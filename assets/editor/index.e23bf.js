window.__require=function t(e,n,i){function a(c,s){if(!n[c]){if(!e[c]){var r=c.split("/");if(r=r[r.length-1],!e[r]){var d="function"==typeof __require&&__require;if(!s&&d)return d(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var l=n[c]={exports:{}};e[c][0].call(l.exports,function(t){return a(e[c][1][t]||t)},l,l.exports,t,e,n,i)}return n[c].exports}for(var o="function"==typeof __require&&__require,c=0;c<i.length;c++)a(i[c]);return a}({DebugEditbox:[function(t,e){"use strict";cc._RF.push(e,"532076qn5tAObREM7qTss8d","DebugEditbox"),cc.Class({extends:cc.Component,properties:{valueName:"editor_map_speed",defaultValue:0},init:function(t){this.args=t},onLoad:function(){var t,e=this.editbox=this.getComponent(cc.EditBox),n=cc.sys.localStorage.getItem(this.valueName)||this.defaultValue;e.string=n,e.string0=n,(t=new cc.Component.EventHandler).target=this.node,t.component="DebugEditbox",t.handler="onChanged",e.textChanged.push(t),(t=new cc.Component.EventHandler).target=this.node,t.component="DebugEditbox",t.handler="onEdit",e.editingDidEnded.push(t)},onChanged:function(t,e){isNaN(t)?e.string=e.string0:e.string0=e.string},onEdit:function(t){var e=t.string;t.string=e,cc.sys.localStorage.setItem(this.valueName,e)}}),cc._RF.pop()},{}],DebugMenu:[function(t,e){"use strict";cc._RF.push(e,"4bd1cx/IoFLYLyRcHgJbez7","DebugMenu"),cc.Class({extends:t("../../script/ui/core/Menu"),properties:{weaponBtn:cc.Node,weaponPop:cc.Node,carBtn:cc.Node,weaponTable:cc.Node,weaponSelectBtn:cc.Node,comPop:cc.Node,comTable:cc.Node,comSelectBtn:cc.Node,bench:[cc.Node],board:cc.Node},onLoad:function(){for(var t in this.weaponBtnTable={},this.bench){var e=this.bench[t],n=cc.sys.localStorage.getItem("test_pilot_b"+t)||"";ENTITY[n]?e.getChildByName("name").getComponent(cc.Label).string=ENTITY[n].name:e.getChildByName("name").getComponent(cc.Label).string="- -";var i=cc.sys.localStorage.getItem("test_star_b"+t)||0;e.getChildByName("star").getChildByName("name").getComponent(cc.Label).string="\u2605"+i}if(this.carBtn){var a=cc.sys.localStorage.getItem("test_vehicle")||"h1",o=this.carBtn;o.getChildByName("name").getComponent(cc.Label).string=ENTITY[a].name;var c=cc.sys.localStorage.getItem("test_star_vehicle")||0;o.getChildByName("star").getChildByName("name").getComponent(cc.Label).string="\u2605"+c}if(this.weaponBtn&&this.weaponPop)for(var s=cc.sys.localStorage.getItem("test_main_weapon"),r=0;r<4;r++){var d=void 0;0!=r?(d=cc.instantiate(this.weaponBtn),this.weaponBtn.getParent().addChild(d)):d=this.weaponBtn,this.weaponBtnTable[r]=d,d.getChildByName("btn").getComponent(cc.Button).clickEvents[0].customEventData=r;var l=cc.sys.localStorage.getItem("test_tower_"+r);this.setIcon(d,l);var h=d.getChildByName("toggle").getComponent(cc.Toggle);h.checkEvents[0].customEventData=r,h.isChecked=s==r;var u=cc.sys.localStorage.getItem("test_star_"+r)||0,v=d.getChildByName("star");v.getChildByName("name").getComponent(cc.Label).string="\u2605"+u,v.getComponent(cc.Button).clickEvents[0].customEventData=r;var p=cc.sys.localStorage.getItem("test_pilot_"+r)||"",f=d.getChildByName("pilot");ENTITY[p]?f.getChildByName("name").getComponent(cc.Label).string=ENTITY[p].name:f.getChildByName("name").getComponent(cc.Label).string="- -",f.getComponent(cc.Button).clickEvents[0].customEventData=r;var m=d.getChildByName("layout").getChildren();for(var g in m){var C=+g+3*r,E=cc.sys.localStorage.getItem("test_part_"+C),T=m[g],y=ItemDefine[E];T.getChildByName("name").getComponent(cc.Label).string=y?y.name+(y.lvl||1):"-",T.getComponent(cc.Button).clickEvents[0].customEventData=C}}this.board.opacity=0,this.board.x=this.board.x+this.board.width,this._resizeCb=this.onResized.bind(this),cc.view.on("canvas-resize",this._resizeCb),window.addEventListener("orientationchange",this._resizeCb),this.onResized(),this.initSwitch()},onDestroy:function(){cc.view.off("canvas-resize",this._resizeCb),window.removeEventListener("orientationchange",this._resizeCb)},onResized:function(){var t=cc.view.getDevicePixelRatio(),e=kit.clamp(.8/cc.view.getScaleX()*t,0,1);this.node.scale=e},initSwitch:function(){this.comPop&&(this.comPop.active=!1,this.comSelectBtn.active=!1,this.comPop.on(cc.Node.EventType.TOUCH_START,function(){this.comPop.active=!1},this)),this.weaponPop&&(this.weaponPop.active=!1,this.weaponSelectBtn.active=!1,this.weaponPop.on(cc.Node.EventType.TOUCH_START,function(){this.weaponPop.active=!1},this))},onSwitch:function(t,e,n){var i=this;if(this.comPop){this.comPop.active=!0;var a=t.convertToWorldSpaceAR(cc.v2(0,0));a.x>cc.winSize.width/2?this.comTable.anchorX=1:this.comTable.anchorX=0,this.comTable.setPosition(this.comPop.convertToNodeSpaceAR(a)),this.comTable.destroyAllChildren();var o=function(t){var a=cc.instantiate(i.comSelectBtn);i.comTable.addChild(a),a.active=!0,a.getChildByName("name").getComponent(cc.Label).string=e[t].n,a.on("click",function(){n(e[t].n,e[t].v)},i)};for(var c in e)o(c)}},onSwitch2:function(t,e,n){var i=this;if(this.weaponPop){this.weaponPop.active=!0,this.weaponTable.setPosition(this.weaponPop.convertToNodeSpaceAR(t.convertToWorldSpaceAR(cc.v2(0,0)))),this.weaponTable.destroyAllChildren();var a=function(t){var a=cc.instantiate(i.weaponSelectBtn);i.weaponTable.addChild(a),a.active=!0,a.getChildByName("name").getComponent(cc.Label).string=e[t].n,a.on("click",function(){n(e[t].n,e[t].v)},i)};for(var o in e)a(o)}},setIcon:function(t,e){var n=ENTITY[e];cc.find("btn/name",t).getComponent(cc.Label).string=n?n.name:"- - -"},onToggle:function(t,e){var n=cc.sys.localStorage.getItem("test_main_weapon");void 0!==n&&this.weaponBtnTable[n]&&(this.weaponBtnTable[n].getChildByName("toggle").getComponent(cc.Toggle).isChecked=!1),t.isChecked=!0,cc.sys.localStorage.setItem("test_main_weapon",e)},start:function(){DEV_MODE?this.board.runAction(cc.spawn(cc.fadeIn(.1),cc.moveBy(.2,-this.board.width,0))):this.node.active=!1},onMenuClose:function(){this.board.runAction(cc.moveBy(.4,this.board.width,0)),this.node.runAction(cc.sequence(cc.fadeOut(.2),cc.destroySelf()))},onClose:function(){menuManager.close(this)},onPopCom:function(t,e){var n=[{n:"- -"}];for(var i in ItemDefine){var a=ItemDefine[i];"equipment"==a.type&&n.push({n:a.name+(a.lvl||1),v:i})}var o=t.target,c=o.getChildByName("name").getComponent(cc.Label);this.onSwitch(o,n,function(t,n){cc.sys.localStorage.setItem("test_part_"+e,n||""),c.string=t})},onPopVehicle:function(t){for(var e=[],n=excel.read("vehicle_list"),i=0;i<n.length;i++)e.push({n:n[i].name,v:n[i].id});var a=t.target,o=a.getChildByName("name").getComponent(cc.Label);this.onSwitch2(a,e,function(t,e){cc.sys.localStorage.setItem("test_vehicle",e||""),o.string=t})},onPopPilot:function(t,e){for(var n=[{n:"- -"}],i=excel.read("hero_list"),a=0;a<i.length;a++)n.push({n:i[a].name,v:i[a].id});var o=t.target,c=o.getChildByName("name").getComponent(cc.Label);this.onSwitch(o,n,function(t,n){cc.sys.localStorage.setItem("test_pilot_"+e,n||""),c.string=t})},onPopStar:function(t,e){for(var n=[],i=0;i<6;i++)n.push({n:"\u2605"+i,v:i});var a=t.target,o=a.getChildByName("name").getComponent(cc.Label);this.onSwitch(a,n,function(t,n){cc.sys.localStorage.setItem("test_star_"+e,n||""),o.string=t})},onPopWeapon:function(t,e){var n=[{n:"- - -"}],i=[CANNON_GUN,FIRE_GUN,MACHINE_GUN];for(var a in excel.read("hero_list"),i){var o=ENTITY[i[a]];n.push({n:o.name,v:o.id})}var c=t.target,s=c.getChildByName("name").getComponent(cc.Label);this.onSwitch2(c,n,function(t,n){cc.sys.localStorage.setItem("test_tower_"+e,n||""),s.string=t})},onWin:function(t,e){var n=menuManager.currentRun().game;if(n)menuManager.close(),e&&(adventure.mapIndex=adventure.mapList.length),n.levelMgr.sendMsg({v:{n:"win"}});else{var i=menuManager.currentRun().args.vehicleConfig;i&&(e?(menuManager.close(),adventure.mapIndex=adventure.mapList.length,adventure.chapterWin(null,i,0)):(adventure.mapIndex++,kit.info("Go to Stage"+(adventure.mapIndex+1))))}},onLoot:function(){var t=menuManager.currentRun().game.levelMgr,e=t.entityList,n=t.heroes[1];for(var i in e)e[i].team!==n.team&&e[i].callDeath(t,0)},onHeatMode:function(t){HEAT_MODE++,HEAT_MODE>5&&(HEAT_MODE=1),t.target.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string="\u8fc7\u70ed\u6a21\u5f0f:"+HEAT_MODE},onJoystickMode:function(t){JOYSTICK_MODE++,JOYSTICK_MODE>3&&(JOYSTICK_MODE=1),t.target.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string="\u7784\u51c6\u6a21\u5f0f:"+JOYSTICK_MODE}}),cc._RF.pop()},{"../../script/ui/core/Menu":void 0}],DebugSelectMenu:[function(t,e){"use strict";cc._RF.push(e,"e0370JTm+pFqoRLheBtBCfb","DebugSelectMenu"),cc.Class({extends:t("../../script/ui/core/Menu"),properties:{headBtn:cc.Node,board:cc.Node},onLoad:function(){this.heroBtnTable={},this.board.opacity=0},start:function(){this.board.runAction(cc.fadeIn(.1))},initStatus:function(t){var e,n=this,i=t.heroes,a=0;for(var o in HEROES){var c=HEROES[o];i&&!i[c]||(0!=a?(e=cc.instantiate(this.headBtn),this.headBtn.getParent().addChild(e)):e=this.headBtn,a++,this.heroBtnTable[c]=e,e.getComponent(cc.Button).clickEvents[0].customEventData=c,c&&function(){var t=UI_CONFIG[c];if(!t)return"continue";n.setCardSelected(e,!1);var i=e.getChildByName("headIcon").getComponent(cc.Sprite);cc.resources.load(t.head.res,cc.SpriteFrame,function(e,n){i.spriteFrame=n,i.node.x+=t.head.x,i.node.y+=t.head.y})}())}i||(e=cc.instantiate(this.headBtn),this.headBtn.getParent().addChild(e),this.heroBtnTable[""]=e,e.getComponent(cc.Button).clickEvents[0].customEventData=""),this.heroId=t.heroId||"",(e=this.heroBtnTable[this.heroId])&&this.setCardSelected(e,!0)},setCardSelected:function(t,e){t.getChildByName("check").opacity=e?255:0},onTouch:function(t,e){var n=this.heroBtnTable[this.heroId];n&&this.setCardSelected(n,!1);var i=t.target;this.setCardSelected(i,!0),this.heroId=e||"";var a=this.args.cb;a&&a(this.heroId)},onMenuClose:function(){this.board.runAction(cc.moveBy(.4,-this.board.width,0)),this.node.runAction(cc.sequence(cc.fadeOut(.2),cc.removeSelf()))},onCheck:function(){var t=this.args.checkCb;t&&t(this.heroId)||this.onClose()}}),cc._RF.pop()},{"../../script/ui/core/Menu":void 0}],DebugSlider:[function(t,e){"use strict";cc._RF.push(e,"ad83czDpbZFdIP+JG27miXl","DebugSlider"),cc.Class({extends:cc.Component,properties:{value:"DEBUG_GAME_SPEED"},init:function(t){this.args=t},onLoad:function(){var t=this.slider=this.getComponent(cc.Slider);t.progress=Math.pow(window[this.value],.5)/2;var e,n=new cc.Component.EventHandler;n.target=this.node,n.component="DebugSlider",n.handler="onSlider",t.slideEvents.push(n);var i=this.editbox=this.node.getChildByName("input").getComponent(cc.EditBox);i.string=window[this.value],i.string0=window[this.value],(e=new cc.Component.EventHandler).target=this.node,e.component="DebugSlider",e.handler="onChanged",i.textChanged.push(e),(e=new cc.Component.EventHandler).target=this.node,e.component="DebugSlider",e.handler="onEdit",i.editingDidEnded.push(e)},onSlider:function(t){var e=Math.round(100*Math.pow(2*t.progress,2))/100;this.editbox.string=e,this.setValue(e)},onChanged:function(t,e){isNaN(t)?e.string=e.string0:e.string0=e.string},onEdit:function(t){var e=kit.clamp(1*t.string,0,4);t.string=e,this.slider.progress=Math.pow(e,.5)/2,this.setValue(e)},setValue:function(t){window[this.value]=t,cc.sys.localStorage.setItem(this.value,t),this.cb&&this.cb(t)}}),cc._RF.pop()},{}],DebugToggle:[function(t,e){"use strict";cc._RF.push(e,"c0c6eqfdHVPjr+uwio0Fe3S","DebugToggle"),cc.Class({extends:cc.Component,properties:{value:"DEBUG_MODE",storage:!1},onLoad:function(){this.getComponent(cc.Toggle).isChecked=this.get(),this.node.on("toggle",this.onSwitch,this)},start:function(){},get:function(){return this.storage?+cc.sys.localStorage.getItem(this.value):window[this.value]},set:function(t){this.storage?cc.sys.localStorage.setItem(this.value,t):(window[this.value]=t,storage.set(this.value,window[this.value]?1:0))},onSwitch:function(t){this.set(t.isChecked?1:0)}}),cc._RF.pop()},{}],EditorListMenu:[function(t,e){"use strict";cc._RF.push(e,"7ef51VgsO9J/Y52QAs5iBs2","EditorListMenu"),cc.Class({extends:t("../../script/ui/core/Menu"),properties:{noTopBar:!0,layoutNode:cc.Node,button:cc.Node},onLoad:function(){this.buttonList=[];var t=cc.sys.localStorage.getItem("editor_page")||0;this.pageIndex=t;for(var e=1;e<=100;e++){var n=cc.instantiate(this.button);this.layoutNode.addChild(n),n.on("click",this.onClick,this),this.buttonList[e-1]=n,this.loadMap(t,e)}this.button.active=!1,menuManager.playBgm(),cc.debug.setDisplayStats(!1)},initStatus:function(){this._super(),menuManager.setDefault()},refreshPage:function(t){if(!(t<0)){this.pageIndex=t,cc.sys.localStorage.setItem("editor_page",t);for(var e=1;e<=100;e++)this.loadMap(t,e)}},loadMap:function(t,e){var n,i=100*t+e,a=this.buttonList[e-1],o="bastion/map_"+i;a.mapIndex=o;try{var c=cc.sys.localStorage.getItem(o);c&&(n=JSON.parse(c))}catch(r){console.warn(r)}var s="";n?(s=n.config.name,cc.sys.localStorage.setItem(o,JSON.stringify(UPGRADE_MAP_DATA(n))),a.color=cc.color(255,255,255)):a.color=cc.color(155,155,155),a.getChildByName("label").getComponent(cc.Label).string=s?i+"\n"+s:i},onPrevPage:function(){this.refreshPage(+this.pageIndex-1)},onNextPage:function(){this.refreshPage(+this.pageIndex+1)},start:function(){},onClick:function(t){var e=t.node;menuManager.runReal("editor/editor",{mapIndex:e.mapIndex})}}),cc._RF.pop()},{"../../script/ui/core/Menu":void 0}],EditorMenu:[function(t,e){"use strict";var n;cc._RF.push(e,"226e9Qmz/xCVrZu+TFJzM7J","EditorMenu");var i=t("../../script/managers/GameSystem"),a=(t("../../script/scripts/VirtualLayer"),t("../../script/managers/EffectManager")),o=t("../../script/entities/environment/GroundAvatar");t("../../script/scripts/Theme"),cc.Class({extends:t("../../script/ui/core/Menu"),properties:{noTopBar:!0,map:{default:null,type:cc.JsonAsset},gameLayer:cc.Node,editUI:cc.Node,eventUI:cc.Node,centerUI:cc.Node,eventBoards:[cc.Node],mapUI:cc.Node,mapBoards:[cc.Node],unitBoards:[cc.Node],brushBoards:[cc.Node],mapNode:cc.Node,coverNode:cc.Node,topCoverNode:cc.Node,cancelButton:cc.Node,infoBoard:cc.Node,posLabel:cc.Label,event:cc.Node,unit:cc.Node,inputItem:cc.Node,buttonItem:cc.Node,textItem:cc.Node,netName:cc.EditBox,deadLine:cc.Node,topLine:cc.Node,endLine:cc.Node,timeLabel:cc.Label,selectFrame:cc.SpriteFrame,sliderPrefab:cc.Prefab,debugMenuPrefab:cc.Prefab},onLoad:function(){this.effectMgr=new a,this.mapBoards[0].active=!0,this.mapBoards[1].active=!1,this.mapBoards[2].active=!1,this.mapBoards[3].active=!1,this.preBoard=this.mapBoards[0],this.skipSelect=["brush","ground"],this.unitBoards[0].active=!1,this.brushBoards[0].active=!1,this.cancelButton.active=!1,this.infoBoard.list=[],this.infoBoard.active=!1,this.eventBoards[0].active=!1,this.eventBoards[1].active=!1,this.eventBoards[1].condList=[],this.eventBoards[1].actList=[],this.event.active=!1,this.linkList=[],this.selectList=[],cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),menuManager.playBgm(),this.deadLine.zIndex=1e4,this.topLine.zIndex=1e4,this._resizeCb=this.onResized.bind(this),cc.view.on("canvas-resize",this._resizeCb),window.addEventListener("orientationchange",this._resizeCb),this.onResized()},onResized:function(){var t=cc.view.getDevicePixelRatio(),e=.5/cc.view.getScaleX()*t;cc.log("onResized",t),this.editUI.scale=e,this.infoBoard.scale=e,this.eventUI.scale=e,this.centerUI.scale=e,this.cancelButton.scale=e,this.uiScale=e;var n=cc.winSize.height/1280;this.updateMapNode(this.mapNode.x,-cc.winSize.height/3,n);var i=this.gameLayer.getParent(),a=i.getComponent(cc.Widget);if(i.scale=n,a){var o=720*(1-n)/2;a.left=o,a.right=o,cc.log("onResized gameScale",720/n,n,o)}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),cc.view.off("canvas-resize",this._resizeCb),window.removeEventListener("orientationchange",this._resizeCb)},saveTempMap:function(){var t=new Date,e=this.mapData;e.config.date=t.getTime(),this.timeLabel.string=t.toLocaleString();var n=this.tempList;this.tempIndex++,n.push({mapData:kit.clone(e),index:this.tempIndex}),cc.sys.isMobile&&n.length>100&&n.shift()},restoreTempMap:function(){var t=this.tempList;if(!(t.length<=1)){t.pop();var e=t[t.length-1],n=kit.clone(e.mapData);this.resetMap(n)}},resetMap:function(t){for(var e in this.onHideEventUI(),this.onHideUnitUI(),this.onHideBrushUI(),this.canSelectList)this.canSelectList[e].destroy();this.selectList=[],this.canSelectList=[],delete this.selectOne,this.mapData=t,this.initMapConfig(t),this.initMapGround(t),this.initMapTheme(t),this.initMapEvent(t),this.initMapEntity(t),this.updateGrid(),this.updateMapLink()},loadMap:function(){var t;try{var e=cc.sys.localStorage.getItem(this.mapIndex);e&&(t=JSON.parse(e))}catch(n){console.warn(n)}return t||JSON.parse(JSON.stringify(DEFAULT_MAP))},saveMap:function(){var t=this.netName.string;t&&(this.mapData.netName=t.replace(".","_")),cc.sys.localStorage.setItem(this.mapIndex,JSON.stringify(this.mapData)),kit.info("\u5730\u56fe\u4fdd\u5b58\u5b8c\u6bd5")},initStatus:function(t){if(this.mapIndex=t.mapIndex||"map_1",t.mapData)var e=t.mapData;else e=this.loadMap();this.initMap(e),cc.sys.isMobile?this.initMobileCover():this.initDesktopCover(),this.initEntityUI()},start:function(){},initMap:function(t){this.canSelectList=[],this.mapData=t,this.initMapConfig(t),this.initMapGround(t),this.initThemeUI(t),this.initMapEntity(t),this.initEventUI(t),this.initGrid(t),this.updateMapLink();var e=t.netName||"";e=e.replace(".","_"),cc.log("netName",t.netName,t),this.netName.string=e,this.tempIndex=0,this.tempList=[{mapData:kit.clone(t),index:this.tempIndex}]},updateMapLink:function(){var t=this;this.eventList=[],this.entityList=[];var e=this.mapBoards[3];e.skipSelect=["brush","ground"];for(var n=e.getChildByName("item"),i=cc.find("scroll/view/layout",e),a=this.linkList,o=0,c=function(){var e=t.canSelectList[s];if("brush"===e.editType||"ground"===e.editType)return"continue";var c=a[o];o++,c||(c=cc.instantiate(n),i.addChild(c),c.on("click",function(){c.onClick&&c.onClick.call(this)},t),a.push(c));var d=e.cfgData;c.active=!0;var l=c.getChildByName("label"),h=d.id;"event"===e.editType?(r="\u4e8b\u4ef6",l.color=cc.color(155,150,255),h&&(r=r+"\n"+d.id,t.eventList.push({n:r,s:h}))):(r=e.define.name,l.color=cc.color(150,255,150),h&&(r=r+"\n"+d.id,t.entityList.push({n:r,s:h}))),l.getComponent(cc.Label).string=r,c.onClick=function(){t.updateMapNode(-e.x*t.mapScale,-e.y*t.mapScale),t.onShowUI(e)}},s=0;s<this.canSelectList.length;s++){var r;c()}for(;o<a.length;o++)a[o].active=!1;n.active=!1},updateMapNode:function(t,e,n){for(var i in void 0===n?n=this.mapScale||1:(this.mapNode.scale=n,this.mapScale=n),this.mapNode.x=t,this.mapNode.y=e,this.deadLine.x=-this.mapNode.x/n,this.deadLine.scale=1/n,this.topLine.x=-this.mapNode.x/n,this.topLine.scale=1/n,this.deadLine.getChildByName("label").getComponent(cc.Label).string="\u5730\u5e73\u7ebf\n"+Math.round(-t/n),this.background&&this.background.updateLayers(-this.mapNode.x/n,-this.mapNode.y/n-cc.winSize.height/2.3),this.groundAvatars)if(this.groundAvatars[i]){var a=(-this.mapNode.x-cc.winSize.width/2)/this.mapScale,o=(-this.mapNode.x+cc.winSize.width/2)/this.mapScale;this.groundAvatars[i].updateGround(a,o)}},initGrid:function(){var t=new cc.Node;this.mapNode.addChild(t,1e3),this.debugDraw=t.addComponent(cc.Graphics),this.updateGrid()},updateGrid:function(){var t=this.debugDraw;t.clear();for(var e=0;e<this.distance;)t.lineWidth=3/this.mapScale,t.strokeColor=cc.color(255,255,255,130),t.fillColor=cc.color(255,255,255,0),t.rect(e+2,0,496,720),t.fill(),t.stroke(),e+=500;this.endLine.x=this.distance,this.cpNode&&(this.cpNode.x=this.distance)},initMapConfig:function(t){t.config||(t.config={date:Date.now()});var e=t.config,n=this.mapBoards[0];n.skipSelect=["brush","ground"];var i=n.getChildByName("layout"),a=i.inputList=i.inputList||[];for(var o in CONFIG_DESCRIBE){var c=CONFIG_DESCRIBE[o],s=e[c.v],r=a[o];r||(r=cc.instantiate(this.inputItem),i.addChild(r),r.getChildByName("name").getComponent(cc.Label).string=c.n,a[o]=r);var d=r.getChildByName("input");this.initEdit(d.getComponent(cc.EditBox),s,c,e,c.func)}this.updateMapNode(0,-cc.winSize.height/3),this.width=720,this.height=1280,this.distance=t.config.distance;var l=new Date(t.config.date);this.timeLabel.string=l.toLocaleString()},initMapTheme:function(t){t.scene||(t.scene=[]);var e=new cc.Node;this.mapNode.addChild(e,-10),this.themeNode=e,this.themeType=t.config.theme||"dust",this.themeDefine=THEME_DEFINE[this.themeType],this.updateMapTheme(t)},updateMapTheme:function(t){var e=this,n=this.themeNode;for(var i in n.destroyAllChildren(),this.canSelectList)"brush"===this.canSelectList[i].editType&&(this.canSelectList.splice(i,1),i--);var a=this.themeDefine,o=this.effectMgr,c=a.bg;c.prefab&&(this.groundAvatars={},this.groundDraws={},o.instantiate(c.prefab,function(i,c){n.addChild(c,-1),c.setPosition(0,150);var s=e.background=c.getComponent("Background"),r=e.mapScale;for(var d in s.updateLayers(-e.mapNode.x/r,-e.mapNode.y/r-cc.winSize.height/2.3),s.grounds)s.grounds[d].active=!1;var l=c.getChildByName("entity");if(l){e.sceneNode=l,e.bgNode=c;var h=t.scene;for(var u in h){var v=h[u],p=a.list[v.i];if(p){var f=o.createSprite(v.x,v.y,p);l.addChild(f),f.editType="brush",f.cfgData=v,e.canSelectList.push(f)}}var m=t.config.distance,g=o.createArmature("qizhi","qizhi",function(t,e){e.playAnimation("stand")});g.setPosition(m,-5),g.scale=ANIME_SCALE,l.addChild(g,1),e.cpNode=g,e.updateMapGround(t)}}))},initThemeUI:function(t){var e=this;this.initMapTheme(t);var n,i=(n=this.brushBoards[0]).getChildByName("layout");for(var a in BRUSH_DESCRIBE){var o=BRUSH_DESCRIBE[a],c=cc.instantiate(this.inputItem);i.addChild(c),c.getChildByName("name").getComponent(cc.Label).string=o.n,c.define=o,c.name=a}var s=this.effectMgr,r=THEME_DEFINE[t.config.theme||"dust"].list;(n=this.mapBoards[2]).skipSelect=null;for(var d=n.getChildByName("item"),l=(i=n.getChildByName("layout"),0);l<3;l++){var h=cc.instantiate(d);i.addChild(h),h.getChildByName("label").getComponent(cc.Label).string="\u8def\u70b9"+l,h.color=this.groundColors[l],h.id="ground",h.groundIndex=l,h.on("click",this.onPrepareBrush,this)}var u=function(t){p=r[t];var n=cc.instantiate(d);i.addChild(n),n.getChildByName("label").getComponent(cc.Label).string=p.n||"",cc.js.isString(p)&&s.createSprite(0,0,p,null,function(t,e){var i=e.node;n.addChild(i,1,"sp"),i.scale=Math.min(120/i.width,120/i.height)}),n.color=cc.color(255,255,255),n.id=t,n.define=p,n.on("click",e.onPrepareBrush,e)};for(var v in r){var p;u(v)}d.active=!1},createGroundPoint:function(t,e){var n=this,i={cfgData:t,groundIndex:e,width:40,height:40,editType:"ground",get x(){return t.x},set x(i){t.x=i,n.updateGroundPoint(e)},get y(){return t.y},set y(i){t.y=i,n.updateGroundPoint(e)},destroy:function(){n.updateGroundPoint(e)}};return this.canSelectList.push(i),i},updateGroundPoint:function(t){void 0===t&&(t=0);var e=this.mapData.ground[t].list||[];if(e.length>0){var n=this.groundDraws[t];if(n)n.clear();else{var i=new cc.Node;this.mapNode.addChild(i,1e3),(n=this.groundDraws[t]=i.addComponent(cc.Graphics)).strokeColor=this.groundColors[t],n.fillColor=this.groundColors[t]}if(e.sort(function(t,e){return t.x-e.x}),!this.skipSelect||!this.skipSelect.includes("ground")){for(var a in n.lineWidth=4/this.mapScale,n.moveTo(-1e3,e[0].y),e){var c=e[a];n.lineTo(c.x,c.y),n.stroke()}for(var s in e){var r=e[s];n.rect(r.x-15,r.y-15,30,30),n.stroke(),0==s||s==e.length-1||n.fill()}}}var d=(-this.mapNode.x-cc.winSize.width/2)/this.mapScale,l=(-this.mapNode.x+cc.winSize.width/2)/this.mapScale,h=this.groundAvatars[t];if(h)h.resetGround(e,d,l);else if(this.sceneNode){var u=t,v=this.effectMgr,p=this.bgNode.getComponent("Background").material,f=this.bgNode.getComponent("Background").grounds,m=f[u<f.length?u:f.length-1],g=m.getComponent(cc.Sprite).spriteFrame,C=m.color,E=m.y-this.sceneNode.y;u>0&&f.length>1&&(E-=147*u);var T=new cc.Node;this.sceneNode.addChild(T,1e3*-u),(h=T.addComponent(o)).initGround({effectMgr:v,left:d,right:l,dx:0,dy:E,list:e,spriteFrame:g,material:p,color:C}),h.updateGround(d,l),this.groundAvatars[u]=h}},initMapGround:function(t){t.ground||(t.ground=[]),this.groundAvatars={},this.groundDraws={},this.groundColors=[cc.color(255,255,255,155),cc.color(0,255,255,155),cc.color(0,0,255,155)];var e=t.ground;for(var n in e){var i=e[n];i||(i=e[n]={i:n,list:[]});var a=i.list||[];for(var o in a)this.createGroundPoint(a[o],i.i)}this.updateMapGround(t)},updateMapGround:function(){var t=this.mapData.ground;if(t)for(var e in t){var n=t[e];this.updateGroundPoint(n.i)}},initMapEvent:function(t){t.event||(t.event=[]);var e=t.event;for(var n in e){var i=e[n];this.createEvent(i)}},initEventUI:function(t){this.initMapEvent(t);var e=this.eventBoards[0].getChildByName("layout");for(var n in EVENT_DESCRIBE){var i=EVENT_DESCRIBE[n],a=cc.instantiate(this.inputItem);e.addChild(a),a.getChildByName("name").getComponent(cc.Label).string=i.n,a.define=i,a.name=n}for(var n in(e=cc.find("scroll/view/layout/cond/more",this.eventBoards[1])).zIndex=cc.macro.MAX_ZINDEX,COND_LIST)i=COND_DESCRIBE[COND_LIST[n]],a=cc.instantiate(this.buttonItem),e.addChild(a),a.getChildByName("name").getComponent(cc.Label).string=i.n,a.define=i,a.on("click",this.addEventCond,this);for(var n in(e=cc.find("scroll/view/layout/act/more",this.eventBoards[1])).zIndex=cc.macro.MAX_ZINDEX,ACT_LIST)i=ACT_DESCRIBE[ACT_LIST[n]],a=cc.instantiate(this.buttonItem),e.addChild(a),a.getChildByName("name").getComponent(cc.Label).string=i.n,a.define=i,a.on("click",this.addEventAct,this);var o=new cc.Node;this.mapNode.addChild(o,100),(this.eventDraw=o.addComponent(cc.Graphics)).node.active=!1},initMapEntity:function(t){t.entity||(t.entity=[]);var e=t.entity;for(var n in e){var i=e[n];this.createEntity(i)}this.cancelButton.collideTest=function(t){var e=this.convertToNodeSpaceAR(t);return Math.abs(e.x)<this.width*this.scale&&Math.abs(e.y)<this.height*this.scale}},initEntityUI:function(){var t,e=(t=this.unitBoards[0]).getChildByName("layout");for(var n in ATTRIBUTE_DESCRIBE){var i=ATTRIBUTE_DESCRIBE[n],a=cc.instantiate(this.inputItem);e.addChild(a),a.getChildByName("name").getComponent(cc.Label).string=i.n,a.define=i,a.name=n}var o=getSortList();(t=this.mapBoards[1]).skipSelect=["brush","ground"];var c=t.getChildByName("item");for(var n in e=cc.find("scroll/view/layout",t),o){var s=o[n],r=ENTITY[s];if(r){var d=cc.instantiate(c);e.addChild(d);var l=r.avatar,h=this.createAvatar(l,{});d.addChild(h),h.scale=(l.s||1)*Math.min(1,50/r.radius)||.5,h.y-=15,d.define=r,d.id=s,d.on("click",this.onPrepareUnit,this)}}c.active=!1,this.cancelButton.on("click",this.onCancel,this)},onJumpTo:function(t,e){var n=+e-1,i=this.mapBoards[1].getChildByName("scroll").getComponent(cc.ScrollView),a=[.95,.35,.05][n]||0;i.scrollToPercentVertical(a,.1)},onCancel:function(){this.testing||(this.prepareOne&&(this.prepareOne.destroy(),this.prepareOne=null),this.editUI.active=!0,this.eventUI.active=!0,this.centerUI.active=!0,this.cancelButton.active=!1)},updateBrushUI:function(t){var e=t.cfgData,n=this.brushBoards[0].getChildByName("layout");for(var i in BRUSH_DESCRIBE){var a=e[BRUSH_DESCRIBE[i].v];n.getChildByName(i).getChildByName("input").getComponent(cc.EditBox).string=a||""}},onShowBrushUI:function(t){this.onHideEventUI(),this.onHideUnitUI();var e=this.brushBoards[0];e.active=!0;var n=t.cfgData,i=e.getChildByName("layout");for(var a in BRUSH_DESCRIBE){var o=BRUSH_DESCRIBE[a],c=n[o.v],s=i.getChildByName(a).getChildByName("input");this.initEdit(s.getComponent(cc.EditBox),c,o,n,o.func)}var r=e.getChildByName("delete");r.on("click",this.onRemove,this),r.unit=t},onHideBrushUI:function(){this.brushBoards[0].active=!1},onPrepareBrush:function(t){var e=t.node.define,n=cc.instantiate(t.node);this.node.addChild(n,1001),n.active=!0,n.id=t.node.id,"ground"==n.id?(n.define=null,n.editType="ground",n.groundIndex=t.node.groundIndex):(n.define=e,n.editType="brush"),n.getComponent(cc.Button).enabled=!1;var i=n.getChildByName("sp");i&&(i.scale=1,i.opacity=150),n.scale0=1,n.scale=n.scale0*this.mapScale,this.prepareOne=n,this.editUI.active=!1,this.eventUI.active=!1,this.cancelButton.active=!0,this.onHideUI()},onPrepareUnit:function(t){var e=t.node.id,n=t.node.define,i=n.avatar,a=this.createAvatar(i,{});this.node.addChild(a,1e3),a.scale0=i.s||1,a.scale=a.scale0*this.mapScale,a.define=n,a.id=e,a.editType="entity",this.prepareOne=a,this.editUI.active=!1,this.eventUI.active=!1,this.centerUI.active=!1,this.cancelButton.active=!0,this.onHideUI()},onPrepareEvent:function(){var t=cc.instantiate(this.event);this.node.addChild(t,1001),t.scale0=1,t.scale=t.scale0*this.mapScale,t.active=!0,t.editType="event",this.prepareOne=t,this.editUI.active=!1,this.eventUI.active=!1,this.centerUI.active=!1,this.cancelButton.active=!0,this.onHideUI()},onShowEventUI:function(t){this.onHideUnitUI(),this.onHideBrushUI(),(e=this.eventBoards[0]).active=!0;var e,n=t.cfgData,i=e.getChildByName("layout");for(var a in EVENT_DESCRIBE){var o=EVENT_DESCRIBE[a],c=n[o.v],s=i.getChildByName(a).getChildByName("input");this.initEdit(s.getComponent(cc.EditBox),c,o,n,o.func)}var r=e.getChildByName("delete");r.on("click",this.onRemove,this),r.unit=t,(e=this.eventBoards[1]).active=!0,this.showEventCell(t,e.getChildByName("condItem"),cc.find("scroll/view/layout/cond",e),e.condList,n.cond,COND_DESCRIBE),this.showEventCell(t,e.getChildByName("actItem"),cc.find("scroll/view/layout/act",e),e.actList,n.act,ACT_DESCRIBE),this.eventDraw.node.active=!0,this.updateEventArea(t)},onRemoveEventCell:function(t){var e=t.cfgData,n=t.list,i=n.indexOf(e);i>=0&&(n.splice(i,1),this.saveTempMap(),t.updateEventCell.call(this))},showEventCell:function(t,e,n,i,a,o){for(var c=0,s=function(){var t=i[c];if(c++,!t){t=cc.instantiate(e),n.addChild(t,-100),i.push(t),cc.find("label/expand",t).on("click",function(){t.onClick&&t.onClick.call(this,t)},this),t.cacheList=[];var a=t.getChildByName("delete");a.on("click",function(){t.onDelete&&t.onDelete.call(this,t)},this),t.deleteBtn=a;var o=t.getChildByName("up");if(o){var s=n.getParent().getParent().getParent().getComponent(cc.ScrollView);t.scroll=s,o.on(cc.Node.EventType.TOUCH_START,function(e){this.onDragStart(t,e)},this),o.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.onDragMove(t,e)},this),o.on(cc.Node.EventType.TOUCH_END,function(e){this.onDragEnd(t,e)},this),o.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.onDragEnd(t,e)},this),t.dragBtn=o}}return t.color=e.color,t.active=!0,t}.bind(this),r=0,d=0,l=[],h=0;h<a.length;h++){var u=s();u.zIndex=h,l[h]=u,u.uiList=l;var v=a[h],p=o[v.type||0],f=u.getChildByName("label"),m=f.getComponent(cc.Label);m.string="["+p.n+"]"+p.func(v),u.define=p,u.cfgData=v,u.list=a,u.event=t,u.onClick=this.onEventCell,this.closeEventCell(u),f.color=cc.color(255,255,255),p.virtual?p.i==ACT.CHOSE?(r=v.n||0,u.color=cc.color(40,70,150)):p.i==ACT.DELAY&&(d=v.t||0,f.color=cc.color(100,255,100)):(r>0&&(u.color=cc.color(40,70,110),m.string=(r>1?"\u2560\u2550":"\u255a\u2550")+m.string,r--),d>0&&(f.color=cc.color(200,255,200),m.string="\u25d4"+d+"\u25b8"+m.string)),u.onDelete=this.onRemoveEventCell,u.updateEventCell=function(){this.updateEvent(t,t.cfgData),this.showEventCell(t,e,n,i,a,o)}}for(;c<i.length;c++)i[c].active=!1;e.active=!1},onDragStart:function(t){t.scroll.enabled=!1,t.dragBtn.color=cc.color(0,255,0);var e=t.uiList;for(var n in e)e[n]!=t&&(e[n].opacity=50);t.dragY=0},onDragMove:function(t,e){var n=t.uiList,i=0;if(t.dragY+=e.getDeltaY(),t.dragY>30&&t.zIndex>0){i=-1;var a=(c=n[o=t.zIndex+i]).height;t.dragY>a?t.dragY-=a:i=0}else if(t.dragY<-30&&t.zIndex<n.length-1){var o,c;i=1,a=(c=n[o=t.zIndex+i]).height,t.dragY<-a?t.dragY+=a:i=0}if(i){var s=t.list,r=t.cfgData,d=s.indexOf(r);d>=0&&(s[d]=s.splice(d+i,1,s[d])[0],c.zIndex=t.zIndex,t.zIndex=o,n[o]=t,n[c.zIndex]=c,t.dragChanged=!0)}},onDragEnd:function(t){t.scroll.enabled=!0,t.dragBtn.color=cc.color(255,255,255);var e=t.uiList;for(var n in e)e[n].opacity=255;t.updateEventCell.call(this),t.dragChanged&&(t.dragChanged=!1,this.saveTempMap())},addEventCond:function(t){var e=this.selectOne;if(e&&"event"==e.editType){var n=t.node.define,i=e.cfgData;i.cond.push({type:n.i}),this.saveTempMap();var a=this.eventBoards[1];a.active=!0,this.showEventCell(e,a.getChildByName("condItem"),cc.find("scroll/view/layout/cond",a),a.condList,i.cond,COND_DESCRIBE),this.updateEvent(e,e.cfgData)}},addEventAct:function(t){var e=this.selectOne;if(e&&"event"==e.editType){var n=t.node.define,i=e.cfgData;i.act.push({type:n.i}),this.saveTempMap();var a=this.eventBoards[1];a.active=!0,this.showEventCell(e,a.getChildByName("actItem"),cc.find("scroll/view/layout/act",a),a.actList,i.act,ACT_DESCRIBE),this.updateEvent(e,e.cfgData)}},onEventCell:function(t){t.editExpand?this.closeEventCell(t):this.expandEventCell(t)},closeEventCell:function(t){t.editExpand=!1;for(var e=t.cacheList,n=0;n<e.length;n++)e[n].active=!1;t.getComponent(cc.Layout).updateLayout(),t.getParent().getComponent(cc.Layout).updateLayout()},expandEventCell:function(t){t.editExpand=!0;for(var e=t.cfgData,n=t.cacheList,i=0,a=t.define.v,o=0;o<a.length;o++){var c=n[i];i++,c||((c=cc.instantiate(this.inputItem)).on("click",function(t){var e=t.node;e.onClick&&e.onClick.call(this,e)},this),t.addChild(c),n.push(c),c.list=[]),c.zIndex=o,c.active=!0;var s=a[o],r=e[s.v];c.getChildByName("name").getComponent(cc.Label).string=s.n||s.v;var d=c.getChildByName("input").getComponent(cc.EditBox);this.initEdit(d,r,s,e,function(i,a,o){this.updateEvent(i,i.cfgData),t.getChildByName("label").getComponent(cc.Label).string="["+t.define.n+"]"+t.define.func(e),o.define.initFunc&&o.define.initFunc.call(this,i,a,o,n)})}for(;i<n.length;i++)n[i].active=!1;for(o=0;o<a.length;o++){var l=n[o],h=a[o],u=e[h.v],v=l.getChildByName("input").getComponent(cc.EditBox);h.initFunc&&h.initFunc.call(this,t.event,u,v,n)}t.getComponent(cc.Layout).updateLayout(),t.getParent().getComponent(cc.Layout).updateLayout()},onHideEventUI:function(){this.eventBoards[0].active=!1,this.eventBoards[1].active=!1,this.eventDraw.node.active=!1},updateEventUI:function(t){var e=t.cfgData,n=this.eventBoards[0].getChildByName("layout");for(var i in EVENT_DESCRIBE){var a=e[EVENT_DESCRIBE[i].v];n.getChildByName(i).getChildByName("input").getComponent(cc.EditBox).string=a||""}},updateEventArea:function(t){this.eventDraw.clear();var e=[cc.color(255,0,0,40),cc.color(255,255,0,40),cc.color(0,255,0,40),cc.color(0,255,255,40),cc.color(0,0,255,40),cc.color(255,0,255,40)],n=0,i=t.cfgData,a=i.cond;for(var o in a){var c=a[o];COND_DESCRIBE[c.type||0].area&&(this.showArea(c[1],c[2],c[3],c[4],e[n]),n++)}var s=i.act;for(var o in s){var r=s[o];ACT_DESCRIBE[r.type||0].area&&(this.showArea(r[1],r[2],r[3],r[4],e[n]),n++)}},showArea:function(t,e,n,i,a){var o=this.width,c=this.height,s=this.eventDraw;s.lineWidth=5,s.strokeColor=a,void 0===t&&void 0===e&&void 0===n&&void 0===i||(void 0===t&&(t=.5*-o),void 0===e&&(e=.5*o),void 0===n&&(n=c),void 0===i&&(i=0),s.rect(+t,+i,e-t,n-i),s.stroke(),s.fillColor=a,s.fill())},updateUnitUI:function(t){var e=t.cfgData,n=this.unitBoards[0].getChildByName("layout");for(var i in ATTRIBUTE_DESCRIBE){var a=ATTRIBUTE_DESCRIBE[i],o=n.getChildByName(i),c=kit.getValueInTable(e,a.v);o.getChildByName("input").getComponent(cc.EditBox).string=c||""}},onShowUnitUI:function(t){this.onHideEventUI(),this.onHideBrushUI();var e=this.unitBoards[0];e.active=!0;var n=t.cfgData,i=e.getChildByName("layout");for(var a in ATTRIBUTE_DESCRIBE){var o=ATTRIBUTE_DESCRIBE[a],c=kit.getValueInTable(n,o.v),s=i.getChildByName(a);if(!o.ids||o.ids.includes(n.i)){s.active=!0;var r=s.getChildByName("input");this.initEdit(r.getComponent(cc.EditBox),c,o,n,o.func)}else s.active=!1}var d=e.getChildByName("delete");d.on("click",this.onRemove,this),d.unit=t,e.getChildByName("name").getComponent(cc.Label).string=t.define.name+"["+t.cfgData.i+"]"},onHideUnitUI:function(){this.unitBoards[0].active=!1},onShowUI:function(t){if(this.selectOne){if(this.selectOne==t)return void(this.unitDrag=t);this.selectOne.zIndex-=1e3,this.selectOne.selectEffect.destroy()}this.selectOne=t,"entity"==t.editType?this.onShowUnitUI(t):"event"==t.editType?this.onShowEventUI(t):this.onShowBrushUI(t);var e=new cc.Node;this.mapNode.addChild(e,cc.macro.MAX_ZINDEX),e.setPosition(t.x,t.y);var n=e.addComponent(cc.Sprite);n.spriteFrame=this.selectFrame,n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,e.width=t.width+10,e.height=t.height+20,t.selectEffect=e,t.zIndex+=1e3},onHideUI:function(){var t=this.selectOne;this.selectOne&&("entity"==t.editType?this.onHideUnitUI(t):"event"==t.editType?this.onHideEventUI(t):this.onHideBrushUI(),this.selectOne.zIndex-=1e3,this.selectOne.selectEffect.destroy(),this.selectOne=null)},onSelect:function(t,e){var n,i=1/0;for(var a in this.canSelectList){var o=this.canSelectList[a],c=o.editType;if((!this.skipSelect||!this.skipSelect.includes(c))&&Math.abs(o.x-t)<o.width/2&&Math.abs(o.y-e)<o.height/2){var s=kit.sumOfSquares(o.x-t,o.y-e);if(s<i&&(i=s,(n=o)==this.selectOne))break}}var r=this.selectList;if(this.ctrlKey){if(n&&"ground"!=n.editType){var d=r.indexOf(n);if(d<0){r.push(n);var l=new cc.Node;n.addChild(l,1e3);var h=l.addComponent(cc.Sprite);h.spriteFrame=this.selectFrame,h.type=cc.Sprite.Type.SLICED,h.sizeMode=cc.Sprite.SizeMode.CUSTOM,l.width=n.width+20,l.height=n.height+30,l.color=cc.color(0,255,0),n.multiSelectEffect=l}else r.splice(d,1),n.multiSelectEffect.destroy()}}else{for(var a in r)r[a].multiSelectEffect.destroy();this.selectList=[]}if(n)return this.onShowUI(n),n;this.onHideUI()},updateUI:function(t){this.selectOne==t&&("event"==t.editType?this.updateEventUI(t):"entity"==t.editType?this.updateUnitUI(t):this.updateBrushUI(t))},onEditBegan:function(t){var e,n,i,a,o,c,s,r,d,l,h,u,v=this,p=t.define,f=t.cfgData,m=this.infoBoard,g=p.info||p.name;(g||p.listFunc||p.list)&&function(){m.active=!0,e=m.getChildByName("layout"),n=e.getChildByName("label"),i=n.getComponent(cc.Label),a=m.list,o=p.list,e.width=535,n.width=525,p.listFunc&&(o=p.listFunc.call(v,f)||o),c=t.node.convertToWorldSpaceAR(cc.v2(0,-10)),c=v.node.convertToNodeSpaceAR(c),i.string=g;var C=v.textItem;if(p.text?(C.active=!0,s=C.getComponent(cc.EditBox),d=kit.getValueInTable(f,p.v),v.initEdit(s,d,p,f,function(e,n,i){t.string=i.string;var a=t.func;a&&a.call(this,e,n,i)})):C.active=!1,r=0,o){m.cacheChosen=null,d=kit.getValueInTable(f,p.v);var E=function(){var n=o[l],i=a[r];r++,i||((i=cc.instantiate(v.buttonItem)).on("click",function(){i.onClick&&i.onClick.call(this)},v),e.addChild(i),a.push(i)),i.active=!0,i.onClick=function(){var e;m.cacheChosen&&(m.cacheChosen.color=cc.color(255,255,255)),e=void 0===n.s?"":n.s,t.string=e,C.active&&(s.string=e),i.color=cc.color(200,255,200),m.cacheChosen=i,this.onEditEnded(t)},i.getChildByName("name").getComponent(cc.Label).string=n.n,n.s==d?(i.color=cc.color(200,255,200),m.cacheChosen=i):i.color=cc.color(255,255,255)};for(l=0;l<o.length;l++)E();o.length>30&&(h=(cc.winSize.height/2-10)/55,u=Math.ceil(o.length/h),e.width=105*u+10,n.width=105*u)}for(;r<a.length;r++)a[r].active=!1;e.getComponent(cc.Layout).updateLayout(),c.x>0&&(c.x-=e.width*m.scale),c.y<0&&(c.y+=e.height*m.scale+20),m.setPosition(c)}()},onEditEnded:function(t){var e=this.selectOne,n=t.string,i=t.define,a=t.cfgData;if(n=this.checkValue(a,i,n),t.string=kit.getValue(n,""),n!=kit.getValueInTable(a,i.v)){kit.setValueInTable(a,i.v,n),this.saveTempMap();var o=t.func;o&&o.call(this,e,n,t),cc.js.isString(n)?t.fontColor=cc.color(155,255,155):t.fontColor=cc.color(155,205,255)}},initEdit:function(t,e,n,i,a){t.string=kit.getValue(e,""),t.define=n,t.cfgData=i,t.func=a,cc.js.isString(e)?t.fontColor=cc.color(155,255,155):t.fontColor=cc.color(155,205,255),t.placeholder=n.placeholder||"\xb7\u672a\u5b9a\u4e49\xb7",n.len&&(t.maxLength=n.len)},checkValue:function(t,e,n){var i=kit.getValueInTable(t,e.v);if(e.lock)return i;if(""===n)return e.default||void 0;if("int"==e.t){if(n=Math.round(n),e.step){var a=e.min||0;n=Math.round((n-a)/e.step)*e.step+a}if(isNaN(n))return i}else if("num"==e.t){if(n=Math.round(1e4*n)/1e4,isNaN(n))return i}else if("mapCell"==e.t&&(n=Math.round(n/e.step)*e.step,isNaN(n)))return i;var o=e.max,c=e.min;return void 0===c&&void 0===o||(n=kit.clamp(n,kit.getValue(c,-1/0),kit.getValue(o,1/0))),n},getGroundData:function(t){return void 0===t&&(t=0),this.mapData.ground[t]||(this.mapData.ground[t]={i:t,list:[]}),this.mapData.ground[t]},onCreate:function(t,e,n){if(e=Math.floor(100*e)/100,n=Math.floor(100*n)/100,"brush"!=t.editType){if("ground"==t.editType){var i={x:e,y:n};return this.getGroundData(t.groundIndex).list.push(i),this.createGroundPoint(i,t.groundIndex),this.updateGroundPoint(t.groundIndex),void this.onCancel()}var a;if("event"==t.editType){if(t.cfgData)var o=kit.clone(t.cfgData);else o={cond:[],act:[]};o.x=e,o.y=n,this.mapData.event.push(o),a=this.createEvent(o)}else(o=t.cfgData?kit.clone(t.cfgData):{i:t.id,ai:1,t:0,team:1,flipX:1}).x=e,o.y=n,this.mapData.entity.push(o),a=this.createEntity(o);this.onShowUI(a),this.onCancel(),this.updateMapLink()}else{var c={i:t.id,x:e,y:n};if(this.mapData.scene.push(c),this.sceneNode){var s=this.effectMgr.createSprite(e,n,t.define);this.sceneNode.addChild(s),s.editType="brush",s.cfgData=c,this.canSelectList.push(s)}this.onCancel()}},onPrepareFadeIn:function(t){t.opacity=100,"event"==t.editType?t.getChildByName("bg").color=cc.color(255,0,0):"entity"==t.editType&&(t.animeNode.color=cc.color(255,0,0))},onPrepareFadeOut:function(t){t.opacity=255,"event"==t.editType?t.getChildByName("bg").color=cc.color(255,255,255):"entity"==t.editType&&(t.animeNode.color=cc.color(255,255,255))},updateEvent:function(t,e){var n=t.getChildByName("name");e.off&&(n.color=cc.color(205,100,100)),n.getComponent(cc.Label).string="\u4e8b\u4ef6"+(e.id?" - "+e.id:"");var i=t.getChildByName("label").getComponent(cc.Label),a="";for(var o in e.cond){var c=e.cond[o];0!=o&&(a+=","),a+=COND_DESCRIBE[c.type||0].func(c)}for(var o in a+="\u2192",e.act){var s=e.act[o];0!=o&&(a+=","),a+=ACT_DESCRIBE[s.type||0].func(s)}i.string=a},createEvent:function(t){var e=cc.instantiate(this.event);return this.mapNode.addChild(e,1001),e.active=!0,e.setPosition(t.x||0,t.y||0),e.cfgData=t,e.editType="event",this.updateEvent(e,t),this.canSelectList.push(e),e},createEntity:function(t){if(t.i){var e=ENTITY[t.i];if(e){var n=e.avatar,i=(n.auraScale||.6)*(n.s||1),a=cc.instantiate(this.unit);this.mapNode.addChild(a,10+500*kit.clamp(1-i,0,1)),a.setPosition(t.x||0,t.y||0),a.define=e,a.cfgData=t;var o=t.shader||n.shader,c=this.createAvatar(n,n.standAnime||"stand",0,o);a.addChild(c,-1),c.scale=n.s||1,-1===n.flipX?c.scaleX*=-1:c.scaleX*=1,c.angle=t.deg||0,this.effectMgr;var s=a.getChildByName("name");if(s.y=100*i,s.getComponent(cc.Label).string=e.name+(t.id?" - "+t.id:""),a.auraScale=i,a.avatar=c,this.updateAura(a),this.canSelectList.push(a),e.slots){var r=new cc.Node,d=r.addComponent(cc.Graphics);for(var l in a.addChild(r),d.lineWidth=3,e.slots){var h=e.slots[l];h.slot?d.strokeColor=cc.color(0,255,255):d.strokeColor=cc.color(0,255,0),d.rect(h.x-.5*h.w,h.y-.5*h.h,h.w,h.h),d.stroke()}}return a.editType="entity",a}}},updateAura:function(){},bindShader:function(t,e){this.effectMgr.bindShader(t,e)},createAvatar:function(t,e,n,i){var a=this,o=this.effectMgr,c=new cc.Node;if(t.anime){var s=o.createArmature(t.anime,t.animeName,function(i,o){a.loadArmature(t,o,e,n)});c.addChild(s),c.animeNode=s;var r=s.armatureDisplay}else if(t.animation){var d=o.createAnimation(t.animation,{speed:t.speed,repeat:-1});c.addChild(d),c.animeNode=d,d.setAnchorPoint(t.ax||.5,t.ay||.5),r=d.sprite}else if(t.frm){var l=o.createSprite(0,0,t.frm);c.addChild(l),c.animeNode=l,l.setAnchorPoint(t.ax||.5,t.ay||.5),r=l.sprite}i&&r&&this.bindShader(r,i);var h=t.base;if(h){var u=o.createSprite(0,0,h.res);c.addChild(u,-10),u.scale=h.s||1,u.setAnchorPoint(h.ax||.5,h.ay||.5),i&&this.bindShader(u.sprite,i),c.base=u}return c},loadArmature:function(t,e,n,i){void 0===i&&(i=0);var a=e.armature();if(a){a.animation.play(n||"stand",i);var o=t.skin;if(o)for(var c in o)a.getSlot(c).setDisplayByName(o[c])}},onCopy:function(){if(this.selectList&&this.selectList.length)var t=this.selectList;else this.selectOne&&(t=[this.selectOne]);if(t)for(var e in n=[],t)n.push({editType:t[e].editType,cfgData:t[e].cfgData,define:t[e].define,x:t[e].x,y:t[e].y,groundIndex:t[e].groundIndex});else n=null},onPaste:function(){if(n){var t=n[0].x,e=n[0].y;for(var i in n)this.onCreate(n[i],n[i].x-t+this.mouseX,n[i].y-e+this.mouseY);this.onSelect(),this.saveTempMap()}},onRemove:function(){var t=this.selectOne;if(t){if("brush"==t.editType)var e=this.mapData.scene;else e="event"==t.editType?this.mapData.event:"ground"==t.editType?this.getGroundData(t.groundIndex).list:this.mapData.entity;var n;(n=e.indexOf(t.cfgData))>=0&&(e.splice(n,1),this.saveTempMap()),(n=this.canSelectList.indexOf(t))>=0&&(this.onHideUI(),this.canSelectList.splice(n,1),t.destroy()),"brush"!==t.editType&&"ground"!==t.editType&&this.updateMapLink()}},onSwitchBoard:function(t,e){var n=this.mapBoards[e-1];this.preBoard!=n&&(this.preBoard.active=!1,this.preBoard=n),n.active=t.isChecked,n.active?this.skipSelect=n.skipSelect:this.skipSelect=null,this.updateMapGround()},initMobileCover:function(){var t=this.topCoverNode,e=this.coverNode,n=this.mapNode;t.on(cc.Node.EventType.TOUCH_START,function(){this.infoBoard.active=!1},this),t.on(cc.Node.EventType.TOUCH_END,function(t){if(this.unitDrag=!1,this.mapDrag=!1,this.unitDragChanged&&(this.saveTempMap(),this.unitDragChanged=!1),this.unitTouchDrag){this.unitTouchDrag=!1;var e=this.prepareOne,n=t.getLocation(),i=(n.x-.5*cc.winSize.width-this.mapNode.x)/this.mapScale,a=(n.y+100-.5*cc.winSize.height-this.mapNode.y)/this.mapScale;this.cancelButton.collideTest(n)||(this.onCreate(e,i,a),this.saveTempMap())}},this),t.on(cc.Node.EventType.TOUCH_MOVE,function(t){this.mapDrag&&(this.updateMapNode(n.x+t.getDeltaX(),n.y+t.getDeltaY()),t.stopPropagation());var e=this.unitDrag;if(e){var i=Math.floor(100*(e.x+t.getDeltaX()/this.mapScale))/100,a=Math.floor(100*(e.y+t.getDeltaY()/this.mapScale))/100;e.cfgData.x=i,e.cfgData.y=a,e.x=i,e.y=a,this.unitDragChanged=!0,this.updateUI(e),t.stopPropagation()}var o=this.prepareOne,c=t.getLocation();o&&(i=c.x-.5*cc.winSize.width,a=c.y+100-.5*cc.winSize.height,o.setPosition(i,a),this.cancelButton.collideTest(c)?this.onPrepareFadeIn(o):this.onPrepareFadeOut(o),t.stopPropagation())},this),t._touchListener.setSwallowTouches(!1),e.on(cc.Node.EventType.TOUCH_START,function(t){var e=this.prepareOne,i=t.getLocation(),a=(i.x-.5*cc.winSize.width-n.x)/this.mapScale,o=(i.y-.5*cc.winSize.height-n.y)/this.mapScale;if(e){if(this.cancelButton.collideTest(i))return;this.unitTouchDrag=!0}else this.onSelect(a,o)||(this.mapDrag=!0)},this)},onMoveOne:function(t,e,n){t&&(t.cfgData.x+=e,t.cfgData.y+=n,t.x+=e,t.y+=n,this.updateUI(t))},onMove:function(t,e){var n=this.selectList;if(n&&n.length)for(var i in n)this.onMoveOne(n[i],t,e);else this.onMoveOne(this.selectOne,t,e);this.moveCt?this.moveCt=this.moveCt+1:this.moveCt=1,this.moveCt>10&&(this.moveCt=0,this.saveTempMap())},onKeyUp:function(t){t.keyCode==cc.macro.KEY.ctrl&&(this.ctrlKey=!1)},onKeyDown:function(t){t.keyCode==cc.macro.KEY.escape?(this.onCancel(),this.onHideUI()):t.keyCode==cc.macro.KEY.Delete?this.onRemove():t.keyCode==cc.macro.KEY.ctrl?this.ctrlKey=!0:t.keyCode==cc.macro.KEY.up?this.onMove(0,1):t.keyCode==cc.macro.KEY.down?this.onMove(0,-1):t.keyCode==cc.macro.KEY.left?this.onMove(-1,0):t.keyCode==cc.macro.KEY.right&&this.onMove(1,0),this.ctrlKey&&(t.keyCode==cc.macro.KEY.z?this.restoreTempMap():t.keyCode==cc.macro.KEY.c?this.onCopy():t.keyCode==cc.macro.KEY.v?this.onPaste():t.keyCode==cc.macro.KEY.s&&this.onSaveMap())},initDesktopCover:function(){var t=this.topCoverNode,e=this.coverNode,n=this.mapNode;t.on(cc.Node.EventType.MOUSE_WHEEL,function(t){var e=t.getScrollY(),i=t.getLocation(),a=i.x-.5*cc.winSize.width,o=i.y-.5*cc.winSize.height,c=kit.clamp(this.mapScale+3e-4*e,.2,2);this.updateMapNode(a-(a-n.x)*c/this.mapScale,o-(o-n.y)*c/this.mapScale,c);var s=this.prepareOne;s&&(s.scale=s.scale0*this.mapScale),t.stopPropagation()},this),t.on(cc.Node.EventType.MOUSE_DOWN,function(t){this.infoBoard.active=!1,t.getButton()===cc.Event.EventMouse.BUTTON_RIGHT&&(this.mapDrag=!0,t.stopPropagation())},this),t.on(cc.Node.EventType.MOUSE_UP,function(t){if(t.getButton()===cc.Event.EventMouse.BUTTON_RIGHT)this.mapDrag=!1,t.stopPropagation();else if(t.getButton()===cc.Event.EventMouse.BUTTON_LEFT){if(this.unitDragChanged){var e=this.unitDrag;e&&e.selectEffect.setPosition(e.x,e.y),this.saveTempMap(),this.unitDragChanged=!1}this.unitDrag=!1,this.mapDrag=!1}},this),t.on(cc.Node.EventType.MOUSE_MOVE,function(t){this.mapDrag&&(this.updateMapNode(n.x+t.getDeltaX(),n.y+t.getDeltaY()),t.stopPropagation());var e=this.unitDrag;if(e){var i=Math.floor(100*(e.x+t.getDeltaX()/this.mapScale))/100,a=Math.floor(100*(e.y+t.getDeltaY()/this.mapScale))/100;e.cfgData.x=i,e.cfgData.y=a,e.x=i,e.y=a,this.unitDragChanged=!0,this.updateUI(e),t.stopPropagation()}var o=this.prepareOne,c=t.getLocation();o&&(i=c.x-.5*cc.winSize.width,a=c.y-.5*cc.winSize.height,o.setPosition(i,a),this.cancelButton.collideTest(c)?this.onPrepareFadeIn(o):this.onPrepareFadeOut(o),t.stopPropagation()),i=(c.x-.5*cc.winSize.width-n.x)/this.mapScale,a=(c.y-.5*cc.winSize.height-n.y)/this.mapScale,this.mouseX=Math.floor(100*i)/100,this.mouseY=Math.floor(100*a)/100,this.posLabel.string="("+Math.round(i)+","+Math.round(a)+")"},this),e.on(cc.Node.EventType.MOUSE_DOWN,function(t){if(t.getButton()==cc.Event.EventMouse.BUTTON_LEFT){var e=t.getLocation(),i=(e.x-.5*cc.winSize.width-n.x)/this.mapScale,a=(e.y-.5*cc.winSize.height-n.y)/this.mapScale,o=this.prepareOne;o?this.cancelButton.collideTest(e)||(this.onCreate(o,i,a),this.saveTempMap()):this.onSelect(i,a)||(this.mapDrag=!0,this.unitDrag=null)}},this)},onSaveMap:function(){this.saveMap()},onDownloadMap:function(){var t=this,e=this.netName.string;e?(e=e.replace(".","_"),editor.post("readMap",{game:"bastion",file:e},function(n,i){if(cc.log(n,i),n){var a="";return 1003==n?a=", missing file name":1004==n&&(a=", file read failed"),void kit.info("Map ["+e+"] download failed"+a)}i.netName=e,kit.info("Map ["+e+"] download complete",function(){t.saveTempMap(),t.resetMap(i)})})):kit.info("Please enter map name")},onUploadMap:function(){var t=this.netName.string;t?(t=t.replace(".","_"),this.mapData.netName=t,editor.post("writeMap",{game:"bastion",file:t,json:this.mapData},function(e,n){if(e){var i="";return 1001==e?i=", missing file name or file data":1002==e&&(i=", file write failed"),void kit.info("Map ["+t+"] upload failed"+i)}kit.info("Map ["+t+"] upload complete"),cc.log(n)})):kit.info("Please enter map name")},onQuit:function(){menuManager.back()},onOption:function(){menuManager.pop(this.debugMenuPrefab)},onBackpackTest:function(){var t=cc.sys.localStorage.getItem("test_backpack"),e=t&&JSON.parse(t);cc.log("onBackpackTest",e),menuManager.run("backpack",{backpack:e,editMode:1})},onHelp:function(){menuManager.pop("notice",{title:"\u8bf4\u660e",btn:"\u597d\u7684",info:"<size=20><b>\u9f20\u6807\u53f3\u952e</b>\uff1a\u79fb\u52a8\u5730\u56fe\uff1b<b>\u6eda\u8f6e</b>\uff1a\u7f29\u653e\u5730\u56fe\u3002\n<b>ctrl+z</b>\uff1a\u56de\u5230\u4e0a\u4e00\u6b65\u3002\n<b>ctrl+c</b>\uff1a\u590d\u5236\uff1b <b>ctrl+v</b>\uff1a\u7c98\u8d34\u3002\n<b>del</b>:\u5220\u9664\u9009\u4e2d\uff1b<b>esc</b>\uff1a\u53d6\u6d88\u9009\u4e2d\u3002</size>"})},onMapTest:function(){var t=this;if(!this.testing){this.testing=!0,this.editUI.active=!1,this.eventUI.active=!1,this.centerUI.active=!1,this.mapNode.active=!1,this.coverNode.active=!1;var e=this.gameLayer.getComponent("GameLayer");try{for(var n in e.init(),chapter.reset(),chapter.data.stack=4,chapter.data.combatItem)chapter.data.combatItem[n]=10;var a=new i;this.game=a;var o=editor.getRemote(),c=+cc.sys.localStorage.getItem("test_auto");cc.log("remotes",o);var s={pvp:0,auto:c?2:1,seed:kit.rndInt(0,99999),remotes:o,name:"\u6d4b\u8bd5",chapter:"0/0",mapData:this.mapData,boxDropFunc:function(){return{id:"machine_gun",lvl:1}},effectMgr:this.effectMgr,drops:[{id:"a",lvl:1},{id:"cannon",lvl:1},{id:"a",lvl:1}],reviveFunc:function(t,e){menuManager.pop("revive",{noWait:!0,noBlock:!0,game:t,closeCb:function(t){e(t)}})},restartFunc:function(){t.onExitMapTest(),t.onMapTest()},pauseFunc:function(){t.onExitMapTest()}};a.editMode=1;var r={},d=this.mapData.entity;for(var l in d){var h=d[l];this.effectMgr.initEntityRes(r,h,o)}this.effectMgr.loadAllRes(r,function(){a.init(s,e),a.onEnter(),a.setSpeed(DEBUG_GAME_SPEED)})}catch(u){kit.error(u),this.onExitMapTest()}}},onExitMapTest:function(){if(this.testing){this.testing=!1,this.editUI.active=!0,this.eventUI.active=!0,this.centerUI.active=!0,this.mapNode.active=!0,this.coverNode.active=!0;var t=this.gameLayer.getComponent("GameLayer");this.game.onExit(),t.clear(),delete this.game,menuManager.playBgm()}}}),cc._RF.pop()},{"../../script/entities/environment/GroundAvatar":void 0,"../../script/managers/EffectManager":void 0,"../../script/managers/GameSystem":void 0,"../../script/scripts/Theme":void 0,"../../script/scripts/VirtualLayer":void 0,"../../script/ui/core/Menu":void 0}],TestMenu:[function(t,e){"use strict";cc._RF.push(e,"01a88nbACpJQIWN9FioRuhA","TestMenu");var n=t("../../script/scripts/quickMatch");cc.Class({extends:t("../../script/ui/core/Menu"),properties:{noTopBar:!0,mapEditBox:cc.EditBox,lvlEditBox:cc.EditBox,abTestEditBox:cc.EditBox,debugMenuPrefab:cc.Prefab,versionLabel:cc.Label,avatarNode:cc.Node,mainScene:""},onLoad:function(){this.mainScene&&(menuManager.mainScene=this.mainScene,window.BGM_VOLUME=1,window.SE_VOLUME=1,window.VIBRATE=1),cc.debug.setDisplayStats(!1)},initStatus:function(){if(this.mapEditBox&&(this.mapEditBox.string=cc.sys.localStorage.getItem("editor_map")||"test1"),this.lvlEditBox&&(this.lvlEditBox.string=cc.sys.localStorage.getItem("editor_stage")||"1"),this.versionLabel){var t=new Date(BUILD_TIME);this.versionLabel.string="v "+MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION+"-"+CODE_VERSION+"("+t.toLocaleString()+")"}if(this.avatarNode){var e=this.avatarNode.getChildByName("vehicle_model").getComponent("VehicleModel");e.init(ENTITY.v1,{driver:1,team:["h1","h2","h3","h4"]}),e.play("walk")}menuManager.setDefault()},start:function(){},callPopMenu:function(t,e){menuManager.pop(e)},callRunMenu:function(t,e){menuManager.runReal(e)},onSetting:function(){menuManager.pop(this.debugMenuPrefab)},onQuickGame:function(){},onQuickMatch:function(){},testRemoteMap:function(t){cc.log("testRemoteMap",t),map.load("map/"+t,function(t,e){if(t)kit.info("Map not found.");else{var n=editor.getRemote(),i=+cc.sys.localStorage.getItem("test_auto");loadGame({me:1,auto:i?2:1,remotes:n,mapData:e,boxDropFunc:function(){return{id:"machine_gun",lvl:1}},finishFunc:function(){},pauseFunc:function(t){t.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(e){t.popTimeScale(0),e&&menuManager.runReal("editor/test",{},!0)}})}})}})},onTestMap:function(t,e){this.testRemoteMap(e)},onTestInput:function(){this.testRemoteMap(this.mapEditBox.string),cc.sys.localStorage.setItem("editor_map",this.mapEditBox.string)},onAdventureRun:function(t,e){adventure.start(+e-1)},onDestroy:function(){n.exit()},onReset:function(){menuManager.pop("check",{title:"Delete saved data",info:"Are you sure you want to delete the save?",noWait:!0,checkCb:function(t){t&&net.post("resetData",{uid:user.getUID()},function(t,e){cc.log(t,e),t||(privacy.remove("chapter_data"),menuManager.pop("info",{title:"Delete Save",info:"Save deleted successfully. Restarting shortly.",closeCb:function(){cc.log("Save deleted. Restarting..."),user.logout()}}))})}})},onJumpLevel:function(){var t=+this.lvlEditBox.string;t<0||isNaN(t)||(cc.sys.localStorage.setItem("editor_stage",t),net.post("updateData",{set:{stageIndex:t}},function(e,n){cc.log(e,n),e||(pc.stageIndex=t,kit.info("Level Transition: "+t,function(){menuManager.refresh()}))}))},onABTestSet:function(){var t=+this.abTestEditBox.string;t<0||isNaN(t)||net.postSilent("updateData",{set:{abTestIndex:t}},function(t,e){t||(user.abTestIndex=e.doc.abTestIndex||0,kit.info("AB test version is:"+GetABTestStr(),function(){user.logout()}))})},onUpgrade:function(){var t,e,n=((t={})[GOLD]=9999999,t[EXP]=99999,t[TALENT]=999,t[DIAMOND]=9999,t[ENERGY]=30,t[KEY_L]=99,t[KEY_M]=99,t[BLUEPRINT_ATK]=999,t[BLUEPRINT_HP]=999,t[BLUEPRINT_SKILL]=999,t[SWEEP_TICKET]=9999,t[HERO_REFRESH_TICKET]=9999,t[RECRUIT_TICKET]=9999,t[EXP_PROGRESSION_TRACK]=9999,t);for(var i in SHARD_LIST)n[SHARD+"."+SHARD_LIST[i]]=999;var a={};for(var o in EquipmentDefine)a[o]={lvl:10,exp:9999},n[EQUIPMENT+".lvl_+"+o]=1,n[EQUIPMENT+"."+o]=9999,n[EQUIPMENT+".slotCt"]=8;equipment.set("items",a),equipment.set("slotCt",8),equipment.save();var c=[];excel.read("hero_list"),c.length>0&&(e=c),cc.log("TestMenu set",n),net.updateData({set:n,heroes:e},function(t,n){for(var i in e)pc.setHero(e[i]);money.update(n),kit.info("Can spending money make you stronger? Yes, it can!",function(){menuManager.refresh()})})},onNextDay:function(){var t=sdk.now()+864e5;user.signCount<6?net.updateData({add:{signCount:1},set:{signRefreshDate:t}},function(t,e){if(e.doc){var n=e.doc;user.signCount=n.signCount,kit.info("user.signIndex : "+user.signIndex+" user.signCount "+user.signCount),user.updateSignData(user.signIndex,n.signCount,n.signRefreshDate)}}):(user.resetSignRewardData(),kit.info("Reset Sign "))},onChangeLocal:function(t){var e=local.lanList,n=e.indexOf(LAN)+1;n>=e.length&&(n=0),LAN=e[n],local.init(),t.target.getChildByName("label").getComponent(cc.Label).string=LI("lan")},onShowRecord:function(){},onUploadRecord:function(){},onDownloadRecord:function(){},onTestBackpack:function(){menuManager.run("backpack")}}),cc._RF.pop()},{"../../script/scripts/quickMatch":void 0,"../../script/ui/core/Menu":void 0}],editor:[function(t,e){"use strict";cc._RF.push(e,"ae50dlYjcFMI4VsKNYC8883","editor"),t("../../script/scripts/define"),t("../../script/scripts/shaderDefine"),t("../../script/scripts/levelDefine"),window.SORT_LIST=null,window.getSortList=function(){if(SORT_LIST)return SORT_LIST;for(var t in SORT_LIST=["bonus","stage","prisoner_haoren","prisoner_xiaoxiong","prisoner_qishou","prisoner_degun","structure","rocket_bomb","vine","fort1"],ENTITY){var e=ENTITY[t];e.id&&e.editor&&(SORT_LIST.includes(e.id)?cc.error("SORT_LIST id exists",e.id):SORT_LIST.push(e.id))}return SORT_LIST},window.COND_LIST=[COND.MSG,COND.TIMER,COND.DISTANCE,COND.POS,COND.DEED,COND.STATUS,COND.RANDOM],window.ACT_LIST=[ACT.MSG,ACT.CREATE,ACT.REMOVE,ACT.CAMERA,ACT.AI,ACT.STATUS,ACT.SWITCH,ACT.AVATAR,ACT.QUEST,ACT.EFFECT,ACT.DELAY,ACT.CHOSE];var n=["\u7f16\u53f7","\u7c7b\u578b","\u961f\u4f0d","\u73a9\u5bb6"],i=[{n:"\u7f16\u53f7",s:0},{n:"\u7c7b\u578b",s:1},{n:"\u961f\u4f0d",s:2},{n:"\u73a9\u5bb6",s:3},{n:"\u5168\u90e8",s:9}],a={n:"\u6807\u8bc6\u7c7b\u578b",v:"t",info:"0:\u7f16\u53f7/1:\u7c7b\u578b/2:\u961f\u4f0d/3:\u73a9\u5bb6/9:\u5168\u5730\u56fe\u5355\u4f4d",t:"int",min:0,max:9,placeholder:"\u7f16\u53f7",list:i},o=function(t){return t.t==INDEX_TYPE.ALL?"\u4efb\u610f\u5355\u4f4d":t.t==INDEX_TYPE.ME?"\u73a9\u5bb6\u7684\u5355\u4f4d":t.t==INDEX_TYPE.ID&&t.i&&ENTITY[t.i]?ENTITY[t.i].name:n[t.t||0]+t.i+"\u7684\u5355\u4f4d"},c=[{n:"\u6211\u65b90",s:0},{n:"\u654c\u65b91",s:1}],s={n:"\u5355\u4f4d\u6807\u8bc6",v:"i",info:"\u5355\u4f4d\u6807\u8bc6",listFunc:function(t){if(1==t.t){var e=[],n=getSortList();for(var i in n){var a=n[i],o=ENTITY[a];o&&e.push({n:o.name+"\n"+a,s:a})}return e}if(2==t.t)return c;if(3==t.t);else if(9!=t.t)return this.entityList}},r=[],d=[];for(var l in ENTITY_VALUE){var h=ENTITY_VALUE[l];h.get&&d.push({n:h.n+"\n"+l,s:l}),h.set&&r.push({n:h.n+"\n"+l,s:l})}var u=function(t){this.updateEventArea(t)},v={n:"\u5de6",v:"1",t:"num",info:"\u5de6\u8fb9\u754c,\u4e0d\u586b\u5219\u4e0d\u68c0\u6d4b\u8fd9\u4e2a\u8fb9",func:u},p={n:"\u53f3",v:"2",t:"num",info:"\u53f3\u8fb9\u754c,\u4e0d\u586b\u5219\u4e0d\u68c0\u6d4b\u8fd9\u4e2a\u8fb9",func:u},f={n:"\u4e0a",v:"3",t:"num",info:"\u4e0a\u8fb9\u754c,\u4e0d\u586b\u5219\u4e0d\u68c0\u6d4b\u8fd9\u4e2a\u8fb9",func:u},m={n:"\u4e0b",v:"4",t:"num",info:"\u4e0b\u8fb9\u754c,\u4e0d\u586b\u5219\u4e0d\u68c0\u6d4b\u8fd9\u4e2a\u8fb9",func:u},g=[{n:"\u5173\u95ed"}];for(var l in TIMER_QUEST_STR)g.push({n:TIMER_QUEST_STR[l],s:l});window.COND_DESCRIBE={},COND_DESCRIBE[COND.TIMER]={n:"\u65f6\u95f4",info:"",i:COND.TIMER,quest:1,func:function(t){return t.t+"\u79d2\u540e"},v:[{n:"\u7b49\u5f85\u65f6\u95f4",v:"t",info:"t\u79d2\u540e\u89e6\u53d1",t:"num",min:0},{n:"\u4efb\u52a1\u76ee\u6807",v:"q",min:0,max:g.length,list:g,info:"0:\u9690\u85cf/n:\u663e\u793a\u4efb\u52a1\u76ee\u6807\n\u9ed8\u8ba4\u503c\u4e3a0"}]},COND_DESCRIBE[COND.DISTANCE]={n:"\u8ddd\u79bb",info:"",i:COND.DISTANCE,quest:1,func:function(t){return"\u5377\u5c4f"+t.d+"\u50cf\u7d20\u540e"},v:[{n:"\u62b5\u8fbe\u8ddd\u79bb",v:"d",info:"d\u50cf\u7d20\u540e\u89e6\u53d1",t:"num",min:0},{n:"\u4efb\u52a1\u76ee\u6807",v:"q",min:0,max:g.length,list:g,info:"0:\u9690\u85cf/n:\u663e\u793a\u4efb\u52a1\u76ee\u6807\n\u9ed8\u8ba4\u503c\u4e3a0"}]};var C=[{n:"\u5173\u95ed"}];for(var l in POS_QUEST_STR)C.push({n:POS_QUEST_STR[l],s:l});var E=["\u5185","\u5916"];COND_DESCRIBE[COND.POS]={n:"\u4f4d\u7f6e",info:"",i:COND.POS,area:1,func:function(t){return o(t)+(t.c?t.c+"\u4e2a":"")+"\u5728\u533a\u57df"+E[t.b||0]},v:[a,s,{n:"\u8ba1\u6570\u6a21\u5f0f",v:"cb",info:"\u591a\u4e8e0/\u5c11\u4e8e1/\u5b8c\u5168\u4e00\u81f42\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:2,placeholder:"\u591a\u4e8e",list:[{n:"\u591a\u4e8e",s:0},{n:"\u5c11\u4e8e",s:1},{n:"\u7b49\u4e8e",s:2}]},{n:"\u8ba1\u6570",v:"c",info:"\u8fbe\u6210\u72b6\u6001\u7684\u5355\u4f4d\u6570\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,placeholder:"0"},{n:"\u5185/\u5916",v:"b",t:"num",min:0,max:1,list:[{n:"\u5185",s:0},{n:"\u5916",s:1}],placeholder:"\u533a\u57df\u5185",info:"0:\u533a\u57df\u5185/1:\u533a\u57df\u5916\n\u9ed8\u8ba4\u503c\u4e3a0"},v,p,f,m,{n:"\u4efb\u52a1\u76ee\u6807",v:"q",min:0,max:C.length,list:C,info:"0:\u9690\u85cf/n:\u663e\u793a\u4efb\u52a1\u76ee\u6807\n\u9ed8\u8ba4\u503c\u4e3a0"}]};var T=[{n:"\u5173\u95ed"}];for(var l in DEED_QUEST_STR)T.push({n:DEED_QUEST_STR[l],s:l});E=["\u5185","\u5916"];var y={0:"\u6b7b\u4ea1",10:"\u5f00\u706b",11:"\u8df3\u8dc3"};COND_DESCRIBE[COND.DEED]={n:"\u884c\u4e3a",info:"",i:COND.DEED,func:function(t){return o(t)+y[t.d||0]+(t.ct?t.ct+"\u6b21":"")+"\u65f6"},v:[a,s,{n:"\u884c\u4e3a",v:"d",info:"0\u6b7b\u4ea1,\u9ed8\u8ba4\u4e3a0 (\u53ef\u6269\u5c55\u5230\u590d\u6d3b,\u6280\u80fd,\u53d7\u4f24\u7b49)",t:"int",min:0,placeholder:"\u6b7b\u4ea1",list:[{n:"\u6b7b\u4ea1",s:0},{n:"\u653b\u51fb",s:10},{n:"\u8df3\u8dc3",s:11}]},{n:"\u8ba1\u6570\u5668",v:"ct",info:"\u884c\u4e3a\u8ba1\u6570",t:"int",min:0},{n:"\u4efb\u52a1\u76ee\u6807",v:"q",min:0,max:T.length,list:T,info:"0:\u9690\u85cf/n:\u663e\u793a\u4efb\u52a1\u76ee\u6807\n\u9ed8\u8ba4\u503c\u4e3a0"}]};var S=[{n:"\u5173\u95ed"}];for(var l in STATUS_QUEST_STR)S.push({n:STATUS_QUEST_STR[l],s:l});var I=["\u5c0f\u4e8e","\u5927\u4e8e","\u7b49\u4e8e"],N=["\u591a\u4e8e","\u5c11\u4e8e","\u7b49\u4e8e"];COND_DESCRIBE[COND.STATUS]={n:"\u72b6\u6001",info:"",i:COND.STATUS,func:function(t){return t.n?o(t)+t.n+I[t.b||0]+(t.v||0)+"\u7684\u8ba1\u6570"+N[t.cb||0]+(t.c||0)+"\u65f6":o(t)+N[t.cb||0]+(t.c||0)+"\u65f6"},v:[a,s,{n:"\u8ba1\u6570\u6a21\u5f0f",v:"cb",info:"\u591a\u4e8e0/\u5c11\u4e8e1/\u5b8c\u5168\u4e00\u81f42\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:2,placeholder:"\u591a\u4e8e",list:[{n:"\u591a\u4e8e",s:0},{n:"\u5c11\u4e8e",s:1},{n:"\u7b49\u4e8e",s:2}]},{n:"\u8ba1\u6570",v:"c",info:"\u8fbe\u6210\u72b6\u6001\u7684\u5355\u4f4d\u6570\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,placeholder:"0"},{n:"\u5c5e\u6027\u540d",v:"n",list:d,info:"\u53ef\u8bfb\u53d6\u7684\u5c5e\u6027"},{n:"\u6bd4\u8f83\u7b26",v:"b",info:"\u5c0f\u4e8e0/\u5927\u4e8e1/\u7b49\u4e8e2\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:2,placeholder:"\u5c0f\u4e8e",list:[{n:"\u5c0f\u4e8e",s:0},{n:"\u5927\u4e8e",s:1},{n:"\u7b49\u4e8e",s:2}]},{n:"\u6570\u503c",v:"v",t:"num",info:"\u6570\u503c"},{n:"\u4efb\u52a1\u76ee\u6807",v:"q",min:0,max:S.length,list:S,info:"0:\u9690\u85cf/n:\u663e\u793a\u4efb\u52a1\u76ee\u6807\n\u9ed8\u8ba4\u503c\u4e3a0"}]};var D=[];for(var l in ACT_EVENT){var B=ACT_EVENT[l];D.push({n:B.n||l,s:l})}COND_DESCRIBE[COND.MSG]={n:"\u6d88\u606f",info:"",i:COND.MSG,func:function(t){return"\u76d1\u542c\u5230"+t.n+"\u7684\u6d88\u606f"+(t.ct?t.ct+"\u6b21":"")+"\u65f6"},v:[{n:"\u6d88\u606f\u540d",v:"n",list:D,info:"\u7b49\u5f85\u4e00\u4e2a\u6d88\u606f"},{n:"\u8ba1\u6570",v:"ct",info:"\u63a5\u6536\u6d88\u606f\u7684\u6b21\u6570\n\u9ed8\u8ba4\u503c\u4e3a1",t:"int",min:1,placeholder:"1"}]},COND_DESCRIBE[COND.RANDOM]={n:"\u63b7\u9ab0",info:"",i:COND.RANDOM,func:function(t){return(t.t?"\u95f4\u9694"+t.t+"\u79d2":"")+(t.n<0?"\u65e0\u7a77":t.n||1)+"\u6b21\u63b7\u9ab0\u6982\u7387"+t.r+"\u6210\u529f\u65f6"},v:[{n:"\u6982\u7387",v:"r",t:"num",min:0,max:1,info:"0\u52301\u7684\u6982\u7387\u503c,\u8d8a\u5927\u6210\u529f\u7387\u8d8a\u9ad8"},{n:"\u95f4\u9694",v:"t",info:"\u63b7\u9ab0\u95f4\u9694\n\u9ed8\u8ba4\u503c\u4e3a0",t:"num",min:0,placeholder:"0"},{n:"\u6b21\u6570",v:"n",info:"\u63b7\u9ab0\u6b21\u6570,\u8d1f\u503c\u4e3a\u65e0\u9650\u6b21\u6570\n\u9ed8\u8ba4\u503c\u4e3a1",t:"int",min:-1,placeholder:"1"}]},COND_DESCRIBE[COND.EVENT]={n:"\u4e8b\u4ef6",info:"",i:COND.EVENT,func:function(t){return"\u4e8b\u4ef6"+t.e+(t.n?"\u6267\u884c"+t.n+"\u6b21":"\u672a\u88ab\u6267\u884c")+"\u65f6"},v:[{n:"\u4e8b\u4ef6\u7f16\u53f7",v:"e",info:"\u4e8b\u4ef6\u7f16\u53f7",listFunc:function(){return this.eventList}},{n:"\u4e8b\u4ef6\u6b21\u6570",v:"n",info:"\u4e8b\u4ef6\u6267\u884c\u6b21\u6570\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0}]},window.ACT_DESCRIBE={},ACT_DESCRIBE[ACT.CREATE]={n:"\u751f\u6210",info:"",i:ACT.CREATE,func:function(t){return"\u751f\u6210\u7f16\u53f7"+t.id+"\u7684\u5355\u4f4d"},v:[{n:"\u5355\u4f4d\u7f16\u53f7",v:"id",info:"\u751f\u6210\u5355\u4f4dby index",listFunc:function(){return this.entityList}},{n:"x",v:"x",info:"x",t:"num"},{n:"y",v:"y",info:"y",t:"num"},{n:"x\u7c7b\u578b",v:"rx",info:"0:\u5168\u5c40\u5750\u6807/1:\u76f8\u5bf9\u5750\u6807\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:1,list:[{n:"\u5168\u5c40"},{n:"\u76f8\u5bf9",s:1}]},{n:"y\u7c7b\u578b",v:"ry",info:"0:\u5168\u5c40\u5750\u6807/1:\u76f8\u5bf9\u5750\u6807\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:1,list:[{n:"\u5168\u5c40"},{n:"\u76f8\u5bf9",s:1}]},a,s]};var _=["\u6740\u6b7b","\u79fb\u9664"];ACT_DESCRIBE[ACT.REMOVE]={n:"\u79fb\u9664",info:"",i:ACT.REMOVE,func:function(t){return _[t.k||0]+o(t)},v:[a,s,{n:"\u79fb\u9664\u6a21\u5f0f",v:"k",info:"0:\u6740\u6b7b/1:\u9759\u9759\u79fb\u9664\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:1,placeholder:"\u6740\u6b7b",list:[{n:"\u6740\u6b7b",s:0},{n:"\u79fb\u9664",s:1}]}]};var b=["\u8ddf\u968f","\u9501\u5b9a","\u89e3\u9501"];ACT_DESCRIBE[ACT.CAMERA]={n:"\u955c\u5934",info:"",i:ACT.CAMERA,func:function(t){return t.l?"\u955c\u5934"+b[t.l]:"\u955c\u5934"+b[0]+o(t)},v:[a,s,{n:"\u64cd\u4f5c",v:"l",info:"0:\u8ddf\u968f/1:\u9501\u5b9a/2:\u89e3\u9501\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:2,list:[{n:"\u8ddf\u968f",s:0},{n:"\u9501\u5b9a",s:1},{n:"\u89e3\u9501",s:2}]},{n:"x",v:"x",info:"\u955c\u5934x\u4f4d\u7f6e,\u9501\u5b9a\u6a21\u5f0f\u4f7f\u7528",t:"num"},{n:"y",v:"y",info:"\u955c\u5934y\u4f4d\u7f6e,\u9501\u5b9a\u6a21\u5f0f\u4f7f\u7528",t:"num"},{n:"s",v:"s",info:"\u955c\u5934\u7f29\u653e",t:"num",min:.1,max:10},{n:"dt",v:"dt",info:"\u955c\u5934\u8f6c\u6362\u7528\u65f6",t:"num"}]};var M=["\u542f\u7528","\u5173\u95ed","\u5207\u6362"];ACT_DESCRIBE[ACT.SWITCH]={n:"\u4e8b\u4ef6",info:"",i:ACT.SWITCH,func:function(t){return M[t.s||0]+"\u4e8b\u4ef6"+t.e+(t.r?"\u5e76\u6267\u884c\u4e8b\u4ef6":"")},v:[{n:"\u4e8b\u4ef6\u7f16\u53f7",v:"e",info:"\u4e8b\u4ef6\u7f16\u53f7",listFunc:function(){return this.eventList}},{n:"\u5f00\u5173",v:"s",info:"0:\u542f\u7528/1:\u5173\u95ed/2:\u5207\u6362\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:2,placeholder:"\u542f\u7528",list:[{n:"\u542f\u7528",s:0},{n:"\u5173\u95ed",s:1},{n:"\u5207\u6362",s:2}]},{n:"\u64cd\u4f5c",v:"r",info:"1:\u6267\u884c\n\u9ed8\u8ba4\u503c\u4e3a0,\u65e0\u89c6\u6761\u4ef6\u5f3a\u5236\u6267\u884c\u4e8b\u4ef6",t:"int",min:0,max:1,list:[{n:"\u65e0\u64cd\u4f5c"},{n:"\u6267\u884c",s:1}]}]};var x=["\u4e3a","\u52a0"];ACT_DESCRIBE[ACT.STATUS]={n:"\u5c5e\u6027",info:"",i:ACT.STATUS,func:function(t){return"\u4fee\u6539"+o(t)+"\u7684"+t.n+x[t.o||0]+t.v},v:[a,s,{n:"\u5c5e\u6027\u540d",v:"n",info:"\u53ef\u4fee\u6539\u7684\u5c5e\u6027",list:r},{n:"\u6570\u503c",v:"v",t:"num",info:"\u6570\u503c",listFunc:function(t){if(cc.log(t.n,ENTITY_VALUE[t.n]),ENTITY_VALUE[t.n])return ENTITY_VALUE[t.n].list}},{n:"\u64cd\u4f5c",v:"o",info:"0:\u8d4b\u503c/1:\u589e\u51cf\n\u9ed8\u8ba4\u503c\u4e3a0",t:"int",min:0,max:1,placeholder:"\u8d4b\u503c",list:[{n:"\u8d4b\u503c",s:0},{n:"\u589e\u51cf",s:1}]}]},ACT_DESCRIBE[ACT.AI]={n:"AI",info:"",i:ACT.AI,func:function(t){return"\u4fee\u6539"+o(t)+"\u7684ai\u53c2\u6570"},v:[a,s,{n:"ai\u53c2\u6570",v:"aiCfg",info:"",text:1,len:200,list:[{n:"\u58eb\u5175",s:'{ctor:"AISoldier",attackRange:450,safeRange:[200,400],}'},{n:"\u51b2\u950b",s:'{ctor:"AICommon",vx:-4,ax:1,at:3}'},{n:"\u7ad9\u7acb",s:'{ctor:"AICommon",vx:0,ax:0,at:0}'},{n:"\u98de\u8fc7",s:'{ctor:"AIFlySoldier"}'},{n:"\u505c\u98de",s:'{ctor:"AIFlySoldierWander"}'},{n:"\u7535\u68af",s:'{ctor:"AIElevator",moveX:0,moveY:-1,moveTime:3,delayTime:6}'},{n:"\u8718\u86db",s:'{ctor:"AISpider",attackRange: [400,500],safeRange:[200,400],seekRange:1000,activateRange:500}'},{n:"\u8ffd\u8f66",s:'{ctor:"AIChaseCar"}'},{n:"\u4f11\u606f",s:'{ctor:"AIIdle"}'}]}]},ACT_DESCRIBE[ACT.MSG]={n:"\u6d88\u606f",info:"",i:ACT.MSG,func:function(t){return"\u53d1\u9001"+t.n+"\u6d88\u606f"},v:[{n:"\u6d88\u606f\u540d",v:"n",list:D,info:"\u53d1\u9001\u4e00\u4e2a\u6d88\u606f"},{n:"\u6d88\u606f\u53c2\u6570",v:"s",info:"\u53d1\u9001\u4e00\u4e2a\u6d88\u606f"}]},ACT_DESCRIBE[ACT.DELAY]={n:"\u5ef6\u8fdf",info:"",i:ACT.DELAY,virtual:1,func:function(t){return(t.t||0)+"\u79d2"},v:[{n:"\u5ef6\u8fdf\u65f6\u95f4",v:"t",info:"t\u79d2\u89e6\u53d1",t:"num",min:0}]};var w=[];for(var l in ACT_EFFECT){var A=ACT_EFFECT[l];w.push({n:A.n||l,s:l})}ACT_DESCRIBE[ACT.EFFECT]={n:"\u7279\u6548",info:"",i:ACT.EFFECT,func:function(t){return"\u91ca\u653e\u7279\u6548"+t.e},v:[{n:"\u7279\u6548\u540d",v:"e",info:"\u7279\u6548\u540d",list:w,initFunc:function(t,e,n,i){for(var a=1;a<7;a++)i[a].active=!1;var o=ACT_EFFECT[e];o&&(o.pos&&(i[1].active=!0,i[2].active=!0),o.scale&&(i[3].active=!0),o.args&&(i[4].active=!0),o.avatar&&(i[5].active=!0,i[6].active=!0))}},{n:"x",v:"x",info:"x",t:"num"},{n:"y",v:"y",info:"y",t:"num"},{n:"s",v:"s",info:"s",t:"num"},{n:"\u989d\u5916\u53c2\u6570",v:"args",info:"\u989d\u5916\u53c2\u6570",text:1,len:100},a,s]};var L={0:"\u79fb\u52a8",10:"\u79fb\u52a8\u5230",9:"\u653b\u51fb",1:"\u6280\u80fd1",2:"\u6280\u80fd2",3:"\u6280\u80fd3"};ACT_DESCRIBE[ACT.CTRL]={n:"\u64cd\u4f5c",info:"",i:ACT.CTRL,func:function(t){return"\u64cd\u4f5c"+o(t)+L[t.b]},v:[a,s,{n:"\u6309\u952e",v:"b",info:"\u79fb\u52a80/\u653b\u51fb9/\u79fb\u52a8\u523010/\u6280\u80fd1-3",t:"int",min:0,max:10,initFunc:function(t,e,n,i){for(var a=3;a<9;a++)i[a].active=!1;e&&9!=e?e<4?(i[3].active=!0,i[4].active=!0,i[7].active=!0,i[8].active=!0):10==e&&(i[5].active=!0,i[6].active=!0):(i[3].active=!0,i[4].active=!0)},list:[{n:"\u79fb\u52a8",s:0},{n:"\u79fb\u52a8\u5230",s:10},{n:"\u653b\u51fb",s:9},{n:"\u6280\u80fd1",s:1},{n:"\u6280\u80fd2",s:2},{n:"\u6280\u80fd3",s:3}]},{n:"\u52a8\u4f5c",v:"a",info:"\u6309\u4e0b1/\u677e\u5f002/\u70b9\u51fb3,\u9ed8\u8ba4\u65e0\u64cd\u4f5c",t:"int",min:1,max:3,list:[{n:"\u6309\u4e0b",s:1},{n:"\u677e\u5f00",s:2},{n:"\u70b9\u51fb",s:3}]},{n:"\u89d2\u5ea6",v:"d",info:"\u89d2\u5ea6",t:"num",min:-360,max:360},{n:"x",v:"x",info:"x",t:"num"},{n:"y",v:"y",info:"y",t:"num"},{n:"\u76ee\u6807\u6807\u8bc6\u7c7b\u578b",v:"t2",info:"0:\u7f16\u53f7/1:\u7c7b\u578b/2:\u961f\u4f0d/3:\u73a9\u5bb6/9:\u5168\u5730\u56fe\u5355\u4f4d",t:"int",min:0,max:9,list:i},{n:"\u76ee\u6807\u5355\u4f4d\u6807\u8bc6",v:"i2",info:"\u5355\u4f4d\u6807\u8bc6",listFunc:function(){}}]},ACT_DESCRIBE[ACT.AVATAR]={n:"\u52a8\u753b",info:"",i:ACT.AVATAR,func:function(t){return t.n?"\u64ad\u653e"+o(t)+"\u7684"+t.n+"\u52a8\u753b":"\u53d6\u6d88"+o(t)+"\u7684\u52a8\u753b"},v:[a,s,{n:"\u90e8\u4f4d",v:"p",info:"\u5168\u8eab0/\u4e0a\u534a\u8eab1/\u4e0b\u534a\u8eab2,\u9ed8\u8ba40",t:"int",min:0,max:2,list:[{n:"\u5168\u8eab",s:0},{n:"\u4e0a\u534a\u8eab",s:1},{n:"\u4e0b\u534a\u8eab",s:2}]},{n:"\u52a8\u753b\u540d",v:"n",info:"\u52a8\u753b\u540d",list:[{n:"\u653b\u51fb",s:"attack"},{n:"\u79fb\u52a8",s:"walk"},{n:"\u7ad9\u7acb",s:"stand"},{n:"\u88c5\u5f39",s:"reload"},{n:"\u6b7b\u4ea1",s:"death"}]}]},ACT_DESCRIBE[ACT.CHOSE]={n:"\u5206\u652f",info:"",i:ACT.CHOSE,virtual:2,func:function(t){return"\u9009\u62e9\u540e\u7eed"+t.n+"\u4e2a\u52a8\u4f5c\u4e4b\u4e00"},v:[{n:"\u6570\u91cf",v:"n",info:"\u8fdb\u5165\u5206\u652f\u62bd\u9009\u7684\u52a8\u4f5c\u6570\u91cf,\u9ed8\u8ba4\u4e3a0",t:"int",min:0}]};var R=[];for(var l in QUEST_STR)for(var O in R[l]=[],QUEST_STR[l])R[l][O]={n:QUEST_STR[l][O],s:+O};var k=function(t){return R[t.q-1]};ACT_DESCRIBE[ACT.QUEST]={n:"\u4efb\u52a1",info:"",i:ACT.QUEST,func:function(t){return t.q?"\u5f00\u542f\u4efb\u52a1"+k(t)[t.s||0].n:"\u5173\u95ed\u4efb\u52a1"},v:[{n:"\u7c7b\u522b",v:"q",info:"\u65e0\u4efb\u52a10/\u6309\u4e0b1/\u677e\u5f002/\u70b9\u51fb3,\u9ed8\u8ba4\u65e0",t:"int",min:1,max:4,list:[{n:"\u65e0\u4efb\u52a1"},{n:"\u6d88\u706d",s:1},{n:"\u4fdd\u62a4",s:2},{n:"\u575a\u5b88",s:3},{n:"\u62b5\u8fbe",s:4}]},a,s,{n:"\u6570\u91cf",v:"n",info:"\u9ed8\u8ba4\u4e3a0",t:"int",min:0},{n:"\u63cf\u8ff0",v:"s",info:"\u9ed8\u8ba4\u4e3a0",t:"int",min:0,listFunc:k}]},window.EVENT_DESCRIBE=[{n:"\u4e8b\u4ef6\u7f16\u53f7",v:"id",func:function(t,e){t.getChildByName("name").getComponent(cc.Label).string="\u4e8b\u4ef6"+(e?" - "+e:""),this.updateMapLink()},info:"\u7528\u4e8e\u5176\u4ed6\u4e8b\u4ef6\u4e2d\u7d22\u5f15\u8fd9\u4e2a\u4e8b\u4ef6"},{n:"x\u5750\u6807",v:"x",t:"num",func:function(t,e){t.x=e||0},info:"x"},{n:"y\u5750\u6807",v:"y",t:"num",func:function(t,e){t.y=e||0},info:"y"},{n:"\u7981\u7528\u4e8b\u4ef6",v:"off",t:"int",func:function(t,e){t.getChildByName("name").color=e?cc.color(205,50,50):cc.color(255,255,255)},list:[{n:"\u7981\u7528",s:1},{n:"\u542f\u52a8"}],info:"\u6709\u503c\u5219\u521d\u59cb\u5316\u65f6\u4e0d\u542f\u7528\u8fd9\u4e2a\u4e8b\u4ef6"},{n:"\u91cd\u590d\u6b21\u6570",v:"repeat",t:"int",min:-1,list:[{n:"\u4e0d\u91cd\u590d"},{n:"\u65e0\u9650",s:-1}],placeholder:"1",info:"\u6b63\u503c\u65f6\u4e8b\u4ef6\u5b8c\u6210\u540e\u4f1a\u518d\u6b21\u542f\u52a8\u5e76\u91cd\u590dn\u6b21.\n\u8d1f\u503c\u65e0\u9650\u91cd\u590d.\n\u5176\u4ed6\u503c\u5219\u53ea\u6267\u884c\u4e00\u6b21."}],window.BRUSH_DESCRIBE=[{n:"\u7b14\u5237\u7f16\u53f7",v:"id",info:"\u7528\u4e8e\u5176\u4ed6\u4e8b\u4ef6\u4e2d\u7d22\u5f15\u8fd9\u4e2a\u4e8b\u4ef6"},{n:"x\u5750\u6807",v:"x",t:"num",func:function(t,e){t.x=e||0},info:"x"},{n:"y\u5750\u6807",v:"y",t:"num",func:function(t,e){t.y=e||0},info:"y"}];var U=[{n:"\u65e0"}];for(var l in SHADER_DEFINE)U.push({n:SHADER_DEFINE[l].n||l,s:l});window.ATTRIBUTE_DESCRIBE=[{n:"\u5355\u4f4d\u7f16\u53f7",v:"id",func:function(t,e){t.getChildByName("name").getComponent(cc.Label).string=t.define.name+(e?" - "+e:""),this.updateMapLink()},info:"\u7528\u4e8e\u4e8b\u4ef6\u4e2d\u7d22\u5f15\u5355\u4f4d"},{n:"\u89e6\u53d1dx\u503c",v:"xx",t:"num",func:function(){},info:"\u89e6\u53d1\u751f\u6210\u4e8b\u4ef6\u7684dx\u503c,\u4e0d\u586b\u4e3a0"},{n:"x\u5750\u6807",v:"x",t:"num",func:function(t,e){t.x=e||0},info:"x"},{n:"y\u5750\u6807",v:"y",t:"num",func:function(t,e){t.y=e||0},info:"y"},{n:"\u89d2\u5ea6",v:"deg",t:"num",min:-360,max:360,func:function(t,e){t.avatar.angle=e||0},info:"\u65cb\u8f6c"},{n:"\u5730\u9762\u7d22\u5f15",v:"ground",list:[{n:"\u9ed8\u8ba4"}],info:"\u6307\u5b9a\u5f53\u524d\u89d2\u8272\u7684\u5730\u9762, \u4e0d\u586b\u4e3a\u9ed8\u8ba4\u5730\u97620"},{n:"\u89d2\u8272",v:"i",info:"\u89d2\u8272\u5e8f\u53f7"},{n:"\u6240\u5c5e\u961f\u4f0d",v:"team",t:"int",func:function(t){this.updateAura(t)},list:c,info:"\u961f\u4f0d\u7f16\u53f7\n0:\u6211\u65b9,1~n:\u654c\u4eba"},{n:"\u63a7\u5236\u9009\u9879",v:"me",t:"int",func:function(t){this.updateAura(t)},list:[{n:"\u73a9\u5bb6",s:1},{n:"\u65e0"}],info:"\u6709\u503c\u5219\u53ef\u88ab\u73a9\u5bb6\u63a7\u5236\n1:\u73a9\u5bb6\u89d2\u8272"},{n:"\u52a8\u6001\u5c5e\u6027",v:"c",info:"\u6709\u503c\u5c06\u88ab\u66ff\u6362\u4e3a\u73a9\u5bb6\u9009\u62e9\u7684\u82f1\u96c4,0\u4e3a\u73a9\u5bb6\u5f53\u524d\u82f1\u96c4"},{n:"\u7f16\u7ec4",v:"g",info:"\u7f16\u7ec4\u5185\u6240\u6709\u5355\u4f4d\u540c\u65f6\u751f\u6210"},{n:"\u751f\u6210\u65f6\u95f4",v:"t",t:"num",min:0,list:[{n:"\u7acb\u523b",s:0},{n:"\u5173\u95ed"}],info:"\u591a\u4e45\u540e\u751f\u6210\u8fd9\u4e2a\u5355\u4f4d,\u4e0d\u586b\u503c\u5219\u4e0d\u751f\u6210"},{n:"\u751f\u6210\u6570\u91cf",v:"n",t:"int",info:"\u521b\u5efa\u5355\u4f4d\u7684\u6570\u91cf,\u4e0d\u586b\u4e3a1,\u590d\u6570\u5355\u4f4d\u5c06\u542f\u52a8\u5706\u73af\u751f\u6210"},{n:"\u751f\u6210\u6a21\u5f0f",v:"m",t:"int",min:0,max:1,list:[{n:"\u56fa\u5b9a0",s:0},{n:"\u968f\u673a1",s:1}],info:"\u521b\u5efa\u5355\u4f4d\u7684\u6a21\u5f0f,\u968f\u673a\u6a21\u5f0f\u5c06\u5728\u5706\u5f62\u533a\u57df\u5185\u968f\u673a"},{n:"\u751f\u6210\u534a\u5f84",v:"r",t:"num",info:"\u4ee5\u5706\u5f62\u751f\u6210\u5355\u4f4d\u65f6\u7684\u5706\u534a\u5f84,\u9ed8\u8ba4100"},{n:"AI\u6a21\u5f0f",v:"ai",t:"int",list:[{n:"\u6253\u5f001",s:1},{n:"\u5173\u95ed0",s:0}],info:"\u6709\u503c\u5219\u6253\u5f00ai"},{n:"\u7b49\u7ea7",v:"lvl",info:"\u7d22\u5f15\u5230excel\u4e2d\u5b9a\u4e49\u7684\u5355\u4f4d\u6570\u636e,\u5b9e\u9645\u7b49\u7ea7\u4e3a(\u5730\u56fe\u57fa\u7840\u7b49\u7ea7+\u7b49\u7ea7)"},{n:"\u8840\u91cf",v:"hp",t:"num",min:0,max:1,info:"\u521d\u59cb\u8840\u91cf=hp*hpMax"},{n:"\u57fa\u7840\u8840\u91cf",v:"hp0",t:"num",min:0,info:"\u6700\u5927\u8840\u91cf\u7cfb\u6570"},{n:"\u57fa\u7840\u653b\u51fb",v:"atk0",t:"num",min:0,info:"\u653b\u51fb\u7cfb\u6570"},{n:"\u4f53\u5f62\u7cfb\u6570",v:"scale",t:"num",min:0,info:"\u4f53\u5f62\u7f29\u653e"},{n:"\u955c\u50cf\u7ffb\u8f6c",v:"flipX",t:"int",min:0,max:1,step:2,func:function(){},list:[{n:"\u7ffb\u8f6c",s:1},{n:"\u5173\u95ed"}],info:"\u955c\u50cf\u7ffb\u8f6c"},{n:"\u4e0d\u6b7b",v:"un",info:"\u6709\u503c\u5219\u4e0d\u4f1a\u6b7b\u4ea1"},{n:"\u5b58\u6d3b\u65f6\u95f4",v:"life",t:"num",info:"\u9650\u65f6\u5355\u4f4d,\u65f6\u95f4\u7ed3\u675f\u540e\u6b7b\u4ea1"},{n:"\u6d88\u706d\u4f4d\u7f6e",v:"out",t:"num",info:"\u6307\u5b9a\u51fa\u5c4f\u591a\u8fdc\u540e\u6740\u6b7b,\u4e0d\u586b\u5219\u51fa\u5c4f\u540e\u7acb\u5373\u6740\u6b7b"},{n:"\u6389\u843d\u7269",v:"drop",text:1,len:200,list:[{n:"\u55b7\u706b\u5668",s:'[{id:"flame_thrower",lvl:1}]'},{n:"\u91d1\u5e01",s:'[{id:"gold"}]'}],info:"\u6b7b\u4ea1\u540e\u6389\u843d\u6307\u5b9a\u7684\u9053\u5177"},{n:"shader",v:"shader",func:function(t,e){var n=t.avatar,i=n.animeNode;if(i){var a=i.sprite||i.armatureDisplay;a&&this.bindShader(a,e)}var o=n.base;o&&this.bindShader(o.sprite,e)},list:U,info:"shader"},{n:"AI\u53c2\u6570",v:"aiCfg",text:1,len:200,list:[{n:"\u58eb\u5175",s:'{ctor:"AISoldier",attackRange:450,safeRange:[200,400],}'},{n:"\u51b2\u950b",s:'{ctor:"AICommon",vx:-4,ax:1,at:3}'},{n:"\u7ad9\u7acb",s:'{ctor:"AICommon",vx:0,ax:0,at:0}'},{n:"\u98de\u8fc7",s:'{ctor:"AIFlySoldier"}'},{n:"\u505c\u98de",s:'{ctor:"AIFlySoldierWander"}'},{n:"\u7535\u68af",s:'{ctor:"AIElevator",moveX:0,moveY:-1,moveTime:3,delayTime:6}'},{n:"\u8718\u86db",s:'{ctor:"AISpider",attackRange: [400,500],safeRange:[200,400],seekRange:1000,activateRange:500}'},{n:"\u8ffd\u8f66",s:'{ctor:"AIChaseCar"}'},{n:"\u4f11\u606f",s:'{ctor:"AIIdle"}'}],info:"AI\u53c2\u6570"}],window.CONFIG_DESCRIBE=[{n:"\u79fb\u52a8\u901f\u5ea6",v:"spd",min:0,max:100,default:1,info:"\u4e3b\u89d2\u79fb\u52a8\u901f\u5ea6"},{n:"\u5173\u5361\u957f\u5ea6",v:"distance",t:"int",default:1e3,func:function(t,e){this.distance=e,this.updateGrid()},info:"\u4f60\u61c2\u5f97"},{n:"\u5730\u56fe\u540d",v:"name",info:"\u4f60\u61c2\u5f97"},{n:"\u4e3b\u9898",v:"theme",t:"list",func:function(t,e){this.themeDefine=THEME_DEFINE[e||"dust"],this.updateMapTheme(this.mapData)},listFunc:function(){var t=[];for(var e in THEME_DEFINE)t.push({n:e,s:e});return t},placeholder:"\u968f\u673a",info:"\u5730\u56fe\u573a\u666f\u4e3b\u9898"},{n:"\u5165\u573a\u5ef6\u8fdf",v:"inDelay",t:"num",min:0,info:"\u8fdb\u573a\u524d\u7684\u5ef6\u8fdf"},{n:"\u5165\u573a\u8ddd\u79bb",v:"inDis",t:"num",min:0,info:"\u8fdb\u573a\u540e\u89e3\u9501\u955c\u5934\u7684\u8ddd\u79bb"},{n:"\u5165\u573a\u6587\u672c",v:"inMsg",t:"num",min:0,list:[{n:"\u5173\u95ed",s:1},{n:"\u542f\u7528"}],info:"\u8fdb\u573a\u6587\u672c"}],window.UPGRADE_MAP_DATA=function(t){return(!t.version||t.version<1)&&(t.ground=[{i:0,list:t.ground||[]}],t.version=1),t},window.DEFAULT_MAP={version:1,author:"",config:{distance:1e3},entity:[{x:-300,y:0,i:"a",team:0,me:1,t:0,c:1,towers:[{i:"b",m:1},{i:"c",m:0},{i:"d",m:0}],heroes:[{i:"h1"},{i:"h2"},{i:"h3"}],bench:[{i:"h4"}]}],ground:[{i:0,list:[]}],scene:[],event:[]};var P="http://"+window.location.hostname+":5556/editor/";window.editor={post:function(t,e,n){var i;try{i=JSON.stringify(e)}catch(c){return void n(-100)}var a=menuManager.popCover(),o=new XMLHttpRequest;o.ontimeout=function(){menuManager.closeCover(a),n(1)},o.open("POST",P+t,!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onloadend=function(){if(menuManager.closeCover(a),4==o.readyState&&o.status>=200&&o.status<=206){var e=o.responseText;try{if(console.log(t+" response:",e),e)var i=JSON.parse(e)}catch(c){cc.error("editor xhr.onloadend",c.fileName+":"+c.lineNumber+"\n"+c.message+"\n\n"+c.stack),n(2)}i&&i.err?(cc.error("editor.post: response.err=",i.err),n(3)):n(0,i)}else n(5)},console.log(t+" send:",i),o.send(i)},getRemote:function(){for(var t=[],e=[],n=cc.sys.localStorage.getItem("test_main_weapon"),i=0;i<4;i++){var a=cc.sys.localStorage.getItem("test_tower_"+i);if(a&&ENTITY[a]){for(var o=[],c=0;c<3;c++){var s=cc.sys.localStorage.getItem("test_part_"+(3*i+c));o.push(s)}t[i]={i:a,m:n==i?1:0,equipment:o}}var r=cc.sys.localStorage.getItem("test_pilot_"+i);if(r&&ENTITY[r]){var d=cc.sys.localStorage.getItem("test_star_"+i);e[i]={i:r,star:d}}}for(var l=cc.sys.localStorage.getItem("test_vehicle"),h=cc.sys.localStorage.getItem("test_star_vehicle"),u=[],v=0;v<3;v++){var p=cc.sys.localStorage.getItem("test_pilot_b"+v);if(p&&ENTITY[p]){var f=cc.sys.localStorage.getItem("test_star_b"+v);u.push({i:p,star:f})}}var m=cc.sys.localStorage.getItem("test_tower"),g=m&&JSON.parse(m);cc.log("getRemote",g);var C=cc.sys.localStorage.getItem("editor_map_level")||0,E=cc.sys.localStorage.getItem("test_backpack");return{lvl:C,entity:{1:{id:l||"v1",towers:g||t,star:h,heroes:e,bench:u}},backpack:E=E&&JSON.parse(E)}}},cc._RF.pop()},{"../../script/scripts/define":void 0,"../../script/scripts/levelDefine":void 0,"../../script/scripts/shaderDefine":void 0}]},{},["DebugEditbox","DebugMenu","DebugSelectMenu","DebugSlider","DebugToggle","EditorListMenu","EditorMenu","TestMenu","editor"]);