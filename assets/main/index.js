window.__require=function e(t,i,a){function n(r,s){if(!i[r]){if(!t[r]){var c=r.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var d=i[r]={exports:{}};t[r][0].call(d.exports,function(e){return n(t[r][1][e]||e)},d,d.exports,e,t,i,a)}return i[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<a.length;r++)n(a[r]);return n}({ADManager:[function(e,t,i){"use strict";cc._RF.push(t,"eb504PnhcFKWLwiCkXTwR0G","ADManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.ADManager=i.LocalData=i.DailyAdInfo=i.ScreenPlacement=void 0;var a=e("./applovin/MAX"),n=e("./DateTime"),o=e("./firebase/FirebaseTracking"),r=e("./SDKManager"),s=cc._decorator,c=s.ccclass;s.property,function(e){e.Challenge="challenge",e.Endless="endless"}(i.ScreenPlacement||(i.ScreenPlacement={}));var l=function(){this.dateTimestamp=Date.now(),this.bannerCount=0,this.interstitialCount=0,this.rewardedCount=0,this.spinCount=0};i.DailyAdInfo=l;var d=function(){};i.LocalData=d;var h=function(){function e(){this._dataKey="SDKlocalData",this._playTotalTime=10,this._LimitMap=new Map,this._countMap=new Map,this._dailyAdInfo=new l,this.IsAdsShowing=!1,this.IsReviveAds=!1}var t;return t=e,Object.defineProperty(e,"Instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),e.prototype.setAdPlacement=function(e){this._adPlacement=e},e.prototype.getAdPlacement=function(){return this._adPlacement},e.prototype.getScreenName=function(e){return e},e.prototype.setScreenName=function(e){this._currentScreen=e},e.prototype.initLocalData=function(){var e=this.getItem(this._dataKey);if(e&&""!=e){var t=JSON.parse(e);this._localData=t}else this._localData=new d,this.setItem(this._dataKey,JSON.stringify(this._localData))},e.prototype.getItem=function(e){return cc.sys.localStorage.getItem(e)},e.prototype.setItem=function(e,t){return cc.sys.localStorage.setItem(e,t)},e.prototype.getLocalData=function(){return this._localData},e.prototype.saveLocal=function(){this.setItem(this._dataKey,JSON.stringify(this._localData))},e.prototype.saveDailyAdCount=function(e){this._localData.dailyAdInfo=e,this.saveLocal()},e.prototype.isSameDay=function(e,t){return new n.DateTime(e).isSameDay(new n.DateTime(t))},e.prototype.checkResetAdCount=function(){var e=this.getLocalData().dailyAdInfo;e&&this.isSameDay(e.dateTimestamp,Date.now())?Object.assign(this._dailyAdInfo,e):this._dailyAdInfo=new l,this.saveDailyAdCount(this._dailyAdInfo)},e.prototype.isInterAvailable=function(){return a.MAX.instance.isInterstitial()},e.prototype.initAdSDK=function(){this.initLocalData(),this.checkResetAdCount(),this.SetAdListener(),console.log("[ADManager] Ad SDK initialization completed")},e.prototype.SetAdListener=function(){var e=this;r.SDKManager.Instance.HaveBanner&&a.MAX.instance.setListener(a.AdType.Banner,{onAdClicked:function(t){o.FirebaseTracking.logBiAdClick("max",t.adNetwork,"banner","","banner",e._dailyAdInfo.bannerCount,e.getScreenName(e._currentScreen))},onAdLoaded:function(t){o.FirebaseTracking.logBiAdImpression("max",t.adNetwork,"banner","","banner",e._dailyAdInfo.bannerCount,e.getScreenName(e._currentScreen),t.revenue,t.lifetimeRevenue),e._dailyAdInfo.bannerCount++,e.saveDailyAdCount(e._dailyAdInfo)},onAdLoadFailed:function(t){o.FirebaseTracking.logBiAdRequestFailed("max","","banner","","banner",e._dailyAdInfo.bannerCount,e.getScreenName(e._currentScreen),t)}}),r.SDKManager.Instance.HaveInterstitial&&a.MAX.instance.setListener(a.AdType.Interstitial,{onAdClicked:function(t){o.FirebaseTracking.logBiAdClick("max",t.networkName,t.adUnitId,"interstitial",t.format,e._dailyAdInfo.interstitialCount,e._adPlacement)},onAdDisplayed:function(t){e.IsAdsShowing=!0,e._dailyAdInfo.interstitialCount++;var i=t.revenue;r.SDKManager.Instance.setAdCumValue(i);var a=r.SDKManager.Instance.getAdCumValue();o.FirebaseTracking.logBiAdImpression("max",t.networkName,t.adUnitId,"interstitial",t.format,e._dailyAdInfo.interstitialCount,e._adPlacement,i,a),e.saveDailyAdCount(e._dailyAdInfo)},onAdLoadFailed:function(t){o.FirebaseTracking.logBiAdRequestFailed("max","","interstitial","","interstitial",e._dailyAdInfo.interstitialCount,e._adPlacement,t)},onAdHidden:function(){e.IsAdsShowing=!1,e._callbackInter&&e._callbackInter({status:1})}}),r.SDKManager.Instance.HaveReward&&a.MAX.instance.setListener(a.AdType.Rewarded,{onAdClicked:function(t){o.FirebaseTracking.logBiAdClick("max",t.networkName,t.adUnitId,"rewarded_video",t.format,e._dailyAdInfo.rewardedCount,e._adPlacement)},onUserRewarded:function(t){"get_revived"==e._adPlacement&&(e.IsReviveAds=!0);var i=t.revenue;r.SDKManager.Instance.setAdCumValue(i);var a=r.SDKManager.Instance.getAdCumValue();o.FirebaseTracking.logBiAdImpression("max",t.networkName,t.adUnitId,"rewarded_video",t.format,e._dailyAdInfo.rewardedCount,e._adPlacement,i,a),e._callbackReward&&e._callbackReward({status:1})},onAdLoadFailed:function(t,i){o.FirebaseTracking.logBiAdRequestFailed("max","",t,"","REWARDED",e._dailyAdInfo.rewardedCount,e._adPlacement,i.message)},onAdDisplayed:function(){e._dailyAdInfo.rewardedCount++,e.saveDailyAdCount(e._dailyAdInfo),e.IsAdsShowing=!0},onAdHidden:function(){e.IsAdsShowing=!1}})},e.prototype.showMaxDebug=function(){},e.prototype.showBanner=function(){a.MAX.instance.showBanner()},e.prototype.hideBanner=function(){a.MAX.instance.hideBanner()},e.prototype.showInterstitial=function(e){a.MAX.instance.showInterstitial(),this._callbackInter=e},e.prototype.showReward=function(e,t){if(console.log("[ADManager] Attempting to show reward ad for placement: "+e),!a.MAX.instance.isRewarded())return console.warn("[ADManager] Rewarded ad not ready for placement: "+e),void(t&&t({status:-1,message:"Ad not ready"}));this.setAdPlacement(e),console.log("[ADManager] Ad ready, proceeding to show for placement: "+e),a.MAX.instance.showRewarded(t)},e._instance=null,t=__decorate([c("ADManager")],e)}();i.ADManager=h,cc._RF.pop()},{"./DateTime":"DateTime","./SDKManager":"SDKManager","./applovin/MAX":"MAX","./firebase/FirebaseTracking":"FirebaseTracking"}],AIAlwaysAttack:[function(e,t){"use strict";cc._RF.push(t,"409d2QCHtdP55KW+NJADfcE","AIAlwaysAttack"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){var e=this.define;null!=e.moveX?this.moveX=e.moveX:this.moveX=0,this.moveY=e.moveY||0,this.atkDeg=e.atkDeg||180},updateAI:function(e){var t=this.obj;t.callMove(this.moveX,this.moveY),t.callAutoAttack(!0),t.attackDeg=this.atkDeg,this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AIBigShipBoss:[function(e,t){"use strict";cc._RF.push(t,"d96d5Um9TtPz56lIwkiEfhl","AIBigShipBoss"),cc.Class({extends:e("../movement/AIChaseCar"),initAI:function(){this._super(),this.obj.setFlag(NO_GROUND,!0),this.obj.fly=!0,this.leftChaseK=1,this.rightChaseK=.1},updateAI:function(e){this._super(e)}}),cc._RF.pop()},{"../movement/AIChaseCar":"AIChaseCar"}],AIBossCyborg:[function(e,t){"use strict";cc._RF.push(t,"bb988BtBexBNZjbfe2LxRRB","AIBossCyborg"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.attackRange=this.define.attackRange||500,this.seekRange=this.attackRange,cc.log("initAI",this.attackRange),this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack,this.spdX=0,this.spdY=0,this.flyDirectionX=-1,this.flyDirectionY=0,this.hitRunTimer=this.define.hitRunTime||99999,this.activate||(this.obj.avatar.setForcedAnime("stand2",1),this.obj.avatar.refresh(.03,!0,!0),this.obj.attribute.add("hurtScale",-1)),this.attackSeqTime1=10,this.attackSeqTime2=5,this.attackSeqIndex=1,this.changeAttackSeqTimer=this.attackSeqTime1},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.activate||this.activateTimer||!kit.timer(this,"activate",1,e)||(this.activateTimer=3,this.obj.avatar.setForcedAnime("skill",1,0,1),this.obj.avatar.refresh(.03,!0,!0),this.obj.attribute.add("hurtScale",1),this.obj.game.effectMgr.playEffect("sound/mob/spider/skill"),this.obj.game.effectMgr.playEffect("sound/mob/spider/skill2")),this.changeAttackSeqTimer-=e,this.changeAttackSeqTimer<=0&&(this.attackSeqIndex++,3==this.attackSeqIndex&&(this.attackSeqIndex=1),1==this.attackSeqIndex?(this.obj.attackSequence=this.obj.define.attackSequence,this.bonusAttackDeg=null):(this.obj.attackSequence=this.obj.define.attackSequence2,this.bonusAttackDeg=-30),this.obj.attackIndex=0,this.changeAttackSeqTimer=this["attackSeqTime"+this.attackSeqIndex],cc.log("cyborg changeAttackSeqTimer",this.changeAttackSeqTimer),cc.log("cyborg attackIndex",this.attackSeqIndex)),this.activateTimer&&(this.activateTimer-=e,this.activateTimer<0&&(this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.activate=!0,this.activateTimer=null,this.obj.getFlag(NO_ATTACK)&&this.obj.setFlag(NO_ATTACK,!1))),this.obj.hp<.66*this.obj.hpMax&&!this.crazyState&&(this.crazyState=!0,this.obj.avatar.setForcedAnime("skill2",1,0,1),this.obj.avatar.refresh(.03,!0,!0),this.activateTimer=2,this.obj.callMove(0,0),this.activate=!1,this.shakeTimer=1),this.obj.hp<.33*this.obj.hpMax&&!this.crazyState2&&(this.crazyState2=!0,this.obj.avatar.setForcedAnime("skill2",1,0,1),this.obj.avatar.refresh(.03,!0,!0),this.activateTimer=2,this.obj.callMove(0,0),this.activate=!1,this.shakeTimer=1,this.toKeepShake=!0),this.shakeTimer>0&&(this.shakeTimer-=e,this.shakeTimer<=0&&(this.shakeTimer=null,this.game.layer.shake(55,55),this.toKeepShake&&(this.keepShaking=!0))),this.keepShaking&&kit.timer(this.obj,"keepShaking",.2,e)&&this.game.layer.shake(3,3),this.activate){var n=Math.abs(a.getPositionX()-i.getPositionX());if(this.hitRunTimer>0&&this.safeRange&&(-1==a.flipX&&n<this.safeRange||1==a.flipX&&(this.moveAttackMinRange?n<this.moveAttackMinRange:n<this.attackRange)))this.flyDirectionX=2,this.moveAttack||a.callAutoAttack(!1);else if(n<this.attackRange){var o=this.target;o&&!o.isDead()||this.seekTargetQuick(),o=this.target,a.isInBorder()&&o&&!o.isDead()?(a.callRotate(this.aim(o)),a.callAutoAttack(!0),this.moveAttack&&(!this.moveAttackMinRange||n>this.moveAttackMinRange)||this.hitRunTimer<=0?(this.flyDirectionX=-1,this.hitRunTimer<=0&&(this.flyDirectionX=-2)):this.flyDirectionX=0):a.callAutoAttack(!1)}else this.flyDirectionX=-1;this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),this._super(e)}}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AIBuff:[function(e,t){"use strict";cc._RF.push(t,"53e9ejQbFhOfLXmcs2a+i6V","AIBuff"),cc.Class({extends:e("../../../ai/core/AIProto"),initAI:function(){this.flyMode=this.define.flyMode,this.time=this.define.randomTime&&kit.rnd(0,2*Math.PI)||0,this.spdX=this.define.vx||-1,this.spdY=this.define.vy||0,this.accelerationX=this.define.ax||0,this.accelerationY=this.define.ay||0,this.accelerationTimer=this.define.at||99,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.time+=4*e,Math.abs(a.getPositionX()-i.getPositionX())<this.attackRange){var n=this.target;n&&!n.isDead()||this.seekTargetQuick(),n=this.target,a.isInBorder()&&n&&!n.isDead()?(a.attackDeg=c_vector2Degree(n.getPositionX()-a.getPositionX(),n.getPositionY()-a.getPositionY()),a.callAutoAttack(!0)):a.callAutoAttack(!1)}"wave"==this.flyMode&&(this.spdY=2*Math.sin(this.time)),(this.accelerationX||this.accelerationY)&&this.accelerationTimer>0&&(this.accelerationTimer-=e,this.accelerationTimer<0&&(e+=this.accelerationTimer),this.spdX+=this.accelerationX*e,this.spdY+=this.accelerationY*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"../../../ai/core/AIProto":"AIProto"}],AIChaseCar:[function(e,t){"use strict";cc._RF.push(t,"27230qikCpFy6VYqds4mkKJ","AIChaseCar"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){var e=this.game.levelMgr.heroes[this.game.me],t=e.moveSpd/this.obj.moveSpd;this.toSpdScale=t,this.flyDirectionX=t,this.flyDirectionY=0,null!=this.define.vx?this.spdX=this.define.vx:this.spdX=-1,this.spdY=this.define.vy||0,this.targetDx=this.define.targetDx,this.targetDx||(this.obj.getPositionX()>e.getPositionX()?t*=kit.rnd(.5,1):t*=kit.rnd(1,2),this.flyDirectionX=t),this.accelerationX=this.define.ax||3,this.seekRange=this.define.seekRange||9999,this.leftChaseK=1,this.rightChaseK=1},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.targetDx){var n=a.getPositionX()-i.getPositionX()-this.targetDx,o=kit.clamp(Math.abs(n/100),.1,5);n<0?this.flyDirectionX=this.toSpdScale+o*this.leftChaseK:n>0&&(this.flyDirectionX=this.toSpdScale-o*this.rightChaseK)}this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,this.accelerationX*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),n=Math.abs(a.getPositionX()-i.getPositionX()),this.obj.attackSequence&&(n<this.seekRange?this.obj.callAutoAttack(!0):this.obj.callAutoAttack(!1)),this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AICommon:[function(e,t){"use strict";cc._RF.push(t,"3c8e8Nz/uJM2KLZ8W3ubleW","AICommon"),cc.Class({extends:e("./AIProto"),initAI:function(){if(this.attackRange=this.define.attackRange||500,this.seekRange=this.attackRange,this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack,null!=this.define.vx?this.spdX=this.define.vx:this.spdX=-1,this.spdY=this.define.vy||0,this.accelerationX=this.define.ax||0,this.accelerationY=this.define.ay||0,this.accelerationTimer=kit.num(this.define.at)||99,this.define.cx){var e=kit.num(this.define.cx);this.define.lsat&&(this.accelerationTimer*=this.define.cx[1]/this.define.cx[0]);var t=this.obj.moveSpd,i=-e,a=this.accelerationTimer,n=i/(a*t)*2- -1,o=(-1-n)/a;this.spdX=n,this.accelerationX=o}},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());if(this.safeRange&&(-1==a.flipX&&n<this.safeRange||1==a.flipX&&(this.moveAttackMinRange?n<this.moveAttackMinRange:n<this.attackRange)))this.flyDirectionX=2,this.moveAttack||a.callAutoAttack(!1);else if(a.attackSequence&&n<this.attackRange){var o=this.target;o&&!o.isDead()||this.seekTargetQuick(),o=this.target,a.isInBorder()&&o&&!o.isDead()?(a.attackDeg=this.aim(o),a.callAutoAttack(!0),this.moveAttack&&(!this.moveAttackMinRange||n>this.moveAttackMinRange)?this.flyDirectionX=-1:this.flyDirectionX=0):(a.callAutoAttack(!1),this.obj.attackDeg=180)}else this.obj.attackDeg=180;(this.accelerationX||this.accelerationY)&&this.accelerationTimer>0&&(this.accelerationTimer-=e,this.accelerationTimer<0&&(e+=this.accelerationTimer),this.spdX+=this.accelerationX*e,this.spdY+=this.accelerationY*e),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"./AIProto":"AIProto"}],AIElevator:[function(e,t){"use strict";cc._RF.push(t,"76dcdHkzPRPMaDBM+rNkfHm","AIElevator"),cc.Class({extends:e("../core/AIProto"),initAI:function(){var e=this.define;null!=e.moveX?this.moveX=e.moveX:this.moveX=0,this.moveY=e.moveY||0,Array.isArray(this.moveY)&&(this.moveY=kit.rnd(this.moveY[0],this.moveY[1])),this.moveTime=e.moveTime,Array.isArray(this.moveTime)&&(this.moveTime=kit.rnd(this.moveTime[0],this.moveTime[1])),this.moveTimer=0,this.delayTimer=e.delayTime||0},updateAI:function(e){var t=this.obj;this.delayTimer>0?this.delayTimer-=e:(this.moveTimer+=e,this.moveTime&&this.moveTimer>this.moveTime?t.callMove(0,0):(t.callMove(this.moveX,this.moveY),this._super(e)))}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIFlySoldierWander:[function(e,t){"use strict";cc._RF.push(t,"de955j/NrpOj7w11WDQlHy8","AIFlySoldierWander"),cc.Class({extends:e("../core/AIProto"),initAI:function(){if(this.spdX=0,this.spdY=0,this.flyDirectionX=-1,this.flyDirectionY=0,this.moveTo=this.define.moveTo,this.define.moveBy){var e=this.game,t=e.levelMgr.heroes[e.me],i=this.obj.x+(this.define.moveBy.x||0),a=this.obj.y+(this.define.moveBy.y||0),n=i-t.getPositionX(),o=a-t.getPositionY();this.moveTo={x:n,y:o}}},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(Math.abs(a.getPositionX()-i.getPositionX())<this.attackRange&&a.getPositionX()>i.getPositionX()){var n=this.target;n&&!n.isDead()||this.seekTargetQuick(),n=this.target,a.isInBorder()&&n&&!n.isDead()&&a.attackSequence?(a.attackDeg=c_vector2Degree(n.getPositionX()-a.getPositionX(),n.getPositionY()-a.getPositionY()),a.callAutoAttack(!0)):a.callAutoAttack(!1),this.moveTo||kit.timer(this,"123",3,e)&&(this.flyDirectionX=kit.rnd(-2,3),this.flyDirectionY=kit.rnd(-3,3),this.attackRange=this.define.attackRange+kit.rnd(-150,0))}var o=i.moveSpd/this.obj.moveSpd;if(this.moveTo){var r=i.getPositionX()+this.moveTo.x,s=i.getPositionY()+this.moveTo.y-a.getPositionY(),c=r-a.getPositionX(),l=c_vector2Radian(s,c);this.flyDirectionX=Math.sin(l)*(c<0&&c>-50?.5:2)+o,this.flyDirectionY=2*Math.cos(l)}else a.getPositionX()<i.getPositionX()&&(this.flyDirectionX=3+o),a.getPositionX()>i.getPositionX()+900&&(this.flyDirectionX=-3+o),a.getPositionY()<t.contactMgr.findGroundLine(a.x)+200&&(this.flyDirectionY=3),a.getPositionY()>800&&(this.flyDirectionY=-3);this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIFlySoldier:[function(e,t){"use strict";cc._RF.push(t,"150fde+/hhKH4sC4UfuhlLZ","AIFlySoldier"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.flyMode=this.define.flyMode,this.time=this.define.randomTime&&kit.rnd(0,2*Math.PI)||0,this.spdX=this.define.vx||-1,this.spdY=this.define.vy||0,this.accelerationX=this.define.ax||0,this.accelerationY=this.define.ay||0,this.accelerationTimer=this.define.at||99,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.time+=2*e,Math.abs(a.getPositionX()-i.getPositionX())<this.attackRange){var n=this.target;n&&!n.isDead()||this.seekTargetQuick(),n=this.target,a.isInBorder()&&n&&!n.isDead()?(a.attackDeg=c_vector2Degree(n.getPositionX()-a.getPositionX(),n.getPositionY()-a.getPositionY()),a.callAutoAttack(!0)):a.callAutoAttack(!1)}"wave"==this.define.flyMode&&(this.spdX=.5*Math.sin(this.time)-.5,this.spdY=2*Math.sin(this.time)),(this.accelerationX||this.accelerationY)&&this.accelerationTimer>0&&(this.accelerationTimer-=e,this.accelerationTimer<0&&(e+=this.accelerationTimer),this.spdX+=this.accelerationX*e,this.spdY+=this.accelerationY*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIFrogman:[function(e,t){"use strict";cc._RF.push(t,"b4e98vhmtlGEqFVNXe9tovb","AIFrogman"),cc.Class({extends:e("../core/AICommon"),initAI:function(){this._super(),this.obj.avatar.setForcedAnime("diving",1),this.obj.avatar.refresh(.03,!0,!0),this.state="diving",this.obj.setFlag(NO_GROUND,!0),this.jumpTime=this.define.jumpTime||[5,9],this.jumpTimer=kit.rnd(this.jumpTime[0],this.jumpTime[1]),this.obj.fly=!0,this.oz=this.obj.avatar.node.zIndex,this.obj.avatar.node.parent=null,this.game.layer.addToTop(this.obj.avatar.node),this.obj.setFlag(NO_ATTACK,!0),this.vy=this.define.vy||kit.rnd(1500,1700),this.obj.setFlag(NO_CONTACT,!0)},updateAI:function(e){if("diving"==this.state)return this.jumpTimer-=e,void(this.jumpTimer<=0&&(this.state="jump",this.obj.applyVelocity(0,this.vy),this.setGroundTimer=.5,this.obj.avatar.setForcedAnime("jump",1),this.obj.avatar.refresh(.03,!0,!0),this.obj.fly=!1,this.obj.setFlag(NO_CONTACT,!1)));this.setGroundTimer>0&&(this.setGroundTimer-=e,this.setGroundTimer<=0&&(this.obj.setFlag(NO_GROUND,!1),this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.obj.avatar.node.parent=null,this.game.layer.addToCamera(this.obj.avatar.node,this.oz))),cc.log(this.obj.y,this.game.contactMgr.findGroundLine(this.obj.x),this.obj.getFlag(NO_ATTACK),!this.obj.getFlag(NO_GROUND)),this.obj.y-this.obj.height<=this.game.contactMgr.findGroundLine(this.obj.x)&&this.obj.getFlag(NO_ATTACK)&&!this.obj.getFlag(NO_GROUND)&&this.obj.setFlag(NO_ATTACK,!1),this._super(e)}}),cc._RF.pop()},{"../core/AICommon":"AICommon"}],AIHelicopterBoss:[function(e,t){"use strict";cc._RF.push(t,"154bds2V4BHZIhSlf23z9FM","AIHelicopterBoss"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.flyMode=this.define.flyMode,this.time=kit.rnd(0,2*Math.PI),this.spdScale=1,this.attackRange=this.define.attackRange+kit.rnd(-150,0),this.spdX=0,this.spdY=0,this.flyDirectionX=1,this.flyDirectionY=0,this.moveTo=this.define.moveTo},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.time+=2*e,this.moveTo){var n=i.getPositionX()+this.moveTo.x,o=i.getPositionY()+this.moveTo.y-a.getPositionY(),r=n-a.getPositionX(),s=c_vector2Radian(o,r);this.flyDirectionX=Math.sin(s)*(r<0&&r>-50?.5:2),this.flyDirectionY=2*Math.cos(s),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),a.callAutoAttack(!1)}else if(Math.abs(a.getPositionX()-i.getPositionX())<this.attackRange+100){var c=this.target;c&&!c.isDead()||this.seekTargetQuick(),c=this.target,kit.timer(this,"123",5,e)&&(this.flyDirectionX=3+kit.rndInt(-.4,.4),this.flyDirectionY=kit.rnd(-.4,.4),this.attackRange=this.define.attackRange+kit.rnd(-150,0)),a.getPositionX()<i.getPositionX()+300&&(this.flyDirectionX=3),a.getPositionX()>i.getPositionX()+900&&(this.flyDirectionX=-1),a.getPositionY()<t.contactMgr.findGroundLine(a.x)+500&&(this.flyDirectionY=3),a.getPositionY()>600&&(this.flyDirectionY=-3),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,2*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,2*e),a.isInBorder()&&c&&!c.isDead()?(a.attackDeg=this.define.attackDeg||c_vector2Degree(c.x-a.getPositionX(),c.y-a.getPositionY()),a.callAutoAttack(!0),a.callMove(this.spdX,this.spdY)):(a.callAutoAttack(!1),a.callMove(this.spdX,this.spdY))}else{var l;l=i.getPositionX()>a.getPositionX()?1:-1,this.spdX=kit.numApproach(this.spdX,2*l,2*e),this.spdY=kit.numApproach(this.spdY,0,2*e),a.callMove(this.spdX,this.spdY)}this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AIHelicopter:[function(e,t){"use strict";cc._RF.push(t,"be945Zf0rFOF48SPkAUUUNH","AIHelicopter"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.flyMode=this.define.flyMode,this.time=kit.rnd(0,2*Math.PI),this.spdScale=1,this.attackRange=this.define.attackRange+kit.rnd(-150,0),this.spdX=0,this.spdY=0,this.flyDirectionX=1,this.flyDirectionY=0},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;if(this.time+=2*e,Math.abs(a.getPositionX()-i.getPositionX())<this.attackRange+50){var n=this.target;n&&!n.isDead()||this.seekTargetQuick(),n=this.target,"wave"==this.define.flyMode&&(this.flyDirectionX=.5*Math.sin(this.time)-.5,this.flyDirectionY=2*Math.sin(this.time)),kit.timer(this,"123",5,e)&&(this.flyDirectionX=3,this.flyDirectionY=kit.rnd(-.2,.2),this.attackRange=this.define.attackRange+kit.rnd(-150,0)),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,2*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,2*e),a.isInBorder()&&n&&!n.isDead()?(a.attackDeg=this.define.attackDeg||c_vector2Degree(n.x-a.getPositionX(),n.y-a.getPositionY()),a.callAutoAttack(!0),a.callMove(this.spdX,this.spdY)):(a.callAutoAttack(!1),a.callMove(this.spdX,this.spdY))}else{var o;o=i.getPositionX()>a.getPositionX()?1:-1,this.spdX=kit.numApproach(this.spdX,2*o,2*e),this.spdY=kit.numApproach(this.spdY,0,2*e),a.callMove(this.spdX,this.spdY)}this._super(e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIIdle:[function(e,t){"use strict";cc._RF.push(t,"90c82XXXqZMX5QDU3GAMG/m","AIIdle"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.obj.flipX=this.define.flipX||-1,this.obj.avatar.setForcedAnime(this.define.anim||"sit",1),this.obj.avatar.refresh(.03,!0,!0),this.obj.avatar.setWalkAnime("run"),this.state="idle",this.radioAI=this.define.radioAI,this.questionTime=this.define.questionTime||5,this.shockTime=this.define.shockTime||.7,this.chatContent=this.define.chatContent,this.chatContent&&(this.chatTime=2,this.chatDelay=this.define.chatDelay||0,this.chatAction=this.define.chatAction)},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());this.chatContent&&(this.chatDelay-=e,this.chatDelay<=0&&(t.callEffect(EFFECT.chatSomething,this.obj.avatar,this.chatContent,this.chatTime),this.chatContent=!1,this.chatAction&&(this.obj.avatar.setForcedAnime(this.chatAction,1),this.obj.avatar.refresh(.03,!0,!0)))),n<1500&&"idle"==this.state&&(this.state="question",this.alertTimer=this.questionTime),"question"==this.state&&(this.alertTimer-=e,this.alertTimer<0&&(this.state="shock")),n<1500&&"shock"==this.state&&(this.obj.avatar.chatSomething&&(this.obj.avatar.chatSomething.destroy(),this.obj.avatar.chatSomething=null),this.state="shock2",this.shock2Timer=this.define.shock2Time||0,t.callEffect(EFFECT.avatarShock,this.obj.avatar,this.shock2Timer)),"shock2"==this.state&&(this.shock2Timer-=e,this.shock2Timer<=0&&(this.obj.avatar.setForcedAnime("shock",1),this.obj.avatar.refresh(.03,!0,!0),this.state="shocking",this.shockTimer=this.shockTime,this.obj.flipX=-1,this.obj.avatar.displayNode.runAction(cc.sequence(cc.moveBy(.1,cc.v2(0,20)),cc.delayTime(this.shockTimer-.2),cc.moveBy(.1,cc.v2(0,-20)))))),"shocking"==this.state&&(this.shockTimer-=e,this.shockTimer<0&&(this.radioAI?this.state="scared":this.state="run")),"scared"==this.state&&(this.obj.avatar.setForcedAnime("scared",1),this.obj.avatar.refresh(.03,!0,!0)),"run"==this.state&&(this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.obj.flipX=1,this.obj.callMove(4,0),this.state++)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AILaobing:[function(e,t){"use strict";cc._RF.push(t,"95b83KYRh9H8aTKekAgfRIP","AILaobing"),cc.Class({extends:e("../core/AIProto"),initAI:function(){var e=this.define;this.attackRange=e.attackRange||500,this.seekRange=this.attackRange,cc.log("initAI",this.attackRange),this.bonusAttackDeg=e.bonusAttackDeg,e.safeRange&&(this.safeRange=e.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.followX=e.followX||0,this.inTimer=0,this.obj.applyVelocity(e.vx||0,e.vy||0),e.inAnime&&(this.obj.avatar.setForcedAnime(e.inAnime,1,0,1),this.obj.avatar.refresh(.03,!0,!0),this.inTimer=1.5)},updateAI:function(e){var t,i,a=this.game,n=a.levelMgr.heroes[a.me],o=this.obj;if(this.inTimer>0)return this.inTimer-=e,this.obj.y-this.obj.height<=this.game.contactMgr.findGroundLine(this.obj.x)&&!this.in2&&(this.in2=!0,this.obj.avatar.setForcedAnime("in2",1,0,1),this.obj.avatar.refresh(0,!0,!0)),void(this.inTimer<=0&&(this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(0,!0,!0)));r&&!r.isDead()||this.seekTargetQuick();var r=this.target;n&&(t=o.getPositionX()-n.getPositionX()+this.followX),r?(i=Math.abs(o.getPositionX()-r.getPositionX()),o.attackDeg=this.aim(r)):o.callAutoAttack(!1),o.moveSpd=n.moveSpd;var s=n.moveScaleX;if(this.isChasing||t<-50){var c=2;t<-100&&(c=3),o.callMove(c*s,0),this.isChasing=!0,t>0&&(this.isChasing=!1)}else null!=i&&i<this.attackRange&&r&&!r.isDead()?(o.flipX=1,o.callAutoAttack(!0),o.callMove(s,0),this.isChasing=!1):(c=1,t>50&&(c=0),o.callMove(c*s,0),this.isChasing=!1);this._super(e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIMosquito:[function(e,t){"use strict";cc._RF.push(t,"6e0b8tlrwtKbpXimAmsV36s","AIMosquito"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.flyMode=this.define.flyMode,this.time=kit.rnd(0,2*Math.PI),this.spdScale=1,this.attackRange=this.define.attackRange+kit.rnd(-150,0),this.spdX=0,this.spdY=0,this.flyDirectionX=1,this.flyDirectionY=0,this.moveTo=this.define.moveTo},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj;this.time+=2*e;var n=i.moveSpd/this.obj.moveSpd;if(this.moveTo){var o=i.getPositionX()+this.moveTo.x,r=i.getPositionY()+this.moveTo.y-a.getPositionY(),s=o-a.getPositionX(),c=c_vector2Radian(r,s);this.flyDirectionX=Math.sin(c)*(s<0&&s>-50?.5:2),this.flyDirectionY=2*Math.cos(c),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),a.callAutoAttack(!1)}else if(Math.abs(a.getPositionX()-i.getPositionX())<this.seekRange){var l=this.target;l&&!l.isDead()||this.seekTargetQuick(),l=this.target,this.attackPhase&&2!=this.attackPhase||!kit.timer(this,"123",2,e)||(this.flyDirectionX=n+3+kit.rndInt(-.4,.4),this.flyDirectionY=kit.rnd(-2,2),this.attackRange=this.define.attackRange+kit.rnd(-150,0)),this.attackPhase&&2!=this.attackPhase||!kit.timer(this,"attack",2,e)||(this.attackPhase=1,this.flyDirectionX=3,this.flyDirectionY=kit.rnd(-.5,0),this.attackRange=this.define.attackRange+kit.rnd(-150,0)),this.obj.attackAction&&1==this.attackPhase&&(this.attackPhase=2,this.flyDirectionX=3,this.flyDirectionY=kit.rnd(-.2,.2),this.attackRange=this.define.attackRange+kit.rnd(-150,0)),a.getPositionX()<i.getPositionX()+(1==this.attackPhase?450:550)&&(this.flyDirectionX=3+n),a.getPositionX()>i.getPositionX()+600&&(this.flyDirectionX=-3+n),a.getPositionY()<t.contactMgr.findGroundLine(a.x)+200&&(this.flyDirectionY=3),a.getPositionY()>600&&(this.flyDirectionY=-3),this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,6*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,6*e);var d=l&&Math.abs(l.x-a.getPositionX());a.isInBorder()&&l&&!l.isDead()&&d<=this.attackRange&&1==this.attackPhase?(a.attackDeg=this.define.attackDeg||c_vector2Degree(l.x-a.getPositionX(),l.y-a.getPositionY()),a.callAutoAttack(!0),a.callMove(this.spdX,this.spdY)):(a.callAutoAttack(!1),a.callMove(this.spdX,this.spdY))}else{var h;h=i.getPositionX()>a.getPositionX()?1:-1,this.spdX=kit.numApproach(this.spdX,2*h+n,2*e),this.spdY=kit.numApproach(this.spdY,0,2*e),a.callMove(this.spdX,this.spdY)}this._super(e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIMyTower:[function(e,t){"use strict";cc._RF.push(t,"5dcc8eRwCJKUL9njcrtAHRL","AIMyTower"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.attackTimer=0,this.attackDeg=0,this.seekTimer=0,this.fixAtkDeg=this.define.fixAtkDeg},updateAI:function(e){var t=this.target;this.seekTimer-=e,(this.seekTimer<=0||!t||t.isDead()||!t.isInBorder())&&(this.seekTarget(),this.seekTimer=1),this.updateAttack(e)},getTargetDegree:function(e,t){var i=this.define.gravity;if(!i)return this._super(e,t);var a=c_parabola2Degree(e,t,i,this.define.spd),n=this.obj;if(1==a.length)return a[0];if(2==a.length){if(this.isDegInRange(n,a[0]))return a[0];if(this.isDegInRange(n,a[1]))return a[1]}},updateAttack:function(e){var t=this.target,i=this.obj,a=!1;if(t&&!t.isDead()&&t.isInBorder()){var n=t.x-i.x+this.offsetX,o=t.y-i.y+this.offsetY,r=i.attackDeg,s=this.define.gravity;if(s){var c=i.bltSpd*this.define.spd,l=c_parabola2Degree(n,o,s,c);if(1==l.length)r=l[0];else if(2==l.length){var d=l[0],h=l[1];r=c_abs(c_includeDegree(d,0))>c_abs(c_includeDegree(h,0))?h:d}}else r=c_vector2Degree(n,o);this.fixAtkDeg&&(r=this.fixAtkDeg),i.callRotate(r),a=!0,this.isDegInRange(i,r)||(this.target=null)}a?(i.callAutoAttack(!0),this.attackTimer=1):(this.attackTimer-=e,!i.mainFlag&&this.attackTimer<=0&&i.callAutoAttack(!1))}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AIProto:[function(e,t){"use strict";cc._RF.push(t,"d9985TRIIVPm5rlr+SC2xx4","AIProto"),cc.Class({extends:e("./Assist"),updateLogic:function(e){this._super(e),this.updateAI(e)},setEnabled:function(e){if(e)this.disabled=!1;else{this.disabled=!0;var t=this.obj;t.callMove(t.deg,0),t.callAutoAttack(!1),t.callRotate()}this.ui&&this.ui.setEnabled(e)},remove:function(){this.ui&&this.ui.onRemove(),this.game.removeUpdate(this)},aim:function(e,t){var i=this.obj;if(i.blt){var a=i.x+i.attackCenter.x,n=i.y+i.attackCenter.y,o=i.blt[0]||i.blt[t.blt],r=this.define.defaultDeg||i.attackDeg;if(this.bonusAttackDeg)r=i.flipX<0?180-this.bonusAttackDeg:this.bonusAttackDeg;else if(o&&o.gravity&&o.gravity<0){var s=e.x-a+2.5*e.getSpdX(),c=e.y-n;c<0&&(s+=-e.getSpdX()*c/200);var l=c_parabola2Degree(s,c,o.gravity,o.spd);if(1==l.length)r=l[0];else if(2==l.length){var d=l[0],h=l[1];r=c_abs(c_includeDegree(d,90))>c_abs(c_includeDegree(h,90))?h:d}}else r=c_vector2Degree(e.x-a,e.y-n);return r}},seekTargetQuick:function(){for(var e,t=this.obj,i=t.x,a=t.y,n=this.game.contactMgr.getContactList(),o=this.seekRange,r=this.seekWidth,s=1/0,c=0;c<n.length;c++){var l=n[c],d=l.getEntity();if(d.isInBorder()&&!l._sensor&&!d.isDead()&&d.team!==t.team){var h=d.x-i+this.offsetX,u=d.y-a+this.offsetY,p=c_sqrt(h*h+u*u)-d.radius;if(r){if(c_abs(h)>r)continue}else if(p>o)continue;(!e||p<s)&&(s=p,e=d)}}this.setTarget(e)}}),cc._RF.pop()},{"./Assist":"Assist"}],AIRocket:[function(e,t){"use strict";cc._RF.push(t,"12576kvi6xODq2ze8MWOsQJ","AIRocket"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.spdScale=this.define.spdScale||1},updateAI:function(e){var t=this.obj,i=t.getDegree()+(t.flipX?180:0),a=kit.degree2Radian(i),n=this.spdScale,o=Math.cos(a)*n,r=Math.sin(a)*n;t.callMove(o,r),this._super(e),this.define.spdScaleAdd&&(this.spdScale+=this.define.spdScaleAdd*e)}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AISimple:[function(e,t){"use strict";cc._RF.push(t,"02c266/MCNDWaIFoEpx1H7E","AISimple"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){var e=this.define;null!=e.moveX?this.moveX=e.moveX:this.moveX=0,this.moveY=e.moveY||0,this.moveTime=e.moveTime,this.moveTimer=0,this.attackTime=e.attackTime,this.attackTimer=0,this.delayTimer=e.delayTime||0,this.attackRange=this.define.attackRange,this.seekRange=this.define.seekRange||this.attackRange,this.bonusAttackDeg=this.define.bonusAttackDeg||0},updateAI:function(e){var t=this.obj;if(this.delayTimer>0)this.delayTimer-=e;else{if(this.attackTime&&(this.attackTimer+=e,this.attackTimer>this.attackTime))if(this.seekRange){var i=this.target;i&&!i.isDead()||this.seekTargetQuick(),i=this.target,t.isInBorder()&&i&&!i.isDead()&&(t.flipX=-1,t.callRotate(this.aim(i)),t.callAutoAttack(!0))}else t.callAutoAttack(!0);this.moveTimer+=e,this.moveTime&&this.moveTimer>this.moveTime?t.callMove(0,0):(t.callMove(this.moveX,this.moveY),this._super(e))}}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AISlime:[function(e,t){"use strict";cc._RF.push(t,"762b8oDAsdDk67D9vQeQDri","AISlime"),cc.Class({extends:e("../core/AICommon"),initAI:function(){this._super(),this.jumpCD=this.define.jumpCD||2,this.jumpCDTimer=this.jumpCD},updateAI:function(e){var t=this.obj;this.jumpCDTimer-=e,t._physic_vy>333&&!this.jump2&&(this.jump2=!0,this.obj.avatar.setForcedAnime("jump2",1,null,1),this.obj.avatar.refresh(.03,!0,!0)),this.jump2&&Math.abs(t._physic_vy)<=333&&!this.jump3&&(this.jump3=!0,this.obj.avatar.setForcedAnime("jump3",1.2,null,1),this.obj.avatar.refresh(.03,!0,!0)),t._physic_vy<-333&&!this.jump4&&(this.jump4=!0,this.obj.avatar.setForcedAnime("jump2_2",1,null,1),this.obj.avatar.refresh(.03,!0,!0),this.obj.updateGround()),this.jump4&&0==t._physic_vy&&!this.jump5&&(this.jump2=!1,this.jump3=!1,this.jump4=!1,this.jump5=!0,this.jump5Timer=.3,this.obj.avatar.setForcedAnime("jump4",1,null,1),this.obj.avatar.refresh(.03,!0,!0)),this.jump5&&(this.jump5Timer-=e,this.jump5Timer<=0&&(this.jump5=!1,this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0))),this.jumpCDTimer<=0&&(this.jumpCDTimer=this.jumpCD,t.applyVelocity(this.obj.moveSpd*t.flipX,1e3)),this._super(e)}}),cc._RF.pop()},{"../core/AICommon":"AICommon"}],AISoldier:[function(e,t){"use strict";cc._RF.push(t,"d92b5RQ5UZH4ZMj+zWYxGy0","AISoldier"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.attackRange=this.define.attackRange||500,this.seekRange=this.attackRange,cc.log("initAI",this.attackRange),this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.runaway=this.define.runaway,this.spdX=kit.rnd(.8,1.4),this.attackTimer=this.define.attackTime},setRunaway:function(){this.obj.avatar.setWalkAnime("run"),this.runningaway=!0},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());if(this.attackTimer&&(this.attackTimer-=e,this.attackTimer<=0&&(this.attackTimer=null)),!a.attachedSlot&&this.safeRange&&(-1==a.flipX&&n<this.safeRange||1==a.flipX&&n<this.attackRange)||this.runningaway)a.callMove(2*this.spdX,0),a.callAutoAttack(!1),this.runaway&&!this.runningaway&&this.setRunaway();else if(n<this.attackRange){var o=this.target;o&&!o.isDead()||this.seekTargetQuick(),o=this.target,a.isInBorder()&&o&&!o.isDead()?(a.flipX=-1,a.attackDeg=this.aim(o),this.attackTimer||a.callAutoAttack(!0),a.callMove(0,0)):(a.callAutoAttack(!1),a.attackDeg=180,a.callMove(-1*this.spdX,0))}else a.callMove(-1*this.spdX,0),this.obj.attackDeg=180;this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AISpider:[function(e,t){"use strict";cc._RF.push(t,"6531fuHziBPsYr7WX6F53pj","AISpider"),cc.Class({extends:e("../core/AIProto"),initAI:function(){this.attackRange=this.define.attackRange&&kit.rnd(this.define.attackRange[0],this.define.attackRange[1])||500,cc.log("initAI",this.attackRange),this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.activateRange=this.define.activateRange,this.activate=!this.activateRange,this.activate||(this.obj.avatar.setForcedAnime("stand2",1),this.obj.avatar.refresh(.03,!0,!0),this.obj.attribute.add("hurtScale",-1)),this.spdX=this.define.vx||1,this.lifeTimer=this.define.lt,this.define.atkSpd&&this.obj.attribute.mutScale("atkSpd",this.define.atkSpd)},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());if(!this.activate&&!this.activateTimer&&n<this.activateRange&&(this.activateTimer=1,this.obj.avatar.setForcedAnime("skill",1,0,1),this.obj.avatar.refresh(.03,!0,!0),this.obj.attribute.add("hurtScale",1),this.obj.game.effectMgr.playEffect("sound/mob/spider/skill"),this.obj.game.effectMgr.playEffect("sound/mob/spider/skill2")),this.activateTimer&&(this.activateTimer-=e,this.activateTimer<0&&(this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.activate=!0,this.activateTimer=null)),this.activate){if(this.lifeTimer&&(this.lifeTimer-=e),null==this.lifeTimer||this.lifeTimer>0)if(this.safeRange&&(a.getPositionX()<i.getPositionX()||a.moveScaleX>0&&n<this.attackRange||a.moveScaleX<=0&&n<this.safeRange)){var o=this.spdX;a.getPositionX()<i.getPositionX()&&(o*=1.5),a.callMove(o,0),a.callAutoAttack(!1)}else if(n<this.attackRange){var r=this.target;r&&!r.isDead()||this.seekTargetQuick(),1==a.flipX&&(this.attackRange=this.define.attackRange&&kit.rnd(this.define.attackRange[0],this.define.attackRange[1])||500),r=this.target,a.isInBorder()&&r&&!r.isDead()?(a.attackDeg=-90,this.bonusAttackDeg&&(a.attackDeg+=this.bonusAttackDeg*a.flipX),a.callAutoAttack(!0),a.callMove(0,0)):(a.callAutoAttack(!1),this.obj.attackDeg=180,a.callMove(-this.spdX,0))}else a.callMove(-1,0),this.obj.attackDeg=180;else a.callMove(-1,0),this.obj.attackDeg=180;this._super(e)}}}),cc._RF.pop()},{"../core/AIProto":"AIProto"}],AISubmarineBoss:[function(e,t){"use strict";cc._RF.push(t,"0b209fp3dVPLKnVY1yLWw72","AISubmarineBoss"),cc.Class({extends:e("../movement/AIChaseCar"),initAI:function(){this._super(),this.obj.setFlag(NO_GROUND,!0),this.obj.fly=!0,this.oz=this.obj.avatar.node.zIndex,this.obj.avatar.node.parent=null,this.game.layer.addToTop(this.obj.avatar.node),this.leftChaseK=1,this.rightChaseK=.1},updateAI:function(e){this._super(e)}}),cc._RF.pop()},{"../movement/AIChaseCar":"AIChaseCar"}],AITank2:[function(e,t){"use strict";cc._RF.push(t,"c6d27oTghFFP6HR6gNYkzBp","AITank2"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.attackRange=this.define.attackRange||500,this.seekRange=this.attackRange,cc.log("initAI",this.attackRange),this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack,this.spdX=0,this.spdY=0,this.flyDirectionX=-1,this.flyDirectionY=0,this.spdScale=0,this.spdUpTimer=.1},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());if(this.spdUpTimer-=e,this.spdUpTimer<0&&(this.spdScale=1),n<this.attackRange){var o=this.target;o&&!o.isDead()||this.seekTargetQuick(),o=this.target,a.isInBorder()&&o&&!o.isDead()?(a.attackDeg=this.aim(o),a.callAutoAttack(!0),this.moveAttack&&(!this.moveAttackMinRange||n>this.moveAttackMinRange)?this.flyDirectionX=-1*this.spdScale:this.flyDirectionX=0):(a.callAutoAttack(!1),this.obj.attackDeg=180)}else this.flyDirectionX=-1*this.spdScale,this.obj.attackDeg=180;this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AITank:[function(e,t){"use strict";cc._RF.push(t,"84939a6RQNAT6Fr+V0ybTTM","AITank"),cc.Class({extends:e("../../core/AIProto"),initAI:function(){this.attackRange=this.define.attackRange||500,this.seekRange=this.attackRange,cc.log("initAI",this.attackRange),this.bonusAttackDeg=this.define.bonusAttackDeg,this.define.safeRange&&(this.safeRange=this.define.safeRange,this.safeRange=kit.rnd(this.safeRange[0],this.safeRange[1])),this.moveAttackMinRange=this.define.moveAttackMinRange,this.moveAttack=this.define.moveAttack,this.spdX=0,this.spdY=0,this.flyDirectionX=-1,this.flyDirectionY=0,this.hitRunTimer=this.define.hitRunTime||12},updateAI:function(e){var t=this.game,i=t.levelMgr.heroes[t.me],a=this.obj,n=Math.abs(a.getPositionX()-i.getPositionX());if(this.hitRunTimer-=e,this.hitRunTimer>0&&this.safeRange&&(-1==a.flipX&&n<this.safeRange||1==a.flipX&&(this.moveAttackMinRange?n<this.moveAttackMinRange:n<this.attackRange)))this.flyDirectionX=2,this.moveAttack||a.callAutoAttack(!1);else if(n<this.attackRange){var o=this.target;o&&!o.isDead()||this.seekTargetQuick(),o=this.target,a.isInBorder()&&o&&!o.isDead()?(a.callRotate(this.aim(o)),a.callAutoAttack(!0),this.moveAttack&&(!this.moveAttackMinRange||n>this.moveAttackMinRange)||this.hitRunTimer<=0?(this.flyDirectionX=-1,this.hitRunTimer<=0&&(this.flyDirectionX=-2)):this.flyDirectionX=0):a.callAutoAttack(!1)}else this.flyDirectionX=-1;this.spdX=kit.numApproach(this.spdX,this.flyDirectionX,3*e),this.spdY=kit.numApproach(this.spdY,this.flyDirectionY,3*e),a.callMove(this.spdX,this.spdY),this._super(e)}}),cc._RF.pop()},{"../../core/AIProto":"AIProto"}],AITurtleBoss:[function(e,t){"use strict";cc._RF.push(t,"12c9bQzpClHY6eukm1SEH0T","AITurtleBoss"),cc.Class({extends:e("../../core/AICommon"),initAI:function(){this._super(),this.defModeHp=this.define.defModeHp||[.75,.5,.25],this.defModeIndex=0,this.defModeTime=8},updateAI:function(e){var t=this.obj;return t.hp/t.hpMax<=this.defModeHp[this.defModeIndex]&&(this.defModeIndex++,this.defModeTimer||(this.obj.avatar.setForcedAnime("def",1,null,1),this.obj.avatar.refresh(.03,!0,!0),this.obj.attribute.add("hurtScale",-1),this.obj.callMove(0,0)),this.defModeTimer=this.defModeTime,this.obj.attackSequence=this.obj.define.attackSequence2,this.obj.attackIndex=0),this.recoverTimer>0?(this.recoverTimer-=e,void(this.recoverTimer<=0&&(this.recoverTimer=0,this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.obj.callMove(this.obj.flipX,0),this.obj.attackSequence=this.obj.define.attackSequence,this.obj.attackIndex=0))):this.defModeTimer>0?(this.defModeTimer-=e,void(this.defModeTimer<=0&&(this.defModeTimer=0,this.obj.attribute.add("hurtScale",1),this.obj.avatar.setForcedAnime("def",-1,null,1),this.obj.avatar.refresh(.03,!0,!0),this.recoverTimer=.5))):void this._super(e)}}),cc._RF.pop()},{"../../core/AICommon":"AICommon"}],AITurtle:[function(e,t){"use strict";cc._RF.push(t,"bb0b6JWVsFF25Bcc5fHjhAN","AITurtle"),cc.Class({extends:e("../core/AICommon"),initAI:function(){this._super(),this.defModeHp=this.define.defModeHp||[.5],this.defModeIndex=0,this.defModeTime=3},updateAI:function(e){var t=this.obj;return t.hp/t.hpMax<=this.defModeHp[this.defModeIndex]&&(this.defModeIndex++,this.defModeTimer||(this.obj.avatar.setForcedAnime("def",1,null,1),this.obj.avatar.refresh(.03,!0,!0),this.obj.setFlag(NO_ATTACK,!0),this.obj.attribute.add("hurtScale",-1),this.obj.callMove(0,0)),this.defModeTimer=this.defModeTime),this.recoverTimer>0?(this.recoverTimer-=e,void(this.recoverTimer<=0&&(this.recoverTimer=0,this.obj.avatar.setForcedAnime(),this.obj.avatar.refresh(.03,!0,!0),this.obj.setFlag(NO_ATTACK,!1),this.obj.callMove(this.obj.flipX,0)))):this.defModeTimer>0?(this.defModeTimer-=e,void(this.defModeTimer<=0&&(this.defModeTimer=0,this.obj.attribute.add("hurtScale",1),this.obj.avatar.setForcedAnime("def",-1,null,1),this.obj.avatar.refresh(.03,!0,!0),this.recoverTimer=.5))):void this._super(e)}}),cc._RF.pop()},{"../core/AICommon":"AICommon"}],AddBuffOnShot:[function(e,t){"use strict";cc._RF.push(t,"3c66c73LndK+JIHQd49lZzY","AddBuffOnShot"),cc.Class({extends:e("../components/combat/buffs/Buff"),cover:function(){},begin:function(){var e=this.define;this.shotBuff=e.shotBuff;var t=this.obj;this.game.eventMgr.regist(t,"shotEvent",this,this.shotEvent)},shotEvent:function(){this.obj.addBuff(this,this.shotBuff)},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"shotEvent",this)}}),cc._RF.pop()},{"../components/combat/buffs/Buff":"Buff"}],Analytic:[function(e,t,i){"use strict";cc._RF.push(t,"dd0157hpelCGIPzQes602Ad","Analytic"),Object.defineProperty(i,"__esModule",{value:!0}),i.getAnalyticPlatform=void 0,i.getAnalyticPlatform=function(){return new a};var a=function(){function e(){}return e.prototype.log=function(){},e}();cc._RF.pop()},{}],AnimUtils:[function(e,t){"use strict";cc._RF.push(t,"05f4bwrigJGn4hikuxTdKTn","AnimUtils");var i={showHandSuggestion:function(e,t,i){var a=void 0!==(i=i||{}).offsetX?i.offsetX:10,n=void 0!==i.offsetY?i.offsetY:0,o=void 0!==i.duration?i.duration:6,r=void 0!==i.moveDistance?i.moveDistance:20,s=void 0!==i.moveSpeed?i.moveSpeed:.5,c=void 0!==i.syncPosition&&i.syncPosition,l={handNode:null};return e&&e.active?(cc.resources.load("prefab/hand_finger",cc.Prefab,function(i,d){if(i)console.error("[AnimUtils] Failed to load hand_finger prefab:",i);else if(d){var h=cc.instantiate(d);l.handNode=h;var u=e.convertToWorldSpaceAR(cc.v2(a,n)),p=t.convertToNodeSpaceAR(u);if(h.setPosition(p),t.addChild(h),h.runAction(cc.repeatForever(cc.sequence(cc.moveBy(s,cc.v2(0,-r)),cc.moveBy(s,cc.v2(0,r))))),c){var f=cc.Class({extends:cc.Component,update:function(){if(e&&cc.isValid(e)&&e.active){var i=e.convertToWorldSpaceAR(cc.v2(a,n)),o=t.convertToNodeSpaceAR(i);h.setPosition(o)}}});h.addComponent(f)}h.runAction(cc.sequence(cc.delayTime(o),cc.callFunc(function(){h&&h.isValid&&(h.destroy(),l.handNode=null)})))}else console.error("[AnimUtils] Prefab is null")}),l):(console.warn("[AnimUtils] Target button not available or not active"),l)},pulseScale:function(e,t,i,a){if(e){t=t||1.2,i=i||.3,a=void 0!==a?a:-1,e.stopAllActions();var n=cc.sequence(cc.scaleTo(i,t),cc.scaleTo(i,1));-1===a?e.runAction(cc.repeatForever(n)):e.runAction(cc.repeat(n,a))}},bounce:function(e,t,i){e&&(t=t||20,i=i||.5,e.stopAllActions(),e.runAction(cc.repeatForever(cc.sequence(cc.moveBy(i,cc.v2(0,t)),cc.moveBy(i,cc.v2(0,-t))))))},fadeIn:function(e,t,i){if(e){t=t||.3,e.opacity=0;var a=cc.fadeIn(t);i?e.runAction(cc.sequence(a,cc.callFunc(i))):e.runAction(a)}},fadeOut:function(e,t,i){if(e){t=t||.3;var a=cc.fadeOut(t);i?e.runAction(cc.sequence(a,cc.callFunc(i))):e.runAction(a)}},stopAll:function(e,t){e&&(t=void 0===t||t,e.stopAllActions(),t&&(e.scale=1))},createEquipmentToSlotPointer:function(e,t,i,a){var n=void 0!==(a=a||{}).offsetX?a.offsetX:30,o=void 0!==a.offsetY?a.offsetY:0,r=void 0!==a.moveDuration?a.moveDuration:1,s=void 0!==a.fadeOutDuration?a.fadeOutDuration:.4,c=void 0!==a.delayBefore?a.delayBefore:.2;if(!e||!t||!i)return console.error("[AnimUtils] Missing required nodes for equipment pointer"),null;var l=null;return cc.resources.load("prefab/hand_finger",cc.Prefab,function(a,d){if(a)console.error("[AnimUtils] Failed to load hand_finger prefab:",a);else if(d){l=cc.instantiate(d),i.addChild(l,9999);var h=e.convertToWorldSpaceAR(cc.v2(n,o)),u=i.convertToNodeSpaceAR(h),p=t.convertToWorldSpaceAR(cc.v2(0,0)),f=i.convertToNodeSpaceAR(p);f.x=p.x,l.setPosition(u),l.opacity=255;var m=l.getComponent(cc.Animation),g=null;m&&m.getClips().length>=2&&(g=m.getClips()[1],m.play(g.name)),cc.tween(l).delay(c).to(r,{position:f},{easing:"sineInOut"}).to(s,{opacity:0},{easing:"sineOut"}).call(function(){l.setPosition(u),l.opacity=255,g&&m&&m.play(g.name)}).delay(c).union().repeatForever().start()}else console.error("[AnimUtils] Prefab is null")}),l},createFingerPointer:function(e,t){var i=void 0!==(t=t||{}).offsetX?t.offsetX:50,a=void 0!==t.offsetY?t.offsetY:-30;if(!e)return console.error("[AnimUtils] Target button is null"),null;var n=null;return cc.resources.load("prefab/hand_finger",cc.Prefab,function(t,o){t?console.error("[AnimUtils] Failed to load hand_finger prefab:",t):(n=cc.instantiate(o),e.addChild(n,9999),n.setPosition(cc.v2(i,a)))}),n}};t.exports=i,cc._RF.pop()},{}],ApiClientPromise:[function(e,t){"use strict";cc._RF.push(t,"5a83ds9qd5Ou6Gw6hkSBYbs","ApiClientPromise");var i=e("./ApiClient"),a={activeRequests:new Map,DEFAULT_TIMEOUT:1e4,createCancellablePromise:function(e){var t=!1,i=null;return{promise:new Promise(function(a,n){i=n,e(function(e){t||a(e)},function(e){t||n(e)})}),cancel:function(){t=!0,i&&i(new Error("Request cancelled"))}}},get:function(e,t,a){var n=(a=a||{}).timeout||this.DEFAULT_TIMEOUT,o=a.retries||0,r=Date.now()+"_"+Math.random();cc.sys.isNative&&e&&e.includes("/leaderboards")&&((t=t||{})._t=Date.now(),console.log("[ApiClientPromise] Added cache buster for native leaderboard request"));var s=this;return console.log("[ApiClientPromise] Request GET",e,t,a),function a(c){var l=s.createCancellablePromise(function(l,d){var h=null,u=!1;n>0&&(h=setTimeout(function(){u||(u=!0,console.warn("[ApiClientPromise] Request timeout:",e),s.cancelRequest(r),c>0?(console.log("[ApiClientPromise] Retrying request, attempts left:",c),a(c-1).then(l).catch(d)):d(new Error("Request timeout after "+(o+1)+" attempts")))},n)),i.get(e,t,function(t,i){u||(u=!0,h&&clearTimeout(h),s.activeRequests.delete(r),t?c>0&&(t.includes("Network")||t.includes("timeout"))?(console.log("[ApiClientPromise] Network error, retrying. Attempts left:",c),a(c-1).then(l).catch(d)):d(t):null==i?(console.warn("[ApiClientPromise] Received null/undefined response from:",e),c>0?(console.log("[ApiClientPromise] Retrying due to null response. Attempts left:",c),setTimeout(function(){a(c-1).then(l).catch(d)},500)):l({leaderboard:[],player_rank:null,total_players:0})):l(i))})});return s.activeRequests.set(r,l),l.promise}(o)},post:function(e,t,a){var n=(a=a||{}).timeout||this.DEFAULT_TIMEOUT,o=a.retries||0,r=Date.now()+"_"+Math.random(),s=this;return console.log("[ApiClientPromise] Request POST",e,t,a),function a(c){var l=s.createCancellablePromise(function(l,d){var h=null,u=!1;n>0&&(h=setTimeout(function(){u||(u=!0,console.warn("[ApiClientPromise] Request timeout:",e),s.cancelRequest(r),c>0?(console.log("[ApiClientPromise] Retrying request, attempts left:",c),a(c-1).then(l).catch(d)):d(new Error("Request timeout after "+(o+1)+" attempts")))},n)),i.post(e,t,function(t,i){u||(u=!0,h&&clearTimeout(h),s.activeRequests.delete(r),t?c>0&&(t.includes("Network")||t.includes("timeout"))?(console.log("[ApiClientPromise] Network error, retrying. Attempts left:",c),a(c-1).then(l).catch(d)):d(t):null==i?(console.warn("[ApiClientPromise] POST received null/undefined response from:",e),c>0?(console.log("[ApiClientPromise] POST retrying due to null response. Attempts left:",c),setTimeout(function(){a(c-1).then(l).catch(d)},500)):l({})):l(i))})});return s.activeRequests.set(r,l),l.promise}(o)},cancelRequest:function(e){var t=this.activeRequests.get(e);t&&(t.cancel(),this.activeRequests.delete(e))},cancelAllRequests:function(){this.activeRequests.forEach(function(e){e.cancel()}),this.activeRequests.clear()},fetch:function(e,t){return"POST"===(t=t||{}).method||"PUT"===t.method?this.post(e,t.body||{},t):this.get(e,t.params||{},t)},fetchAll:function(e){var t=e.map(function(e){return this.get(e.endpoint,e.params||{},e.options||{}).catch(function(t){return{error:t,endpoint:e.endpoint}})},this);return Promise.all(t)},fetchRace:function(e){var t=e.map(function(e){return this.get(e.endpoint,e.params||{},e.options||{})},this);return Promise.race(t)}};t.exports=a,cc._RF.pop()},{"./ApiClient":"ApiClient"}],ApiClient:[function(e,t){"use strict";cc._RF.push(t,"6b8c6x8tsBIH5yPd9AX2ce3","ApiClient");var i=e("./net"),a=e("../security/pako"),n={config:{timeout:1e4,retryAttempts:3,retryDelay:1e3},requestCounter:0,getBaseUrl:function(){return(window.NGINX?"https://":"http://")+window.DATA_HOST},getToken:function(){if(window.net&&window.net.token){if(cc.sys.isNative){var e=window.net.token?window.net.token.substring(0,30)+"...":"null";console.log("[ApiClient] Using window.net.token:",e)}return window.net.token}return i&&i.token?(cc.sys.isNative&&(e=i.token?i.token.substring(0,30)+"...":"null",console.log("[ApiClient] Using net.token:",e)),i.token):(cc.sys.isNative&&console.log("[ApiClient] No token available"),null)},decryptResponse:function(e){try{try{var t=JSON.parse(e);if(t&&"object"==typeof t)return cc.sys.isNative&&(console.log("[ApiClient] Response is plain JSON (likely an error response)"),t.error)?(console.log("[ApiClient] Server error:",t.error),{leaderboard:[],player_rank:null,total_players:0,error:t.error}):t}catch(m){}if(e.charCodeAt(0)>255)return this.decryptNewFormat(e);var i=e.charCodeAt(0);if(cc.sys.isNative){console.log("[ApiClient] Decryption attempt - Key byte:",i,"Data length:",e.length);for(var n=!1,o=0;o<Math.min(20,e.length);o++)if(65533===e.charCodeAt(o)){n=!0;break}if(n)return console.log("[ApiClient] WARNING: Response contains UTF-8 replacement characters - binary data may be corrupted"),{leaderboard:[],player_rank:null,total_players:0,error:"Response corrupted"}}for(var r=[function(){for(var t=[],a=1;a<e.length;a++)t.push(e.charCodeAt(a)^i);return t},function(){for(var t=[],a=1;a<e.length;a++){var n=e.charCodeAt(a);n>=128&&n<=159&&(n=n+64&255),t.push(n^i)}return t},function(){var t=[];try{for(var a=1;a<e.length;a++){var n=e.charCodeAt(a);65533!==n&&(n>=128&&n>=128&&n<=159&&(n&=127),t.push(n^i))}}catch(o){for(a=1;a<e.length;a++)t.push(e.charCodeAt(a)^i)}return t}],s=null,c=0;c<r.length;c++)try{var l,d=r[c]();if(!d||0===d.length)continue;cc.sys.isNative&&c>0&&console.log("[ApiClient] Trying decryption method",c+1);try{l=a.inflate(new Uint8Array(d),{to:"string"})}catch(g){throw cc.sys.isNative&&0===c&&console.log("[ApiClient] Pako inflate failed for method",c+1,"- error:",g.message||g),g}var h=JSON.parse(l);return cc.sys.isNative&&(console.log("[ApiClient] Successfully decrypted with method",c+1),h&&h.leaderboard&&console.log("[ApiClient] Leaderboard entries:",h.leaderboard.length)),h}catch(v){s=v}throw s||new Error("All decryption methods failed")}catch(v){if(cc.warn("[ApiClient] Decryption failed:",v),cc.warn("[ApiClient] Error details:",v.message||v),cc.sys.isNative){if(console.log("[ApiClient] Failed to decrypt data of length:",e?e.length:0),e&&e.length<200&&"{"===e[0])try{var u=JSON.parse(e);if(u&&u.error)return console.log("[ApiClient] Found unencrypted error response:",u.error),{leaderboard:[],player_rank:null,total_players:0,error:u.error}}catch(y){}if(e&&e.length>0){var p=[];for(o=0;o<Math.min(10,e.length);o++)p.push(e.charCodeAt(o));console.log("[ApiClient] First 10 char codes:",p);var f=e.substring(0,Math.min(50,e.length));console.log("[ApiClient] Response preview as text:",f)}}return"null"===e||'""'===e||"''"===e?null:(cc.sys.isNative&&console.log("[ApiClient] Returning empty leaderboard structure due to decryption failure"),{leaderboard:[],player_rank:null,total_players:0,error:"Decryption failed"})}},decryptNewFormat:function(e){try{var t=e.charCodeAt(0),i=t^e.length+1,n=[120,156];(cc.sys.isNative||cc.sys.isBrowser)&&console.log("[ApiClient] Decrypting new format - Key:",t,"Length:",e.length,"XorKey:",i);for(var o=1;o<e.length;o++){var r=255&(e.charCodeAt(o)^255&(i^o+1));n.push(r)}var s=a.inflate(new Uint8Array(n),{to:"string"}),c=JSON.parse(s);return cc.sys.isNative&&(console.log("[ApiClient] Successfully decrypted new format (Unicode > 255)"),c&&c.leaderboard&&console.log("[ApiClient] Leaderboard entries:",c.leaderboard.length)),c}catch(l){return cc.warn("[ApiClient] New format decryption failed:",l),{leaderboard:[],player_rank:null,total_players:0,error:"Decryption failed"}}},encryptData:function(e){try{for(var t=JSON.stringify(e),i=a.deflate(t),n=Math.floor(256*Math.random()),o=String.fromCharCode(n),r=0;r<i.length;r++)o+=String.fromCharCode(i[r]^n);return o}catch(s){return cc.warn("[ApiClient] Encryption failed:",s),JSON.stringify(e)}},request:function(e,t){var i=this;this.requestCounter++;var a=this.requestCounter;if(e.endpoint){cc.sys.isNative&&console.log("[ApiClient] Starting request #"+a+" to "+e.endpoint);var n=this.getToken(),o=this.getBaseUrl()+e.endpoint,r=e.method||"GET",s=e.endpoint&&e.endpoint.includes("/leaderboards")&&"GET"===r;if(cc.sys.isNative&&(console.log("[ApiClient] Request to:",e.endpoint),console.log("[ApiClient] Full URL:",o),console.log("[ApiClient] Method:",r),console.log("[ApiClient] Token available:",!!n),n&&console.log("[ApiClient] Token preview:",n.substring(0,20)+"..."),console.log("[ApiClient] Is leaderboard GET:",s)),!n&&!1!==e.requireAuth&&!s)return cc.warn("[ApiClient] No authentication token available"),void t("No authentication token",null);var c=e.timeout||this.config.timeout,l=e.data||{};if(n&&("GET"===r||(l.token=n)),"GET"===r&&e.params){var d=-1===o.indexOf("?");for(var h in e.params)("token"!==h||n)&&(o+=(d?"?":"&")+h+"="+encodeURIComponent(e.params[h]),d=!1);!n||e.params&&e.params.token||(o+=(-1===o.indexOf("?")?"?":"&")+"token="+n)}else"GET"===r&&n&&(o+=(-1===o.indexOf("?")?"?":"&")+"token="+n);cc.sys.isNative&&"GET"===r&&e.endpoint&&e.endpoint.includes("/leaderboards")&&console.log("[ApiClient] Final GET URL:",o);var u=new XMLHttpRequest;if(u.open(r,o,!0),u.timeout=c,cc.sys.isNative&&e.endpoint&&e.endpoint.includes("/leaderboards")&&console.log("[ApiClient] Native request setup for leaderboard endpoint"),"GET"!==r&&u.setRequestHeader("Content-Type","application/json"),e.headers)for(var p in e.headers)u.setRequestHeader(p,e.headers[p]);u.onreadystatechange=function(){4===u.readyState&&i.handleResponse(u,e,t)},u.ontimeout=function(){cc.error("[ApiClient] Request timeout:",e.endpoint),t("Request timeout",null)},u.onerror=function(){cc.error("[ApiClient] Network error:",e.endpoint),t("Network error",null)};try{if("GET"===r)u.send();else{var f=e.encrypt?this.encryptData(l):JSON.stringify(l);u.send(f)}}catch(m){cc.error("[ApiClient] Failed to send request:",m),t("Failed to send request",null)}}else t("Endpoint is required",null)},handleResponse:function(e,t,i){if(200===e.status)try{var a=e.responseText,n=null;if(cc.sys.isNative&&t.endpoint&&t.endpoint.includes("/leaderboards")&&(console.log("[ApiClient] Response for",t.endpoint,"length:",a?a.length:0),a&&a.length>0)){var o=a.length>100?a.substring(0,100)+"...":a;console.log("[ApiClient] Response preview:",o)}if("null"===a||"undefined"===a||""===a)console.warn("[ApiClient] Server returned literal null/undefined/empty string for:",t.endpoint),t.endpoint&&t.endpoint.includes("/leaderboards")?(n={leaderboard:[],player_rank:null,total_players:0},console.log("[ApiClient] Returning empty leaderboard structure instead of null")):n=null;else try{n=JSON.parse(a),cc.sys.isNative&&t.endpoint&&t.endpoint.includes("/leaderboards")&&console.log("[ApiClient] Successfully parsed as JSON")}catch(r){n=!1!==t.decrypt?this.decryptResponse(a):a}cc.sys.isNative&&t.endpoint&&t.endpoint.includes("/leaderboards")&&n&&(n.leaderboard&&(console.log("[ApiClient] Decrypted - leaderboard length:",n.leaderboard.length),n.leaderboard.length>0&&console.log("[ApiClient] First entry:",JSON.stringify(n.leaderboard[0]))),n.player_rank&&console.log("[ApiClient] Player rank info exists")),n&&"object"==typeof n?!1===n.success?i(n.error||"Request failed",null):n.error?i(n.error,null):n.retcode&&0!==n.retcode?i(n.retdesc||"Server error",null):n.data?i(null,n.data):i(null,n):(cc.sys.isNative&&null===n&&console.warn("[ApiClient] About to return null responseData for:",t.endpoint),i(null,n))}catch(r){cc.error("[ApiClient] Error processing response:",r),cc.error("[ApiClient] Error stack:",r.stack),cc.error("[ApiClient] Response that caused error:",e.responseText?e.responseText.substring(0,200):"empty"),i("Error processing response",null)}else 401===e.status?i("Unauthorized - Please login again",null):404===e.status?i("Endpoint not found",null):429===e.status?i("Too many requests - Please wait",null):500===e.status?i("Server error",null):i("Request failed: "+e.status,null)},get:function(e,t,i){"function"==typeof t&&(i=t,t=null),this.request({endpoint:e,method:"GET",params:t},i)},post:function(e,t,i){this.request({endpoint:e,method:"POST",data:t},i)},put:function(e,t,i){this.request({endpoint:e,method:"PUT",data:t},i)},delete:function(e,t,i){"function"==typeof t&&(i=t,t=null),this.request({endpoint:e,method:"DELETE",params:t},i)},requestWithRetry:function(e,t,i){var a=this;i=i||0,this.request(e,function(n,o){n&&i<a.config.retryAttempts?(cc.warn("[ApiClient] Retrying request, attempt:",i+1),setTimeout(function(){a.requestWithRetry(e,t,i+1)},a.config.retryDelay*(i+1))):t(n,o)})},batchRequest:function(e,t){var i=[],a=[],n=0,o=e.length;0!==o?e.forEach(function(e,r){this.request(e,function(e,s){n++,e?(a[r]=e,i[r]=null):(a[r]=null,i[r]=s),n===o&&t(a,i)})}.bind(this)):t([],[])},cache:{},cachedRequest:function(e,t,i){var a=e.method+":"+e.endpoint+":"+JSON.stringify(e.params||{}),n=this.cache[a];if(n&&n.timestamp+t>Date.now())i(null,n.data);else{var o=this;this.request(e,function(e,t){!e&&t&&(o.cache[a]={data:t,timestamp:Date.now()}),i(e,t)})}},clearCache:function(e){if(e)for(var t in this.cache)-1!==t.indexOf(e)&&delete this.cache[t];else this.cache={}},uploadFile:function(e,t,i,a){var n=new FormData;n.append("file",t);var o=this.getToken();if(o&&n.append("token",o),i)for(var r in i)n.append(r,i[r]);var s=new XMLHttpRequest,c=this.getBaseUrl()+e;s.open("POST",c,!0),s.timeout=3e4,s.onreadystatechange=function(){4===s.readyState&&this.handleResponse(s,{endpoint:e},a)}.bind(this),s.onerror=function(){a("Upload failed",null)},s.send(n)}};t.exports=n,window.ApiClient=n,cc._RF.pop()},{"../security/pako":"pako","./net":"net"}],ApiEndpoints:[function(e,t){"use strict";cc._RF.push(t,"d6fd1WXHfdJS50oegD634zI","ApiEndpoints");var i={LEADERBOARD_BASE:"/api/leaderboards",leaderboard:{mainStory:{get:"/api/leaderboards/main-story",update:"/api/leaderboards/main-story"},minigames:{bulletFly:{get:"/api/leaderboards/minigames/bullet-fly",update:"/api/leaderboards/minigames/bullet-fly"},shootTarget:{get:"/api/leaderboards/minigames/shoot-target",update:"/api/leaderboards/minigames/shoot-target"},makeChoice:{get:"/api/leaderboards/minigames/make-choice",update:"/api/leaderboards/minigames/make-choice"},all:"/api/leaderboards/minigames"},timer:"/api/leaderboards/timer"},player:{login:"/dat?m=login",updateData:"/dat?m=updateData",getData:"/dat?m=getData",syncProgress:"/dat?m=syncProgress"},weeklyRewards:{checkUnclaimed:"/api/weekly-rewards/check",claimReward:"/api/weekly-rewards/claim",getTimer:"/api/weekly-rewards/timer",getConfig:"/api/weekly-rewards/config",getTopPlayers:"/api/weekly-rewards/top-players",getCurrentWeek:"/api/weekly-rewards/check",getRewardTiers:"/api/weekly-rewards/config"},shop:{items:"/api/shop/items",purchase:"/api/shop/purchase"},settings:{get:"/api/settings",update:"/api/settings"},getLeaderboardEndpoint:function(e,t){switch(t=t||"update",e){case"mainStory":case"main-story":return this.leaderboard.mainStory[t]||this.leaderboard.mainStory.update;case"bulletFly":case"bullet-fly":case"ballMode":return this.leaderboard.minigames.bulletFly[t]||this.leaderboard.minigames.bulletFly.update;case"shootTarget":case"shoot-target":case"gunnerMode":return this.leaderboard.minigames.shootTarget[t]||this.leaderboard.minigames.shootTarget.update;case"makeChoice":case"make-choice":return this.leaderboard.minigames.makeChoice[t]||this.leaderboard.minigames.makeChoice.update;default:return cc.warn("[ApiEndpoints] Unknown leaderboard type:",e),null}},buildUrl:function(e,t){if(!t||0===Object.keys(t).length)return e;var i=Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&");return e+(-1===e.indexOf("?")?"?":"&")+i}};t.exports=i,window.ApiEndpoints=i,cc._RF.pop()},{}],AreaPoint:[function(e,t){"use strict";cc._RF.push(t,"9e189NXmatP4Jq7u8plu0nW","AreaPoint");var i=function(){this.runAction(cc.sequence(cc.spawn(cc.scaleTo(.7,2),cc.fadeTo(.4,255)),cc.spawn(cc.scaleTo(.4,1.8),cc.fadeTo(.7,55))).repeatForever())},a=function(e,t,a,n){var o=e.effectMgr.createSprite(0,-15-65*a,"ui/point");t.addChild(o),o.scale=2,o.runAction(cc.sequence(cc.delayTime(n),cc.callFunc(i,o)))};cc.Class({extends:cc.Component,init:function(e,t){this.cond=t,this.game=e;var i=new cc.Node;e.layer.addToCamera(i,ZORDER.NORMAL),this.arrow=i,a(e,i,1,.5),a(e,i,2,.3),a(e,i,3,.1);var n=t.v;this.left=n[1],this.right=n[2],this.top=n[3],this.bottom=n[4];var o=e.contactMgr,r=this.left||o.left,s=this.right||o.right,c=this.top||o.top,l=this.bottom||o.bottom,d=(r+s)/2,h=(c+l)/2,u=s-r,p=c-l,f=e.effectMgr.createSprite(0,0,"ui/area",[25,25,25,25]);this.node.addChild(f,0),f.scale=1,f.width=(u+10)/f.scale,f.height=(p+10)/f.scale,f.runAction(cc.sequence(cc.fadeTo(.5,100),cc.fadeTo(.5,255)).repeatForever());var m=this.node;m.setPosition(d,h),m.opacity=0,m.runAction(cc.fadeIn(.2)),this.opacity=0},remove:function(){this.removed=!0;var e=this.node;e.stopAllActions(),e.runAction(cc.sequence(cc.fadeOut(.2),cc.destroySelf()))},update:function(e){if(!this.removed){var t=this.arrow,i=this.node.x,a=this.node.y,n=this.game.layer.camera,o=n.node.x,r=n.node.y,s=n.scale,c=.5*cc.winSize.width/s,l=.5*cc.winSize.height/s,d=o-c,h=o+c,u=r-l,p=r+l,f=this.game.contactMgr,m=this.left||f.left,g=this.right||f.right,v=this.top||f.top,y=this.bottom||f.bottom;(d<g&&h>g||d<m&&h>m)&&(u<v&&p>v||u<y&&p>y)?(this.opacity-=1e3*e,this.opacity<0&&(this.opacity=0)):(this.opacity+=1e3*e,this.opacity>255&&(this.opacity=255));var b=!1,k=0,T=0,_=0;if(a>p?(T=p,(k=o-(r-p)*(o-i)/(r-a))>d&&k<h&&(b=!0,_=90-(90+(o-k)/c*45))):a<u&&(T=u,(k=o-(r-u)*(o-i)/(r-a))>d&&k<h&&(b=!0,_=180+(o-k)/c*45)),b||(i>h?(k=h,_=90+(r-(T=r-(o-h)*(r-a)/(o-i)))/l*45,b=!0):i<d&&(k=d,_=-(90+(r-(T=r-(o-d)*(r-a)/(o-i)))/l*45),b=!0)),b)return t.active=!0,t.setPosition(k,T),t.angle=_,void(t.opacity=this.opacity);t.active=!1}}}),cc._RF.pop()},{}],ArmatureAvatar:[function(e,t){"use strict";cc._RF.push(t,"c19ff/WZklED4bD6gnoo1Kh","ArmatureAvatar"),cc.Class({extends:e("./Avatar"),initAnime:function(){try{var e=this,t=this.define,i=this.obj;this.attackAnime0=t.attackAnime||"attack",this.standAnime0=t.standAnime||"stand",this.reloadAnime0=t.reloadAnime,this.walkAnime0=t.walkAnime||"walk",this.deathAnime0=t.deathAnime||"dead",this.setAttackAnime(),this.setWalkAnime(),this.setStandAnime(),this.setReloadAnime(),this.reloadSpd=1;var a=this.define.reloadTime;a&&(this.reloadSpd=a/(i.bltReload-.1));var n=this.game,o=n.layer,r=i.scale;this.node.setScale(r),this.moveScale=(t.moveSpd||1)*r;var s=this.rttNode=new cc.Node;o.bindScheduler(s),this.addChild(s,0),s.angle=i.getDegree(),this.config;var c=t.anime||"hero_torbjorn",l=t.animeName,d=n.effectMgr.createArmature(c,l,function(t,i){e.initSkin(i)});d.x=t.dx||0,d.y=t.dy||0,d.scale=t.s||1,t.fixedScale||(d.scale*=ANIME_SCALE),s.addChild(d,0),this.displayNode=d,(this.display=d.armatureDisplay).addEventListener(dragonBones.EventObject.COMPLETE,this.onAnimeEvent,this),this.initStatus(),this.initBase(),t.gunBone&&(this.dar=0,this.gunDeg=t.gunDeg||0,this.attackDeg=this.getAttackDeg(),this.gunBoneName=t.gunBone,this.refreshGunBone()),t.effect&&(this.effect=n.callEffect(t.effect,this))}catch(h){console.log("init Anime errro",h)}},getAttackDeg:function(){return this.obj.flipX<0?-this.obj.attackDeg*this.flipX0+180+this.gunDeg:this.obj.attackDeg+this.gunDeg},refreshGunBone:function(){var e=this.getArmature();if(e){var t=e.getBone(this.gunBoneName);t&&(t.offset.rotation=kit.degree2Radian(this.attackDeg),t.invalidUpdate())}},setSlotVisible:function(e,t){var i=this.getArmature();i&&(i.getSlot(e).visible=t)},setSlotByIndex:function(e,t){var i=this.getArmature();if(i){var a=i.getSlot(e);a.displayIndex=t,a._color.a=255,this.display.connects[e]|=1}},initSkin:function(e){var t=e.armature();if(t){var i=this.define.skin,a=e.connects;if(i)for(var n in i)t.getSlot(n).setDisplayByName(i[n]),a[n]|=1;var o=t.getSlots();for(var n in o){var r=o[n];if("ns_"==r.name.substr(0,3)){var s=r.displayList;for(var c in s)s[c]instanceof dragonBones.CCSlot&&(s[c].cascadeColor=0)}}}},onAnimeEvent:function(e){e.type==dragonBones.EventObject.COMPLETE&&(this.forcedAnimeName||(this.state=null))},refresh:function(e,t,i){this.needRefresh=!0,this.forcedRefresh=this.forcedRefresh||t||i,(e||0===e)&&(this.fadeTime&&!t?e<this.fadeTime?this.fadeTime=e:this.fadeTime=this.fadeTime:this.fadeTime=e)},setAttackAnime:function(e){this.attackAnimeName=e||this.attackAnime0},setWalkAnime:function(e){this.walkAnimeName=e||this.walkAnime0},setStandAnime:function(e){this.standAnimeName=e||this.standAnime0},setReloadAnime:function(e){this.reloadAnimeName=e||this.reloadAnime0},setForcedAnime:function(e,t,i,a){this.forcedAnimeName=e,this.forcedAnimeSpd=t,this.forcedAnimeDelay=i||0,this.forcedAnimeAction=!!e,this.forcedAnimePlayTimes=a},setForcedAnimeSpd:function(e){this.forcedAnimeSpd=e},callAttackAnime:function(e){this.attackPlay=e},callMoveAnime:function(e){this.moveAction=e},callStunAnime:function(e){this.stunAction=e},updateRender:function(e){var t=this.obj;if(this.setFlipX(t.flipX),this.needRefresh){var i=this.forcedAnimeSpd;if(this.stunAction)this.state&&(this.state.timeScale=0),this.hideEffect(),this.forcedAnimeName=null,this.aniName=null,this.fadeTime=null,this.needRefresh=!1;else if(this.forcedAnimeName)this.forcedAnimeAction&&(this.forcedAnimeDelay-=e,this.forcedAnimeDelay<=0&&(this.forcedAnimeAction=!1,this.callAnime(this.forcedAnimeName,i||1,this.forcedAnimePlayTimes)));else{var a,n=t.moveAction&&!t.getFlag(NO_MOVE)||this.moveAction;if(a=null!=t.attackPlay?t.attackPlay:this.attackPlay,t.reloadAction&&this.reloadAnimeName)this.callAnime(this.reloadAnimeName,i||this.reloadSpd);else if(a)this.callAnime(this.attackAnimeName,i||t.atkSpd,1);else if(n){var o=Math.abs(t.getMoveSpdX())/this.moveScale;this.flipX==t.flipX?o*=1:o*=-1,this.callAnime(this.walkAnimeName,i||o)}else this.callAnime(this.standAnimeName,i||1)}(!this.forcedAnimeName||this.forcedAnimeDelay<=0)&&(this.fadeTime=null,this.needRefresh=!1,this.forcedRefresh=!1),this.effect&&this.effect.refresh(this)}this.updateStatus()},callAnime:function(e,t,i){var a=this.getArmature();if(a){var n=a.animation;if(!n.animationNames||-1===n.animationNames.indexOf(e))return console.warn('[ArmatureAvatar] CRITICAL: Animation "'+e+'" does not exist in armature "'+a.name+'".'),void console.warn("[ArmatureAvatar] Available animations:",n.animationNames);if(this.forcedRefresh||this.aniName!=e){this.aniName=e;var o=n.fadeIn(e,this.fadeTime||0,i||-1);this.state=o}else o=this.state;o&&(o.timeScale=t)}},hideEffect:function(){var e=this.getArmature();if(e){var t=e.getSlots();for(var i in t){var a=t[i];if("ns_"==a.name.substr(0,3)){var n=a.displayList;for(var o in n)n[o]instanceof dragonBones.CCSlot&&(n[o]._color.a=0)}}}},updateStatus:function(){if(this._super(),this.gunBoneName){var e=kit.includeDegree(this.getAttackDeg(),this.attackDeg);this.dar=e/STEP_TIME}},updateReal:function(e){this._super(e),this.gunBoneName&&(this.attackDeg=(this.attackDeg+this.dar*e+360)%360,this.refreshGunBone())}}),cc._RF.pop()},{"./Avatar":"Avatar"}],Assist:[function(e,t){"use strict";cc._RF.push(t,"41c53UAQGNB9ZVYfhrc5das","Assist"),cc.Class({init:function(e,t,i,a){this.game=e,this.obj=t,this.define=i,this.config=a,this.seekTargetTimer=.9,i&&(this.aimDeg=i.aimDeg||20,this.aimLock=i.aimLock,i.aimOffsetX&&(this.aimOffsetX=i.aimOffsetX,this.aimOffsetChoice=i.aimOffsetChoice)),this.offsetX=this.define.offsetX||0,this.offsetY=this.define.offsetY||0,this.attackRange=i.attackRange,this.seekRange=i.seekRange||650,this.seekWidth=i.seekWidth,this.initAI()},initAI:function(){},updateAI:function(){},updateLogic:function(){},callAim:function(e,t,i){var a=this.obj,n=t-a.x+this.offsetX,o=i-a.y+this.offsetY,r=c_vector2Degree(n,o),s=this.define.gravity;if(s){var c=c_parabola2Degree(n,o,s,this.define.spd);if(1==c.length)r=c[0];else if(2==c.length){var l=c[0],d=c[1];r=c_abs(c_includeDegree(l,r))>c_abs(c_includeDegree(d,r))?d:l}}a.attackDeg=(r+360)%360,a.callHeat(e)},setTarget:function(e){this.target=e},isDegInRange:function(e,t){var i=e.define.attackAngle,a=e.flipX;if(i&&(t||0===t)){t=kit.convertTo0to360(t);var n=i[0],o=i[1];if(a>0){if(t>180){if(t<n+360)return!1}else if(t>o)return!1}else{if(t<180-o)return!1;if(t>180-n)return!1}}return!0},getTargetDegree:function(e,t){return c_vector2Degree(e,t)},seekTarget:function(){for(var e,t=this.obj,i=t.x,a=t.y,n=t._attackDeg+t._deg,o=this.game.contactMgr.getContactList(),r=this.seekRange,s=this.seekWidth,c=1/0,l=0;l<o.length;l++){var d=o[l],h=d.getEntity();if(h.isInBorder()&&h._activeContact&&!d._sensor&&!h.isDead()&&h.team!==t.team){var u=h.x-i+this.offsetX,p=h.y-a+this.offsetY,f=c_sqrt(u*u+p*p)-h.radius;if(s){if(c_abs(u)>s)continue}else if(f>r)continue;var m=this.getTargetDegree(u,p);c_isValue(m)&&this.isDegInRange(t,m)&&(f+=5*c_abs(c_includeDegree(m,n)),(!e||f<c)&&(c=f,e=h))}}this.setTarget(e)}}),cc._RF.pop()},{}],AttributeAgent:[function(e,t){"use strict";cc._RF.push(t,"c607bOAm05HPZHvK7ZDHIxo","AttributeAgent"),cc.Class({init:function(e){this.list=[],this.skill=e},setStatus:function(e,t,i){if(t!==NO_SKILLS)e.setFlag(t,i),this.list.push({o:e,a:SET_FLAG,t:t,f:i});else for(var a in e.skills)e.skills[a]!==this.skill&&(e.setFlag(NO_SKILL[a],i),this.list.push({o:e,a:SET_FLAG,t:NO_SKILL[a],f:i}))},add:function(e,t,i){e.attribute.add(t,i),this.list.push({o:e,a:ADD,t:t,v:i})},addScale:function(e,t,i){e.attribute.addScale(t,i),this.list.push({o:e,a:ADD_SCALE,t:t,v:i})},mutScale:function(e,t,i){e.attribute.mutScale(t,i),this.list.push({o:e,a:MUT_SCALE,t:t,v:i})},addCover:function(e,t,i,a){e.attribute.addCover(t,i,a),this.list.push({o:e,a:ADD_COVER,t:t,v:i,z:a})},clear:function(){for(var e in this.list){var t=this.list[e];t.a===SET_FLAG?t.o.setFlag(t.t,!t.f):t.a===ADD_COVER?t.o.attribute.removeCover(t.t,t.v,t.z):t.a===ADD?t.o.attribute.add(t.t,-t.v):t.a===ADD_SCALE?t.o.attribute.addScale(t.t,-t.v):t.a===MUT_SCALE&&t.o.attribute.mutScale(t.t,-t.v)}this.list=[]}}),cc._RF.pop()},{}],Attribute:[function(e,t){"use strict";cc._RF.push(t,"aa184BFSkhBiJZ9rGzM+OT9","Attribute"),cc.Class({init:function(e,t,i,a,n){this[e]={max:i||Number.MAX_VALUE,min:a||0,v0:t||0,v1:0,s_add:1,s_mut:1,cb:n,cover:null,coverStack:[]},this.update(e)},update:function(e){var t,i=this[e];(t=i.cover?i.cover:(i.v0+i.v1)*i.s_add*i.s_mut)>i.max?i.v=i.max:t<i.min?i.v=i.min:i.v=t,i.cb&&i.cb(i.v)},setMin:function(e,t){this[e].min=t,this.update(e)},set:function(e,t){this[e].v0=t,this.update(e)},get:function(e){return this[e].v},add:function(e,t){this[e].v1+=t,this.update(e)},addScale:function(e,t){this[e]||cc.error("addScale",e,t),this[e].s_add+=t,this.update(e)},mutScale:function(e,t){t>0?this[e].s_mut*=t:t<0?this[e].s_mut/=-t:cc.error("Attribute.mutScale: a zero value!"),this.update(e)},addCover:function(e,t,i){void 0===i&&(i=0);var a=this[e],n=a.coverStack,o=n[n.length-1];if(n.push({v:t,z:i}),!o||i>=o.z)a.cover=t;else for(var r=n.length;r>0;){var s=r,c=--r;if(n[s].z<n[c].z){var l=n[s];n[s]=n[c],n[c]=l}}this.update(e)},removeCover:function(e,t,i){void 0===i&&(i=0);for(var a=this[e],n=a.coverStack,o=0;o<n.length;o++)if(n[o].v==t&&n[o].z==i){n.splice(o,1);break}if(0==n.length)a.cover=null;else if(o==n.length){var r=n[n.length-1];a.cover=r.v}this.update(e)},dump:function(){for(var e in cc.log("Attribute:--------"),this)kit.isObject(this[e])&&this[e].v&&cc.log(e+":"+this[e].v);cc.log("==========--------")}}),cc._RF.pop()},{}],A:[function(e,t){"use strict";cc._RF.push(t,"cc6085iaRhMx7OdiKcZ821k","A"),e("./script/scripts/kit"),e("./script/data/constants/GameConstants"),e("./script/scripts/ids"),e("./script/scripts/dmgType"),e("./script/managers/EffectManager"),e("./script/managers/StatsTracker"),e("./script/utils/EquipmentEncoder"),e("./script/managers/StatsStorage"),cc._RF.pop()},{"./script/data/constants/GameConstants":"GameConstants","./script/managers/EffectManager":"EffectManager","./script/managers/StatsStorage":"StatsStorage","./script/managers/StatsTracker":"StatsTracker","./script/scripts/dmgType":"dmgType","./script/scripts/ids":"ids","./script/scripts/kit":"kit","./script/utils/EquipmentEncoder":"EquipmentEncoder"}],AuthMenu:[function(e,t){"use strict";cc._RF.push(t,"59b03TepVtDpppw7HIV6btW","AuthMenu"),cc.Class({extends:e("./CheckMenu"),properties:{buttonNode:cc.Node},initStatus:function(e){e.title&&(this.titleLabel.string=e.title)},onDestroy:function(){if(this._super(),cc.sys.platform==cc.sys.WECHAT_GAME){var e=this.wxButton;e&&e.destroy()}},createButton:function(){var e=this;if(cc.sys.platform==cc.sys.WECHAT_GAME){var t=sdk.pt();if(t.createUserInfoButton){var i=cc.view.getDevicePixelRatio(),a=cc.view.getScaleX()/i,n=cc.view.getScaleY()/i,o=this.buttonNode.getBoundingBoxToWorld();console.log("createUserInfoButton",o);var r=t.createUserInfoButton({type:"text",text:"",style:{left:o.x*a,top:(cc.winSize.height-o.y-o.height)*n,width:o.width*a,height:o.height*n}}),s=this.args.infoCb;r.onTap(function(t){console.log("onTap",t),t.userInfo&&(s&&s(0,t.userInfo),e.close())}),r.show(),this.wxButton=r}}},close:function(){menuManager.close(this);var e=this.args.infoCb;e&&e(-1)},start:function(){this.board.runAction(cc.sequence(cc.spawn(cc.fadeIn(.2),cc.moveTo(.2,0,0).easing(cc.easeBounceOut())),cc.callFunc(this.createButton,this)))}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],Avatar:[function(e,t){"use strict";cc._RF.push(t,"9a57cxkncRFrLCU+uMOoTIV","Avatar"),cc.Class({extends:cc.Component,init:function(e,t,i,a){e.layer.bindScheduler(this.node),this.scheduleVS(this.updateReal,0),this.define=i,this.config=a,this.game=e,this.obj=t,this.initAnime(),this.initShader()},remove:function(){this.node.destroy()},setUIVisible:function(e){this.hpBar&&this.hpBar.setVisible(e)},initAnime:function(){var e=this.define,t=this.obj,i=this.game,a=t.scale;this.node.setScale(a);var n=this.rttNode=new cc.Node;i.layer.bindScheduler(n),this.addChild(n,0),n.angle=t.getDegree();var o=this.displayNode=new cc.Node;i.layer.bindScheduler(o),n.addChild(o);var r=e.s||1;if(e.frm){var s=o.addComponent(cc.Sprite);i.effectMgr.loadSprite(s,e.frm),this.display=s,o.setAnchorPoint(e.ax||.5,e.ay||.5)}else if(e.animation){s=o.addComponent(cc.Sprite);var c=o.addComponent(cc.Animation);i.effectMgr.loadAnimation(s,c,e.animation,{speed:e.speed,repeat:-1}),this.display=s,r*=ANIME_SCALE,o.setAnchorPoint(e.ax||.5,e.ay||.5)}o.scale=r,this.initStatus(),this.initBase(),e.effect&&(this.effect=i.callEffect(e.effect,this))},initStatus:function(){var e=this.obj;this.flipX0=this.define.flipX||1,this.setFlipX(e.flipX),this.x=e.x,this.y=e.y,this.deg=e.deg,this.setPosition(this.x,this.y),this.updateStatus()},getAngle:function(){return this.rttNode.angle},initBase:function(){var e=this.config.base,t=this.config.slot;e&&t&&e.avatar.attachAvatar(t.name,this,t.dx,t.dy)},setFlipX:function(e){this.flipX=this.rttNode.scaleX=e*this.flipX0},refresh:function(){this.needRefresh=!0},setAttackAnime:function(){},setWalkAnime:function(){},setStandAnime:function(){},setReloadAnime:function(){},setForcedAnime:function(){},setBeadsAction:function(){},setForcedUpperAnime:function(){},callStunAnime:function(){},callAttackAnime:function(){},updateRender:function(){var e=this.obj;this.setFlipX(e.flipX),this.needRefresh&&(this.effect&&this.effect.refresh&&this.effect.refresh(this),this.needRefresh=!1),this.updateStatus()},updateStatus:function(){if(!this.attachTarget){var e=this.obj;this.dx=(e.x-this.x)/STEP_TIME,this.dy=(e.y-this.y)/STEP_TIME;var t=kit.includeDegree(e.deg,this.deg);this.dr=t/STEP_TIME}},updateReal:function(e){this.attachTarget||(this.x+=this.dx*e,this.y+=this.dy*e,this.deg=(this.deg+this.dr*e+360)%360,this.node.x=this.x,this.node.y=this.y,this.rttNode.angle=this.deg,this.updateRenderTexture(e))},updateRenderTexture:function(){},setRenderTextureEnabled:function(){},getRenderTexture:function(){},initShader:function(){var e=this.define,t=this.config;this.shaderStack=[];var i=t.shader||e.shader;i&&(this.defaultShader=i,this.setShader(i))},cloneShader:function(e){if(this.shaderStack=e.shaderStack,this.shaderName!=e.shaderName)return this.setShader(e.shaderName)},clearShader:function(){this.shaderStack=[];var e=this.defaultShader;if(this.shaderName!=e)return this.setShader(e)},pushShader:function(e){if(this.shaderStack.push(e),this.shaderName!=e)return this.setShader(e)},popShader:function(e){for(var t=this.shaderStack.length-1;t>=0;t--)if(this.shaderStack[t]==e){this.shaderStack.splice(t,1);break}if(e=this.shaderStack.length>0?this.shaderStack[this.shaderStack.length-1]:this.defaultShader,this.shaderName!=e)return this.setShader(e)},setShader:function(e){this.shaderName=e,this.loadShader()},getShaderName:function(){return this.shaderName},loadShader:function(){var e;if(e=this.shaderName?this.shaderName:"normal",this.rtEabled);else{var t=this.game.effectMgr;this.display&&t.bindShader(this.display,e),this.base&&t.bindShader(this.base.sprite,e)}},setRotation:function(e){this.node.angle=e},setOpacity:function(e){this.node.opacity=e},setVisible:function(e){this.node.active=e},setLocalZOrder:function(e){this.node.zIndex=e},getLocalZOrder:function(){return this.node.zIndex},getRotation:function(){return this.node.angle},addChild:function(e,t){this.node.addChild(e,t)},runDisplayAction:function(e){this.displayNode.runActionVS(e)},stopDisplayActions:function(){this.displayNode.stopAllActionsVS()},setDisplayColor:function(e){this.displayNode.color=e},setPosition:function(e,t){this.node.setPosition(e,t)},getPosition:function(){if(this.attachTarget){var e=this.attachTarget.node.getPosition();return e.x+=this.obj._x,e.y+=this.obj._y,e}return this.node.getPosition()},getArmature:function(){if(this.display)return this.display.armature()},getScale:function(){return this.obj.scale}}),cc._RF.pop()},{}],AvoidDeathBuff:[function(e,t){"use strict";cc._RF.push(t,"f6d9dXDEXFK5YyOv3y1jBt0","AvoidDeathBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.ct=0,this.hpPercent=e.hp||.5,this.config&&this.config.hp&&(this.hpPercent=this.config.hp);var t=this.obj;this.game.eventMgr.regist(t,"hurtEvent",this,this.hurtEvent)},hurtEvent:function(e,t,i){if(e.hp<=i&&this.ct<1)return this.ct++,e.onHeal(this,e.hpMax*this.hpPercent),cc.warn("death! avoid"),!0},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"hurtEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],Background:[function(e,t){"use strict";cc._RF.push(t,"1466coL3NdBdqGF/LvVDZo8","Background"),cc.Class({extends:cc.Component,properties:{layers:[cc.Node],layersMoveRatio:[cc.String],grounds:[cc.Node],material:cc.Material},onLoad:function(){this.initRepeatLayers(),this.enabled=!1},initRepeatLayers:function(){for(var e in this.layers2=[],this.layers){var t=this.layers[e];if(t&&t.active&&(t.ox=t.x,t.oy=t.y,t.zIndex=e,"entity"!=t.name)){var i=cc.instantiate(t);t.addChild(i),i.x=t.width,i.y=0,i.scale=1}}},start:function(){},init:function(e){this.camera=e.camera,this.enabled=!0,this.layer=e},lateUpdate:function(){var e=this.camera.node;this.updateLayers(e.x,e.y)},updateLayers:function(e,t){for(var i in this.layers){var a=this.layers[i];if(a&&a.active)if("entity"!=a.name){var n=Math.floor((e-this.layersMoveRatio[i]*e)/(a.width*a.scale))||0;a.x=a.ox+this.layersMoveRatio[i]*e+n*a.width*a.scale,a.y=a.oy+this.layersMoveRatio[i]*(t+cc.winSize.height/2.3)}else a.x=a.ox+this.layersMoveRatio[i]*e}}}),cc._RF.pop()},{}],BackpackItemDefine:[function(e,t){"use strict";cc._RF.push(t,"39457TO5olFjpkIkGlg7/ml","BackpackItemDefine"),e("./machineGun"),e("./cannon"),e("./fireThrower"),e("./PassiveItem"),e("../entities/projectiles/Mortar"),e("./rifleman"),window.RARE_COLOR=[cc.color(110,110,110),cc.color(0,255,0),cc.color(0,0,255),cc.color(255,0,255)],window.loadBackpackItemDefine=function(){window.BackpackItemDefine={energyBarrier:{name:LI("matrix"),rarity:0,shape:[[0,0],[0,1]],unitID:"energyBarrier",upgrade:"energyBarrier2",talent:{id:"hp",num:30},infoType:"armor",info:[LI("type_self"),"talent","infoNum"],drawPower:600,firstDrawPower:700,adBlob:{index:2},describe:LI("des_energy_barrier")},bouncing_ball:{name:LI("ballhitter"),rarity:0,shape:[[0,0],[0,1],[-1,1]],unitID:"bouncing_ball",upgrade:"bouncing_ball2",infoType:"weapon",info:[LI("type_via"),LI("slow"),"attack",LI("mid")],tag:["physics"],drawPower:500,firstDrawPower:1500,adBlob:{index:7},describe:LI("des_bouncing_ball")},fly_shield:{name:LI("blackarrow"),rarity:0,shape:[[0,0],[0,1],[-1,1],[1,1]],unitID:"fly_shield",upgrade:"fly_shield2",infoType:"weapon",info:[LI("type_via"),LI("slow"),"attack",LI("mid")],tag:["physics"],drawPower:400,adBlob:{index:3},describe:LI("des_fly_shield")},tesla:{name:LI("electower"),rarity:0,shape:[[0,0],[0,1],[0,2],[1,2]],unitID:"tesla_tower",upgrade:"tesla2",infoType:"weapon",info:[LI("type_chain"),LI("slow"),"attack",LI("far")],tag:["energy"],drawPower:400,firstDrawPower:1200,adBlob:{index:5},describe:LI("des_tesla")},laser:{name:LI("laser"),rarity:0,shape:[[0,0],[0,1],[1,1]],unitID:"laser",upgrade:"laser2",infoType:"weapon",info:[LI("type_via"),LI("mid"),"attack",LI("far")],tag:["energy"],drawPower:500,firstDrawPower:1100,adBlob:{index:6},describe:LI("des_laser")},machine_gun:{name:LI("gun"),rarity:0,shape:[[0,0],[1,0]],unitDx:15,unitID:"b",upgrade:"machine_gun2",avatar:{animeName:"jiqiang",anime:"weapon/jiqiang",s:1.5,dx:25,dy:-40},infoType:"weapon",info:[LI("type_bullet"),LI("fast"),"attack",LI("far")],tag:["physics"],drawPower:600,firstDrawPower:700,adBlob:{index:1},describe:LI("des_machine_gun")},cannon:{name:LI("cannon"),rarity:0,shape:[[0,0],[0,1],[1,0],[1,1]],upgrade:"cannon2",unitID:"c",unitDx:20,avatar:{animeName:"dapao",anime:"weapon/dapao",s:2,dx:50,dy:-35},infoType:"weapon",info:[LI("type_boom"),LI("slow"),"attack",LI("far")],tag:["physics"],drawPower:400,firstDrawPower:900,adBlob:{index:3},describe:LI("des_cannon")},fire_thrower:{name:LI("flamer"),rarity:0,shape:[[0,0],[1,0]],upgrade:"fire_thrower2",unitID:"d",unitDx:20,avatar:{animeName:"huoyanpensheqi",anime:"weapon/huoyanpensheqi",s:1.5,dx:25,dy:-40},infoType:"weapon",info:[LI("type_via"),LI("fast"),"attack",LI("near")],tag:["energy"],drawPower:600,firstDrawPower:750,adBlob:{index:1},describe:LI("des_fire_thrower")},sniper:{name:LI("soldier"),rarity:0,shape:[[0,0]],upgrade:"sniper2",unitID:"rifleman",avatar:{animeName:"jqxb",anime:"weapon/jqxb",s:1.5,dx:0,dy:-40},infoType:"weapon",info:[LI("type_bullet"),LI("mid"),"attack",LI("far")],tag:["physics"],drawPower:700,firstDrawPower:350,describe:LI("des_sniper")},mortar:{name:LI("rocket"),rarity:0,shape:[[0,0],[0,1],[0,2]],upgrade:"mortar2",unitID:"mortar",avatar:{anime:"checkpoint/item/daodan",animeName:"daodan",ax:.5,ay:.5},infoType:"weapon",info:[LI("type_boom"),LI("slow"),"attack",LI("far")],tag:["physics"],drawPower:500,firstDrawPower:2300,adBlob:{index:4},describe:LI("des_mortar")},armor:{name:LI("toolcase"),rarity:0,shape:[[0,0]],unitID:"armorPack",upgrade:"armor2",talent:{id:"hp",num:16},avatar:{frm:"avatar/backpack/item/armor",ax:.5,ay:.5},infoType:"armor",info:[LI("type_self"),"talent","infoNum"],drawPower:700,firstDrawPower:300,describe:LI("des_armor")},heal:{name:LI("gasbottle"),rarity:0,shape:[[0,0],[0,1]],unitID:"healPack",upgrade:"heal2",talent:{id:"hp",num:35},avatar:{frm:"avatar/backpack/item/heal",ax:.5,ay:.2},infoType:"heal",info:[LI("type_self"),"talent","infoNum"],drawPower:600,adBlob:{index:2},describe:LI("des_heal")},fuelTank:{name:LI("fueltank"),rarity:0,shape:[[0,0],[1,0]],unitID:"fuelTank",upgrade:"fuelTank2",talent:{id:"hp",num:50},unitDx:25,avatar:{frm:"avatar/backpack/item/heal",ax:.5,ay:.2},infoType:"heal",info:[LI("type_self"),"talent","infoNum"],drawPower:600,adBlob:{index:1},describe:LI("des_fuelTank")},block1x1:{shape:[[0,0]],block:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:800,firstDrawPower:50,describe:LI("des_block1x1")},block2x1:{shape:[[0,0],[1,0]],block:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:350,firstDrawPower:30,describe:LI("des_block2x1")},block1x2:{shape:[[0,0],[0,1]],block:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:300,firstDrawPower:30,describe:LI("des_block1x2")},block1x3:{shape:[[0,0],[0,1],[0,2]],block:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:120,firstDrawPower:80,adBlob:{index:4},describe:LI("des_block1x3")},block_laser:{shape:[[0,0],[0,1],[1,1]],block:1,needAD:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:150,firstDrawPower:200,adBlob:{index:6},describe:LI("des_block_laser")},block_boucing_ball:{shape:[[0,0],[0,1],[-1,1]],block:1,avatar:{frm:"avatar/backpack/block",ax:.5,ay:.5},drawPower:150,firstDrawPower:200,adBlob:{index:7},describe:LI("des_block_boucing_ball")},moneyPack:{name:LI("moneypack"),rarity:0,equip:1,shape:[[0,0]],talent:{id:"moneypack",num:2},unitID:"moneyPack",upgrade:"moneyPack2",avatar:{frm:"avatar/backpack/item/\u94b1\u888b\u5b50",ax:.5,ay:.2},infoType:"money",info:[LI("type_self"),"talent"],drawPower:200,describe:LI("des_block_moneyPack")}};var e={moneyPack2:{talent:{id:"moneypack",num:4}},moneyPack3:{talent:{id:"moneypack",num:8}},moneyPack4:{talent:{id:"moneypack",num:16}},armor2:{talent:{id:"hp",num:24}},armor3:{talent:{id:"hp",num:36}},armor4:{talent:{id:"hp",num:54}},heal2:{talent:{id:"hp",num:53}},heal3:{talent:{id:"hp",num:80}},heal4:{talent:{id:"hp",num:120}},fuelTank2:{talent:{id:"hp",num:75}},fuelTank3:{talent:{id:"hp",num:112}},fuelTank4:{talent:{id:"hp",num:168}},energyBarrier2:{talent:{id:"hp",num:45}},energyBarrier3:{talent:{id:"hp",num:68}},energyBarrier4:{talent:{id:"hp",num:102}}};for(var t in BackpackItemDefine){var i=BackpackItemDefine[t];i.block||(BackpackItemDefine[t].type=t,BackpackItemDefine[t+"2"]=kit.mergeObjs(e[t+"2"],i),BackpackItemDefine[t+"2"].type=t,BackpackItemDefine[t+"2"].upgrade=t+"3",BackpackItemDefine[t+"2"].unitID=i.unitID+"_2",BackpackItemDefine[t+"2"].rarity=1,BackpackItemDefine[t+"3"]=kit.mergeObjs(e[t+"3"],i),BackpackItemDefine[t+"3"].type=t,BackpackItemDefine[t+"3"].upgrade=t+"4",BackpackItemDefine[t+"3"].unitID=i.unitID+"_3",BackpackItemDefine[t+"3"].rarity=2,BackpackItemDefine[t+"4"]=kit.mergeObjs(e[t+"4"],i),BackpackItemDefine[t+"4"].type=t,BackpackItemDefine[t+"4"].upgrade=null,BackpackItemDefine[t+"4"].unitID=i.unitID+"_4",BackpackItemDefine[t+"4"].rarity=3)}},cc._RF.pop()},{"../entities/projectiles/Mortar":"Mortar","./PassiveItem":"PassiveItem","./cannon":"cannon","./fireThrower":"fireThrower","./machineGun":"machineGun","./rifleman":"rifleman"}],BackpackItemInfoMenu:[function(e,t){"use strict";cc._RF.push(t,"5e9b4NHcGxHEIXFoGr/bg2c","BackpackItemInfoMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{itemNode:cc.Node,nameLabel:cc.Label,desLabel:cc.Label,lvlLabel:cc.Label,itemPrefab:cc.Prefab,itemInfoNode:cc.Node},initStatus:function(e){console.log("initStatus Backpack",e),this.itemData=e.itemData;var t=BackpackItemDefine[this.itemData.id];console.log("initStatus Backpack",t),this.initIcon(t),this.nameLabel.string=t.name||"\u65e0\u540d",this.lvlLabel.string=null!=t.rarity&&"Lv."+(+t.rarity+1),this.desLabel.string=t.describe||"",this.itemInfoNode.getComponent("BackpackItemStatInfo").initStatus({id:this.itemData.id})},initFrames:function(){var e=BackpackItemDefine[this.itemData.id],t=e.info;for(var i in this.infoFrameNodes){var a=this.infoFrameNodes[i];if(t[i]){var n,o,r;if("attack"==t[i])(s=ENTITY[e.unitID].bltDmg||ENTITY[e.unitID].bombDmg)||(s=(null==(n=ENTITY[e.unitID].blt[0])?void 0:n.dmg)||(null==(o=ENTITY[e.unitID].blt[0])?void 0:null==(r=o.bomb)?void 0:r.dmg0)||0);else if("talent"==t[i])var s=e.talent.num||0;else s="infoNum"==t[i]?ENTITY[e.unitID].infoNum||ENTITY[e.unitID].infoNum:t[i];a.getChildByName("info").getComponent(cc.Label).string=s}}"weapon"==e.infoType||("armor"==e.infoType?(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("hp"),this.infoFrameNodes[2].getChildByName("title").getComponent(cc.Label).string=LI("restore_armor"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.hpSpriteFrame,this.infoFrameNodes[2].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.armorSpriteFrame,this.infoFrameNodes[3].active=!1):"heal"==e.infoType?(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("hp"),this.infoFrameNodes[2].getChildByName("title").getComponent(cc.Label).string=LI("restore_hp"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.hpSpriteFrame,this.infoFrameNodes[2].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.healSpriteFrame,this.infoFrameNodes[3].active=!1):"money"==e.infoType&&(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("money"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.moneySpriteFrame,this.infoFrameNodes[2].active=!1,this.infoFrameNodes[3].active=!1))},initIcon:function(e){var t,i=-1!==["mortar","mortar_2","mortar_3","mortar_4"].indexOf(e.unitID);console.log("initIcon",i);var a=ENTITY[e.unitID].avatar;a.frm?t=menuManager.createSprite(0,0,a.frm):a.anime&&((t=menuManager.createArmature(a.anime,a.animeName,function(){})).scale*=2),t.angle=0,console.log(t),i?(t.y=70,t.x=-110,t.anchorY=0,t.angle=-90):(t.anchorY=0,t.angle=0),this.itemNode.addChild(t)}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],BackpackItemStatInfo:[function(e,t){"use strict";cc._RF.push(t,"a4ca89lKqVI+La1LHmK1I7n","BackpackItemStatInfo"),cc.Class({extends:cc.Component,properties:{infoFrameNodes:[cc.Node],armorSpriteFrame:cc.SpriteFrame,healSpriteFrame:cc.SpriteFrame,moneySpriteFrame:cc.SpriteFrame,hpSpriteFrame:cc.SpriteFrame},initStatus:function(e){this.equipmentID=e.id,this.equipmentData=e.data,this.showBonus=e.showBonus,this.initFrames()},initFrames:function(){var e=BackpackItemDefine[this.equipmentID],t=e.type,i=e.info;for(var a in this.infoFrameNodes){var n=this.infoFrameNodes[a],o=null,r=null,s=null;if(i[a]){var c,l,d;"attack"==i[a]?((o=ENTITY[e.unitID].bltDmg||ENTITY[e.unitID].bombDmg)||(o=(null==(c=ENTITY[e.unitID].blt[0])?void 0:c.dmg)||(null==(l=ENTITY[e.unitID].blt[0])?void 0:null==(d=l.bomb)?void 0:d.dmg0)||0),r=equipment.getStat(t,"atk"),s="atk"):"talent"==i[a]?(o=e.talent.num||0,"hp"==e.talent.id&&(r=equipment.getStat(t,"hp"),s="hp")):"infoNum"==i[a]?(o=ENTITY[e.unitID].infoNum||ENTITY[e.unitID].infoNum,"armor"==t&&(r=equipment.getStat(t,"armor"),s="armor"),"heal"==t&&(r=equipment.getStat(t,"heal"),s="heal"),"fuelTank"==t&&(r=equipment.getStat(t,"heal"),s="heal")):o=i[a];var h=s&&equipment.getStat(t,s,1),u=h&&h-r;if("fuelTank"==t&&"heal"==s){r&&(o+=r*Math.pow(1.5,e.rarity));var p=u*Math.pow(1.5,e.rarity);p=Math.floor(1e3*p)/10+"%",o=Math.floor(1e3*o)/10+"%"}else p=Math.floor(u*Math.pow(1.5,e.rarity)),r&&(o=Math.floor(o+r*Math.pow(1.5,e.rarity)));var f=this.showBonus&&u&&"<color=#00ff00>+"+p||"";cc.log("initFrames: bonus nextLvlBonus minus nextLvlBonusStr num",r,h,u,f,o);var m="<outline color=black width=2>"+o+f+"</outline>";n.getChildByName("info").getComponent(cc.RichText).string=m}}"weapon"==e.infoType||("armor"==e.infoType?(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("hp"),this.infoFrameNodes[2].getChildByName("title").getComponent(cc.Label).string=LI("restore_armor"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.hpSpriteFrame,this.infoFrameNodes[2].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.armorSpriteFrame,this.infoFrameNodes[3].active=!1):"heal"==e.infoType?(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("hp"),this.infoFrameNodes[2].getChildByName("title").getComponent(cc.Label).string=LI("restore_hp"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.hpSpriteFrame,this.infoFrameNodes[2].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.healSpriteFrame,this.infoFrameNodes[3].active=!1):"money"==e.infoType&&(this.infoFrameNodes[1].getChildByName("title").getComponent(cc.Label).string=LI("money"),this.infoFrameNodes[1].getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.moneySpriteFrame,this.infoFrameNodes[2].active=!1,this.infoFrameNodes[3].active=!1))}}),cc._RF.pop()},{}],BackpackMenu:[function(e,t){"use strict";cc._RF.push(t,"ba197HvwE5C7ZYyEdyA3JIo","BackpackMenu");var i=e("../../../Plugins/firebase/FirebaseTracking"),a=e("../../../Plugins/SDKManager");function n(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=o(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(e){if("string"==typeof e)return r(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}e("../../scripts/BackpackItemDefine");var s=["sound/checkpoint/drop_item",1.5],c=e("../../utils/ConsecutiveHPManager");cc.Class({extends:e("../core/Menu"),properties:{blockInstance:cc.Node,itemBlockInstance:cc.Node,blockNode:cc.Node,drawNode:cc.Node,debugNode:cc.Node,noTopBar:!0,chapterName:cc.Label,goldLabel:cc.Label,drawCost:cc.Label,bgNode:cc.Node,tank:cc.Node,uiNode:cc.Node,topUiNode:cc.Node,resetEditModeNode:cc.Node,bottomUINode:cc.Node,bottomBtnLayoutNode:cc.Node,toggleBottomUIBtnNode:cc.Node,blockAddSpriteFrame:cc.SpriteFrame,adBlobSpriteFrame:[cc.SpriteFrame],adIconSpriteFrame:cc.SpriteFrame,backgroundSpriteFrame:[cc.SpriteFrame],backgroundSpr:cc.Sprite,iconFrame:cc.SpriteFrame,adTicketLabel:cc.Label,videoIconPrefab:cc.Prefab,feedbackBtn:cc.Node,buttonBackMain:cc.Node,btnDrawItems:cc.Node,btn_debug_remote:cc.Node},onLoad:function(){this.initTouch(),this.itemsInDrawArea=[],this.isActiveGuide=!1,this.currentATK=0,this.currentHPRegen=0,this.currentArmorRegen=0,this._rulesInitialized=!1,this._idleTimer=0,this._idleSuggestionActive=!1,this._idleSuggestionNode=null,this._idleCheckInterval=null,this._isResettingIdle=!1,this._startIdleTracking()},checkForcedDraw:function(e){console.log("checkForcedDraw",e,+this.args.mapIndex+1);var t,i=+this.args.mapIndex+1,a=window.CHAPTER_HARD_FIX_CONFIG["chapter"+(this.args.chapterIndex+1)],n=null;if(a&&(n=a[i]),console.log("checkForcedDraw",a,n,this.args.chapterIndex+1,i,(this.args.chapterIndex,2!=this.args.chapterIndex)),!n||0!=this.args.chapterIndex&&2!=this.args.chapterIndex)return!0;n[t=e?this.drawItemCtAd:this.drawItemCtNoAd]&&(this.forcedDrawItems=n[t][e?1:0])},initBottomUI:function(){this.bottomUINode.active=!0;var e=this.bottomUINode.getComponent("battleBottomUI");e.init(this,{noTouch:1});var t={hp:1e3,hpMax:1e3};this.updateVehicleObj(t),e.setVehicle(t,this),this.bottomUI=e,this.bottomUINode.getChildByName("bottom").active=!1,this.buttonBackMain.active=0!=this.args.chapterIndex},updateVehicleObj:function(t){var i,a,n,o,r=this;if(!this.editMode){t=t||this.vehicleObj,this.vehicleObj=t;var s=(null==(i=this.vehicleConfig)?void 0:null==(a=i.attr)?void 0:a.hp)||ENTITY[VEHICLE_BASE].hp,c=1*s,l=chapter.data.events;cc.log("updateVehicleObj hpBase",s);var d,h,u=[];for(var p in l){var f=l[p],m=EVENTS[f.eventId];f.objectId&&"che"!=f.objectId||m.attr&&(u=u.concat(m.attr))}var g=this.getTalents(),v=new(e("../../components/attributes/Attribute"));for(var y in t.attribute=v,v.init("hpMax",c,1e10,0,function(e){if(r.hpCurrent){t.hp=r.hpCurrent+e-r.hpMaxCurrent;var i=Math.min(r.hpCurrent,s);t.hp<i&&(t.hp=i)}else t.hp=r.vehicleConfig.hp*e;t.hpMax=e,cc.log("updateVehicleObj hp set",t.hp,t.hpMax)}),null!=(n=this.vehicleConfig)&&null!=(o=n.attr)&&o.hp0&&v.mutScale("hpMax",null==(d=this.vehicleConfig)?void 0:null==(h=d.attr)?void 0:h.hp0),g){var b=g[y],k=TalentDefine[b.id];cc.log("updateVehicleObj attrList events talents",b,k),k.templateFunc&&k.templateFunc.bind(this)(k.template,b,this),k.templateFunc2&&k.templateFunc2.bind(this)(k.template2,b,this);var T=k.template;if(T&&"attribute"==k.template.id&&"hpMax"==k.template.attr){var _=[[T.mul&&MUT_SCALE||T.add&&ADD||ADD_SCALE,T.attr,T.num]];u=u.concat(_)}}var w=pc.talentGlobal.hp4vehicle;w&&v.addScale("hpMax",+w);var E=(v=this.addtAttr(v,u)).get("hpMax");this.hpCurrent||(this.hpCurrent=t.hp),this.hpMaxCurrent||(this.hpMaxCurrent=t.hpMax),this.vehicleConfig.hp=t.hp/t.hpMax,cc.log("getCalculatedHpMax",E,u,this.vehicleConfig),this.bottomUI&&this.bottomUI.setVehicle(t,this)}},updateEquipmentStats:function(){if(cc.log("[BackpackMenu] updateEquipmentStats - Recalculating stats after equipment change"),this.blockItemData&&this.vehicleObj)if("undefined"!=typeof window&&(window.lastBlockItemData=this.blockItemData),chapter.data.backpack||(chapter.data.backpack={}),chapter.data.backpack.blockItemData=this.blockItemData,chapter.data.backpack.blockData=this.blockData,cc.log("[BackpackMenu] Current blockItemData count:",this.blockItemData.length),cc.log("[BackpackMenu] Items with position (equipped):",this.blockItemData.filter(function(e){return e.pos}).length),cc.log("[BackpackMenu] Vehicle max HP for stats calculation:",this.vehicleObj.hpMax),window.StatsCalculator){window.StatsCalculator.setLastMaxHP(this.vehicleObj.hpMax),cc.log("[BackpackMenu] Set authoritative max HP:",this.vehicleObj.hpMax),"undefined"!=typeof window&&(window.lastVehicleData={hpMax:this.vehicleObj.hpMax,hp:this.vehicleObj.hp,lastUpdated:Date.now()},cc.log("[BackpackMenu] Stored authoritative vehicle data globally")),window.StatsCalculator.clearSyncedStats();var e=window.StatsCalculator.calculateAndSyncStats(this.blockItemData,this.vehicleObj);cc.log("[BackpackMenu] Fresh stats calculated with max HP",this.vehicleObj.hpMax+":",e),this.bottomUI&&this.bottomUI.updateBattleStats&&(cc.log("[BackpackMenu] Triggering bottomUI stats refresh"),this.bottomUI.updateBattleStats())}else cc.log("[BackpackMenu] WARNING: StatsCalculator not available");else cc.log("[BackpackMenu] Missing blockItemData or vehicleObj, skipping stats update")},addtAttr:function(e,t){if(t){var i=e;for(var a in t){var n=t[a],o=n[0];"hpMax"==n[1]&&(o==ADD?i.add(n[1],n[2]):o==ADD_SCALE?i.addScale(n[1],n[2]):o==ADD_COVER?i.addCover(n[1],n[2]):o==MUT_SCALE&&i.mutScale(n[1],n[2]))}return e}},updateGold:function(){this.goldLabel.string=chapter.get("gold"),this.adTicketLabel&&(this.adTicketLabel.string=money.getNum(SWEEP_TICKET))},animateStatValue:function(e,t,i,a,n){if(e&&e.node){a=a||"",n=n||0,cc.Tween.stopAllByTarget(e.node);var o={value:t};cc.tween(o).to(.3,{value:i},{progress:function(t,i,o,r){var s=t+(i-t)*r;e.string=n>0?s.toFixed(n)+a:Math.floor(s)+a},easing:"quadOut"}).start()}},update:function(e){if(this.updateGold(),this.tankLeaving)this.leavingSpd+=1e3*e,this.tank.x+=this.leavingSpd*e,this.tankWalkState2&&(this.tankWalkState2.timeScale=kit.clamp(this.leavingSpd/100,0,10)),this.tankWalkState&&(this.tankWalkState.timeScale=kit.clamp(this.leavingSpd/100,0,10)),this.tank.x>400&&this.startGame2();else{var t=800-this.camera.node.x;this.camera.node.x=kit.numApproach(this.camera.node.x,800,t/20*e*50+.5),this.bgNode.x=0+t/4,this.tankWalkState2&&(this.tankWalkState2.timeScale=kit.clamp(t/100,0,10)),this.tankWalkState&&(this.tankWalkState.timeScale=kit.clamp(t/100,0,10))}t<2&&!this.tankStop&&(this.tankStop=!0,this.enableUI(!0),this.initGuide(),this.drawItems(null,!0),this.updateGetBlockForAd(),console.log("-----------------------TODO---------------------"),console.log(user.getGuide("backpack"),user.getGuide("freeAds"),this.args.chapterIndex,user),2==user.getGuide("freeAds")&&1==this.args.chapterIndex&&this.guideFreeAds())},updateToggleBottomUIBtn:function(){var e,t,i,a,n,o;cc.log("updateToggleBottomUIBtn",null==(e=chapter)?void 0:null==(t=e.data)?void 0:null==(i=t.talent)?void 0:i.length,this.args.chapterIndex,this.args.mapIndex),null==(a=chapter)?this.toggleBottomUIBtnNode.active=void 0:null==(n=a.data)?this.toggleBottomUIBtnNode.active=void 0:null==(o=n.talent)?this.toggleBottomUIBtnNode.active=void 0:this.toggleBottomUIBtnNode.active=o.length,0==this.args.chapterIndex&&this.args.mapIndex<2&&(this.toggleBottomUIBtnNode.active=!1)},initStatus:function(t){var n=this;this.args=t,this.currentEquip=equipment&&equipment.get("current"),cc.log("this.currentEquip",this.currentEquip);var o=e("../../managers/EffectManager");this.effectMgr=new o,this.editMode=t.editMode,this.editMode||(this.resetEditModeNode.active=!1),this.adventure=t.adventure,this.chapterName.string=t.mapIndex+"/"+t.mapLength,i.FirebaseTracking.gameMode="Classic",a.SDKManager.Instance.CurrentScreen="Backpack";var r=t.mapIndex+1,s=this.args.chapterIndex+1;i.FirebaseTracking.levelID="c"+s+"_"+r,console.log("========= Init Backpack chapter : "+i.FirebaseTracking.levelID),console.log("[initStatus]","initStatus",s);var c=i.FirebaseTracking.levelID;i.FirebaseTracking.curStage=r,a.SDKManager.Instance.handleLevelStart(c);var l=a.SDKManager.Instance.getAttempts(c),d=a.SDKManager.Instance.generateUniqueID(c),h=0;t.vehicleConfig&&void 0!==t.vehicleConfig.hp&&(h=parseFloat(t.vehicleConfig.hp.toFixed(1))),i.FirebaseTracking.logGameStart(d,l,h),user.getGuide("backpack")||0!=this.args.chapterIndex||(user.setGuide("backpack",1),user.quickSave("guide.backpack",1),menuManager.pop("tutorial_popup",{})),this.initBackground(),this.updateGold(),this.updateToggleBottomUIBtn(),this.vehicleConfig=t.vehicleConfig;var u=t.backpack||{};this.blockAvatars={},this.drawExclude={},this.blockData=u.blockData||[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,0],[0,1,1,1,0],[0,1,1,1,0]],this.blockItemData=u.blockItemData||[],this.itemAvatars=[],this.initBlocksAvatar(),this.initItemsAvatar(),this.drawItemCt=0,this.drawItemCtNoAd=0,this.drawItemCtAd=0;var p=new cc.Node;this.node.addChild(p),this.camera={node:p},this.node.getChildByName("transition_go").getComponent("Transition").transitionOut(this);var f=pc.getChooseVehicle(),m=pc.getVehicleData(f.id);this.vid=f.id,menuManager.loadArmature(this.tank.getChildByName("bottom").getComponent(dragonBones.ArmatureDisplay),m.avatar.anime,function(){n.tankWalkState2=n.tank.getChildByName("bottom").getComponent(dragonBones.ArmatureDisplay).playAnimation("walk",-1)},m.avatar.animeName),menuManager.loadArmature(this.tank.getChildByName("top").getComponent(dragonBones.ArmatureDisplay),m.avatar.anime,function(){n.tankWalkState=n.tank.getChildByName("top").getComponent(dragonBones.ArmatureDisplay).playAnimation("walk",-1),n.attach("yuandian",n.blockNode,0,160)},m.avatar.animeName2),this.enableUI(!1),this.enableBlockEditMode(!1),this.effectMgr.playMusic("sound/bgm/checkpoint",!0,1.2*BGM_VOLUME,function(){}),this.initBottomUI(),this.initRules(),this._rulesInitialized=!0,this.bonusRarity1=0,0==this.args.mapIndex?this.freeDrawCt=2:this.freeDrawCt=1,this.bonusRefreshItem1=0,this.initTalents(),cc.log("freeDrawCt",this.freeDrawCt),this.feedbackBtn.active=!!user.feedback},initBackground:function(){console.log("initBackground",this.args,this.args.chapterIndex%7),this.backgroundSpr.spriteFrame=this.backgroundSpriteFrame[this.args.chapterIndex%7]},evaluateOperator:function(e,t,i){switch(t){case"<":return e<i;case"<=":return e<=i;case">":return e>i;case">=":return e>=i;case"==":return e==i;default:return cc.warn("[BackpackMenu] Unknown operator:",t),!1}},initRules:function(){cc.log("[BackpackMenu] initRules called - delegating to DrawRulesManager");var t=e("../../utils/DrawRulesManager"),n=1;this.vehicleObj&&this.vehicleObj.hpMax>0?n=this.vehicleObj.hp/this.vehicleObj.hpMax:this.vehicleConfig&&this.vehicleConfig.hp&&(n=this.vehicleConfig.hp);var o=t.initializeRules({chapterIndex:this.args.chapterIndex,mapIndex:this.args.mapIndex,vehicleConfig:this.vehicleConfig,currentHpPercent:n});this.currentDrawRule=o;var r=i.FirebaseTracking.levelID||"c"+(this.args.chapterIndex+1)+"_"+(this.args.mapIndex+1);a.SDKManager.Instance.getAttempts(r)},createDebugLabels:function(e,t,i){if(this.debugNode.active){for(var a=this,n=this.debugNode.children,o=n.length-1;o>=0;o--)0!==n[o].name.indexOf("DebugLabel_")&&0!==n[o].name.indexOf("WeightLabel_")||n[o].destroy();var r=this.debugNode.getChildByName("DebugBg");r.y+=50,r.color=cc.color(0,0,0,150),r.opacity=200,r.width=400,r.height=1600;var s=r.getComponent(cc.Sprite);s.type=cc.Sprite.Type.SIMPLE,s.sizeMode=cc.Sprite.SizeMode.CUSTOM;var l=c.getDebugInfo(),d=1,h=1;if(window.CHAPTER_DEFINE_ARRAY&&void 0!==this.args.chapterIndex&&void 0!==this.args.mapIndex){var u=window.CHAPTER_DEFINE_ARRAY[this.args.chapterIndex];if(u&&u.stage&&u.stage[this.args.mapIndex]){var p=u.stage[this.args.mapIndex];d=p.lvl||1,h=p.lvl2||1}}var f=c.getModifiedLevels(d,h),m=[{label:"=== DRAW RULES DEBUG ===",value:"",isHeader:!0},{label:"Attempts",value:t},{label:"Current HP",value:i},{label:"Case ID",value:e?e.case_id:"NO MATCH"},{label:"--- Level Values ---",value:"",isHeader:!0},{label:"Original lvl",value:d},{label:"Current lvl",value:f.lvl+(f.multiplied?" (x"+l.multiplier+")":"")},{label:"Original lvl2",value:h},{label:"Current lvl2",value:f.lvl2+(f.multiplied?" (x"+l.multiplier+")":"")},{label:"--- Consecutive HP ---",value:"",isHeader:!0},{label:"Multiplier Active",value:l.isActive?"YES":"NO"},{label:"Consecutive > "+100*window.GAME_CONFIG.hp_consecutive+" %",value:l.consecutiveCount+"/3"},{label:"Recent Stages",value:l.recentStages||"None"}];console.log("Current",i),e&&(m.push({label:"Block Threshold",value:window.BONUS_BLOCK_THRESHOLD},{label:"Draw Bonus",value:window.DRAW_BLOCK_BONUS},{label:"Draw Bonus (Ad)",value:window.DRAW_BLOCK_BONUS_AD},{label:"No Smelt Count",value:window.NO_SAME_ITEM_DRAW_COUNT},{label:"Item Weights",value:window.ITEM_TYPE_WEIGHTS}),window.DRAW_ITEMS_POWER&&window.DRAW_ITEMS_POWER.rarity&&m.push({label:"--- Rarity Weights ---",value:"",isHeader:!0},{label:"Common (rare0)",value:window.DRAW_ITEMS_POWER.rarity.rare0},{label:"Rare (rare1)",value:window.DRAW_ITEMS_POWER.rarity.rare1},{label:"Epic (rare2)",value:window.DRAW_ITEMS_POWER.rarity.rare2},{label:"Block",value:window.DRAW_ITEMS_POWER.rarity.block},{label:"diversity",value:window.DRAW_ITEMS_POWER.diversity}),window.RARITY_UPGRADE_CONFIG&&m.push({label:"--- RARITY_UPGRADE_CONFIG ---",value:"",isHeader:!0},{label:"bonusRarity1_chance",value:window.RARITY_UPGRADE_CONFIG.bonusRarity1_chance},{label:"bonusRarity1_target",value:window.RARITY_UPGRADE_CONFIG.bonusRarity1_target},{label:"bonusRarity1_adChance",value:window.RARITY_UPGRADE_CONFIG.bonusRarity1_adChance}));var g=500;for(o=0;o<m.length;o++){var v=m[o],y=new cc.Node("DebugLabel_"+o);y.parent=this.debugNode;var b=y.addComponent(cc.Label);v.isHeader?(b.string=v.label,b.fontSize=24,b.lineHeight=25,y.color=cc.color(255,255,100)):(b.string=v.label+": "+v.value,b.fontSize=20,b.lineHeight=25,y.color=cc.color(255,255,255)),b.horizontalAlign=cc.Label.HorizontalAlign.LEFT,b.verticalAlign=cc.Label.VerticalAlign.TOP,b.overflow=cc.Label.Overflow.NONE,y.anchorX=0,y.anchorY=.5,y.x=-190,y.y=g,g-=25}this.debugLabelsEndY=g-30,this.btn_debug_remote.active=window.DEV_MODE,window.DEV_MODE&&this.btn_debug_remote&&(this.btn_debug_remote.off(cc.Node.EventType.TOUCH_END),this.btn_debug_remote.getComponent(cc.Button)||(this.btn_debug_remote.addComponent(cc.Button).target=this.btn_debug_remote),this.btn_debug_remote.on(cc.Node.EventType.TOUCH_END,function(){a.debugNode?(a.debugNode.active=!a.debugNode.active,console.log("[BackpackMenu] Debug node toggled to:",a.debugNode.active)):console.warn("[BackpackMenu] Debug node not found")},this,!0)),cc.log("[BackpackMenu] [Rules] Debug labels created for rule:",e?e.case_id:"NO MATCH")}},updateDebugWeights:function(e,t,i){if(this.debugNode.active){for(var a=this.debugNode.children,n=a.length-1;n>=0;n--)0!==a[n].name.indexOf("WeightLabel_")&&0!==a[n].name.indexOf("DrawResult_")||a[n].destroy();if(this.lastDrawWeights){void 0!==e&&(this.drawHistory||(this.drawHistory=[]),this.drawHistory.push({drawNumber:e,drawType:t,selectedItemId:i,weights:JSON.parse(JSON.stringify(this.lastDrawWeights))}),this.drawHistory.length>3&&this.drawHistory.shift());var o=this.debugLabelsEndY||-250;if(this.drawHistory&&this.drawHistory.length>0){var r=new cc.Node("DrawResult_header");r.parent=this.debugNode;var s=r.addComponent(cc.Label);s.string="=== DRAW RESULTS ===",s.fontSize=22,s.lineHeight=25,r.color=cc.color(255,200,100),s.horizontalAlign=cc.Label.HorizontalAlign.LEFT,s.verticalAlign=cc.Label.VerticalAlign.TOP,s.overflow=cc.Label.Overflow.NONE,r.anchorX=0,r.anchorY=.5,r.x=-190,r.y=o,o-=27;for(var c=0;c<this.drawHistory.length;c++){var l=this.drawHistory[c],d=new cc.Node("DrawResult_draw_"+c);d.parent=this.debugNode;var h=d.addComponent(cc.Label);h.string="Draw #"+l.drawNumber+" ("+l.drawType+")",h.fontSize=18,h.lineHeight=20,d.color=cc.color(255,255,150),h.horizontalAlign=cc.Label.HorizontalAlign.LEFT,h.verticalAlign=cc.Label.VerticalAlign.TOP,h.overflow=cc.Label.Overflow.NONE,d.anchorX=0,d.anchorY=.5,d.x=-190,d.y=o,o-=20;var u=l.weights;for(n=0;n<u.length;n++){var p=u[n],f=p.itemId===l.selectedItemId,m=new cc.Node("DrawResult_item_"+c+"_"+n);m.parent=this.debugNode;var g=m.addComponent(cc.Label);g.string="  "+p.itemId+": "+p.percentage+"%"+(f?" <<<":""),g.fontSize=16,g.lineHeight=20,m.color=f?cc.color(100,255,100):cc.color(200,200,200),g.horizontalAlign=cc.Label.HorizontalAlign.LEFT,g.verticalAlign=cc.Label.VerticalAlign.TOP,g.overflow=cc.Label.Overflow.NONE,m.anchorX=0,m.anchorY=.5,m.x=-190,m.y=o,o-=20}o-=5}o-=10}cc.log("[BackpackMenu] Updated debug weights display")}}},initGuide3:function(){var e=this;if(!(user.getGuide("backpack")>2)&&4==this.args.mapIndex&&0==this.args.chapterIndex){this.forcedDrawItems=["block2x1","laser4","sniper"],this.setUITouchable(!1);var t={head:"h99",dy:280,dx:-80,size:cc.size(1,1),z:998,noFinger:1};menuManager.focusOn(this.node,LI("zc_guide_12"),3,function(){user.setGuide("backpack",3),e.setUITouchable(!0),YMTJ("guide","guide012")},1,t)}},initGuide2:function(){var e=this;if(!(user.getGuide("backpack")>1)&&1==this.args.mapIndex&&0==this.args.chapterIndex){var t,i=this.bottomBtnLayoutNode.getChildren();for(var a in i)i[a].opacity=64,i[a].getComponent(cc.Button).interactable=!1;for(var a in this.itemAvatars)"block2x1"!=(n=this.itemAvatars[a]).itemData.id&&(n.locked=!0);for(var a in cc.log("fromNode0",this.itemAvatars),this.itemAvatars){var n=this.itemAvatars[a];if(cc.log("fromNode",a,n,n.itemData),"block2x1"==n.itemData.id){t=n;break}}cc.log("fromNode",t);var o={head:"h99",dy:280,dx:-100,z:998,dragFromNode:t,dragToNode:this.blockAvatars["3-2"],cond:function(t,i){cc.log("guideDragItem cond",i),"onTouchMoved"==i&&t.finger&&(t.finger.active=!1);var a=!0,n=!0;if("onTouchEnded"==i){for(var o in e.blockItemData)"block2x1"==e.blockItemData[o].id&&(a=!1),e.blockItemData[o].pos||(n=!1);if(a){for(var o in e.itemAvatars)e.itemAvatars[o].locked=!1;if(t.infoNode.active=!1,n)return!0}return!1}}};sdk.setFibaseEvent("tutorial",'{"step4_tutorial7":""}'),menuManager.focusOn(this.node,LI("zc_guide_9"),null,function(){YMTJ("guide","guide009"),e.guideDrawItem2()},null,o)}},guideDrawItem2:function(){var e=this;chapter.data.gold=15,this.updateDrawCost(),this.setItemDraggable(!1);var t=this.bottomBtnLayoutNode.getChildren();t[1].opacity=255,t[1].getComponent(cc.Button).interactable=!0,sdk.setFibaseEvent("tutorial",'{"step4_tutorial8":""}'),menuManager.focusOn(t[1],LI("zc_guide_10"),null,function(){e.guideFinish(),YMTJ("guide","guide010")},null,{head:"h99",dy:0,dx:-100,z:998})},guideFinish:function(){console.log(" tutorial_new guideFinish");var e=this;this.setItemDraggable(!0);var t=this.bottomBtnLayoutNode.getChildren();t[0].opacity=255,t[0].getComponent(cc.Button).interactable=!0,t[2].opacity=255,t[2].getComponent(cc.Button).interactable=!0,this.setUITouchable(!1);var i={head:"h99",dy:280,dx:-80,size:cc.size(1,1),z:998,noFinger:1};sdk.setFibaseEvent("tutorial",'{"step4_tutorial9":""}'),menuManager.focusOn(this.node,LI("zc_guide_11"),3,function(){user.setGuide("backpack",2),e.setUITouchable(!0),YMTJ("guide","guide011")},1,i)},initGuide:function(){console.log("[guide]",this.args.mapIndex,this.args.chapterIndex),0==this.args.chapterIndex?this.buttonBackMain.active=!1:this.buttonBackMain.active=!0},guideDragItem:function(){var e,t=this;for(var i in this.itemAvatars){e=this.itemAvatars[i];break}var a={head:"h99",dy:280,dx:-80,z:998,dragFromNode:e,dragToNode:this.blockAvatars["5-2"],cond:function(e,i){if(cc.log("guideDragItem cond",i),"onTouchMoved"==i&&e.finger&&(e.finger.active=!1),"onTouchEnded"==i){for(var a in t.blockItemData)if(!t.blockItemData[a].pos)return!1;return!0}}};sdk.setFibaseEvent("tutorial",'{"step4_tutorial1":""}'),console.log("--------------------------"),console.log(this.node),menuManager.focusOn(this.node,LI("zc_guide_2"),null,function(){YMTJ("guide","guide002"),t.guideDrawItem()},null,a)},guideDrawItem:function(){var e=this;this.setItemDraggable(!1);var t=this.bottomBtnLayoutNode.getChildren();t[1].opacity=255,t[1].getComponent(cc.Button).interactable=!0,sdk.setFibaseEvent("tutorial",'{"step4_tutorial2":""}'),menuManager.focusOn(t[1],LI("zc_guide_3"),null,function(){e.setItemDraggable(!0),e.guideCombineItem(),YMTJ("guide","guide003")},null,{head:"h99",dy:0,dx:-80,z:998})},guideCombineItem:function(){var e,t,a=this,o=this.bottomBtnLayoutNode.getChildren();for(var r in o[1].opacity=64,o[1].getComponent(cc.Button).interactable=!1,this.itemAvatars){var s=this.itemAvatars[r];"machine_gun"!=s.itemData.id||s.itemData.pos&&(!t||s==t)?"machine_gun"==s.itemData.id&&s.itemData.pos?t=s:s.locked=!0:e=s}var c={head:"h99",dy:280,dx:-80,z:998,dragFromNode:e,dragToNode:t,cond:function(e,t){cc.log("guideDragItem cond",t),"onTouchMoved"==t&&e.finger&&(e.finger.active=!1);var o=!1,r=!0;if("onTouchEnded"==t){for(var s,c=n(a.blockItemData);!(s=c()).done;){var l=s.value;"machine_gun2"===l.id&&(e.infoNode.active=!1,o=!0,null!=a.check&&(a.check=!0,a.check&&4!=user.getGuideStep()&&i.FirebaseTracking.logNewTutorial({Step:4,userID:user.uuid,Status:1}))),l.pos||(r=!1)}if(o){for(var d in a.itemAvatars)a.itemAvatars[d].locked=!1;if(r)return!0}else a.guideCombineItem();return!1}}};console.log("tutorial_new",a.check),null==a.check?i.FirebaseTracking.logNewTutorial({Step:3,userID:user.uuid,Status:1}):i.FirebaseTracking.logNewTutorial({Step:4,userID:user.uuid,Status:0}),sdk.setFibaseEvent("tutorial",'{"step8_tutorial3":""}'),menuManager.focusOn(this.node,LI("zc_guide_4"),null,function(){a.guideEquipmentHeal("heal"),YMTJ("guide","guide004")},null,c)},guideMoneyPack:function(){var e,t=this;for(var i in this.setItemDraggable(!1),this.itemAvatars)cc.log("guideMoneyPack",i,this.itemAvatars[i].itemData.id),"moneyPack"==this.itemAvatars[i].itemData.id&&(e=this.itemAvatars[i]);cc.log("guideMoneyPack 2 ",e);var a={head:"h99",dy:280,dx:-100,z:998,noFinger:1,size:cc.size(100,100)};sdk.setFibaseEvent("tutorial",'{"step4_tutorial3":""}'),menuManager.focusOn(e,LI("zc_guide_5"),3,function(){t.setItemDraggable(!0),YMTJ("guide","guide005"),t.guideStartGame()},1,a)},guideEquipmentHeal:function(e){var t,i=this;for(var a in this.setItemDraggable(!1),this.itemAvatars)cc.log(e,a,this.itemAvatars[a].itemData.id),e==this.itemAvatars[a].itemData.id&&(t=this.itemAvatars[a]);cc.log("guide ",e);var n=t.convertToWorldSpaceAR(cc.v2(0,0));n.y+=45;var o={head:"h99",dy:280,dx:-100,z:998,noFinger:1,size:cc.size(90,180),pos:n};sdk.setFibaseEvent("tutorial",'{"step4_tutorial3":""}'),menuManager.focusOn(t,LI("zc_guide_28"),3,function(){i.setItemDraggable(!0),YMTJ("guide","guide028"),i.guideStartGame()},1,o)},guideStartGame:function(){console.log("[check]","guideStartGame");var e=this,t=this.bottomBtnLayoutNode.getChildren();t[2].opacity=255,t[2].getComponent(cc.Button).interactable=!0,this.setItemDraggable(!1),sdk.setFibaseEvent("tutorial",'{"step4_tutorial4":""}'),sdk.setFibaseEvent("tutorial",'{"step9":""}'),menuManager.focusOn(t[2],LI("zc_guide_6"),null,function(){e.setItemDraggable(!0),user.setGuide("backpack",1),YMTJ("guide","guide006")},null,{head:"h99",dy:0,dx:-80,z:998})},guideFreeAds:function(){var e=this.uiNode.getChildByName("bottom").getChildByName("getBlockAd"),t=this,a=1;this.setItemDraggable(!1),this.isActiveGuide=!0,user.setGuide("freeAds",3),user.quickSave("guide.freeAds",3),function n(){menuManager.focusOn(e,null,null,function(){0==--a||0==money.getNum(SWEEP_TICKET)?(i.FirebaseTracking.logNewTutorial({Step:9,userID:user.uuid,Status:1}),user.setGuide("freeAds",4),user.quickSave("guide.freeAds",4),t.setItemDraggable(!0),t.isActiveGuide=!1):n()},null,null)}()},guideRefresh:function(){var e=this;if(1==pc.getChapterIndex()){var t=e.bottomBtnLayoutNode.getChildByName("drawItemAD");t.active&&menuManager.focusOn(t,LI("zc_guide_30"),null,function(){i.FirebaseTracking.logNewTutorial({Step:10,userID:user.uuid,Status:1}),e.isActiveGuide=!1,user.setGuide("refreshBackpack",1),user.quickSave("guide.refreshBackpack",1)},null,{head:"h99",dy:0,dx:-80,z:998})}},addGuideButton:function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0);var a=new cc.Node;return a.width=3333,a.height=333,i&&(a.width=i.width,a.height=i.height),a.x=e||0,a.y=t||0,a.onTouchBegan=function(){},a.onTouchMoved=function(){},a.onTouchEnded=function(){},a.onTouchCanceled=function(){},this.node.addChild(a),a},setItemDraggable:function(e){this.noItemDraggable=!e},setUITouchable:function(e){if(e)this.blockInputNode&&(this.blockInputNode.active=!1);else{if(!this.blockInputNode){var t=new cc.Node;t.addComponent(cc.BlockInputEvents),t.width=9999,t.height=9999,this.node.addChild(t,9999),this.blockInputNode=t}this.blockInputNode.active=!0}},updateGetBlockForAd:function(){var e=chapter.get("getBlockAdCt")||0,t=this.uiNode.getChildByName("bottom").getChildByName("getBlockAd");t.active=e>0&&this.args.chapterIndex>=1,t.getChildByName("freeCt").getComponent(cc.Label).string="("+e+")"},getBlockAdOnTouch:function(){this._resetIdleTimer();var e=this;sdk.useTicket("get_randomblock",function(t,i){t||(e.drawItem(Math.random()<.5?"block2x1":"block1x2"),chapter.add("getBlockAdCt",-1),e.updateGetBlockForAd(),chapter.add("videoCt"),i&&YMTJ("video","lv_Space"))})},adUnlockAvatar:function(e){sdk.useTicket("get_backpack",function(t,i){!t&&e.needAD&&(e.needAD=!1,e.adBlob.destroy(),e.adBlob=null,chapter.add("videoCt"),i&&YMTJ("video","lv_arms"))})},setAdAvatar:function(e){var t,i=new cc.Node,a=BackpackItemDefine[e.itemData.id],n=a.adBlob||{},o=i.addComponent(cc.Sprite);cc.log("setAvatar",n.index||0,e.itemData.id),o.spriteFrame=this.adBlobSpriteFrame[n.index||0];var r=this.getAvatarCenterOffset(e);for(var s in i.x=r.x||0,i.y=r.y||0,i.angle=n.angle||0,e.needAD=!0,e.adBlob=i,a.shape)(!t||a.shape[s][0]+a.shape[s][1]>t[0]+t[1])&&(t=a.shape[s]);var c=cc.instantiate(this.videoIconPrefab);c.getComponent("VideoIcon").setSpecialType("adTicket"),c.x=95*(t[0]+.5)-r.x,c.y=95*(t[1]+.5)-r.y,i.addChild(c),e.addChild(i)},updateDrawCost:function(){var e,t;this.drawItemCtNoAd<this.freeDrawCt&&(e=!0),t=e?0:15,console.log("check Cost ",t);var i=this.drawCost.node.parent;0==t?(this.drawCost.string=LI("free_1st"),i.getChildByName("icon_coin").active=!1):(i.getChildByName("icon_coin").active=!0,this.drawCost.string=t),chapter.get("gold")<t?this.drawCost.node.color=cc.color(255,0,0):this.drawCost.node.color=cc.color(255,255,255)},getAvatarCenterOffset:function(e,t){if(e.centerOffset)return e.centerOffset;var i=t||BackpackItemDefine[e.itemData.id].shape,a=0,n=0,o=0,r=0;for(var s in i){var c=i[s][0],l=i[s][1];c>n&&(n=c),c<a&&(a=c),l>o&&(o=l),l<r&&(r=l)}var d=(n+a)/2*95,h=(o+r)/2*95;return e.centerOffset={x:d,y:h}},upgradeItemEffect:function(e){cc.log("upgradeItemEffect",e);var t=this.effectMgr.createAnimation("effect/backpack/sj",{speed:1,repeat:1});t.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,t.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,t.scale=3;var i=this.getAvatarWithItemData(e),a=this.getAvatarCenterOffset(i),n=i.convertToWorldSpaceAR(cc.v2(a.x,a.y));cc.log("upgradeItemEffect ws",n,i.sprite.y);var o=this.node.convertToNodeSpaceAR(n);t.x=o.x,t.y=o.y,this.node.addChild(t),this.effectMgr.playEffect("sound/checkpoint/get_item")},addBlockEffect:function(e){cc.log("addBlockEffect",e);var t=this.blockAvatars[e.y+"-"+e.x];for(var i in e.shape){var a=this.effectMgr.createAnimation("effect/backpack/gezi",{speed:1,repeat:1});a.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,a.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,a.scale=3;var n=e.shape[i],o={x:95*n[0],y:95*n[1]};cc.log("addBlockEffect",i,o);var r=t.convertToWorldSpaceAR(cc.v2(o.x,o.y)),s=this.node.convertToNodeSpaceAR(r);a.x=s.x,a.y=s.y,this.node.addChild(a)}this.effectMgr.playEffect("sound/checkpoint/set_weapon")},enableUI:function(e){this.uiNode.active=e,this.topUiNode.active=e,this.setUITouchable(e)},updateBlockAvatars:function(){for(var e in this.blockAvatars)this.blockAvatars[e].showFitColor?(this.blockAvatars[e].opacity=255,this.blockAvatars[e].color=this.blockAvatars[e].showFitColor):(this.blockAvatars[e].opacity=(this.blockData[this.blockAvatars[e].posY][this.blockAvatars[e].posX]?255:this.blockEditMode&&128)||0,this.blockAvatars[e].color=cc.color(255,255,255))},updatePerfectBorderAvatar:function(){},enableBlockEditMode:function(e){cc.log("enableBlockEditMode",e),this.blockEditMode=e,this.updatePerfectBorderAvatar(),this.updateBlockAvatars(),this.updateBlockSideAvatar()},attach:function(e,t,i,a){void 0===i&&(i=0),void 0===a&&(a=0),cc.warn("VehicleAvatar attach!",e,i,a);var n=this.tank.getChildByName("top").getComponent(dragonBones.ArmatureDisplay),o=this.attachUtil;o||(this.attachUtil=o=n.attachUtil),o.generateAttachedNodes(e);var r=o.getAttachedNodes(e),s=r[0];if(!s)throw console.log("attach no bone:"+e+","+r),new Error("attach no bone:"+e+","+r);t.parent&&t.removeFromParent(),s.addChild(t),t.scale0||(t.scale0=t.scale),t.scale=t.scale0/ANIME_SCALE,t.attachBone=s,t.x=a,t.y=-i,t.angle=-90,t.attachName=e},getAvatarWithItemData:function(e){for(var t in this.itemAvatars)if(cc.log("getAvatarWithItemData",this.itemAvatars[t].itemData,e,this.itemAvatars[t].itemData==e),this.itemAvatars[t].itemData==e)return this.itemAvatars[t]},initBlocksAvatar:function(){var e=this.blockData;for(var t in e)for(var i in e[t])this.addBlockAvatar(t,i);this.updateBlockSideAvatar()},updateBlockSprite:function(e){cc.resources.load("avatar/backpack/block",cc.SpriteFrame,function(t,i){if(t)cc.log("load SpriteFrame err",t);else if(cc.isValid(e)){var a=i;e.spriteFrame=a}})},updateBlockSideAvatar:function(){var e,t=this.blockData;for(var i in e="v3"==this.vid?"avatar/backpack/side2":"avatar/backpack/side",t)for(var a in t[i]){var n=this.blockAvatars[i+"-"+a];if(n.decorationAvatars)for(var o in n.decorationAvatars)n.decorationAvatars[o].destroy();if(n.decorationAvatars=[],!this.blockEditMode&&t[i][a]){if(!t[i][a-1]){var r=this.createSprite(-50,0,e);n.addChild(r),n.decorationAvatars.push(r)}if(cc.log("blockDataj+1",t[i][a],t[i][a+1]),!t[i][+a+1]){var s=this.createSprite(65,0,"avatar/backpack/embrasures");n.addChild(s),r=this.createSprite(50,0,e),n.addChild(r),n.decorationAvatars.push(r),n.decorationAvatars.push(s)}t[i-1]&&t[i-1][a]||((r=this.createSprite(0,50,e)).angle=90,n.addChild(r),n.decorationAvatars.push(r)),t[+i+1]&&t[+i+1][a]||((r=this.createSprite(0,-50,e)).angle=90,n.addChild(r),n.decorationAvatars.push(r))}}},addBlockAvatar:function(e,t){var i=this.blockData;if(this.blockAvatars[e+"-"+t])return i[e][t]?this.blockAvatars[e+"-"+t].opacity=255:this.blockAvatars[e+"-"+t].opacity=0,void(i[e][t]&&this.updateBlockSprite(this.blockAvatars[e+"-"+t].getComponent(cc.Sprite)));var a=cc.instantiate(this.blockInstance);return a.active=!0,cc.log("addBlockAvatar",i,e,t),i[e][t]?a.opacity=255:a.opacity=0,i[e][t]&&this.updateBlockSprite(a.getComponent(cc.Sprite)),a.x=95*(-(i[e].length-1)/2+ +t),a.y=95*-(-(i.length-1)/2+ +e),a.posX=t,a.posY=e,this.blockNode.addChild(a),this.blockAvatars[e+"-"+t]=a,!0},createItem:function(e,t){this.blockItemData.push(e);var i=this.addItemAvatar(e);return t&&this.setAdAvatar(i),i},removeItem:function(e){for(var t in this.blockItemData)if(this.blockItemData[t]==e){this.blockItemData.splice(t,1),this.removeItemAvatar(e),this.updateEquipmentStats();break}},initItemsAvatar:function(){var e=this.blockItemData;for(var t in e)this.addItemAvatar(e[t])},removeItemAvatar:function(e){for(var t in this.itemAvatars)if(this.itemAvatars[t].itemData==e)return this.itemAvatars[t].destroy(),void delete this.itemAvatars[t]},addItemAvatar:function(e){var t=BackpackItemDefine[e.id],i=t.shape,a=new cc.Node;a.itemData=e,this.itemAvatars.push(a),this.blockNode.addChild(a);var n=new cc.Node;for(var o in a.addChild(n),t.block||(n.active=!1),a.shapeNode=n,i){var r=cc.instantiate(this.itemBlockInstance);r.active=!0,r.x=95*i[o][0],r.y=95*i[o][1],n.addChild(r)}if(t.unitID){var s;cc.log("addItemAvatar unitID",t.unitID);var c=ENTITY[t.unitID].avatar;c.frm?(s=this.createSprite(0,0,c.frm)).x+=t.unitDx||0:c.anime&&((s=menuManager.createArmature(c.anime,c.animeName,function(){})).scale*=2,s.x+=t.unitDx||0),s.scale*=c.s||1,null!=c.ax?s.anchorX=c.ax:s.anchorX=.5,null!=c.ay?s.anchorY=c.ay:s.anchorY=.5,s.x+=c.dx||0,s.y+=c.dy||0,s.x+=t.unitDx||0,s.y-=37.5,a.sprite=s,a.addChild(s),cc.log("addItemAvatar sprite",s.x,s.y,s.anchorX,s.anchorY)}return this.updateItemAvatarPos(a),a},createSprite:function(e,t,i){var a=new cc.Node;a.x=e,a.y=t;var n=a.addComponent(cc.Sprite);return cc.resources.load(i,cc.SpriteFrame,function(e,t){n.spriteFrame=t}),a},updateItemAvatarPos:function(e){var t=e.itemData;t.pos?(e.x=95*(-(this.blockData[t.pos[0]].length-1)/2+ +t.pos[0]),e.y=95*((this.blockData.length-1)/2-t.pos[1]),e.parent=this.blockNode):this.updateDrawItemsAvatarPos()},updateAllitemsAvatarPos:function(){this.updateBlockItemsAvatarPos(),this.updateDrawItemsAvatarPos()},updateBlockItemsAvatarPos:function(e){for(var t in this.itemAvatars)(e=this.itemAvatars[t]).itemData.pos&&this.updateItemAvatarPos(e)},updateDrawItemsAvatarPos:function(){cc.log("updateDrawItemsAvatarPos start");var e=0,t=0,i=0,a=[],n=[];for(var o in this.itemAvatars){var r=this.itemAvatars[o];a.push(r)}for(var o in a.sort(function(e,t){return e.x-t.x}),a){var s=(r=a[o]).itemData;if(!s.pos&&!r.moving){a.push(r);var c,l,d=BackpackItemDefine[s.id].shape,h=(t=0,i=0,0),u=0;for(var p in d)d[p][0]<t&&(t=+d[p][0]),d[p][0]>i&&(i=+d[p][0]),d[p][1]<u&&(u=+d[p][1]),d[p][1]>h&&(h=+d[p][1]);var f=i-t+1;c=e+95*1.1*((f-(i+t))/2),l=-522.5-(h+u)/2*95,e+=95*f,r.stopAllActions(),n.push(r),r.parent=this.drawNode,r.tx=c,r.ty=l}}for(var o in n)(r=n[o]).tx-=e/2,r.x||r.y?(r.runAction(cc.moveTo(.2,cc.v2(r.tx,r.ty))),r.angle||(r.angle=15*Math.random()-7.5)):(r.x=r.tx,r.y=r.ty,r.angle=15*Math.random()-7.5)},moveItemToBlock:function(e,t,a){if(!BackpackItemDefine[e.id].block){e.pos=[t,a],cc.log("moveItemToBlock",e,t,a);var n=this.checkCanCombineItems(e);if(n){var o=this.combineItems(n,e);return o&&{state:"upgrade",itemData:o}}if(this.checkBorder(e))return this.moveItemToDraw(e),void cc.log("moveItemToBlock checkBorder true");var r=this.checkCollision(e);if(r)for(var s in cc.log("moveItemToBlock checkCollision true",r),r)this.moveItemToDraw(r[s]);return{state:"moveToBlock"}}if(cc.log("moveItemToBlock target is block",e,t,a),1==user.getGuide("backpack")&&i.FirebaseTracking.logNewTutorial({Step:4,userID:user.uuid,Status:1}),this.checkPerfectBorder(e,t,a)){var c=this.addBlocks(e,t,a);return c&&{state:"addBlock",addBlockInfo:c}}this.moveItemToDraw(e)},checkPerfectBorder:function(e,t,i){var a=BackpackItemDefine[e.id].shape,n=this.blockData,o=!1;for(var r in a){var s=+t+a[r][0],c=+i-a[r][1];if(!this.blockData[c]||0!=this.blockData[c][s])return cc.log("checkPerfectBorder false:shape is not in empty block block",s,c),!1;o||(n[c][s-1]?(cc.log("checkPerfectBorder left found",s,c),o=!0):n[c][s+1]?(cc.log("checkPerfectBorder right found",s,c),o=!0):n[c-1]&&n[c-1][s]?(cc.log("checkPerfectBorder top found",s,c),o=!0):n[c+1]&&n[c+1][s]&&(cc.log("checkPerfectBorder bottom found",s,c),o=!0))}return o?cc.log("checkPerfectBorder true",t,i):cc.log("checkPerfectBorder false:need adjacent exist block",t,i),o},checkCanCombineItems:function(e,t,i){if(cc.log("checkCanCombineItems",this.blockItemData),BackpackItemDefine[e.id].upgrade){if(t){var a=e.pos;i&&(a=null);var n=a&&t.pos&&a[0]==t.pos[0]&&a[1]==t.pos[1];return a||t.pos||(n=!0),t!=e&&e.id==t.id&&n?t:void 0}for(var o in this.blockItemData)if(this.blockItemData[o]!=e&&e.id==this.blockItemData[o].id&&e.pos&&this.blockItemData[o].pos&&e.pos[0]==this.blockItemData[o].pos[0]&&e.pos[1]==this.blockItemData[o].pos[1])return this.blockItemData[o]}else cc.log("checkCanCombineItems no upgrade",e)},checkBorder:function(e,t,i){var a=BackpackItemDefine[e.id].shape,n=t||e.pos[0],o=i||e.pos[1];for(var r in a){var s=+n+a[r][0],c=+o-a[r][1];if(!this.blockData[c]||!this.blockData[c][s])return cc.log("checkBorder noBlock",s,c,e,a),!0}return!1},checkCollision:function(e){BackpackItemDefine[e.id],cc.log("checkCollision",e);var t=[];for(var i in this.blockItemData)this.blockItemData[i].pos&&this.blockItemData[i]!=e&&this.check2ItemCollision(this.blockItemData[i],e)&&t.push(this.blockItemData[i]);if(t.length>0)return t},check2ItemCollision:function(e,t){cc.log("check2ItemCollision",e,t);var i=BackpackItemDefine[e.id].shape,a=BackpackItemDefine[t.id].shape;for(var n in i){var o=+e.pos[0]+i[n][0],r=+e.pos[1]-i[n][1];for(var s in a){var c=+t.pos[0]+a[s][0],l=+t.pos[1]-a[s][1];if(cc.log("check2ItemCollision block",o,r,c,l),o==c&&r==l)return!0}}},moveItemToDraw:function(e){console.log("moveItemTo Draw"),e.pos=null},addBlocks:function(e,t,i){var a=BackpackItemDefine[e.id].shape;for(var n in a){var o=+t+a[n][0],r=+i-a[n][1];this.blockData[r][o]=1,this.addBlockAvatar(r,o),this.removeItem(e),this.updateDrawItemsAvatarPos()}return this.updateBlockSideAvatar(),{shape:a,x:t,y:i}},upgradeItem:function(e){var t=BackpackItemDefine[e.id];if(t.upgrade){var i=kit.clone(e);return i.id=t.upgrade,this.removeItem(e),this.createItem(i),i}},combineItems:function(e,t){var i=this.upgradeItem(e);return i&&(this.removeItem(t),cc.log("combineItems success",i)),i},updateMovingItemBgColor:function(e,t){for(var i in this.blockAvatars)this.blockAvatars[i].showFitColor=!1;if(e){var a,n=BackpackItemDefine[e.itemData.id];for(var i in a=n.block?this.checkMovingBlockFit(e,t):this.checkMovingItemFit(e,t),n.shape){var o=this.isTouchPosInBlock(t,95*n.shape[i][0],95*n.shape[i][1]);(n.block?o&&this.blockData[o.y]&&!this.blockData[o.y][o.x]:o&&this.blockData[o.y][o.x])&&this.blockAvatars[o.y+"-"+o.x]&&(this.blockAvatars[o.y+"-"+o.x].showFitColor=a&&cc.color(0,255,0)||cc.color(255,255,0))}}this.updateBlockAvatars()},checkMovingItemFit:function(e,t){var i=this.isTouchPosInBlock(t);return!(!i||this.checkBorder(e.itemData,i.x,i.y))},checkMovingBlockFit:function(e,t){var i=this.isTouchPosInBlock(t);return!(!i||!this.checkPerfectBorder(e.itemData,i.x,i.y))},backToMenu:function(){menuManager.back()},initTouch:function(){this.touchNode=this.node;var e=this.touchNode;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this),this.touch={}},_startIdleTracking:function(){if(console.log(" hceck _startIdleTracking",pc.getChapterIndex()),!(pc.getChapterIndex()>=3)){this._idleCheckInterval&&clearInterval(this._idleCheckInterval);var e=this;this._idleCheckInterval=setInterval(function(){!e.isActiveGuide&&e.bottomUINode&&(e._idleSuggestionActive||(e._idleTimer+=.1,e._idleTimer>=5&&e._showIdleSuggestion()))},100)}},_stopIdleTracking:function(){this._idleCheckInterval&&(clearInterval(this._idleCheckInterval),this._idleCheckInterval=null)},_resetIdleTimer:function(){if(!this._isResettingIdle){this._isResettingIdle=!0,this._idleTimer=0,this._idleSuggestionActive&&this._hideIdleSuggestion();var e=this;setTimeout(function(){e._isResettingIdle=!1},100)}},resetIdleSuggestion:function(){this._resetIdleTimer()},_showIdleSuggestion:function(){this._idleSuggestionActive=!0;var e=!1;for(var t in this.blockItemData)if(!this.blockItemData[t].pos){e=!0;break}if(e){var i=[],a=[],n=[];for(var t in this.itemAvatars)if((f=this.itemAvatars[t]).itemData&&!f.itemData.pos){var o={avatar:f,itemData:f.itemData,x:f.x};i.push(o),BackpackItemDefine[f.itemData.id].block?n.push(o):a.push(o)}if(0===i.length)e=!1;else{var r=null,s=null;if(a.length>0&&(a.sort(function(e,t){return e.x-t.x}),r=a[Math.floor((a.length-1)/2)].itemData,s=this._findFirstEmptySlot(!1)),!s&&a.length>0){r=null;var c=function(e){var t=e.match(/(\d)$/);if(t){var i=parseInt(t[1]);if(i>=2&&i<=4)return i}return 1},l=0,d=null;for(t=0;t<a.length;t++){console.log("Sugg check unplacedEquipment[i]  ",a[t]);var h=a[t].itemData.id;console.log("Sugg ",h);var u=c(h);console.log("Sugg ",u,"maxLevelUnplaced",l),u>l&&(l=u,d=a[t])}var p=0;for(var t in this.itemAvatars){var f;(f=this.itemAvatars[t]).itemData&&f.itemData.pos&&(u=c(f.itemData.id))>p&&(p=u)}if(console.log("Sugg maxLevelUnplaced",l,"maxLevelPlaced",p,d),l>=p&&d)r=d.itemData,s=this._findMatchingEquipmentSlot(d.itemData.id)||this._findFirstOccupiedSlot()}if(!s&&n.length>0&&(n.sort(function(e,t){return e.x-t.x}),r=n[Math.floor((n.length-1)/2)].itemData,s=this._findFirstEmptySlot(!0)),r&&s)return void this._createEquipmentToSlotPointer(r,s)}}var m=null,g=parseInt(this.drawCost.string)||0,v=chapter.get("gold");if(this.btnDrawItems&&v>=g)m=this.btnDrawItems;else if(this.uiNode){var y=this.uiNode.getChildByName("bottom").getChildByName("btnAction");y&&(m=y.getChildByName("btn_start"))}m&&(this._createFingerPointer(m),this._createButtonHighlight(m))},_hideIdleSuggestion:function(){this._idleSuggestionActive=!1,this._idleSuggestionNode&&(this._idleSuggestionNode.destroy(),this._idleSuggestionNode=null),this._highlightedButton&&(this._highlightedButton.stopAllActions(),this._highlightedButton.setScale(1),this._highlightedButton=null)},_createFingerPointer:function(e){var t=this;this._idleSuggestionNode&&(this._idleSuggestionNode.destroy(),this._idleSuggestionNode=null),cc.resources.load("prefab/hand_finger",cc.Prefab,function(i,a){if(!i){t._idleSuggestionNode&&(t._idleSuggestionNode.destroy(),t._idleSuggestionNode=null);var n=cc.instantiate(a);e.addChild(n,9999),n.setPosition(cc.v2(50,-30)),t._idleSuggestionNode=n}})},_createButtonHighlight:function(e){this._highlightedButton=e;var t=cc.sequence(cc.scaleTo(.3,1),cc.scaleTo(.3,1.05));e.runAction(cc.repeatForever(t))},_findFirstEmptySlot:function(e){if(!this.blockData)return null;if(e){for(var t=0;t<this.blockData.length;t++)for(var i=0;i<this.blockData[t].length;i++)if(0===this.blockData[t][i]){for(var a=!1,n=[[-1,0],[1,0],[0,-1],[0,1]],o=0;o<n.length;o++){var r=t+n[o][0],s=i+n[o][1];if(r>=0&&r<this.blockData.length&&s>=0&&s<this.blockData[0].length&&this.blockData[r][s]>0){a=!0;break}}if(a)return{row:t,col:i}}return null}for(var c=[],l=0;l<this.blockData.length;l++){c[l]=[];for(var d=0;d<this.blockData[l].length;d++)c[l][d]=!1}for(var h in this.blockItemData){var u=this.blockItemData[h];if(u.pos&&!BackpackItemDefine[u.id].block){var p=parseInt(u.pos[0]),f=parseInt(u.pos[1]),m=BackpackItemDefine[u.id].shape;for(var g in m)t=f-m[g][1],i=p+m[g][0],t>=0&&t<c.length&&i>=0&&i<c[0].length&&(c[t][i]=!0)}}for(t=0;t<this.blockData.length;t++)for(i=0;i<this.blockData[t].length;i++){var v=this.blockData[t][i]>0,y=c[t][i];if(v&&!y)return{row:t,col:i}}return null},_findMatchingEquipmentSlot:function(e){var t=function(e){return e.replace(/[2-4]$/,"")},i=t(e);for(var a in this.itemAvatars){var n=this.itemAvatars[a];if(n.itemData&&n.itemData.pos&&t(n.itemData.id)===i){var o=parseInt(n.itemData.pos[0]);return{row:parseInt(n.itemData.pos[1]),col:o}}}return null},_findFirstOccupiedSlot:function(){for(var e in this.itemAvatars){var t=this.itemAvatars[e];if(t.itemData&&t.itemData.pos&&!BackpackItemDefine[t.itemData.id].block){var i=parseInt(t.itemData.pos[0]);return{row:parseInt(t.itemData.pos[1]),col:i}}}return null},_createEquipmentToSlotPointer:function(e,t){var i=this;this._idleSuggestionNode&&(this._idleSuggestionNode.destroy(),this._idleSuggestionNode=null);var a=null;for(var n in this.itemAvatars)if(this.itemAvatars[n].itemData===e){a=this.itemAvatars[n];break}a?cc.resources.load("prefab/hand_finger",cc.Prefab,function(e,n){if(e)console.error("[BackpackMenu] Failed to load hand_finger prefab:",e);else{i._idleSuggestionNode&&(i._idleSuggestionNode.destroy(),i._idleSuggestionNode=null);var o=cc.instantiate(n);i.uiNode.addChild(o,9999);var r=a.convertToWorldSpaceAR(cc.v2(30,0)),s=i.uiNode.convertToNodeSpaceAR(r),c=t.row+"-"+t.col,l=i.blockAvatars[c];if(l){var d=l.convertToWorldSpaceAR(cc.v2(0,0)),h=i.uiNode.convertToNodeSpaceAR(d),u=cc.v2(h.x,h.y);o.setPosition(s),o.opacity=255;var p=o.getComponent(cc.Animation),f=null;p&&p.getClips().length>=2&&(f=p.getClips()[1],p.play(f.name)),cc.tween(o).delay(.2).to(1,{position:u},{easing:"sineInOut"}).to(.4,{opacity:0},{easing:"sineOut"}).call(function(){o.setPosition(s),o.opacity=255,f&&p.play(f.name)}).delay(.2).union().repeatForever().start(),i._idleSuggestionNode=o}else console.error("[BackpackMenu] Block avatar not found for slot:",c)}}):console.error("[BackpackMenu] Could not find avatar for unplaced item:",e.id)},onTouchBegan:function(e){if(console.log("[onTouchBegan] Resetting idle timer from:",this._idleTimer),this._resetIdleTimer(),!this.noItemDraggable){var t,i;for(var a in this.itemAvatars){var n=this.itemAvatars[a],o=n.convertToWorldSpaceAR(cc.v2(0,0)),r=BackpackItemDefine[n.itemData.id].shape;for(var s in r){var c=o.x+95*r[s][0],l=o.y+95*r[s][1],d=kit.norm(c-e.x,l-e.y);d<65&&!n.locked&&(!t||d<t)&&(t=d,i=n)}}if(i){if(i.needAD)return void this.adUnlockAvatar(i);this.movingAvatar=i,i.stopAllActions(),i.moving=!0,i.oZIndex=i.zIndex,i.zIndex=999,i.parent=this.drawNode,i.angle=0;var h=this.movingAvatar.parent.convertToNodeSpaceAR(cc.v2(e.x,e.y)),u=this.getAvatarCenterOffset(this.movingAvatar);return this.movingAvatar.x=h.x-u.x,this.movingAvatar.y=h.y-u.y+95/3,BackpackItemDefine[this.movingAvatar.itemData.id].block&&this.enableBlockEditMode(!0),this.effectMgr.playEffect("sound/checkpoint/pick_item"),this.updateDrawItemsAvatarPos(),this.movingAvatar.ox=this.movingAvatar.x,this.movingAvatar.oy=this.movingAvatar.y,this.movingAvatar.distance=0,!0}}},onTouchMoved:function(e){if(this.movingAvatar){var t=this.getAvatarCenterOffset(this.movingAvatar),i=(e=cc.v2(e.x-t.x,e.y-t.y+95/3),this.movingAvatar.parent.convertToNodeSpaceAR(e));this.movingAvatar.x=i.x,this.movingAvatar.y=i.y,this.updateMovingItemBgColor(this.movingAvatar,e),this.movingAvatar.distance+=kit.norm(this.movingAvatar.x-this.movingAvatar.ox,this.movingAvatar.y-this.movingAvatar.oy),menuManager.checkGuideFinish("onTouchMoved")}},onTouchEnded:function(e){if(this.movingAvatar){(t=this.movingAvatar).zIndex=t.oZIndex;var t,i,a=BackpackItemDefine[t.itemData.id],n=this.getAvatarCenterOffset(this.movingAvatar);e.x-=n.x,e.y-=n.y-95/3;var o=this.isTouchPosInBlock(e);o?(i=this.moveItemToBlock(this.movingAvatar.itemData,o.x,o.y))&&("upgrade"==i.state?r=i.itemData:"addBlock"==i.state?this.addBlockEffect(i.addBlockInfo):"moveToBlock"==i.state&&this.effectMgr.playEffect(s)):(t=this.isTouchPosInAvatar(e,this.movingAvatar))&&(i=this.checkCanCombineItems(this.movingAvatar.itemData,t.itemData,!0))?r=this.combineItems(i,this.movingAvatar.itemData):this.moveItemToDraw(this.movingAvatar.itemData),BackpackItemDefine[this.movingAvatar.itemData.id].block&&this.enableBlockEditMode(!1),this.movingAvatar.moving=!1,this.updateAllitemsAvatarPos(),this.updateMovingItemBgColor(),r&&this.upgradeItemEffect(r),cc.log("_________________[BackpackMenu] onTouchEnded__________________"),this.updateVehicleObj(),this.updateEquipmentStats(),this.movingAvatar.distance<50&&a.infoType&&menuManager.pop("backpack_item_info",{itemData:this.movingAvatar.itemData}),this.movingAvatar=!1,menuManager.checkGuideFinish("onTouchEnded")}var r,c=this;if(this.itemsInDrawArea=this.blockItemData.filter(function(e){return!e.pos}),console.log(this.itemsInDrawArea.length,user.getGuide("refreshBackpack"),user.getGuide("freeAds"),pc.getChapterIndex()),0==this.itemsInDrawArea.length){if(4!=user.getGuide("freeAds")||user.getGuide("refreshBackpack")||1!=pc.getChapterIndex()||(cc.Canvas.instance.node.focusNode&&c.setItemDraggable(!0),c.isActiveGuide||(c.isActiveGuide=!0,c.guideRefresh())),5==user.getGuide("freeAds"))return(r=this.bottomBtnLayoutNode.getChildren())[1].opacity=255,r[1].getComponent(cc.Button).interactable=!0,c.setItemDraggable(!1),void menuManager.focusOn(r[1],LI("zc_guide_30"),function(){user.setGuide("freeAds",6),user.quickSave("guide.freeAds",6),c.setItemDraggable(!0)},null,null,{dy:0,dx:-100,z:998})}else c.setItemDraggable(!0)},onTouchCanceled:function(e,t){this.onTouchEnded(e,t)},isTouchPosInBlock:function(e,t,i){for(var a in void 0===t&&(t=0),void 0===i&&(i=0),this.blockAvatars){var n=this.blockAvatars[a].convertToWorldSpaceAR(cc.v2(-t,-i));if(kit.norm(n.x-e.x,n.y-e.y)<50)return{x:this.blockAvatars[a].posX,y:this.blockAvatars[a].posY}}},isTouchPosInAvatar:function(e,t){for(var i in this.itemAvatars){var a=this.itemAvatars[i].convertToWorldSpaceAR(cc.v2(0,0));if(this.itemAvatars[i]!=t&&kit.norm(a.x-e.x,a.y-e.y)<60)return this.itemAvatars[i]}},initTalents:function(){var e=this.getTalents();e&&(0==this.args.mapIndex&&(cc.log("initTalents",e,this.vehicleConfig),Talent.effect("backpackInit",e,this)),Talent.effect("backpack",e,this))},pushItem:function(e){var t={id:e},i=!1;for(var a in this.blockData){for(var n in this.blockData[a])if(this.blockData[a][n])if(t.pos=[n,a],cc.log("pushItem pos",e,n,a),this.checkBorder(t))cc.log("pushItem moveItemToBlock checkBorder true");else{var o=this.checkCollision(t);if(!o){i=!0;break}cc.log("pushItem moveItemToBlock checkCollision true",o)}if(i)break}cc.log("pushItem",t),this.createItem(t)},getTalents:function(){var e,t=kit.clone(chapter.data.talent);if(null!=(e=this.vehicleConfig)&&e.talents&&(t=t.concat(this.vehicleConfig.talents)),this)for(var i in this.blockItemData){var a=this.blockItemData[i],n=BackpackItemDefine[a.id];if(cc.log("adventure run talents from backpack",a.id,n.talent),a.pos){var o=equipment.getStats(n.type);if(o)for(var r in cc.log("\u53d1\u73b0\u88c5\u5907\u5bf9\u5e94\u6570\u636e",a.type,o),o)if(o[r]&&TalentDefine[r]){var s={id:r,num:o[r]*Math.pow(1.5,n.rarity),backpack:a};t.push(s),cc.log("\u88c5\u5165\u88c5\u5907\u5bf9\u5e94\u5929\u8d4b",r,o[r],s)}if(n.talent)if("object"==typeof n.talent){var c=kit.clone(n.talent);c.backpack=a,t.push(c)}else t.push({id:n.talent})}}return cc.log("getTalents",t,"\n",JSON.stringify(t)),t},clearDrawItems:function(){for(var e=this.blockItemData.length,t=0;t<e;t++)this.blockItemData[t].pos||(this.removeItem(this.blockItemData[t]),t--,e=this.blockItemData.length);cc.log("clearDrawItems",JSON.stringify(this.blockItemData))},drawItemsAD:function(e){this._resetIdleTimer();var t=this;user.getGuide("refreshBackpack")||1!=pc.getChapterIndex()||(user.setGuide("refreshBackpack",1),user.quickSave("guide.refreshBackpack",1)),sdk.useTicket("get_refreshlv2",function(i,a){i||(t.drawItems(e,!0,!0),chapter.add("videoCt"),H5VERSION||(e.target.active=!1),a&&YMTJ("video","lv_equipment"))})},drawItems:function(e,t,i){this._resetIdleTimer();var a=this;if(t=t,this.drawItemCtNoAd<this.freeDrawCt&&(t=!0),!t){if(!(chapter.get("gold")>=15))return void kit.info(LI("lack_silver_coin"),function(){menuManager.pop("video",{title:LI("ad_silver_coin30"),icon:a.iconFrame,name:"x30",type:"adTicket",checkCb:function(e){e&&sdk.useTicket("get_30sliver",function(e,t){e||(t&&YMTJ("video","lv_silver_coin"),chapter.add("videoCt"),chapter.data.gold+=30,a.updateDrawCost())})}})});chapter.add("gold",-15)}this.checkForcedDraw(i);var n=!1;this.drawItemCt++,i?this.drawItemCtAd++:this.drawItemCtNoAd++,this.updateDrawCost();var o=this.forcedDrawItems;this.clearDrawItems(),this.drawHistory&&(this.drawHistory=[],console.log("[BackpackMenu] Cleared draw history for new draw cycle")),i?chapter.data.drawBlockBonusAD>=window.BONUS_BLOCK_THRESHOLD&&(n="block"):chapter.data.drawBlockBonus>=window.BONUS_BLOCK_THRESHOLD&&(n="block");var r=this.drawItem(o&&o[0],"weapon",null,i);this.drawExclude[r.id]=!0;var s=this.drawItem(o&&o[1],n,null,i);this.drawExclude[s.id]=!0,this.lastDrawWeights&&(console.log("========== DRAW #2 (Type: "+(n||"any")+") PERCENTAGES =========="),this.lastDrawWeights.forEach(function(e){console.log("  "+e.itemId+": "+e.percentage+"%")}),console.log("  >>> SELECTED: "+s.id),console.log("=======================================================")),this.updateDebugWeights(2,n||"any",s.id);var c=this.drawItem(o&&o[2],null,null,i);this.drawExclude[c.id]=!0,this.lastDrawWeights&&(console.log("========== DRAW #3 (Type: any) PERCENTAGES =========="),this.lastDrawWeights.forEach(function(e){console.log("  "+e.itemId+": "+e.percentage+"%")}),console.log("  >>> SELECTED: "+c.id),console.log("=======================================================")),this.updateDebugWeights(3,"any",c.id),console.log("Result Draw 3 Item",r,s,c),this.bonusRefreshItem1&&1==this.drawItemCt&&(this.drawItem(),this.bonusRefreshItem1=0),i&&this.drawItem(o&&o[3],"weappon",1,i),window.NO_SAME_ITEM_DRAW_COUNT&&window.NO_SAME_ITEM_DRAW_COUNT--,console.log("[NO_SAME_ITEM_DRAW_COUNT] drawItems",window.NO_SAME_ITEM_DRAW_COUNT),this.forcedDrawItems=null;var l=[r,s,c];for(var d in cc.log("drawItems",JSON.stringify(this.blockItemData)),l)if(BackpackItemDefine[l[d].id].block)return void(i?chapter.data.drawBlockBonusAD=0:chapter.data.drawBlockBonus=0);var h=this.getBlocksLeft();i?chapter.data.drawBlockBonusAD+=window.DRAW_BLOCK_BONUS_AD*h:chapter.data.drawBlockBonus+=window.DRAW_BLOCK_BONUS*h},getBlocksLeft:function(){var e=0,t=0;for(var i in this.blockData)for(var a in this.blockData[i])this.blockData[i][a]&&t++,e++;return(e-t)/(e-9)||0},drawItem:function(e,t,i,a){console.log("--\x3e>>drawItem",t);var n="weapon"==t,o="block"==t,r=[];for(var s in window.DRAW_ITEMS_POWER.rarity)"block"==s&&n||r.push(window.DRAW_ITEMS_POWER.rarity[s]);var c=kit.rollWithPower(r);cc.log("rollArray",r,c,n);var l=c;3==l&&(l="block"),o&&(l="block"),i&&(l=i),0==l&&this.bonusRarity1&&Math.random()<this.bonusRarity1&&(l=1),0==l&&window.RARITY_UPGRADE_CONFIG&&Math.random()<window.RARITY_UPGRADE_CONFIG.bonusRarity1_chance&&(l=window.RARITY_UPGRADE_CONFIG.bonusRarity1_target,cc.log("[BackpackMenu] Rarity0 upgraded to rarity"+window.RARITY_UPGRADE_CONFIG.bonusRarity1_target+"!"));var d=!1;2!=l||e||(d=!0,0==c&&window.RARITY_UPGRADE_CONFIG&&(Math.random()<1-window.RARITY_UPGRADE_CONFIG.bonusRarity1_adChance?(d=!1,cc.log("[BackpackMenu] Lucky! Rarity"+window.RARITY_UPGRADE_CONFIG.bonusRarity1_target+" upgrade without ad!")):(d=!0,cc.log("[BackpackMenu] Rarity"+window.RARITY_UPGRADE_CONFIG.bonusRarity1_target+" upgrade requires watching ad"))));var h=[];for(var s in BackpackItemDefine){var u=BackpackItemDefine[s],p=!1;if("block"==l?u.block&&(p=!0):l==u.rarity&&(p=!0),this.currentEquip&&p&&"block"!=l)for(var f in p=!1,this.currentEquip)if(this.currentEquip[f]==u.type||u.equip){p=!0;break}!p||n&&"weapon"!=u.infoType||h.push(s)}console.log("check d drawItem ",h,l,a);var m=e||this.getBackpackRollPower(h,"block"==l,a),g={id:m};return BackpackItemDefine[m]&&BackpackItemDefine[m].needAD&&(d=!0),cc.log("needAD",m,d,l),this.createItem(g,d),g},getBackpackRollPower:function(e,t,i){var a=this;cc.log("getBackpackRollPower ",e,t);var n={};if(!t)for(var o in this.blockItemData){var r=this.blockItemData[o];r.pos&&(l=BackpackItemDefine[r.id]).type&&(n[l.type]||(n[l.type]=1),n[l.type]-=(l.rarity+1)*window.DRAW_ITEMS_POWER.diversity,n[l.type]<.1&&(n[l.type]=.1))}cc.log("getBackpackRollPower \u80cc\u5305\u5df2\u6709\u7269\u54c1\u6743\u91cd",n);var s=[],c=[];for(var o in e){var l,d=e[o];if((l=BackpackItemDefine[d]).type,s[o]=n[l.type]||1,i||0!=this.args.mapIndex?l.drawPower&&(s[o]*=l.drawPower):l.firstDrawPower?s[o]*=l.firstDrawPower:l.drawPower&&(s[o]*=l.drawPower),l.info&&Array.isArray(l.info))for(var h=0;h<l.info.length;h++)if("type_self"===l.info[h]||l.info[h]===LI("type_self")){c.push(o);break}console.log("[NO_SAME_ITEM_DRAW_COUNT] ",window.NO_SAME_ITEM_DRAW_COUNT&&this.drawExclude[d],window.NO_SAME_ITEM_DRAW_COUNT,this.drawExclude[d]),window.NO_SAME_ITEM_DRAW_COUNT&&this.drawExclude[d]&&(s[o]=.001)}if(console.log("[ITEM_TYPE_WEIGHTS] Value window.ITEM_TYPE_WEIGHTS",window.ITEM_TYPE_WEIGHTS),void 0!==window.ITEM_TYPE_WEIGHTS&&c.length>0){var u=0,p=0;for(var o in s)u+=s[o],-1!==c.indexOf(o)&&(p+=s[o]);console.log("[ITEM_TYPE_WEIGHTS] Before adjustment - Total:",u,"Self:",p,"Ratio:",p/u);var f=window.ITEM_TYPE_WEIGHTS*u,m=p+f,g=m+(u-p);if(p>0){for(var v=m/p,y=0;y<c.length;y++)o=c[y],s[o]*=v;var b=(m/g*100).toFixed(1);console.log("[ITEM_TYPE_WEIGHTS] Added weight:",f,"Multiplier:",v.toFixed(2),"Final Self %:",b+"%")}}var k=0;for(var o in s)k+=s[o];this.lastDrawWeights=[],e.forEach(function(e,t){var i=k>0?(s[t]/k*100).toFixed(2):0;a.lastDrawWeights.push({itemId:e,weight:s[t].toFixed(2),percentage:i}),console.log("[ITEM_TYPE_WEIGHTS] Weights of",e,": ",s[t],"(",i+"% )")});var T=kit.rollWithPower(s);return console.log("[ITEM_TYPE_WEIGHTS] Result:",e[T]),this.debugNode&&this.updateDebugWeights(),e[T]},transformBlockItemDataToTowersData:function(){var e=0,t=[];for(var i in this.blockData)for(var a in this.blockData[i])if(this.blockData[i][a]){e=i;break}for(var i in this.blockItemData){var n=this.blockItemData[i];if(n.pos){var o=BackpackItemDefine[n.id],r={stage:e,x:n.pos[0],i:o.unitID,y:n.pos[1],backpack:n};t.push(r)}}return cc.log("transformBlockItemDataToTowersData",t),t},startGameWithAnimation:function(){this.leavingSpd=0,this.tankLeaving=!0,this.enableUI(!1),this.enableBlockEditMode(!1),menuManager.preload("loading"),menuManager.preload("game")},resetEditModeSave:function(){cc.sys.localStorage.setItem("test_backpack",""),cc.sys.localStorage.setItem("test_tower",""),menuManager.back()},startGameEditModeSave:function(){var e=this.transformBlockItemDataToTowersData(),t={blockData:this.blockData,blockItemData:this.blockItemData};t=JSON.stringify(t),cc.sys.localStorage.setItem("test_backpack",t),cc.sys.localStorage.setItem("test_tower",JSON.stringify(e)),cc.log("startGameEditModeSave"),menuManager.back()},startGame:function(){if(this.adventure)return this.startGameWithAnimation();if(this.editMode)return this.startGameEditModeSave();var e={vid:"v1",star:1,attr:{tower:{atk:1,hp:200},hp:300,skill:1,global:{}},towers:this.transformBlockItemDataToTowersData(),heroes:[{i:"h2",star:1}],bench:[{i:"h4",star:1},{i:"h3",star:1}]},t=e.vid,i=e.star,a=e.attr,n=e.hp,o=e.towers,r=e.heroes,s=e.bench,c=e.cd;map.load("map/adv/601",function(e,l){e?kit.info("\u5730\u56fe\u4e0d\u5b58\u5728adv/601"):loadGame({me:1,remotes:{lvl:1,pw:1,entity:{1:{id:t,cd:c,star:i,attr:a,hp:n,towers:o,heroes:r,bench:s}}},mapData:l,reviveFunc:function(){},startFunc:function(){},finishFunc:function(){},pauseFunc:function(e){e.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(t){e.popTimeScale(0),t&&(e.finished=!0,menuManager.back(-1))}})}})})},startGame2:function(){if(!this.gameStarted){this.gameStarted=!0;var e=this.transformBlockItemDataToTowersData();cc.log("startGame2",this.blockData);var t=this.vehicleConfig;t.towers=e,cc.log("BackpackMenu startGame2 vehicleConfig",t),chapter.data.backpack={blockData:this.blockData,blockItemData:this.blockItemData},adventure.run(t)}},toggleBottomUI:function(){this._resetIdleTimer(),this.isToggleBottomUI=!this.isToggleBottomUI,this.bottomUINode.getChildByName("bottom").active=this.isToggleBottomUI,this.toggleBottomUIBtnNode.getChildByName("on_choose").active=this.isToggleBottomUI},quitGame:function(){this._resetIdleTimer(),menuManager.pop("pause",{closeCb:function(e){e&&menuManager.back(-1)}})},streamAddMoney:function(){H5VERSION&&(chapter.data.gold+=100)},onFeedbackBtn:function(){menuManager.pop("feedback",{closeCb:function(){}})},onDestroy:function(){this._stopIdleTracking()}}),window.get2ItemDistance=function(e,t){var i=BackpackItemDefine[e.id].shape,a=BackpackItemDefine[t.id].shape,n=99;for(var o in i){var r=i[o],s=+e.pos[0]+r[0],c=+e.pos[1]-r[1];for(var l in a){var d=a[l],h=+t.pos[0]+d[0],u=+t.pos[1]-d[1],p=Math.abs(s-h)+Math.abs(c-u);p<n&&(n=p)}}return n},window.checkItemTag=function(e,t){var i=BackpackItemDefine[e.id].tag;if(!i||i.constructor!=Array)return t==i;for(var a in i)if(i[a]==t)return!0},window.BackpackUtil={pushItem:function(e,t){var i=t.blockData,a=t.blockItemData,n={id:e},o=!1;for(var r in i){for(var s in i[r])if(i[r][s])if(n.pos=[s,r],cc.log("pushItem pos",e,s,r),BackpackUtil.checkBorder(n,t))cc.log("pushItem moveItemToBlock checkBorder true",e,s,r);else{var c=BackpackUtil.checkCollision(n,t);if(!c){o=!0;break}cc.log("pushItem moveItemToBlock checkCollision true",c,e,s,r)}if(o)return cc.log("pushItem moveItemToBlock push found",n,e,s,r),a.push(n),n}},checkBorder:function(e,t){var i=t.blockData,a=(t.blockItemData,BackpackItemDefine[e.id].shape),n=e.pos[0],o=e.pos[1];for(var r in a){var s=+n+a[r][0],c=+o-a[r][1];if(!i[c]||!i[c][s])return cc.log("checkBorder noBlock",s,c,e,a),!0}return!1},checkCollision:function(e,t){t.blockData;var i=t.blockItemData;BackpackItemDefine[e.id],cc.log("checkCollision",e);var a=[];for(var n in i)i[n].pos&&i[n]!=e&&BackpackUtil.check2ItemCollision(i[n],e)&&a.push(i[n]);if(a.length>0)return a},check2ItemCollision:function(e,t){cc.log("check2ItemCollision",e,t);var i=BackpackItemDefine[e.id].shape,a=BackpackItemDefine[t.id].shape;for(var n in i){var o=+e.pos[0]+i[n][0],r=+e.pos[1]-i[n][1];for(var s in a){var c=+t.pos[0]+a[s][0],l=+t.pos[1]-a[s][1];if(cc.log("check2ItemCollision block",o,r,c,l),o==c&&r==l)return!0}}},transformBlockItemDataToTowersData:function(e){var t=0,i=[];for(var a in e.blockData)for(var n in e.blockData[a])if(e.blockData[a][n]){t=a;break}for(var a in e.blockItemData){var o=e.blockItemData[a];if(o.pos){var r=BackpackItemDefine[o.id],s={stage:t,x:o.pos[0],i:r.unitID,y:o.pos[1],backpack:o};i.push(s)}}return cc.log("BackpackUtil transformBlockItemDataToTowersData",i),i}},cc._RF.pop()},{"../../../Plugins/SDKManager":"SDKManager","../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../components/attributes/Attribute":"Attribute","../../managers/EffectManager":"EffectManager","../../scripts/BackpackItemDefine":"BackpackItemDefine","../../utils/ConsecutiveHPManager":"ConsecutiveHPManager","../../utils/DrawRulesManager":"DrawRulesManager","../core/Menu":"Menu"}],BallBulletSprite:[function(e,t){"use strict";cc._RF.push(t,"4a46aGh1T9Cb45XvWdM226/","BallBulletSprite"),cc.Class({extends:e("./BulletSprite"),updateRender:function(){var e=this.obj;this.dx=(e.x-this.x)/STEP_TIME,this.dy=(e.y-this.y)/STEP_TIME;var t=kit.includeDegree(e.deg,this.deg);this.dr=t/STEP_TIME},updateReal:function(e){this.x+=this.dx*e,this.y+=this.dy*e,this.deg=(this.deg+this.dr*e+360)%360;var t=this.node;t.x=this.x,t.y=this.y,t.angle=this.deg},removeByHitEnd:function(){var e=this.obj;this.streak&&this.streak.remove(e.x,e.y,0),this.node.destroy()},removeByHit:function(){var e=this.obj;if(e.hurtDelayTime<0)throw cc.log(e.define.name),new Error("BulletSprite.removeByHit:obj.hurtDelayTime:"+e.hurtDelayTime);this.node.runActionVS(cc.sequence(cc.moveTo(e.hurtDelayTime||0,e.x,e.y),cc.callFunc(this.removeByHitEnd,this)))}}),cc._RF.pop()},{"./BulletSprite":"BulletSprite"}],Ball:[function(e,t){"use strict";cc._RF.push(t,"3604fRKhFxD9qRP5uiRqtwZ","Ball"),cc.Class({extends:cc.Component,properties:{bulletType:"machine_gun"},update:function(){pinballManager.checkBall(this)}}),cc._RF.pop()},{}],Basket:[function(e,t){"use strict";cc._RF.push(t,"94688xLCV9FLYgdsYMLTTC8","Basket"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},update:function(){this.node.y<-500&&this.node.destroy()}}),cc._RF.pop()},{}],BattlePassItemLevel:[function(e,t){"use strict";cc._RF.push(t,"57acag5mmZCPpare8UxVSl8","BattlePassItemLevel"),cc.Class({extends:cc.Component,properties:{levelLabel:cc.Label,rankLevel:cc.Sprite,frame:cc.Node,listIconRankLevel:[cc.SpriteFrame],lock_free:cc.Node,lock_premium:cc.Node,freeRewardNode:cc.Node,premiumRewardNode:cc.Node,iconNotifi:cc.Sprite,itemReward:cc.Prefab},init:function(e,t,i,a){this.level=e,this.currentLevel=t,this.isPremium=i,this.claimedRewards=a,this.levelConfig=window.BattlePassManager.getLevelConfig(e),this.levelConfig&&(this.initReward(),this.updateUI(),this.updateNotificationIcon(),this.setupEventListeners())},initReward:function(){if(this.levelConfig&&(this.freeRewardNode&&this.setupRewardDisplay(this.freeRewardNode,"free",this.levelConfig.reward.free),this.premiumRewardNode)){var e=Array.isArray(this.levelConfig.reward.premium)?this.levelConfig.reward.premium:[this.levelConfig.reward.premium];this.setupRewardDisplay(this.premiumRewardNode,"premium",e)}},setupRewardDisplay:function(e,t,i){if(e&&this.itemReward){var a=this,n="level_"+this.level+"_"+t,o=!0===this.claimedRewards[n],r=this.currentLevel>this.level;if(e.removeAllChildren(),1===i.length){var s=cc.instantiate(this.itemReward);e.addChild(s);var c=s.getComponent("BattlePassItemReward");if(c){var l={rewards:i};c.init(l,r,o,t,this.isPremium,this.level)}}else i.length>1&&i.forEach(function(i){var n=cc.instantiate(a.itemReward);e.addChild(n);var s=n.getComponent("BattlePassItemReward");if(s){var c={rewards:[i]};s.init(c,r,o,t,a.isPremium,a.level)}});var d=e.getChildByName("claimButton");d&&this.setupClaimButton(d,t,o,r)}},setupClaimButton:function(e,t,i,a){var n=this,o=e.getChildByName("Label"),r=e.getComponent(cc.Button);i?(o&&(o.getComponent(cc.Label).string="Claimed"),r.interactable=!1,r.enableAutoGrayEffect=!0):a?"premium"!==t||this.isPremium?(o&&(o.getComponent(cc.Label).string="Claim"),r.interactable=!0,r.enableAutoGrayEffect=!1,e.off("click"),e.on("click",function(){n.onClaimReward(t)})):(o&&(o.getComponent(cc.Label).string="Premium"),r.interactable=!1,r.enableAutoGrayEffect=!0):(o&&(o.getComponent(cc.Label).string="Locked"),r.interactable=!1,r.enableAutoGrayEffect=!0)},updateUI:function(){if(this.levelConfig){var e=this.currentLevel>this.level;if(this.levelLabel&&(this.levelLabel.string=this.level+1),this.rankLevel&&this.listIconRankLevel&&this.listIconRankLevel.length>=3){var t=0;this.level>=0&&this.level<=9?t=0:this.level>=10&&this.level<=19?t=1:this.level>=20&&(t=2),this.rankLevel.spriteFrame=this.listIconRankLevel[t]}if(this.lock_free&&(this.lock_free.active=!e),this.lock_premium){var i=!e||!this.isPremium;this.lock_premium.active=i}if(this.frame){var a=this.frame.getComponent(cc.Sprite);a&&(this.level>=1&&this.level<=10?a.node.color=new cc.Color(205,127,50):this.level>=11&&this.level<=20?a.node.color=new cc.Color(192,192,192):this.level>=21&&(a.node.color=new cc.Color(128,0,128)))}}},updateNotificationIcon:function(){if(this.iconNotifi&&this.iconNotifi.node){var e=this.currentLevel>this.level,t="level_"+this.level+"_free",i="level_"+this.level+"_premium",a=e&&!this.claimedRewards[t],n=e&&this.isPremium&&!this.claimedRewards[i],o=a||n;this.iconNotifi.node.active=o}},setupEventListeners:function(){var e=this;window.BattlePassManager&&(window.BattlePassManager.on("levelUp",function(t){var i=t.oldLevel,a=t.newLevel;i>e.level!=a>e.level?(e.currentLevel=a,e.updateUI(),e.updateNotificationIcon(),e.updateRewardItemStates()):e.currentLevel=a}),window.BattlePassManager.on("rewardClaimed",function(t){if(t.level===e.level){var i="level_"+e.level+"_"+t.type;e.claimedRewards[i]=!0,e.updateNotificationIcon(),e.updateRewardItemStates();var a="free"===t.type?e.freeRewardNode:e.premiumRewardNode;if(a){var n=a.getChildByName("claimButton");n&&e.setupClaimButton(n,t.type,!0,!0)}}}),window.BattlePassManager.on("premiumPurchased",function(){if(e.isPremium=!0,e.updateUI(),e.updateNotificationIcon(),e.updateRewardItemStates(),e.premiumRewardNode){var t=e.premiumRewardNode.getChildByName("claimButton");if(t){var i=e.currentLevel>e.level,a="level_"+e.level+"_premium",n=e.claimedRewards[a];e.setupClaimButton(t,"premium",n,i)}}}))},updateRewardItemStates:function(){var e=this.currentLevel>this.level;if(this.freeRewardNode){var t="level_"+this.level+"_free",i=!0===this.claimedRewards[t];this.updateRewardNodeStates(this.freeRewardNode,e,i)}if(this.premiumRewardNode){var a="level_"+this.level+"_premium";i=!0===this.claimedRewards[a],this.updateRewardNodeStates(this.premiumRewardNode,e,i)}},updateRewardNodeStates:function(e,t,i){if(e)for(var a=e.children,n=0;n<a.length;n++){var o=a[n].getComponent("BattlePassItemReward");o&&o.updateRewardState&&o.updateRewardState(t,i,this.isPremium)}},onClaimReward:function(e){window.BattlePassManager&&(window.BattlePassManager.claimReward(this.level,e)?window.FirebaseTracking&&window.FirebaseTracking.setDataBiRes("BattlePass_Claim_"+this.level+"_"+e):"undefined"!=typeof kit&&kit.info&&kit.info("Cannot claim reward"))},onDestroy:function(){window.BattlePassManager&&(window.BattlePassManager.off("levelUp"),window.BattlePassManager.off("rewardClaimed"),window.BattlePassManager.off("premiumPurchased"))}}),cc._RF.pop()},{}],BattlePassItemReward:[function(e,t){"use strict";cc._RF.push(t,"6a61cmptC1LhqmizzuSKZCT","BattlePassItemReward"),cc.Class({extends:cc.Component,properties:{itemReward:cc.Node,lockNode:cc.Node,tickNode:cc.Node,claimed:cc.Node,frameRaritySpr:cc.Sprite,listFrameRarity:[cc.SpriteFrame],iconNotifi:cc.Sprite,frame_light:cc.Node,btn_claim:cc.Button},init:function(e,t,i,a,n,o){this.data=e,this.isUnlocked=t,this.isClaimed=i,this.rewardType=a||"free",this.isPremium=n||!1,this.level=o,this.initReward(),this.updateState(),this.updateClaimButtonState()},initReward:function(){if(this.data&&this.data.rewards&&0!==this.data.rewards.length){var e=this.data.rewards[0];if(this.itemReward){var t=this.itemReward.getComponent("Item");if(t&&(t.init(e),this.frameRaritySpr&&this.listFrameRarity&&this.listFrameRarity.length>0)){var i=e.rarity||0;i<this.listFrameRarity.length&&(this.frameRaritySpr.spriteFrame=this.listFrameRarity[i])}}}},updateState:function(){if("premium"===this.rewardType&&!this.isPremium)return this.lockNode&&(this.lockNode.active=!0),this.tickNode&&(this.tickNode.active=!1),this.claimed&&(this.claimed.active=!1),this.iconNotifi&&this.iconNotifi.node&&(this.iconNotifi.node.active=!1),void(this.frame_light&&(this.frame_light.active=!1));var e=this.isUnlocked&&!this.isClaimed;this.lockNode&&(this.lockNode.active=!this.isUnlocked),this.iconNotifi&&this.iconNotifi.node&&(this.iconNotifi.node.active=e),this.frame_light&&(this.frame_light.active=e),this.tickNode&&(this.tickNode.active=this.isClaimed),this.claimed&&(this.claimed.active=this.isClaimed),this.node&&(this.node.opacity=255)},updateClaimButtonState:function(){if(this.btn_claim){var e="premium"===this.rewardType&&!this.isPremium,t=this.isUnlocked&&!this.isClaimed&&!e;this.btn_claim.interactable=t,this.btn_claim.node.active=!this.isClaimed}},onRewardItemClicked:function(){var e="premium"===this.rewardType&&!this.isPremium;this.isUnlocked&&!this.isClaimed&&!e&&this.showClaimPopup()},showClaimPopup:function(){var e=this;if(window.menuManager){var t=this.data.rewards;console.log("[BP_REWARD_DEBUG] Raw rewards array:",t);var i={};t.forEach(function(e,t){i["item"+(t+1)]=e}),console.log("[BP_REWARD_DEBUG] Converted to object:",i);var a=[];window.equipment.getItemFromReward(a,i),console.log("[BP_REWARD_DEBUG] Converted listRewards:",a),net.updateData({items:a},function(t,i){if(t)return console.error("[BP_REWARD_DEBUG] \u274c Failed to send reward to server:",t),void("undefined"!=typeof kit&&kit.info&&kit.info("Failed to save reward to server. Please try again."));"undefined"!=typeof money&&"function"==typeof money.update&&money.update(i),window.BattlePassManager.claimReward(e.level,e.rewardType)?(e.isClaimed=!0,e.updateClaimedVisuals(),console.log("[BP_REWARD_DEBUG] Showing popup with items:",a),window.menuManager.pop("show",{tid:"sign",items:a,checkCb:function(){console.log("[BP_REWARD_DEBUG] Popup closed")}}),window.FirebaseTracking&&window.FirebaseTracking.setDataBiRes("BattlePass_Claim_"+e.level+"_"+e.rewardType)):"undefined"!=typeof kit&&kit.info&&kit.info("Failed to claim reward")})}},updateClaimedVisuals:function(){this.tickNode&&(this.tickNode.active=!0),this.claimed&&(this.claimed.active=!0),this.iconNotifi&&this.iconNotifi.node&&(this.iconNotifi.node.active=!1),this.frame_light&&(this.frame_light.active=!1),this.node&&(this.node.opacity=255)},updateRewardState:function(e,t,i){this.isUnlocked=e,this.isClaimed=t,void 0!==i&&(this.isPremium=i),this.updateState(),this.updateClaimButtonState()},onDestroy:function(){}}),cc._RF.pop()},{}],BattlePassManager:[function(e,t,i){"use strict";cc._RF.push(t,"58e2bJNfPNFmp4t9Iq14umW","BattlePassManager"),Object.defineProperty(i,"__esModule",{value:!0});var a=e("../core/EventSystem"),n=e("../TimeManager"),o=e("./BattlePassSeasonManager"),r=function(e){function t(){var t=e.call(this)||this;return t.levelConfig=new Map,t.extraRewardConfig={},t.progress={level:0,exp:0,extraExp:0,premium:!1,seasonId:"",claimedRewards:{}},t.configLoaded=!1,t.extraConfigLoaded=!1,t.globalStartTime=0,t.SEASON_DURATION=2592e6,t.seasonManager=new o.default,t.loadConfigs(),t.fetchGlobalStartTime(),t.GetPayInfoMess("backpackmaster.bp1",null),t}return __extends(t,e),t.prototype.loadConfigs=function(){var e=this;ConfigSourceManager.loadConfig("BattlePassRewardConfig",function(t,i){if(t)console.error("[BattlePass] Failed to load BattlePassRewardConfig:",t);else{for(var a in i){var n=i[a];e.levelConfig.set(n.lvl_index,n)}e.configLoaded=!0,console.log("[BattlePass] Reward config loaded, levels:",e.levelConfig.size),e.emit("configLoaded",{type:"levels",count:e.levelConfig.size})}}),ConfigSourceManager.loadConfig("BattlePassExtraRewardConfig",function(t,i){t?console.error("[BattlePass] Failed to load BattlePassExtraRewardConfig:",t):(e.extraRewardConfig=i,e.extraConfigLoaded=!0,console.log("[BattlePass] Extra reward config loaded"),e.emit("configLoaded",{type:"extra",count:Object.keys(i).length}))})},t.prototype.fetchGlobalStartTime=function(){var e=this,t=this;if("undefined"==typeof net)return console.warn("[BattlePass] net not available, using fallback season ID"),this.progress.seasonId="season_1",this.globalStartTime=n.default.Instance.now(),void this.seasonManager.setGlobalStartTime(this.globalStartTime);net.post("getBattlePassGlobalStart",{},function(i,a){if(i)return console.error("[BattlePass] Failed to fetch global start time:",i),t.progress.seasonId="season_1",t.globalStartTime=e.initStartTime(),void t.seasonManager.setGlobalStartTime(t.globalStartTime);var o=null==a?void 0:a.battlePassGlobalStart;o||(console.log("[BattlePass] No global start time found, initializing with current time"),o=e.initStartTime(),net.post("setBattlePassGlobalStart",{battlePassGlobalStart:o},function(e){e?console.error("[BattlePass] Failed to save global start time:",e):console.log("[BattlePass] Global start time saved:",new Date(o).toISOString())})),t.globalStartTime=o,t.seasonManager.setGlobalStartTime(o);var r=n.default.Instance.now()-o,s=Math.floor(r/t.SEASON_DURATION)+1;t.progress.seasonId="season_"+s,console.log("[BattlePass] Season initialized:",t.progress.seasonId,"(Global start:",new Date(o).toISOString(),")")})},t.prototype.addExp=function(e){if(this.configLoaded)if(e<=0)console.warn("[BattlePass] Invalid EXP amount:",e);else{var t=this.progress.exp,i=this.progress.level,a=this.progress.extraExp||0;if(this.progress.level>=30){var n=this.getCurrentExtraChest(),o=this.extraRewardConfig["level_"+n];if(!o)return void console.warn("[BattlePass] No more extra chests available (all 5 claimed)");var r=o.exp,s=a+e;if(s>r){var c="extra_"+n;if(!this.progress.claimedRewards[c]){this.progress.extraExp=r;var l=r-a;return console.log("[BattlePass] \u26a0\ufe0f Extra EXP capped at "+r+" (chest "+n+" not claimed yet)"),console.log("[BattlePass] Extra EXP: "+a+" \u2192 "+this.progress.extraExp+" (+"+l+"/"+e+")"),void this.emit("expGained",{amount:l,totalExp:this.progress.exp,extraExp:this.progress.extraExp,currentLevel:this.progress.level,oldExp:t,oldLevel:i,isExtra:!0,capped:!0,overflow:e-l})}}return this.progress.extraExp=s,console.log("[BattlePass] Extra EXP added: "+a+" \u2192 "+this.progress.extraExp+" (+"+e+")"),void this.emit("expGained",{amount:e,totalExp:this.progress.exp,extraExp:this.progress.extraExp,currentLevel:this.progress.level,oldExp:t,oldLevel:i,isExtra:!0,capped:!1})}this.progress.exp+=e,console.log("[BattlePass] EXP added: "+t+" \u2192 "+this.progress.exp+" (+"+e+")");var d=this.calculateLevel(this.progress.exp);d>i&&(this.onLevelUp(i,d),this.progress.level=d),30===d&&i<30&&(console.log("[BattlePass] \ud83c\udf89 Reached max level! Initializing extraExp to 0"),this.progress.extraExp=0),this.emit("expGained",{amount:e,totalExp:this.progress.exp,extraExp:this.progress.extraExp||0,currentLevel:this.progress.level,oldExp:t,oldLevel:i,isExtra:!1})}else console.warn("[BattlePass] Config not loaded yet, ignoring addExp")},t.prototype.calculateLevel=function(e){for(var t=0,i=0,a=Array.from(this.levelConfig.entries()).sort(function(e,t){return e[0]-t[0]});i<a.length;i++){var n=a[i],o=n[0];if(!(e>=n[1].exp))break;t=o}return e>=2420&&(t=30),t},t.prototype.onLevelUp=function(e,t){console.log("[BattlePass] Level Up: "+e+" \u2192 "+t),this.emit("levelUp",{oldLevel:e,newLevel:t,totalExp:this.progress.exp})},t.prototype.claimReward=function(e,t){var i=this.levelConfig.get(e);if(!i)return console.error("[BattlePass] Level config not found:",e),!1;if(this.progress.level<e)return console.warn("[BattlePass] Level "+e+" not unlocked yet (current: "+this.progress.level+")"),!1;if("premium"===t&&!this.progress.premium)return console.warn("[BattlePass] Premium required for this reward"),!1;var a="level_"+e+"_"+t;if(this.progress.claimedRewards[a])return console.warn("[BattlePass] Reward already claimed: "+a),!1;this.progress.claimedRewards[a]=!0;var n="free"===t?i.reward.free:[i.reward.premium];console.log("[BattlePass] Reward claimed: "+a+", rewards:",n);var o={};return o["battlePass.claimedRewards."+a]=!0,net.updateData({set:o},function(e,t){e?console.error("[BattlePass] Failed to save claimed reward:",e):(console.log("[BattlePass] Reward saved to server:",a),"undefined"!=typeof money&&"function"==typeof money.update&&money.update(t))}),this.emit("rewardClaimed",{level:e,type:t,rewards:n}),!0},t.prototype.purchasePremium=function(){var e=this;return console.log("[BattlePass] Initiating premium purchase..."),this.progress.premium?(console.warn("[BattlePass] Already have premium"),void("undefined"!=typeof kit&&kit.info("You already own Battle Pass Premium!"))):"undefined"!=typeof DEV_MODE&&DEV_MODE?(console.log("[BattlePass] \ud83d\udd27 DEV_MODE enabled - activating premium for FREE (no payment)"),void e.activatePremium(!0)):cc.sys.platform===cc.sys.DESKTOP_BROWSER||cc.sys.platform===cc.sys.MOBILE_BROWSER?(console.log("[BattlePass] Web platform detected, activating premium directly..."),void e.activatePremium(!1)):void("undefined"!=typeof sdk&&"function"==typeof sdk.buyDiamond?sdk.buyDiamond("backpackmaster.bp1",function(){console.log("[BattlePass] Purchase successful, activating premium..."),e.activatePremium(!1)}):console.error("[BattlePass] SDK not available"))},t.prototype.GetPayInfoMess=function(e){if(null!=window.MAX.instance._productIdInfo){var t=window.MAX.instance._productIdInfo.split("*");for(var i in console.log("CheckNative ",t),t){var a=t[i].split("&");a[0]==e&&console.log("CheckNative",a[1]+a[2])}}},t.prototype.activatePremium=function(e){void 0===e&&(e=!1);var t=this;console.log("[BattlePass] Activating premium... (Dev mode: "+e+")"),this.progress.premium=!0,this.progress.purchaseTime=n.default.Instance.now();for(var i=[],a=0;a<this.progress.level;a++){var o="level_"+a+"_premium";if(!this.progress.claimedRewards[o]){this.progress.claimedRewards[o]=!0;var r=this.levelConfig.get(a);r&&i.push({level:a,rewards:[r.reward.premium]})}}for(var s={"battlePass.premium":!0,"battlePass.purchaseTime":n.default.Instance.now()},c=0;c<this.progress.level;c++)s["battlePass.claimedRewards."+(o="level_"+c+"_premium")]=!0;var l={set:s};e||(l.add={buyCost:4.99}),net.updateData(l,function(e,a){if(e)return console.error("[BattlePass] Failed to save premium purchase:",e),void("undefined"!=typeof kit&&kit.info("Purchase failed. Please try again."));if(console.log("[BattlePass] Premium purchase saved successfully"),"undefined"!=typeof money&&"function"==typeof money.update&&money.update(a),"undefined"!=typeof FirebaseTracking&&FirebaseTracking.setDataBiRes("BattlePass_Premium_Purchase"),t.emit("premiumPurchased",{rewardsCount:i.length,rewards:i}),i.length>0){var n=[];i.forEach(function(e){var t=e.rewards[0];Array.isArray(t)&&t.forEach(function(e){n.push(e)})});var o={};n.forEach(function(e,t){o["item"+(t+1)]=e}),console.log("[BattlePass] Raw rewards object:",o);var r=[];"undefined"!=typeof equipment&&"function"==typeof equipment.getItemFromReward?equipment.getItemFromReward(r,o):(console.warn("[BattlePass] equipment.getItemFromReward not available, using raw rewards"),r.push.apply(r,n)),console.log("[BattlePass] Converted rewards for popup:",r),net.updateData({items:r},function(e,t){e?console.error("[BattlePass] Failed to send retroactive rewards to server:",e):"undefined"!=typeof money&&"function"==typeof money.update&&money.update(t),"undefined"!=typeof menuManager&&"function"==typeof menuManager.pop&&menuManager.pop("loot",{tid:"sign",items:r,checkCb:function(){}}),console.log("[BattlePass] Premium activated, "+i.length+" rewards granted")})}else"undefined"!=typeof kit&&kit.info("Battle Pass Premium unlocked!"),console.log("[BattlePass] Premium activated, no retroactive rewards (level 0 or already claimed)")})},t.prototype.checkSeasonReset=function(){var e=this.getCurrentSeasonId();return this.progress.seasonId!==e&&(console.log("[BattlePass] Season changed: "+this.progress.seasonId+" \u2192 "+e),this.resetForNewSeason(e),!0)},t.prototype.resetForNewSeason=function(e){var t=this.progress.seasonId,i=this.progress.premium;console.log("[BattlePass] \ud83d\udd04 Resetting for new season:",e),console.log("[BattlePass] Old season:",t,"\u2192 New:",e),console.log("[BattlePass] Wiping premium status:",i,"\u2192 false"),console.log("[BattlePass] Wiping all claimed rewards and progress");var a=t&&""!==t&&t!==e;this.progress={level:0,exp:0,extraExp:0,premium:!1,purchaseTime:0,seasonId:e,claimedRewards:a?{}:this.progress.claimedRewards,seasonStartTime:n.default.Instance.now()},this.emit("seasonReset",{seasonId:e,oldSeasonId:t,premiumPreserved:!1,rewardsWiped:a}),console.log("[BattlePass] \u2705 Season reset complete - fresh start for",e)},t.prototype.getCurrentSeasonId=function(){if(0===this.globalStartTime)return console.warn("[BattlePass] Global start time not initialized, returning season_1"),"season_1";var e=n.default.Instance.now()-this.globalStartTime;return"season_"+(Math.floor(e/this.SEASON_DURATION)+1)},t.prototype.getProgress=function(){return __assign({},this.progress)},t.prototype.setProgress=function(e){console.log("[BattlePass] \ud83d\udce5 setProgress called with data:",JSON.stringify(e,null,2)),console.log("[BattlePass] \ud83d\udce5 Claimed rewards keys:",Object.keys(e.claimedRewards||{})),console.log("[BattlePass] L\u1ea5y m\u1ed1c th\u01b0\u1eddi gian:",this.initStartTime()),e.claimedRewards||(console.warn("[BattlePass] No claimedRewards in progress data, initializing empty object"),e.claimedRewards={}),void 0===e.extraExp&&(console.warn("[BattlePass] No extraExp in progress data, initializing to 0"),e.extraExp=0);var t=Object.keys(e.claimedRewards).filter(function(e){return e.startsWith("level_")&&e.endsWith("_extra")});if(t.length>0&&(console.warn("[BattlePass] \ud83d\udd27 Data correction: Removing "+t.length+" legacy extra reward keys:",t),t.forEach(function(t){delete e.claimedRewards[t]})),30===e.level&&e.extraExp>0&&this.extraConfigLoaded){for(var i=-1,a=0;a<5;a++){var n="extra_"+a;if(!e.claimedRewards[n]){i=a;break}}if(i>=0){var o=this.extraRewardConfig["level_"+i];o&&e.extraExp>o.exp&&(console.warn("[BattlePass] \ud83d\udd27 Data correction: Capping extraExp from "+e.extraExp+" to "+o.exp+" (next chest: "+i+")"),e.extraExp=o.exp)}else{var r=this.extraRewardConfig.level_4;r&&e.extraExp>r.exp&&(console.warn("[BattlePass] \ud83d\udd27 Data correction: All chests claimed, capping extraExp from "+e.extraExp+" to "+r.exp),e.extraExp=r.exp)}}if(this.configLoaded&&e.exp>=0){var s=this.calculateLevel(e.exp);s!==e.level&&(console.warn("[BattlePass] Level mismatch! Server: "+e.level+", Calculated from EXP: "+s+". Using calculated level."),e.level=s)}this.progress=e,this.checkSeasonReset(),console.log("[BattlePass] \u2705 Progress loaded from server - Level:",this.progress.level,"EXP:",this.progress.exp,"Extra EXP:",this.progress.extraExp,"Premium:",this.progress.premium,"Claimed:",Object.keys(this.progress.claimedRewards).length)},t.prototype.getCurrentLevel=function(){return this.progress.level},t.prototype.getExpForNextLevel=function(){var e=this.progress.level+1,t=this.levelConfig.get(e);return t?Math.max(0,t.exp-this.progress.exp):0},t.prototype.getLevelConfig=function(e){return this.levelConfig.get(e)},t.prototype.isConfigLoaded=function(){return this.configLoaded},t.prototype.getCurrentExtraChest=function(){for(var e=0;e<5;e++){var t="extra_"+e;if(!this.progress.claimedRewards[t])return e}return 5},t.prototype.calculateExtraLevel=function(){if(this.progress.level<30)return-1;for(var e=this.progress.extraExp||0,t=-1,i=0;i<5;i++){var a=this.extraRewardConfig["level_"+i];a&&e>=a.exp&&(t=i)}return t},t.prototype.getExtraProgress=function(){var e;if(this.progress.level<30)return{currentLevel:-1,currentExp:0,nextLevelExp:0,totalExp:0};var t=this.progress.extraExp||0,i=this.getCurrentExtraChest(),a=this.extraRewardConfig["level_"+i];if(!a)return{currentLevel:4,currentExp:t,nextLevelExp:0,totalExp:t};var n=a.exp,o=i>0&&(null===(e=this.extraRewardConfig["level_"+(i-1)])||void 0===e?void 0:e.exp)||0;return{currentLevel:i,currentExp:Math.max(0,Math.min(t-o,n-o)),nextLevelExp:n-o,totalExp:t}},t.prototype.claimExtraReward=function(e){var t=this.extraRewardConfig["level_"+e];if(!t)return console.error("[BattlePass] Extra level config not found:",e),!1;var i=this.progress.extraExp||0,a=t.exp;if(i<a)return console.warn("[BattlePass] Not enough extra EXP to claim (have: "+i+", need: "+a+")"),!1;var n="extra_"+e;if(this.progress.claimedRewards[n])return console.warn("[BattlePass] Extra reward already claimed: "+n),!1;this.progress.claimedRewards[n]=!0,console.log("[BattlePass] Extra reward claimed: "+n+" (extraExp: "+i+"/"+a+")");var o=t.reward||[],r={};o.forEach(function(e,t){r["item"+(t+1)]=e}),console.log("[BattlePass] Extra reward raw object:",r);var s=[];"undefined"!=typeof equipment&&"function"==typeof equipment.getItemFromReward?equipment.getItemFromReward(s,r):(console.warn("[BattlePass] equipment.getItemFromReward not available, using raw rewards"),s.push.apply(s,o)),console.log("[BattlePass] Converted extra rewards for popup:",s);var c={};return c["battlePass.claimedRewards."+n]=!0,net.updateData({set:c,items:s},function(t,i){t?console.error("[BattlePass] Failed to save extra reward:",t):(console.log("[BattlePass] Extra reward saved to server:",n),"undefined"!=typeof money&&"function"==typeof money.update&&money.update(i),"undefined"!=typeof menuManager&&"function"==typeof menuManager.pop&&menuManager.pop("loot",{tid:"sign",items:s,checkCb:function(){console.log("[BattlePass] Extra reward popup closed")}}),"undefined"!=typeof FirebaseTracking&&FirebaseTracking.setDataBiRes("BattlePass_ExtraChest_"+e))}),this.emit("rewardClaimed",{level:e,type:"extra",rewards:o,isExtra:!0}),!0},t.prototype.getExtraRewardConfig=function(){return this.extraRewardConfig},t.prototype.resetProgress=function(){console.log("[BattlePass] \ud83d\udd04 resetProgress called - Resetting all progress");var e=this.progress.seasonId,t=e||this.getCurrentSeasonId();this.progress={level:0,exp:0,extraExp:0,premium:!1,purchaseTime:0,seasonId:t,claimedRewards:{},seasonStartTime:n.default.Instance.now()},console.log("[BattlePass] \u2705 Progress reset complete"),this.emit("seasonReset",{seasonId:t,oldSeasonId:e,premiumPreserved:!1,rewardsWiped:!0,manualReset:!0})},t.prototype.initStartTime=function(){var e=new Date(2025,9,17,0,0,0),t=e.getTime()-6e4*e.getTimezoneOffset(),i=n.default.Instance.now()-t;console.log("[BattlePass] \u0110\xe3 tr\xf4i qua:",i,"milliseconds");var a=Math.floor(i/1e3),o=a%60,r=Math.floor(a/60),s=r%60,c=Math.floor(r/60);return console.log("[BattlePass] \u0110\xe3 tr\xf4i qua: "+c+" gi\u1edd "+s+" ph\xfat "+o+" gi\xe2y"),t},t}(a.default);i.default=r,cc._RF.pop()},{"../TimeManager":"TimeManager","../core/EventSystem":"EventSystem","./BattlePassSeasonManager":"BattlePassSeasonManager"}],BattlePassPopup:[function(e,t){"use strict";cc._RF.push(t,"b31e5OdgZlPb66HZg01quak","BattlePassPopup"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{seasonTimerLabel:cc.Label,seasonIdLabel:cc.Label,stateSpfBuy:[cc.SpriteFrame],currentLevelLabel:cc.Label,expProgressBar:cc.Sprite,expProgressLabel:cc.Label,targetLevelLabel:cc.Label,listIconRankLevel:[cc.SpriteFrame],premiumStatusLabel:cc.Label,premiumButton:cc.Button,premiumButtonLabel:cc.Label,premiumPrice:cc.Label,levelListContent:cc.Node,levelItemPrefab:cc.Prefab,layout_extra:cc.Node,extraLevelLabel:cc.Label,extraLevelCurrentLabel:cc.Label,extraExpProgressBar:cc.Sprite,extraExpProgressLabel:cc.Label,extraRewardChestNode:cc.Node,contentLayoutRoot:cc.Node,layout_exp:cc.Node,layout_item:cc.Node,Botbar:cc.Node},onLoad:function(){this.levelItems=[]},start:function(){window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized()?this.initStatus():console.error("[BattlePassPopup] Battle Pass system not initialized!")},initStatus:function(){this.setupEventListeners(),this.updateSeasonInfo(),this.updateProgressInfo(),this.updatePremiumStatus(),this.updateExtraRewards(),this.refreshLevelList(),this.schedule(this.updateSeasonTimer,1),this.premiumButton&&this.premiumButton.node.on("click",this.onPremiumButtonClicked,this),this.premiumPrice&&(this.premiumPrice.string="$4.99")},setupEventListeners:function(){var e=this;window.BattlePassManager&&(window.BattlePassManager.on("expGained",function(){e.updateProgressInfo(),e.updateExtraRewards()}),window.BattlePassManager.on("levelUp",function(){e.updateProgressInfo(),e.updateExtraRewards()}),window.BattlePassManager.on("premiumPurchased",function(){e.updatePremiumStatus()}),window.BattlePassManager.on("seasonReset",function(){e.updateSeasonInfo(),e.updateProgressInfo(),e.updatePremiumStatus(),e.refreshLevelList()}))},updateSeasonInfo:function(){if(window.BattlePassManager&&window.BattlePassManager.seasonManager){var e=window.BattlePassManager.seasonManager.getCurrentSeasonId();if(this.seasonIdLabel){var t=e.split("_")[1]||"1";this.seasonIdLabel.string="Season "+t}}},updateSeasonTimer:function(){if(window.BattlePassManager&&window.BattlePassManager.seasonManager){var e=window.BattlePassManager.seasonManager,t=e.getTimeUntilSeasonEnd(),i=e.formatSeasonEndTime(t);this.seasonTimerLabel&&(this.seasonTimerLabel.string=i)}},updateProgressInfo:function(){if(window.BattlePassManager){var e=window.BattlePassManager.getProgress(),t=e.level,i=e.exp,a=window.BattlePassManager.getExpForNextLevel();if(this.currentLevelLabel&&(this.currentLevelLabel.string=t,this.updateRankIcon(this.currentLevelLabel,t)),this.targetLevelLabel)if(t>=30)this.targetLevelLabel.node.parent.active=!1;else{this.targetLevelLabel.node.parent.active=!0;var n=t+1;this.targetLevelLabel.string=n,this.updateRankIcon(this.targetLevelLabel,n)}if(t>=30)this.expProgressBar&&(this.expProgressBar.fillRange=1),this.expProgressLabel&&(this.expProgressLabel.string="MAX LEVEL");else if(29===t){var o=i-2320,r=100;this.expProgressBar&&(this.expProgressBar.fillRange=o/r),this.expProgressLabel&&(this.expProgressLabel.string=o+"/"+r+" EXP")}else if(a>0){var s=window.BattlePassManager.getLevelConfig(t+1);if(s){var c=0;if(t>0){var l=window.BattlePassManager.getLevelConfig(t);c=l?l.exp:0}r=s.exp-c,o=i-c,this.expProgressBar&&(this.expProgressBar.fillRange=o/r),this.expProgressLabel&&(this.expProgressLabel.string=o+"/"+r+" EXP")}}else this.expProgressBar&&(this.expProgressBar.fillRange=1),this.expProgressLabel&&(this.expProgressLabel.string="MAX LEVEL")}},updateRankIcon:function(e,t){if(e&&this.listIconRankLevel&&!(this.listIconRankLevel.length<3)){var i=e.node.parent;if(i){var a=i.getChildByName("rank_battle_pass");if(a){var n=a.getComponent(cc.Sprite);if(n){var o=0;t>=0&&t<=9?o=0:t>=10&&t<=19?o=1:t>=20&&(o=2),n.spriteFrame=this.listIconRankLevel[o]}}}}},updatePremiumStatus:function(){if(window.BattlePassManager){var e=window.BattlePassManager.getProgress().premium;if(this.premiumStatusLabel&&(e?(this.premiumStatusLabel.string="Active",this.premiumStatusLabel.node.color=cc.color(162,87,18)):(this.premiumStatusLabel.string="Inactive",this.premiumStatusLabel.node.color=cc.color(133,121,182))),this.premiumButton&&this.premiumButton.node){var t=this.premiumButton.node.getComponent(cc.Sprite);!0===e?(t&&this.stateSpfBuy&&this.stateSpfBuy.length>=2&&(t.spriteFrame=this.stateSpfBuy[1]),this.premiumButton.node.active=!0,this.premiumButton.interactable=!1,this.premiumButtonLabel&&(this.premiumButtonLabel.string="Active")):(t&&this.stateSpfBuy&&this.stateSpfBuy.length>=1&&(t.spriteFrame=this.stateSpfBuy[0]),this.premiumButton.node.active=!0,this.premiumButton.interactable=!0,this.premiumButtonLabel&&(this.premiumButtonLabel.string="Inactive"))}}},updateExtraRewards:function(){if(window.BattlePassManager){var e=window.BattlePassManager.getProgress(),t=e.level;if(this.layout_extra){var i=this;if(t>=0){this.layout_extra.active=!0,this.scheduleOnce(function(){i.adjustLayoutItemHeight()},.1);var a=window.BattlePassManager.getExtraProgress(),n=a.currentLevel,o=a.currentExp,r=a.nextLevelExp;if(this.extraLevelLabel){for(var s=0,c=5,l=0;l<c;l++){var d="extra_"+l;e.claimedRewards[d]&&s++}this.extraLevelLabel.string=s+"/5"}if(this.extraLevelCurrentLabel)if(t<30)this.extraLevelCurrentLabel.string=t.toString();else{for(s=0,c=5,l=0;l<c;l++)d="extra_"+l,e.claimedRewards[d]&&s++;this.extraLevelCurrentLabel.string=(30+s).toString()}if(this.extraExpProgressBar&&r>0){var h=o/r;this.extraExpProgressBar.fillRange=h}if(this.extraExpProgressLabel){for(s=0,c=5,l=0;l<c;l++)d="extra_"+l,e.claimedRewards[d]&&s++;s>=c?(this.extraExpProgressLabel.string="MAX",this.extraExpProgressBar.fillRange=1):this.extraExpProgressLabel.string=r>0?o+"/"+r+" EXP":"0/200"}this.updateExtraRewardItems(n)}else this.layout_extra.active=!1,this.scheduleOnce(function(){i.adjustLayoutItemHeight()},.1)}}},adjustLayoutItemHeight:function(){var e="[BP_LAYOUT_ADJUST]";if(this.layout_item&&this.layout_extra&&this.layout_exp&&this.Botbar)if(window.BattlePassManager){var t=window.BattlePassManager.getProgress().level,i=cc.winSize.height,a=this.Botbar.height,n=this.layout_exp.height,o=this.layout_extra.height;this._defaultLayoutItemHeight||(this._defaultLayoutItemHeight=this.layout_item.height);var r,s=i-a-(i/2-this.contentLayoutRoot.y);if(t>=0?(r=s-n-o,console.log(e+" Level 30+ adjustment: "+this.layout_item.height+"px \u2192 "+r+"px")):(r=s-n,console.log(e+" Below level 30 adjustment: "+this.layout_item.height+"px \u2192 "+r+"px")),this.layout_item.height=r,this.layout_item.getComponent(cc.ScrollView)){var c=this.layout_item.getChildByName("view");c&&(c.height=r)}if(this.contentLayoutRoot){var l=this.contentLayoutRoot.getComponent(cc.Layout);l&&l.updateLayout()}}else console.error(e+" BattlePassManager not found!");else console.error(e+" Missing required nodes!")},updateExtraRewardItems:function(e){if(window.BattlePassManager){var t=window.BattlePassManager.getExtraRewardConfig(),i=window.BattlePassManager.getProgress().claimedRewards;if(this.extraRewardChestNode&&e>=0){var a=i["extra_"+e]||!1,n=window.BattlePassManager.calculateExtraLevel()>=e;this.extraRewardChestNode.stopAllActions(),this.extraRewardChestNode.scale=1,this.extraRewardChestNode.rotation=0;var o=t["level_"+e];if(o&&o.reward)if(n)if(a)this.extraRewardChestNode.opacity=128;else{this.extraRewardChestNode.opacity=255;var r=cc.rotateTo(.1,-10),s=cc.rotateTo(.1,10),c=cc.rotateTo(.1,0),l=cc.sequence(r,s,r,s,c),d=cc.delayTime(2),h=cc.repeatForever(cc.sequence(l,d)),u=cc.scaleTo(.5,1.1),p=cc.scaleTo(.5,1),f=cc.sequence(u,p),m=cc.repeatForever(f);this.extraRewardChestNode.runAction(h),this.extraRewardChestNode.runAction(m)}else this.extraRewardChestNode.opacity=128;var g=this;this.extraRewardChestNode.off(cc.Node.EventType.TOUCH_END),this.extraRewardChestNode.on(cc.Node.EventType.TOUCH_END,function(){if(n){if(a){if("undefined"!=typeof kit){for(var t=0,i=5,o=window.BattlePassManager.getProgress(),r=0;r<i;r++){var s="extra_"+r;o.claimedRewards[s]&&t++}t>=i?kit.info("All expansion rewards taken"):kit.info("Extra rewards already claimed!")}}else if(window.BattlePassManager.claimExtraReward(e)&&(g.updateExtraRewards(),"undefined"!=typeof kit)){t=0,i=5;var c=window.BattlePassManager.getProgress();for(r=0;r<i;r++)s="extra_"+r,c.claimedRewards[s]&&t++;console.log(t,i),t>=i&&kit.info("All expansion rewards taken")}}else"undefined"!=typeof kit&&kit.info("Need more EXP to unlock this chest!")},this)}}},refreshLevelList:function(){if(window.BattlePassManager){this.levelItems=[];for(var e=window.BattlePassManager.getProgress(),t=e.level,i=e.premium,a=e.claimedRewards,n=0;n<=29;n++){var o=cc.instantiate(this.levelItemPrefab);this.levelListContent.addChild(o);var r=o.getComponent("BattlePassItemLevel");r&&r.init(n,t,i,a),this.levelItems.push(o)}}},onPremiumButtonClicked:function(){if(window.BattlePassManager){if(!0===window.BattlePassManager.getProgress().premium)return"undefined"!=typeof kit&&kit.info("You already own Battle Pass Premium!"),void this.updatePremiumStatus();"undefined"!=typeof kit&&kit.confirm?kit.confirm("Purchase Battle Pass Premium for $4.99?\n\nYou will get all premium rewards for unlocked levels!",function(){window.BattlePassManager.purchasePremium()}):window.BattlePassManager.purchasePremium()}},calculateLevelFromExp:function(e){return window.BattlePassManager?window.BattlePassManager.calculateLevel(e):0},getStats:function(){if(!window.BattlePassManager)return null;var e=window.BattlePassManager.getProgress();return{level:e.level,exp:e.exp,premium:e.premium,seasonId:e.seasonId,expForNextLevel:window.BattlePassManager.getExpForNextLevel()}},onDestroy:function(){this.unschedule(this.updateSeasonTimer)},onDebugAddExp:function(){if(window.BattlePassManager){window.BattlePassManager.addExp(50);var e=window.BattlePassManager.getProgress();"undefined"!=typeof kit&&kit.info&&kit.info("Added 50 EXP - Level: "+e.level)}},onDebugResetAll:function(){if(window.BattlePassManager){var e=this;"undefined"!=typeof kit&&kit.confirm?kit.confirm("\ud83d\udd27 DEBUG: Reset all Battle Pass progress?\n\n- Level \u2192 0\n- EXP \u2192 0\n- Premium \u2192 false\n- All rewards \u2192 unclaimed",function(){e.executeDebugReset()}):this.executeDebugReset()}else console.error("[BattlePassPopup] BattlePassManager not found")},executeDebugReset:function(){window.BattlePassManager.resetProgress(),window.TaskBattlePassServer&&window.TaskBattlePassServer.saveBattlePassProgress(),"undefined"!=typeof kit&&kit.info&&kit.info("Battle Pass reset complete!")}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],BattlePassSeasonManager:[function(e,t,i){"use strict";cc._RF.push(t,"02b3f+m1upB1qe9w5SClnaR","BattlePassSeasonManager"),Object.defineProperty(i,"__esModule",{value:!0});var a=e("../TimeManager"),n=function(){function e(){this.currentSeason=null,this.globalStartTime=0,this.SEASON_DURATION=2592e6,console.log("[SeasonManager] Initialized, waiting for global start time from server")}return e.prototype.setGlobalStartTime=function(e){var t,i;this.globalStartTime=e,this.initializeSeason(),console.log("[BP_SEASON_DEBUG] Season initialized:",null===(t=this.currentSeason)||void 0===t?void 0:t.seasonId,"- Ends:",new Date((null===(i=this.currentSeason)||void 0===i?void 0:i.endTime)||0).toISOString())},e.prototype.initializeSeason=function(){if(0!==this.globalStartTime){var e=this.getCurrentSeasonId(),t=this.getSeasonTimes(e),i=t.startTime,a=t.endTime;this.currentSeason={seasonId:e,startTime:i,endTime:a}}else console.warn("[BP_SEASON_DEBUG] \u274c Cannot initialize season - global start time not set")},e.prototype.getCurrentSeasonId=function(){if(0===this.globalStartTime)return"season_1";var e=a.default.Instance.now()-this.globalStartTime;return"season_"+(Math.floor(e/this.SEASON_DURATION)+1)},e.prototype.getSeasonTimes=function(e){var t=e.split("_"),i=parseInt(t[1]),a=this.globalStartTime+(i-1)*this.SEASON_DURATION;return{startTime:a,endTime:a+this.SEASON_DURATION-1e3}},e.prototype.getTimeUntilSeasonEnd=function(){if(!this.currentSeason)return console.warn("[BP_SEASON_DEBUG] \u274c No current season, returning 0"),0;var e=a.default.Instance.now();return Math.max(0,this.currentSeason.endTime-e)},e.prototype.formatSeasonEndTime=function(e){var t=Math.floor(e/864e5),i=Math.floor(e%864e5/36e5),a=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3);return t>0?t+"d "+i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0"):i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")},e.prototype.isSeasonActive=function(){if(!this.currentSeason)return!1;var e=a.default.Instance.now();return e>=this.currentSeason.startTime&&e<=this.currentSeason.endTime},e.prototype.getCurrentSeason=function(){return this.currentSeason},e.prototype.getSeasonStartTime=function(){var e;return(null===(e=this.currentSeason)||void 0===e?void 0:e.startTime)||0},e.prototype.getSeasonEndTime=function(){var e;return(null===(e=this.currentSeason)||void 0===e?void 0:e.endTime)||0},e.prototype.getSeasonInfo=function(){var e,t,i,n=a.default.Instance.now(),o=this.getTimeUntilSeasonEnd();return{seasonId:(null===(e=this.currentSeason)||void 0===e?void 0:e.seasonId)||"",startTime:(null===(t=this.currentSeason)||void 0===t?void 0:t.startTime)||0,endTime:(null===(i=this.currentSeason)||void 0===i?void 0:i.endTime)||0,currentTime:n,timeRemaining:this.formatSeasonEndTime(o),isActive:this.isSeasonActive()}},e}();i.default=n,cc._RF.pop()},{"../TimeManager":"TimeManager"}],BesselMissileSprite:[function(e,t){"use strict";cc._RF.push(t,"66f665Eb5xDtqPdtde7cr9d","BesselMissileSprite"),cc.Class({extends:e("./BulletSprite"),move:function(){var e=this.obj;this.timer=e.timer+STEP_TIME,this.bessel=e.bessel,this._super()},updateRender:function(){},updateReal:function(e){this.x0=this.x,this.y0=this.y,this.timer-=e,this.bessel.call(this,this.timer);var t=this.x-this.x0,i=this.y-this.y0;if(0!=t&&0!=i){var a=this.node;a.x=this.x,a.y=this.y,a.angle=kit.vector2Degree(t,i)-90}},removeByHit:function(){var e=this.obj;this.hitEffect&&this.game.callEffect(this.hitEffect,e.x,e.y,e.deg,e.hurtDelayTime),this.node.runActionVS(cc.sequence(cc.delayTime(e.hurtDelayTime),cc.callFunc(this.removeByHitEnd,this)))},removeByHitEnd:function(){this.unscheduleVS(this.updateReal);var e=this.obj;this.streak&&this.streak.remove(e.x,e.y,0),this.node.destroy()},remove:function(e){this.removeByHit(e)}}),cc._RF.pop()},{"./BulletSprite":"BulletSprite"}],BgResize:[function(e,t){"use strict";cc._RF.push(t,"64671PbarlNU5o8ghg+OXB8","BgResize"),cc.Class({extends:cc.Component,properties:{designResolution:new cc.Size(1560,720),lastWitdh:0,lastHeight:0},start:function(){this.updateSize()},update:function(){this.updateSize()},updateSize:function(){var e=cc.view.getFrameSize();if(this.lastWitdh!==e.width||this.lastHeight!==e.height)if(this.lastWitdh=e.width,this.lastHeight=e.height,this.designResolution.width/this.designResolution.height>e.width/e.height){var t=(a=this.designResolution.width*e.height/e.width)*this.designResolution.width/this.designResolution.height,i=cc.size(t,a);this.node.setContentSize(i)}else{var a=(t=this.designResolution.height*e.width/e.height)*this.designResolution.height/this.designResolution.width;i=cc.size(t,a),i=cc.size(t,a),this.node.setContentSize(i)}}}),cc._RF.pop()},{}],BigShieldBuff:[function(e,t){"use strict";cc._RF.push(t,"7efa31EQGRKyam6ofSIOZVx","BigShieldBuff"),e("../../../entities/projectiles/Bullet"),e("../../../entities/projectiles/BallBulletSprite"),e("../../../entities/projectiles/Bomb"),cc.Class({extends:e("./Buff"),cover:function(){this.hp+=this.define.hp||0,this.addShieldTotal(this.hp),this.recoverFix+=this.define.recoverFix||0},begin:function(){var e=this.obj;this.r=this.define.r||300,this.game.eventMgr.regist(this.obj,"hurtEvent",this,this.hurtEvent),this.hitRadius=this.obj.hitRadius,this.hp=this.define.hp||0,this.define.hpRatio&&(this.hp+=this.define.hpRatio*e.hpMax),this.hpMax=this.define.hpMax||this.obj.hpMax,this.obj.shieldTimeBonus&&(this.castTimer*=this.obj.shieldTimeBonus),this.recoverRate=this.define.recoverRate,this.recoverFix=this.define.recoverFix||0,this.recoverDT=this.define.recoverDT||1,this.stayOnBroken=this.define.stayOnBroken,this.addShieldTotal(this.hp,this.hpMax),this.recoverLatencyOnHurt=this.define.recoverLatencyOnHurt},addShieldTotal:function(e){this.obj.shieldCurrent||(this.obj.shieldCurrent=0),this.obj.shieldMax||(this.obj.shieldMax=this.obj.hpMax),this.obj.shieldCurrent+=e||0},preHurtEvent:function(e,t,i){if(i>0){var a=this.obj;if(e.team==a.team&&kit.norm(a.x-e.x,a.y-e.y)<this.r){var n,o;if(e==this.obj&&(i<this.hp&&(null!=t&&null!=(n=t.obj)&&null!=(o=n.attribute)&&o.get("dmg2ShieldBonus")&&(i*=t.obj.attribute.get("dmg2ShieldBonus"))>this.hp&&(i=this.hp),null!=t&&t.dmg2ShieldBonus&&(i*=t.dmg2ShieldBonus)>this.hp&&(i=this.hp)),this.hp-=i,this.addShieldTotal(-i),this.recoverLatencyOnHurt&&(this.recoverLatencyOnHurtTimer=this.recoverLatencyOnHurt),this.hp<=0)){if(this.stayOnBroken){var r=-this.hp;return this.hp=0,this.addShieldTotal(r),cc.log("preHurtEvent bigshieldBuff hp 2",r,this.hp,i,t),r}this.callEnd(),this.addShieldTotal(-this.hp),this.hp=0}return 0}}},hurtEvent:function(e,t,i){if((i=e.hurtNum||0)>0){var a=this.obj;if(e.team==a.team&&kit.norm(a.x-e.x,a.y-e.y)<this.r){if(e==this.obj)if(this.hp,this.hp-=i,this.addShieldTotal(-i),this.recoverLatencyOnHurt&&(this.recoverLatencyOnHurtTimer=this.recoverLatencyOnHurt),this.hp<=0)if(this.stayOnBroken){var n=-this.hp;this.hp=0,this.addShieldTotal(n),e.hp+=i-n,e.hurtNum-=i-n,e.hp>e.hpMax&&(e.hp=e.hpMax)}else this.callEnd(),this.game.callEffect(EFFECT.hurtText,a,"status_shieldbreak"),e.hp+=i+this.hp,e.hurtNum-=i+this.hp,e.hp>e.hpMax&&(e.hp=e.hpMax),this.hp=0;else e.hp+=i,e.hurtNum-=i,e.hp>e.hpMax&&(e.hp=e.hpMax);return 0}}},playAnim:function(){this.define.anim&&(this.obj.avatar.setForcedAnime(this.define.anim.animName||"attack",1),this.obj.avatar.refresh(.03,!0,!0),this.obj.setFlag(NO_ATTACK,!0),this.obj.setFlag(NO_MOVE,!0))},end:function(){this.game.eventMgr.unregist(this.obj,"hurtEvent",this),this.addShieldTotal(-this.hp,-this.hpMax)},getTowersStat:function(e){var t=1;if(this.towers)for(var i in this.towers)"armor"!=this.towers[i].unitType&&"energyBarrier"!=this.towers[i].unitType||(t+=this.towers[i][e]-1);return t},update:function(e){var t;if(this.hpMax=this.obj.hpMax,this.obj.shieldMax=this.obj.hpMax,this.recoverLatencyOnHurt&&this.recoverLatencyOnHurtTimer&&(this.recoverLatencyOnHurtTimer-=e,t=this.recoverLatencyOnHurtTimer>0),!t&&(this.recoverRate||this.recoverFix)&&kit.timer(this,"recover",this.recoverDT/this.getTowersStat("atkSpd"),e)){var i=this.recoverFix+(this.recoverRate&&this.hpMax*this.recoverRate||0);i*=this.getTowersStat("_atkScale"),i*=this.obj.armorScale||1;var a=this.hp;this.hp+=i,this.hp>this.hpMax&&(i=this.hpMax-a,this.hp=this.hpMax),window.StatsTracker&&i>0&&StatsTracker.trackArmorRecovery(i),this.addShieldTotal(i)}}}),cc._RF.pop()},{"../../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","./Buff":"Buff"}],Blink:[function(e,t){"use strict";cc._RF.push(t,"a7fc9G2RmNAoKn3s+cPH1qW","Blink"),cc.Class({extends:cc.Component,properties:{stars:[cc.Node]},onLoad:function(){this.node;var e=function e(){this.x=this.x0+kit.rnd(-20,20),this.y=this.y0+kit.rnd(-15,15),this.scale=0,this.opacity=255,this.runAction(cc.sequence(cc.delayTime(kit.rnd(0,3)),cc.scaleTo(.2,kit.rnd(.75,1.25)),cc.fadeOut(.2),cc.delayTime(kit.rnd(2,4)),cc.callFunc(e,this)))};for(var t in this.stars){var i=this.stars[t];i.x0=i.x,i.y0=i.y,e.call(i)}}}),cc._RF.pop()},{}],BltPerShotBuff:[function(e,t){"use strict";cc._RF.push(t,"99ba6Uoh/ZOxJKOKmV59oxp","BltPerShotBuff"),cc.Class({extends:e("./Buff"),cover:function(){this.nShot+=this.define.nShot},begin:function(){this.define;var e=this.obj;this.game.eventMgr.regist(e,"shotEvent",this,this.shotEvent),this.nShot=this.define.nShot||1,this.nShotCt=this.nShot,this.stat=this.define.stat},shotEvent:function(){if(this.nShotCt--,0==this.nShotCt)return this.nShotCt=this.nShot,this.stat},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"shotEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],BombSkill:[function(e,t){"use strict";cc._RF.push(t,"9a7f4VH0edOK7yMU9sW+Zz4","BombSkill");var i=e("../../../entities/projectiles/BallBulletSprite"),a=e("../../../entities/projectiles/Bomb"),n=e("../../../entities/projectiles/Bullet");cc.Class({extends:e("./Skill"),startCast:function(){var e=this.obj;this.timer=0,this.smokeIndex=0,this.bombIndex=0,this.smokeMax=6,e.config.skillBlt&&(this.smokeMax+=e.config.skillBlt);var t=e.skillScale;this.blt=[{name:"\u70ae\u5f39",ctor:a,noContact:1,avatar:{ctor:i,frm:"avatar/huojiandan",sx:.6,sy:.6,noBlend:!0},bomb:{r1:150,r0:50,dmg1:200*t,dmg0:500*t,kb:300,effect:EFFECT.bombs3},kb:.3,length:20,n:1,wd:0,d:0,spd:2e3,spdFluc:0,gravity:-2e3,distance:13450,disExtra:100}],this.attackSequence=[{t:.7,x:-20,y:50,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1}],this.game.callEffect(EFFECT.slowMotion,e.avatar,this.define.t,this.clearBullet.bind(this))},clearBullet:function(){var e=this.obj,t=(e.avatar,this.game.contactMgr.bulletList);for(var i in t)t[i].team!==e.team&&t[i].onTimeOut();var a=this.game.contactMgr.getContactList();for(var n in a){var o=a[n],r=o.getEntity();o._activeContact&&r.isInBorder()&&r.team!==e.team&&(r.onHurt(this,100*e.skillScale,null,null),this.game.callEffect(EFFECT.preUltDamage,r.avatar))}},updateCast:function(e){var t=this.obj.avatar;if(this.smokeIndex<this.smokeMax){if(this.timer-=e,this.timer<=0){var i=this.smokeIndex%3;this.timer=.2;var a=-5+kit.rnd(-5,2);this.game.callEffect(EFFECT.launchSmoke,t.x+20*i-30,t.y,a),this.smokeIndex++,this.shot(this.attackSequence[0],t.x+20*i-15,t.y+200,a)}}else this.bombIndex<this.smokeMax&&(this.timer-=e,this.timer<=0&&(this.timer=.2,this.bombIndex++))},shot:function(e,t,i,a){var o=this.obj,r=this.blt[e.blt-1],s=(e.x||0)*o.flipX*o.scale,c=(e.y||0)*o.scale;r.offsets&&(o._bltOffsetIndex||(o._bltOffsetIndex=r.offsets.length),o._bltOffsetIndex-=1,s+=r.offsets[o._bltOffsetIndex].x,c+=r.offsets[o._bltOffsetIndex].y),t=t,i=i;var l=90+a,d=c_degree2cos(l),h=c_degree2sin(l),u=+h*s+d*c,p=-d*s+h*c;(r.shot||n.shot)(this.game,r,{distance:void 0,target:void 0,deg:l,obj:o,x:t,y:i,team:o.team,dmg:this.bltDmg,moveSpdX:o.getSpdX()}),e.effect&&this.game.callEffect(e.effect,o.avatar,u,p,l),e.sound&&this.game.playEffect(e.sound),this.bltMax>0&&(this.bltCt-=1)},bomb:function(e){for(var t=this.game.contactMgr.getContactList(),i=0,a=t.length;i<a;i++){var n=t[i],o=n.getEntity();Math.abs(n.getPositionX()-e)<200&&n.getPositionY()<900&&o.onHurt(this,1e3)}},endCast:function(){}}),cc._RF.pop()},{"../../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","./Skill":"Skill"}],Bomb:[function(e,t){"use strict";cc._RF.push(t,"310f0xmEQlDHpLDntnfBeIi","Bomb"),cc.Class({extends:e("./ContactBullet"),initStatus:function(){this._super();var e=this.define.bomb;e&&(this.bombDmg=this.config.bombDmg||e.dmg0,this.bombStep=(e.dmg1-e.dmg0)/e.dmg0),this.x00=this.x0,this.y00=this.y0},onRemove:function(e){var t=this.config.cb;t&&!t(this)||this.explosion(e),this._super(e)},remove:function(e){this.removed||(this.removed=!0,this.define.latency?(this.define.bomb.preEffect&&this.game.callEffect(this.define.bomb.preEffect,this.x,this.y,this.define.bomb.r1),this.explodeTimer=this.define.latency):this.onRemove(e))},updateLogic:function(e){this._super(e),this.explodeTimer&&(this.explodeTimer-=e,this.explodeTimer<=0&&(this.onRemove(BULLET_FADE_TYPE.TIME_OUT),this.explodeTimer=null))},explosion:function(e){var t=this.define.bomb;if(!t.exploFunc||!t.exploFunc.call(this,e)){var i=t.r1,a=t.r0,n=this.bombDmg,o=this.bombStep,r=t.kb,s=this.x,c=this.y,l=this.team,d=this.obj;d.bltExploRange&&(i*=d.bltExploRange);var h=this.game.contactMgr.getContactList(),u={};for(var p in h){var f=h[p],m=f.getEntity();if(f._activeContact&&m.isInBorder()&&m.team!=l){var g;if((g=m.getBase?m.getBase().uniqueID:m.uniqueID)&&u[g])continue;var v=f.hitRadius+i,y=s-f.getPositionX(),b=c-f.getPositionY(),k=y*y+b*b;if(k<=v*v){var T=c_sqrt(k)+.1;if(T<=a)m.onHurt(this,n,t.weaponType,t.dmgType);else{var _=n*(1+o*(T-a)/(v-a));m.onHurt(this,_,t.weaponType,t.dmgType)}var w=t.buff;w&&m.addBuff(this,w);var E=r/(T*m.weight);if(m.onKnockback(-y*E,-b*E),m.isDead())if(m.y<=m.height+this.game.contactMgr.findGroundLine(m.x)){var C=y>0&&kit.rnd(-600,-350)||kit.rnd(350,600);m.applyVelocity(C,kit.rnd(1e3,1250))}else{var S=kit.rnd(750,1e3),I=(C=-y/(Math.abs(y)+Math.abs(b))*S,-b/(Math.abs(y)+Math.abs(b))*S);m.applyVelocity(C,I)}g&&(u[g]=!0)}}}var A=this.hurtDelayTime;t.effect&&this.game.callEffect(t.effect,s,c,i,A)}}}),cc._RF.pop()},{"./ContactBullet":"ContactBullet"}],BossBar:[function(e,t){"use strict";cc._RF.push(t,"7b6e0K3JD1A4qXVn08i00cE","BossBar"),cc.Class({extends:cc.Component,properties:{hpBg:cc.Node,hpBar:cc.Sprite,hpLight:cc.Sprite,hpHurt:cc.Sprite,nameLabel:cc.Label},init:function(e,t){this.game=e,this.obj=t,this.nameLabel.string=t.define.name,this.prevRange=1,this.reset()},reset:function(){this.hpBar.fillRange=1,this.hpLight.fillRange=1,this.hpHurt.fillRange=1},setVisible:function(e){this.node.active=e,e&&this.lateUpdate(0)},refresh:function(){var e=this.obj;if(this.hp=e.hp,this.hp<=0)this.node.active=!1;else{var t=e.hp/e.hpMax;this.hpBar.fillRange=t,this.hpHurt.fillRange=this.prevRange,this.tween&&this.tween.stop(),this.tween=cc.tween(this.hpHurt).to(.5,{fillRange:t}).start(),this.hpLight.node.stopAllActions(),this.hpLight.fillRange=this.prevRange,this.hpLight.node.opacity=0,this.hpLight.node.runAction(cc.sequence(cc.fadeIn(.02),cc.fadeOut(.02)).repeat(3)),this.prevRange=t}},lateUpdate:function(){var e=this.obj;this.node,this.hp!=e.hp&&this.refresh()}}),cc._RF.pop()},{}],BouncingBall:[function(e,t){"use strict";cc._RF.push(t,"0eb3cku4z9F5IFvhLxv3Zn7","BouncingBall"),e("./define");var i=e("../entities/environment/MyTower"),a=(e("../entities/projectiles/Bomb"),e("../entities/projectiles/MissileSprite"),e("../entities/projectiles/BallBulletSprite")),n=e("../ai/units/AIMyTower");BULLET_DEFINE.bouncing_ball=[{name:"\u5f39\u5f39",ctor:e("../entities/projectiles/ContactBullet"),noContact:1,jump:8,avatar:{ctor:a,frm:"bullet/iron_ball",sx:1.8,sy:1.8,noBlend:!0,streakEffect:EFFECT.bulletStreak},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:900,spdFluc:0,gravity:-2e3,distance:8888,disExtra:100,thrChance:1,thrDecline:1}],ENTITY.bouncing_ball={id:"bouncing_ball",hero:!0,category:"bouncing_ball",name:"\u5f39\u7403",avatar:{gunBone:"gun",animeName:"toushiji",anime:"weapon/toushiji",s:.9,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:100,bombDmg:50,blt:BULLET_DEFINE.bouncing_ball,bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(-9,108),attackSequence:[{t:.15},{t:1.6,x:72,y:0,blt:1,sound:"sound/cannon_fire",volume:.3}],attackAngle:[-40,80],pilot:{ctor:n,attackRange:550,seekRange:700,spd:2200,gravity:-500,fixAtkDeg:80}},RES.bouncing_ball=[{anime:"weapon/toushiji"}],ENTITY.bouncing_ball_2={id:"bouncing_ball_2",hero:!0,category:"bouncing_ball",name:"\u5f39\u74032",avatar:{gunBone:"gun",animeName:"toushiji2",anime:"weapon/toushiji",s:.9,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:150,bombDmg:75,blt:BULLET_DEFINE.bouncing_ball,bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(-9,108),attackSequence:[{t:.15},{t:1.6,x:72,y:0,blt:1,sound:"sound/cannon_fire",volume:.3}],attackAngle:[-40,80],pilot:{ctor:n,attackRange:550,seekRange:700,spd:2200,gravity:-500,fixAtkDeg:80}},RES.bouncing_ball_2=[{anime:"weapon/toushiji"}],ENTITY.bouncing_ball_3={id:"bouncing_ball_3",hero:!0,category:"bouncing_ball",name:"\u5f39\u74033",avatar:{gunBone:"gun",animeName:"toushiji3",anime:"weapon/toushiji",s:.9,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:225,bombDmg:113,blt:BULLET_DEFINE.bouncing_ball,bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(-9,108),attackSequence:[{t:.15},{t:1.6,x:72,y:0,blt:1,sound:"sound/cannon_fire",volume:.3}],attackAngle:[-40,80],pilot:{ctor:n,attackRange:550,seekRange:700,spd:2200,gravity:-500,fixAtkDeg:80}},RES.bouncing_ball_3=[{anime:"weapon/toushiji"}],ENTITY.bouncing_ball_4={id:"bouncing_ball_4",hero:!0,category:"bouncing_ball",name:"\u5f39\u74034",avatar:{gunBone:"gun",animeName:"toushiji4",anime:"weapon/toushiji",s:.9,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:337,bombDmg:170,blt:BULLET_DEFINE.bouncing_ball,bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(-9,108),attackSequence:[{t:.15},{t:1.6,x:72,y:0,blt:1,sound:"sound/cannon_fire",volume:.3}],attackAngle:[-40,80],pilot:{ctor:n,attackRange:550,seekRange:700,spd:2200,gravity:-500,fixAtkDeg:80}},RES.bouncing_ball_4=[{anime:"weapon/toushiji"}],cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/ContactBullet":"ContactBullet","../entities/projectiles/MissileSprite":"MissileSprite","./define":"define"}],BoxMenu:[function(e,t){"use strict";cc._RF.push(t,"af453jZTLpCab4+gFRNBFhp","BoxMenu"),cc.Class({extends:e("./LootMenu"),properties:{openNode:cc.Node,openLight:cc.Node,openLeft:cc.Node,openRight:cc.Node},initStatus:function(e){this.speed=2,this.openNode.active=!1,this.itemLayoutNode.active=!1,this.lightNode.opacity=0,this.coverNode.opacity=0,this.isBannerOpened()?this.board.y=70:this.board.y=0,this.itemList=[];var t=e.items;if(t){var i=t.length+(e.videoItems?e.videoItems.length:0),a=Math.ceil(i/4);for(var n in this.itemLayoutNode.height=190*a,t)this.addItem(t[n])}this.itemNode.active=!1,menuManager.playEffect(this.readyAudio),this.videoButtonNode.active=!1,this.lootButtonNode.active=!1},onOpen:function(){this.opened||(this.opened=!0)},jump:function(e,t){var i=this.openNode;e.opacity=0,e.scale=.5,e.runAction(cc.sequence(cc.delayTime((t-.4)/this.speed),cc.callFunc(function(){this.openLight.runAction(cc.sequence(cc.fadeTo(.2/this.speed,255),cc.fadeTo(.3/this.speed,100)));var t=e.itemNode.getComponent("Item");this.flyLight(this.node,t.getColor(),t.rank,i.convertToWorldSpaceAR(cc.v2(0,0)),e.convertToWorldSpaceAR(cc.v2(0,0)))},this),cc.delayTime(.6/this.speed),cc.callFunc(function(){menuManager.playEffect(this.itemAudio),e.runAction(cc.spawn(cc.scaleTo(.2/this.speed,1),cc.fadeIn(.2/this.speed)));var t=e.itemShine;t&&(t.opacity=100,t.scale=.5,t.runAction(cc.spawn(cc.scaleTo(.5/this.speed,1),cc.fadeIn(.5/this.speed)).easing(cc.easeSineOut())))},this)))},onJump:function(){menuManager.playEffect(this.openAudio),this.lightNode.runAction(cc.spawn(cc.fadeIn(.3/this.speed),cc.scaleBy(.3/this.speed,7),cc.tintTo(.3/this.speed,255,255,255)).easing(cc.easeIn(1)));var e=this.openNode;this.coverNode.runAction(cc.sequence(cc.fadeIn(.5/this.speed).easing(cc.easeIn(1)),cc.delayTime(.3/this.speed),cc.callFunc(function(){e.active=!0,e.opacity=255,this.openLight.scale=.5,this.openLight.opacity=0,e.runAction(cc.sequence(cc.delayTime(.5/this.speed),cc.callFunc(function(){this.openLight.runAction(cc.sequence(cc.scaleTo(.2/this.speed,1.8,2),cc.scaleTo(.3/this.speed,1.5,1.5)).easing(cc.easeSineInOut())),this.openLight.runAction(cc.fadeTo(.5/this.speed,155)),this.openLeft.runAction(cc.spawn(cc.moveBy(1/this.speed,-15,0),cc.rotateBy(1/this.speed,30)).easing(cc.easeBounceOut())),this.openRight.runAction(cc.spawn(cc.moveBy(1/this.speed,15,0),cc.rotateBy(1/this.speed,-30)).easing(cc.easeBounceOut()))},this))),e.runAction(cc.sequence(cc.jumpTo(.4/this.speed,0,-300,200,1),cc.jumpTo(.2/this.speed,0,-300,60,1),cc.jumpTo(.1/this.speed,0,-300,30,1))),this.lightNode.runAction(cc.fadeOut(.2/this.speed))},this),cc.fadeOut(.5),cc.callFunc(function(){for(var e in this.itemLayoutNode.active=!0,this.itemList){var t=this.itemList[e],i=.6+.3*e;this.jump(t,i)}var a=.3*this.itemList.length;this.node.runAction(cc.sequence(cc.delayTime((a+.2+.5)/this.speed),cc.callFunc(this.onShow,this))),this.openNode.runAction(cc.sequence(cc.delayTime((a+.5)/this.speed),cc.spawn(cc.moveBy(.3/this.speed,0,-100),cc.fadeOut(.3/this.speed))))},this)))}}),cc._RF.pop()},{"./LootMenu":"LootMenu"}],BoxUpgradeInfo:[function(e,t){"use strict";cc._RF.push(t,"1d1bd5x9fFL67AVGLNw0FFv","BoxUpgradeInfo"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{midBoxRewardItem:[cc.Node],bigBoxRewardItem:[cc.Node],lvlLabel:cc.Label,leftArrowNode:cc.Node,rightArrowNode:cc.Node},initStatus:function(){var e=boxLvl.getLvl();this.lvl=e,this.initShow()},initShow:function(){this.lvlLabel.string="LV."+this.lvl;for(var e=MID_BOX_DROP_LIST,t=BIG_BOX_DROP_LIST,i=e[this.lvl],a=0;a<3;a++)i[a]?(this.midBoxRewardItem[a].active=!0,this.midBoxRewardItem[a].getChildByName("label").getComponent(cc.Label).string="X "+i[a].n):this.midBoxRewardItem[a].active=!1;var n=t[this.lvl];for(a=0;a<3;a++)n[a]?(this.bigBoxRewardItem[a].active=!0,this.bigBoxRewardItem[a].getChildByName("label").getComponent(cc.Label).string="X "+n[a].n):this.bigBoxRewardItem[a].active=!1;1==this.lvl?this.leftArrowNode.active=!1:this.leftArrowNode.active=!0,this.lvl==BoxLvlExoDefine.length?this.rightArrowNode.active=!1:this.rightArrowNode.active=!0},changePage:function(e,t){this.lvl=+this.lvl+ +t,this.initShow()}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],Buff:[function(e,t){"use strict";cc._RF.push(t,"b5abc/s9HpL9LquiWOyY2Nl","Buff");var i=cc.Class({extends:e("../../../core/base/Proto"),init:function(e,t,i,a,n){this.define=a,this.config=n,this.obj=i,this.from=t,this.game=e,this.game.addUpdate(this),this.castTimer=a.t,this.attr=this.addAttr(a.attr),this.begin(),a.effect&&(this.effect=this.game.callEffect(a.effect,this))},addAttr:function(e){if(e){var t=this.obj.attribute;for(var i in e){var a=e[i],n=a[0];n==ADD?t.add(a[1],a[2]):n==ADD_SCALE?t.addScale(a[1],a[2]):n==ADD_COVER?t.addCover(a[1],a[2]):n==MUT_SCALE&&t.mutScale(a[1],a[2])}return e}},removeAttr:function(e){if(e){var t=this.obj.attribute;for(var i in e){var a=e[i],n=a[0];n==ADD?t.add(a[1],-a[2]):n==ADD_SCALE?t.addScale(a[1],-a[2]):n==ADD_COVER?t.removeCover(a[1],a[2]):n==MUT_SCALE&&t.mutScale(a[1],-a[2])}return null}},remove:function(){this.end(),this.attr=this.removeAttr(this.attr),this.game.removeUpdate(this),this.effect&&(this.effect.remove(),this.effect=null)},callCover:function(e,t){this.define=e,this.config=t,this.castTimer=e.t,this.cover(e,t)},callEnd:function(){this.attr=this.removeAttr(this.attr),this.game.removeUpdate(this),this.obj.removeBuff(this),this.end(),this.effect&&(this.effect.remove(),this.effect=null)},updateLogic:function(e){this.castTimer&&(this.castTimer-=e,this.castTimer<=0)?this.callEnd():this.update(e)},getPrev:function(){return this.from},cover:function(){},begin:function(){},update:function(){},end:function(){},statics:{uniqueSymbolIndex:0,getSymbol:function(){return i.uniqueSymbolIndex+=1,i.uniqueSymbolIndex}}});cc._RF.pop()},{"../../../core/base/Proto":"Proto"}],BulletLaser:[function(e,t){"use strict";cc._RF.push(t,"608fd9brj1OS74EedFI13fj","BulletLaser");var i=cc.Class({extends:e("./Bullet"),initAvatar:function(){if(!this.game.fastMode){this.define;var e=this.config.obj,t=e.attackSequence[e.attackIndex];if(!e.Electric){e.Electric&&(e.Electric.autoRemoveOnFinish=!0);var i=EFFECT.Laser(t.x,t.y,e,this.game);e.Electric=i,e.Electric.lifetime=this.define.lifetime,i.opacity=0}}},onFail:function(e,t,i){var a=this.ox-e,n=this.oy-t;e=this.ox-(this.oy-i)*a/n,t=i,this.hurtDelayTime=0,this.x=e,this.y=t,this.remove(BULLET_FADE_TYPE.FAIL)},init:function(){this._super.apply(this,arguments);var e=this.config.obj;e.Electric.x=this.config.x,e.Electric.y=this.config.y,this.ox=this.config.x,this.oy=this.config.y},onRemove:function(){var e=this.config.obj,t=this.x,i=this.y,a=kit.vector2Degree(i-this.oy,t-this.ox),n=kit.norm(t-this.ox,i-this.oy);e.Electric.start(this.define.lifetime),e.Electric&&e.Electric.updateLength(n,a),this.define.avatar.hitFloorEffect&&this.game.callEffect(this.define.avatar.hitFloorEffect,t,i),this._super.apply(this,arguments)}});t.exports=i,cc._RF.pop()},{"./Bullet":"Bullet"}],BulletSprite:[function(e,t){"use strict";cc._RF.push(t,"e7c9a1njf5BXqDTxtwt43s4","BulletSprite"),cc.Class({extends:cc.Component,init:function(e,t,i,a){if(this.define=i,this.game=e,e.layer.bindScheduler(this.node),this.scheduleVS(this.updateReal,0),i.frm||i.anime){var n=this.addComponent(cc.Sprite);i.noBlend||(n.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,n.dstBlendFactor=cc.macro.BlendFactor.ONE)}if(i.frm&&e.effectMgr.loadSpriteFromAtlas(n,null,i.frm),i.anime){var o=i.anime,r=this.addComponent(cc.Animation);e.effectMgr.loadAnimation(n,r,o.atlas,o)}this.x=a.x,this.y=a.y,this.deg=t.deg,this.dx=0,this.dy=0,this.dr=0,this.obj=t,this.node.x=this.x,this.node.y=this.y,i.hitEffect&&(this.hitEffect=i.hitEffect),this.move()},move:function(){var e,t=this.node,i=this.define;t.setAnchorPoint(i.a||cc.v2(.5,.5)),t.angle=this.deg,e=i.anime?ANIME_SCALE:1,t.setScale((i.sx||1)*e,(i.sy||1)*e),i.st&&t.runActionVS(cc.scaleTo(i.st,(i.sx1||1)*e,(i.sy1||1)*e)),i.streakEffect&&(this.streak=this.game.callEffect(i.streakEffect,this))},updateRender:function(){var e=this.obj;this.dx=(e.x-this.x)/STEP_TIME,this.dy=(e.y-this.y)/STEP_TIME},updateReal:function(e){this.x+=this.dx*e,this.y+=this.dy*e;var t=this.node;t.x=this.x,t.y=this.y},removeByHit:function(e){var t=this.obj;if("hitWall"==e||this.hitEffect&&this.game.callEffect(this.hitEffect,t.x,t.y,t.deg,t.hurtDelayTime),t.hurtDelayTime<0)throw cc.log(t.define.name),new Error("BulletSprite.removeByHit:obj.hurtDelayTime:"+t.hurtDelayTime);this.node.runActionVS(cc.sequence(cc.moveTo(t.hurtDelayTime||0,t.x,t.y),cc.callFunc(this.removeByHitEnd,this)))},removeByHitEnd:function(){var e=this.node;e.stopAllActionsVS(),e.runActionVS(cc.sequence(cc.scaleTo(.02,e.scaleX,0),cc.destroySelf()));var t=this.obj;this.streak&&this.streak.remove(t.x,t.y,0)},remove:function(e){this.unscheduleVS(this.updateReal),this.removeByHit(e)},setVisible:function(e){this.node.active=e},setLocalZOrder:function(e){this.node.zIndex=e},getLocalZOrder:function(){return this.node.zIndex},getRotation:function(){return this.node.angle},getScale:function(){return this.node.scale},getScaleY:function(){return this.node.scaleY},addChild:function(e,t){this.node.addChild(e,t)}}),cc._RF.pop()},{}],Bullet:[function(e,t){"use strict";var i;cc._RF.push(t,"365ed5mH8hAxpgygbtxTlZ3","Bullet"),window.BULLET_FADE_TYPE={HIT:"hit",TIME_OUT:"time_out",FAIL:"fail",GROUND:"ground",DEATH:"death"};var a=cc.Class(((i={extends:e("../../core/base/Proto"),init:function(e,t,i,a,n){this.define=t,this.config=i,this.game=e;var o=this.obj=i.obj;this.heatOver=i.heatOver,this.team=i.team||0,this.dmg=i.bltDmg||t.dmg||0,this.knockBack=t.kb||0,this.radius=t.radius||0,this._critChance=i.critChance,t.height||0===t.height?this.height=t.height:i.height||0===i.height?this.height=i.height:this.height=1,this.simpleCompute=t.simpleCompute,this.thrDecline=t.thrDecline||0,this.thrChance=t.thrChance||0,o.config.bltThrChance&&(this.thrChance+=o.config.bltThrChance),this.buff=t.buff||i.buff;var r=e.c_rnd(.5,1)*(t.disExtra||250);i.distance&&i.distance<t.distance?r+=i.distance:r+=t.distance;var s=(t.spd||1e3)*n;o.bltSpd&&(s*=o.bltSpd),this.timer=r/s,this.distance=r,this.moveSpd=s;var c=c_degree2cos(a),l=c_degree2sin(a);this.moveSpdX=this.moveSpd*c+(i.moveSpdX||0),this.moveSpdY=this.moveSpd*l,this.deg=a;var d=i.x,h=i.y,u=STEP_TIME;this.timer<=u&&(u=this.timer,this.hurtDelayTime=u),this.timer-=u,this.x=d+this.moveSpdX*u,this.y=h+this.moveSpdY*u,this.gravity=t.gravity,this.damp=t.damp;var p=t.length||0;this.x0=d-c*p,this.y0=h-l*p,this.bulletMark=!0,this.bulletFlag=!0,this.ignoreObject={},i.ignoreObjectID&&(this.ignoreObject[i.ignoreObjectID]=1),null!=i.chain?this.chainCt=i.chain:this.chainCt=t.chain,this.chainDegression=t.chainDegression||i.chainDegression,this.ignoreChainTarget=i.ignoreChainTarget,this.chainRange=t.chainRange,this.chainAngle=t.chainAngle,this.initStatus()},initStatus:function(){this.initAvatar(),this.game.addUpdate(this),this.game.contactMgr.addBullet(this)},initDebug:function(){},initAvatar:function(){var e=this.define.avatar;e&&(this.game.addRender(this),this.avatar=this.game.addBulletSprite(this,e,this.config))},removeAvatar:function(e){this.avatar&&(this.game.removeRender(this),this.avatar.remove(e),delete this.avatar)},updateLogic:function(e){this.timer<=e&&(e=this.timer,this.hurtDelayTime=e),this.timer-=e,this.x0=this.x,this.y0=this.y,this.x+=this.moveSpdX*e,this.y+=this.moveSpdY*e,this.gravity&&(this.moveSpdY+=this.gravity*e,this.deg=c_vector2Degree(this.moveSpdX,this.moveSpdY)),this.damp&&(this.moveSpdX*=this.damp,this.moveSpdY*=this.damp)},updateRender:function(e){this.avatar.updateRender(e)},onTimeOut:function(){this.remove(BULLET_FADE_TYPE.TIME_OUT)},onFail:function(e,t){this.hurtDelayTime=0,this.x=e,this.y=t,this.remove(BULLET_FADE_TYPE.FAIL)},onHitWall:function(e,t,i){var a=this.x-this.x0,n=this.y-this.y0;this.hurtDelayTime=1==i&&0!=a?STEP_TIME*(e-this.x0)/a:2==i&&0!=n?STEP_TIME*(t-this.y0)/n:0,this.define.avatar.hitFloorEffect&&this.game.callEffect(this.define.avatar.hitFloorEffect,e,t),this.x=e,this.y=t,this.remove(BULLET_FADE_TYPE.GROUND)},checkIgnoreObjects:function(e){return this.ignoreObject[e.uniqueID]},addIgnoreObject:function(e){this.ignoreObject[e.uniqueID]=1},onHit:function(e,t){if(!this.checkIgnoreObjects(e)&&!(e.isDead()||e.onBltContact&&e.onBltContact(this))){if(this.explosion&&!this.thrChance)return cc.log("onHitonHitonHit"),void this.remove(BULLET_FADE_TYPE.HIT,e);this.hurtDelayTime=STEP_TIME*t,this.x=this.x0+(this.x-this.x0)*t,this.y=this.y0+(this.y-this.y0)*t;var i=this.define,a=0+e.height;if(!e.onHurt(this,this.dmg,i.weaponType,i.dmgType||DMG_TYPE.blt)){if(e.isDead()){var n=this.moveSpdX>0&&kit.rnd(250,325)||-kit.rnd(250,325),o=kit.rnd(500,700);e.y>a+e.game.contactMgr.findGroundLine(e.x)&&(o=0,n=kit.rnd(55,111)),e.applyVelocity(n,o)}if(this.dmg&&e.hurtEffect||this.game.callEffect(EFFECT.spurt,e,this.deg,this.knockBack,this.hurtDelayTime),this.knockBack){var r=this.knockBack/e.weight;e.onKnockback(this.moveSpdX*r,this.moveSpdY*r)}if(this.buff&&e.addBuff(this,this.buff),this.thrDecline){var s=this.game;if(s.c_rnd(0,1)<this.thrChance){this.dmg*=this.thrDecline,this.addIgnoreObject(e);var c=void 0;return this.avatar?c=this.avatar.hitEffect:console.warn("hitEffect undefined Todo something in future",this.avatar,e,t),c&&s.callEffect(c,e.x,e.y,e.deg,e.hurtDelayTime),!1}}return this.remove(BULLET_FADE_TYPE.HIT,e),!0}}},onRemove:function(e,t){if(this.removeAvatar(e),this.game.removeUpdate(this),this.game.contactMgr.removeBullet(this),this.define.spawnBlt){var i=this.define.spawnBlt;for(var n in i){var o=i[n],r={obj:this.obj,x:this.x+(o.x||0),y:this.y+(o.y||0),deg:o.deg,team:this.obj.team,moveSpdX:this.obj.getSpdX()};a.shot(this.game,o.blt,r)}}if(this.chainCt&&e==BULLET_FADE_TYPE.HIT){var s=this.seekTarget(t,this.ignoreChainTarget,this.chainRange,this.chainAngle);if(s){var c=kit.vector2Degree(s.x-t.x,s.y-t.y);this.ignoreChainTarget=this.ignoreChainTarget||[],this.ignoreChainTarget.push(t.uniqueID),r={obj:this.obj,x:this.x,y:this.y,deg:c,team:this.obj.team,moveSpdX:this.obj.getSpdX(),groundY:this.groundY,ignoreObjectID:t.uniqueID,chain:this.chainCt-1,bltDmg:this.dmg*(this.chainDegression||1),ignoreChainTarget:this.ignoreChainTarget},a.shot(this.game,this.define,r)}}},seekTarget:function(e,t,i,a){for(var n,o,r=this.game.getEntityList(),s=0;s<r.length;s++){var c,l=r[s];if(c=this.define.heal?1-this.team:this.team,l.isInBorder()&&!l.isDead()&&!l._sensor&&l.team!=c&&l!=e){if(t){var d=!1;for(var h in t)if(t[h]==l.uniqueID){d=!0;break}if(d)continue}var u=kit.norm(l.x-e.x,l.y-e.y);(!i||u<=i)&&(a&&kit.includeDegree(this.deg,kit.vector2Degree(l.x-e.x,l.y-e.y))<a&&(u-=1e4),(!n||u<o)&&(n=l,o=u))}}return n}}).seekTarget=function(e,t,i,a){for(var n,o,r=this.game.getEntityList(),s=0;s<r.length;s++){var c,l=r[s];if(c=this.define.heal?1-this.team:this.team,l.isInBorder()&&!l.isDead()&&!l._sensor&&l.team!=c&&l!=e){if(t){var d=!1;for(var h in t)if(t[h]==l.uniqueID){d=!0;break}if(d)continue}var u=kit.norm(l.x-e.x,l.y-e.y);(!i||u<=i)&&(a&&kit.includeDegree(this.deg,kit.vector2Degree(l.x-e.x,l.y-e.y))<a&&(u-=1e4),(!n||u<o)&&(n=l,o=u))}}return n},i.remove=function(e,t){this.removed||(this.removed=!0,this.onRemove(e,t))},i.statics={shot:function(e,t,i,n){var o=i.spd||1,r=t.spdFluc||0,s=i.d||t.d||0,c=e.core.c_rnd,l=t.ctor||a,d=i.n||t.n,h=c_getValue(i.deg,0);if(d&&d>1)for(var u=0;u<d;u++){if(t.wd)var p=s*u/(d-1)-.5*s;else p=c(0,s)-.5*s;var f;(f=new l).init(e,t,i,h+p,c(1,1+r)*o),n&&n(f)}else s&&(h+=c(0,s)-.5*s),(f=new l).init(e,t,i,h,c(1,1+r)*o),n&&n(f)}},i));cc._RF.pop()},{"../../core/base/Proto":"Proto"}],ChapterBoxRewardInfo:[function(e,t){"use strict";cc._RF.push(t,"6cb58H5aedKHoxp+qhH2O3V","ChapterBoxRewardInfo"),cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,itemLayoutNode:cc.Node,itemNode:cc.Node},onLoad:function(){},start:function(){},init:function(e){this.reward=e,this.initItems()},initItems:function(){if(this.itemList)for(var e in this.itemList)this.itemList[e].destroy();this.itemList=[];var t=this.reward;if(t)for(var e in t)this.addItem(t[e]);this.itemNode.active=!1},addItem:function(e){var t=cc.instantiate(this.itemNode);t.active=!0,this.itemLayoutNode.addChild(t);var i=cc.instantiate(this.itemPrefab);t.addChild(i,-1),t.itemNode=i;var a=i.getComponent("Item");return a.init(e),t.model=a.model,t.itemCfg=e,this.itemList.push(t),t}}),cc._RF.pop()},{}],ChapterCompleteMenu:[function(e,t){"use strict";cc._RF.push(t,"170ccqEMoBKh46Ow/ZnXvse","ChapterCompleteMenu");var i=e("../../Plugins/ADManager"),a=e("../../Plugins/firebase/FirebaseTracking"),n=e("../../Plugins/SDKManager");e("../utils/network/ApiClient"),e("../utils/network/ApiEndpoints"),cc.Class({extends:e("./ShowMenu"),properties:{titleNodes:[cc.Node],backBtnNode:cc.Node,lootBtnNode:cc.Node,layoutNode:cc.Node,videoBtnNode:cc.Node,vehiclePrefab:cc.Prefab,avatarNode:cc.Node,animeNode:cc.Node,itemBg:cc.Node,jumpToAdventureBtnNode:cc.Node,recordBtnNode:cc.Node,rollAudio:{type:cc.AudioClip,default:null},winAudio:{type:cc.AudioClip,default:null},failAudio:{type:cc.AudioClip,default:null}},initStatus:function(e){var t=this;for(var i in this.args=e,this.items=e.items,this.itemList=[],this.itemNode.active=!1,this.titleNodes)this.titleNodes[i].active=!1;this.node.getChildByName("bg").active=!1;var n=0;if(e.items&&(n+=2*e.items.length),e.win&&e.vehicleConfig&&e.vehicleConfig.stack>1&&n++,n){var o=kit.clamp(Math.ceil(n/6),2,5);this.itemLayoutNode.height=110*o+50,n<=6&&(this.itemLayoutNode.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.CONTAINER,this.itemLayoutNode.getComponent(cc.Layout).type=cc.Layout.Type.HORIZONTAL),this.itemBg.height=this.itemLayoutNode.height}else this.itemBg.active=!1;this.itemLength=n,this.layoutNode.active=!1,this.backBtnNode.active=!1,this.lootBtnNode.active=!1,this.videoBtnNode.active=!1,this.lootBtnNode.onTouch=function(){t.videoBtnNode.active=!1,t.lootBtnNode.active=!1,t.onLoot()},this.videoBtnNode.onTouch=function(){var i=e.items;sdk.useFree("x2_complete",function(e){e||(t.videoBtnNode.active=!1,equipment.getItemFromReward([],i),net.updateData({items:i},function(e,n){a.FirebaseTracking.setDataBiRes("ChapterCompleteMenu"),money.update(n),t.addItems(i),t.items=t.items.concat(i)}),YMTJ("video","lv_double"))})},e.win?this.initWin(e):this.initFail(e)},initWin:function(t){cc.log("[ChapterCompleteMenu] initWin called");var o=t&&t.game&&t.game.gunnerMode;cc.log("[ChapterCompleteMenu] Is gunner mode?",o,"game obj:",t.game);var r=null;if(!window.StatsTracker)try{e("../managers/StatsTracker"),cc.log("[ChapterCompleteMenu] Loaded StatsTracker")}catch(t){console.warn("[ChapterCompleteMenu] Failed to load StatsTracker:",t)}if(window.StatsTracker&&(r=StatsTracker.getSessionStats(),cc.log("[ChapterCompleteMenu] StatsTracker exists:",!!window.StatsTracker),cc.log("[ChapterCompleteMenu] Stats collected:",JSON.stringify(r)),r&&this.node)){var s=e("../ui/stats/StatsDisplayOverlay");s&&s.attachToGameOverScreen(this.node,r)}if(o)cc.log("[ChapterCompleteMenu] Skipping Firebase tracking - already done in gunnerMode");else{var c=n.SDKManager.Instance.endLevelTimer(),l=a.FirebaseTracking.levelID,d=n.SDKManager.Instance.generateUniqueID(l),h=n.SDKManager.Instance.getAttempts(l),u=i.ADManager.Instance.IsReviveAds?1:0,p="",f=0,m=0,g=0,v=0,y=0,b=0,k=0,T=0,_=0,w=0,E=0;cc.log("[ChapterCompleteMenu] Stats available:",!!r),r?(cc.log("[ChapterCompleteMenu] Processing stats, content:",JSON.stringify(r)),p=r.equipmentEncoded||"",r.damageByWeapon&&(cc.log("[ChapterCompleteMenu] damageByWeapon found:",JSON.stringify(r.damageByWeapon)),f=Math.floor(r.damageByWeapon.sniper||0),m=Math.floor(r.damageByWeapon.machinegun||0),g=Math.floor(r.damageByWeapon.firethrower||0),v=Math.floor(r.damageByWeapon.mortar||0),y=Math.floor(r.damageByWeapon.bouncingball||0),b=Math.floor(r.damageByWeapon.cannon||0),k=Math.floor(r.damageByWeapon.laser||0),T=Math.floor(r.damageByWeapon.tesla||0),_=Math.floor(r.damageByWeapon.flyshield||0)),r.recovery&&(w=Math.floor(r.recovery.hp||0),E=Math.floor(r.recovery.armor||0))):cc.log("[ChapterCompleteMenu] No stats available to send to Firebase"),cc.log("[ChapterCompleteMenu] Sending to Firebase - equipment:",p,"dmg_sniper:",f,"dmg_machinegun:",m),a.FirebaseTracking.logGameOver(d,c,u,1,0,h,p,f,m,g,v,y,b,k,T,_,w,E)}var C=t.vehicleConfig;C.vid,C.driver=1,C.pilotScale=.6,this.args.train,this.addItems(t.items);var S=this.titleNodes[0];S.active=!0,this.anime=S.getComponent(cc.Animation);var I=S.getPosition();S.y=100,S.opacity=0,S.runAction(cc.sequence(cc.delayTime(t.delay||0),cc.callFunc(function(){t.hideCb&&t.hideCb();var e=this.node.getChildByName("bg");e.active=!0,e.opacity=0,e.runAction(cc.fadeTo(.2,150)),menuManager.stopBgm(),menuManager.playEffect(this.winAudio),this.anime.play("winStart"),this.anime.on("stop",this.onAnimeStop,this)},this),cc.delayTime(2.5),cc.callFunc(function(){this.args.train||this.avatarNode.runAction(cc.moveTo(1,0,this.avatarNode.y).easing(cc.easeOut(2)))},this),cc.moveTo(.5,I).easing(cc.easeInOut(2)),cc.callFunc(function(){var e=this;this.anime.off("stop",this.onAnimeStop,this),this.anime.stop(),this.layoutNode.active=!0,this.layoutNode.opacity=0,this.layoutNode.runAction(cc.fadeIn(.2));var t=C.stack-1,i=0;!this.args.train&&t>0&&function(){var a=e.itemList[e.itemList.length-1],n=a.itemNode.getComponent("Item"),o=cc.color(255,255,0),r={i:DIAMOND,n:0};a.opacity=0;for(var s=function(t){var s=5*++i;e.node.runAction(cc.sequence(cc.delayTime(.2+.5*i),cc.callFunc(function(){cc.log("====== complete menu init win aaaaaaaa"),menuManager.playEffect(this.rollAudio);var e=this.model,i=e.node;e.setStageVisible(t,!1);var n=cc.instantiate(this.animeNode);i.addChild(n),n.active=!0,n.setPosition(e.getTowerPosition(t)),n.getComponent(cc.Animation).play(),this.flyLight(this.node,o,1,n.convertToWorldSpaceAR(cc.v2(0,0)),a.convertToWorldSpaceAR(cc.v2(0,0)))},e),cc.delayTime(.6),cc.callFunc(function(){r.n+=s,a.opacity=255,n.setNum(r)},e)))},c=t;c>0;c--)s(c)}(),this.node.runAction(cc.sequence(cc.delayTime(.5*i+.5),cc.callFunc(function(){this.args.train||this.avatarNode.runAction(cc.moveTo(1,cc.winSize.width,this.avatarNode.y).easing(cc.easeIn(2)))},this),cc.delayTime(.5),cc.callFunc(function(){this.showButton()},this)))},this)))},onAnimeStop:function(){this.anime.play("winUpdate")},initFail:function(t){var o=t&&t.game&&t.game.gunnerMode;cc.log("[ChapterCompleteMenu] Is gunner mode?",o,"game obj:",t.game);var r=null;if(window.StatsTracker&&(r=StatsTracker.getSessionStats())&&this.node){var s=e("../ui/stats/StatsDisplayOverlay");s&&s.attachToGameOverScreen(this.node,r)}o&&cc.log("[ChapterCompleteMenu] Skipping Firebase tracking - already done in gunnerMode");var c=n.SDKManager.Instance.endLevelTimer(),l=a.FirebaseTracking.levelID,d=n.SDKManager.Instance.generateUniqueID(l),h=n.SDKManager.Instance.getAttempts(l),u=i.ADManager.Instance.IsReviveAds?1:0,p="",f=0,m=0,g=0,v=0,y=0,b=0,k=0,T=0,_=0,w=0,E=0;cc.log("[ChapterCompleteMenu] Stats available:",!!r),r&&(cc.log("[ChapterCompleteMenu] Processing stats, content:",JSON.stringify(r)),p=r.equipmentEncoded||"",r.damageByWeapon&&(cc.log("[ChapterCompleteMenu] damageByWeapon found:",JSON.stringify(r.damageByWeapon)),f=Math.floor(r.damageByWeapon.sniper||0),m=Math.floor(r.damageByWeapon.machinegun||0),g=Math.floor(r.damageByWeapon.firethrower||0),v=Math.floor(r.damageByWeapon.mortar||0),y=Math.floor(r.damageByWeapon.bouncingball||0),b=Math.floor(r.damageByWeapon.cannon||0),k=Math.floor(r.damageByWeapon.laser||0),T=Math.floor(r.damageByWeapon.tesla||0),_=Math.floor(r.damageByWeapon.flyshield||0)),r.recovery&&(w=Math.floor(r.recovery.hp||0),E=Math.floor(r.recovery.armor||0))),a.FirebaseTracking.logGameOver(d,c,u,0,0,h,p,f,m,g,v,y,b,k,T,_,w,E),sdk.setAdjustEvent("qhikn7",""),this.addItems(t.items);var C=this.titleNodes[1];C.active=!0;var S=C.getPosition();C.y=100,C.opacity=0,C.scale=2,C.runAction(cc.sequence(cc.delayTime(t.delay||0),cc.callFunc(function(){t.hideCb&&t.hideCb();var e=this.node.getChildByName("bg");e.active=!0,e.opacity=0,e.runAction(cc.fadeTo(.2,150)),menuManager.stopBgm(),menuManager.playEffect(this.failAudio)},this),cc.spawn(cc.jumpTo(2,S.x,50,50,3),cc.scaleTo(.5,1),cc.fadeIn(.5)).easing(cc.easeElasticOut(1)),cc.moveTo(.3,S).easing(cc.easeInOut(2)),cc.callFunc(function(){this.layoutNode.active=!0,this.layoutNode.opacity=0,this.layoutNode.runAction(cc.fadeIn(.2)),this.showButton(),cc.log("====== complete menu  aaaaaaaa")},this)))},showButton:function(){if(!this.itemLength)return this.backBtnNode.active=!0,void(this.args.jumpToAdventure&&(this.backBtnNode.active=!1,this.jumpToAdventureBtnNode.active=!0));this.lootBtnNode.active=!0,this.videoBtnNode.active=!this.args.noVideo,this.recordBtnNode.active=!1},addItems:function(e){if(cc.log("====== complete menu additems"),e)for(var t in e)this.addItem(e[t]).active=!0},onLoot:function(){var e=this.got();this.videoBtnNode.active=!1,this.lootBtnNode.active=!1,this.node.runAction(cc.sequence(cc.delayTime(e),cc.callFunc(this.onBack,this)))},onBack:function(){var e=this.args.nextCb;e?e():menuManager.back(-1)}}),cc._RF.pop()},{"../../Plugins/ADManager":"ADManager","../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../managers/StatsTracker":"StatsTracker","../ui/stats/StatsDisplayOverlay":"StatsDisplayOverlay","../utils/network/ApiClient":"ApiClient","../utils/network/ApiEndpoints":"ApiEndpoints","./ShowMenu":"ShowMenu"}],ChapterDefine:[function(e,t){"use strict";cc._RF.push(t,"04ed3fg8T9MAoTpWXUuudS9","ChapterDefine"),window.CHAPTER_DEFINE_ARRAY=window.CHAPTER_DEFINE_ARRAY||[];var i=window.CHAPTER_DEFINE_ARRAY;window.initChapterDefineFromData=function(e){function t(e){switch(e){case"EQUIPMENT":return EQUIPMENT;case"EXP":return EXP;case"TALENT":return TALENT;case"SHARD":return SHARD;default:return e}}function a(e){var i={name:LI(e.name.trim()),theme:e.theme,indexName:LI(e.indexName.trim()),excelData:e.excelData,mapPool:e.mapPool||{},energy:e.energy,stage:e.stage};return e.item&&(i.item=e.item.map(function(e){var i={i:t(e.i),n:e.n};return e.id&&(i.id=e.id),void 0!==e.rarity&&(i.rarity=e.rarity),i})),e.item0&&(i.item0=e.item0.map(function(e){var i={i:t(e.i),n:e.n};return e.id&&(i.id=e.id),void 0!==e.rarity&&(i.rarity=e.rarity),i})),e.rewardBox&&(i.rewardBox=e.rewardBox.map(function(e){return e.map(function(e){var i={i:t(e.i),n:e.n};return e.id&&(i.id=e.id),void 0!==e.rarity&&(i.rarity=e.rarity),i})})),void 0!==e.unlockSlot&&(i.unlockSlot=e.unlockSlot),i}i=[],console.log(e);for(var n=Object.keys(e).sort(),o=0;o<n.length;o++){var r=e[n[o]];i.push(a(r))}return window.CHAPTER_DEFINE_ARRAY=i,i},cc._RF.pop()},{}],ChapterNewMenu:[function(e,t){"use strict";cc._RF.push(t,"8bab6VZnI9OnLOXbLt67tQz","ChapterNewMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{chapterLabel:cc.Label,chapterSprite:cc.Sprite,itemLayoutNode:cc.Node,itemBoard:cc.Node,fadeNodes:[cc.Node],pressNode:cc.Node,starNode:cc.Node,chapter3Icons:[cc.SpriteFrame]},initStatus:function(e){var t=this,i=e.chapterIndex,a=window.CHAPTER_DEFINE_ARRAY[i];this.chapterLabel.string=a.indexName+" "+a.name;var n=THEME_DEFINE[a.theme].ui;for(var o in cc.resources.load(n,cc.SpriteFrame,function(e,i){t.chapterSprite.spriteFrame=i}),this.iconList=[],this.itemBoard.active=this.iconList.length>0,this.noWait=!0,this.node.opacity=0,this.pressNode.runAction(cc.sequence(cc.fadeIn(1),cc.fadeOut(1)).repeatForever()),this.fadeNodes){var r=this.fadeNodes[o];r.opacity=0,r.scale=.5}this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){for(var e in this.fadeNodes)this.fadeNodes[e].runAction(cc.sequence(cc.delayTime(.2*e),cc.spawn(cc.fadeIn(.3),cc.scaleTo(.3,1))))},this),cc.fadeIn(.2),cc.callFunc(function(){this.noWait=!1,this.shine()},this))),this.starNode.active=!1},shine:function(){this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){var e=cc.instantiate(this.starNode);e.x=kit.rnd(-.5,.5)*cc.winSize.width,e.y=kit.rnd(-.5,.5)*cc.winSize.height,this.node.addChild(e),e.scale=0,e.active=!0,e.runAction(cc.sequence(cc.scaleTo(.1,1),cc.delayTime(.2),cc.fadeOut(.2),cc.destroySelf()).easing(cc.easeInOut(1)))},this)).repeatForever())},onTouchClose:function(){this.noWait||this.close()}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],CheckMenu:[function(e,t){"use strict";cc._RF.push(t,"30cf3TN+6tBnKcXZVfrligf","CheckMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{titleLabel:cc.Label,btnLabel:cc.Label,infoText:cc.RichText,btnNoLabel:cc.Label},initStatus:function(e){e.title&&this.titleLabel&&(this.titleLabel.string=e.title),this.infoText&&(e.info&&(this.infoText.string=e.info),void 0!==e.infoAlign&&(this.infoText.horizontalAlign=e.infoAlign),e.infoColor&&(this.infoText.node.color=e.infoColor));var t=e.btnYes||e.btn;t&&this.btnLabel&&(this.btnLabel.string=t),e.btnNo&&this.btnNoLabel&&(this.btnNoLabel.string=e.btnNo)},onPlace:function(){this._super(),this.args.guide&&menuManager.hotOn(this.btnLabel.node,0,5e3)},onCheck:function(e,t){var i=this.args.checkCb;i&&i.call(this,t)||this.close(t)}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],ClickButton:[function(e,t){"use strict";cc._RF.push(t,"0a3221YS25AwIRUgmnbemcU","ClickButton"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this.getComponent(cc.Button);e||((e=this.node.addComponent(cc.Button)).transition=cc.Button.Transition.SCALE),this.node.on("click",this.onTouch,this)},onTouch:function(){var e=this.node.onTouch;e&&e.call(this.node,menuManager.current())}}),cc._RF.pop()},{}],ColorMatrix:[function(e,t){"use strict";cc._RF.push(t,"742fedotK9JGLjWXtnj7HVp","ColorMatrix"),cc.Class({ctor:function(){this.rawData=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},getArgs:function(){return[["Mat4","u_mat4",this.getMatrix()],["Vec4","u_vec4",this.getOffset()]]},getOffset:function(){var e=this.rawData;return cc.vec4(e[4],e[9],e[14],e[19])},getMatrix:function(){var e=this.rawData;return cc.mat4(e[0],e[1],e[2],e[3],e[5],e[6],e[7],e[8],e[10],e[11],e[12],e[13],e[15],e[16],e[17],e[18])},concat:function(e){for(var t=[],i=this.rawData,a=0;a<4;a++)t[5*a+0]=e[5*a]*i[0]+e[5*a+1]*i[5]+e[5*a+2]*i[10]+e[5*a+3]*i[15],t[5*a+1]=e[5*a]*i[1]+e[5*a+1]*i[6]+e[5*a+2]*i[11]+e[5*a+3]*i[16],t[5*a+2]=e[5*a]*i[2]+e[5*a+1]*i[7]+e[5*a+2]*i[12]+e[5*a+3]*i[17],t[5*a+3]=e[5*a]*i[3]+e[5*a+1]*i[8]+e[5*a+2]*i[13]+e[5*a+3]*i[18],t[5*a+4]=e[5*a]*i[4]+e[5*a+1]*i[9]+e[5*a+2]*i[14]+e[5*a+3]*i[19]+e[5*a+4];for(a=0;a<20;a++)this.rawData[a]=t[a]},setSaturation:function(e){var t=1-e,i=.212671*t,a=.71516*t,n=.072169*t,o=[i+e,a,n,0,0,i,a+e,n,0,0,i,a,n+e,0,0,0,0,0,1,0];return this.concat(o),this},setContrast:function(e,t,i){var a=[e+1,0,0,0,.5*-e,0,t+1,0,0,.5*-t,0,0,i+1,0,.5*-i,0,0,0,1,0];return this.concat(a),this},setBrightness:function(e,t,i){var a=[1,0,0,0,e,0,1,0,0,t,0,0,1,0,i,0,0,0,1,0];return this.concat(a),this},setHue:function(e){e*=.01745;var t=Math.cos(e),i=Math.sin(e),a=[.212671+.787329*t+-.212671*i,.71516+-.71516*t+-.71516*i,.072169+-.072169*t+.927831*i,0,0,.212671+-.212671*t+.143*i,.71516+.28484*t+.14*i,.072169+-.072169*t+-.283*i,0,0,.212671+-.212671*t+-.787329*i,.71516+-.71516*t+.71516*i,.072169+.927831*t+.072169*i,0,0,0,0,0,1,0];return this.concat(a),this},rotHue:function(e){this.concat([.7751357857532615,-.44674630028947854,-.4467463002894786,0,0,0,.7071067811865476,-.7071067811865475,0,0,.5376955000889125,1.0618005111930762,.14287437137812964,0,0,0,0,0,1,0]),e*=.01745;var t=Math.sin(e),i=Math.cos(e),a=[i,-t,0,0,0,t,i,0,0,0,0,0,1,0,0,0,0,0,1,0];return this.concat(a),this.concat([.8518337785912076,-.4105268532016195,.631794676809384,0,0,-.3802081343263619,.35096051346921253,.5481037704464939,0,0,-.38020813432636197,-1.0632530489038825,.548103770446494,0,0,0,0,0,1,0]),this}}),cc._RF.pop()},{}],ConditionBuff:[function(e,t){"use strict";cc._RF.push(t,"bf2e29L2TBHb5gB9GcMmGm0","ConditionBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.conditionFunc=e.condition.func,this.conditionAttr=e.condition.attr},update:function(){this.conditionFunc(this.obj)?this.extraAttr||(this.extraAttr=this.addAttr(this.conditionAttr)):this.extraAttr&&(this.extraAttr=this.removeAttr(this.extraAttr))},end:function(){this.extraAttr&&(this.extraAttr=this.removeAttr(this.extraAttr))}}),cc._RF.pop()},{"./Buff":"Buff"}],ConfigSourceManager:[function(e,t){"use strict";cc._RF.push(t,"placeholder-uuid","ConfigSourceManager");var i=cc.Class({statics:{useRemoteConfig:!0,CONFIG_REGISTRY:{BattlePassRewardConfig:{remoteKey:"battle_pass_reward_config",localPath:"config/BattlePassRewardConfig"},BattlePassExtraRewardConfig:{remoteKey:"battle_pass_extra_reward_config",localPath:"config/BattlePassExtraRewardConfig"},TaskConfig:{remoteKey:"task_config",localPath:"config/TaskConfig"},TaskMilestoneConfig:{remoteKey:"task_milestone_config",localPath:"config/TaskMilestoneConfig"}},loadConfig:function(e,t){var i=this,a=this.CONFIG_REGISTRY[e];return a?cc.sys.isBrowser?(cc.log("[ConfigSourceManager] Web platform detected, using local config:",e),this.loadLocalConfig(a.localPath,t)):this.useRemoteConfig?(cc.log("[ConfigSourceManager] Attempting remote config for:",e),void this.loadRemoteConfig(a.remoteKey,function(n,o){n||!o?(cc.warn("[ConfigSourceManager] Remote config failed for",e,"- falling back to local"),cc.warn("[ConfigSourceManager] Error:",n),i.loadLocalConfig(a.localPath,t)):(cc.log("[ConfigSourceManager] Remote config loaded successfully for:",e),t(null,o))})):(cc.log("[ConfigSourceManager] Remote config disabled globally - using local"),this.loadLocalConfig(a.localPath,t)):(cc.error("[ConfigSourceManager] Unknown config:",e),t(new Error("Unknown config: "+e)))},loadLocalConfig:function(e,t){try{cc.resources.load(e,function(i,a){if(i)return cc.error("[ConfigSourceManager] Failed to load local config:",e,i),t(i);var n=a.json||a;cc.log("[ConfigSourceManager] Local config loaded:",e),t(null,n)})}catch(i){cc.error("[ConfigSourceManager] Error loading local config:",e,i),t(i)}},loadRemoteConfig:function(e,t){var i=this;if(!window.RemoteConfigManager||!window.RemoteConfigManager.getInstance)return t(new Error("RemoteConfigManager not available"));var a=window.RemoteConfigManager.getInstance();a.isInitialized?this._fetchRemoteConfigValue(e,t):a.initialize().then(function(){i._fetchRemoteConfigValue(e,t)}).catch(function(e){t(e)})},_fetchRemoteConfigValue:function(e,t){try{var i=window.RemoteConfigManager.getInstance().getString(e);if(!i||""===i)return t(new Error("Remote config key not found: "+e));t(null,JSON.parse(i))}catch(a){cc.error("[ConfigSourceManager] Error parsing remote config:",e,a),t(a)}},enableRemoteConfig:function(){this.useRemoteConfig=!0,cc.log("[ConfigSourceManager] Remote config enabled globally")},disableRemoteConfig:function(){this.useRemoteConfig=!1,cc.log("[ConfigSourceManager] Remote config disabled globally")},isUsingRemoteConfig:function(){return!cc.sys.isBrowser&&this.useRemoteConfig},getConfigSourceInfo:function(e){var t=this.CONFIG_REGISTRY[e];if(!t)return{error:"Unknown config"};var i=cc.sys.isBrowser,a=this.useRemoteConfig&&!i;return{configName:e,platform:i?"web":"native",useRemoteConfig:this.useRemoteConfig,actualSource:a?"remote":"local",remoteKey:t.remoteKey,localPath:t.localPath}}}});window.ConfigSourceManager=i,t.exports=i,cc._RF.pop()},{}],ConsecutiveHPManager:[function(e,t){"use strict";cc._RF.push(t,"8977fWvl4FE75A2nsGs5f5Q","ConsecutiveHPManager");var i={stageHistory:[],maxHistorySize:3,isMultiplierActive:!1,initialize:function(){console.log("[ConsecutiveHPManager] Initializing consecutive HP tracking"),this.stageHistory=[],this.isMultiplierActive=!1},recordStageCompletion:function(e,t,i){var a=window.GAME_CONFIG?window.GAME_CONFIG.hp_consecutive:.8;i<=a&&(this.stageHistory.length>0&&console.log("[ConsecutiveHPManager] \u26a0 HP dropped to",(100*i).toFixed(1)+"% (<= "+100*a+"%) - RESETTING consecutive count"),this.stageHistory=[],this.isMultiplierActive=!1);var n={chapterIndex:e,mapIndex:t,hpPercent:i};this.stageHistory.push(n),this.stageHistory.length>this.maxHistorySize&&this.stageHistory.shift(),this.checkMultiplierStatus(),console.log("[ConsecutiveHPManager] Recorded stage - Chapter:",e+1,"Stage:",t+1,"HP:",(100*i).toFixed(1)+"%"),console.log("[ConsecutiveHPManager] Stage history:",this.stageHistory.length,"stages tracked")},checkMultiplierStatus:function(){if(this.stageHistory.length<3)this.isMultiplierActive=!1;else{var e=window.GAME_CONFIG?window.GAME_CONFIG.hp_consecutive:void 0;if(void 0===e)return console.error("[ConsecutiveHPManager] ERROR: hp_consecutive is undefined in GAME_CONFIG"),void(this.isMultiplierActive=!1);for(var t=!0,i=0;i<this.stageHistory.length;i++)if(this.stageHistory[i].hpPercent<=e){t=!1;break}var a=this.isMultiplierActive;this.isMultiplierActive=t,a!==this.isMultiplierActive&&(this.isMultiplierActive?console.log("[ConsecutiveHPManager] \u2713 MULTIPLIER ACTIVATED - 3 consecutive stages with HP >",100*e+"%"):console.log("[ConsecutiveHPManager] \u2717 Multiplier deactivated - HP dropped below threshold"))}},getModifiedLevels:function(e,t){if(!window.FEATURE_TOGGLE||!window.FEATURE_TOGGLE.multiplier_mode)return{lvl:e,lvl2:t,multiplied:!1};if(!this.isMultiplierActive)return{lvl:e,lvl2:t,multiplied:!1};var i=window.multiplier_diff;if(null==i)return console.error("[ConsecutiveHPManager] ERROR: window.multiplier_diff is undefined!"),console.log("[ConsecutiveHPManager] Check if GAME_CONFIG has multiplier_diff value"),{lvl:e,lvl2:t,multiplied:!1};var a=Math.round(e*i),n=Math.round(t*i*10)/10;return console.log("[ConsecutiveHPManager] Applying multiplier:",i,"- Original lvl:",e,"\u2192",a,"- Original lvl2:",t,"\u2192",n),{lvl:a,lvl2:n,multiplied:!0}},resetHistory:function(){console.log("[ConsecutiveHPManager] Resetting stage history"),this.stageHistory=[],this.isMultiplierActive=!1},getDebugInfo:function(){for(var e=[],t=0;t<this.stageHistory.length;t++){var i=this.stageHistory[t];e.push("C"+(i.chapterIndex+1)+"-"+(i.mapIndex+1)+": "+(100*i.hpPercent).toFixed(0)+"%")}var a=window.GAME_CONFIG?window.GAME_CONFIG.hp_consecutive:.8,n=this.stageHistory.filter(function(e){return e.hpPercent>a}).length;return{isActive:this.isMultiplierActive,multiplier:window.multiplier_diff,consecutiveCount:n,recentStages:e.join(", ")||"None"}}};t.exports=i,cc._RF.pop()},{}],ContactBullet:[function(e,t){"use strict";cc._RF.push(t,"dc29cQ1UOFHdLHQkiU8X1h3","ContactBullet");var i=e("./Bullet");cc.Class({extends:i,initStatus:function(){this.initAvatar(),this.game.addUpdate(this);var e=this.define;e.noContact?(this.game.contactMgr.addBullet(this),this.jumpCt=0,this.jumpMax=e.jump||0):(this.hp=e.hp||1,this.hitRadius=e.hitRadius||this.radius,this.game.contactMgr.addEntity(this),this.jumpCt=0,this.jumpMax=e.jump||0,this.jumpHitCt=e.jumpHitCt||0,this.jumpHitCtRecord={})},onContact:function(e){var t=!1;e.team!==this.team&&(this.thrChance?this.removed||this.onHit(e,0):(this.remove(BULLET_FADE_TYPE.HIT),t=!0)),cc.log("ContactBullet onContact thrChance",this.thrChance,this.obj.define.id,t)},updateLogic:function(e){if(this._super(e),this.define.noContact){if(this.jumpMax&&this.y-this.radius<this.game.contactMgr.findGroundLine(this.x))if(this.jumpCt++,this.jumpCt>this.jumpMax)this.remove(BULLET_FADE_TYPE.GROUND);else if(this.moveSpdY=.85*-this.moveSpdY,this.moveSpdX*=.9,this.y=this.game.contactMgr.findGroundLine(this.x)+this.radius,this.jumpHitCt)for(var t in this.ignoreObject)(!this.jumpHitCtRecord[t]||this.jumpHitCtRecord[t]<this.jumpHitCt)&&(this.ignoreObject[t]=null,this.jumpHitCtRecord[t]=this.jumpHitCtRecord[t]||0,this.jumpHitCtRecord[t]++)}else this.timer<=0?this.remove(BULLET_FADE_TYPE.TIME_OUT):this.y-this.radius<this.game.contactMgr.findGroundLine(this.x)&&(this.jumpCt++,this.jumpCt>this.jumpMax?this.remove(BULLET_FADE_TYPE.GROUND):(this.moveSpdY=.8*-this.moveSpdY,this.moveSpdX-=70,this.y=this.game.contactMgr.findGroundLine(this.x)+this.radius))},callDeath:function(){this.remove(BULLET_FADE_TYPE.DEATH)},onHurt:function(e,t){if(cc.log("ContactBullet onHurt",this.hp,t),this.hp-=t,EFFECT.hurtRed(this.avatar),this.hp<=0)return this.callDeath(),!0},onRemove:function(e){if(cc.log("ContactBullet onRemove",e),this.removeAvatar(e),this.game.removeUpdate(this),this.define.noContact?this.game.contactMgr.removeBullet(this):this.game.contactMgr.removeEntity(this),this.define.spawnBlt){var t=this.define.spawnBlt;for(var a in t){var n=t[a],o={obj:this.obj,x:this.x+(n.x||0),y:this.y+(n.y||0),deg:n.deg,team:this.obj.team,moveSpdX:this.obj.getSpdX()};i.shot(this.game,n.blt,o)}}},getPositionX:function(){return this.x},getPositionY:function(){return this.y},getEntity:function(){return this}}),cc._RF.pop()},{"./Bullet":"Bullet"}],ContactManager:[function(e,t){"use strict";cc._RF.push(t,"3e8d8Er9MdJKr3MKw0vghP0","ContactManager");var i=e("../entities/environment/Ground");cc.Class({initDebug:function(){if(DEBUG_MAP){var e=new cc.Node;this.game.layer.addToTop(e,ZORDER.UI);var t=this.mapDraw=e.addComponent(cc.Graphics);for(var i in t.lineWidth=5,t.strokeColor=cc.color(255,255,255),t.moveTo(-1e3,0),this.groundWave){var a=this.groundWave[i];t.lineTo(a.x,a.y),t.stroke()}e=new cc.Node,this.game.layer.addToTop(e,ZORDER.UI),this.bulletDraw=e.addComponent(cc.Graphics),e=new cc.Node,this.game.layer.addToTop(e,ZORDER.UI),this.entityDraw=e.addComponent(cc.Graphics)}},initMap:function(e,t){this.contactList=[],this.bulletList=[],this.game=e,this.initGround(t),this.initDebug()},initGround:function(e){this.groundLine=0,this.platformList=[],this.groundList=[];var t=e.ground;for(var a in t){var n=new i;n.init(t[a]),this.groundList.push(n)}},findPlatform:function(e,t,i){this.platformNeedUpdate&&(this.platformNeedUpdate=!1,this.platformList.sort(function(e,t){return t.getGroundLine(0)-e.getGroundLine(0)}));for(var a=0,n=this.platformList.length;a<n;a++){var o=this.platformList[a];if(o.groundIndex==i&&e>o.getGroundLeft()&&e<=o.getGroundRight()&&t>=o.getGroundLine(e))return o}return this.findGround(e,t,i)},findGround:function(e,t,i){void 0===i&&(i=0);var a=this.groundList[i];return a?a.findGround(e,t):this.groundList[0].findGround(e,t)},findGroundLine:function(e){return this.groundList[0].findGround(e).getGroundLine(e)},addPlatform:function(e){this.platformList.push(e),this.platformNeedUpdate=!0},removePlatform:function(e){var t=this.platformList.indexOf(e);t>=0&&this.platformList.splice(t,1)},addEntity:function(e,t){e._inContactList?e._needRemoveContact=!1:(e._sensor||e.radius&&!(e.radius<0)||cc.error("ContactManager.addEntity: wrong radius="+e.radius),(!e.hitRadius||e.hitRadius<0)&&cc.error("ContactManager.addEntity: wrong hitRadius="+e.hitRadius),e._inContactList||(t?this.contactList.unshift(e):this.contactList.push(e)),e._inContactList=!0,e._needRemoveContact=!1,e._activeContact=!0)},removeEntity:function(e){e._activeContact=!1,e._needRemoveContact=!0},addBullet:function(e){if(!e._activeContact&&(e._activeContact=!0,this.bulletList.push(e),DEBUG_MAP&&e.debug)){var t=new cc.Node;this.game.layer.addToTop(t,ZORDER.UI+2);var i=e.debugDraw=t.addComponent(cc.Graphics);e.config&&e.config.x&&(i.circle(e.config.x,e.config.y,5),i.fillColor=cc.color(255,255,0,155),i.fill()),i.circle(e.x0,e.y0,5),i.fillColor=cc.color(0,255,255,155),i.fill(),i.circle(e.x,e.y,5),i.fillColor=cc.color(0,0,255,155),i.fill()}},removeBullet:function(e){e._activeContact=!1},update0:function(e){this.updateEntityStart(e)},updateEntityStart:function(){},updateEntityContact:function(){for(var e=this.contactList,t=e.length,i=0;i<t-1;i++){var a=e[i],n=a.getEntity();if(n.onBltContact||a._activeContact&&!n._ignoreEntity)for(var o=a.x,r=a.y,s=a.radius,c=i+1;c<t;c++){var l=e[c],d=l.getEntity();if(n.onBltContact){if(!n.checkBltContact(d))continue}else if(!l._activeContact||d._ignoreEntity||d.team===n.team)continue;var h=l.x,u=l.y,p=s+l.radius,f=o-h,m=r-u;if(!(c_abs(f)>p||c_abs(m)>p)&&c_norm(f,m)<p){if(n.onBltContact&&n.onBltContact(d))continue;n.getEntity().onContact(d.getEntity()),d.getEntity().onContact(n.getEntity())}}}},updateEntityEnd:function(){for(var e=this.contactList,t=e.length,i=0;i<t;i++){var a=e[i];a._needRemoveContact&&(a._needRemoveContact=!1,a._inContactList=!1,e.splice(i,1),i-=1,t-=1)}},updateBullet:function(){for(var e=this.contactList,t=e.length,i=this.bulletList,a=i.length,n=0;n<a;n++){var o=0,r=null;if((N=i[n])._activeContact){var s=N.x,c=N.y,l=N.x0,d=N.y0,h=l-s,u=d-c,p=N.radius;if(!N._ignoreGround){var f=this.findGroundLine(s);if(d<f){N.onFail(l,d,f);continue}c<f&&(h=l-(s=l-(d-f)*h/u),u=d-(c=f),o=2)}if(!N._ignoreEntity)for(var m,g=1/(h*h+u*u),v=c_abs(.5*h),y=c_abs(.5*u),b=1/0,k=0;k<t;k++){var T=e[k],_=T.getEntity();if(_.onBltContact){if(!_.checkBltContact(N))continue}else if(!_.isInBorder()||!T._activeContact||N.team===_.team)continue;if(!T._ignoreBullet||!N.bulletMark){var w=T.getPositionX(),E=T.getPositionY(),C=T.hitRadius;if(c_abs(w-s-.5*h)<v+C+p&&c_abs(E-c-.5*u)<y+C+p){var S=((w-s)*h+(E-c)*u)*g;S>1?S=1:S<0&&(S=0);var I=s+S*h-w,A=c+S*u-E;if(I*I+A*A<(C+p)*(C+p))if(N.simpleCompute){if(N.onHit(_,1-S))break}else{var B=c_sumOfSquares(w-l,E-d);B<b&&(b=B,r=_,m=1-S)}}}}if(r){if(o){var M=c_norm(l-N.x,d-N.y);m=m*c_norm(h,u)/M}N.onHit(r.getEntity(),m,s,c)}else o?N.onHitWall(s,c,o):N.timer<=0&&N.onTimeOut();if(DEBUG_MODE&&N.debugDraw){var D=N.debugDraw;o?(D.circle(s,c,5),D.fillColor=cc.color(155,0,0,155),D.fill(),D.moveTo(s,c),D.lineTo(l,d),D.lineWidth=2,D.strokeColor=cc.color(255,255,0,155),D.stroke()):(D.moveTo(s,c),D.lineTo(l,d),D.lineWidth=2,D.strokeColor=cc.color(255,255,255,155),D.stroke()),r&&(D.circle(s+h*m,c+u*m,5),D.fillColor=cc.color(255,0,0,255),D.fill())}}else i.splice(n,1),n-=1,a-=1}if(DEBUG_MAP){(D=this.bulletDraw).clear();var x=cc.color(0,255,0,100),R=cc.color(255,0,0,100);for(n=0;n<a;n++){var N=i[n];D.moveTo(N.x,N.y),D.lineTo(N.x0,N.y0),N.radius?D.lineWidth=2*N.radius:D.lineWidth=3,0==N.team?D.strokeColor=x:D.strokeColor=R,D.stroke()}(D=this.entityDraw).clear();for(var F=0;F<t;F++){var L=e[F];if(L._activeContact){var P=L.x,O=L.y;if(D.lineWidth=5,D.circle(P,O,L.radius||3),D.strokeColor=cc.color(0,55,200,200),D.stroke(),D.circle(P,O,L.hitRadius||5),0==L.team?D.strokeColor=x:D.strokeColor=R,D.stroke(),L.wheels)for(var U in L.wheels)D.lineWidth=5,D.circle(L.wheels[U].x,L.wheels[U].y,5),D.strokeColor=cc.color(255,55,200,200),D.stroke()}}}},update1:function(e){this.updateEntityContact(e),this.updateEntityEnd(e),this.updateBullet(e)},getContactList:function(){return this.contactList},checkAliveEnemy:function(e,t,i,a,n,o){var r=this.getContactList(1-n);for(var s in r){var c=r[s].getEntity();if(!c._sensor&&c._activeContact&&!c.isDead()&&c.team!=n){var l=c.hitRadius+a,d=t-c.x,h=i-c.y,u=d*d+h*h;if(u<=l*l&&o.call(e,c,u,d,h))return c}}}}),cc._RF.pop()},{"../entities/environment/Ground":"Ground"}],CoreMath:[function(e,t){"use strict";cc._RF.push(t,"c3a9bdEAZdGgJuaeQL8SPbz","CoreMath"),window.FIXED=1e5,window.c_parabola2Degree=function(e,t,i,a){var n,o=e,r=1/(2*a*a)*i*o*o,s=o*o-4*r*(r-t);if(0===r||s<0)return[];n=e>0?0:180;var c=1/(2*r);if(0===s){var l=c_atan(-o*c);return[c_radian2Degree(l)+n]}var d=c_sqrt(s),h=c_atan((-o+d)*c),u=c_atan((-o-d)*c);return[c_radian2Degree(h)+n,+c_radian2Degree(u)+n]},window.c_isValue=function(e){return e||0===e},window.c_getValue=function(e,t){return c_isValue(e)?e:t},window.c_clamp=function(e,t,i){return e<t?t:e>i?i:e},window.c_includeDegree=function(e,t){return(e-t+900)%360-180};var i=Math;window.c_floor=i.floor,window.c_abs=i.abs,window.c_sin=function(e){return c_floor(i.sin(e)*FIXED)/FIXED},window.c_cos=function(e){return c_floor(i.cos(e)*FIXED)/FIXED},window.PI=c_floor(i.PI*FIXED)/FIXED,window.c_sqrt=function(e){return c_floor(i.sqrt(e)*FIXED)/FIXED},window.c_norm=function(e,t){return c_sqrt(e*e+t*t)},window.c_sumOfSquares=function(e,t){return e*e+t*t},window.c_degree2Radian=function(e){return.017453292521*e},window.c_radian2Degree=function(e){return 57.29577951*e},window.c_degree2sin=function(e){return c_sin(.017453292521*e)},window.c_degree2cos=function(e){return c_cos(.017453292521*e)},window.c_atan=function(e){return c_floor(i.atan(e)*FIXED)/FIXED},window.c_vector2Radian=function(e,t){var i=0;return 0==e?i=t>0?.5*PI:1.5*PI:e>0?i=c_atan(t/e):e<0&&(i=c_atan(t/e)+PI),i<0&&(i+=2*PI),i},window.c_vector2Degree=function(e,t){var i=0;return 0==e?i=t>0?90:270:e>0?i=57.29577951*c_atan(t/e):e<0&&(i=57.29577951*c_atan(t/e)+180),i<0&&(i+=360),i},cc.Class({initMap:function(e,t){var i;cc.log("seed:"+t);var a=(i=t,function(){return(i=(9301*i+49297)%233280)/233280});this.c_random=a,this.c_rnd=function(e,t){return e+(t-e)*a()},this.c_rndInt=function(e,t){return e+c_floor(a()*(t-e+1))}}}),cc._RF.pop()},{}],CrashlyticsInit:[function(e,t){"use strict";cc._RF.push(t,"f1e862AOk5LMZw8scr0Dps3","CrashlyticsInit"),cc.Class({extends:cc.Component,onLoad:function(){var t=e("../../Plugins/firebase/Crashlytics");window.crashlytics=t.crashlytics,window.crashlytics&&(window.crashlytics.init(),console.log("Crashlytics initialized globally"),window.crashlytics.setCustomKey("game_version",MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION),window.crashlytics.setCustomKey("platform",cc.sys.os),window.crashlytics.setCustomKey("channel",CH),window.crashlytics.log("Game started - "+(new Date).toISOString()))}}),cc._RF.pop()},{"../../Plugins/firebase/Crashlytics":"Crashlytics"}],Crashlytics:[function(e,t,i){"use strict";cc._RF.push(t,"64227djNrVKV6+J1zNHYEvW","Crashlytics"),Object.defineProperty(i,"__esModule",{value:!0}),i.crashlytics=void 0;var a=cc._decorator,n=a.ccclass,o=(a.property,function(){function e(){}var t;return t=e,e.getInstance=function(){return this.instance||(this.instance=new t),this.instance},e.prototype.init=function(){console.log("Crashlytics: Initializing..."),cc.sys.isNative&&(cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","init","()V"):cc.sys.os===cc.sys.OS_IOS&&console.log("Crashlytics: iOS initialized via AppController"))},e.prototype.log=function(e){cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","log","(Ljava/lang/String;)V",e):cc.sys.os===cc.sys.OS_IOS&&window.Crashlytics&&window.Crashlytics.log&&window.Crashlytics.log(e):console.log("[Crashlytics Log] "+e)},e.prototype.setCustomKey=function(e,t){cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?"string"==typeof t?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","setCustomKey","(Ljava/lang/String;Ljava/lang/String;)V",e,t):"number"==typeof t?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","setCustomKeyInt","(Ljava/lang/String;I)V",e,Math.floor(t)):"boolean"==typeof t&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","setCustomKeyBool","(Ljava/lang/String;Z)V",e,t):cc.sys.os===cc.sys.OS_IOS&&window.Crashlytics&&window.Crashlytics.setCustomKey&&window.Crashlytics.setCustomKey(e,t.toString()):console.log("[Crashlytics CustomKey] "+e+": "+t)},e.prototype.setUserId=function(e){cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","setUserId","(Ljava/lang/String;)V",e):cc.sys.os===cc.sys.OS_IOS&&window.Crashlytics&&window.Crashlytics.setUserId&&window.Crashlytics.setUserId(e):console.log("[Crashlytics UserId] "+e)},e.prototype.recordException=function(e){cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","recordException","(Ljava/lang/String;)V",e):cc.sys.os===cc.sys.OS_IOS&&window.Crashlytics&&window.Crashlytics.recordException&&window.Crashlytics.recordException(e):console.error("[Crashlytics Exception] "+e)},e.prototype.setCrashlyticsCollectionEnabled=function(e){cc.sys.isNative?cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","setCrashlyticsCollectionEnabled","(Z)V",e):cc.sys.os===cc.sys.OS_IOS&&console.log("Crashlytics: Collection enabled state is managed via Info.plist on iOS"):console.log("[Crashlytics Collection] "+(e?"Enabled":"Disabled"))},e.prototype.testCrash=function(){if(this.log("Test crash initiated"),!cc.sys.isNative)throw new Error("Crashlytics test crash");if(cc.sys.os===cc.sys.OS_ANDROID)jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/Crashlytics","testCrash","()V");else if(cc.sys.os===cc.sys.OS_IOS)throw new Error("Crashlytics test crash")},e.instance=null,t=__decorate([n],e)}());i.default=o,i.crashlytics=o.getInstance(),cc._RF.pop()},{}],DEBUGADS:[function(e,t){"use strict";cc._RF.push(t,"b4531szZxNPNI/20tHvVh8E","DEBUGADS"),cc.Class({extends:cc.Component,properties:{autoActivate:{default:!0},showDebugUI:{default:!0},delaySeconds:{default:3}},onLoad:function(){var t=this;cc.log("==========================================="),cc.log("TEST MODE ACTIVATOR LOADED"),cc.log("Test mode will activate in "+this.delaySeconds+" seconds"),cc.log("==========================================="),this.MAXDebug=e("MAXDebug"),this.autoActivate&&this.scheduleOnce(function(){t.activateTestMode()},this.delaySeconds),this.showDebugUI&&this.createQuickTestUI(),window.testMode={activate:function(){return t.activateTestMode()},deactivate:function(){return t.deactivateTestMode()},showDebugger:function(){return t.MAXDebug.showMediationDebugger()},testRewarded:function(){return t.MAXDebug.testRewardedAd()},testInterstitial:function(){return t.MAXDebug.testInterstitialAd()}},cc.log("Quick commands available in console:"),cc.log("  testMode.activate() - Activate test mode"),cc.log("  testMode.deactivate() - Deactivate test mode"),cc.log("  testMode.showDebugger() - Show MAX debugger"),cc.log("  testMode.testRewarded() - Test rewarded ad"),cc.log("  testMode.testInterstitial() - Test interstitial ad")},activateTestMode:function(){var e=this;cc.log("==========================================="),cc.log("ACTIVATING MAX TEST MODE NOW!"),cc.log("==========================================="),this.MAXDebug.enableTestMode(),this.showNotification("TEST MODE ACTIVATED\nTest ads will be shown",cc.Color.GREEN),this.scheduleOnce(function(){e.MAXDebug.logStatus()},1)},deactivateTestMode:function(){cc.log("Deactivating test mode..."),this.MAXDebug.disableTestMode(),this.showNotification("Test Mode Disabled",cc.Color.RED)},createQuickTestUI:function(){var e=this,t=new cc.Node("TestModeButton");t.width=150,t.height=50,t.x=cc.winSize.width-85,t.y=cc.winSize.height-30;var i=t.addComponent(cc.Graphics);i.fillColor=new cc.Color(255,0,0,200),i.fillRect(-75,-25,150,50);var a=new cc.Node("Label"),n=a.addComponent(cc.Label);n.string="TEST MODE",n.fontSize=16,n.lineHeight=20,a.color=cc.Color.WHITE,a.parent=t,t.on("touchend",function(){e.onTestButtonClick()},this),t.parent=cc.director.getScene(),t.zIndex=9999,this.testButton=t,this.updateButtonColor(),cc.game.addPersistRootNode(t),cc.log("Test mode button created at top-right corner")},onTestButtonClick:function(){var e=this,t=new cc.Node("TestMenu");t.width=300,t.height=350;var i=t.addComponent(cc.Graphics);i.fillColor=new cc.Color(0,0,0,220),i.fillRect(-150,-175,300,350);var a=new cc.Node("Title"),n=a.addComponent(cc.Label);n.string="MAX TEST CONTROLS",n.fontSize=18,a.y=150,a.parent=t,[{text:"Activate Test Mode",y:100,action:function(){return e.activateTestMode()}},{text:"Show Debugger",y:50,action:function(){return e.MAXDebug.showMediationDebugger()}},{text:"Test Rewarded Ad",y:0,action:function(){return e.MAXDebug.testRewardedAd()}},{text:"Test Interstitial",y:-50,action:function(){return e.MAXDebug.testInterstitialAd()}},{text:"Check Status",y:-100,action:function(){return e.MAXDebug.logStatus()}},{text:"Close",y:-150,action:function(){return t.destroy()}}].forEach(function(i){var a=new cc.Node("Button");a.y=i.y;var n=a.addComponent(cc.Label);n.string=i.text,n.fontSize=14,n.node.color=cc.Color.WHITE,a.on("touchend",function(){i.action(),"Close"!==i.text&&t.destroy()},e),a.parent=t}),t.x=cc.winSize.width/2,t.y=cc.winSize.height/2,t.parent=cc.director.getScene(),t.zIndex=1e4},updateButtonColor:function(){if(this.testButton){var e=this.testButton.getComponent(cc.Graphics);this.MAXDebug.isEnabled?e.fillColor=new cc.Color(0,255,0,200):e.fillColor=new cc.Color(255,0,0,200),e.clear(),e.fillRect(-75,-25,150,50)}},showNotification:function(e,t){var i=new cc.Node("Notification"),a=i.addComponent(cc.Graphics);a.fillColor=new cc.Color(0,0,0,200),a.fillRect(-150,-30,300,60);var n=i.addComponent(cc.Label);n.string=e,n.fontSize=18,n.lineHeight=24,i.color=t||cc.Color.WHITE,i.x=cc.winSize.width/2,i.y=cc.winSize.height/2,i.parent=cc.director.getScene(),i.zIndex=10001,i.opacity=0,i.runAction(cc.sequence(cc.fadeIn(.3),cc.delayTime(3),cc.fadeOut(.5),cc.removeSelf()))},onDestroy:function(){cc.log("Test Mode Activator destroyed"),this.testButton&&(cc.game.removePersistRootNode(this.testButton),this.testButton.destroy())}}),cc._RF.pop()},{MAXDebug:"MAXDebug"}],DEFINE_GO_TO:[function(e,t){"use strict";cc._RF.push(t,"b40d6vUCnhHTq0x7Pd9bnr8","DEFINE_GO_TO"),window.DEFINE_GO_TO={GO_TO_BACKPACK:{go_to_id:"GO_TO_BACKPACK",name:"Pilot/Equipment",description:"Opens the equipment upgrade screen in main menu (pilot tab)",navigate:function(){window.menuManager?menuManager.run("main",{hot:"equipment"}):console.error("[DEFINE_GO_TO] menuManager not available")}},GO_TO_MAP:{go_to_id:"GO_TO_MAP",name:"Adventure Map",description:"Opens the adventure/map screen for chapters and combat",showSuggestion:!0,navigate:function(){window.menuManager?(window._taskNavSkipPopup=!0,window._taskNavIsMapNav=!0,menuManager.run("main",{hot:"map"})):console.error("[DEFINE_GO_TO] menuManager not available")}},GO_TO_BATTLE:{go_to_id:"GO_TO_BATTLE",name:"Battle",description:"Opens the battle screen at the current chapter/stage",showSuggestion:!0,navigate:function(){if(window.menuManager&&window.pc){for(var e=null,t=0;t<window.CHAPTER_DEFINE_ARRAY.length;t++)if(!window.pc.isChapterDone(t)){e=t+1;break}e||(e=window.CHAPTER_DEFINE_ARRAY.length);var i=e-1;return window._taskNavPrepareChapterIndex=i,window._taskNavSkipPopup=!0,window._taskNavSkipLock=!1,window._taskNavSuppressChapterPopup=!0,window._taskNavIsBattleNav=!0,menuManager.run("main",{hot:"map"}),!0}return!1}},GO_TO_SWEEP:{go_to_id:"GO_TO_SWEEP",name:"Sweep",description:"Opens the map at the previous completed chapter for sweeping",showSuggestion:!0,navigate:function(){if(window.menuManager&&window.pc){for(var e=0,t=window.CHAPTER_DEFINE_ARRAY.length-1;t>=0;t--)if(window.pc.isChapterDone(t)){e=t;break}return window._taskNavPrepareChapterIndex=e,window._taskNavSkipPopup=!0,window._taskNavSkipLock=!0,window._taskNavSuppressChapterPopup=!0,window._taskNavIsSweepNav=!0,menuManager.run("main",{hot:"map"}),!0}return console.error("[GO_TO_SWEEP] menuManager or pc not available"),!1}},GO_TO_GARAGE:{go_to_id:"GO_TO_GARAGE",name:"Garage",description:"Opens the garage to upgrade and star up tanks",unlockChapter:3,showSuggestion:!0,navigate:function(e){return window.pc&&!window.pc.isChapterDone(this.unlockChapter)?("undefined"!=typeof kit&&"undefined"!=typeof LI&&kit.info(LI("chapter_unlock_4")),console.warn("[DEFINE_GO_TO] Garage locked - Complete Chapter 4 required"),!1):window.menuManager?(e&&(window._taskNavGarageType=e),menuManager.run("main",{hot:"garage"}),!0):(console.error("[DEFINE_GO_TO] menuManager not available"),!1)}},GO_TO_SHOP:{go_to_id:"GO_TO_SHOP",name:"Shop",description:"Opens the shop for purchases, free items, and chests",showSuggestion:!0,navigate:function(e){return window.menuManager?(e&&(window._taskNavShopType=e),menuManager.run("main",{hot:"shop"}),!0):(console.error("[DEFINE_GO_TO] menuManager not available"),!1)}},GO_TO_MINIGAME:{go_to_id:"GO_TO_MINIGAME",name:"Minigame",description:"Opens the minigame selection screen",showSuggestion:!0,navigate:function(){window.menuManager&&(window._taskNavSkipPopup=!0,window._taskNavIsMinigameNav=!0,menuManager.run("main",{hot:"map"}))}},GO_TO_MAIN:{go_to_id:"GO_TO_MAIN",name:"Main Screen",description:"Returns to main screen/home",navigate:function(){window.menuManager?menuManager.run("main"):console.error("[DEFINE_GO_TO] menuManager not available")}},GO_TO_IDLE_REWARD:{go_to_id:"GO_TO_IDLE_REWARD",name:"Idle Reward",description:"Navigate to main screen and show idle reward suggestion",showSuggestion:!0,navigate:function(){window.menuManager&&(window._taskNavSkipPopup=!0,window._taskNavIsIdleNav=!0,menuManager.run("main",{hot:"map"}))}},GO_TO_CREW:{go_to_id:"GO_TO_CREW",name:"pilot",description:"Opens the talent upgrade screen",unlockChapter:4,navigate:function(){return window.pc&&!window.pc.isChapterDone(this.unlockChapter)?("undefined"!=typeof kit&&"undefined"!=typeof LI&&kit.info(LI("chapter_unlock_5")),console.warn("[DEFINE_GO_TO] Crew/Pilot locked - Complete Chapter 5 required"),!1):window.menuManager?(menuManager.run("main",{hot:"pilot"}),!0):(console.error("[DEFINE_GO_TO] menuManager not available"),!1)}},GO_TO_TRAIN:{go_to_id:"GO_TO_TRAIN",name:"Train Mode",description:"Opens the infinite train challenge mode",navigate:function(){window.menuManager?menuManager.run("train"):console.error("[DEFINE_GO_TO] menuManager not available")}}},window.DEFINE_GO_TO.get=function(e){return this[e]||null},window.DEFINE_GO_TO.navigateTo=function(e){var t=this.get(e);return t?(t.navigate(),!0):(console.error("[DEFINE_GO_TO] Navigation not found:",e),!1)},window.DEFINE_GO_TO.getAllIds=function(){var e=[];for(var t in this)t.startsWith("GO_TO_")&&this.hasOwnProperty(t)&&e.push(t);return e},window.DEFINE_GO_TO.validate=function(){var e=this.getAllIds(),t=[];return e.forEach(function(e){var i=this.get(e);i&&i.navigate||t.push(e)}.bind(this)),{valid:0===t.length,missing:t,total:e.length,defined:e.length-t.length}},cc._RF.pop()},{}],DailyTaskMenu:[function(e,t){"use strict";cc._RF.push(t,"da327BY5oxIoalpB6Govitz","DailyTaskMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{layoutNode:cc.Node,itemNode:cc.Node,itemPrefab:cc.Prefab,allItemNode:cc.Node,allProgress:cc.Sprite,allDone:cc.Node,allLabel:cc.Label,allBtnNode:cc.Node},onLoad:function(){},start:function(){},initStatus:function(){this.itemList=[],this.itemNode.active=!1,this.initUI()},initUI:function(){this.refreshUI()},refreshUI:function(){var e=task.getDailTaskList();for(var t in e){var i=e[t],a=this.itemList[t];a||(a=cc.instantiate(this.itemNode),this.layoutNode.addChild(a),a.zIndex=t,a.active=!0,this.itemList.push(a)),this.refreshTaskBoard(a,i,+t)}this.refreshSumBoard(),this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.delayTime(task.getDailyTaskRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.post("updateDailyTask",{},function(t,i){cc.log("updateDailyTask",i),task.loadDailyTaskData(i),e.refreshUI()})},this)))},refreshSumBoard:function(){var e=this,t=task.getDailyTaskSum(),a=t.sum,n=t.max;this.allProgress.fillRange=a/n;var o=a>=n,r=task.getDailyTaskStatus("sum");this.allDone.active=o&&!r;var s={i:DIAMOND,n:100};this.allLabel.string=r?"\u4eca\u65e5\u4efb\u52a1\u5df2\u5168\u90e8\u5b8c\u6210":"\u5b8c\u6210 "+a+" / "+n+" \u4e2a\u6bcf\u65e5\u4efb\u52a1\u53ef\u83b7\u5f97";var c=this.allItemNode.itemNode;c||(c=cc.instantiate(this.itemPrefab),this.allItemNode.addChild(c),c.getComponent("Item").init(s),c.getComponent("Item").setTouchEnabled(!1),this.allItemNode.itemNode=c),c.getComponent("Item").setGray(r),this.allBtnNode.onTouch=function(){var t;if(o)if(r)kit.info("\u9886\u8fc7\u4e86");else{var a=[s],n=[s];net.updateData({items:a,set:(t={},t["dailyTaskStatus.sum"]=1,t)},function(t,o){i.FirebaseTracking.setDataBiRes("DailyTask_RefeshSumboard"),money.update(o),task.setDailyTaskStatus("sum",1),e.refreshSumBoard(),menuManager.pop("loot",{items:a,tid:"daily_task",tname:"\u6bcf\u65e5\u4efb\u52a1",videoItems:n,lootCb:function(){}})})}else kit.info("\u8fd8\u6ca1\u6709\u5b8c\u6210\u5168\u90e8\u6bcf\u65e5\u4efb\u52a1")}},refreshTaskBoard:function(e,t,a){var n=this,o=t.item;e.getChildByName("name").getComponent(cc.Label).string=t.name,e.getChildByName("info").getComponent(cc.Label).string=t.info.replace(/\{.+?\}/g,function(){return" "+t.getNum()+" / "+t.num+" "});var r=t.getNum()>=t.num,s=task.getDailyTaskStatus(a),c=e.itemNode;c||(c=cc.instantiate(this.itemPrefab),e.getChildByName("item").addChild(c),c.getComponent("Item").init(o),e.itemNode=c),c.getComponent("Item").setGray(s),e.getChildByName("go").active=!r&&!s,e.getChildByName("finish").active=!s&&r,e.getChildByName("loot").active=s,e.onTouch=function(){var c;if(r)if(s)kit.info("\u9886\u8fc7\u4e86");else{var l=[o];net.updateData({items:l,set:(c={},c["dailyTaskStatus."+a]=1,c)},function(o,r){i.FirebaseTracking.setDataBiRes("DailyTask_Refresh"),money.update(r),task.setDailyTaskStatus(a,1),n.refreshTaskBoard(e,t,a),n.refreshSumBoard(),menuManager.pop("show",{tid:"daily_task",items:l,checkCb:function(){}})})}else t.goTo()}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],DateTime:[function(e,t,i){"use strict";var a;cc._RF.push(t,"f59b4P13GxB86LwDewFebl6","DateTime"),Object.defineProperty(i,"__esModule",{value:!0}),i.DateTime=i.Month=i.DateTimeKind=i.DayOfWeek=void 0,function(e){e[e.Sunday=0]="Sunday",e[e.Monday=1]="Monday",e[e.Tuesday=2]="Tuesday",e[e.Wednesday=3]="Wednesday",e[e.Thursday=4]="Thursday",e[e.Friday=5]="Friday",e[e.Saturday=6]="Saturday"}(i.DayOfWeek||(i.DayOfWeek={})),function(e){e[e.Local=0]="Local",e[e.Utc=1]="Utc"}(a=i.DateTimeKind||(i.DateTimeKind={})),function(e){e[e.January=0]="January",e[e.February=1]="February",e[e.March=2]="March",e[e.April=3]="April",e[e.May=4]="May",e[e.June=5]="June",e[e.July=6]="July",e[e.August=7]="August",e[e.September=8]="September",e[e.October=9]="October",e[e.November=10]="November",e[e.December=11]="December"}(i.Month||(i.Month={}));var n=function(){function e(){for(var e,t,i,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(this._date=new Date,this._kind=a.Local,0!=n.length){if(1==n.length){if("number"==typeof n[0])return void this._date.setTime(n[0]);if("string"==typeof n[0]||n[0]instanceof Date)return void(this._date=new Date(n[0]));if(this.isDateTimeInstance(n[0]))return void this.copy(n[0])}this._date=new Date(n[0],n[1]-1,n[2],null!==(e=n[3])&&void 0!==e?e:0,null!==(t=n[4])&&void 0!==t?t:0,null!==(i=n[5])&&void 0!==i?i:0)}}return Object.defineProperty(e.prototype,"kind",{get:function(){return this._kind},set:function(e){this._kind=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"now",{get:function(){return new e(Date.now())},enumerable:!1,configurable:!0}),e.isLeapYear=function(e){return e%400==0||e%100!=0&&e%4==0},e.fromUtcSeconds=function(t){return new e(1e3*t)},e.getDaysInMonth=function(t,i){if(Number.isInteger(t)&&Number.isInteger(i))return Date.getDaysInMonth(t,i);if(t instanceof e){var n=t,o=i;return null!=o||(o=a.Local),Date.getDaysInMonth(n._date,o==a.Local)}return-1},e.prototype.clone=function(){return new e(this)},e.prototype.copy=function(e){this.isDateTimeInstance(e)?this.setTimestamp(e.getTimestamp()):this.setTimestamp(e.getTime())},e.prototype.compare=function(e){return this.isDateTimeInstance(e)?this.getTimestamp()>e.getTimestamp()?1:this.getTimestamp()<e.getTimestamp()?-1:0:this.getTimestamp()>e.getTime()?1:this.getTimestamp()<e.getTime()?-1:0},e.prototype.isSameDay=function(e){return this.isDateTimeInstance(e)?e.getDayOfYear(a.Local)==this.getDayOfYear(a.Local)&&e.getYear(a.Local)==this.getYear(a.Local):this._date.isSameDay(e)},e.prototype.isDateTimeInstance=function(t){return t instanceof e},e.prototype.isDateInstance=function(e){return e instanceof Date},e.prototype.resolveKind=function(e){return e||this._kind},e.prototype.setYear=function(e,t){return(t=this.resolveKind(t))==a.Local?this._date.setFullYear(e):this._date.setUTCFullYear(e),this},e.prototype.setMonth=function(e,t){return(t=this.resolveKind(t))==a.Local?this._date.setMonth(e):this._date.setUTCMonth(e),this},e.prototype.setDay=function(e,t){return(t=this.resolveKind(t))==a.Local?this._date.setDate(e):this._date.setUTCDate(e),this},e.prototype.setHour=function(e,t,i,n){return this.kind==a.Local?this._date.setHours(e,t,i,n):this._date.setUTCHours(e,t,i,n),this},e.prototype.setTimestamp=function(e){return this._date.setTime(e),this},e.prototype.addYears=function(e){return this._date.setFullYear(this._date.getFullYear()+e),this},e.prototype.addMonths=function(e){var t=this._date.getDate();this._date.setDate(1),this._date.setMonth(this._date.getMonth()+e);var i=Math.min(t,this._date.getDaysInMonth());return this._date.setDate(i),this},e.prototype.addDays=function(e){return this._date.setDate(this._date.getDate()+e),this},e.prototype.addMilliseconds=function(e){return this._date.setMilliseconds(this._date.getMilliseconds()+e),this},e.prototype.getYear=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getFullYear():this._date.getUTCFullYear()},e.prototype.getMonthIndex=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getMonth():this._date.getUTCMonth()},e.prototype.getMonth=function(e){return e=this.resolveKind(e),this.getMonthIndex(e)+1},e.prototype.getDayOfWeek=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getDay():this._date.getUTCDay()},e.prototype.getDay=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getDate():this._date.getUTCDate()},e.prototype.getDaysInMonth=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getDaysInMonth():this._date.getDaysInMonthUTC()},e.prototype.getDayOfYear=function(t){t=this.resolveKind(t);var i=this.getMonthIndex(t),a=this.getDay(t),n=e.isLeapYear(this.getYear(t)),o=[0,31,59,90,120,151,181,212,243,273,304,334,365][i]+a;return i>1&&n&&o++,o},e.prototype.getTimestamp=function(){return this._date.getTime()},e.prototype.getHour=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getHours():this._date.getUTCHours()},e.prototype.getMinute=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getMinutes():this._date.getUTCMinutes()},e.prototype.getSecond=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getSeconds():this._date.getUTCSeconds()},e.prototype.getMillisecond=function(e){return(e=this.resolveKind(e))==a.Local?this._date.getMilliseconds():this._date.getUTCMilliseconds()},e.prototype.getTimezoneOffset=function(){return this._date.getTimezoneOffset()},e.prototype.toString=function(){return this._date.toString()},e.prototype.toDateString=function(){return this._date.toDateString()},e.prototype.toTimeString=function(){return this._date.toTimeString()},e.prototype.toLocaleString=function(e,t){return this._date.toLocaleString(e,t)},e.prototype.toLocaleDateString=function(e,t){return this._date.toLocaleDateString(e,t)},e.prototype.toLocaleTimeString=function(e,t){return this._date.toLocaleTimeString(e,t)},e.prototype.toUTCString=function(){return this._date.toUTCString()},e.prototype.toISOString=function(){return this._date.toISOString()},e.prototype.toJSON=function(e){return this._date.toJSON(e)},e.MaxDayOfMonth=31,e.MinDayOfMonth=28,e}();i.DateTime=n,cc._RF.pop()},{}],DeadlyHitBuff:[function(e,t){"use strict";cc._RF.push(t,"d6032uPwV5B2J9xAjVlKWGr","DeadlyHitBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.obj;this.game.eventMgr.regist(e,"hitEvent",this,this.hitEvent)},hitEvent:function(e,t,i,a){var n=this.define;t.armorType==ARMOR_TYPE.human&&t.team!=this.obj.team&&!t.isDead()&&this.game.c_rnd(0,1)<n.chance&&t.callDeath(this,i,a)},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"hitEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],Dialog:[function(e,t){"use strict";cc._RF.push(t,"60b08N1P5hFe7ItKiuee9kn","Dialog"),cc.Class({extends:cc.Component,properties:{audios:{type:[cc.AudioClip],default:[]},humanNode:cc.Node,label:cc.Label,layout:cc.Layout,infoNode:cc.Node,arrowNode:cc.Node},onLoad:function(){},onDestroy:function(){void 0!==this.sound&&cc.audioEngine.stop(this.sound)},init:function(e){this.args=e;var t=e.x||(e.index%2?-400:400),i=t<0;if(this.humanNode){var a=this.humanNode.getComponent("HumanModel");a.init(ENTITY[HUMAN],{effectMgr:e.effectMgr,face:e.face}),e.anime&&a.runAnime(e.anime),this.humanNode.scaleX=i?-1:1}var n,o=.2*(e.t||3);this.node.opacity=0,n=i?-200:200,this.dx=n,this.node.x=t+n;var r=e.str;r?(this.arrowNode.scaleX=i?-1:1,this.infoNode.anchorX=i?0:1,this.infoNode.x=(i?-1:1)*this.infoNode.x):this.infoNode.active=!1,this.setString(""),this.node.runAction(cc.sequence(cc.spawn(cc.fadeIn(.1),cc.moveBy(.1,-n,0)).easing(cc.easeOut(2)),cc.callFunc(function(){this.sound=menuManager.playEffect(this.audios[e.index%3],1),this.speak(r,o)},this)))},remove:function(){var e=this.dx;this.node.runAction(cc.sequence(cc.spawn(cc.fadeOut(.1),cc.moveBy(.1,.5*e,0)).easing(cc.easeIn(2)),cc.destroySelf()))},speak:function(e,t){if(e){var i=e.length,a=0;this.setString(""),this.node.runAction(cc.sequence(cc.delayTime(t/i),cc.callFunc(function(){a++,this.setString(e.substr(0,a)),a>=i&&void 0!==this.sound&&(cc.audioEngine.stop(this.sound),delete this.sound)},this)).repeat(i))}},setString:function(e){this.label.string=e,this.label._forceUpdateRenderData(!0),this.layout.updateLayout()},start:function(){}}),cc._RF.pop()},{}],DiamondMenu:[function(e,t){"use strict";cc._RF.push(t,"7e32f//Op5HPoqx7TAngs5P","DiamondMenu"),cc.Class({extends:e("./CheckMenu"),properties:{itemNode:cc.Node,itemPrefab:cc.Prefab,label:cc.Label,priceLabel:cc.Label},initStatus:function(e){e.title&&(this.titleLabel.string=e.title);var t=e.items;if(t){var i=this.item=t[0],a=cc.instantiate(this.itemPrefab);this.itemNode.addChild(a),a.getComponent("Item").init(i,this.label)}this.priceLabel.string=e.price},waitOnClose:function(){}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],DifficultyAffixDefine:[function(e,t){"use strict";cc._RF.push(t,"f777fq7IKJN2IGB4o3TSxFG","DifficultyAffixDefine"),e("../components/combat/buffs/Buff"),e("../data/constants/GameConstants"),e("../components/visual/ArmatureAvatar"),e("../entities/projectiles/PowerBullet"),e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),e("./TalentDefine"),window.loadDifficultyAffixDefine=function(){window.DifficultyAffixDefine={hp30:{title:"\u751f\u547d\u52a0\u6210",rarity:1,template:{id:"attribute",attr:"hpMax",num:.3},des:"\u654c\u4eba\u751f\u547d\u503c+30%",content:"ui/talent/affix/\u8840\u91cfUP"},hp20:{title:"\u751f\u547d\u52a0\u6210",rarity:1,template:{id:"attribute",attr:"hpMax",num:.2},des:LI("loop_tip3"),content:"ui/talent/affix/\u8840\u91cfUP"},hp10:{title:"\u751f\u547d\u52a0\u6210",rarity:1,template:{id:"attribute",attr:"hpMax",num:.1},des:"\u654c\u4eba\u751f\u547d\u503c+10%",content:"ui/talent/affix/\u8840\u91cfUP"},atk30:{title:"\u653b\u51fb\u52a0\u6210",template:{id:"attribute",attr:"atkScale",num:.3},rarity:1,des:"\u654c\u4eba\u653b\u51fb\u529b+30%",content:"ui/talent/affix/\u653b\u51fbUP"},atk20:{title:"\u653b\u51fb\u52a0\u6210",template:{id:"attribute",attr:"atkScale",num:.2},rarity:1,des:LI("loop_tip2"),content:"ui/talent/affix/\u653b\u51fbUP"},atk10:{title:"\u653b\u51fb\u52a0\u6210",template:{id:"attribute",attr:"atkScale",num:.1},rarity:1,des:"\u654c\u4eba\u653b\u51fb\u529b+10%",content:"ui/talent/affix/\u653b\u51fbUP"}},window.DifficultyAffixInit=function(){var e=function(){var e=DifficultyAffixDefine[t],i=void 0,a=void 0,n=void 0,o=void 0;e.template&&(i=TalentTemplateDefine[e.template.id])&&(i.effect&&(e.effect=i.effect),i.unitSpawnEffect&&(e.unitSpawnEffect=i.unitSpawnEffect)),e.template2&&(a=TalentTemplateDefine[e.template2.id],e.template3&&(n=TalentTemplateDefine[e.template3.id]),e.template4&&(o=TalentTemplateDefine[e.template4.id]),a&&(e.effect=function(e,t){i&&i.effect&&i.effect.bind(this)(e,t),a&&a.effect&&a.effect.bind(this)(e,t,this.template2),n&&n.effect&&n.effect.bind(this)(e,t,this.template3),o&&o.effect&&o.effect.bind(this)(e,t,this.template4)},e.unitSpawnEffect=function(e,t){i&&i.unitSpawnEffect&&i.unitSpawnEffect.bind(this)(e,t),a&&a.unitSpawnEffect&&a.unitSpawnEffect.bind(this)(e,t,this.template2),n&&n.unitSpawnEffect&&n.unitSpawnEffect.bind(this)(e,t,this.template3),o&&o.unitSpawnEffect&&o.unitSpawnEffect.bind(this)(e,t,this.template4)}))};for(var t in DifficultyAffixDefine)e()},DifficultyAffixInit()},cc._RF.pop()},{"../components/combat/buffs/Buff":"Buff","../components/visual/ArmatureAvatar":"ArmatureAvatar","../data/constants/GameConstants":"GameConstants","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/PowerBullet":"PowerBullet","./TalentDefine":"TalentDefine"}],DodgeBuff:[function(e,t){"use strict";cc._RF.push(t,"0bf35XM4rhDuoa0NsWGHTbE","DodgeBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.time=this.config.dt||e.dt||20,this.timer=this.time,this.ready=!0;var t=this.obj;this.game.eventMgr.regist(t,"preHurtEvent",this,this.preHurtEvent)},preHurtEvent:function(e,t,i){return this.ready?(this.ready=!1,this.game.callEffect(EFFECT.dodgeNum,t,e),0):i},update:function(e){this.ready||(this.timer-=e,this.timer<=0&&(this.timer=this.time,this.ready=!0))},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"preHurtEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],DoubleShotBuff:[function(e,t){"use strict";cc._RF.push(t,"e32c5aqy1NIlqeT3y3UNrsj","DoubleShotBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){if(this.deg=this.define.deg||0,this.x=0,this.y=0,this.define.shotOffset){var e=0,t=this.obj.buffTable;for(var i in t)t[i].shotOffset&&e++;this.shotOffset=this.define.shotOffset,this.deg=this.shotOffset*e,this.y=this.shotOffset*e}var a=this.obj;this.attackSequence=[];var n=a.define.attackSequence;for(var o in n){var r=n[o],s={x:this.x+.5*r.x,y:this.y+r.y+30,deg:this.deg+(r.deg||0)+5,blt:r.blt,ds:this.define.dmgScale,t:r.t,ani:r.ani,effect:r.effect};this.attackSequence.push(s),s.blt&&(this.dx=s.x,this.dy=s.y)}this.attackIndex=0,this.attackTimer=0},end:function(){},update:function(e){var t=this.obj;if(!t.reloadAction&&t.attackAction&&!t.getFlag(NO_ATTACK)){this.attackTimer-=e;var i=this.attackSequence[this.attackIndex];this.attackTimer<=0&&(i.blt&&(this.shot(i),this.effect&&this.effect.shot(i.t)),this.attackTimer=i.t,this.attackIndex++,this.attackIndex>=this.attackSequence.length&&(this.attackIndex=0))}},shot:function(e){this.obj.shot(e)}}),cc._RF.pop()},{"./Buff":"Buff"}],DraftMenu:[function(e,t){"use strict";cc._RF.push(t,"9ce4dx9cd9ESqDD+WgQK/91","DraftMenu"),DIAMOND,cc.Class({extends:e("../ui/core/PopMenu"),properties:{whatFrame:cc.SpriteFrame,infoLabel:cc.Label,itemNode:cc.Node,itemLayoutNode:cc.Node,shadowNode:cc.Node,shadowLayoutNode:cc.Node,curtainNode:cc.Node,priceLabel:cc.Label,draftBtnNode:cc.Node,closeBtnNode:cc.Node,heroPrefab:cc.Prefab,bgNode:cc.Node},itemList:void 0,shadowNodes:void 0,waitOnClose:function(){},initStatus:function(){this.infoLabel.string="",this.shadowNode.active=!1,this.itemNode.active=!1,this.curtainNode.scale=1,this.priceLabel.string=1},onPlace:function(){this._super()},onDraft:function(e,t){if(this.clickFunc=e,this.finishFunc=t,this.draftBtnNode.active=!1,this.draftBtnNode.y=80,this.started){for(var i in this.shadowNodes)this.shadowNodes[i].destroy();for(var a in this.itemNodes)this.itemNodes[a].runAction(cc.sequence(cc.delayTime(1),cc.destroySelf()));this.curtainNode.runAction(cc.sequence(cc.scaleTo(1,1,1).easing(cc.easeInOut(5)),cc.callFunc(this.onStartDraft,this)))}else this.started=!0,this.onStartDraft();1==user.getGuide("hero")&&menuManager.focusOn(this.bgNode,LI("zc_guide_20"),function(){},null,null,{dx:-120,dy:-150,noFinger:1})},onStartDraft:function(){var e=this;this.selected=!1;var t={draftList:[HERO,HERO,HERO]};this.infoLabel.string=LI("hero_select_tip"),this.infoLabel.node.opacity=0,this.infoLabel.node.runAction(cc.sequence(cc.delayTime(2),cc.fadeIn(.3)));var i=this.typeList=t.draftList;this.shadowNodes=[];for(var a=function(t){var a=cc.instantiate(e.shadowNode);e.shadowLayoutNode.addChild(a),a.active=!0,a.onTouch=function(){e.onSelectDraft(t)},i[t];var n=cc.find("mask/light0",a);n.opacity=0,n.runAction(cc.sequence(cc.delayTime(.1*t),cc.fadeIn(.2),cc.fadeOut(.2),cc.delayTime(.5),cc.fadeIn(.2),cc.fadeOut(.2),cc.callFunc(function(){n.runAction(cc.sequence(cc.scaleTo(.5,.9),cc.scaleTo(.5,1)).easing(cc.easeInOut(1)).repeatForever())},e),cc.delayTime(.5-.1*t),cc.fadeIn(.2),cc.fadeOut(.1),cc.fadeIn(.2),cc.fadeOut(.1),cc.fadeIn(.1))),e.shadowNodes[t]=a},n=0;n<i.length;n++)a(n)},onSelectDraft:function(e){var t=this;this.selected||(this.selected=!0,this.itemList=[],pc.draftIndex,this.clickFunc(function(i){t.showDraft(e,i)}))},showDraft:function(e,t){var i=this;this.infoLabel.string="",this.infoLabel.node.stopAllActions();for(var a=0;a<this.shadowNodes.length;a++){var n=this.shadowNodes[a].find("mask/light0");n.stopAllActions(),a===e?n.runAction(cc.sequence(cc.fadeIn(.2),cc.delayTime(.7),cc.fadeOut(.5))):n.runAction(cc.fadeOut(.2))}this.itemNodes=[],this.itemList=[];var o=excel.read("hero_list"),r=[];for(var s in o)o[s].id!=t&&r.push(o[s].id);for(s=0;s<3;s++)if(s==e)this.itemList.push({i:HERO,id:t,n:1});else{var c=r.splice(kit.rndInt(0,r.length-1),1);this.itemList.push({i:HERO,id:c,n:1})}for(var l=function(t){var a=cc.instantiate(i.itemNode);i.itemLayoutNode.addChild(a),a.active=!0;var n=i.itemList[t],o=a.find("open/item");o.getComponent("Item").init(n),i.itemNodes.push(a),e===t?n.i===DIAMOND?o.runAction(cc.sequence(cc.delayTime(1.8),cc.callFunc(function(){cc.game.emit("add_money",{i:n.i,n:n.n,tid:"draft",pos:o.convertToWorldSpaceAR(cc.Vec2.ZERO)}),o.active=!1},i))):o.runAction(cc.sequence(cc.delayTime(1.8),cc.jumpBy(1,0,0,30,5))):(a.find("light").active=!1,a.y+=35)},d=0;d<this.itemList.length;d++)l(d);this.curtainNode.stopAllActions(),this.curtainNode.runAction(cc.scaleTo(3,1,.1).easing(cc.easeInOut(5))),this.node.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){i.finishDraft(t)},this))),this.guideShowCb&&(this.guideShowCb(),delete this.guideShowCb)},finishDraft:function(e){if(this.finishFunc&&this.finishFunc(e),2==user.getGuide("hero")){var t=cc.Canvas.instance.node;t.focusNode&&t.focusNode.remove()}},reset:function(){this.draftBtnNode.active=!0,this.draftBtnNode.find("layout/icon").active=0!==pc.draftIndex,0!==pc.draftIndex?this.draftBtnNode.findLabel("layout/label").string=1:this.draftBtnNode.findLabel("layout/label").string=LI("free"),this.guideResetCb&&(this.guideResetCb(),delete this.guideResetCb)},popHelp:function(){menuManager.pop("help",{info:"\u6982\u7387\u4e00\u89c8:\n        \u666e\u901a\u7403\u5458   35%\n        \u4f18\u79c0\u7403\u5458   10%\n        \u7cbe\u826f\u7403\u5458   25%\n        \u53f2\u8bd7\u7403\u5458   25%\n        \u4f20\u8bf4\u7403\u5458     5%\n        \n(\u7403\u5458\u5e2d\u4f4d\u4e0d\u8db3\u65f6, \u666e\u901a\u7403\u5458\u4f1a\u88ab\u8f6c\u6362\u4e3a\u94bb\u77f3)"})}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],DrawRulesManager:[function(e,t){"use strict";cc._RF.push(t,"79bf1a5USxDOrwe0r0TM/O0","DrawRulesManager");var i=e("../../Plugins/SDKManager"),a={initializeRules:function(e){console.log("[DrawRulesManager] Initializing draw rules",e);var t=window.FEATURE_TOGGLE&&window.FEATURE_TOGGLE.draw_rules_mode;if(this.logConfigurationStatus(t),t){if(window.DRAW_RULES_CONFIG){var a="c"+(e.chapterIndex+1)+"_"+(e.mapIndex+1),n=1;void 0!==i.SDKManager&&i.SDKManager.Instance&&(n=i.SDKManager.Instance.getAttempts(a)),console.log("[DrawRulesManager] [Rules] Current attempts for",a+":",n);var o=1;if(e.vehicleConfig&&void 0!==e.vehicleConfig.hp?o=e.vehicleConfig.hp:void 0!==e.currentHpPercent&&(o=e.currentHpPercent),console.log("[DrawRulesManager] [Rules] Current HP percentage:",o),t&&window.DRAW_RULES_CONFIG){var r=window.DRAW_RULES_CONFIG,s=r.hp_normal,c=r.hp_hurt,l=r.hp_damage,d=r.attempt_n;if(!r.case_rules||!Array.isArray(r.case_rules))return console.warn("[DrawRulesManager] case_rules not found or not an array in DRAW_RULES_CONFIG"),null;for(var h=null,u=0;u<r.case_rules.length;u++){var p=r.case_rules[u],f=!1;if(p.attempt){var m="attempt_n"===p.attempt.value?d:p.attempt.value;f=this.evaluateOperator(n,p.attempt.op,m)}var g=!1;if(p.hp_bucket){var v=null,y=null;"hp_normal"===p.hp_bucket.min?v=s:"hp_hurt"===p.hp_bucket.min?v=c:"hp_damage"===p.hp_bucket.min?v=l:null!==p.hp_bucket.min&&(v=p.hp_bucket.min),"hp_normal"===p.hp_bucket.max?y=s:"hp_hurt"===p.hp_bucket.max?y=c:"hp_damage"===p.hp_bucket.max?y=l:null!==p.hp_bucket.max&&(y=p.hp_bucket.max);var b=!0;null!==v&&p.hp_bucket.min_op&&(b=this.evaluateOperator(o,p.hp_bucket.min_op,v));var k=!0;null!==y&&p.hp_bucket.max_op&&(k=this.evaluateOperator(o,p.hp_bucket.max_op,y)),g=b&&k}if(f&&g){h=p,console.log("[DrawRulesManager] [Rules] Matched rule case_id:",p.case_id,"for attempts:",n,"and HP:",o);break}}if(h)return console.log("[DrawRulesManager] [Rules] Applying rule case_id:",h.case_id),window.DRAW_ITEMS_POWER=h.draw_items_power,window.RARITY_UPGRADE_CONFIG=h.rarity_upgrade_config,window.BONUS_BLOCK_THRESHOLD=h.bonus_block_threshold,window.DRAW_BLOCK_BONUS_AD=h.draw_block_bonus_ads,window.DRAW_BLOCK_BONUS=h.draw_block_bonus,window.NO_SAME_ITEM_DRAW_COUNT=h.no_smeltem_draw_count,window.ITEM_TYPE_WEIGHTS=h.item_type_weights,this.logAppliedRule(h),h;console.warn("[DrawRulesManager] [Rules] No matching rule found for attempts:",n,"and HP:",o)}return null}console.error("[DrawRulesManager] [Rules] DRAW_RULES_CONFIG not found, cannot apply dynamic rules")}},logConfigurationStatus:function(e){console.log("[DrawRulesManager] [Rules] ====================================="),console.log("[DrawRulesManager] [Rules] MODE:",e?"DYNAMIC RULES ENABLED":"STATIC VALUES"),e?console.log("[DrawRulesManager] [Rules] Will use DRAW_RULES_CONFIG to override values based on HP/attempts"):console.log("[DrawRulesManager] [Rules] Using individual remote config parameters (no dynamic adjustment)"),console.log("[DrawRulesManager] [Rules] Current values:"),e&&window.DRAW_RULES_CONFIG&&console.log("[DrawRulesManager] [Rules]   - DRAW_RULES_CONFIG:",JSON.stringify(window.DRAW_RULES_CONFIG)),console.log("[DrawRulesManager] [Rules]   - draw_items_power:",JSON.stringify(window.DRAW_ITEMS_POWER)),console.log("[DrawRulesManager] [Rules]   - rarity_upgrade_config:",JSON.stringify(window.RARITY_UPGRADE_CONFIG)),console.log("[DrawRulesManager] [Rules]   - bonus_block_threshold:",window.BONUS_BLOCK_THRESHOLD),console.log("[DrawRulesManager] [Rules]   - draw_block_bonus_ad:",window.DRAW_BLOCK_BONUS_AD),console.log("[DrawRulesManager] [Rules]   - draw_block_bonus:",window.DRAW_BLOCK_BONUS),console.log("[DrawRulesManager] [Rules]   - no_same_item_draw_count:",window.NO_SAME_ITEM_DRAW_COUNT),console.log("[DrawRulesManager] [Rules]   - item_type_weights:",window.ITEM_TYPE_WEIGHTS),console.log("[DrawRulesManager] [Rules] =====================================")},logAppliedRule:function(e){console.log("[DrawRulesManager] [Rules] Rule applied successfully - case_id:",e.case_id),console.log("[DrawRulesManager] [Rules] Window variables updated:"),console.log("[DrawRulesManager] [Rules]   - DRAW_ITEMS_POWER:",window.DRAW_ITEMS_POWER),console.log("[DrawRulesManager] [Rules]   - RARITY_UPGRADE_CONFIG:",window.RARITY_UPGRADE_CONFIG),console.log("[DrawRulesManager] [Rules]   - BONUS_BLOCK_THRESHOLD:",window.BONUS_BLOCK_THRESHOLD),console.log("[DrawRulesManager] [Rules]   - DRAW_BLOCK_BONUS:",window.DRAW_BLOCK_BONUS),console.log("[DrawRulesManager] [Rules]   - DRAW_BLOCK_BONUS_AD:",window.DRAW_BLOCK_BONUS_AD),console.log("[DrawRulesManager] [Rules]   - NO_SAME_ITEM_DRAW_COUNT:",window.NO_SAME_ITEM_DRAW_COUNT),console.log("[DrawRulesManager] [Rules]   - ITEM_TYPE_WEIGHTS:",window.ITEM_TYPE_WEIGHTS)},evaluateOperator:function(e,t,i){switch(t){case"<":return e<i;case"<=":return e<=i;case">":return e>i;case">=":return e>=i;case"==":return e==i;default:return console.warn("[DrawRulesManager] Unknown operator:",t),!1}}};t.exports=a,cc._RF.pop()},{"../../Plugins/SDKManager":"SDKManager"}],Drop:[function(e,t){"use strict";cc._RF.push(t,"35611ue2hxKn4SGuE+HrIza","Drop"),cc.Class({extends:e("../../core/base/Entity"),init:function(e,t,i){this.define=t,this.config=i,this.game=e,this.game.addUpdate(this),this.game.addRender(this),this.team=i.team,this._deg=0,this._x=i.x||0,this._y=i.y||0,this.flipX=1,this.scale=1,this.junkFlag=t.junk,this.initAvatar(),this.initPhysics(),this._physic_bounce=-.2,this._physic_damp_vx=.1;var a=this.moveSpd=100,n=a*kit.rnd(-2.5,2.5),o=a*kit.rnd(-.5,2.5);this.applyVelocity(n,o),this.height=t.height||0,this.pickTimer=i.delay||t.delay||3,this.picked=!1},updateLogic:function(e){if(this.updatePhysics(e),this.updateMoveOffset(e),!this.picked){this.pickTimer-=e;var t=this.game.levelMgr.heroes[1];(this.pickTimer<=0||t.x+100>this.x)&&(this.picked=!0,this.callDeath())}},callDeath:function(){this.deathAction||(this.deathAction=!0,this.define.onPick(this),this.game.callEffect(EFFECT.removeDrop,this.avatar),this.remove())},remove:function(){if(!this.removed){this.removed=!0;var e=this.game;e.removeUpdate(this),e.removeRender(this),this.avatar.remove(),delete this.avatar}}}),cc._RF.pop()},{"../../core/base/Entity":"Entity"}],EffectManager:[function(e,t){"use strict";cc._RF.push(t,"ad4ecVZxhJEzLQQnKLGDbxb","EffectManager"),window.EFFECT={},window.RES={};var i=function(){var e=this.syncAvatar;e&&!e.removed&&this.node.setPosition(e.x,e.y)},a=function(e){e.unscheduleAllCallbacks(),e.unscheduleAllCallbacksVS()},n=function(){this.stopAllActions(),this.stopAllActionsVS();for(var e=this.children,t=0;t<e.length;t++)e[t].recycleFunc();this.removeAllChildren(!1);var i=this.recycleIndex,a=m[this.recycleIndex];a||(a=m[i]=new cc.NodePool),a.put(this)},o=function(){a(this.sprite),n.call(this)},r=function(){a(this.label),n.call(this)},s=function(){var e=this.armatureDisplay;a(e),e.armature().animation.reset(),e.connects={},n.call(this)},c=function(){a(this.particleSystem),n.call(this)},l=function(){a(this.motionStreak),n.call(this)},d=function(){this.stopAllActions(),this.stopAllActionsVS(),n.call(this)},h=function(){this.node.recycleFunc()},u=function(){var e=this.particleSystem;e.updateAvatar&&e.unschedule(e.updateAvatar),e.autoRemoveOnFinish=!0,e.stopSystem()},p=function(){this.resetSystem(),this.stopSystem(),this.disableRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.recycleFunc()};cc.Node.prototype.recycleFunc=function(){cc.error("cant recycle this node",this)},cc.Recycle=cc.Class({name:"cc.Recycle",extends:cc.ActionInstant,update:function(){this.target.recycleFunc()},reverse:function(){return new cc.Recycle},clone:function(){return new cc.Recycle}}),cc.recycle=function(){return new cc.Recycle},window.AnimationWrap={Reserve:"r"};var f={},m={},g=e("./LevelManager");cc.Class({initRes:function(e,t,i){cc.log("initRes",e);var a=e.mapData,n=e.remotes;this.progressCb=t,this.successCb=i;var o={},r=["ui/select","white_block",RES.healNum,RES.hurtDeathNum,RES.hurtNum,RES.win,"avatar/backpack/block","avatar/backpack/side","avatar/backpack/embrasures","avatar/backpack/block2","avatar/backpack/side2",{anime:"operator/degun"},{anime:"operator/haoren"},{anime:"operator/qishou"},{anime:"operator/xiaoxiong"},{anime:"weapon/dapao"},{anime:"weapon/huoyanpensheqi"},{anime:"weapon/jiqiang"}],s=(null==n?void 0:n.themeDefine)||THEME_DEFINE[a.config.theme||"dust"];for(var c in s)s[c].atlas?this.pushResource(o,{atlas:s[c].atlas}):s[c].res&&this.pushResource(o,s[c].res),s[c].prefab&&this.pushResource(o,{prefab:s[c].prefab});var l=a.entity;for(var c in l){var d=l[c];this.initEntityRes(o,d,n)}for(var h in this.pushResource(o,r),cc.log("effectManager initRes",o),this.loadList=[],o)this.loadList.push(o[h]);this.stepIndex=this.loadList.length,this.loadCt=this.stepIndex,this.preloaded=!0,0==this.stepIndex&&(this.progressCb(1),this.successCb())},pushEntityRes:function(e,t){var i=ENTITY[t.id],a=RES[t.id]||[];if(i)if(i.getLoadList)i.getLoadList(i,t,a);else if(i.avatar){var n=i.avatar;n.anime?a.push({anime:n.anime}):n.frm&&a.push(n.frm)}this.pushResource(e,a)},pushFullEntityRes:function(e,t){this.pushEntityRes(e,t);var i=t.towers;for(var a in i){var n=i[a];n&&n.i&&this.pushEntityRes(e,{id:n.i})}},initEntityRes:function(e,t,i){var a=t.c&&i.entity[t.c];if(a&&a.length)for(var n=0;n<a.length;n++){var o=g.getConfig(i,t,n);this.pushFullEntityRes(e,o)}else o=g.getConfig(i,t),this.pushFullEntityRes(e,o)},pushResource:function(e,t,i){if(void 0===i&&(i=1),t)if(Array.isArray(t))for(var a=0;a<t.length;a++)t[a]&&this.pushResource(e,t[a],i);else if(cc.js.isString(t)){var n=t.indexOf("sound/");e[t]=n<0?{path:t,type:cc.SpriteFrame}:{path:t,type:cc.AudioClip}}else if(t.path)e[t.path]=t;else if(t.anime){var o=t.anime,r="anime/"+o+"_ske",s="anime/"+o+"_tex";e[r]={path:r,type:dragonBones.DragonBonesAsset},e[s]={path:s,type:dragonBones.DragonBonesAtlasAsset}}else if(t.particle)e[c="particle/"+t.particle]={path:c,type:cc.ParticleAsset};else if(t.prefab)e[c=t.prefab]={path:c,type:cc.Prefab};else if(t.sound)e[c=t.sound]={path:c,type:cc.AudioClip};else if(t.atlas)e[c=t.atlas]={path:c,type:cc.SpriteAtlas};else if(t.material)e[c="material/"+t.material]={path:c,type:cc.Material};else if(t.shader){var c,l=SHADER_DEFINE[t.shader];l?e[c="material/"+l.name]={path:c,type:cc.Material}:cc.warn("no shader def",t.shader)}},loadResource:function(e,t){var i,a,n=this;e.path?(i=e.path,a=e.type):(i=e,a=cc.SpriteFrame),this.getCache(i)?t&&t(null):cc.resources.load(i,a,function(e,a){n.setCache(i,a),e&&cc.log(i,e,a),t&&t(e,a)})},updateProgress:function(){var e=1-(this.stepIndex+this.loadCt)/2/this.loadList.length;this.progressCb(e)},loadAllRes:function(e,t){var i=this;for(var a in this.loadList=[],e)this.loadList.push(e[a]);for(this.stepIndex=this.loadList.length,this.loadCt=this.stepIndex;this.stepIndex>0;)this.loadResource(this.loadList[this.stepIndex-1],function(){i.loadCt--,0==i.loadCt&&t&&t()}),this.stepIndex--},loadResStep:function(e){var t=this;this.stepIndex>0&&(this.loadResource(this.loadList[this.stepIndex-1],function(){t.loadCt--,t.updateProgress(),0==t.loadCt&&t.successCb()}),this.stepIndex--,this.updateProgress(),e&&this.loadResStep(e))},initMap:function(e){cc.log("initMap",e.layer),this.game=e,this.layer=e.layer},clear:function(){if(!this.cacheMode){for(var e in m)m[e].clear();for(var e in f)f[e].decRef(),cc.log("cache clear",e);f={}}},bindScheduler:function(e){this.layer&&this.layer.bindScheduler(e)},getCache:function(e){return f[e]},setCache:function(e,t){t||cc.error("setCache no data",e),this.getCache(e)?this.preloaded&&cc.log("cache repeated",e):t.addRef(),f[e]=t},instantiate:function(e,t){var i=this;if(this.getCache(e)){var a=cc.instantiate(this.getCache(e));t&&t(0,a)}else this.preloaded&&cc.log("loadPrefab",e),cc.resources.load(e,cc.Prefab,function(a,n){if(a)cc.log("load prefab err",a);else{i.setCache(e,n);var o=cc.instantiate(n);t&&t(0,o)}})},createNode:function(e,t){var i,a=m.node;return a&&a.size()>0?((i=a.get()).opacity=255,i.x=0,i.y=0,i.angle=0,i.color=cc.color(255,255,255),i.setScale(1,1)):((i=new cc.Node).recycleIndex="node",i.recycleFunc=d),i.x=e,i.y=t,this.bindScheduler(i),i},createArmature:function(e,t,i){var a;i||(i=t,t=null);var n=e+"-"+t,o=m[n];if(o&&o.size()>0)(a=o.get()).opacity=255,a.x=0,a.y=0,a.angle=0,a.scale=1,a.color=cc.color(255,255,255),this.bindShader(a.armatureDisplay,"normal"),i&&i(null,a.armatureDisplay);else{var r=(a=new cc.Node).addComponent(dragonBones.ArmatureDisplay);this.loadArmature(r,e,i,t),a.armatureDisplay=r,a.recycleIndex=n,a.recycleFunc=s}return this.bindScheduler(a),a},loadArmature:function(e,t,i,a){var n=this,o="anime/"+t+"_ske",r="anime/"+t+"_tex";e.connects={},e.dragonAsset=null,e.dragonAtlasAsset=null,e.armatureName=null;var s=a||t;this.getCache(o)&&this.getCache(r)?(e.dragonAsset=this.getCache(o),e.dragonAtlasAsset=this.getCache(r),e.armatureName=s,e.enabled=!0,i&&i(null,e)):(this.preloaded&&cc.log("loadArmature",t),cc.resources.load(o,dragonBones.DragonBonesAsset,function(t,a){t?cc.log("load DragonBonesAsset err",t):(n.setCache(o,a),cc.resources.load(r,dragonBones.DragonBonesAtlasAsset,function(t,a){t?cc.log("load DragonBonesAtlasAsset err",t):(n.setCache(r,a),cc.isValid(e)&&(e.dragonAsset=n.getCache(o),e.dragonAtlasAsset=n.getCache(r),e.armatureName=s,e.enabled=!0,i&&i(t,e)))}))}))},createParticle:function(e,t,i,a){var n,o=i,r=m[o];if(r&&r.size()>0)(n=r.get()).opacity=255,n.angle=0,n.color=cc.color(255,255,255),n.particleSystem.resetSystem();else{var s=(n=new cc.Node).addComponent(cc.ParticleSystem);this.loadParticle(s,i),n.particleSystem=s,n.recycleIndex=o,n.recycleFunc=c,n.remove=u}return this.bindScheduler(n),this.syncParticle(n.particleSystem,a),n.x=e,n.y=t,n},syncParticle:function(e,t){t&&(e.syncAvatar=t,e.updateAvatar=i,e.scheduleVS(e.updateAvatar,0)),e.scheduleVS(e.updateStatus,0)},loadParticle:function(e,t){var i=this,a=t;this.getCache(a)?e.file=this.getCache(a):(this.preloaded&&cc.log("loadParticle",t),cc.resources.load(a,cc.ParticleAsset,function(t,n){t?cc.log("load ParticleAsset err",t):(i.setCache(a,n),cc.isValid(e)&&(e.file=n))})),e.updateStatus=e.lateUpdate,e.lateUpdate=null,e._finishedSimulation=p},createSpriteFromAtlas:function(e,t,i,a,n){var r,s;DEBUG_MODE&&(isNaN(e)||isNaN(t))&&cc.error("createSprite isNaN",e,t,i,a);var c=m[s=i?i+a:a];if(c&&c.size()>0)(r=c.get()).opacity=255,r.angle=0,r.color=cc.color(255,255,255);else{var l=(r=new cc.Node).addComponent(cc.Sprite);this.loadSpriteFromAtlas(l,i,a,n),r.sprite=l,r.recycleIndex=s,r.recycleFunc=o}return r.x=e,r.y=t,this.bindScheduler(r),r},loadSpriteFromAtlas:function(e,t,i,a){var n=this;if(t){var o=this.getCache(t);if(o){var r=o.getSpriteFrame(i);e.spriteFrame=r,a&&a(null,e)}else this.preloaded&&cc.log("loadSpriteFromAtlas",t),cc.resources.load(t,cc.SpriteAtlas,function(o,r){if(o)cc.log("load SpriteAtlas err",o);else if(cc.isValid(e)){n.setCache(t,r);var s=r.getSpriteFrame(i);e.spriteFrame=s,a&&a(null,e)}})}else this.loadSprite(e,i,null,a)},createSprite:function(e,t,i,a,n){if(DEBUG_MODE&&(isNaN(e)||isNaN(t)))throw cc.error("createSprite isNaN",e,t,i),new Error("createSprite isNaN");var r,s=i,c=m[s];if(c&&c.size()>0)(r=c.get()).opacity=255,r.angle=0,r.color=cc.color(255,255,255);else{var l=(r=new cc.Node).addComponent(cc.Sprite);this.loadSprite(l,i,a,n),r.sprite=l,r.recycleIndex=s,r.recycleFunc=o}return r.x=e,r.y=t,this.bindScheduler(r),r},loadSprite:function(e,t,i,a){var n=this;if(t){var o=this.getCache(t);if(o){var r=o;e.spriteFrame=r,i&&(r.insetLeft=i[0],r.insetTop=i[1],r.insetRight=i[2],r.insetBottom=i[3],e.type=cc.Sprite.Type.SLICED,e.sizeMode=cc.Sprite.SizeMode.CUSTOM),a&&a(null,e)}else cc.resources.load(t,cc.SpriteFrame,function(o,r){if(o)cc.log("load SpriteFrame err",o);else if(n.setCache(t,r),cc.isValid(e)){var s=r;e.spriteFrame=s,i&&(s.insetLeft=i[0],s.insetTop=i[1],s.insetRight=i[2],s.insetBottom=i[3],e.type=cc.Sprite.Type.SLICED,e.sizeMode=cc.Sprite.SizeMode.CUSTOM),a&&a(null,e)}})}},createAnimation:function(e,t){var i,a=e,n=m[a];if(n&&n.size()>0)(i=n.get()).x=0,i.y=0,i.opacity=255,i.angle=0,i.color=cc.color(255,255,255),this.bindScheduler(i),this.playAnimation(i.sprite,i.animation,t);else{i=new cc.Node,this.bindScheduler(i);var r=i.addComponent(cc.Sprite),s=i.addComponent(cc.Animation);this.loadAnimation(r,s,e,t),i.sprite=r,i.animation=s,i.recycleIndex=a,i.recycleFunc=o}return i},loadAnimation:function(e,t,i,a){var n=this;this.getCache(i)?this.bindAnimation(e,t,this.getCache(i),a):(this.preloaded&&cc.log("loadAnimation",i),cc.resources.load(i,cc.SpriteAtlas,function(o,r){o?cc.log("load  Animation SpriteAtlas err",i,o):(n.setCache(i,r),cc.isValid(e)&&n.bindAnimation(e,t,r,a))}))},bindAnimation:function(e,t,i,a){var n=a.speed,o=a.repeat,r=i.getSpriteFrames();if(a.rand){for(var s=[],c=0,l=r.length;c<l;c++)s.push(r.splice(kit.rndInt(0,r.length-1),1)[0]);r=s}e.trim=!1,e.sizeMode=cc.Sprite.SizeMode.RAW;var d=cc.AnimationClip.createWithSpriteFrames(r,r.length);d.name="1",d.speed=n||1,o==AnimationWrap.Reserve?d.wrapMode=cc.WrapMode.Reverse:o<0?d.wrapMode=cc.WrapMode.Loop:(d.wrapMode=cc.WrapMode.Normal,d.repeatCount=o||1),t.addClip(d),this.playAnimation(e,t,a)},playAnimation:function(e,t,i){var a=i.delay;i.alive?t._animationFinish&&(t.off("finished",h,t),t._animationFinish=null):t._animationFinish||(t.on("finished",h,t),t._animationFinish=h),a?(t.node.runActionVS(cc.sequence(cc.delayTime(a),cc.callFunc(function(){t.play("1")},t))),e.spriteFrame=null):t.play("1")},createLabel:function(e,t,i,a,n){var o,s=this,c=i,l=m[c];if(l&&l.size()>0)(o=l.get()).label.string=a;else{var d=(o=new cc.Node).addComponent(cc.Label);this.getCache(i)?(d.font=this.getCache(i),d.string=a,d.fontSize=n):(this.preloaded&&cc.log("load font",i),cc.resources.load(i,cc.Font,function(e,t){e?cc.log("load font err",e):(s.setCache(i,t),cc.isValid(d)&&(d.font=t,d.string=a,d.fontSize=n))})),o.label=d,o.recycleIndex=c,o.recycleFunc=r}return o.x=e,o.y=t,this.bindScheduler(o),o},createSimpleLabel:function(e,t,i,a){var n=new cc.Node;n.x=e,n.y=t;var o=n.addComponent(cc.Label);return o.string=i,a&&(o.fontSize=a),n.label=o,n},createMotionStreak:function(e,t,i,a){var n,o=this,r="motion-"+e,s=m[r];if(s&&s.size()>0)(n=s.get()).opacity=255,(c=n.motionStreak).fadeTime=t,c.minSeg=i,c.stroke=a,c.reset();else{var c=(n=new cc.Node).addComponent(cc.MotionStreak),d=this.getCache(e);d?(c.texture=d.getTexture(),c.onLoad=function(){c.fadeTime=t,c.minSeg=i,c.stroke=a}):(this.preloaded&&cc.log("loadMotionStreak",e),cc.resources.load(e,cc.SpriteFrame,function(n,r){n?cc.log("load Motion SpriteFrame err",n):(o.setCache(e,r),cc.isValid(c)&&(c.texture=r.getTexture(),c.fadeTime=t,c.minSeg=i,c.stroke=a))})),n.motionStreak=c,n.recycleIndex=r,n.recycleFunc=l}return this.bindScheduler(n),n},bindShader:function(e,t){if("normal"!=t){var i=SHADER_DEFINE[t];i&&this.bindMaterial(e,i.name,i.value)}else{var a=cc.MaterialVariant.createWithBuiltin("2d-sprite",e);e.setMaterial(0,a)}},loadMaterial:function(e,t){var i=this,a="material/"+e,n=this.getCache(a);n?t(0,n):(this.preloaded&&cc.log("loadMaterial",a),cc.resources.load(a,cc.Material,function(e,n){e?cc.log("loadMaterial err",e):(i.setCache(a,n),t(0,n))}))},bindMaterial:function(e,t,i){var a=this,n="material/"+t,o=this.getCache(n);if(o){var r=cc.MaterialVariant.create(o,e);for(var s in i)r.setProperty(s,i[s]);e.setMaterial(0,r)}else this.preloaded&&cc.log("bindMaterial",n),cc.resources.load(n,cc.Material,function(t,o){if(t)cc.log("bindMaterial err",t);else if(a.setCache(n,o),cc.isValid(e)){var r=cc.MaterialVariant.create(o,e);for(var s in i)r.setProperty(s,i[s]);e.setMaterial(0,r)}})},playEffect:function(e,t,i,a){if(SE_VOLUME&&e)return this.play(e,t,i,!0,a);a&&a(1)},playMusic:function(e,t,i,a){return cc.log("playMusic",e,!!t,i),this.play(e,t,i,!1,a)},play:function(e,t,i,a,n){var o,r=this;void 0===i&&(i=1),e.constructor==Array&&(e[1]&&e[1]>0?(i=e[1],e=e[0]):(e=e[kit.rndInt(0,e.length-1)]).constructor==Array&&(i=e[1],e=e[0]));var s=e,c=this.getCache(s);if(i>1&&(i=1),i*=.2,c)return a?o=cc.audioEngine.play(c,!!t,i):menuManager.playBgm(c,!!t,i),n&&n(0,o),o;this.preloaded&&cc.log("loadSound",s),cc.resources.load(s,cc.AudioClip,function(e,o){var c;e?cc.log("load AudioClip err",e):(r.setCache(s,o),(!t||n)&&(a?c=cc.audioEngine.play(o,!!t,i):menuManager.playBgm(o,!!t,i),n&&n(0,c)))})}}),cc._RF.pop()},{"./LevelManager":"LevelManager"}],Electric:[function(e,t){"use strict";cc._RF.push(t,"71af2a7QJNG14VDOYVJxVxn","Electric");var i=e("../components/visual/VirtualAvatar"),a=cc.Class({extends:e("../core/base/Proto"),init:function(e,t,i,a){this.define=t,this.config=i,this.game=e,this.obj=i.obj,this.from=i.from,this.favorite=i.favorite,this.noRepeat=this.define.noRepeat,cc.log("Eletric obj",this.obj.define.id),this.deg=a,this.x=i.x,this.y=i.y,this.team=i.team||0,this.dmg=i.dmg||i.bltDmg||t.dmg||0,this.knockBack=t.kb||0,this.radius=t.radius||0,this.lifeTimer=t.life||.4,this.attackTimer=.1,this.hitCt=t.hitCt,null!=i.chain?this.chainCt=i.chain:this.chainCt=t.chain,this.chainDegression=t.chainDegression||i.chainDegression,this.ignoreChainTarget=i.ignoreChainTarget,this.chainRange=t.chainRange,this.chainAngle=t.chainAngle,this.initStatus()},initStatus:function(){this.initAvatar(),this.game.addUpdate(this)},initDebug:function(){},check:function(){var e=this.obj.deg;this.knockBackX=this.knockBack*c_degree2cos(e),this.knockBackY=this.knockBack*c_degree2sin(e),this.hitCounter=this.hitCt,this.game.contactMgr.checkAliveEnemy(this,this.x,this.y,this.radius,this.team,this.onCover)},initAvatar:function(){var e=this.obj;this.from||(e.electricAvatar?(this.avatar=e.electricAvatar,e.electricCount+=1,1==e.electricCount&&this.avatar.restart()):(this.define,this.avatar=this.game.callEffect(EFFECT.lightning,e.avatar,this)||i,e.electricAvatar=this.avatar,e.electricCount=1))},removeAvatar:function(){if(!this.from){var e=this.obj;e.electricCount-=1,0==e.electricCount&&this.avatar.stop()}},onCover:function(e){if(e!=this.from&&(!this.favorite||e==this.favorite)){if(this.hitCt){if(this.hitCounter<=0)return;this.hitCounter--}e.weight,e.onHurt(this,this.dmg),this.explosion(e),this.game.callEffect(EFFECT.lightningHit,e.avatar,this);var t=BULLET_FADE_TYPE.HIT,i=e;if(this.define.spawnBlt){var n=this.define.spawnBlt;for(var o in n){var r=n[o],s={obj:this.obj,x:this.x+(r.x||0),y:this.y+(r.y||0),deg:r.deg,team:this.obj.team,moveSpdX:this.obj.getSpdX()};Bullet.shot(this.game,r.blt,s)}}if(this.chainCt&&t==BULLET_FADE_TYPE.HIT){var c=this.seekTarget(i,this.ignoreChainTarget,this.chainRange,this.chainAngle);if(c){var l=kit.vector2Degree(c.x-i.x,c.y-i.y);this.ignoreChainTarget=this.ignoreChainTarget||[],this.noRepeat&&this.ignoreChainTarget.push(i.uniqueID),s={obj:this.obj,x:i.x,y:i.y,deg:l,from:i,favorite:c,team:this.obj.team,moveSpdX:this.obj.getSpdX(),groundY:this.groundY,chain:this.chainCt-1,dmg:this.dmg*(this.chainDegression||1),ignoreChainTarget:this.ignoreChainTarget},a.shot(this.game,this.define,s)}}}},updateLogic:function(e){this.attackTimer>0&&(this.attackTimer-=e,this.attackTimer<=0&&this.check()),this.lifeTimer-=e,this.lifeTimer<=0&&this.remove()},remove:function(){this.removed||(this.removed=!0,this.removeAvatar(),this.game.removeUpdate(this))},playHitEffect:function(e){var t=e.avatar;if(t){var i=this.game.effectMgr.createAnimation("effect/electric/hit_lightning",{speed:3,rand:1});t.addChild(i,100),i.scale=1.5+.1*Math.random(),i.angle=360*Math.random(),i.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,i.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE}},explosion:function(e,t){var i=this.define.bomb;if(!(!i||i.exploFunc&&i.exploFunc.call(this,t))){var a=i.r1,n=i.r0,o=this.dmg,r=i.kb,s=e.x,c=e.y,l=this.team;a<=n&&(cc.warn("\u534a\u5f84\u5fc5\u987br1>r0",a,n),a=n+.1);var d,h=this.obj;h.bltExploRange&&(a*=h.bltExploRange),d=this.define.heal?l:1-l;var u=this.game.contactMgr.getContactList(d);for(var p in u){var f=u[p],m=f.getEntity();if(f._activeContact&&m.isInBorder()&&(this.define.heal?m.team==l:m.team!=l)){var g=f.hitRadius+a,v=s-f.getPositionX(),y=c-f.getPositionY(),b=v*v+y*y,k=i.buff;if(b<=g*g){var T=c_sqrt(b)+.1;if(T<=n)this.define.heal?this.define.healType&&m.armorType!=this.define.healType||(m.onHeal(this,this.heal,!0),this.playHitEffect(m),k&&m.addBuff(this,k)):(m.onHurt(this,o,i.weaponType,i.dmgType),this.playHitEffect(m),k&&m.addBuff(this,k));else if(this.define.heal){var _=this.heal*(1+1*(T-n)/(g-n));this.define.healType&&m.armorType!=this.define.healType||(m.onHeal(this,_,!0),this.playHitEffect(m),k&&m.addBuff(this,k))}else{var w=o*(1+1*(T-n)/(g-n));m.onHurt(this,w,i.weaponType,i.dmgType),this.playHitEffect(m),k&&m.addBuff(this,k)}if(!m.isDead()&&m.weight>0){var E=-v*(r/(T*m.weight))*100;1==m.team&&E<0&&(E=0),0==m.team&&E>0&&(E=0)}m.isDead()&&(m.isFly()?(kit.rnd(750,1e3),Math.abs(v),Math.abs(y),Math.abs(v),Math.abs(y)):v>0&&kit.rnd(-600,-350)||kit.rnd(350,600))}}}var C=this.hurtDelayTime;if(i.effect)this.game.callEffect(i.effect,s,c,a,C,this.groundY);else if(i.effectCfg){var S,I,A=i.effectCfg,B=this.game.effectMgr.createAnimation(A.name,{speed:A.speed,repeat:A.repeat||-1});B.x=s,B.y=c,B.scale=A.scale||1,B.angle=A.angle||0,null!=(S=h.avatar)&&null!=(I=S.define)&&I.effectScale&&(B.scale*=h.avatar.define.effectScale),this.game.layer.addToCamera(B,ZORDER.EFFECT),A.blend&&(B.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,B.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE),A.rotate&&B.runAction(cc.rotateBy(1,A.rotate).repeatForever())}}},seekTarget:function(e,t,i,a){for(var n,o,r=this.game.getEntityList(),s=0;s<r.length;s++){var c,l=r[s];if(c=this.define.heal?1-this.team:this.team,l.isInBorder()&&!l.isDead()&&!l._sensor&&l.team!=c&&l!=e){if(t){var d=!1;for(var h in t)if(t[h]==l.uniqueID){d=!0;break}if(d)continue}var u=kit.norm(l.x-e.x,l.y-e.y);(!i||u<=i)&&(a&&kit.includeDegree(this.deg,kit.vector2Degree(l.x-e.x,l.y-e.y))<a&&(u-=1e4),(!n||u<o)&&(n=l,o=u))}}return n}});a.shot=function(e,t,i){var n=i.deg||i.obj.deg,o=new a;return o.init(e,t,i,n),o},cc._RF.pop()},{"../components/visual/VirtualAvatar":"VirtualAvatar","../core/base/Proto":"Proto"}],EnergyBarrier:[function(e,t){"use strict";cc._RF.push(t,"df3349RzgZPAL9JJ3DAIl6N","EnergyBarrier");var i=e("../../../entities/projectiles/Bullet"),a=e("../../../entities/projectiles/Bomb"),n=e("../../../entities/projectiles/ContactBullet"),o=e("../../../entities/projectiles/MortarBomb");cc.Class({extends:e("../../../entities/environment/MyTower"),checkBltContact:function(e){if(e.team==this.team&&this.bltContactEnabled&&e.bulletFlag&&(!e.define.ctor||e.define.ctor==i||e.define.ctor==a||e.define.ctor==n||e.define.ctor==o))return!0},onBltContact:function(e){if(e.team==this.team){if(!this.bltContactEnabled)return!0;if(!e.bulletFlag)return!0;if(e.define.ctor&&e.define.ctor!=i&&e.define.ctor!=a&&e.define.ctor!=n&&e.define.ctor!=o)return!0;if(e.energyBarrierAffected||(e.energyBarrierAffected={}),!this.affectMultiple&&Object.keys(e.energyBarrierAffected).length>0)return!0;if(e.energyBarrierAffected[this.uniqueID])return!0;if(e.energyBarrierAffected[this.uniqueID]=!0,EFFECT.PureFireLight.call(this.game.effectMgr,this.x,e.y,{x:0,y:0},0,-100,.5,this.game,1,2,1300,255,255),this.empowerBlt&&(e.dmg&&(e.dmg*=1.5),e.bombDmg&&(e.bombDmg*=1.5)),!this.duplicateBlt)return!0;var t=e.deg,r=t+25;r>90&&r<270&&(r+=180);var s=t-25;s>90&&s<270&&(s+=180),cc.log("EnergyBarrier deg",r,s);var c={obj:e.obj,x:this.x,y:e.y,deg:r,team:e.obj.team,moveSpdX:e.obj.getSpdX(),groundY:e.groundY,bltDmg:e.dmg/2,bombDmg:e.bombDmg&&e.bombDmg/2};return i.shot(e.game,e.define,c,function(t){t.energyBarrierAffected=kit.clone(e.energyBarrierAffected)}),c={obj:e.obj,x:this.x,y:e.y,deg:s,team:e.obj.team,moveSpdX:e.obj.getSpdX(),groundY:e.groundY,bltDmg:e.dmg/2,bombDmg:e.bombDmg&&e.bombDmg/2},i.shot(e.game,e.define,c,function(t){t.energyBarrierAffected=kit.clone(e.energyBarrierAffected)}),!0}}}),cc._RF.pop()},{"../../../entities/environment/MyTower":"MyTower","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","../../../entities/projectiles/ContactBullet":"ContactBullet","../../../entities/projectiles/MortarBomb":"MortarBomb"}],EnergyUpMenu:[function(e,t){"use strict";cc._RF.push(t,"228aac9ExVBCatJdke3DEJQ","EnergyUpMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{upLabel1:cc.Label,upLabel2:cc.Label,label1:cc.Label,label2:cc.Label,priceLabel:cc.Label,energyIcon:[cc.Node]},initStatus:function(){var e=money.getEnergyLevel(),t=ENERGY_DEF[e],i=ENERGY_DEF[e+1];for(var a in this.energyIcon)this.energyIcon[a].active=a==e+1;this.priceLabel.string=t.price,this.upLabel1.string="+"+(i.max-t.max),this.upLabel2.string=i.time-t.time,this.label1.string=t.max,this.label2.string=t.time},onUpgrade:function(){var e=this;(0,this.args.upgradeCb)(function(t){e.onCheck(t)})},onCheck:function(){var e=this.args.checkCb;e&&e.call(this)||this.close(!0)},waitOnClose:function(){}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],Entity:[function(e,t){"use strict";cc._RF.push(t,"14a9d2KDJtIP57gPcSvfsM5","Entity");var i=e("../../components/attributes/Attribute"),a=e("../../entities/projectiles/Bullet"),n=e("../../components/combat/buffs/Buff"),o=e("../../components/Slot");cc.Class({extends:e("./Proto"),properties:{_inBorder:!1,_spdX:0,_spdY:0,_dx:0,_dy:0,_x:0,x:{get:function(){return this.getPositionX()},set:function(e){this.setPositionX(e)}},_y:0,y:{get:function(){return this.getPositionY()},set:function(e){this.setPositionY(e)}},_deg:0,deg:{get:function(){return this.getDegree()},set:function(e){this.setDegree(e)}},_attackDeg:0,attackDeg:{get:function(){return this._attackDeg},set:function(e){this.setAttackDeg(e)}}},init:function(e,t,i){this.define=t,this.config=i,this.game=e,this.initFlags(),this.initAttributes(),this.initStatus(),this.initBuffs(),this.game.addUpdate(this),this.game.addRender(this),t.noContact||this.game.contactMgr.addEntity(this),t.noBullet&&(this._ignoreBullet=!0),t.noEntity&&(this._ignoreEntity=!0),this.initPhysics(),this.initAvatar(),this.initSkills(),this.initPilot(),this.initDebug(),this.initShapes(),this.initSlots(),t.createCb&&t.createCb.call(this)},initShapes:function(){var e=this.define.shapes;if(e)for(var t in this.shapes=[],e)this.shapes.push(this.createShape(e[t]))},initStatus:function(){this.game;var e=this.config,t=this.define,i=this.scale=e.scale||1;this.radius=(t.radius||50)*i,t.hitRadius?this.hitRadius=t.hitRadius*i:this.hitRadius=this.radius,this._x=e.x||0,this._y=e.y||0,this.team=e.team||0,this.rttSpd=t.rttSpd||20,this._deg=e.deg||0,this.attackCenter=t.attackCenter||cc.v2(0,0),this.attackSequence=t.attackSequence,this.blt=t.blt,this.bltReload=t.bltReload,this.bltMax=t.bltMax,this.bltCt=this.bltMax,this.lifeTimer=t.life||e.life,this.undead=e.un,this.height=this.define.height||this.radius,0==this.team?this.flipX=1:this.flipX=-1,this._attackDeg=90-90*this.flipX,this.attackSound=t.attackSound,this.attackVolume=t.attackVolume,this.moveSequence=t.moveSequence,this.moveScale=t.moveScale||1,this.mobType=t.mobType,this.armorType=t.armorType,this.fly=t.fly,this.groundIndex=e.ground||0,this.crashScale=t.crash||.1,this.fixedFlipX=t.fixedFlipX,this.dropList=e.drop,this.outRange=e.out||t.out||0,this.machineFlag=t.machine,this.bossFlag=e.boss||t.boss,this.slotType=e.slot||t.slot,this.subFlag=t.sub,this.climbFlag=t.climb,this.hp=this.hpMax,void 0!==e.hp&&(this.hp=c_clamp(this.hpMax*e.hp,0,this.hpMax))},initDebug:function(){},initAttributes:function(){var e,t=this,a=this.define,n=this.config,o=n.attr||{},r=new i;this.attribute=r,this.hurtScaleTable=((e={})[DMG_TYPE.blt]=1,e[DMG_TYPE.explode]=1,e[DMG_TYPE.fire]=1,e[DMG_TYPE.crash]=1,e),r.init("hurtScale",a.hurtScale||1,1e10,0,function(e){t.hurtScale=e}),r.init("bltHurtScale",1,1e10,0,function(e){t.hurtScaleTable[DMG_TYPE.blt]=e}),r.init("explodeHurtScale",1,1e10,0,function(e){t.hurtScaleTable[DMG_TYPE.explode]=e}),r.init("fireHurtScale",1,1e10,0,function(e){t.hurtScaleTable[DMG_TYPE.fire]=e}),r.init("crashHurtScale",1,1e10,0,function(e){t.hurtScaleTable[DMG_TYPE.crash]=e});var s=(o.hp||a.hp||50)*(n.hp0||1);r.init("hpMax",s,1e10,0,function(e){t.hpMax=e,t.hp>e&&(t.hp=e)}),o.hp0&&r.mutScale("hpMax",o.hp0);var c=(o.armor||a.armor||0)*(n.amr0||1);r.init("armor",c,1e10,0,function(){t.armorRate=1}),r.init("critChance",0,1,0,function(e){t._critChance=e}),r.init("critBonus",o.critBonus||a.critBonus||2,10,0,function(e){t._critBonus=e}),r.init("crit",o.crit||a.crit||0,1e5,0,function(){}),r.init("critSuffer",o.critSuffer||a.critSuffer||0,1e5,0,function(e){t._critSuffer=e}),r.init("moveSpd",o.moveSpd||a.moveSpd,1e10,0,function(e){t.moveSpd=e}),this.moveScaleX=0,this.moveScaleY=0,r.init("atkSpd",o.atkSpd||a.atkSpd||1,100,0,function(e){t.atkSpd=e});var l=(o.atk||a.atk||1)*(n.atk0||1);r.init("atkScale",l,100,0,function(e){t._atkScale=e}),r.init("bltDmg",o.bltDmg||a.bltDmg||0,1e10,0,function(e){t.bltDmg=e}),r.init("bombDmg",o.bombDmg||a.bombDmg||0,1e10,0,function(e){t.bombDmg=e}),r.init("bltExploRange",1,1e10,0,function(e){t.bltExploRange=e}),r.init("bltSpd",1,1e10,0,function(e){t.bltSpd=e}),this.skillScale=1,r.init("skillScale",(o.skill||1)*(n.skill0||1),100,0,function(e){t.skillScale=e}),this.skillCD=1,r.init("skillCD",1,100,0,function(e){t.skillCD=e}),this.skillCombo=0,r.init("skillCombo",0,1,0,function(e){t.skillCombo=e}),r.init("atk2Boss",0,1,0,function(e){t.atk2Boss=e}),r.init("healScale",1,1e10,0,function(e){t.healScale=e}),r.init("armorScale",1,1e10,0,function(e){t.armorScale=e})},initAvatar:function(){this.avatar=this.game.addAvatar(this,this.define.avatar,this.config),this.avatar.refresh(0,!0,!0),this.avatar.updateRender(0),this.isInBorder()&&this.game.step>1&&1==this.team&&this.game.callEffect(EFFECT.unitShow,this.avatar)},initPilot:function(){this.pilot=this.game.addPilot(this,this.define.pilot,this.config)},initSkills:function(){this.skills=[];var e=this.define.skill;if(e)for(var t in e){var i=e[t];if(i){var a=new i.ctor;a.init(this.game,i,{obj:this,index:t}),this.skills.push(a)}}},initFlags:function(){this.define,this.flags={},this.flags[NO_ATTACK]=0,this.flags[NO_MOVE]=0,this.flags[NO_ROTATE]=0,this.flags[NO_SKILLS]=0,this.flags[NO_SKILL0]=0,this.flags[NO_SKILL1]=0,this.flags[NO_SKILL2]=0,this.flags[NO_CONTACT]=0,this.flags[NO_BULLET]=0,this.flags[NO_BORDER]=0,this.flags[NO_GROUND]=0,this.flags[NO_HURT]=0,this.flags[NO_ENTITY]=0,this.attackAction=!1,this.moveAction=!1,this.idleTimer=0},initBuffs:function(){this.buffTable={}},addBuff:function(e,t,i){if(t&&(t.revive||!this.isDead())&&(!t.noBoss||!this.bossFlag)){var a,o=t.symbol;o||(o=n.getSymbol());var r=this.buffTable;return r[o]?(a=r[o]).callCover(t,i):((a=new(t.ctor||n)).init(this.game,e,this,t,i),r[o]=a,a.symbol=o),a}},getBuff:function(e){var t=e.symbol,i=this.buffTable;if(t&&i[t])return i[t]},clearBuff:function(){if(this.buffTable){for(var e in this.buffTable)this.buffTable[e].remove();this.buffTable={}}},removeBuff:function(e){delete this.buffTable[e.symbol]},setFlag:function(e,t){var i=this.flags;if(i[e]+=t?1:-1,e==NO_CONTACT)t&&1==i[e]?this._activeContact=!1:t||0!=i[e]||(this._activeContact=!0);else if(e==NO_ENTITY)t&&1==i[e]?this._ignoreEntity=!0:t||0!=i[e]||(this._ignoreEntity=!1);else if(e==NO_GROUND)t&&1==i[e]?this._ignoreGround=!0:t||0!=i[e]||(this._ignoreGround=!1);else if(e==NO_BORDER)t&&1==i[e]?this._ignoreBorder=!0:t||0!=i[e]||(this._ignoreBorder=!1);else if(e==NO_BULLET)t&&1==i[e]?this._ignoreBullet=!0:t||0!=i[e]||(this._ignoreBullet=!1);else if(e==NO_SKILLS){if(t&&1==i[e])for(var a in this.skills)this.setFlag(NO_SKILL[a],!0);else if(!t&&0==i[e])for(var a in this.skills)this.setFlag(NO_SKILL[a],!1)}else for(var a in NO_SKILL)e==NO_SKILL[a]&&(t&&1==i[e]?this.skills[a].silence(!0):t||0!=i[e]||this.skills[a].silence(!1))},getFlag:function(e){return this.flags[e]},startAttack:function(){if(this.attackSequence&&!this.attackAction&&!this.reloadAction&&!this.getFlag(NO_ATTACK)){this.attackAction=!0,this.attackIndex=0,this.attackTimer=0,this.atkFadeTimer=.1;var e=this.attackSequence[0];e&&void 0!==e.ani?(this.attackPlay=e.ani,this.attackPlay&&this.avatar.refresh(.1,!0)):(this.attackPlay=1,this.avatar.refresh(.1,!0)),this.startAttackSound()}},updateAttack:function(e){if(this.getFlag(NO_ATTACK))return this.attackAction&&this.clearAttack(),void(this.reloadAction=!1);if(this.reloadAction){if(this.reloadTimer-=e,!(this.reloadTimer<=0))return;this.reloadAction=!1,this.bltCt=this.bltMax,this.avatar.refresh(.1)}if(!this.attackAction){if(!this.autoAttack)return this.idleTimer+=e,void(this.idleTimer>1&&this.bltMax>0&&this.bltCt<this.bltMax&&this.callReload());if(this.bltMax>0&&this.bltCt<=0)return void this.callReload();this.startAttack()}this.idleTimer=0,this.atkFadeTimer<=ZERO?(this.attack(),this.attackTimer-=e*this.atkSpd):this.atkFadeTimer-=e},attack:function(){for(var e=this.attackSequence;this.attackTimer<=ZERO;){if(!(this.attackIndex<e.length))return void(this.bltMax>0&&this.bltCt<=0?this.callReload():this.stopAttack());var t=e[this.attackIndex];if(this.attackTimer+=t.t,t.stop){if(!this.autoAttack)return void this.stopAttack();if(this.bltMax>0&&this.bltCt<=0)return void this.callReload()}void 0!==t.ani&&(this.attackPlay=t.ani,this.avatar.refresh(.1,!0)),t.blt&&this.shot(t),this.attackIndex+=1}},shot:function(e){var t=this.blt[e.blt-1],i=this.attackCenter,n=this.x,o=this.y,r=this._attackDeg+this._deg;e.deg&&(r+=e.deg);var s,c,l,d=(e.x||0)*this.scale,h=(e.y||0)*this.scale*this.flipX;t.offsets&&(this._bltOffsetIndex||(this._bltOffsetIndex=t.offsets.length),this._bltOffsetIndex-=1,d+=t.offsets[this._bltOffsetIndex].x,h+=t.offsets[this._bltOffsetIndex].y);var u=c_degree2cos(r),p=c_degree2sin(r),f=u*d-p*h+i.x*this.flipX*this.scale,m=p*d+u*h+i.y*this.scale,g=this.bltDmg*(e.ds||1),v=this.bombDmg*(e.ds||1),y=e.deg2||0,b=this.game.eventMgr.compute(this,"shotEvent",n+f,o+m,r+y);b&&(s=b.critChance,c=b.n,l=b.d),(t.shot||a.shot)(this.game,t,{obj:this,x:n+f,y:o+m,deg:r+y,team:this.team,bltDmg:g,bombDmg:v,critChance:s,n:c,d:l,moveSpdX:this.getSpdX(),heatOver:this.isHeatOver()}),e.effect&&this.game.callEffect(e.effect,this.avatar,f,m,r),e.sound&&this.game.playEffect(e.sound,null,e.volume),this.bltMax>0&&(this.bltCt-=1)},resetAttack:function(){this.attackAction&&(this.attackIndex=0,this.attackTimer=0,this.atkFadeTimer=.1,this.avatar.refresh(.1,!0))},stopAttack:function(){if(this.autoAttack&&!this.getFlag(NO_ATTACK)){this.attackIndex=0;var e=this.attackSequence[0];void 0!==e.ani?(this.attackPlay=e.ani,this.attackPlay&&this.avatar.refresh(.1,!0)):(this.attackPlay=1,this.avatar.refresh(.1,!0)),this.attack(),this.avatar.refresh(ZERO,!0)}else this.clearAttack()},clearAttack:function(){this.attackMoveLock=1,this.attackRttLock=1,this.attackAction=!1,this.attackPlay=0,this.avatar.refresh(.1,!0),this.stopAttackSound()},startAttackSound:function(){var e=this.attackSound;e&&void 0===this.attackAudio&&(this.attackAudio=this.game.playEffect(e,!0,this.attackVolume))},stopAttackSound:function(){void 0!==this.attackAudio&&(cc.audioEngine.stop(this.attackAudio),delete this.attackAudio)},callReload:function(){if(!this.getFlag(NO_ATTACK)){this.reloadAction=!0,cc.log("callReload"),this.reloadTimer=this.bltReload,this.attackAction&&this.clearAttack(),this.avatar.refresh(.1,!0);var e=this.define.reloadEffect;e&&this.game.callEffect(e,this.avatar,0,0,0)}},callAutoAttack:function(e){this.autoAttack=e},callMove:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),!this.getFlag(NO_MOVE)&&(this.moveScaleX!=e||this.moveScaleY!=t)){this.moveScaleX=e,this.moveScaleY=t;var i=0!==e||0!==t;this.fixedFlipX||(this.flipX=e>0?1:-1),this.moveAction!=i?(this.moveAction=i,this.moveIndex=-1,this.moveOffset=0,this.moveTime=0,this.moveTimer=0,this.avatar.refresh(.1)):this.avatar.refresh()}},updateMove:function(e){if((this.isFly()||this.landed)&&!this.getFlag(NO_MOVE)){if(!this.moveAction)return this._physic_vx=0,void(this._physic_vy=0);var t=this.moveSpd;if(this._physic_vx=t*this.moveScaleX,this._physic_vy=t*this.moveScaleY,this.moveSequence){var i=c_abs(this.moveScaleX*this.moveSpd*this.moveScale);if(this.moveTimer-=e*i,this.moveTimer<=0){var a=this.moveSequence;this.moveIndex<a.length-1?this.moveIndex+=1:this.moveIndex=0;var n=a[this.moveIndex].t;this.moveTime=n,this.moveTimer+=n,this.moveSeqY0=a[this.moveIndex].y,this.moveSeqY1=a[this.moveIndex<a.length-1?this.moveIndex+1:0].y}if(this.moveTime){var o=this.moveTimer/this.moveTime,r=this.moveSeqY1+(this.moveSeqY0-this.moveSeqY1)*o;if(this.slotsList)for(var s in this.slotsList)this.slotsList[s].moveOffset=r}}}},callRotate:function(e){e||0===e?(this.rotateAction=!0,this.targetDeg=this.getDegInRange(e-this._deg)):this.rotateAction&&(this.rotateAction=!1)},updateRotate:function(e){if(this.rotateAction&&!this.getFlag(NO_ROTATE)){var t=this.rttSpd,i=this.targetDeg,a=c_includeDegree(i,this._attackDeg);if(c_abs(a)<1)this._attackDeg=i,this.rotateAction=!1;else{var n=c_clamp(a*t*e*.3,-t,t);c_abs(n)>c_abs(a)&&(n=a),this._attackDeg=(this._attackDeg+n+360)%360}}},callSkill:function(e,t,i,a){if(!this.isDead()){var n=this.skills[e];n&&(t==BTN_DOWN?n.call(!0,i,a):t==BTN_CLICK?(n.call(!0,i,a),n.call(!1,i,a)):n.call(!1,i,a))}},getSkillCDPercent:function(e){var t=this.skills[e];if(t)return t.cdTimer/t.maxCDTimer},setSkillCDPercent:function(e,t){var i=this.skills[e];i&&i.refreshCdTimer(t*i.maxCDTimer)},updateSkills:function(e){for(var t=0;t<this.skills.length;t++)this.skills[t].updateLogic(e)},updateLogic:function(e){this.pilot.updateLogic(e),this.updateDeath(e),this.updateAttack(e),this.updateRotate(e),this.updateMove(e),this.updateSkills(e),this.updatePhysics(e),this.updateMoveOffset(e)},updateRender:function(e){this.avatar.updateRender(e)},onHeal:function(e,t){if(!this.isDead()&&!this.noHeal){var i=this.game;if(i.eventMgr.check(this,"preHealEvent",e,t))return!0;var a=e.getCritChance();if(a&&a>i.c_rnd(0,1)){t*=e.getCritBonus()||1.5;var n=!0}t*=this.healScale,i.callEffect(EFFECT.healNum,e,this,t,n),this.hp+t>=this.hpMax?(t=this.hpMax-this.hp,this.hp=this.hpMax):this.hp+=t,window.StatsTracker&&t>0&&StatsTracker.trackHPRecovery(t),i.eventMgr.on(this,"healEvent",e,t)}},onHurt:function(e,t,i,a){if(!this.isDead()&&!this.getFlag(NO_HURT)){var n=this.game,o=n.eventMgr;if((t=o.compute(this,"preHurtEvent",e,t,i))>0){var r=e.getCritChance();if((r+=this.getCritSufferChance())&&r>n.c_rnd(0,1)){t*=e.getCritBonus()||1.5;var s=!0}var c=this.armorType,l=this.mobType;if(a!==DMG_TYPE.crash&&a!==DMG_TYPE.platform&&(t*=e.getAtkScale(this,i,c,l)),t*=this.hurtScale,i&&(c&&(t*=DMG_SCALE[i][c]),l&&(t*=DMG_SCALE[i][l])),a){var d=this.hurtScaleTable[a];void 0!==d&&(t*=d)}t*=this.armorRate;var h=e.heatOver;if(h&&(t*=e.getCaster().getHeatScale()),this.hp-=t,this.hurtNum=t,o.check(this,"hurtEvent",e,t,i))return void n.callEffect(EFFECT.hurtNum,e,this,t,s,a);if(n.eventMgr.on(e.getOwner(),"hitEvent",this,t,i,a),this.attachedSlot&&this.attachedSlot.onHurt(e,t,i,a),this.undead&&this.hp<=0&&(this.hp=1),this.hp<=0?(this.callDeath(e,t,i,a),n.callEffect(EFFECT.hurtDeathNum,e,this,t,s,a,h)):n.callEffect(EFFECT.hurtNum,e,this,t,s,a,h),n.levelMgr.calculateDamageStat(this,e,t),window.StatsTracker&&t>0){var u=i;i&&"number"!=typeof i||(e&&e.config&&e.config.obj&&e.config.obj.unitType?i=e.config.obj.unitType:e&&e.obj&&e.obj.unitType?i=e.obj.unitType:e&&e.weapon?i=e.weapon:e&&e.backpack&&e.backpack.weapon?i=e.backpack.weapon:e&&e.define&&e.define.category?i=e.define.category.split("_")[0]:e&&e.define&&e.define.weaponType?i=e.define.weaponType:e&&e.define&&e.define.name&&(i=e.define.name)),3===i||"3"===i?i=e&&e.obj&&"mortar"===e.obj.unitType?"mortar":e&&e.obj&&"cannon"===e.obj.unitType?"cannon":(e&&e.define&&e.define.ctor&&e.define.ctor.name,"mortar"):6===i||"6"===i?i="firethrower":7===i||"7"===i?i="cannon":"number"!=typeof i&&isNaN(parseInt(i))||(i=null),i?StatsTracker.trackDamage(i,t):cc.log("[Entity] Could not detect weapon type - original:",u,"attacker:",e)}}}},callDrop:function(){this.game.config.train||1==this.team&&this.game.levelMgr.tryGetExp(this)},updateDeath:function(e){this.deathAction?this.removeTimer>0&&(this.armorType!=ARMOR_TYPE.human||this.machineFlag||this.landed&&this._physic_vr&&this._physic_vy<=0&&(this.avatar.setForcedAnime(Math.random()<.5||this.onFire?"dead":"dead2",1),this.avatar.refresh(.03,!0,!0),this.deg=0,this._physic_vr=0),this.removeTimer-=e,this.removeTimer<=0&&this.remove()):this.lifeTimer&&this.lifeTimer>0&&(this.lifeTimer-=e,this.lifeTimer<=0&&this.callDeath(this))},callDeath:function(e,t,i,a){if(!this.deathAction){var n=this.game,o=this.define;if(this.hp=0,this.fly=!1,this.deathAction=!0,this.removeTimer=o.removeTime||2,this.clearBuff(),this.skills)for(var r in this.skills)this.skills[r].interrupt(),this.skills[r].froze(!0);this.setFlag(NO_ATTACK,!0),this.setFlag(NO_MOVE,!0),this.setFlag(NO_ROTATE,!0),this.setFlag(NO_ENTITY,!0),this.updateGround();var s=this.avatar;s.setForcedAnime(s.deathAnime0,1,0,1),s.refresh(.3,!0,!0),"tt"!=CH&&this.armorType==ARMOR_TYPE.human&&a===DMG_TYPE.fire&&n.callEffect(EFFECT.deathFire,s,0);var c=o.deathEffect||EFFECT.deathSplash,l=o.fadeEffect||EFFECT.deathFade;if(n.callEffect(c,s,0),n.callEffect(l,s,0),this.callDrop(0),n.playEffect(this.define.deathSound),this.slotsList){for(var d in this.slotsList)this.slotsList[d].callDeath(e,t,i,a);this.slotsList=null}this.attachedSlot&&this.attachedSlot.releaseUnit(this),this.armorType!=ARMOR_TYPE.human||this.machineFlag||(this.avatar.setForcedAnime("fly",1),this.avatar.refresh(.03,!0,!0),this.vx?this._physic_vr=-this.vx:this._physic_vr=300*this.flipX),o.deathCb&&o.deathCb.call(this,e),n.eventMgr.check(this,"deathEvent",e,t,i),n.eventMgr.on(e.getOwner(),"killEvent",this,t,i),window.TaskManager&&(!this.config||this.config.me||this.armorType!==ARMOR_TYPE.machine&&this.armorType!==ARMOR_TYPE.human||(this.bossFlag||this.define&&this.define.boss?(console.log("[Task] \u2713 Kill boss:",this.define?this.define.name:"unknown","- task_11 +1"),window.TaskManager.updateProgress("task_11",1)):window.TaskManager.updateProgress("task_10",1)))}this.explosion()},onRevive:function(e,t){if(this.deathAction){if(this.deathAction=!1,this.setFlag(NO_ATTACK,!1),this.setFlag(NO_MOVE,!1),this.setFlag(NO_ROTATE,!1),this.setFlag(NO_ENTITY,!1),this.avatar.setForcedAnime(),this.avatar.refresh(.5),this.onHeal(e,t),this.skills)for(var i in this.skills)this.skills[i].reset();this.deg=0,this._physic_vr=0}},onSlotIn:function(e){this.attachedSlot=e,this.setFlag(NO_MOVE,!0),this.avatar.refresh(.1,!0)},onSlotOut:function(){this.updateGround(),this.attachedSlot=null,this.setFlag(NO_MOVE,!1)},explosion:function(){var e=this.define.bomb;if(e&&!this.explosive){this.explosive=!0;var t=e.r1,i=e.r0,a=e.kb,n=this.getPositionX(),o=this.getPositionY(),r=this.team,s=this.bombDmg||e.dmg0,c=(e.dmg1-e.dmg0)/e.dmg0,l=e.buff,d=this.game.contactMgr.getContactList(),h={};for(var u in d){var p=d[u],f=p.getEntity();if(p._activeContact&&f.isInBorder()&&f.team!==r){var m;if((m=f.getBase?f.getBase().uniqueID:f.uniqueID)&&h[m])continue;var g=p.hitRadius+t,v=n-p.getPositionX(),y=o-p.getPositionY(),b=v*v+y*y;if(b<=g*g){var k=c_sqrt(b)+.1;if(k<=i)f.onHurt(this,s,e.weaponType,e.dmgType);else{var T=s*(1+c*(k-i)/(g-i));f.onHurt(this,T,e.weaponType,e.dmgType)}l&&f.addBuff(this,l);var _=a/(k*f.weight);f.onKnockback(-v*_,-y*_)}m&&(h[m]=!0)}}e.effect?this.game.callEffect(e.effect,n,o,t,0):this.game.callEffect(EFFECT.bomb,n,o,t,0)}},isDead:function(){return this.deathAction},onContact:function(){},remove:function(){if(!this.removed){this.removed=!0,this.stopAttackSound();var e=this.game;for(var t in this.clearBuff(),this.skills)this.skills[t].remove();this.attachedSlot&&this.attachedSlot.releaseUnit(this),e.removeUpdate(this),e.removeRender(this),e.contactMgr.removeEntity(this);var i=this.shapes;if(i){for(var a in i)e.contactMgr.removeEntity(i[a]);this.shapes=[]}this.avatar.remove(),this.pilot.remove(),delete this.avatar,delete this.pilot,e.eventMgr.on(this,"removeEvent")}},setPositionX:function(e){this._x=e},setPositionY:function(e){this._y=e},getPositionX:function(){return this._x},getPositionY:function(){return this._y},getPosition:function(){return cc.v2(this.x,this.y)},setDegree:function(e){this._deg=e},getDegree:function(){return this._deg},getDegInRange:function(e){var t=this.define.attackAngle;if(t&&(e||0===e)){var i=t[0],a=t[1];if(this.flipX>0){if(e>180){if(e<i+360)return i+360}else if(e>a)return a}else{if(e<180-a)return 180-a;if(e>180-i)return 180-i}}return e},setAttackDeg:function(e){this._attackDeg=this.getDegInRange(e-this._deg)},isInBorder:function(){return this._inBorder},initSlots:function(){var e=this.game,t=this.define.slots;if(t)for(var i in this.slotsList=[],t){var a=t[i],n=new(a.ctor||o);n.init(e,a,{obj:this}),this.slotsList.push(n)}},initPhysics:function(){this._physic_vr=0,this._physic_vx=0,this._physic_vy=0,this._physic_g=-2e3,this._physic_damp_vx=.8,this._physic_bounce=0,this.define.float&&(this._physic_float_t=0,this._physic_float_y=0,this._physic_float_h=100,this._physic_float_s=1),this.updateGround(),this.checkIsInBorder()},applyVelocity:function(e,t){this.machineFlag||this.vehicleFlag||(this._physic_vx+=e,this._physic_vy+=t,this.landed=!1)},updateGround:function(){this.isDead()?this.ground=this.game.contactMgr.findGround(this._x,this._y,this.groundIndex):this.ground=this.game.contactMgr.findPlatform(this._x,this._y,this.groundIndex)},updatePhysics:function(e){var t,i=this._physic_vx*e,a=this._physic_vy*e,n=this.attachedSlot;if(n||(n=this.ground,(i<0&&this._x+i<n.getGroundLeft()||i>0&&this._x+i>n.getGroundRight())&&(this.updateGround(),n=this.ground)),t=n.getGroundLine(this.x)+this.height,this._deg=(this._deg+this._physic_vr*e+360)%360,!this._ignoreGround&&a<=0&&this._y+a<=t)this.landed=!0,a=t-this._y,this._physic_vy*=this._physic_bounce,this._physic_vx*=this._physic_damp_vx;else if(this.landed=!1,this.isFly()){var o=this._physic_float_h;if(o){this._physic_float_t+=e;var r=this._physic_float_s,s=c_sin(this._physic_float_t*r)*o;a+=s-this._physic_float_y,this._physic_float_y=s}}else this._physic_vy+=this._physic_g*e;this._dx+=i,this._dy+=a},applyMoveOffset:function(e,t){this._dx+=e,this._dy+=t},getMoveSpdX:function(){return this.moveSpd*this.moveScaleX},getSpdX:function(){return this._spdX},updateMoveOffset:function(e){var t=this._dx,i=this._dy;this._x+=t,this._y+=i;var a=this.slotsList;if(a)for(var n in a)a[n].updateOffset(e,t,i);this._spdX=this._dx/e,this._spdY=this._dy/e,this._dx=0,this._dy=0,this.checkIsInBorder()},checkIsInBorder:function(){if(1==this.team){var e=this.game.levelMgr.cameraX,t=c_abs(this._x-e),i=360/GAME_VIEW_SCALE+this.radius,a=t<i;this._inBorder=a,this._inDone=this._inDone||a,this._inDone&&t>i+this.outRange&&this.remove()}},isFly:function(){return this.fly},getEntity:function(){return this},createShape:function(e){var t=e.x,i=e.y,a=e.radius,n=this,o={uniqueID:-this.uniqueID,get x(){return n.x+t},get y(){return n.y+i},getPositionX:function(){return n.x+t},getPositionY:function(){return n.y+i},isInBorder:function(){return n.isInBorder()},radius:a,hitRadius:a,getEntity:function(){return n}};return this.game.contactMgr.addEntity(o),o}}),cc._RF.pop()},{"../../components/Slot":"Slot","../../components/attributes/Attribute":"Attribute","../../components/combat/buffs/Buff":"Buff","../../entities/projectiles/Bullet":"Bullet","./Proto":"Proto"}],EquipmentEncoder:[function(e,t){"use strict";cc._RF.push(t,"4dcae9rS9xJJ7GvKihvF+ei","EquipmentEncoder"),window.EquipmentEncoder={equipmentMap:{sniper:"snip",machinegun:"magun",machine_gun:"magun",firethrower:"fla",mortar:"roc",bouncingball:"ball",bouncing_ball:"ball",cannon:"can",laser:"laser",tesla:"tesla",flyshield:"arrow",fly_shield:"arrow",armor:"arm",heal:"heal",fueltank:"fuel",fuel_tank:"fuel",energybarrier:"matrix",energy_barrier:"matrix"},reverseMap:null,initReverseMap:function(){if(!this.reverseMap)for(var e in this.reverseMap={},this.equipmentMap)this.reverseMap[this.equipmentMap[e]]=e},getShortId:function(e){if(!e)return"";var t={b:"magun",b_2:"magun",b_3:"magun",b_4:"magun",d:"fla",d_2:"fla",d_3:"fla",d_4:"fla",c:"can",c_2:"can",c_3:"can",c_4:"can",laser:"laser",tesla:"tesla",snip:"snip",roc:"roc",ball:"ball",arrow:"arrow",arm:"arm",heal:"heal",fuel:"fuel",matrix:"matrix"};if(t[e])return console.log("[EquipmentEncoder] Mapping single-letter ID:",e,"->",t[e]),t[e];var i=e.toLowerCase(),a=i.replace(/\d+$/,"");if(t[a])return t[a];if(this.equipmentMap[a])return this.equipmentMap[a];if(this.equipmentMap[i])return this.equipmentMap[i];var n={energy_barrier:"matrix",energyBarrier:"matrix",energybarrier:"matrix",barrier:"matrix",laser:"laser",tesla:"tesla",mortar:"roc",cannon:"can",fly_shield:"arrow",flyshield:"arrow",flyShield:"arrow",machine_gun:"magun",machinegun:"magun",machineGun:"magun",firethrower:"fla",fire_thrower:"fla",fire:"fla",sniper:"snip",bouncing_ball:"ball",bouncingball:"ball",bouncingBall:"ball",fueltank:"fuel",fuelTank:"fuel",fuel_tank:"fuel",armor:"arm",heal:"heal"};if(n[a])return n[a];if(n[i])return n[i];if(n[e])return n[e];var o=a.substr(0,4);return"cann"===o?"can":"fire"===o?"fla":"mach"===o?"magun":"boun"===o?"ball":"lase"===o?"laser":"tesl"===o?"tesla":"mort"===o?"roc":"armo"===o?"arm":"ener"===o?"matrix":"fuel"===o?"fuel":"snip"===o?"snip":o},getFullName:function(e){return this.initReverseMap(),this.reverseMap[e]||e},encodeEquipment:function(e,t){if(!e||!Array.isArray(e)||0===e.length)return"";void 0===t&&(t=!0);for(var i={},a=0;a<e.length;a++){var n=e[a];if(n&&n.id){var o=this.getShortId(n.id),r=n.level||1,s=n.rarity||1;r<1&&(r=1),i[l=t?r+"_"+o:o]||(i[l]={level:r,shortId:o,rarities:[]}),i[l].rarities.push(s)}}var c=[];for(var l in i){var d=i[l],h=d.rarities.length;if(0!==h)if(h&&!isNaN(h))if(d.rarities.sort(function(e,t){return e-t}),h>9)for(console.warn("[EquipmentEncoder] Quantity exceeds 9 for",d.shortId,"- splitting");d.rarities.length>0;){var u=d.rarities.splice(0,9),p=u.length,f=u.join("");t?c.push(String(d.level)+String(p)+d.shortId+f):c.push(String(p)+d.shortId+f)}else if(f=d.rarities.join(""),t){var m=String(d.level)+String(h)+d.shortId+f;d.level>=10&&console.log("[EquipmentEncoder] Encoding high level item:",{level:d.level,quantity:h,shortId:d.shortId,rarities:f,result:m}),c.push(m)}else c.push(h+d.shortId+f);else console.error("[EquipmentEncoder] Invalid quantity:",h,"for group:",d)}return c.join("_")},decodeEquipment:function(e){if(!e||"string"!=typeof e)return[];this.initReverseMap();for(var t=[],i=e.split("_"),a=0;a<i.length;a++){var n=i[a];if(n){for(var o,r,s,c=1,l=null,d=-1,h=["matrix"],u=0;u<h.length;u++){var p=h[u];if((v=n.indexOf(p))>=0&&v<=3){l=p,d=v;break}}if(!l){var f=["magun","arrow","laser","tesla"];for(u=0;u<f.length;u++)if(p=f[u],(v=n.indexOf(p))>=0&&v<=3){l=p,d=v;break}}if(!l){var m=["snip","ball","heal","fuel"];for(u=0;u<m.length;u++)if(p=m[u],(v=n.indexOf(p))>=0&&v<=3){l=p,d=v;break}}if(!l){var g=["fla","roc","can","arm"];for(u=0;u<g.length;u++){var v;if(p=g[u],(v=n.indexOf(p))>=0&&v<=3){l=p,d=v;break}}}if(l)if(r=l,d>=2){var y=n.substring(0,d);y.length>=2?(c=parseInt(y.substring(0,y.length-1))||1,o=parseInt(y[y.length-1])||1):(c=1,o=parseInt(y)||1),s=d+r.length}else if(1===d)o=parseInt(n[0])||1,s=1+r.length;else{if(0!==d){console.warn("[EquipmentEncoder] Unexpected format:",n);continue}o=1,s=r.length}else n.length>5&&!isNaN(n[0])&&!isNaN(n[1])&&isNaN(n[5])?(c=parseInt(n[0])||1,o=parseInt(n[1])||1,r=n.substr(2,4),s=6):(o=parseInt(n[0])||1,r=n.substr(1,4),s=5);var b=n.substr(s),k=[];for(u=0;u<b.length;u++){var T=parseInt(b[u]);isNaN(T)||k.push(T)}for(;k.length<o;)k.push(1);var _=this.getFullName(r);for(u=0;u<o;u++)t.push({id:_,level:c,rarity:k[u]||1})}}return t},encodeCurrentEquipment:function(e){if(!e)return"";var t=[],i=e.tank||e.towers||[];if(!Array.isArray(i)&&"object"==typeof i){var a=[];for(var n in i)i[n]&&a.push(i[n]);i=a}for(var o=0;o<i.length;o++){var r=i[o];if(r){var s=r.weapon||r.unitType||r.backpack&&r.backpack.id||r.id,c=r.weaponLvl||r.weaponLevel||r.level||r.lvl||r.upgrade||1,l=r.rarity;if(!l&&s){var d=s.match(/^(.+?)(\d+)$/);if(d){var h=parseInt(d[2]);if(h>=1&&h<=6){l=h;var u=d[1];u.endsWith("_")&&(u=u.slice(0,-1)),s=u}}}l||(l=1),s&&t.push({id:s,level:c,rarity:l})}}return this.encodeEquipment(t,!0)}},void 0!==t&&t.exports&&(t.exports=EquipmentEncoder),cc._RF.pop()},{}],EquipmentPageDisassemble:[function(e,t){"use strict";cc._RF.push(t,"39c45A7iZhEeo08eoirED1p","EquipmentPageDisassemble"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{equipmentCardNode:cc.Node,equipmentCardNode2:cc.Node,itemLayoutNode:cc.Node,itemPrefab:cc.Prefab,itemNode:cc.Node},onLoad:function(){this.waitOnClose()},start:function(){},initStatus:function(e){this.fromCard=e.fromCard,this.equipmentId=e.id,this.equipmentData=e.data,this.reward=equipment.getDisassembleItems(this.equipmentId),this.equipmentCardNode.getComponent("EquipmentPageItem").initStatus(e.id,e.data,null,!0),this.equipmentCardNode2.getComponent("EquipmentPageItem").initStatus(e.id,{lvl:1,exp:e.data.exp+this.reward[1].n},null,!0),cc.log("EquipmentPageDisassemble reward",this.reward),this.initItems()},initItems:function(){if(this.itemList)for(var e in this.itemList)this.itemList[e].destroy();this.itemList=[];var t=this.reward;if(t)for(var e in t)this.addItem(t[e])},addItem:function(e){var t=cc.instantiate(this.itemNode);t.active=!0,this.itemLayoutNode.addChild(t);var i=cc.instantiate(this.itemPrefab);t.addChild(i,-1),t.itemNode=i;var a=i.getComponent("Item");return a.init(e),t.model=a.model,t.itemCfg=e,this.itemList.push(t),t},disassemble:function(){var e=this;sdk.useFree("reset_item",function(t){t||equipment.disassemble(e.equipmentId,function(){e.close(),menuManager.close(),e.fromCard&&e.fromCard.initStatus(e.equipmentId,equipment.getItem(e.equipmentId),e.fromCard.menu),YMTJ("video","reset")})})}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],EquipmentPageItemInfo:[function(e,t){"use strict";cc._RF.push(t,"2a99bmL/zpNq7ZT3f76jZOJ","EquipmentPageItemInfo");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{equipmentCardNode:cc.Node,statInfoNode:cc.Node,talentLayoutNode:cc.Node,talentFrameInstance:cc.Node,talentBgSpriteFrames:[cc.SpriteFrame],unlockChapterLabel:cc.Label,upgradeBtnNode:cc.Node,disassembleNode:cc.Node,btnClose:cc.Node},onLoad:function(){this.waitOnClose()},start:function(){this.updateGuide()},initStatus:function(e){this.fromCard=e.fromCard,this.equipmentId=e.id,this.equipmentData=e.data,this.equipmentCardNode.getComponent("EquipmentPageItem").initStatus(e.id,e.data,null,!0),this.statInfoNode.getComponent("BackpackItemStatInfo").initStatus({id:this.equipmentId,data:e.data,showBonus:1}),this.initTalent(),this.updateUpgradeBtn(),this.updateDisassembleBtn()},updateDisassembleBtn:function(){var e=this.equipmentData&&this.equipmentData.lvl;this.disassembleNode.active=e>1},updateUpgradeBtn:function(){if(this.upgradeBtnNode.active=!!this.equipmentData,equipment.isUpgradeLvlMax(this.equipmentId)&&(this.upgradeBtnNode.active=!1),this.upgradeBtnNode.active){var e=equipment.getCost(this.equipmentId);cc.log("updateUpgradeBtn",this.equipmentId,e),this.upgradeBtnNode.getChildByName("cost").getComponent(cc.Label).string=e||0;var t=money.had(GOLD,equipment.getCost(this.equipmentId));this.upgradeBtnNode.getChildByName("cost").color=t&&cc.color(255,255,255)||cc.color(255,0,0);var i=H5VERSION||equipment.canAffordUpgradeCost(this.equipmentId);this.setGray(this.upgradeBtnNode,!i)}var a=EquipmentDefine[this.equipmentId];a.unlock7D?this.unlockChapterLabel.string=LI("tip_unlock_7D"):a.unlockProgression?this.unlockChapterLabel.string=LI("tip_unlock_progress"):this.unlockChapterLabel.string=LI("unlock_0")},lateUpdate:function(){this.inited||(this.inited=!0)},initTalent:function(){var e=EquipmentDefine[this.equipmentId].talent;for(var t in cc.log("EquipmentPageItemInfo initTalent list",this.equipmentId,e),e){var i=Talent.getInfo(e[t].id),a=cc.instantiate(this.talentFrameInstance);cc.log("EquipmentPageItemInfo initTalent instantiate",t,e[t].id,i),a.active=!0,a.define=e[t],this.talentLayoutNode.addChild(a),a.getChildByName("bg").getComponent(cc.Sprite).spriteFrame=this.talentBgSpriteFrames[(i.rarity||1)-1];var n=menuManager.createSprite(0,0,i.iconImgPath);a.getChildByName("bg").getChildByName("icon").addChild(n),a.getChildByName("bg").getChildByName("icon").sprite=n,a.getChildByName("des").getComponent(cc.RichText).string="<outline color=black width=2>"+i.des+"</outline>",a.getChildByName("block_node").active=!1}cc.log("[StatsCalculator]  Equipment Page item info",e),this.updateUnlock()},updateUnlock:function(){var e=this.talentLayoutNode.children;for(var t in e){var i=e[t],a=i.define;if(a){var n=Talent.getInfo(a.id),o=this.equipmentData&&this.equipmentData.lvl;if(cc.log("talent checkUnlock",o,a.unlockLvl),o&&o>=a.unlockLvl)this.setGray(i.getChildByName("bg"),!1),this.setGray(i.getChildByName("bg").getChildByName("icon").sprite,!1),i.getChildByName("des").getComponent(cc.RichText).string="<outline color=black width=2>"+n.des+"</outline>",i.getChildByName("block_node").active=!1;else{i.color=cc.color(128,128,128),this.setGray(i.getChildByName("bg"),!0),this.setGray(i.getChildByName("bg").getChildByName("icon").sprite,!0);var r=i.getChildByName("des").getComponent(cc.RichText);r.string="<outline color=black width=2>"+LI("unlock_lvn",{n:a.unlockLvl})+" "+n.des+"</outline>";var s=i.getChildByName("block_node");s.active=!0;var c=s.getComponentInChildren(cc.RichText);console.log(c),c.string="<outline color=black width=2>"+LI("unlock_lvn",{n:a.unlockLvl})+"</outline>",c.node.setPosition(new cc.Vec3(c.node.x,r.node.height/2-c.node.height/2,c.node.z))}}}},upgradeItem:function(e){var t,a,n,o=this;this.guideUnlock&&user.setGuide("talent",1);var r=equipment.getCost(this.equipmentId);if(!money.check(GOLD,r)){var s;if(H5VERSION)s=0;else{if(!equipment.canAffordUpgradeCost(this.equipmentId))return void kit.info(LI("tip_equip1"));s=equipment.getExpCost(this.equipmentId)}var c=equipment.upgrade(this.equipmentId,!!H5VERSION);net.updateData({price:{i:GOLD,n:r},set:(t={},t[EQUIPMENT+".lvl_"+this.equipmentId]=c.lvl,t),add:(a={},a[EQUIPMENT+"."+this.equipmentId]=-s,a),min:(n={},n[EQUIPMENT+"."+this.equipmentId]=s,n)},function(t,a){i.FirebaseTracking.setDataBiRes("UpgradeEquipment"),money.update(a),cc.log("EquipmentPageItemInfo upgradeItem updateData",a,c.lvl,r),cc.game.emit("use_money",{pos:e.target.convertToWorldSpaceAR(cc.v2(0,0)),tid:"rename",i:GOLD,n:-r}),c&&(o.equipmentData=c,o.equipmentCardNode.getComponent("EquipmentPageItem").initStatus(o.equipmentId,o.equipmentData,null,!0),o.statInfoNode.getComponent("BackpackItemStatInfo").initStatus({data:o.equipmentData,id:o.equipmentId}),o.updateUnlock(),o.fromCard&&o.fromCard.initStatus(o.equipmentId,o.equipmentData,o.fromCard.menu),o.updateUpgradeBtn(),o.updateDisassembleBtn(),window.TaskManager&&window.TaskManager.completeTask("task_0"))})}},updateGuide:function(){var e,t=this;null!=(e=this.fromCard)&&e.isGuilding&&(this.fromCard.isGuilding=!1,this.guideUnlock=!0,this.upgradeBtnNode.active?menuManager.focusOn(this.upgradeBtnNode,LI("zc_guide_14"),function(){i.FirebaseTracking.logNewTutorial({Step:6,userID:user.uuid,Status:1}),user.setGuide("talent",1),YMTJ("guide","guide014"),menuManager.focusOn(t.btnClose,null,function(){t.clickClose()})},null,null,{head:"h99"}):user.setGuide("talent",1))},clickClose:function(){var e=this.fromCard;this.guideUnlock&&menuManager.focusOn(this.fromCard.menu.lockedLayoutNode,LI("zc_guide_15"),3,function(){e.menu.node.parent.parent.getComponent("Menu").guideStartGame(),YMTJ("guide","guide015")},null,{noTouch:1,noFinger:1,dx:-100}),this.close()},disassemble:function(){menuManager.pop("equipment_disassemble",{id:this.equipmentId,data:this.equipmentData,fromCard:this.fromCard})},stripRichTextTags:function(e){return e.replace(/<[^>]+>/g,"")}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],EquipmentPageItem:[function(e,t){"use strict";cc._RF.push(t,"7d94aw9AcNHEabggU+wh8Xc","EquipmentPageItem"),cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,lvlLabel:cc.Label,progressLabel:cc.Label,progressNodeCanUpgrade:cc.Node,progressNodeCantUpgrade:cc.Node,canUpgradeIconNode:cc.Node,cantUpgradeIconNode:cc.Node,shapeNode:cc.Node,shapeInstance:cc.Node,itemIconNode:cc.Node,expandBoard:cc.Node,equipLabel:cc.Label,bgNode:cc.Node,bgSpriteFrames:[cc.SpriteFrame],expandSpriteFrames:[cc.SpriteFrame],progressNode:cc.Node,grayMaterial:cc.Material},onLoad:function(){this.isLocked=void 0},initStatus:function(e,t,i,a){var n=BackpackItemDefine[e];this.onlyShow=a,this.equipmentId=e,this.equipmentData=t,cc.log("EquipmentPageItem initStatus",e,t,n),console.log("EquipmentPageItem initStatus","this.equipmentData",this.equipmentData,"this.equipmentId",this.equipmentId),this.menu=i,this.backpackDefine=n,this.equipmentDefine=EquipmentDefine[e],n&&n.name?this.nameLabel.string=n.name:(this.nameLabel.string=e||"Unknown",console.warn("BackpackItemDefine not found for equipment:",e)),n&&(this.initShapeNode(n),this.updateBg(n)),this.updateIcon(e),this.updateInfo(t),t?(console.log("EquipmentPageItem initStatus","this.isLocked",this.isLocked,null!=this.isLocked),null==this.isLocked||this.isEquipped||(this.setUnlock(),this.updateInfo(t))):(console.log("EquipmentPageItem initStatus","setLock",t,e),this.setLocked())},initShapeNode:function(e){if(!this.shapeNode.shapeInited){var t=e.shape,i=0,a=0,n=0,o=0;for(var r in t){var s=cc.instantiate(this.shapeInstance);s.active=!0,+t[r][0]<i&&(i=+t[r][0]),+t[r][0]>a&&(a=+t[r][0]),+t[r][1]<o&&(o=+t[r][1]),+t[r][1]>n&&(n=+t[r][1]),s.x=10*t[r][0],s.y=10*t[r][1],this.shapeNode.addChild(s)}this.shapeNode.x+=-(a+i)/2*10,this.shapeNode.y+=-(n+o)/2*10,this.shapeNode.shapeInited=!0}},updateBg:function(){var e=this.equipmentDefine.rarity&&this.equipmentDefine.rarity-1||0;this.bgNode.getComponent(cc.Sprite).spriteFrame=this.bgSpriteFrames[e],this.expandBoard.getComponent(cc.Sprite).spriteFrame=this.expandSpriteFrames[e]},updateInfo:function(e){var t=equipment.getExpCost(this.equipmentId,this.equipmentData&&this.equipmentData.lvl||1)||0,i=(null==e?void 0:e.exp)||0,a=equipment.isUpgradeLvlMax(this.equipmentId);this.lvlLabel.string=LI("lv")+" "+((null==e?void 0:e.lvl)||1),this.progressLabel.string=a&&LI("level_max")||i+"/"+t,this.canUpgradeIconNode.active=!a&&i>=t,this.canUpgradeIconNode.active&&(this.canUpgradeIconNode.stopAllActions(),this.canUpgradeIconNode.y=0,this.canUpgradeIconNode.runAction(cc.sequence(cc.moveBy(.5,cc.v2(0,5)),cc.moveBy(.5,cc.v2(0,-5))).easing(cc.easeInOut(2)).repeatForever())),this.cantUpgradeIconNode.active=!a&&i<t,this.progressNodeCanUpgrade.active=i>=t,this.progressNodeCantUpgrade.active=i<t,this.progressNodeCanUpgrade.oWidth=this.progressNodeCanUpgrade.oWidth||this.progressNodeCanUpgrade.width;var n=t&&i/t||0;n>1&&(n=1),this.progressNodeCanUpgrade.width=n*this.progressNodeCanUpgrade.oWidth,this.progressNodeCantUpgrade.oWidth=this.progressNodeCantUpgrade.oWidth||this.progressNodeCantUpgrade.width,this.progressNodeCantUpgrade.width=n*this.progressNodeCantUpgrade.oWidth},updateIcon:function(e){var t,i=BackpackItemDefine[e],a=EquipmentDefine[e];if(i&&i.unitID){var n=ENTITY[i.unitID].avatar;n.frm?t=menuManager.createSprite(0,0,n.frm):n.anime&&((t=menuManager.createArmature(n.anime,n.animeName,function(){})).scale*=ANIME_SCALE)}else console.warn("BackpackItemDefine or unitID not found for equipment:",e),(t=menuManager.createSprite(0,0,""))||(t=new cc.Node);t&&(t.x=a&&a.avatarDx||0,t.y=a&&a.avatarDy||0,t.scale*=.5*(a&&a.avatarScale||1),t.anchorY=0,this.itemIconNode.display=t.armatureDisplay||t.sprite,this.itemIconNode.addChild(t))},setUnlock:function(){this.isLocked=!1,this.menu.unLock(this),this.setGray(this.node.getComponent(cc.Sprite),!1),this.setGray(this.itemIconNode.display,!1),this.progressNode.active=!0,this.lvlLabel.node.oy&&(this.lvlLabel.node.y=this.lvlLabel.node.oy),this.updateInfo(this.equipmentData);for(var e=this.shapeNode.children,t=0;t<e.length;t++){var i=e[t].getComponent(cc.Sprite);this.setGray(i,!1)}},setLocked:function(){this.isLocked=!0,this.progressNode.active=!1,console.log(!!this.equipmentDefine.unlock7D),console.log(!!this.equipmentDefine.unlockProgression),this.equipmentDefine.unlock7D?this.lvlLabel.string=LI("tip_unlock_7D"):this.equipmentDefine.unlockProgression?this.lvlLabel.string=LI("tip_unlock_progress"):this.lvlLabel.string=LI("unlock_0"),this.lvlLabel.node.oy||(this.lvlLabel.node.oy=this.lvlLabel.node.y),this.lvlLabel.node.y=this.lvlLabel.node.oy-37,this.setGray(this.node.getComponent(cc.Sprite),!0),this.setGray(this.itemIconNode.display,!0);for(var e=this.shapeNode.children,t=0;t<e.length;t++){var i=e[t].getComponent(cc.Sprite);this.setGray(i,!0)}},setGray:function(e,t){var i,a;e instanceof cc.Sprite?(i=t?"2d-gray-sprite":"2d-sprite",e.setMaterial(0,cc.Material.getBuiltinMaterial(i))):(a=t?this.grayMaterial:cc.Material.getBuiltinMaterial("2d-sprite"),e.setMaterial(0,a))},update:function(){if(this.expandBoard.active){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=this.expandBoard.parent.convertToNodeSpaceAR(e);null==this.expandBoard.ox&&(this.expandBoard.ox=this.expandBoard.x),null==this.expandBoard.oy&&(this.expandBoard.oy=this.expandBoard.y),this.expandBoard.x=t.x+this.expandBoard.ox,this.expandBoard.y=t.y+this.expandBoard.oy}},enableExpand:function(e){if(this.isExpanded=e,this.expandBoard.active=e,this.menu)if(e){this.menu.expandItem&&this.menu.expandItem!=this&&this.menu.expandItem.enableExpand(!1),this.menu.expandItem=this;var t=this.expandBoard.convertToWorldSpaceAR(cc.v2(0,0));this.expandBoard.parent=this.menu.node;var i=this.expandBoard.parent.convertToNodeSpaceAR(t);null==this.expandBoard.ox&&(this.expandBoard.ox=this.expandBoard.x),null==this.expandBoard.oy&&(this.expandBoard.oy=this.expandBoard.y),this.expandBoard.x=i.x,this.expandBoard.y=i.y,this.canUpgradeIconNode.opacity=0}else this.expandBoard.parent=this.node,null!=this.expandBoard.ox&&(this.expandBoard.x=this.expandBoard.ox),null!=this.expandBoard.oy&&(this.expandBoard.y=this.expandBoard.oy),this.canUpgradeIconNode.opacity=255},setEquipped:function(e){console.log("set Equipped ",e),this.isEquipped=e,this.equipLabel.string=this.isEquipped&&LI("unload")||LI("use")},onClick:function(){this.onlyShow||(this.isLocked?this.showInfo():(console.log(2222),this.menu&&this.menu.replaceWith==this?(console.log(22223333),this.menu.enableReplaceMode()):(console.log(5555),this.replaceMode&&this.menu?this.menu.replaceItem(this):(console.log(5555),this.enableExpand(!this.isExpanded)))))},switchEquip:function(){this.isEquipped?this.unEquip():this.onEquip()},onEquip:function(){this.menu&&this.menu.isEquipMax()?this.menu.enableReplaceMode(this):this.menu.equip(this),this.enableExpand(!1)},unEquip:function(){this.menu.unEquip(this),this.enableExpand(!1)},enableReplaceMode:function(e){this.replaceMode=e,e?this.node.runAction(cc.sequence(cc.scaleTo(.1,1.1),cc.scaleTo(.1,1),cc.delayTime(.2)).repeatForever()):(this.node.stopAllActions(),this.node.scale=1)},showInfo:function(){menuManager.pop("equipment_info",{id:this.equipmentId,data:this.equipmentData,fromCard:this}),this.enableExpand(!1)}}),cc._RF.pop()},{}],EquipmentPage:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"8b793czfXlPJZNw68Ww9yTq","EquipmentPage"),cc.Class({extends:e("../core/Menu"),properties:{currentLayoutNode:cc.Node,unlockedLayoutNode:cc.Node,lockedLayoutNode:cc.Node,equipmentItemInstance:cc.Node,scrollContentNode:cc.Node,scrollContentLayoutNode:cc.Node,equipNumLabel:cc.Label,swapNode:cc.Node,scrollNode:cc.Node,currentBgLayoutNode:cc.Node},onLoad:function(){var e;this.topVisible=((e={})[DIAMOND]=!1,e[GOLD]=!0,e[SWEEP_TICKET]=!1,e[EXP]=!1,e[ENERGY]=!1,e),equipment.checkUnlockSlotCt(!0),this.slotCt=equipment.get("slotCt"),console.log("[EquipmentPage] Slot count:",this.slotCt);var t=equipment.get("current");t&&0!==t.length||(console.warn("[EquipmentPage] No equipment found, attempting restoration..."),equipment.restoreDefaultEquipment()&&console.log("[EquipmentPage] Equipment restored successfully"));var i=equipment.get("items"),a=equipment.get("current");console.log(i,a);var n={};for(var o in a)if(a[o]&&""!==a[o]&&null!==a[o]&&void 0!==a[o]){var r=this.createEquipmentItem(a[o],i[a[o]],!0);r&&(this.currentLayoutNode.addChild(r),n[a[o]]=!0)}else console.warn("Skipping invalid equipment in current slot:",o,a[o]);for(var o in this.updateEquipNum(i),EquipmentDefine)if(i[o]){if(n[o])continue;r=this.createEquipmentItem(o,i[o]),console.log(r),r&&this.unlockedLayoutNode.addChild(r)}else(r=this.createEquipmentItem(o))&&this.lockedLayoutNode.addChild(r);this.initCurrentBgLayout(),this.scrollContentNodeInitTimer=.1},initGuide:function(){var e=equipment.get("slotCt");user.getGuide("unlockNewSlot")||2!=user.getGuide("chapter")||menuManager.focusOn(this.currentBgLayoutNode.children[e-1],LI("zc_guide_16"),3,function(){user.setGuide("unlockNewSlot",1),user.quickSave("guide.unlockNewSlot",1)})},updateEquipmentItem:function(){var e=this,t=equipment.get("items");console.log("createEquipmentItem",t);var a=function(a,n){for(var o,r=i(a);!(o=r()).done;){var s=o.value,c=s.getComponent("EquipmentPageItem");console.log("createEquipmentItem",s.equipmentId,t[s.equipmentId]),c.initStatus(s.equipmentId,t[s.equipmentId],e),c.setEquipped(n),console.log("updateChildren ",s.equipmentId,n,s.parent.name)}};a(this.currentLayoutNode.children,!0),a(this.unlockedLayoutNode.children,!1),a(this.lockedLayoutNode.children,!1)},updateByUniquenlockedLayoutNode:function(){0==this.unlockedLayoutNode.children.length&&(this.unlockedLayoutNode.height=10)},update:function(e){kit.timer(this,"save",5,e)&&equipment.checkSave(),this.scrollContentNodeInited||(this.scrollContentNodeInitTimer-=e,this.scrollContentNodeInitTimer>0||(this.scrollContentNodeInited=!0,console.log("EquipmentPage scrollContentNode",this.scrollContentNode.height)))},initCurrentBgLayout:function(){var e=equipment.get("slotCt");e!==this.slotCt&&(console.log("[EquipmentPage] initCurrentBgLayout - Updating slot count from",this.slotCt,"to",e),this.slotCt=e);var t=this.currentBgLayoutNode.children;for(var i in t)if(i<this.slotCt)t[i].getChildByName("icon").active=!1,t[i].getChildByName("label").active=!1;else{var a;a=6==i?2:4,t[i].getChildByName("label").getComponent(cc.Label).string=LI("complete_chapter_n",{n:a})}},initStatus:function(){console.log("createEquipmentItem","initStatus"),this.updateEquipmentItem()},isEquipMax:function(){var e=equipment.get("slotCt");return e!==this.slotCt&&(console.log("[EquipmentPage] Slot count changed from",this.slotCt,"to",e),this.slotCt=e),this.equipNum>=this.slotCt},updateEquipNum:function(){console.log("updateEquipNum");var e=this.currentLayoutNode.children;this.equipNum=e.length,this.equipNumLabel.string=e.length+"/"+this.slotCt},createEquipmentItem:function(e,t,i){if(!e||""===e||null==e)return console.error("Invalid equipment ID in createEquipmentItem:",e),null;var a=cc.instantiate(this.equipmentItemInstance);return a.equipmentId=e,a.equipmentData=t,a.active=!0,console.log("createEquipmentItem",e,t),a.getComponent("EquipmentPageItem").initStatus(e,t,this),a.getComponent("EquipmentPageItem").setEquipped(i),a},equip:function(e,t){console.log("equip",e,"\n",t,!this.isEquipMax());var i=null;if(!this.isEquipMax()||t){if(!(i=equipment.addCurrent(e.equipmentId)))return void console.warn("[EquipmentPage] Failed to add equipment - likely at max capacity");e.node.parent=this.currentLayoutNode,e.setEquipped(!0)}else this.enableReplaceMode(e);this.updateByUniquenlockedLayoutNode(),this.updateEquipNum(),i&&net.updateData({set:i},function(e,t){if(e)return cc.warn(e);console.log("equip update equip",t.doc),equipment.updateCurrentFromDoc(t.doc)})},unEquip:function(e){e.node.parent=this.unlockedLayoutNode,e.setEquipped(!1);var t=equipment.removeCurrent(e.equipmentId);this.updateEquipNum(),console.log("current 22",t),t?net.updateData({set:t},function(e,t){if(e)return cc.warn(e);equipment.updateCurrentFromDoc(t.doc),console.log("equip update unEquip ",t.doc)}):console.error("[EquipmentPage] unEquip failed - no update data")},unLock:function(e){e.node.parent=this.unlockedLayoutNode},onClickCancleReplaceMode:function(){this.enableReplaceMode()},enableReplaceMode:function(e){var t=this.currentLayoutNode.children;for(var i in t)t[i].getComponent("EquipmentPageItem").enableReplaceMode(!!e);this.scrollNode.active=!e,this.swapNode.active=!!e,cc.log("this.swapNode.active",this.swapNode.active),e?(e.node.x=0,e.node.y=0,e.node.parent=this.swapNode):this.replaceWith&&!this.replaceWith.isEquipped&&(this.replaceWith.node.parent=this.unlockedLayoutNode),this.replaceWith=e},replaceItem:function(e){cc.log("replaceItem"),this.unEquip(e),e.enableExpand(!1),this.equip(this.replaceWith,!0),this.enableReplaceMode(),e.enableReplaceMode(!1)},updateRedPoint:function(){var e=0,t=equipment.get("items");for(var i in console.log(t),t)if(t[i]){var a=equipment.getExpCost(i)||0;(t[i].exp||0)>=a&&e++}return cc.log("equipmentPage updateRedPoint",e),e}}),cc._RF.pop()},{"../core/Menu":"Menu"}],ErrorMenu:[function(e,t){"use strict";cc._RF.push(t,"a9ef0T64kxNZqIgrQ6tGrZe","ErrorMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{titleLabel:cc.Label,btnLabel:cc.Label,infoLabel:cc.Label},initStatus:function(e){e.title&&this.titleLabel&&(this.titleLabel.string=e.title),e.info&&this.infoLabel&&(this.infoLabel.string=e.info),e.btn&&this.btnLabel&&(this.btnLabel.string=e.btn)},onCheck:function(e,t){var i=this.args.checkCb;i&&i.call(this,t)||this.close(t)},onLoad:function(){},start:function(){}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],EventManager:[function(e,t){"use strict";cc._RF.push(t,"10122pauQdCu4QgNjUeDjG7","EventManager"),cc.Class({initMap:function(e){this.game=e,this.mapping={}},unregist:function(e,t,i){i[e.uniqueID+t]=null},regist:function(e,t,i,a){var n=e.uniqueID;if(this.mapping[n])o=this.mapping[n];else{var o={};this.mapping[n]=o}o[t]||(o[t]=[]),o[t].push(i),i[n+t]=a},on:function(e,t,i,a,n){var o=e.uniqueID,r=this.mapping[o];if(r){var s=r[t];if(s)for(var c=0,l=s.length;c<l;c++){var d=s[c];d[o+t]?d[o+t](e,i,a,n):(s.splice(c,1),c-=1,l-=1)}}},check:function(e,t,i,a,n){var o=e.uniqueID,r=this.mapping[o];if(r){var s=r[t];if(s){for(var c=!1,l=0,d=s.length;l<d;l++){var h=s[l];h[o+t]?c=h[o+t](e,i,a,n)||c:(s.splice(l,1),l-=1,d-=1)}return c}}},compute:function(e,t,i,a,n){var o=e.uniqueID,r=this.mapping[o];if(!r)return a;var s=r[t];if(!s)return a;for(var c=0,l=s.length;c<l;c++){var d=s[c];d[o+t]?a=d[o+t](e,i,a,n):(s.splice(c,1),c-=1,l-=1)}return a}}),cc._RF.pop()},{}],EventSystem:[function(e,t,i){"use strict";cc._RF.push(t,"placeholder-uuid-eventsystem","EventSystem"),Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(){this.listeners={}}return e.prototype.on=function(e,t){var i=this;return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),function(){return i.off(e,t)}},e.prototype.once=function(e,t){var i=this,a=function(n){t(n),i.off(e,a)};this.on(e,a)},e.prototype.off=function(e,t){this.listeners[e]&&(t?this.listeners[e]=this.listeners[e].filter(function(e){return e!==t}):delete this.listeners[e])},e.prototype.emit=function(e,t){console.log("[EventSystem] emit event : ",e);var i=this.listeners[e];i&&0!==i.length&&i.forEach(function(i){try{i(t)}catch(a){console.error('[EventSystem] Error in event listener for "'+e+'":',a)}})},e.prototype.removeAllListeners=function(){this.listeners={}},e.prototype.listenerCount=function(e){var t;return(null===(t=this.listeners[e])||void 0===t?void 0:t.length)||0},e.prototype.eventNames=function(){return Object.keys(this.listeners)},e.prototype.hasListeners=function(e){return this.listenerCount(e)>0},e}();i.default=a,cc._RF.pop()},{}],Exploder:[function(e,t){"use strict";cc._RF.push(t,"e8f2dJIcKBI3Yaz7qwyNzp3","Exploder"),cc.Class({extends:e("../core/base/Entity"),shot:function(){this.callDeath(this,0)},updateLogic:function(e){this.landed&&this.define.landExplode&&this.callDeath(this,0),this._super(e)}}),cc._RF.pop()},{"../core/base/Entity":"Entity"}],FakeUI:[function(e,t){"use strict";cc._RF.push(t,"b4ba5mzMJ9MC50r2c7mbHOb","FakeUI"),cc.Class({extends:cc.Component,properties:{desktopNode:cc.Node,sideBarNode:cc.Node},start:function(){user.onlyPhysics||user.onlyGunner?(initDesktopIcon(this.desktopNode,!0),initSideBarIcon(this.sideBarNode,!0)):this.node.active=!1}}),cc._RF.pop()},{}],FavoriteMenu:[function(e,t){"use strict";cc._RF.push(t,"d03254gyelKeaWELhTf9W0A","FavoriteMenu");var i=function e(t){if(console.log("favorite onShow",t),cc.sys.platform==cc.sys.WECHAT_GAME)if(window.qq){if("3003"==t.scene)return user.lootFavorite(),void(a&&(a=!1,wx.offShow(e)))}else if("1103"==t.scene||"1104"==t.scene||"1089"==t.scene)return user.lootFavorite(),void(a&&(a=!1,wx.offShow(e)))},a=!1;cc.Class({extends:e("./CheckMenu"),properties:{finger:cc.Node,points:[cc.Node],wxNode:cc.Node,qqNode:cc.Node,blNode:cc.Node,myTitleLabel:cc.Label,myBtnLabel:cc.Label,myInfoLabel:cc.Label},initStatus:function(){this.wxNode&&(this.wxNode.active="wx"==CH),this.qqNode&&(this.qqNode.active="qq"==CH),this.blNode&&(this.blNode.active="bl"==CH,this.myTitleLabel.string="\u5173\u6ce8\u5f97\u58d5\u793c",this.myBtnLabel.string="\u7acb\u5373\u5173\u6ce8",this.myInfoLabel.string="\u4ece\u5173\u6ce8\u9875\u8fdb\u5165\u6e38\u620f\u53ef\u83b7\u5f97   --   x80");var e=this.finger;e.runAction(cc.sequence(cc.spawn(cc.scaleTo(.3,1.2),cc.moveBy(.3,0,10)),cc.spawn(cc.scaleTo(.2,1),cc.moveBy(.2,0,-10))).repeatForever()),e.opacity=0,e.moveAction=e.runAction(cc.sequence(cc.place(this.points[0].getPosition()),cc.delayTime(.5),cc.fadeIn(.3),cc.delayTime(2),cc.fadeOut(.3),cc.place(this.points[1].getPosition()),cc.delayTime(.5),cc.fadeIn(.3),cc.delayTime(2),cc.fadeOut(.3),cc.place(this.points[2].getPosition()),cc.delayTime(.5),cc.fadeIn(.3),cc.delayTime(2),cc.fadeOut(.3)).repeatForever()),cc.sys.platform==cc.sys.WECHAT_GAME&&(a||(a=!0,wx.onShow(i)))},onAdd:function(e){this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchClose,this),this.node.runAction(cc.sequence(cc.delayTime(5),cc.callFunc(this.close,this))),e.target.getComponent(cc.Button).interactable=!1;var t=this.finger;t.stopAllActions(),t.opacity=255,t.scale=1.5,t.runAction(cc.sequence(cc.moveBy(.3,0,-30),cc.moveBy(.2,0,30)).repeatForever());var i=sdk.pt();if(i&&i.getMenuButtonBoundingClientRect){var a=i.getMenuButtonBoundingClientRect(),n=cc.view.getDevicePixelRatio();t.x=(.75*a.left+.25*a.right)*n/cc.view.getScaleX()-cc.winSize.width/2,t.y=cc.winSize.height/2-a.bottom*n/cc.view.getScaleY()}else t.x=cc.winSize.width/2-150,t.y=cc.winSize.height/2-50,user.lootFavorite()}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],FeedbackMenu:[function(e,t){"use strict";cc._RF.push(t,"acfe0j8e9pHiLMjq3gJ9AOp","FeedbackMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{toggles:[cc.Toggle],confirmBtn:cc.Node,successMsgInstance:cc.Node},initStatus:function(){},onToggle:function(e){for(var t in cc.log("onToggle",e),e.isChecked=!0,this.toggles)this.toggles[t]!=e?this.toggles[t].isChecked=!1:this.toggleIndex=+t+1;this.toggleOk=!0,this.updateConfirmButton()},onTextChanged:function(e){cc.log("onTextChanged",e),this.textOk=e.length>0,this.textStr=e,this.updateConfirmButton()},updateConfirmButton:function(){var e=this.textOk&&this.toggleOk;this.confirmBtn.opacity=e?255:100},onConfirm:function(){if(this.textOk&&this.toggleOk){this.close();var e=cc.Canvas.instance.node,t=cc.instantiate(this.successMsgInstance);t.active=!0,e.addChild(t,99999),t.runAction(cc.sequence(cc.delayTime(2),cc.destroySelf())),cc.log("onConfirm",this.toggleIndex,this.textStr),YMTJ("notice","notice_"+this.toggleIndex+"_"+this.textStr)}}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],Film:[function(e,t){"use strict";cc._RF.push(t,"12067yzY8tCEbdS3fykqfzd","Film"),cc.Class({extends:cc.Component,properties:{top:cc.Node,bottom:cc.Node,bg:cc.Node},onLoad:function(){this.bg.opacity=0,this.top.active=!1,this.bottom.active=!1,this.darkCount=0,this.filmFlag=0},showFilm:function(){if(!this.filmFlag){this.filmFlag=!0,this.bottom.stopAllActions(),this.top.stopAllActions(),this.top.active=!0,this.bottom.active=!0;var e,t=cc.winSize.height;e=.2*t>200?200:.2*t,this.top.height=e,this.top.y=e,this.top.runAction(cc.moveBy(.4,0,-e)).easing(cc.easeSineOut()),this.bottom.height=e,this.bottom.y=-e,this.bottom.runAction(cc.moveBy(.4,0,e)).easing(cc.easeSineOut())}},hideFilm:function(){this.filmFlag&&(this.filmFlag=!1,this.bottom.stopAllActions(),this.top.stopAllActions(),this.bottom.runAction(cc.fadeOut(.2)),this.top.runAction(cc.fadeOut(.2)))},showDark:function(){this.darkCount++,1==this.darkCount&&(this.bg.stopAllActions(),this.bg.runAction(cc.fadeTo(.2,180)))},hideDark:function(){this.darkCount--,0==this.darkCount&&(this.bg.stopAllActions(),this.bg.runAction(cc.fadeTo(.2,0)))},showDelay:function(e,t){this.node.runAction(cc.sequence(cc.delayTime(e||3),cc.callFunc(t,this)))}}),cc._RF.pop()},{}],FirebaseTracking:[function(e,t,i){"use strict";cc._RF.push(t,"8d5a0XxBr9JRqHJGOlpZ8Gu","FirebaseTracking"),Object.defineProperty(i,"__esModule",{value:!0}),i.FirebaseTracking=void 0;var a=e("../ADManager"),n=e("./Firebase"),o=function(){function e(){}return e.setDataBiRes=function(e){this.dataBiRes=e},e.logBiBusiness=function(e,t,i,a,o,r,s,c,l){n.Firebase.instance.analytic.log("bi_business_event",{product_name:e,price:t,value:i,quantity:a,event_source_screen_class:o,currency_name:r,transaction_id:s,level_played:c,days_played:l})},e.logAdPlacement=function(e){n.Firebase.instance.analytic.log("ad_placement",{placement:e})},e.logTutorial=function(e){n.Firebase.instance.analytic.log("tutorial",{step:e})},e.logNewTutorial=function(e){window.user.getGuideStep()<e.Step&&(console.log("===== log Tutorial_new =  "+e.Step,window.user.getGuideStep()<e.Step,window.user.getGuideStep(),e.Step),window.user.setGuideStep(e.Step),n.Firebase.instance.analytic.log("tutorial_new",e))},e.LogCustomEvent=function(e,t){n.Firebase.instance.analytic.log(e,t)},e.logGameStart=function(e,t,i){n.Firebase.instance.analytic.log("game_start",{game_mode:this.gameMode,ID:e,level_id:this.levelID,attempts:t,hp_percent:i}),console.log("===== log game start : "+this.gameMode+" - id : "+e+" - level id : "+this.levelID+" - attemp : "+t+" - HP: "+i)},e.logGameOver=function(e,t,i,o,r,s,c,l,d,h,u,p,f,m,g,v,y,b){console.log("===== log GameOver  : "+this.gameMode+" - id : "+e+" - level id : "+this.levelID+" - attemp : "+s+" - time_spent : "+t+" - continue Ad : "+i+" - context : "+o+" - level_abandoned : "+r+" - stage : "+this.curStage),console.log("[Firebase] Stats params - equipment:",c,"dmg_sniper:",l,"dmg_machinegun:",d,"dmg_firethrower:",h,"dmg_mortar:",u,"dmg_bouncingball:",p,"dmg_cannon:",f,"dmg_laser:",m,"dmg_tesla:",g,"dmg_flyshield:",v,"hprecovery:",y,"armorrecovery:",b,"total damage:",(l||0)+(d||0)+(h||0));var k={game_mode:this.gameMode,ID:e,level_id:this.levelID,time_spent:t,continue_ad:i,context:o,level_abandoned:r,attempts:s,stage:this.curStage};void 0!==c&&(k.equipment=c),void 0!==l&&(k.dmg_sniper=l,k.dmg_machinegun=d||0,k.dmg_firethrower=h||0,k.dmg_mortar=u||0,k.dmg_bouncingball=p||0,k.dmg_cannon=f||0,k.dmg_laser=m||0,k.dmg_tesla=g||0,k.dmg_flyshield=v||0,k.total_damage=(l||0)+(d||0)+(h||0)+(u||0)+(p||0)+(f||0)+(m||0)+(g||0)+(v||0)),void 0!==y&&(k.hprecovery=y||0,k.armorrecovery=b||0,k.total_recovery=(y||0)+(b||0)),console.log("[Firebase] Game Over data being sent:",k),n.Firebase.instance.analytic.log("game_over",k),this.curStage=1,a.ADManager.Instance.IsReviveAds=!1,this.isContinue=!1},e.logBiResource=function(e,t,i,a){"source"==e?(this.fromBiRes=this.dataBiRes,this.toBiRes=""):(this.fromBiRes="",this.toBiRes=this.dataBiRes),n.Firebase.instance.analytic.log("bi_resource_event",{flow_type:e,from:this.fromBiRes,to:this.toBiRes,virtual_currency_name:t,value:i,level_id:this.levelID,balance:a}),console.log("======= log Bi Resource  - flow : "+e+" - from : "+this.fromBiRes+" - to : "+this.toBiRes+" - level id = "+this.levelID)},e.logBiProgression=function(e,t,i,a,o,r,s,c){n.Firebase.instance.analytic.log("bi_progression_event",{progression_scenario:e,subject:t,object:i,completed_wave:a,action:o,type_of_quantity:r,numerical_value:null!=s?s:"",retry:c?1:0})},e.logBiAdImpression=function(e,t,i,a,o,r,s,c,l){n.Firebase.instance.analytic.log("bi_ad_impression",{ad_platform:e,ad_source:t,ad_platform_unit_id:i,ad_source_unit_id:a,ad_format:o,ad_number:r,ad_placement:s,est_value_usd:c,cum_value_usd:l}),this.logBiAdValue(e,t,i,a,o,r,s,c,"USD","0",c,l)},e.logBiAdClick=function(e,t,i,a,o,r,s){n.Firebase.instance.analytic.log("bi_ad_click",{ad_platform:e,ad_source:t,ad_platform_unit_id:i,ad_source_unit_id:a,ad_format:o,ad_number:r,ad_placement:s})},e.logBiAdValue=function(e,t,i,a,o,r,s,c,l,d,h,u){console.log("===== logBiAdValue "),n.Firebase.instance.analytic.log("bi_ad_value",{ad_platform:e,ad_source:t,ad_platform_unit_id:i,ad_source_unit_id:a,ad_format:o,ad_number:r,ad_placement:s,estimated_value:c,est_value_currency:l,precision_type:d,est_value_usd:h,cum_value_usd:u})},e.logBiAdRequestFailed=function(e,t,i,a,o,r,s,c){console.log("===== logBiAdRequestFailed "),n.Firebase.instance.analytic.log("bi_ad_request_failed",{ad_platform:e,ad_source:t,ad_platform_unit_id:i,ad_source_unit_id:a,ad_format:o,ad_number:r,ad_placement:s,error_message:c})},e.gameMode="Classic",e.levelID="",e.fromBiRes="",e.toBiRes="",e.dataBiRes="",e.curStage=1,e.isContinue=!1,e}();i.FirebaseTracking=o,cc._RF.pop()},{"../ADManager":"ADManager","./Firebase":"Firebase"}],Firebase:[function(e,t,i){"use strict";cc._RF.push(t,"ecbf9svz7RBOq00RLzHnF0e","Firebase"),Object.defineProperty(i,"__esModule",{value:!0}),i.Firebase=void 0;var a=e("./Analytic"),n=function(){function e(){this._analytic=a.getAnalyticPlatform()}return Object.defineProperty(e.prototype,"analytic",{get:function(){return this._analytic},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e._instance=void 0,e}();i.Firebase=n,window.Firebase=n,cc._RF.pop()},{"./Analytic":"Analytic"}],FloatBar:[function(e,t){"use strict";cc._RF.push(t,"6bc79Sens1FhJT4YAy8y+hP","FloatBar"),cc.Class({extends:cc.Component,properties:{hpBg:cc.Node,hpBar:cc.Node},init:function(e,t,i){var a=Math.min(Math.floor(1.5*(t.radius||1)),100);this.w=a,this.h=9,this.game=e,this.obj=t,this.hpBar.x=.5*-a,this.hpBg.width=a;var n=t.hp/t.hpMax*(this.w-1)+1;this.hpBar.width=n,this.hp=t.hp,this.hpBg.opacity=0,this.node.setPosition(i.x,i.y+.5*this.w+15)},setVisible:function(e){this.node.active=e,e&&this.lateUpdate(0)},refresh:function(){var e=this.obj;if(this.hp=e.hp,this.hp<=0)this.node.active=!1;else{var t=e.hp/e.hpMax*(this.w-1)+1;this.hpBar.width=t,this.hpBg.opacity=255}},lateUpdate:function(){var e=this.obj;if(e.removed)this.node.destroy();else{var t=this.node;this.hp!=e.hp&&(this.hp<=0&&t.runAction(cc.fadeIn(.1)),this.refresh());var i=e.avatar;if(i){var a=i.getPosition();t.setPosition(a.x-10,a.y+15)}}}}),cc._RF.pop()},{}],FlyShield:[function(e,t){"use strict";cc._RF.push(t,"a563f95J1dPULWiLid3STYT","FlyShield"),e("./define");var i=e("../entities/environment/MyTower"),a=e("../entities/projectiles/Bomb"),n=(e("../entities/projectiles/MissileSprite"),e("../entities/projectiles/BallBulletSprite")),o=e("../ai/units/AIMyTower");BULLET_DEFINE.fly_shield=[{name:"\u70ae\u5f39",ctor:a,avatar:{ctor:n,sx:1,sy:1,sx1:1,sy1:1,noBlend:!0,hitEffect:EFFECT.yellowHit,a:cc.v2(.3,.5),anime:{repeat:-1,alive:1,atlas:"bullet/fly_shield/fh_jian",speed:13.8},z:ZORDER.BULLET+1},hp:55,bomb:{r1:120,r0:120,dmg1:150,dmg0:150,kb:300,effect:EFFECT.bombs},kb:.3,length:100,radius:100,hitRadius:100,n:1,wd:0,d:0,spd:800,spdFluc:0,gravity:-150,distance:3450,disExtra:100,thrChance:1,thrDecline:1}],ENTITY.fly_shield={id:"fly_shield",hero:!0,category:"fly_shield",name:"\u98de\u76fe",avatar:{gunBone:"gun",animeName:"jianta",anime:"weapon/jianta",moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:100,bombDmg:100,blt:BULLET_DEFINE.fly_shield,bltMax:1,bltReload:.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(0,100),attackSequence:[{t:.3,ani:0},{t:1.6,x:50*1.1*1.1/7,y:0,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3,ani:1},{t:1}],attackAngle:[-30,30],pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},RES.fly_shield=[{anime:"weapon/jianta"}],ENTITY.fly_shield_2={id:"fly_shield_2",hero:!0,category:"fly_shield",name:"\u98de\u76fe2",avatar:{gunBone:"gun",animeName:"jianta2",anime:"weapon/jianta",moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:150,bombDmg:150,blt:BULLET_DEFINE.fly_shield,bltMax:1,bltReload:.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(0,100),attackSequence:[{t:.3,ani:0},{t:1.6,x:50*1.1*1.1/7,y:0,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3,ani:1},{t:1}],attackAngle:[-30,30],pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},RES.fly_shield2=[{anime:"weapon/jianta"}],ENTITY.fly_shield_3={id:"fly_shield_3",hero:!0,category:"fly_shield",name:"\u98de\u76fe3",avatar:{gunBone:"gun",animeName:"jianta3",anime:"weapon/jianta",moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:225,bombDmg:225,blt:BULLET_DEFINE.fly_shield,bltMax:1,bltReload:.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(0,100),attackSequence:[{t:.3,ani:0},{t:1.6,x:50*1.1*1.1/7,y:0,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3,ani:1},{t:1}],attackAngle:[-30,30],pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},RES.fly_shield3=[{anime:"weapon/jianta"}],ENTITY.fly_shield_4={id:"fly_shield_4",hero:!0,category:"fly_shield",name:"\u98de\u76fe4",avatar:{gunBone:"gun",animeName:"jianta4",anime:"weapon/jianta",moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:338,bombDmg:338,blt:BULLET_DEFINE.fly_shield,bltMax:1,bltReload:.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(0,100),attackSequence:[{t:.3,ani:0},{t:1.6,x:50*1.1*1.1/7,y:0,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3,ani:1},{t:1}],attackAngle:[-30,30],pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},RES.fly_shield4=[{anime:"weapon/jianta"}],cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/MissileSprite":"MissileSprite","./define":"define"}],Focus:[function(e,t){"use strict";cc._RF.push(t,"7aa7dGYMO9GW5KsB2tgIYYo","Focus"),cc.Class({extends:cc.Component,properties:{mask:cc.Node,finger:cc.Node,infoNode:cc.Node,infoText:cc.RichText,backup:cc.Node,head:cc.Node,head2:cc.Node,line:cc.Node,npcName:cc.Node,aim:cc.Node,heads:[cc.Node]},onLoad:function(){for(var e in this.heads)if("h0"==this.heads[e].name)this.heads[e].npcName=ENTITY.h7.name;else{var t=ENTITY[this.heads[e].name];t&&(this.heads[e].npcName=t.name)}},checkFinish:function(e,t){this.args.cond&&this.args.cond(this,e,t)&&(this.cb&&this.cb(),this.node.destroy())},update:function(e){this.targetStr||(this.targetStr=this.infoText.string,this.targetStrIndex=0,this.infoText.string="",this.showTextTimer=.2),this.showTextTimer-=e,this.showTextTimer<0&&(this.showTextTimer=.015,this.targetStrIndex++,this.infoText.string=this.targetStr.substr(0,this.targetStrIndex))},init:function(e){var t=this,i=e.node,a=e.info,n=e.delay||0,o=e.cb;this.args=e,this.cb=o,this.infoText.string=a||"",this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){var t=e.size||i,n=t.width,o=t.height;this.mask.width=n,this.mask.height=o,this.backup.width=n,this.backup.height=o;var r=e.pos||i.convertToWorldSpaceAR(cc.v2(0,0));r.x+=n*(.5-i.anchorX),r.y+=o*(.5-i.anchorY),this.touchRect=!e.noTouch&&cc.rect(r.x,r.y,n,o);var s=this.node.convertToNodeSpaceAR(r);this.mask.setPosition(s),this.backup.setPosition(s),e.noBlack&&(this.mask.active=!1),this.mask.scale=3,this.mask.runAction(cc.scaleTo(.3,1));var c=this.finger;if(e.noFinger&&(c.active=!1),c.setPosition(s),e.dragBetween){c.getChildByName("finger").active=!0,c.getChildByName("finger2").active=!1,c.getChildByName("finger").runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){c.getChildByName("finger").active=!1,c.getChildByName("finger2").active=!0,c.runAction(cc.sequence(cc.moveBy(.5,e.dragBetween),cc.delayTime(.2),cc.moveBy(.5,cc.v2(-e.dragBetween.x,-e.dragBetween.y))).repeatForever())})));var l=e.dragBetweenLinePos&&e.dragBetweenLinePos.dx||370,d=e.dragBetweenLinePos&&e.dragBetweenLinePos.dy||230;this.line.x=c.x-l,this.line.y=c.y-d;var h=this.line.x,u=this.line.y;this.line.active=!0,cc.isValid(this.aim)?(cc.log("focus aim valid"),this.aim.active=!0):cc.log("focus aim not valid");var p=e.dragBetweenLinePos&&e.dragBetweenLinePos.hero;this.line.getComponent(cc.Sprite).schedule(function(){if(p){var e=kit.vector2Degree(c.x-h,c.y+100-u);p.mainTower.attackDeg=(e+360)%360}e=kit.vector2Degree(c.x-h,c.y+100-u),this.node.angle=e})}if(e.dragBy&&c.runAction(cc.sequence(cc.moveBy(.5,e.dragBy),cc.delayTime(.2),cc.moveBy(.01,cc.v2(-e.dragBy.x,-e.dragBy.y))).repeatForever()),e.dragToNode){var f=e.dragToNode.convertToWorldSpaceAR(cc.v2(0,0)),m=this.node.convertToNodeSpaceAR(f),g=s;if(e.dragFromNode){var v=e.dragFromNode.convertToWorldSpaceAR(cc.v2(0,0)),y=this.node.convertToNodeSpaceAR(v);c.x=y.x,c.y=y.y,g=y}c.runAction(cc.sequence(cc.moveTo(.5,m),cc.delayTime(1),cc.moveTo(.01,g)).repeatForever())}if(c.runAction(cc.sequence(cc.sequence(cc.scaleTo(.3,1.2),cc.scaleTo(.2,1)).repeat(5),cc.delayTime(2)).repeatForever()),e.dx&&(this.infoNode.x+=e.dx),e.dy&&(this.infoNode.y+=e.dy),this.updateHeadPosition(),!a)for(var b in this.infoNode.active=!1,this.heads)this.heads[b].active=!1},this),cc.fadeIn(.5))),n>0&&this.node.runAction(cc.sequence(cc.delayTime(n),cc.callFunc(function(){o&&o()},this),cc.destroySelf()));var r=i;if(i.getComponent(cc.Button),e.event){if(this.args.cond)return;r.once(cc.Node.EventType.TOUCH_START,function(e){t.node.runAction(cc.sequence(cc.fadeOut(.2),cc.destroySelf())),o&&o(e)},this),r.once(cc.Node.EventType.TOUCH_MOVE,function(){}),r.once(cc.Node.EventType.TOUCH_END,function(){}),r.once(cc.Node.EventType.TOUCH_CANCEL,function(){})}else{var s=e.fade||0;console.log("click fade",s),r.once("click",function(){t.args.cond||(t.block=!0,o&&o(),t.node.runAction(cc.sequence(cc.fadeOut(.2),cc.delayTime(s),cc.callFunc(function(){e.fadeCb&&e.fadeCb()},t),cc.destroySelf())))},this)}this.node._hitTest=function(e){if(t.block)return!0;cc.log("hitTest 111");var i=t.touchRect;return i&&Math.abs(e.x-i.x)<i.width/2&&Math.abs(e.y-i.y)<i.height/2?(cc.log("hitTest 222"),!1):(cc.log("hitTest 333"),!0)},this.node.on(cc.Node.EventType.TOUCH_START,function(){},this),this.initTouch()},updateHeadPosition:function(){var e=this.args&&this.args.head||"h99";if(e)for(var t in this.heads)this.heads[t].name==e?(this.heads[t].active=!0,this.npcName.getComponent(cc.Label).string=this.heads[t].npcName):this.heads[t].active=!1;this.args&&this.args.flipHead&&console.log("TODO")},initHot:function(e){var t=e.node,i=e.delay||0,a=e.info,n=e.cb;this.args=e,this.mask.active=!1,this.infoText.string=a||"",this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){if(this.updateHeadPosition(),!a)for(var e in this.infoNode.active=!1,this.heads)this.heads[e].active=!1},this),cc.delayTime(.4),cc.callFunc(function(){var i=e.pos||t.convertToWorldSpaceAR(cc.v2(0,0));cc.log("hot pos",i);var a=this.node.convertToNodeSpaceAR(i),n=this.finger;if(e.noFinger&&(n.active=!1),n.setPosition(a),e.dragToNode){var o=e.dragToNode.convertToWorldSpaceAR(cc.v2(0,0)),r=this.node.convertToNodeSpaceAR(o);n.runAction(cc.sequence(cc.moveTo(.5,r),cc.delayTime(1),cc.moveTo(.01,a)).repeatForever())}e.dragBy&&n.runAction(cc.sequence(cc.moveTo(.5,e.dragBy),cc.delayTime(.2),cc.moveTo(.01,cc.v2(-e.dragBy.x,-e.dragBy.y))).repeatForever()),n.runAction(cc.sequence(cc.sequence(cc.scaleTo(.3,1.2),cc.scaleTo(.2,1)).repeat(5),cc.fadeOut(.1),cc.delayTime(2),cc.fadeIn(.1)).repeatForever())},this),cc.fadeIn(.5))),i>0&&this.node.runAction(cc.sequence(cc.delayTime(i),cc.callFunc(function(){n&&n()},this),cc.destroySelf())),this.infoNode.y=0,e.dx&&(this.infoNode.x+=e.dx),e.dy&&(this.infoNode.y+=e.dy)},initChat:function(e){this.args=e,e.node;var t=e.info,i=e.delay||0,a=e.cb;this.cb=a,this.infoText.string=t||"",void 0!==e.noBlack?e.noBlack?this.mask.active=!1:(this.mask.active=!0,this.mask.getComponent(cc.Mask).enabled=!1,this.noFinger=!0,this.initTouch()):this.mask.active=!1,this.infoNode.y=0,e.dx&&(this.infoNode.x+=e.dx),e.dy&&(this.infoNode.y+=e.dy),this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.updateHeadPosition()},this),cc.fadeIn(.4),cc.delayTime(i),cc.callFunc(function(){cc.Canvas.instance.node.focusNode=null,this.args.cb&&this.args.cb()},this),cc.destroySelf()))},remove:function(){this.node.destroy()},onDestroy:function(){var e=cc.Canvas.instance.node;e.focusNode==this&&(e.focusNode=null)},initTouch:function(){var e=this.node;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this),this.touch={}},onTouchBegan:function(){if(!this.noFinger){var e=this.finger.getChildByName("guangquan");e.active=!0,e.opactiy=0,e.scale=5,e.stopAllActions(),e.runAction(cc.sequence(cc.spawn(cc.scaleTo(.2,1),cc.fadeIn(.2)),cc.blink(.5,4),cc.delayTime(.5),cc.fadeOut(.1)))}},onTouchMoved:function(){},onTouchEnded:function(){},onTouchCanceled:function(){}}),cc._RF.pop()},{}],FreeIcon:[function(e,t){"use strict";cc._RF.push(t,"ee902iw5uFEi4yUBIfimeaR","FreeIcon"),cc.Class({extends:cc.Component,properties:{videoFrame:cc.SpriteFrame,shareFrame:cc.SpriteFrame,boostType:cc.Boolean,adid:""},onLoad:function(){cc.game.on("video_change",this.refresh,this),this.refresh()},refresh:function(){if(this.boostType)var e=sdk.getBoostType();else e=sdk.getFreeType(this.adid);var t=this.getComponent(cc.Sprite);t&&(e==VIDEO_FREE?t.spriteFrame=this.videoFrame:t.spriteFrame=this.shareFrame)}}),cc._RF.pop()},{}],FreeLabel:[function(e,t){"use strict";cc._RF.push(t,"90670RxX/xBdJmrL/wZvZ4A","FreeLabel"),cc.Class({extends:cc.Component,properties:{videoString:cc.String,shareString:cc.String,boostType:cc.Boolean,adid:""},onLoad:function(){cc.game.on("video_change",this.refresh,this),this.refresh()},refresh:function(){if(this.boostType)var e=sdk.getBoostType();else e=sdk.getFreeType(this.adid);var t=this.getComponent("LocalLabel")||this.getComponent(cc.Label);t&&(e==VIDEO_FREE?t.string=this.videoString:t.string=this.shareString)}}),cc._RF.pop()},{}],FriendMenu:[function(e,t){"use strict";cc._RF.push(t,"00e3042519E4Zvsx7Bqozsf","FriendMenu"),cc.Class({extends:e("../core/PopMenu"),properties:{openRender:cc.Sprite,right:cc.Node,layoutNode:cc.Node,item:cc.Node,scroll:cc.ScrollView},onLoad:function(){this._super(),this.scroll.node.active=!1,this.uiList=[this.item],this.item.active=!1,this.renderWidth=770,(cc.sys.platform!=cc.sys.WECHAT_GAME||window.qq)&&(this.right.active=!1,this.board.width=650,this.renderWidth=635)},initStatus:function(){var e=this,t=window.hg,i=sdk.pt();i&&i.getOpenDataContext?this.initOpenRender():t&&(this.scroll.node.active=!0,t.getRank({type:0,success:function(t){cc.log("hg.getRank success"),t.ranks&&cc.isValid(e.node)&&e.initRankList(t.ranks)},fail:function(){cc.log("hg.getRank fail")}}))},initRankList:function(e){for(var t in console.log("initRankList",JSON.stringify(e)),e){var i=e[t],a=this.uiList[t];a||(a=this.uiList[t]=cc.instantiate(this.item),this.layoutNode.addChild(a)),a.active=!0;var n=cc.find("headNode/head",a).getComponent(cc.Sprite);user.loadUserHead(n,i.avatarUrl),cc.find("bar/name",a).getComponent(cc.Label).string=i.name,a.getChildByName("index").getComponent(cc.Label).string=i.rank,a.getChildByName("score").getComponent(cc.Label).string=i.score}},initOpenRender:function(){var e=sdk.pt();this.openTexture=new cc.Texture2D,this.openSpriteFrame=new cc.SpriteFrame;var t=this.renderWidth,i=e.getOpenDataContext(),a=i.canvas;a.width=t,a.height=370,this.sharedCanvas=a,console.log(a),i.postMessage({action:"fetchFriend",openId:user.openId,ch:CH}),this.openTexture.initWithElement(a),this.openTexture.handleLoadedTexture(),this.openSpriteFrame.setTexture(this.openTexture),this.openRender.spriteFrame=this.openSpriteFrame;var n=this.openRender.node;n.width=t,n.height=370,n.on(cc.Node.EventType.TOUCH_END,function(e){var a=e.getLocation(),o=n.convertToNodeSpaceAR(a);o.x+=t/2,o.y=185-o.y,i.postMessage({action:"click",pos:o})},this),n.on(cc.Node.EventType.TOUCH_MOVE,function(e){i.postMessage({action:"scroll",data:e.getDelta().y})},this),e.setMessageToFriendQuery&&e.setMessageToFriendQuery({shareMessageToFriendScene:1})},updateOpenRender:function(){var e=this.sharedCanvas;e&&(this.openTexture.initWithElement(e),this.openTexture.handleLoadedTexture())},update:function(){this.updateOpenRender()}}),cc._RF.pop()},{"../core/PopMenu":"PopMenu"}],FullBarWidget:[function(e,t){"use strict";cc._RF.push(t,"6cd9cfugRVKiqBbgSWuUJEt","FullBarWidget"),cc.Class({extends:cc.Component,editor:{executionOrder:-1},properties:{leftFill:!1,rightFill:!1},start:function(){var e=this.getComponent(cc.Widget);if(e){var t=sdk.getSafeAreaRect(),i=t.width/cc.winSize.width;this.leftFill&&(e.left-=t.x/i),this.rightFill&&(e.right-=(cc.winSize.width-t.x-t.width)/i)}}}),cc._RF.pop()},{}],FullScreenWidget:[function(e,t){"use strict";cc._RF.push(t,"123a9P0HMZP+acPIFGWnojN","FullScreenWidget"),cc.Class({extends:cc.Component,editor:{executionOrder:-2},properties:{resizable:!0},onLoad:function(){this.resizable&&cc.winSize.height<1280&&(this.node.scale=cc.winSize.height/1280)},start:function(){var e=this.getComponent(cc.Widget);if(e){var t=sdk.getSafeAreaRect();e.bottom+=t.y,e.top+=cc.winSize.height-t.y-t.height}}}),cc._RF.pop()},{}],GameCamera:[function(e,t){"use strict";cc._RF.push(t,"7c8f4rWUq5MFZxgwQZP0s46","GameCamera"),cc.Class({extends:cc.Component,initMap:function(e,t){this.borderColor=cc.color(35,35,35),this.game=e,this.layer=e.layer,this.fogNode=new cc.Node,this.layer.addToTop(this.fogNode,ZORDER.TOP+1),this.zoom=0,this.scale=1,this.offset=0,this.tx=0,this.ty=0;var i=t.config;i.offset&&(this.offset=i.offset),i.color&&(this.borderColor=i.color),this.setScale(i.scale||1),this.updateCenter(),this.getComponent(cc.Camera).backgroundColor=this.borderColor,this.layer.coverNode.color=this.borderColor,this.x=0,this.y=0,this.dx=0},addBorder:function(e,t){this.fogNode.addChild(e,t)},updateCenter:function(){var e=this.node;e.x=this.tx+this.layer.x,e.y=this.ty+this.layer.y,this.x=e.x,this.y=e.y},setCenter:function(e,t){this.tx=e,this.ty=t},setScale:function(e){e*=GAME_VIEW_SCALE,this.getComponent(cc.Camera).zoomRatio=e,this.scale=e},getScale:function(){return this.scale},updateStatus:function(){var e=this.game.levelMgr,t=e.cameraX,i=e.cameraY;this.dx=(t-this.x)/STEP_TIME,this.dy=(i-this.y)/STEP_TIME},updateReal:function(e){this.x+=this.dx*e,this.y+=this.dy*e,this.setCenter(this.x,this.y),this.updateCenter()}}),cc._RF.pop()},{}],GameConstants:[function(e,t){"use strict";cc._RF.push(t,"7c91eQiTDNKE5nX5jj8mj6A","GameConstants"),window.METAL="metal",window.HONOR="honoiager",window.POWER="power",window.GOLD="gold",window.SILVER="silver",window.EQUIPMENT="equipment",window.SHARD="shard",window.ENERGY="energy",window.EXP="exp",window.TALENT="talent",window.BLUEPRINT_ATK="blueprintAtk",window.BLUEPRINT_HP="blueprintHp",window.BLUEPRINT_SKILL="blueprintSkill",window.SWEEP_TICKET="sweepTicket",window.DIAMOND="diamond",window.RECRUIT_TICKET="recruitTicket",window.HERO_REFRESH_TICKET="heroRefreshTicket",window.HERO="hero",window.VEHICLE="vehicle",window.KEY_M="midBoxKey",window.KEY_L="bigBoxKey",window.EXP_PROGRESSION_TRACK="expProgressionTrack",cc._RF.pop()},{}],GameLayer:[function(e,t){"use strict";cc._RF.push(t,"5eeddwsUdlEho+B9Ox0BwUh","GameLayer"),e("../../components/visual/VirtualAvatar");var i=e("../../scripts/Theme"),a=e("../../components/visual/ArmatureAvatar"),n=(e("../../entities/characters/HumanAvatar"),e("../../entities/projectiles/BulletSprite")),o=e("../../scripts/AreaPoint");cc.Class({extends:cc.Component,properties:{transFrame:cc.SpriteFrame,talentChoosePrefab:cc.Prefab,numBarPrefab:cc.Prefab,floatBarPrefab:cc.Prefab,heroBarPrefab:cc.Prefab,towerBarPrefab:cc.Prefab,bossBarPrefab:cc.Prefab,joystickPrefab:cc.Prefab,bottomPrefab:cc.Prefab,camera:cc.Camera,btnNode:cc.Node,uiNode:cc.Node,gameNode:cc.Node,coverNode:cc.Node,debugNode:cc.Node,timeNode:cc.Node,finishNode:cc.Node,startNode:cc.Node,titleNode:cc.Node,chapterLabel:cc.Label,chapterNameLabel:cc.Label,infoPrefab:cc.Prefab,dialogPrefab:cc.Prefab,filmPrefab:cc.Prefab,questNode:cc.Node,questBarPrefab:cc.Prefab,feedbackBtn:cc.Node,pauseBtn:cc.Node},onFeedbackBtn:function(){var e=this;menuManager.pop("feedback",{closeCb:function(){e.game.popTimeScale(0)}}),this.game.pushTimeScale(0)},onLoad:function(){this.enabled=!1,this.initScheduler(),this.feedbackBtn.active=!!user.feedback},onDestroy:function(){this.clearScheduler()},init:function(){this.dialogIndex=0,this.coverCount=0,this.finishNode.active=!1,this.startNode.active=!1,this.titleNode.active=!1;var e=this.coverNode;e.active=!0,e.opacity=255,cc.winSize.height>e.height&&e.setScale(cc.winSize.height/e.height),this.initLayers(),this.theme=new i,this.theme.init(this)},initMap:function(e,t){this.game=e,"Chapter 1"!==this.game.config.chapterIndexName||DEV_MODE?this.pauseBtn&&(this.pauseBtn.active=!0):this.pauseBtn&&(this.pauseBtn.active=!1),this.initScheduler(),0===e.config.mapIndex&&e.config.chapterIndexName&&(this.chapterLabel.string=e.config.chapterIndexName,this.chapterNameLabel.string=e.config.chapterName,this.titleNode.active=!0,this.titleNode.opacity=0,this.titleNode.runAction(cc.sequence(cc.fadeIn(.3),cc.delayTime(1),cc.fadeOut(1))));var i=t.config.scale||1;this.gameNode.setPosition(0,cc.winSize.height*(i-1-.5)),cc.winSize.width/cc.winSize.height>2?this.scale=(cc.winSize.width-96)/cc.winSize.width:this.scale=1,this.gameNode.scale=this.scale,e.flipX?(this.gameNode.scaleX=-this.gameNode.scale,this.flipX=!0):this.flipX=!1,this.btnNode.active=!0,this.theme.initMap(e,t),this.gameCamera=this.camera.getComponent("GameCamera"),this.gameCamera.initMap(e,t)},initDebug:function(){},clear:function(){for(var e in this.coverNode.active=!1,this.gameNode.destroyAllChildren(),this.uiNode.destroyAllChildren(),this.clearScheduler(),delete this.joystick,delete this.infoUI,delete this.dialogCover,this.enabled=!1,this.questList)this.questList[e].node.destroy();this.questList=[]},clearScheduler:function(){var e=this._gameScheduler,t=cc.director._scheduler;if(e){var i=dragonBones.CCFactory.getInstance();t.scheduleUpdate(i,cc.Scheduler.PRIORITY_SYSTEM,!1);var a=cc.director._animationManager;e.unscheduleUpdate(a),t.scheduleUpdate(a,cc.Scheduler.PRIORITY_SYSTEM,!1),e.unscheduleAll(),delete this._gameActionManager,delete this._gameScheduler}},initScheduler:function(){var e=this._gameScheduler=new cc.Scheduler,t=cc.director._scheduler;this._gameActionManager=new cc.ActionManager,e.scheduleUpdate(this._gameActionManager,cc.Scheduler.PRIORITY_SYSTEM,!1);var i=dragonBones.CCFactory.getInstance();t.unscheduleUpdate(i);var a=cc.director._animationManager;t.unscheduleUpdate(a),e.scheduleUpdate(a,cc.Scheduler.PRIORITY_SYSTEM,!1)},updateScheduler:function(e){this._gameScheduler.update(e),dragonBones.CCFactory.getInstance().update(e)},bindScheduler:function(e){e.setScheduler(this._gameScheduler),e.setActionManager(this._gameActionManager)},initLayers:function(){this.shakeTimerX=0,this.shakePowerX=0,this.shakeTimerY=0,this.shakePowerY=0,this.x=0,this.y=0,this.lowLayer=new cc.Node,this.gameNode.addChild(this.lowLayer,-1),this.topLayer=new cc.Node,this.gameNode.addChild(this.topLayer,1e3),this.midLayer=new cc.Node,this.gameNode.addChild(this.midLayer,0)},addToUI:function(e,t){void 0===t&&(t=0),this.uiNode.addChild(e,t)},addToCamera:function(e,t){void 0===t&&(t=0),this.midLayer.addChild(e,t)},addToTop:function(e,t){void 0===t&&(t=0),this.topLayer.addChild(e,t)},addToBottom:function(e,t){void 0===t&&(t=0),this.lowLayer.addChild(e,t)},start:function(){this.enabled=!0,this.coverNode.runAction(cc.fadeOut(.2))},addAvatar:function(e,t,i){var n=this.game,o=(n.config,new cc.Node),r=e.groundIndex||0;this.addToCamera(o,(t.z||ZORDER.HERO)-1e3*r);var s=t.ctor||a,c=o.addComponent(s);return c.init(n,e,t,i),e.define.boxFlag?this.addStatusBar(e,c,this.numBarPrefab,"NumBar"):e.vehicleFlag?this.addStatusBar(e,c,this.heroBarPrefab,"VehicleBar"):e.towerFlag?this.addStatusBar(e,c,this.towerBarPrefab,"TowerBar"):e.bossFlag||this.addStatusBar(e,c,this.floatBarPrefab,"FloatBar"),c},addStatusBar:function(e,t,i,a){var n=this.game;if(n.config,e.hpMax&&e.hp&&i){var o=cc.instantiate(i);this.addToTop(o,ZORDER.UI),this.flipX?o.scaleX=-1:o.scaleX=1;var r=o.getComponent(a);r.init(n,e,t),t.hpBar=r}},addBulletSprite:function(e,t,i){var a=new cc.Node;this.addToCamera(a,t.z||ZORDER.BULLET);var o=t.ctor||n,r=a.addComponent(o);return r.init(this.game,e,t,i),r},addHeroUI:function(e,t,i){var a=this.game;if(a.config,e.bossFlag){var n=cc.instantiate(this.bossBarPrefab);this.addToUI(n),n.getComponent("BossBar").init(a,e,e.avatar)}else if(i.me==a.me&&!a.replayData&&i.team==a.team){var o=this.joystick;if(!o){var r=cc.instantiate(this.joystickPrefab);if(this.addToUI(r),o=this.joystick=r.getComponent("Joystick"),this.bottomPrefab){var s=cc.instantiate(this.bottomPrefab);this.addToUI(s);var c=s.getComponent("battleBottomUI");c.init(a,{noTouch:1}),c.setVehicle(e,this),this.bottomUI=c}}if(!i.ai)return o.init(a,e,t,i),o.setVisible(!0),o;o.setVisible(!1)}},shake:function(e,t){this.shakePowerX+=e||0,this.shakePowerX>3?this.shakePowerX=3:this.shakePowerX=this.shakePowerX,this.shakePowerY+=t||0,this.shakePowerY>3?this.shakePowerY=3:this.shakePowerY=this.shakePowerY},updateShake:function(e){this.shakePowerX>0&&(this.shakePowerX=.85*this.shakePowerX-e,this.shakePowerX<=0?this.x=this.shakeTimerX=0:(this.shakeTimerX+=e,this.x=Math.round(this.shakePowerX*Math.cos(60*this.shakeTimerX)))),this.shakePowerY>0&&(this.shakePowerY=.85*this.shakePowerY-e,this.shakePowerY<=0?this.y=this.shakeTimerY=0:(this.shakeTimerY+=e,this.y=Math.round(this.shakePowerY*Math.cos(60*this.shakeTimerY))))},update:function(e){this.game.update(e)},updateReal:function(e){if(this.updateScheduler(e),this.updateShake(e),this.gameCamera.updateReal(e),this.theme.updateReal(e),DEV_MODE&&DEBUG_MODE&&this.debugLabel){var t=this.game,i=t.contactMgr,a="\t\u7269\u4f53:\t"+i.contactList.length+"\t\u5b50\u5f39:\t"+i.bulletList.length+"\t\u65f6\u95f4:\t"+Math.round(t.step*STEP_TIME);this.debugLabel.string=a}},callLabel:function(){},callStart:function(){var e=this.startNode;e.active=!0,e.opacity=0,e.scale=.2,e.stopAllActions(),e.runAction(cc.sequence(cc.delayTime(.5),cc.spawn(cc.fadeIn(.15),cc.scaleTo(.15,1.5)).easing(cc.easeOut(1)),cc.scaleTo(.3,1).easing(cc.easeSineIn(1)),cc.delayTime(1),cc.fadeOut(1)))},callFinish:function(e){if(e){var t=this.finishNode;t.active=!0,t.opacity=0,t.scale=.2,t.stopAllActions(),t.runAction(cc.sequence(cc.delayTime(.5),cc.spawn(cc.fadeIn(.15),cc.scaleTo(.15,1.5)).easing(cc.easeOut(1)),cc.scaleTo(.3,1).easing(cc.easeSineIn(1))))}},removeLabel:function(){},hidePauseBtn:function(e){this.btnNode.active=e,this.infoUI&&(this.infoUI.active=e)},hideOtherBtn:function(e){this.removeLabel(),this.finishNode.active=e,this.startNode.active=e,this.titleNode.active=e,this.bottomUI&&this.bottomUI.setEnabled(e)},hideJoystickBtn:function(e){this.joystick&&this.joystick.setVisible(e)},updateJoystickBtn:function(e,t){var i=this.joystick;i&&(void 0!==e&&i.jumpBtn.getComponent("JoyButton").setType(e),void 0!==t&&i.shotBtn.getComponent("JoyButton").setType(t))},removeDialog:function(e){this.coverCount--,0==this.coverCount&&this.dialogCover.runAction(cc.sequence(cc.fadeOut(.2),cc.destroySelf()));var t=this.dialogCover.getComponent("Film");e&&(t.hideDark(),e.remove())},createDialog:function(e,t,i,a,n,o){if(this.coverCount)this.coverCount++;else{this.coverCount=1;var r=cc.instantiate(this.filmPrefab);this.addToUI(r,1e3),this.dialogCover=r}var s=this.dialogCover.getComponent("Film");if(o&&(1==o?s.showFilm():2==o&&s.hideFilm()),t||i||a){this.dialogIndex++,s.showDark();var c=cc.instantiate(this.dialogPrefab);this.addToUI(c,1001);var l=c.getComponent("Dialog");return l.init({effectMgr:this.game.effectMgr,face:e,anime:t,str:i,x:a,t:n,index:this.dialogIndex}),l}},createInfoLabel:function(e,t,i){var a=this;if(void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=50),!(n=this.infoUI)){var n=cc.instantiate(this.infoPrefab);this.addToUI(n),this.infoUI=n}e=e.replace(/\[.+?\]/g,function(e){if("attack"==e.substr(1,e.length-2)){var t=new cc.Node;n.addChild(t,-1),t.width=40,t.height=50;var i=a.game.effectMgr.createSprite(0,0,"effect/locked_point");t.addChild(i),i.opacity=255,i.scale=2,i.color=cc.color(255,0,0),i.runAction(cc.sequence(cc.scaleTo(.5,.8*i.scale),cc.scaleTo(.3,1.2*i.scale)).repeatForever())}return""}),n.getChildByName("label").getComponent(cc.RichText).string=e,n.opacity=0,n.scale=1.2,n.x=t,n.y=i,n.stopAllActions(),n.runAction(cc.spawn(cc.scaleTo(.4,1).easing(cc.easeBounceOut()),cc.fadeIn(.3)))},removeInfoLabel:function(){this.infoUI&&(this.infoUI.destroy(),delete this.infoUI,cc.log("removeInfoLabel"))},callDialog:function(){},callMainQuest:function(e){var t=this.questNode.getChildByName("main");if(!e&&t.opacity>0)return t.stopAllActions(),void t.runAction(cc.spawn(cc.moveTo(.3,t.x0,t.y),cc.fadeOut(.3)).easing(cc.easeIn(1)));var i=t.getChildByName("label").getComponent(cc.Label);t.opacity<255?(i.string=e,t.stopAllActions(),t.runAction(cc.spawn(cc.moveTo(.2,t.x1,t.y),cc.fadeIn(.2)).easing(cc.easeOut(1)))):t.runAction(cc.sequence(cc.spawn(cc.moveTo(.1,(t.x1+t.x0)/2,t.y),cc.fadeOut(.1)),cc.callFunc(function(){i.string=e},this),cc.spawn(cc.moveTo(.1,t.x1,t.y),cc.fadeIn(.1)).easing(cc.easeOut(1))))},callArea:function(e){var t=new cc.Node;this.addToCamera(t,ZORDER.NORMAL);var i=t.addComponent(o);i.init(this.game,e),e.pointUI=i},removeArea:function(e){var t=e.pointUI;t&&(t.remove(),delete e.pointUI)},callQuest:function(){},removeQuest:function(e){var t=e.questUI;t&&(t.remove(this.questList),delete e.questUI)},onPause:function(){var e=this.game;e&&e.config.pauseFunc?e.config.pauseFunc(e):menuManager.back()},onRestart:function(){var e=this.game;e&&e.config.restartFunc?e.config.restartFunc(e):menuManager.refresh()}}),cc._RF.pop()},{"../../components/visual/ArmatureAvatar":"ArmatureAvatar","../../components/visual/VirtualAvatar":"VirtualAvatar","../../entities/characters/HumanAvatar":"HumanAvatar","../../entities/projectiles/BulletSprite":"BulletSprite","../../scripts/AreaPoint":"AreaPoint","../../scripts/Theme":"Theme"}],GameMenu:[function(e,t){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","GameMenu");var i=e("../../../Plugins/firebase/FirebaseTracking"),a=e("../../../Plugins/SDKManager");cc.Class({extends:e("../core/Menu"),properties:{fadeOutPrefab:cc.Prefab,label:{default:null,type:cc.Label},map:{default:null,type:cc.JsonAsset},noTopBar:!0,gameLayer:cc.Node},onDestroy:function(){try{this.game&&(this.game.onExit(),this.game.clear())}catch(e){cc.error("GameMenu.onDestroy",e.fileName+":"+e.lineNumber+"\n"+e.message+"\n\n"+e.stack)}},initStatus:function(t){var i=e("../../managers/GameSystem"),a=this.gameLayer.getComponent("GameLayer");try{a.init(),(this.game=new i).init(t,a)}catch(n){kit.error(n)}},start:function(){a.SDKManager.Instance.CurrentScreen="Gameplay";var e=this,t=this.game.config.mapIndex;this.game.config.chapterIndex,this.game.config.mapLength;var n=this.game.config.mapIndex+1;if("Minigame"==i.FirebaseTracking.gameMode){var o="mini_"+n;o=o.replace(" ",""),i.FirebaseTracking.levelID=o}else{var r=this.game.config.chapterIndex+1;i.FirebaseTracking.levelID="c"+r+"_"+n}console.log("======== level id : "+i.FirebaseTracking.levelID),this.game.onEnter(),this.game.config.gunnerMode&&0==t&&this.game.callFuncDelay(function(){e.game.levelMgr.heroes[1].avatar.node.convertToWorldSpaceAR(cc.v2(0,0));var t=e.addGuideButton(null,null,cc.size(3333,3333),cc.v2(100,cc.winSize.height/2));e.longTimeNoTouchBtn=t;var i={head:"h99",dy:380,dx:-160,dragBetween:cc.v2(0,-100),size:cc.size(3333,3333),dragBetweenLinePos:{dx:320,dy:1},z:998};menuManager.focusOn(t,LI("guide_59"),14,function(){},1,i)}.bind(this),1)},addGuideButton:function(e,t,i,a,n,o){void 0===n&&(n=0),void 0===o&&(o=0);var r=this.game.layer.joystick,s=(this.game.layer.camera,a),c=new cc.Node;return c.width=3333,c.height=333,i&&(c.width=i.width,c.height=i.height),c.x=s.x,c.y=s.y,c.onTouchBegan=function(){},c.onTouchMoved=function(){},c.onTouchEnded=function(){},c.onTouchCanceled=function(){},r.btnList.push(c),r.node.addChild(c),c},addTower:function(e,t,i){void 0===i&&(i=0);var a=this.game.levelMgr.heroes[1];e=e||"machine_gun",t=t||"h2",chapter.data.tank.push({weapon:e,weaponLvl:1,operator:t}),a.addHero({s:0,i:t},i),a.addTower({s:0,hp:150,i:ItemDefine[e].gameId,m:!0},i)},addBench:function(e){var t=this.game.levelMgr.heroes[1],i=[];i.push({s:0,i:e}),t.avatar.addBench(i),chapter.data.bench.push(e)}}),cc._RF.pop()},{"../../../Plugins/SDKManager":"SDKManager","../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../managers/GameSystem":"GameSystem","../core/Menu":"Menu"}],GameResCache:[function(e,t){"use strict";cc._RF.push(t,"f13a8IYLwhCcZrCb/u+ARQC","GameResCache"),cc._RF.pop()},{}],GameSystem:[function(e,t){"use strict";cc._RF.push(t,"7836aK81eNKcZJLdE9vPpa1","GameSystem");var i=e("../../Plugins/firebase/FirebaseTracking"),a=e("../../Plugins/SDKManager"),n=e("../core/utils/CoreMath"),o=e("./EffectManager"),r=e("../scripts/Sync"),s=e("../scripts/NetSync"),c=e("../entities/characters/Pilot"),l=(e("../scripts/VirtualLayer"),e("./ContactManager")),d=e("./EventManager"),h=e("./LevelManager");cc.Class({init:function(e,t){this.randomSeed=e.seed||0,cc.log("this.randomSeed",this.randomSeed),this.config=e,this.updateList=[],this.renderList=[],this.core=new n,this.effectMgr=e.effectMgr||new o,this.contactMgr=new l,this.eventMgr=new d,this.levelMgr=new h,this.step=0,this.frmTimer=0,this.rTimer=STEP_TIME,this.speed=1,this.baseTimeScale=1,this.minTimeScale=1,this.timeScale=this.minTimeScale*this.baseTimeScale,this.timeScaleStack=[],this.pvp=e.pvp,this.netMode=e.rid,this.team=e.team||0,this.me=e.me||1,DEV_MODE&&DEBUG_MODE&&(this.max_dt=0,this.sum_dt=0,this.ct_dt=0,this.avg_dt=0,this.updateProto=this.update,this.update=function(e){this.max_dt=Math.max(this.max_dt,e),this.ct_dt++,this.sum_dt+=e,this.sum_dt>=1&&(this.avg_dt=this.sum_dt/this.ct_dt,this.sum_dt=0,this.ct_dt=0),this.updateProto(e)}),this.mapData=e.mapData,this.remotes=e.remotes,cc.audioEngine.stopAll(),this.playBgm("sound/bgm/1",.7*BGM_VOLUME),this.initMap(t)},initMap:function(e){this.layer=e;var t=this.config,i=this.mapData;this.team=0;var a=i.entity;for(var n in a){var o=a[n];o.me==this.me&&(this.team=o.team||0,this.flipX=o.flipX)}this.replayData=!!t.actionList,t.rid?(this.sync=new s,this.sync.init(this,t.rid)):(this.sync=new r,this.sync.init(this,t.actionList)),this.effectMgr.initMap(this),this.core.initMap(this,this.randomSeed),this.contactMgr.initMap(this,i),this.eventMgr.initMap(this,i),e.initMap(this,i),this.levelMgr.initMap(this,i)},continue:function(e){cc.log("game.continue"),this.finished=!1,this.mapData=e,this.levelMgr.continue(e),console.log("========= continue minigame")},clear:function(){this.effectMgr.clear(),delete this.core,delete this.effectMgr,delete this.contactMgr,delete this.eventMgr,delete this.levelMgr,delete this.sync},start:function(){try{var e=this.config.startFunc;e&&e(this),this.layer.start()}catch(c){cc.error("game.start",c.fileName+":"+c.lineNumber+"\n"+c.message+"\n\n"+c.stack)}if("Minigame"==i.FirebaseTracking.gameMode||i.FirebaseTracking.isContinue){console.log("======= level id : "+i.FirebaseTracking.levelID);var t=i.FirebaseTracking.levelID;a.SDKManager.Instance.handleLevelStart(t);var n=a.SDKManager.Instance.getAttempts(t),o=a.SDKManager.Instance.generateUniqueID(t);i.FirebaseTracking.levelID=t;var r=1;if(this.config&&this.config.remotes&&this.config.remotes.entity&&this.config.remotes.entity[1]){var s=this.config.remotes.entity[1];void 0!==s.hp&&(r=parseFloat(s.hp.toFixed(1)),console.log("[GameSystem] HP for game_start:",s.hp,"=>",r))}i.FirebaseTracking.logGameStart(o,n,r)}i.FirebaseTracking.curStage=this.config.mapIndex+1,console.log("======= Current Stage : "+i.FirebaseTracking.curStage)},callFinish:function(e,t){if(cc.log("game.callFinish"),console.log("========= mini game callFinish 00000000"),!this.finished){console.log("========= mini game callFinish 1111111111111"),this.finished=!0;var i=this.config.finishFunc;i&&i(this,e)?console.log("========= mini game callFinish 2222222222222"):(console.log("========= mini game callFinish 33333333333333"),this.layer.callFinish(e,t))}},onEnter:function(){this.sync.onEnter()},onExit:function(){cc.audioEngine.stopAll(),this.levelMgr.onExit(),this.sync.onExit()},setSpeed:function(e){this.speed=e},setTimeScale:function(e){this.baseTimeScale=e,this.timeScale=e*this.minTimeScale},pushTimeScale:function(e){this.timeScaleStack.push(e),e<this.minTimeScale&&(this.minTimeScale=e,this.timeScale=this.baseTimeScale*e,this.minTimeScale<=0&&cc.audioEngine.pauseAllEffects())},popTimeScale:function(e){for(var t=this.timeScaleStack,i=0;i<t.length;i++)if(t[i]==e){t.splice(i,1);break}if(e<=this.minTimeScale){var a=1;for(i=0;i<t.length;i++)t[i]<a&&(a=t[i]);this.minTimeScale=a,this.timeScale=this.baseTimeScale*a,this.minTimeScale>0&&cc.audioEngine.resumeAllEffects()}},addRender:function(e){e._inRenderList||(e._inRenderList=!0,this.renderList.push(e)),e._needRemoveRender=!1},removeRender:function(e){e._needRemoveRender=!0},addUpdate:function(e){e._inUpdateList||(e._inUpdateList=!0,this.updateList.push(e)),e._needRemoveUpdate=!1},removeUpdate:function(e){e._needRemoveUpdate=!0},callFuncDelay:function(e,t){var i=t,a={updateLogic:function(t){if((i-=t)<=0)return e(),!0}};this.addUpdate(a)},update:function(e){if(!((e*=this.timeScale*this.speed)<=0))if(this.sync.update(e),e>=2*STEP_TIME){for(this.frmTimer+=e;this.frmTimer>=STEP_TIME;)this.frmTimer-=STEP_TIME,this.updateLogic(STEP_TIME);this.updateReal(this.rTimer)}else this.frmTimer+=e,this.frmTimer>=STEP_TIME?(this.frmTimer-=STEP_TIME,this.updateReal(e-this.frmTimer),this.updateLogic(STEP_TIME),this.updateReal(this.frmTimer)):this.updateReal(e)},updateReal:function(e){this.rTimer>0&&e>0&&(this.rTimer<e?(this.layer.updateReal(this.rTimer),this.rTimer=0):(this.layer.updateReal(e),this.rTimer-=e))},updateLogic:function(e){if(!this.sync.updateLogic(e)){this.step+=1,this.rTimer=STEP_TIME,this.levelMgr.update(e),this.contactMgr.update0(e);for(var t=this.updateList,i=0,a=t.length;i<a;i++){var n=t[i];n.updateLogic||cc.log(n,n.define.name),(n._needRemoveUpdate||n.updateLogic(e))&&(n._inUpdateList=!1,n._needRemoveUpdate=!1,t.splice(i,1),i-=1,a-=1)}this.contactMgr.update1(e),this.updateRender(e)}},updateRender:function(e){for(var t=this.renderList,i=0,a=t.length;i<a;i++){var n=t[i];(n._needRemoveRender||n.updateRender(e))&&(n._inRenderList=!1,n._needRemoveRender=!1,t.splice(i,1),i-=1,a-=1)}},addAvatar:function(e,t,i){return this.layer.addAvatar(e,t,i)},addBulletSprite:function(e,t,i){return this.layer.addBulletSprite(e,t,i)},addPilot:function(e,t,i){this.config;var a=this.layer.addHeroUI(e,t,i),n=new c;return n.init(this,e,t,i,a),n},callEffect:function(e,t,i,a,n,o,r){if(e)return e.call(this.effectMgr,t,i,a,n,o,r)},playEffect:function(e,t,i){return this.effectMgr.playEffect(e,t,i)},playBgm:function(e,t){void 0===t&&(t=BGM_VOLUME),cc.log("playBgm",e,this.bgm),this.effectMgr.playMusic(e,!0,t,function(){})},getEntityList:function(){return this.levelMgr.entityList},c_rnd:function(e,t){return this.core.c_rnd(e,t)},c_rndInt:function(e,t){return this.core.c_rndInt(e,t)},getChapterIndex:function(){return this.config.chapterIndex},getLevelIndex:function(){return this.config.mapIndex}}),window.loadGame=function(e){try{e.noWait=!0,menuManager.run("loading",e)}catch(t){cc.log(t)}},cc._RF.pop()},{"../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../core/utils/CoreMath":"CoreMath","../entities/characters/Pilot":"Pilot","../scripts/NetSync":"NetSync","../scripts/Sync":"Sync","../scripts/VirtualLayer":"VirtualLayer","./ContactManager":"ContactManager","./EffectManager":"EffectManager","./EventManager":"EventManager","./LevelManager":"LevelManager"}],GarageDefine:[function(e,t){"use strict";cc._RF.push(t,"f332evTeKZIIbp8vFyRTMth","GarageDefine"),window.GarageDefine={a:{talent:[{id:"hp",num:50,unlockLvl:5},{id:"hp",num:50,unlockLvl:10},{id:"hp",num:50,unlockLvl:15}]}},cc._RF.pop()},{}],GaragePage:[function(e,t){"use strict";cc._RF.push(t,"188d7+OVTFEKr+n444NqD6k","GaragePage");var i=e("../../Plugins/firebase/FirebaseTracking"),a=e("../utils/AnimUtils");cc.Class({extends:e("../ui/core/Menu"),properties:{avatarNode:cc.Node,starNode:cc.Node,nameLabel:cc.Label,upgradeBtnNode:cc.Node,powerLabel:cc.Label,attrNodes:[cc.Node],propertyNodes:[cc.Node],partLabel:cc.Label,partSprite:cc.Sprite,selectBtnNode:cc.Node,leftBtnNode:cc.Node,rightBtnNode:cc.Node,attrBoard:cc.Node,lockBoard:cc.Node,partLockLabel:cc.Label,partLockSprite:cc.Sprite,lockIconNode:cc.Node,unlockBtnNode:cc.Node,upgradeAnime:cc.Animation,linkBtnNode:cc.Node,infoBtnNode:cc.Node,leftMsgBoard:cc.Node,rightMsgBoard:cc.Node,lvlNode:cc.Node,lvlLabel:cc.Label,atkLabel:cc.Label,hpLabel:cc.Label,attrGlobalItemInstance:cc.Node,attrGlobalLayeoutNode:cc.Node,adUpgradeBtnCtLabel:cc.Label},onLoad:function(){var e;this.topVisible=((e={})[EXP]=!0,e[DIAMOND]=!0,e[SWEEP_TICKET]=!1,e[ENERGY]=!1,e[TALENT]=!1,e),this.currentSuggestion=null,this.scheduleOnce(this.handleTaskNavigationSuggestion,.5)},handleTaskNavigationSuggestion:function(){if(window._taskNavGarageType){var e=window._taskNavGarageType,t=null;"upgrade"===e&&this.attrNodes&&this.attrNodes[0]?t=this.attrNodes[0]:"starup"===e&&this.upgradeBtnNode&&(t=this.upgradeBtnNode),window._taskNavGarageType=null,t&&(console.log("[GaragePage] Showing suggestion on target node, duration:",duration),this.currentSuggestion=a.showHandSuggestion(t,this.node,{offsetX:0,offsetY:0,duration:5,moveDistance:20,moveSpeed:.5}))}},dismissSuggestion:function(){this.currentSuggestion&&(this.currentSuggestion.handNode&&cc.isValid(this.currentSuggestion.handNode)?this.currentSuggestion.handNode.destroy():console.log("[GaragePage] Hand node not yet loaded or already destroyed"),this.currentSuggestion=null)},updateRedPoint:function(){var e=0;if(!(DEV_MODE&&DEBUG_MODE||pc.isChapterDone(5)))return e;var t=excel.read("vehicle_list");for(var i in t){var a,n=t[i].id,o=pc.getVehicle(n),r=pc.getVehicleData(n);a=o?o.star:0;var s=[SHARD]+"."+n,c=money.getNum(s),l=pc.getHeroUpgradePrice(a);a<9&&c>=l&&e++;var d=["atk"];for(var h in d){var u=d[h],p=o&&o[u]||0;pc.isVehicleLinked(n)&&(p=pc.getMaxLevel(u));var f=excel.read("vehicle_"+r.attr);if(f[p+1]){var m=EXP,g=f[p].price;a&&money.had(m,g)&&e++}}}return e},initStatus:function(){var e=this,t=excel.read("vehicle_list");if(this.dismissSuggestion(),void 0===this.vehicleIndex)for(var i in this.vid=pc.getChooseVehicle().id,this.vehicleIndex=0,t)t[i].id==this.vid&&(this.vehicleIndex=i);else this.vid=t[this.vehicleIndex].id;this.initVehicle(),this.initVehicleRed(),this.leftBtnNode.onTouch=function(){e.vehicleIndex--,e.vehicleIndex<0&&(e.vehicleIndex=t.length-1),e.vid=t[e.vehicleIndex].id,e.initVehicle(),e.initVehicleRed(),e.updateAttrGlobalItem()},this.rightBtnNode.onTouch=function(){e.vehicleIndex++,e.vehicleIndex>=t.length&&(e.vehicleIndex=0),e.vid=t[e.vehicleIndex].id,e.initVehicle(),e.initVehicleRed(),e.updateAttrGlobalItem()},this.linkBtnNode.onTouch=function(){menuManager.pop("link",{refreshCb:function(){e.initVehicle()}})},this.initAttrGlobal(),this.checkAdCt(),this.initGuide()},initVehicleRed:function(){excel.read("vehicle_list"),this.leftBtnNode.getChildByName("rp").active=!1,this.rightBtnNode.getChildByName("rp").active=!1},initVehicle:function(){var e,t=this,i=this.vid,a=pc.getVehicle(i),n=pc.getVehicleData(i);cc.log("initVehicle",a,n),e=a?a.star:0;var o=this.avatarNode.getChildByName("vehicle_model").getComponent("VehicleModel");o.vid!=i&&(o.vid=i,o.init(n,{})),e&&o.play("stand"),o.setGray(!e);var r=n.leftMsg,s=n.rightMsg;this.leftMsgBoard.active=r,this.rightMsgBoard.active=s,r&&(this.leftMsgBoard.getChildByName("label").getComponent(cc.Label).string=r),s&&(this.rightMsgBoard.getChildByName("label").getComponent(cc.Label).string=s);var c=[SHARD]+"."+i,l=money.getNum(c),d=pc.getHeroUpgradePrice(e);this.nameLabel.string=LI("vehicle_"+i),this.lockIconNode.active=!e,this.attrBoard.active=e,this.lockBoard.active=!e,this.lvlNode.active=e;for(var h=this.starNode.getChildren(),u=0;u<9;u++)h[u].active=u<e;e?(e<9?(this.partSprite.fillRange=l/d,this.partLabel.string=l+"/"+d):(this.partSprite.fillRange=0,this.partLabel.string=l+"/ - - -"),this.selectBtnNode.onTouch=function(){pc.getChooseVehicle().id!=i?(pc.setChooseVehicle(i),t.selectBtnNode.color=cc.color(80,80,80)):kit.info(LI("vehicle_ready_msg"))},pc.getChooseVehicle().id!=i?(this.selectBtnNode.color=cc.color(255,255,255),this.selectBtnNode.getChildByName("name").color=cc.color(255,255,255)):(this.selectBtnNode.color=cc.color(80,80,80),this.selectBtnNode.getChildByName("name").color=cc.color(80,80,80)),this.upgradeBtnNode.getChildByName("rp").active=e<9&&l>=d,this.upgradeBtnNode.onTouch=function(){menuManager.pop("vehicle_unlock",{vid:i,refreshCb:function(){t.initVehicle()}})},this.infoBtnNode.onTouch=function(){menuManager.pop("vehicle_unlock",{vid:i,refreshCb:function(){t.initVehicle()}})}):(this.partLockSprite.fillRange=l/d,this.partLockLabel.string=l+"/"+d,this.unlockBtnNode.getChildByName("rp").active=l>=d,this.infoBtnNode.onTouch=function(){kit.info(LI("vehicle_lock_msg"))},this.unlockBtnNode.onTouch=function(){e>=5?kit.info(LI("tip_max")):menuManager.pop("vehicle_unlock",{vid:i,refreshCb:function(){t.initVehicle()}})});var p=["atk"];for(var f in p)this.initVehicleAttr(this.attrNodes[f],p[f])},initAttrGlobal:function(){if(this.attrGlobalInited)this.updateAttrGlobalItem();else{this.attrGlobalInited=!0;var e=this.vid,t=pc.getVehicle(e),i=pc.getVehicleData(e).attrGlobal,a=t&&t.atk||0;for(var n in cc.log("attrGlobal",i),i){var o=cc.instantiate(this.attrGlobalItemInstance);o.active=!0,this.attrGlobalLayeoutNode.addChild(o),o.attr=i[n],i[n].atk?o.getChildByName("des").getComponent(cc.Label).string=LI("car_bonus_atk",{n:100*i[n].atk}):i[n].hp&&(o.getChildByName("des").getComponent(cc.Label).string=LI("car_bonus_hp",{n:100*i[n].hp})),o.getChildByName("lvl").getComponent(cc.Label).string=LI("pass_lvl",{n:i[n].lvl}),i[n].lvl>a&&(o.getChildByName("lock").active=!0,o.getChildByName("des").opacity=128)}}},updateAttrGlobalItem:function(){var e=this.vid,t=pc.getVehicle(e),i=(pc.getVehicleData(e),t&&t.atk||0),a=this.attrGlobalLayeoutNode.children;for(var n in a){var o=a[n];o.attr.lvl>i?(o.getChildByName("lock").active=!0,o.getChildByName("des").opacity=128):(o.getChildByName("lock").active=!1,o.getChildByName("des").opacity=256)}},checkAdCt:function(){var e=this;cc.log("garage checkAdCt",sdk.now()>garage.refreshTime,sdk.now(),garage.refreshTime),sdk.now()>garage.refreshTime&&net.updateData({set:{garage_refreshTime:kit.getNextDate(sdk.now()).getTime(),garage_adUpgradeCt:3,garage_adShardCt:3}},function(t,i){garage.setOnlineData(i.doc),e.updateAdUpgradeBtn()}),this.updateAdUpgradeBtn()},updateAdUpgradeBtn:function(){var e=garage.adUpgradeCt;cc.log("garage updateAdUpgradeBtn",e),this.adUpgradeBtnCtLabel.string=LI("times_available_3",{n:e})},adUpgradeBtnClick:function(e){garage.adUpgradeCt<=0?kit.info(LI("tip_timesout")):this.attrNodes[0].onTouch(e,!0)},initVehicleAttr:function(e,t){var a,n=this,o=this.vid,r=pc.getVehicle(o),s=pc.getVehicleData(o);a=r?r.star:0;var c=r&&r[t]||0;cc.log("initVehicleAttr",r,c,t),pc.isVehicleLinked(o)&&(c=pc.getMaxLevel(t));var l=20*a,d=excel.read("vehicle_"+s.attr);this.lvlLabel.getComponent(cc.Label).string=c+"/"+l;var h=pc.getVehicleAttr(o);this.atkLabel.string=kit.abbr(100*(+h.atk-1))+"%",this.hpLabel.string=kit.abbr(100*(+h.hp0-1))+"%";var u=!!d[c+1],p=e;if(u){var f=EXP,m=d[c].price;p.getChildByName("num").getComponent(cc.Label).string=kit.abbr(m),p.getChildByName("rp").active=a&&money.had(f,m);var g=function(t){!t&&money.check(f,m)||((r=r||{id:o,star:1}).atk=c+1,net.updateData({price:!t&&{i:f,n:m}||{i:"garage_adUpgradeCt",n:1},vehicles:[r]},function(a,o){cc.log("garagePage upgrade onTouch",o),t&&(garage.adUpgradeCt=o.doc.garage_adUpgradeCt||0),n.updateAdUpgradeBtn(),i.FirebaseTracking.setDataBiRes("GarageUpgrade"),money.update(o),n.initVehicle(),window.TaskManager&&window.TaskManager.completeTask("task_3"),n.upgradeAnime.node.y=e.y-100,n.upgradeAnime.play(),n.lvlLabel.node.runAction(cc.sequence(cc.scaleTo(.1,3),cc.scaleTo(.2,1))),t||cc.game.emit("use_money",{i:f,n:-m,pos:p.convertToWorldSpaceAR(cc.v2(0,0)),tid:"vehicle_upgrade"}),n.updateAttrGlobalItem(),task.addDailyTaskCt("vehicleUpgrade")}))};p.onTouch=function(e,t){a?l<=c?kit.info(LI("tip_vehicle_ascend")):t?sdk.useFree("free_upgrade",function(e){e||(g(!0),YMTJ("video","car_upgrade"))}):g():kit.info(LI("tip_vehicle_lock"))}}else p.getChildByName("num").getComponent(cc.Label).string=LI("level_max"),p.onTouch=function(){kit.info(LI("level_max_msg"))},p.getChildByName("rp").active=!1},initGuide:function(){if(console.log("initGuide Gara"),console.log(user.getGuide("guideGara"),pc.isChapterDone(3)),1!=user.getGuide("guideGara")&&pc.isChapterDone(3)){var e=this,t=this.node.parent.convertToWorldSpaceAR(cc.Vec3.ZERO);t.y-=150;var i=function(){menuManager.focusOn(e.upgradeBtnNode,LI("zc_guide_42"),2.5,function(){},null,{pos:t,size:new cc.Size(500,230),dx:-100,dy:200,noFinger:!0})};menuManager.focusOn(e.attrNodes[0],LI("zc_guide_41"),function(){menuManager.focusOn(e.upgradeBtnNode,null,function(){i()},null,null,{dx:-100,dy:100,noFinger:!1})},null,null,{dx:-100,dy:-200})}}}),window.garage={setOnlineData:function(e){null!=e.garage_adUpgradeCt?garage.adUpgradeCt=e.garage_adUpgradeCt:garage.adUpgradeCt=3,null!=e.garage_adShardCt?garage.adShardCt=e.garage_adShardCt:garage.adShardCt=3,garage.refreshTime=e.garage_refreshTime||0,cc.log("garage setOnlineData",e)}},cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/Menu":"Menu","../utils/AnimUtils":"AnimUtils"}],GetItemInfo:[function(e,t){"use strict";cc._RF.push(t,"6abccibKghJhKGFnnpuIv+o","GetItemInfo"),cc.Class({extends:cc.Component,properties:{title:cc.Node,icon:cc.Node,des:cc.Node},init:function(e){this.game=e.game;var t=e.itemId,i=ItemDefine[t],a=i.lvl||1;this.icon.addComponent("checkpointAvatar").init(i,a||i.lvl,this.game,!0),this.node.runAction(cc.sequence(cc.delayTime(2),cc.destroySelf()))}}),cc._RF.pop()},{}],GiftCodeMenu:[function(e,t){"use strict";cc._RF.push(t,"c6c5aEqahVBoKKEdpfHbvYR","GiftCodeMenu");var i=e("../../Plugins/firebase/FirebaseTracking");ENERGY,EQUIPMENT,GOLD,DIAMOND,ENERGY,EQUIPMENT,DIAMOND,SHARD,GOLD,cc.Class({extends:e("../ui/core/PopMenu"),properties:{editBox:cc.EditBox},initStatus:function(e){this.editBox.string="",e.code&&(this.editBox.string=e.code)},onCheck:function(){var e=this,t=this.editBox.string;t?net.post("getGiftCode",{code:t},function(i,a){if(!i)return"no_code"===a.res?kit.info("\u65e0\u6548\u7684\u5151\u6362\u7801"):"used"===a.res?kit.info("\u5df2\u7ecf\u4f7f\u7528\u8fc7\u540c\u7c7b\u5151\u6362\u7801\u4e86"):"fail"===a.res?kit.info("\u5151\u6362\u5931\u8d25"):void(a.dev?(window.streamerMode?H5VERSION=1:DEV_MODE=1,user.logout()):(money.update(a),e.costCode(t,a.items)))}):kit.info(LT("\u8bf7\u8f93\u5165\u5151\u6362\u7801"))},costCode:function(e,t){var a=this;if(t){if(user.getGuide("giftCode_"+e))return void kit.info("\u5df2\u7ecf\u5151\u6362\u8fc7\u4e86");user.setGuide("giftCode_"+e,1);var n=[];equipment.getItemFromReward(n,t),cc.log("giftCode",e,n),net.updateData({items:n},function(t,o){cc.log("giftCode cb ",e,o),t?kit.info("\u5151\u6362\u5931\u8d25"):(i.FirebaseTracking.setDataBiRes("GiftCode"),money.update(o),n&&(a.editBox.string="",menuManager.pop("show",{items:n,checkCb:function(){}})))})}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],GreenDiamondMenu:[function(e,t){"use strict";cc._RF.push(t,"a04c1gV0elKPqRp57UFmBPg","GreenDiamondMenu");var i=e("../../Plugins/firebase/FirebaseTracking"),a={1:[{i:GOLD,n:500}],2:[{i:GOLD,n:1e3}],3:[{i:ENERGY,n:10}],4:[{i:DIAMOND,n:100}]},n={1:[{i:SWEEP_TICKET,n:10},{i:GOLD,n:600}],2:[{i:SWEEP_TICKET,n:10,daily:1},{i:GOLD,n:1800}],3:[{i:SWEEP_TICKET,n:20,daily:1},{i:"bigbox",n:1}],4:[{i:SWEEP_TICKET,n:30,daily:1},{i:"bigbox",n:3}]};cc.Class({extends:e("../ui/core/PopMenu"),properties:{freeNodes:[cc.Node],greenDiamondNodes:[cc.Node]},initStatus:function(){this.updateUI(),this.checkGreenDiamondReward(),user.getGuide("greenDiamond")||(user.setGuide("greenDiamond",1),YMTJ("lv","spe_enter"))},isGreenDiamond:function(){return!0},checkGreenDiamondReward:function(){var e,t=this,a=[];for(var o in n){var r="greenDiamond_reward"+o;2==daily[r]&&this.isGreenDiamond()&&(n[o][0].daily&&a.push(n[o][0]),e||(e={}),e["daily_"+r]=1)}e&&net.updateData({set:e,items:a},function(e,n){e||(cc.log("checkGreenDiamondReward cb",n),null!=n.doc["daily_"+r]&&(daily[r]=n.doc["daily_"+r],i.FirebaseTracking.setDataBiRes("GreenDiamondReward"),money.update(n),menuManager.pop("loot",{items:a,tid:"greenDiamond_reward",tname:"\u7eff\u94bb\u6bcf\u65e5\u5956\u52b1"})),t.updateUI())})},onAdFreeBtn:function(e,t){var n=this;void 0===t&&(t=1);var o="greenDiamond_free"+t;!daily[o]||daily[o]<1?kit.info("\u4eca\u65e5\u6b21\u6570\u7528\u5b8c\uff01"):sdk.useFree("spe_video",function(e){var r,s;if(!e){var c=a[t];cc.log("onAdFreeBtn",daily[o],"daily_"+o),net.updateData({min:daily[o]&&(r={},r["daily_"+o]=1,r),add:daily[o]&&(s={},s["daily_"+o]=-1,s),items:c},function(e,t){e||(cc.log("onAdFreeBtn cb",t),null!=t.doc["daily_"+o]&&(daily[o]=t.doc["daily_"+o],i.FirebaseTracking.setDataBiRes("GreenDiamondAds"),money.update(t),menuManager.pop("loot",{items:c,tid:"greenDiamond_free",tname:"\u7eff\u94bb\u514d\u8d39"})),n.updateUI(),YMTJ("video","spe_video"))})}})},onGreenDiamondBtn:function(e,t){var a=this;void 0===t&&(t=1),sdk.getGameReward(t,function(e){var o,r,s;if(console.log("sdk.getGameReward",t,e),!e){var c="greenDiamond_pay"+t;if(!daily[c]||daily[c]<1)kit.info("\u4eca\u65e5\u6b21\u6570\u7528\u5b8c\uff01");else{var l=[n[t][0]];if("bigbox"==n[t][1].i)for(var d=1;d<=n[t][1].n;d++)equipment.getItemFromReward(l,BIG_BOX_DROP_LIST[boxLvl.getLvl()]);else l.push(n[t][1]);cc.log("onGreenDiamondBtn",daily[c],"daily_"+c);var h=((o={})["daily_greenDiamond_reward"+t]=1,o);net.updateData({set:h,min:daily[c]&&(r={},r["daily_"+c]=1,r),add:daily[c]&&(s={},s["daily_"+c]=-1,s),items:l},function(e,n){e||(cc.log("onGreenDiamondBtn cb",n),null!=n.doc["daily_"+c]&&(daily[c]=n.doc["daily_"+c],daily["greenDiamond_reward"+t]=n.doc["daily_greenDiamond_reward"+t],i.FirebaseTracking.setDataBiRes("GreenDiamondButton"),money.update(n),menuManager.pop("loot",{items:l,tid:"greenDiamond_free",tname:"\u7eff\u94bb\u514d\u8d39"}),YMTJ("lv","spe_buy_"+c)),a.updateUI())})}}})},updateUI:function(){for(var e in this.freeNodes){var t="greenDiamond_free"+(+e+1);this.freeNodes[e].getChildByName("info1").active=!!daily[t],this.freeNodes[e].getChildByName("info2").active=!daily[t]}for(var e in this.greenDiamondNodes)t="greenDiamond_pay"+(+e+1),this.greenDiamondNodes[e].getChildByName("info1").active=!!daily[t],this.greenDiamondNodes[e].getChildByName("info2").active=!daily[t]}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],GroundAvatar:[function(e,t){"use strict";cc._RF.push(t,"a737cYDo41DwLhSgzkEau3t","GroundAvatar");var i=e("../../scripts/MeshSprite");cc.Class({extends:cc.Component,initGround:function(e){var t=e.material,i=e.effectMgr,a=e.list,n=e.spriteFrame,o=e.color,r=e.start,s=e.dx,c=e.dy;this.effectMgr=i,this.material=t,this.spriteFrame=n,this.color=o,this.dx=s,this.dy=c,this.initLine(a),this.groundCaches={},this.groundList=[this.createGround(r,null)]},initLine:function(e){void 0===e&&(e=[]),this.list=e,this.leftLine=0,this.rightLine=0,e.length&&(this.leftLine=e[0].y,this.rightLine=e[e.length-1].y)},getCache:function(e){var t=this.groundCaches[e];return t||(t=[],this.groundCaches[e]=t),t},createGround:function(e,t){var a,n=this.spriteFrame,o=n.getRect(),r=o.width;kit.isValue(e)||(e=t-r),kit.isValue(t)||(t=e+r);var s=this.getGroundArr(e,t),c=this.getCache(s.length).pop();c?(a=c.getComponent(i),c.active=!0):(c=new cc.Node,this.node.addChild(c,0),c.color=this.color,(a=c.addComponent(i)).spriteFrame=n,a.setMaterial(0,this.material),c.lengthIndex=s.length),c.setPosition((e+t)/2,this.dy-o.y),c.leftBorder=e,c.rightBorder=t;for(var l=o.x-o.width/2,d=o.y-o.height/2,h=o.y+o.height/2,u=[],p=[],f=s.length,m=0;m<f;m++){var g=l+(s[m].x-s[0].x),v=d+s[m].y;u.push(cc.v2(g,v)),p.push(cc.v2(g,d))}for(var y=0;y<f;y++){var b=l+(s[f-y-1].x-s[0].x),k=h+s[f-y-1].y;u.push(cc.v2(b,k)),p.push(cc.v2(b,h))}return a.setPoly(u,p),c},getGroundArr:function(e,t){var i=this.list,a=i.length,n=[];if(a<2)return n.push(cc.v2(e,this.leftLine)),n.push(cc.v2(t,this.rightLine)),n;if(e>=i[a-1].x)return n.push(cc.v2(e,this.rightLine)),n.push(cc.v2(t,this.rightLine)),n;if(t<=i[0].x)return n.push(cc.v2(e,this.leftLine)),n.push(cc.v2(t,this.leftLine)),n;for(var o=0,r=0;r<a;r++)if(e<i[r].x){o=r;break}o<=0?n.push(cc.v2(e,this.leftLine)):n.push(cc.v2(e,kit.x4Line(i[o-1],i[o],e)));for(var s=o;s<a;s++){if(!(i[s].x<t))return n.push(cc.v2(t,kit.x4Line(i[s-1],i[s],t))),n;n.push(cc.v2(i[s].x,i[s].y))}return n.push(cc.v2(t,this.rightLine)),n},removeGround:function(e){e.active=!1,this.getCache(e.lengthIndex).push(e)},updateGround:function(e,t){var i=this.groundList,a=i[0],n=i[i.length-1];if(a.leftBorder>e){var o=this.createGround(null,a.leftBorder);i.unshift(o)}else a.rightBorder<e&&(i.shift(),this.removeGround(a));if(n.rightBorder<t){var r=this.createGround(n.rightBorder,null);i.push(r)}else n.left>t&&(i.pop(),this.removeGround(n))},resetGround:function(e){for(var t in this.initLine(e),this.groundList)this.removeGround(this.groundList[t]);this.groundCaches=[],this.groundList=[this.createGround(0,null)]}}),cc._RF.pop()},{"../../scripts/MeshSprite":"MeshSprite"}],Ground:[function(e,t){"use strict";cc._RF.push(t,"1ce5fvRqlJE+4XBeve7brid","Ground"),cc.Class({init:function(e){this.leftLine=0,this.rightLine=0,this.groundParts=[];var t=e.list;t&&t.length&&(this.leftLine=t[0].y,this.rightLine=t[t.length-1].y,t.length>1&&this.initPart(t))},initPartTree:function(e,t,i){if(t==i)return{part:this.groundParts[t]};if((i-t)%2==0){var a=(t+i)/2,n=(e[t].x+e[i].x)/2;return c_abs(e[a].x-n)>c_abs(e[a+1].x-n)&&(a+=1),{mid:e[a].x,left:this.initPartTree(e,t,a-1),right:this.initPartTree(e,a,i)}}var o=(t+i+1)/2;return{mid:e[o].x,left:this.initPartTree(e,t,o-1),right:this.initPartTree(e,o,i)}},createPart:function(e,t,i,a,n){var o={name:e,getGroundDegree:function(){return t},getGroundLeft:function(){return i},getGroundRight:function(){return a}};return cc.js.isNumber(n)?o.getGroundLine=function(){return n}:o.getGroundLine=n,o},initPart:function(e){for(var t=this,i=function(i){var a=e[i-1],n=e[i],o=a.x,r=a.y,s=n.x,c=n.y,l=c_vector2Degree(s-o,c-r);t.groundParts.push(t.createPart("wave"+i,l,o,s,function(e){return r+(e-o)*(r-c)/(o-s)}))},a=1;a<e.length;a++)i(a);var n=e[0].x,o=e[e.length-1].x;this.leftPart=this.createPart("start",0,-1/0,n,this.leftLine),this.rightPart=this.createPart("end",0,o,1/0,this.rightLine),this.leftSide=n,this.rightSide=o,this.groundPartTree=this.initPartTree(e,0,e.length-1)},findGround:function(e){if(this.groundParts.length){if(e<=this.leftSide)return this.leftPart;if(e>=this.rightSide)return this.rightPart;for(var t=this.groundPartTree;!t.part;)t=e<t.mid?t.left:t.right;return t.part}return this},getGroundDegree:function(){return 0},getGroundLine:function(){return this.leftLine},getGroundLeft:function(){return-1/0},getGroundRight:function(){return 1/0},addPlatform:function(e){this.groundList.push(e)}}),cc._RF.pop()},{}],GuideLeaderBoard:[function(e,t){"use strict";cc._RF.push(t,"4469aDjOYBINLTdg6Qs7aQO","GuideLeaderBoard"),cc.Class({extends:e("../core/PopMenu"),properties:{},initStatus:function(){},initGuide:function(){if(1==user.getGuide("progressionTrack")){var e=this,t=this.node.getChildByName("bg_popup"),i=new cc.Node("btn");i.addComponent(cc.Button),i.setContentSize(t.getContentSize()),i.zIndex=999,this.node.addChild(i),menuManager.focusOn(t,null,2,function(){i&&e.node.removeChild(i,!0),menuManager.focusOn(e.node.getChildByName("btn_close"),null,null,function(){e.args&&e.args.checkCb&&(user.setGuide("progressionTrack",2),user.quickSave("guide.progressionTrack",2),e.args.checkCb())},null,null)},null,{noFinger:!0,head:!1})}}}),cc._RF.pop()},{"../core/PopMenu":"PopMenu"}],GuideProgressionTrack:[function(e,t){"use strict";cc._RF.push(t,"828ffNJ2vVH+4REwQnuNggx","GuideProgressionTrack"),cc.Class({extends:e("../../../scripts/ItemMenu"),properties:{guideContent:cc.Node,continueBtn:cc.Node},initStatus:function(){this.initGuide()},initGuide:function(){if(1==user.getGuide("progressionTrack")){var e=this,t=this.node.getChildByName("bg_popup"),i=new cc.Node("btn");i.addComponent(cc.Button),i.setContentSize(t.getContentSize()),i.zIndex=999,this.node.addChild(i),menuManager.focusOn(t,null,2,function(){i&&e.node.removeChild(i,!0),menuManager.focusOn(e.node.getChildByName("btn_close"),null,null,function(){e.args&&e.args.checkCb&&(user.setGuide("progressionTrack",2),user.quickSave("guide.progressionTrack",2),e.args.checkCb())},null,null)},null,{noFinger:!0,head:!1})}}}),cc._RF.pop()},{"../../../scripts/ItemMenu":"ItemMenu"}],Handbook:[function(e,t){"use strict";cc._RF.push(t,"69a1bl9D1VGdKUm66bVp4rN","Handbook"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{formulaNode:cc.Node,questNode:cc.Node,layoutNode:cc.Node},initStatus:function(e){this.game=e&&e.game,this.formulaNode.active=!1,this.questNode.active=!1,this.initUI(1)},onToggle:function(e,t){this.initUI(+t)},popInfoBox:function(e){var t=this,i=ItemDefine[e];cc.resources.load("checkpoint/itemInfoBox",cc.Prefab,function(e,a){var n=cc.instantiate(a);n.getComponent("itemInfoBox").init(t.game,i,i.lvl||1),n.x=0,n.y=0,t.node.addChild(n,1e3)})},initUI:function(e){void 0===e&&(e=1);var t=this;this.layoutNode.destroyAllChildren();var i=function(e,t){cc.log("loadIcon",e,t),cc.resources.load(t,cc.SpriteFrame,function(t,i){e.getComponent(cc.Sprite).spriteFrame=i})},a=function(e,a,n){if(e.active=!0,i(e,EquipmentForgeFormula.getBase(a)),n){var o=EquipmentForgeFormula.getIcon(a);if(o.sprite)i(e.getChildByName("icon"),o.sprite);else{var r=menuManager.createArmature(o.anime,o.animeName,function(){});e.getChildByName("icon").addChild(r),r.scale=.55*ANIME_SCALE,r.y=-25}e.getChildByName("name").getComponent(cc.Label).string=EquipmentForgeFormula.getName(a),e.onTouch=function(){t.popInfoBox(a)}}else e.onTouch=function(){kit.info("\u56fe\u9274\u5c1a\u672a\u70b9\u4eae")}},n=function(e,t,i){e.active=!0,a(e.getChildByName("1"),t[0],i),a(e.getChildByName("2"),t[1],i),a(e.getChildByName("3"),t[2],i)};for(var o in EquipmentForgeFormulaDefine){var r=EquipmentForgeFormulaDefine[o];if(cc.log(r,r[0],EquipmentForgeFormula.getRarity(r[0])),EquipmentForgeFormula.getRarity(r[0])==e)if(EquipmentForgeFormula.isFormulaRecorded(r[0],r[1])){var s=cc.instantiate(this.formulaNode);this.layoutNode.addChild(s),n(s,r,!0)}else{var c=cc.instantiate(this.questNode);this.layoutNode.addChild(c),n(c,r)}}}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],HeadBar:[function(e,t){"use strict";cc._RF.push(t,"91182DhgThEv5YhAzYa2ZRn","HeadBar"),cc.Class({extends:cc.Component,properties:{headIcon:cc.Sprite,headName:cc.Label,honorLabel:cc.Label,honorProgress:cc.ProgressBar,honorIcon:cc.Sprite},onLoad:function(){var e=this;if(cc.game.on("name_change",this.refresh,this),"hago"==CH&&"ar"==LAN){var t=this.node.getComponent(cc.Widget);t.right=t.left,t.isAlignLeft=!1,t.isAlignRight=!0}if(this.honorLabel&&(this.honorLabel.string=pvp.getHonor()),this.honorProgress){var i=pvp.getHonor(),a=0,n=excel.read("pvp_road");for(var o in n){var r=n[o];if(r.icon){if(r.honor>i){var s=(i-a)/(r.honor-a);this.honorProgress.progress=s;break}a=r.honor}}this.honorProgress.progress=0}if(this.honorIcon){var c=pvp.getHonorIcon();cc.resources.load("ui/medal/"+c,cc.SpriteFrame,function(t,i){!t&&cc.isValid(e.honorIcon)&&(e.honorIcon.spriteFrame=i)})}this.refresh()},onCheckLogin:function(){var e=this;user.checkUserInfo(function(t,i){i&&(e.refresh(),menuManager.pop("user_info"))},LI("guest_msg"))},refresh:function(){user.loadUserHead(this.headIcon,user.getUserHeadUrl())},start:function(){}}),cc._RF.pop()},{}],HeroBoard:[function(e,t){"use strict";cc._RF.push(t,"0559dMu+gBEI7o0E41UF9ZR","HeroBoard");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:cc.Component,properties:{humanPrefab:cc.Prefab,heroUpPrefab:cc.Prefab,heroUpPrefab_e:cc.Prefab,heroNode:cc.Node,upgradeArrow:cc.Node,upgradeHp:cc.Label,upgradeAtk:cc.Label,upgradeHpNode:cc.Node,upgradeAtkNode:cc.Node,mainMenuNode:cc.Node,upgradeButton:cc.Button,upgradePrice:cc.Label,upgradeLevel:cc.Label},onLoad:function(){var e=pc.getChooseHero();if(e){var t=pc.getHeroData(e.id),i=pc.getChooseGun(),a=this.heroNode.getComponent("HumanModel");a.init(ENTITY[HUMAN],{face:t.cos,guns:{left_gun:{i:i.id}},shadow:1}),a.runRandomAnime(),this.model=a}this.upgradeHp.string=Math.round(100*pc.getHeroAttr(t,e.lvl).hp),this.upgradeAtk.string="x"+Math.round(1e3*pc.getHeroAttr(t,e.lvl).atk)/10+"%",this.refresh()},onUpgrade:function(){var e=this;if(!this.upgradePost){var t=pc.getChooseHero(),a=t.id,n=pc.getHeroData(a),o=pc.getHeroUpgradePrice(t);o?money.check(GOLD,o)||(this.upgradePost=!0,net.post("updateData",{price:{i:GOLD,n:o},heroes:[{id:a,lvl:t.lvl+1}],income:{max:money.getMaxIncome(),ipm:pc.getIncomePerMinute()}},function(r,s){if(e.upgradePost=!1,!r){pc.setHeroLevel(a,t.lvl+1),i.FirebaseTracking.setDataBiRes("UpgradeHero"),money.update(s),cc.game.emit("use_money",{pos:e.heroNode.convertToWorldSpaceAR(cc.v2(0,0)),i:GOLD,n:-o}),e.refresh();var c=cc.instantiate(e.heroUpPrefab);e.heroNode.addChild(c);var l=cc.instantiate(e.heroUpPrefab_e);e.upgradeHpNode.parent.addChild(l);var d=function(){var e=this.upgradeHpNode;cc.tween(e).to(.3,{scale:1.5},{easing:"backOut"}).call(function(){this.upgradeHp.string=Math.round(100*pc.getHeroAttr(n,t.lvl).hp)},this).to(.1,{scale:1}).start()}.bind(e);l.getComponent("Light2").init(d,e);var h=cc.instantiate(e.heroUpPrefab_e);e.upgradeAtkNode.parent.addChild(h);var u=function(){var e=this.upgradeAtkNode;cc.tween(e).to(.3,{scale:1.5},{easing:"backOut"}).call(function(){this.upgradeAtk.string="x"+Math.round(1e3*pc.getHeroAttr(n,t.lvl).atk)/10+"%"},this).to(.1,{scale:1}).start()}.bind(e);h.getComponent("Light2").init(u,e)}})):kit.info(LI("upgrade_max_msg"))}},refresh:function(){var e=pc.getChooseHero(),t=pc.getHeroData(e.id),i=pc.getHeroAttr(t,e.lvl);if(this.upgradeLevel.string=e.lvl,i.price){var a=pc.getHeroUpgradePrice(e);if(this.upgradePrice.string=a,!this.upgradeEffect){var n=this.upgradeEffect=new cc.Node;this.upgradeButton.node.addChild(n);for(var o=function e(t){t.stopAllActions(),t.x=kit.rnd(-40,100),t.y=kit.rnd(-30,10),t.runAction(cc.sequence(cc.delayTime(kit.rnd(0,1)),cc.spawn(cc.fadeIn(.4),cc.moveBy(.4,0,20)),cc.spawn(cc.fadeOut(.4),cc.moveBy(.4,0,20)),cc.callFunc(e,this)))},r=0;r<5;r++){var s=cc.instantiate(this.upgradeArrow);n.addChild(s),o(s)}}}else this.upgradePrice.string=LI("level_max"),this.upgradeEffect&&(this.upgradeEffect.destroy(),delete this.upgradeEffect)},start:function(){}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],HeroInfo:[function(e,t){"use strict";cc._RF.push(t,"3b0f7p6QwVCNJH3n1fSnQ6S","HeroInfo");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{nameLabel:cc.Label,partLabel:cc.Label,partSprite:cc.Sprite,careerLabel:cc.Label,starsNode:cc.Node,lockBar:cc.Node,unlockBar:cc.Node,newBar:cc.Node,propertyBarNode:cc.Node,upgradeBtnNode:cc.Node,upgradeAnime:cc.Animation,avatarNode:cc.Node,btnLabel:cc.Label},onLoad:function(){this._super(),this.lockBar.active=!1,this.newBar.active=!1,this.unlockBar.active=!1},initStatus:function(e){var t=this;this.initUI(e.hid),2==user.getGuide("chapter")&&(user.getGuide("pilot")||menuManager.focusOn(this.upgradeBtnNode,"",function(){TJ.onGuideEvent({guide_id:90,guide_name:"\u4e58\u5458-\u89e3\u9501"})},null,null,{fade:3,fadeCb:function(){t.close(),menuManager.chatOn(null,"\u5927\u5bb6\u597d\uff01\u6211\u53eb\u5fb7\u8389\u838e\uff0c\n\u76ee\u6807\u662f\u6210\u4e3a\u6307\u6325\u5b98\uff0c\u8bf7\u591a\u6307\u6559\uff01",2,{noBlack:0,head:"h99",dx:-50,dy:200},function(){menuManager.chatOn(menuManager.currentRun().node,"\u5404\u4f4d\u591a\u591a\u4ea4\u6d41\uff0c\u51c6\u5907\u597d\u4e4b\u540e\uff0c\n\u6211\u4eec\u4e00\u8d77\u51fa\u53d1\uff01",2,{noBlack:0,head:"h99",dx:-120,dy:0})})}}))},initUI:function(e){var t,a=this,n=pc.getHeroData(e),o=pc.getHero(e);t=o?o.star:0,this.nameLabel.string=n.name,this.careerLabel.string=n.career;var r=this.avatarNode.getChildByName("hero_model").getComponent("HeroModel");r.init(n,o),r.setGray(!t);var s=[SHARD]+"."+e,c=money.getNum(s),l=pc.getHeroUpgradePrice(t);this.btnLabel.string=t?"\u8fdb\u9636":"\u89e3\u9501",this.propertyBarNode.destroyAllChildren();for(var d=0;d<5;d++){this.starsNode.getChildByName(""+(d+1)).active=d<t;var h=void 0;h=d==t&&money.had(s,l)?cc.instantiate(this.newBar):d<t?cc.instantiate(this.unlockBar):cc.instantiate(this.lockBar),this.propertyBarNode.addChild(h),h.active=!0,h.getChildByName("num").getComponent(cc.Label).string="x"+(d+1),h.getChildByName("msg").getComponent(cc.Label).string=n.starInfo[d]}t<5?(this.partSprite.fillRange=c/l,this.partLabel.string=c+"/"+l,this.setGray(this.upgradeBtnNode,!money.had(s,l))):(this.partSprite.fillRange=0,this.partLabel.string=c+"/ - - -",this.setGray(this.upgradeBtnNode,!0)),this.upgradeBtnNode.getChildByName("rp").active=t<5&&c>=l,this.upgradeBtnNode.onTouch=function(){2==user.getGuide("chapter")&&(user.getGuide("pilot")||user.setGuide("pilot",1)),t>=5?kit.info(LI("tip_max")):money.check(s,l)||((o=o||{id:e,star:0}).star+=1,o.lvl=1,cc.log("upgradeBtnNode",o,t),net.updateData({heroes:[o],price:{i:s,n:l}},function(n,o){i.FirebaseTracking.setDataBiRes("UpgradeHeroInfo"),money.update(o),a.initUI(e),a.args.refreshCb(),t<=0?menuManager.pop("show",{items:[{i:HERO,id:e}],tid:"hero_info",checkCb:function(){}}):a.upgradeAnime.play()}))}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],HeroModel:[function(e,t){"use strict";cc._RF.push(t,"d5b7d+Gq0dO2pP4JWRj41u6","HeroModel"),cc.Class({extends:cc.Component,properties:{display:dragonBones.ArmatureDisplay,grayMaterial:cc.Material},init:function(e,t){this.define=e,this.config=t,this.armatureLoaded=!1,this.animeName="stand",this.animeSpd=0,this.animeNum=1,this.loadAvatar()},loadAvatar:function(){var e=this,t=(this.config,this.define.avatar),i=t.anime||"hero_torbjorn";this.display.node.scale=1,menuManager.loadArmature(this.display,i,function(){e.armatureLoaded=!0,e.animeName&&e.playAnime(),e.setGray(e.gray)},t.animeName)},playAnime:function(){var e;(e=this.animeSpd>0&&"stand"==this.animeName?this.display.armature().animation.gotoAndPlayByProgress(this.animeName,kit.rnd(0,1),this.animeNum):this.display.playAnimation(this.animeName,this.animeNum))&&(e.timeScale=this.animeSpd)},play:function(e,t,i){void 0===t&&(t=-1),void 0===i&&(i=1),this.animeName=e,this.animeNum=t,this.animeSpd=i,this.armatureLoaded&&this.playAnime()},setGray:function(e){var t;this.gray=e,this.armatureLoaded&&(t=e?this.grayMaterial:cc.Material.getBuiltinMaterial("2d-sprite"),this.display.setMaterial(0,t))}}),cc._RF.pop()},{}],HeroStatDefine:[function(e,t){"use strict";cc._RF.push(t,"59b5bm1xNhCsZx5IRuISRVO","HeroStatDefine"),e("../components/combat/buffs/Buff"),e("../data/constants/GameConstants"),e("../components/visual/ArmatureAvatar"),e("../entities/projectiles/PowerBullet"),e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),window.loadHeroStatDefine=function(){window.HeroStatDefine={hero_hp:{title:LI("hero_stat_1"),template:{id:"attribute",attr:"hpMax",num:.2},desPercent:.2,content:"ui/talent/heroStat/\u751f\u547d\u503c",templateFunc:function(e,t){e.num=t.num}},hero_atk:{title:LI("hero_stat_2"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"hero"},desPercent:.2,content:"ui/talent/heroStat/\u653b\u51fb\u529b",templateFunc:function(e,t){e.num=t.num}},hero_critBonus:{title:LI("hero_stat_3"),template:{id:"attribute",attr:"critBonus",num:.2},desPercent:.2,content:"ui/talent/heroStat/\u66b4\u51fb\u4f24\u5bb3",templateFunc:function(e,t){e.num=t.num}},hero_healScale:{title:LI("hero_stat_4"),template:{id:"attribute",attr:"healScale",num:.2},desPercent:.2,content:"ui/talent/heroStat/\u6cbb\u7597\u52a0\u6210",templateFunc:function(e,t){e.num=t.num}},hero_armorScale:{title:LI("hero_stat_5"),template:{id:"attribute",attr:"armorScale",num:.2},desPercent:.2,content:"ui/talent/heroStat/\u62a4\u7532\u52a0\u6210",templateFunc:function(e,t){e.num=t.num}},hero_atkSpd:{title:LI("hero_stat_6"),template:{id:"attribute",attr:"atkSpd",num:.2},desPercent:.2,content:"ui/talent/heroStat/\u653b\u901f",templateFunc:function(e,t){e.num=t.num}},hero_machine_gun_atk:{title:LI("hero_stat_7"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"machine_gun"},desPercent:.2,content:"ui/talent/heroStat/\u673a\u67aa\u653b\u51fb\u529b",templateFunc:function(e,t){e.num=t.num}},hero_machine_gun_crit_bonus:{title:LI("hero_stat_8"),template:{id:"attribute",attr:"critBonus",num:.2,unitType:"machine_gun"},desPercent:.2,content:"ui/talent/heroStat/\u673a\u67aa\u66b4\u4f24",templateFunc:function(e,t){e.num=t.num}},hero_fire_thrower_atk:{title:LI("hero_stat_9"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"fire_thrower"},desPercent:.2,content:"ui/talent/heroStat/\u55b7\u706b\u5668\u653b\u51fb",templateFunc:function(e,t){e.num=t.num}},hero_canon_atk:{title:LI("hero_stat_10"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"cannon"},desPercent:.2,content:"ui/talent/heroStat/\u5de8\u70ae\u653b\u51fb",templateFunc:function(e,t){e.num=t.num}},hero_canon_atkSpd:{title:LI("hero_stat_11"),template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"cannon"},desPercent:.2,content:"ui/talent/heroStat/\u5de8\u70ae\u653b\u901f",templateFunc:function(e,t){e.num=t.num}},hero_mortar_atk:{title:LI("hero_stat_12"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"mortar"},desPercent:.2,content:"ui/talent/heroStat/\u706b\u7bad\u653b\u51fb",templateFunc:function(e,t){e.num=t.num}},hero_mortar_crit_bonus:{title:LI("hero_stat_13"),template:{id:"attribute",attr:"critBonus",num:.2,unitType:"mortar"},desPercent:.2,content:"ui/talent/heroStat/\u706b\u7bad\u66b4\u4f24",templateFunc:function(e,t){e.num=t.num}},hero_sniper_atk:{title:LI("hero_stat_14"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"sniper"},desPercent:.2,content:"ui/talent/heroStat/\u6b65\u5175\u653b\u51fb",templateFunc:function(e,t){e.num=t.num}},hero_sniper_atkSpd:{title:LI("hero_stat_15"),template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"sniper"},desPercent:.2,content:"ui/talent/heroStat/\u6b65\u5175\u653b\u901f",templateFunc:function(e,t){e.num=t.num}},hero_armor_atk:{title:LI("hero_stat_16"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"armor"},desPercent:.2,content:"ui/talent/heroStat/\u5de5\u5177\u7bb1\u62a4\u7532",templateFunc:function(e,t){e.num=t.num}},hero_armor_atkSpdBuff:{title:LI("hero_stat_17"),template:{id:"attribute",attr:"atkSpd",num:.02,suround:["armor",2],tag:"physics"},desPercent:.02,content:"ui/talent/heroStat/\u5de5\u5177\u7bb1\u653b\u901f",templateFunc:function(e,t){e.num=t.num}},hero_heal_atk:{title:LI("hero_stat_18"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"heal"},desPercent:.2,content:"ui/talent/heroStat/\u71c3\u6599\u7f50\u7597",templateFunc:function(e,t){e.num=t.num}},hero_heal_hpBonus:{title:LI("hero_stat_19"),desPercent:.2,content:"ui/talent/heroStat/\u71c3\u6599\u7f50\u8010",template:{id:"attribute",attr:"hpMax",num:0,add:1},templateFunc:function(e,t,i){var a,n,o=0;if(i=i||(null==(a=chapter)?void 0:null==(n=a.data)?void 0:n.backpack),cc.log("fuelTank_hpBonus",i),i){for(var r in i.blockItemData){var s=i.blockItemData[r],c=BackpackItemDefine[s.id];if(s.pos&&"heal"==c.type){var l=equipment.getStats(c.type);l&&l.hp&&TalentDefine.hp&&(o+=l.hp*Math.pow(1.5,c.rarity)),c.talent&&"object"==typeof c.talent&&(o+=c.talent.num)}}cc.log("fuelTank_hpBonus\u8ba1\u7b97fuelTank\u6240\u83b7\u5f97\u7684\u603b\u751f\u547d\u503c",o),e.num=o*t.num}}},hero_bouncing_ball_atk:{title:LI("hero_stat_20"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"bouncing_ball"},desPercent:.2,content:"ui/talent/heroStat/\u6295\u7403\u673a\u653b\u51fb\u529b",templateFunc:function(e,t){e.num=t.num}},hero_bouncing_ball_atkSpd:{title:LI("hero_stat_21"),template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"bouncing_ball"},desPercent:.2,content:"ui/talent/heroStat/\u6295\u7403\u673a\u653b\u901f",templateFunc:function(e,t){e.num=t.num}},hero_laser_atk:{title:LI("hero_stat_22"),template:{id:"attribute",attr:"atkScale",num:.2,unitType:"laser"},desPercent:.2,content:"ui/talent/heroStat/\u6fc0\u5149\u70ae\u653b\u51fb\u529b",templateFunc:function(e,t){e.num=t.num}},hero_fly_shield_critBonus:{title:LI("hero_stat_23"),template:{id:"attribute",attr:"critBonus",num:.2,unitType:"fly_shield"},desPercent:.2,content:"ui/talent/heroStat/\u76fe\u5f13\u653b\u51fb",templateFunc:function(e,t){e.num=t.num}},hero_tesla_blt_n:{title:LI("hero_stat_24"),template:{id:"blt",bltAdd:{n:1},num:1,unitType:"tesla"},desPercent:.2,content:"ui/talent/heroStat/\u7535\u51fb\u5854\u76ee\u6807",templateFunc:function(e,t){e.bltAdd.n=t.num}}},window.HeroStatInit=function(){for(var e in HeroStatDefine){var t=HeroStatDefine[e];t.equipment=1,t.rarity=0,TalentDefine[e]=HeroStatDefine[e];for(var i=2;i<=5;i++)HeroStatDefine[e+i]=TalentDefine[e+i]=kit.clone(HeroStatDefine[e]),TalentDefine[e+i].rarity=i-1}},HeroStatInit()},cc._RF.pop()},{"../components/combat/buffs/Buff":"Buff","../components/visual/ArmatureAvatar":"ArmatureAvatar","../data/constants/GameConstants":"GameConstants","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/PowerBullet":"PowerBullet"}],Hero:[function(e,t){"use strict";cc._RF.push(t,"06161tvO7hI/pULH1Tq4oQW","Hero"),cc.Class({extends:e("../../core/base/Entity"),init:function(e,t,i){this.define=t,this.config=i,this.game=e,this.game.addRender(this),this.flipX=1,this.scale=1,this.initAvatar(),this.team=i.team;var a=this.config.base;a&&(this.base=i.base,this.team=a.team)},getPositionX:function(){return this.base?this.base.x+this._x:this._x},getPositionY:function(){return this.base?this.base.y+this._y:this._y},getDegree:function(){return this.base?this.base.deg+this._deg:this._deg},onHurt:function(e){var t=this.game;this.define,t.callEffect(EFFECT.hurtRed,this.avatar,e.hurtColor)},initDeath:function(){if(!this.deathAction){this.deathAction=!0,this.hp=0;var e=this.avatar;e.setForcedAnime("dead2",1,0,1),e.refresh(0,!0,!0)}},callDeath:function(e){if(!this.deathAction){this.deathAction=!0,this.game,this.define,this.hp=0;var t=this.avatar,i=(e.hurtDelayTime||.05)+.1;this.deathFade=!0,t.setForcedAnime("dead2",1,i,1),t.refresh(.3,!0,!0)}},callVehicleDeath:function(){if(!this.downAction){this.downAction=!0;var e=this.game;this.define,e.callEffect(EFFECT.heroDeath,this.avatar)}},callVehicleRevive:function(){var e=this.avatar;if(this.deathAction&&(this.deathAction=!1,this.deathFade=!1,this.hp=1,e.setForcedAnime(),e.refresh(.5)),this.downAction){this.downAction=!1;var t=this.game;this.define,t.callEffect(EFFECT.heroRevive,this.avatar),e.setForcedAnime(),e.refresh(.5)}}}),cc._RF.pop()},{"../../core/base/Entity":"Entity"}],HotUpdate:[function(e,t,i){"use strict";cc._RF.push(t,"868edDc7HhB8YKWHDe8FbTF","HotUpdate"),Object.defineProperty(i,"__esModule",{value:!0});var a=cc._decorator,n=a.ccclass,o=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.manifestUrl=null,t.versionLabel=null,t.labProgress=null,t.loadingProgress=null,t.btnRetry=null,t._updateSizeMB=0,t}return __extends(t,e),t.prototype.onLoad=function(){cc.sys.isNative&&(this.btnRetry.active=!1,this._storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"qygame-remote-asset",this.versionCompareHandle=function(e,t){for(var i=e.split("."),a=t.split("."),n=0;n<i.length;++n){var o=parseInt(i[n]),r=parseInt(a[n]||0);if(o!==r)return o-r}return a.length>i.length?-1:0},this._am=new jsb.AssetsManager(this.manifestUrl.nativeUrl,this._storagePath,this.versionCompareHandle),this._am.setVerifyCallback(function(){return!0}),this.versionLabel&&(this.versionLabel.string="src:"+this._am.getLocalManifest().getVersion()),cc.sys.os,cc.sys.OS_ANDROID,this._am.setMaxConcurrentTask(8))},t.prototype.start=function(){var e=this;this.scheduleOnce(function(){e.checkUpdate()},0)},t.prototype.onDestroy=function(){this._am.setEventCallback(null),this._am=null},t.prototype.showLog=function(e){console.log("[HotUpdateModule][showLog]----"+e)},t.prototype.retry=function(){!this._updating&&this._canRetry&&(this._canRetry=!1,this._am.downloadFailedAssets())},t.prototype.updateCallback=function(e){var t=!1,i=!1;switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:this.showLog("\u6ca1\u6709\u53d1\u73b0\u672c\u5730manifest\u6587\u4ef6\uff0c\u8df3\u8fc7\u4e86\u70ed\u66f4\u65b0."),this.showTxtMsg("Skip hot updates!"),i=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:var a=e.getPercent();if(isNaN(a))return;var n=e.getMessage();this.disPatchRateEvent(a,n),this.showLog("updateCallback\u66f4\u65b0\u8fdb\u5ea6\uff1a"+a+", msg: "+n),this.labProgress.string="Downloading\uff1a"+this.formatBytes(e.getDownloadedBytes())+" / "+this.formatBytes(e.getTotalBytes());break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:this.showLog("\u4e0b\u8f7dmanifest\u6587\u4ef6\u5931\u8d25\uff0c\u8df3\u8fc7\u70ed\u66f4\u65b0."),this.showTxtMsg("Skip hot updates!"),i=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:this.showLog("\u5df2\u662f\u6700\u65b0\u7248\u672c."),this.showTxtMsg("Already the latest version!"),i=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:this.showLog("\u66f4\u65b0\u7ed3\u675f."+e.getMessage()),this.disPatchRateEvent(1),this.showTxtMsg("Update complete!\uff01"),t=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:this.showLog("\u66f4\u65b0\u9519\u8bef."+e.getMessage()),this._updating=!1,this._canRetry=!0,this._failCount++,this.showTxtMsg("Update failed!"),this._failCount>=3?i=!0:this.retry();break;case jsb.EventAssetsManager.ERROR_UPDATING:var o="Error during update: "+e.getAssetId()+", "+e.getMessage();this.showLog(o),this.showTxtMsg(o);break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:this.showLog("\u89e3\u538b\u9519\u8bef"),this.showTxtMsg("Decompression error")}if(i&&(this._am.setEventCallback(null),this._updating=!1,this.btnRetry.active=!0),t){this._am.setEventCallback(null);var r=jsb.fileUtils.getSearchPaths(),s=this._am.getLocalManifest().getSearchPaths();Array.prototype.unshift.apply(r,s),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(r)),jsb.fileUtils.setSearchPaths(r),cc.audioEngine.stopAll(),setTimeout(function(){cc.game.restart()},100)}},t.prototype.hotUpdate=function(){if(this.btnRetry.active=!1,this._am&&!this._updating){if(this._am.setEventCallback(this.updateCallback.bind(this)),this._am.getState()===jsb.AssetsManager.State.UNINITED){var e=this.manifestUrl.nativeUrl;this._am.loadLocalManifest(e)}this._failCount=0,this._am.update(),this._updating=!0}},t.prototype.checkCallback=function(e){switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:this.showLog("\u6ca1\u6709\u53d1\u73b0\u672c\u5730manifest\u6587\u4ef6\uff0c\u8df3\u8fc7\u4e86\u70ed\u66f4\u65b0."),this.hotUpdateFinish(!0),this.showTxtMsg("Skip hot updates!");break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:this.showLog("\u4e0b\u8f7dmanifest\u6587\u4ef6\u5931\u8d25\uff0c\u8df3\u8fc7\u70ed\u66f4\u65b0."),this.hotUpdateFinish(!1),this.showTxtMsg("Retry hot update\uff01");break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:this.showLog("\u5df2\u66f4\u65b0."),this.hotUpdateFinish(!0),this.showTxtMsg("");break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:return this.showLog("\u6709\u65b0\u7248\u672c,\u9700\u8981\u66f4\u65b0"+this.manifestUrl.nativeUrl),this._updating=!1,this.hotUpdate(),void this.showTxtMsg("There is a new version, start updating");case jsb.EventAssetsManager.UPDATE_PROGRESSION:var t=e.getPercent();if(isNaN(t))return;var i=e.getMessage();return void this.showLog("checkCallback\u66f4\u65b0\u8fdb\u5ea6\uff1a"+t+", msg: "+i);default:return void console.log("event.getEventCode():"+e.getEventCode())}this._am.setEventCallback(null),this._updating=!1},t.prototype.checkUpdate=function(){if(this.btnRetry.active=!1,this._updating)console.log("\u68c0\u6d4b\u66f4\u65b0\u4e2d...");else{if(this._am.getState()===jsb.AssetsManager.State.UNINITED){var e=this.manifestUrl.nativeUrl;cc.assetManager.md5Pipe&&(e=cc.assetManager.md5Pipe.transformURL(e)),this._am.loadLocalManifest(e)}this._am.getLocalManifest()&&this._am.getLocalManifest().isLoaded()?(this._am.setEventCallback(this.checkCallback.bind(this)),this._am.checkUpdate(),this._updating=!0,this.disPatchRateEvent(.01)):this.showLog("\u52a0\u8f7dmanifest\u6587\u4ef6\u5931\u8d25")}},t.prototype.hotUpdateFinish=function(e){e?this.jump2Login():this.btnRetry.active=!0},t.prototype.disPatchRateEvent=function(e){e>1&&(e=1),this.loadingProgress.progress=e},t.prototype.skipHotUpdate=function(){this.jump2Login()},t.prototype.jump2Login=function(){setTimeout(function(){cc.director.loadScene("scene/login")},500)},t.prototype.showTxtMsg=function(e){this.labProgress.string=e},t.prototype.formatBytes=function(e){return e>=1073741824?(e/1073741824).toFixed(2)+"GB":e>=1048576?(e/1048576).toFixed(2)+"MB":e>=1024?(e/1024).toFixed(2)+"KB":e+"B"},__decorate([o(cc.Asset)],t.prototype,"manifestUrl",void 0),__decorate([o(cc.Label)],t.prototype,"versionLabel",void 0),__decorate([o(cc.Label)],t.prototype,"labProgress",void 0),__decorate([o(cc.ProgressBar)],t.prototype,"loadingProgress",void 0),__decorate([o(cc.Node)],t.prototype,"btnRetry",void 0),__decorate([n],t)}(cc.Component);i.default=r,cc._RF.pop()},{}],HpMaxBuff:[function(e,t){"use strict";cc._RF.push(t,"1d656eYwxBEPZf0z3LcVQTf","HpMaxBuff"),cc.Class({extends:e("./Buff"),init:function(e,t,i,a,n){e.addUpdate(this),this.define=a,this.config=n,this.obj=i,this.from=t,this.game=e,this.castTimer=a.t,this.hpMax=i.hpMax,this.addAttr(a.attr),i.onHeal(this,i.hpMax-this.hpMax),a.effect&&(this.effect=this.game.callEffect(a.effect,this)),this.begin()}}),cc._RF.pop()},{"./Buff":"Buff"}],HumanAvatar:[function(e,t){"use strict";cc._RF.push(t,"ab22aoi6qdLt79o02K9KUge","HumanAvatar"),cc.Class({extends:e("../../components/visual/ArmatureAvatar"),initAnime:function(){this.upperBone="body",this.lowerBone="ass",this._super()},setForcedUpperAnime:function(e,t,i){this.forcedUpperAnimeName=e,this.forcedAnimeSpd=t,this.forcedAnimePlayTimes=i},setForcedLowerAnime:function(e,t,i){this.forcedLowerAnimeName=e,this.forcedAnimeSpd=t,this.forcedAnimePlayTimes=i},refresh:function(e,t,i){this.needRefresh=!0,this.forcedRefresh=this.forcedRefresh||t,this.forcedLowerRefresh=this.forcedLowerRefresh||i,(e||0===e)&&(this.fadeTime&&!t?e<this.fadeTime?this.fadeTime=e:this.fadeTime=this.fadeTime:this.fadeTime=e)},updateRender:function(e){var t=this.obj;if(this.setFlipX(t.flipX),this.needRefresh){var i=this.forcedRefresh,a=this.forcedLowerRefresh,n=this.forcedAnimeSpd;if(this.stunAction)this.hideEffect(),this.upperState&&(this.upperState.timeScale=0),this.lowerState&&(this.lowerState.timeScale=0),this.forcedAnimeName=null,this.upperAniName=null,this.lowerAniName=null,this.fadeTime=null,this.needRefresh=!1;else if(this.forcedAnimeName)this.forcedAnimeAction&&(this.forcedAnimeDelay-=e,this.forcedAnimeDelay<=0&&(this.forcedAnimeAction=!1,this.callAnime(this.forcedAnimeName,n||1,this.forcedAnimePlayTimes),cc.log(1111)));else{var o=t.moveAction&&!t.getFlag(NO_MOVE)||this.moveAction,r=t.attackPlay||this.attackPlay,s=t.reloadAction,c=t.getMoveSpdX()/this.moveScale*t.flipX;this.flipX==t.flipX?c*=1:c*=-1,this.forcedUpperAnimeName?(this.callUpperAnime(this.forcedUpperAnimeName,n||1,i,this.forcedAnimePlayTimes),cc.log(2222)):s&&this.reloadAnimeName?this.callUpperAnime(this.reloadAnimeName,n||this.reloadSpd,i):r?this.callUpperAnime(this.attackAnimeName,n||t.atkSpd,i):o?this.callUpperAnime(this.walkAnimeName,n||c,i):this.callUpperAnime(this.standAnimeName,n||1,i),this.forcedLowerAnimeName?(this.callLowerAnime(this.forcedLowerAnimeName,n||1,a,this.forcedAnimePlayTimes),cc.log(3333)):o?this.callLowerAnime(this.walkAnimeName,n||c,a):s&&this.reloadAnimeName?this.callLowerAnime(this.reloadAnimeName,n||this.reloadSpd,a):r?this.callLowerAnime(this.attackAnimeName,n||t.atkSpd,a||i):this.callLowerAnime(this.standAnimeName,n||1,a)}(!this.forcedAnimeName||this.forcedAnimeDelay<=0)&&(this.fadeTime=null,this.needRefresh=!1,this.forcedRefresh=!1,this.forcedLowerRefresh=!1)}this.updateStatus()},onAnimeEvent:function(e){e.type==dragonBones.EventObject.COMPLETE&&(e.animationState==this.lowerState?this.lowerState=null:e.animationState==this.upperState&&(this.upperState=null))},callUpperAnime:function(e,t,i,a){var n=this.getArmature();if(n){var o=n.animation;if(!o.animationNames||-1===o.animationNames.indexOf(e))return console.warn('[HumanAvatar] CRITICAL: Animation "'+e+'" does not exist in armature "'+n.name+'".'),void console.warn("[HumanAvatar] Available animations:",o.animationNames);if(i||this.upperAniName!=e){this.upperAniName=e;var r=o.fadeIn(e,this.fadeTime||0,a||-1,0,"UPPER_BODY_GROUP",dragonBones.AnimationFadeOutMode.SameGroup);r&&(r.addBoneMask(this.upperBone,!0),this.upperState=r)}else r=this.upperState;r&&(r.timeScale=t)}},callLowerAnime:function(e,t,i,a){var n=this.getArmature();if(n){var o=n.animation;if(!o.animationNames||-1===o.animationNames.indexOf(e))return console.warn('[HumanAvatar] CRITICAL: Animation "'+e+'" does not exist in armature "'+n.name+'".'),void console.warn("[HumanAvatar] Available animations:",o.animationNames);if(i||this.lowerAniName!=e){this.lowerAniName=e;var r=o.fadeIn(e,this.fadeTime||0,a||-1,0,"LOWER_BODY_GROUP",dragonBones.AnimationFadeOutMode.SameGroup);r&&(r.addBoneMask(this.lowerBone,!0),this.lowerState=r)}else r=this.lowerState;r&&(r.timeScale=t)}}}),cc._RF.pop()},{"../../components/visual/ArmatureAvatar":"ArmatureAvatar"}],IncendiaryBomb:[function(e,t){"use strict";cc._RF.push(t,"5da45Gg/4JJKIMTlOPserCk","IncendiaryBomb"),cc.Class({extends:e("./ContactBullet"),initStatus:function(){this._super();var e=this.define.bomb;e&&(this.bombDmg=this.config.bombDmg||e.dmg0,this.bombStep=(e.dmg1-e.dmg0)/e.dmg0),this.x00=this.x0,this.y00=this.y0,this.define.lifeTime&&(this.timer=this.define.lifeTime),this.burningTime=this.define.burningTime||.1,this.burningTimer=this.burningTime},onRemove:function(e){var t=this.config.cb;t&&!t(this)||this.explosion(e),this._super(e)},onFail:function(e,t){this.hurtDelayTime=0,this.x=e;var i=this.game.contactMgr.findGroundLine(e);t<i&&(t=i),this.y=t},updateLogic:function(e){this._super(e),this.burningTimer-=e,this.burningTimer<0&&(this.burningTimer=this.burningTime,this.burn())},onHit:function(){var e=this.game.contactMgr.findGroundLine(this.x);this.y<e&&(this.y=e)},onContact:function(){},onHitWall:function(e,t){var i=this.game.contactMgr.findGroundLine(this.x);t<i&&(t=i),this.x0=this.x=e,this.y0=this.y=t},explosion:function(){},burn:function(){var e=this.define.bomb,t=e.r1,i=e.r0,a=this.bombDmg,n=this.bombStep,o=e.kb,r=this.x,s=this.y,c=this.team,l=this.game.contactMgr.findGroundLine(r);s<l&&(s=l);var d=this.obj;d.bltExploRange&&(t*=d.bltExploRange);var h=this.game.contactMgr.getContactList();for(var u in h){var p=h[u],f=p.getEntity(),m=e.buff;if(!f.bulletFlag&&(!m||!f.getBuff(m))&&p._activeContact&&f.isInBorder()&&f.team!=c){var g=p.hitRadius+t,v=r-p.getPositionX(),y=s-p.getPositionY(),b=v*v+y*y;if(b<=g*g){var k=c_sqrt(b)+.1;if(k<=i)f.onHurt(this,a,e.weaponType,e.dmgType);else{var T=a*(1+n*(k-i)/(g-i));f.onHurt(this,T,e.weaponType,e.dmgType)}m&&f.addBuff(this,m);var _=o/(k*f.weight);if(f.onKnockback(-v*_,-y*_),f.isDead())if(f.y<=f.height+this.game.contactMgr.findGroundLine(f.x)){var w=v>0&&kit.rnd(-600,-350)||kit.rnd(350,600);f.applyVelocity(w,kit.rnd(1e3,1250))}else{var E=kit.rnd(750,1e3),C=(w=-v/(Math.abs(v)+Math.abs(y))*E,-y/(Math.abs(v)+Math.abs(y))*E);f.applyVelocity(w,C)}}}}}});var i=e("../../components/combat/buffs/Buff");BUFF_DEFINE.incendiary={symbol:i.getSymbol(),t:.1,ctor:e("../../components/combat/buffs/Buff")},cc._RF.pop()},{"../../components/combat/buffs/Buff":"Buff","./ContactBullet":"ContactBullet"}],IncendiarySkill:[function(e,t){"use strict";cc._RF.push(t,"5d3dcE+FTpCh7EmSNhLYzKp","IncendiarySkill");var i=e("../../../entities/projectiles/BallBulletSprite"),a=e("../../../entities/projectiles/Bomb"),n=e("../../../entities/projectiles/Bullet"),o=e("../../../entities/projectiles/IncendiaryBomb");cc.Class({extends:e("./Skill"),startCast:function(){var e=this.obj;this.timer=0,this.smokeIndex=0,this.bombIndex=0,this.smokeMax=7,e.config.skillBlt&&(this.smokeMax+=e.config.skillBlt);var t=e.skillScale,n={name:"\u706b\u7130",ctor:o,noContact:1,avatar:{sx:.6,sy:.6,noBlend:!0,anime:{atlas:"bullet/incendiary/fire2",speed:1,repeat:-1}},bomb:{r1:150,r0:50,dmg1:50*t,dmg0:50*t,kb:300,effect:EFFECT.bombs3,buff:BUFF_DEFINE.incendiary},lifeTime:3,kb:.3,length:20,n:1,wd:0,d:0,spd:444,spdFluc:0,gravity:-2e3,distance:13450,disExtra:100},r=[{x:0,blt:n,dmg:50*t},{x:150,blt:n,dmg:50*t},{x:-150,blt:n,dmg:50*t}];this.blt=[{name:"\u70ae\u5f39",ctor:a,noContact:1,avatar:{ctor:i,frm:"bullet/incendiary/blt",sx:.6,sy:.6,noBlend:!0,streakEffect:EFFECT.spinBlt},bomb:{r1:150,r0:50,dmg1:50*t,dmg0:50*t,kb:300,effect:EFFECT.bombs3},spawnBlt:r,lifeTime:3,kb:.3,length:20,n:1,wd:0,d:0,spd:444,spdFluc:0,gravity:-2e3,distance:13450,disExtra:100}],this.attackSequence=[{t:.7,x:-20,y:50,blt:1,sound:"sound/cannon_fire"},{t:1}],this.game.callEffect(EFFECT.slowMotion,e.avatar,this.define.t,this.clearBullet.bind(this))},clearBullet:function(){var e=this.obj,t=(e.avatar,this.game.contactMgr.bulletList);for(var i in t)t[i].team!==e.team&&t[i].onTimeOut();var a=this.game.contactMgr.getContactList();for(var n in a){var o=a[n],r=o.getEntity();o._activeContact&&r.isInBorder()&&r.team!==e.team&&(r.onHurt(this,100*e.skillScale,null,null),this.game.callEffect(EFFECT.preUltDamage,r.avatar))}},updateCast:function(e){var t=this.obj.avatar;if(this.smokeIndex<this.smokeMax){if(this.timer-=e,this.timer<=0){var i=this.smokeIndex;this.timer=.1,this.smokeIndex++,this.shot(this.attackSequence[0],t.x+100*i+100,t.y+1e3,-165)}}else this.bombIndex<this.smokeMax&&(this.timer-=e,this.timer<=0&&(this.timer=.2,this.bombIndex++))},shot:function(e,t,i,a){var o=this.obj,r=this.blt[e.blt-1],s=(e.x||0)*o.flipX*o.scale,c=(e.y||0)*o.scale;r.offsets&&(o._bltOffsetIndex||(o._bltOffsetIndex=r.offsets.length),o._bltOffsetIndex-=1,s+=r.offsets[o._bltOffsetIndex].x,c+=r.offsets[o._bltOffsetIndex].y),t=t,i=i;var l=90+a,d=c_degree2cos(l),h=c_degree2sin(l),u=+h*s+d*c,p=-d*s+h*c;(r.shot||n.shot)(this.game,r,{distance:void 0,target:void 0,deg:l,obj:o,x:t,y:i,team:o.team,dmg:this.bltDmg,moveSpdX:o.getSpdX()}),e.effect&&this.game.callEffect(e.effect,o.avatar,u,p,l),e.sound&&this.game.playEffect(e.sound),this.bltMax>0&&(this.bltCt-=1)},bomb:function(e){for(var t=this.game.contactMgr.getContactList(),i=0,a=t.length;i<a;i++){var n=t[i],o=n.getEntity();Math.abs(n.getPositionX()-e)<200&&n.getPositionY()<900&&o.onHurt(this,1e3)}},endCast:function(){}}),cc._RF.pop()},{"../../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","../../../entities/projectiles/IncendiaryBomb":"IncendiaryBomb","./Skill":"Skill"}],IncomeUpMenu:[function(e,t){"use strict";cc._RF.push(t,"e5fa3SE3PNBNp54BTQ/mo3x","IncomeUpMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{priceLabel:cc.Label,icon:cc.Sprite,levelLabel:cc.Label,label1:[cc.Label],label2:[cc.Label]},initStatus:function(e){this.icon.spriteFrame=e.iconFrame,this.levelLabel.string="Lv. "+(+e.lvl+1),this.priceLabel.string=e.price,this.label2[0].string=e.n[0],this.label2[1].string=e.n[1],this.label2[2].string="+"+(e.n[2]-e.n[1]),this.label1[0].string=e.m[0],this.label1[1].string=e.m[1],this.label1[2].string="+"+(e.m[2]-e.m[1])},onUpgrade:function(){var e=this;(0,this.args.upgradeCb)(function(t){e.onCheck(t)})},onCheck:function(){var e=this.args.checkCb;e&&e.call(this)||this.close(!0)},waitOnClose:function(){}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],InfiniteHeatBuff:[function(e,t){"use strict";cc._RF.push(t,"d13d0xvorFKRJ2woHDkSD5J","InfiniteHeatBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){this.heatUp=this.obj.heatUp,this.heatUpOnShot=this.obj.heatUpOnShot,this.obj.heat=0,this.obj.callHeatOver(!1),this.obj.heatUpOnShot-=this.heatUpOnShot,this.obj.heatUp-=this.heatUp},end:function(){this.obj.heatUpOnShot+=this.heatUpOnShot,this.obj.heatUp+=this.heatUp}}),cc._RF.pop()},{"./Buff":"Buff"}],InfoMenu:[function(e,t){"use strict";cc._RF.push(t,"e01259erqhPKLGDhjLnLVRt","InfoMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{infoText:cc.RichText},onLoad:function(){this.node.setScale(0),this.waitOnClose()},onTouchClose:function(){this.onCheck()},initStatus:function(e){e.info&&(this.infoText.string=e.info),e.time?this.time=e.time:this.time=1},start:function(){this.node.runAction(cc.sequence(cc.scaleTo(.1,1).easing(cc.easeBackOut(2)),cc.delayTime(this.time),cc.callFunc(this.onCheck,this))),this.node.getChildByName("board").y+=this.args.dy||0},onCheck:function(){this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.spawn(cc.fadeOut(.1),cc.scaleTo(.1,0,1)).easing(cc.easeIn(2)),cc.callFunc(this.close,this)))}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],InterfaceManager:[function(e,t,i){"use strict";cc._RF.push(t,"6a49erk2AdKMbfpzPvjIjuy","InterfaceManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.isTaskComplete=i.isValidReward=i.isIncrementalTask=void 0,i.isIncrementalTask=function(e){return e.task.num>1},i.isValidReward=function(e){return e&&"string"==typeof e.i&&"number"==typeof e.n},i.isTaskComplete=function(e,t){return 1===t.task.num?e.completed:(e.progress||0)>=t.task.num},cc._RF.pop()},{}],InvincibleBuff:[function(e,t){"use strict";cc._RF.push(t,"1f1cbBzkNNMnJ54Hm8b/CDv","InvincibleBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){this.obj.setFlag(NO_HURT,!0)},end:function(){this.obj.setFlag(NO_HURT,!1)}}),cc._RF.pop()},{"./Buff":"Buff"}],ItemInfoMenu:[function(e,t){"use strict";cc._RF.push(t,"aba8cOckx9E3adDMFV2oDPG","ItemInfoMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{itemNode:cc.Node,nameLabel:cc.Label,info1Label:cc.Label,info2Label:cc.Label,itemPrefab:cc.Prefab},initStatus:function(e){var t=e.item;if(t){var i=cc.instantiate(this.itemPrefab);this.itemNode.addChild(i,-1);var a=i.getComponent("Item");a.init(t,this.nameLabel),a.setTouchEnabled(!1),t.i===SHARD?this.info1Label.string=LI(t.i+t.id+"_info",{n:ENTITY[t.id].name}):this.info1Label.string=LI(t.i+"_info"),console.log("check info2Label",t.i+"_source"),"equipment_source"!=t.i+"_source"?this.info2Label.string=LI(t.i+"_source"):this.info2Label.string=""}else{var n=new cc.Node;n.addComponent(cc.Sprite).spriteFrame=e.spriteFrame,n.scale=Math.min(100/n.height,1),this.itemNode.addChild(n),this.nameLabel.string=e.name||"",this.info1Label.string=e.info||"",this.info2Label.string=e.source||""}}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],ItemMainPlayerRank:[function(e,t){"use strict";cc._RF.push(t,"f6cf81hluJFkqLNhmlL4R8/","ItemMainPlayerRank"),cc.Class({extends:cc.Component,properties:{rankLb:cc.Label,namePlayerLb:cc.Label,scoreLb:cc.Label,iconTopRank:cc.Sprite,listIconTopRank:[cc.SpriteFrame]},init:function(e){this.data=e,this.data&&this.data.rank?(this.rank=this.data.rank,this.updateUI()):(this.data||(this.data={rank:null,username:user.getUID?user.getUID():"Player",player_id:user.getUID?user.getUID():"",displayName:user.getDisplayName(),chapter:0,stage:0,highest_stage:0,total_score:0,maintain_time:0}),this.rank=this.data.rank||null,this.updateUIDefault())},updateUI:function(){switch(this.rank){case 1:case 2:case 3:this.rankLb.node.active=!1,this.iconTopRank.node.active=!0,this.iconTopRank.spriteFrame=this.listIconTopRank[this.rank-1];break;default:this.rankLb.node.active=!0,this.iconTopRank.node.active=!1,this.rankLb.string=this.rank.toString()}this.rankLb.string=this.rank.toString(),this.namePlayerLb.string=this.data.displayName||"---";var e="";void 0!==this.data.chapter&&void 0!==this.data.stage?e="Chapter "+this.data.chapter+" -  Stage "+this.data.stage:void 0!==this.data.highest_stage&&(e="Stage "+(this.data.highest_stage+1),void 0!==this.data.maintain_time&&(e+=" | Time: "+this.data.maintain_time+"s")),this.scoreLb.string=e},updateUIDefault:function(){this.rankLb.node.active=!0,this.iconTopRank.node.active=!1,this.rank&&this.rank>0?this.rankLb.string=this.rank.toString():this.rankLb.string="...",this.rank&&this.rank>0?this.namePlayerLb.string=this.data.displayName:this.namePlayerLb.string="...";var e="...";void 0!==this.data.chapter&&void 0!==this.data.stage?(this.data.chapter>0||this.data.stage>0)&&(e="Chapter "+this.data.chapter+" - Stage "+this.data.stage):void 0!==this.data.highest_stage&&this.data.highest_stage>0&&(e="Stage "+(this.data.highest_stage+1),void 0!==this.data.maintain_time&&this.data.maintain_time>0&&(e+=" | Time: "+this.data.maintain_time+"s")),this.scoreLb.string=e},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}}),cc._RF.pop()},{}],ItemMenu:[function(e,t){"use strict";cc._RF.push(t,"1098f5H2+dJkYN8zP/K/Vti","ItemMenu"),e("../../Plugins/firebase/FirebaseTracking"),cc.Class({extends:e("./CheckMenu"),properties:{heroAudio:{type:cc.AudioClip,default:null},itemNode:cc.Node,itemLayoutNode:cc.Node,itemPrefab:cc.Prefab,lightPrefab:cc.Prefab,shinePrefab:cc.Prefab,starPrefab:cc.Prefab,flyLightNode:cc.Node},initStatus:function(){this.initItems()},initItems:function(){this.itemList=[];var e=this.args.items;if(e)for(var t in e)this.addItem(e[t]);this.itemNode.active=!1},addItem:function(e){var t=cc.instantiate(this.itemNode);this.itemLayoutNode.addChild(t);var i=cc.instantiate(this.itemPrefab);t.addChild(i,-1),t.itemNode=i;var a=t.getChildByName("name");a||(a=t.getChildByName("name_layout").getChildByName("name"));var n=null;a&&(a.zIndex=1,t.labelNode=a,n=a.getComponent(cc.Label));var o=i.getComponent("Item");if(o.init(e,n),t.model=o.model,this.lightPrefab){var r=cc.instantiate(this.lightPrefab);t.addChild(r,-3),t.itemLight=r}if(this.shinePrefab&&o.getRank()>3){var s=cc.instantiate(this.shinePrefab);t.addChild(s,-2),t.itemShine=s}if(this.starPrefab&&o.getRank()>1){var c=cc.instantiate(this.starPrefab);t.addChild(c,1),t.itemStar=c}return t.itemCfg=e,this.itemList.push(t),t},flyToBag:function(e,t,i){var a=t.itemCfg;return a.i==HERO||a.i==VEHICLE?(t.runAction(cc.sequence(cc.delayTime(.2*e),cc.callFunc(function(){menuManager.playEffect(this.heroAudio)},this),cc.spawn(cc.moveTo(.4,t.x,0),cc.scaleTo(.4,1.5)).easing(cc.easeInOut(2)),cc.delayTime(.5),cc.spawn(cc.scaleTo(.1,.6),cc.fadeOut(.1)))),i=Math.max(1+.2*e,i)):a.i==DIAMOND||a.i==ENERGY||a.i==TALENT||a.i==EXP||a.i==GOLD||a.i==SWEEP_TICKET?(t.runAction(cc.sequence(cc.delayTime(.2*e),cc.callFunc(function(){t.itemNode.active=!1,cc.game.emit("add_money",{pos:t.convertToWorldSpaceAR(cc.v2(0,0)),tid:this.args.tid,i:a.i,n:a.n})},this))),i=Math.max(1+.2*e,i)):(cc.log("flyToBag",a),t.runAction(cc.sequence(cc.delayTime(.2*e),cc.callFunc(function(){t.itemNode.active=!1,menuManager.playEffect(this.heroAudio);var e=cc.winSize.width/2;a.i==KEY_L||a.i==KEY_M?e=cc.winSize.width/2+280:[BLUEPRINT_ATK,BLUEPRINT_HP,BLUEPRINT_SKILL].includes(a.i)?e=cc.winSize.width/2-140:a.i==SHARD?e=["v1","v2","v3"].includes(a.id)?cc.winSize.width/2-140:cc.winSize.width/2-280:a.i==EQUIPMENT&&(e=cc.winSize.width/2+140),this.fly(t.convertToWorldSpaceAR(cc.v2(0,0)),cc.v2(e,100),a.n,t.itemNode.getComponent("Item").iconNode)},this))),i=Math.max(1+.2*e,i)),i},fly:function(e,t,i,a){for(var n=cc.Canvas.instance.node,o=n.convertToNodeSpaceAR(e),r=n.convertToNodeSpaceAR(t),s=0;s<i;s++){var c=cc.instantiate(a);n.addChild(c,cc.macro.MAX_ZINDEX),c.scale=1,c.x=o.x+kit.rnd(-20,20),c.y=o.y+kit.rnd(-20,20),c.runAction(cc.sequence(cc.jumpTo(.4,o.x+kit.rnd(-50,50),o.y+kit.rnd(-30,70),40,1),cc.bezierTo(.4,[cc.v2(o.x+kit.rnd(-200,200),o.y+kit.rnd(-200,200)),cc.v2(r.x+kit.rnd(-200,200),r.y+kit.rnd(200,0)),r]).easing(cc.easeIn(1)),cc.destroySelf()))}},flyLight:function(e,t,i,a,n){var o=e.convertToNodeSpaceAR(a),r=e.convertToNodeSpaceAR(n),s=cc.instantiate(this.flyLightNode);e.addChild(s),s.setPosition(o),s.active=!0;var c=s.getChildByName("white_blur"),l=s.getComponent(cc.ParticleSystem);c.color=t,c.scale=.5+.1*i,s.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){l.startColor=t,l.totalParticles=20+10*i},this),cc.bezierTo(.6,[cc.v2(o.x,o.y+300),cc.v2(r.x,r.y),r]).easing(cc.easeInOut(2)),cc.spawn(cc.scaleTo(.2,2),cc.fadeOut(.2)),cc.callFunc(function(){l.autoRemoveOnFinish=!0,l.stopSystem()},this)))},got:function(){var e,t=((e={})[ENERGY]=0,e[EXP]=0,e[GOLD]=0,e[DIAMOND]=0,e[SWEEP_TICKET]=0,e),i=0;for(var a in this.itemList){var n=this.itemList[a];console.log(n),i=this.flyToBag(a,n,i);var o=n.getChildByName("bar");o&&(o.active=!1);var r=n.labelNode;r&&(r.active=!1),n.itemLight&&(n.itemLight.stopAllActions(),n.itemLight.runAction(cc.fadeOut(.1))),n.itemStar&&(n.itemStar.stopAllActions(),n.itemStar.runAction(cc.fadeOut(.1))),n.itemShine&&(n.itemShine.stopAllActions(),n.itemShine.runAction(cc.scaleTo(.1,0)));var s=n.itemCfg;void 0!==t[s.i]&&(t[s.i]+=s.n||0)}var c={},l={};for(var d in t)t[d]>0&&(c[d]=!0,l[d]=money.getNum(d)-t[d]);return menuManager.currentRun().showTopBar({active:c,money:l}),i}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","./CheckMenu":"CheckMenu"}],ItemProgressionTrack:[function(e,t){"use strict";cc._RF.push(t,"9df5clRwkhPwqaQmsnnmiXk","ItemProgressionTrack");var i=e("../../../../Plugins/firebase/FirebaseTracking");cc.Class({extends:cc.Component,properties:{spActive:[cc.Node],listSpfLineActive:[cc.SpriteFrame],listSpfLevelActive:[cc.SpriteFrame],lightNode:cc.Node,currentLevelLb:cc.Label,iconReward:cc.Node,iconLevel:cc.Node,iconFlip:cc.Node,iconTick:cc.Node,btnClaim:cc.Node,nameRewardLb:cc.Label,iconSpfGold:cc.SpriteFrame,iconSpfDiamond:cc.SpriteFrame,iconSpfSweepTicket:cc.SpriteFrame,iconSpfRecruitTicket:cc.SpriteFrame,iconSpfFuelTank:cc.SpriteFrame,iconSpfEnergyBarrier:cc.SpriteFrame,iconSpfBlackArrow:cc.SpriteFrame},initializeStatus:function(e,t){console.log("initializeStatus"),this.colorReward="#6B6B6B",this.dataItem=e,this.dataProgress=t,this.isLock=!0,console.log("initializeStatus ItemPro",this.dataItem,this.dataProgress),this.updateUI()},updateUI:function(){var e=this,t=this.dataItem.index%2,i=money.getNum(EXP_PROGRESSION_TRACK);switch(console.log("currentExp",i),this.currentLevelLb.string=this.dataItem.levelProgressionTrack,t){case 0:this.iconFlip.x=-this.iconFlip.x,this.iconReward.x=-this.iconReward.x,this.lightNode.x=-this.lightNode.x,this.btnClaim.x=-this.btnClaim.x}if(this.dataItem.expRequired<=i)this.spActive.forEach(function(t){t.getComponent(cc.Sprite).spriteFrame=e.listSpfLineActive[1]}),this.iconLevel.getComponent(cc.Sprite).spriteFrame=this.listSpfLevelActive[1],this.activeAnimLight(!0),this.isLock=!1;else{this.spActive.forEach(function(t){t.getComponent(cc.Sprite).spriteFrame=e.listSpfLineActive[0]}),this.iconLevel.getComponent(cc.Sprite).spriteFrame=this.listSpfLevelActive[0],this.activeAnimLight(!1),this.isLock=!0;var a=(new cc.Color).fromHEX(this.colorReward);this.iconReward.color=a}switch(this.dataItem.reward.item1.i){case GOLD:this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfGold,this.nameRewardLb.string=this.dataItem.reward.item1.n+" Gold";break;case DIAMOND:this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfDiamond,this.nameRewardLb.string=this.dataItem.reward.item1.n+" Diamond";break;case SWEEP_TICKET:this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfSweepTicket,this.nameRewardLb.string=this.dataItem.reward.item1.n+" Free Ads Ticket";break;case RECRUIT_TICKET:this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfRecruitTicket,this.nameRewardLb.string=this.dataItem.reward.item1.n+" Shining Star";break;case"fuelTank":this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfBlackArrow,this.nameRewardLb.string="Fuel Tank";break;case"energyBarrier":this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfBlackArrow,this.nameRewardLb.string="Energy Matrix";break;case"fly_shield":this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfBlackArrow,this.nameRewardLb.string="Black Arrow";break;case"bouncing_ball":this.iconReward.getComponent(cc.Sprite).spriteFrame=this.iconSpfBlackArrow,this.nameRewardLb.string="Pitcher"}this.checkRewarded()},checkRewarded:function(){void 0!==this.dataProgress&&null!==this.dataProgress&&this.dataProgress>=1?(this.iconTick.active=!0,this.btnClaim.active=!1,this.activeAnimLight(!1),this.iconReward.color=(new cc.Color).fromHEX(this.colorReward)):(this.btnClaim.active=!0,this.iconTick.active=!1)},onClaimReward:function(){if(!this.isLock){var e,t={};switch((e=this.dataItem.reward.item1).i){case GOLD:case DIAMOND:case SWEEP_TICKET:case RECRUIT_TICKET:net.updateData({items:[e]},function(t,i){console.log("Claim","updatedData",i),money.update(i),menuManager.pop("show",{items:[e],lootCb:function(){}})});break;case"fly_shield":t=equipment.unlockByName("fly_shield"),net.updateData({add:t},function(){equipment.save(),menuManager.pop("show_new_equiment",{items:e,lootCb:function(){}})});break;case"fuelTank":t=equipment.unlockByName("fuelTank"),net.updateData({add:t},function(t,i){console.log("unlock ",t,i),equipment.save(),menuManager.pop("show_new_equiment",{items:e,lootCb:function(){}})});break;case"energyBarrier":t=equipment.unlockByName("energyBarrier"),net.updateData({add:t},function(t,i){console.log("unlock ",t,i),equipment.save(),menuManager.pop("show_new_equiment",{items:e,lootCb:function(){}})});break;case"bouncing_ball":t=equipment.unlockByName("bouncing_ball"),i.FirebaseTracking.logNewTutorial({Step:12,userID:user.uuid,Status:1}),net.updateData({add:t},function(t,i){console.log("unlock ",t,i),equipment.save(),menuManager.pop("show_new_equiment",{items:e,lootCb:function(){}})})}i.FirebaseTracking.LogCustomEvent("ProgressionTrack",{reward_id:"[Free]_"+this.dataItem.levelProgressionTrack,userID:user.uuid,cohort_day:user.countLoginDay,claim_time:""+Utils.getCurrentUTCTimestamp()}),console.log(this.dataItem),pc.setProgressisonTrack(this.dataItem.index,1),this.dataProgress=1,this.checkRewarded(),cc.game.emit("check_claim_reward")}},activeAnimLight:function(e){e?(this.lightNode.scale=.9,cc.tween(this.lightNode).to(.5,{scale:1.1},{easing:"sineInOut"}).to(.5,{scale:.9},{easing:"sineInOut"}).union().repeatForever().start()):(this.lightNode.stopAllActions(),this.lightNode.active=e)}}),cc._RF.pop()},{"../../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],ItemRanker:[function(e,t){"use strict";cc._RF.push(t,"f8965k6FnZMQImped5A/iqw","ItemRanker"),cc.Class({extends:cc.Component,properties:{rankLb:cc.Label,namePlayerLb:cc.Label,scoreLb:cc.Label,iconTopRank:cc.Sprite,iconMainPlayer:cc.Sprite,listIconTopRank:[cc.SpriteFrame],listIconMainPlayer:[cc.SpriteFrame]},start:function(){},init:function(e,t){this.data=e,this.rank=t,console.log("initItemRanker",this.data,this.rank),this.updateUI()},updateUI:function(){var e=this.checkIfMainPlayer();switch(this.iconMainPlayer&&(e&&this.listIconMainPlayer&&this.listIconMainPlayer.length>1?(this.iconMainPlayer.spriteFrame=this.listIconMainPlayer[1],this.iconMainPlayer.node.active=!0):this.listIconMainPlayer&&this.listIconMainPlayer.length>0&&(this.iconMainPlayer.spriteFrame=this.listIconMainPlayer[0],this.iconMainPlayer.node.active=!0)),this.rank){case 1:case 2:case 3:this.rankLb.node.active=!1,this.iconTopRank.node.active=!0,this.iconTopRank.spriteFrame=this.listIconTopRank[this.rank-1];break;default:this.rankLb.node.active=!0,this.iconTopRank.node.active=!1,this.rankLb.string=this.rank.toString()}this.rankLb.string=this.rank.toString(),this.namePlayerLb.string=this.data.displayName||"---";var t="";void 0!==this.data.chapter&&void 0!==this.data.stage?t="Chapter "+this.data.chapter+" -  Stage "+this.data.stage:void 0!==this.data.highest_stage&&(t="Stage "+(this.data.highest_stage+1),void 0!==this.data.maintain_time&&(t+=" | Time: "+this.data.maintain_time+"s")),this.scoreLb.string=t},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},checkIfMainPlayer:function(){if(!this.data)return!1;var e=null,t=null;"undefined"!=typeof user&&user&&(user.getUID&&(e=user.getUID()),user.getUserName&&(t=user.getUserName())),!e&&window.user&&(e=window.user.uid||window.user.id||window.user.player_id,t=window.user.username||window.user.name),e||(e=cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid"),t=cc.sys.localStorage.getItem("username"));var i=!1;return e&&(i=this.data.player_id===e||this.data.uuid===e||this.data.uid===e),!i&&t&&this.data.username&&(i=this.data.username===t),console.log("ItemRanker - Check if main player:",{currentPlayerId:e,currentUsername:t,itemPlayerId:this.data.player_id||this.data.uuid,itemUsername:this.data.username,isMainPlayer:i}),i}}),cc._RF.pop()},{}],Item:[function(e,t){"use strict";var i,a;cc._RF.push(t,"7fce0fqnYtPvZuf8KQVfoip","Item");var n=((i={gold:[1,100],diamond:[10,20,30,50,100],energy:[10,20,30,50,100],exp:[50,100,150,250,500],talent:[1,2,3,5,10],shard:[1,2,3,5,10]})[BLUEPRINT_ATK]=[0,0,1,2,3],i[BLUEPRINT_HP]=[0,0,1,2,3],i[BLUEPRINT_SKILL]=[0,0,1,2,3],i.blueprint=[0,0,1,2,3],i[SWEEP_TICKET]=[0,0,0,1,2],i[KEY_L]=[0,0,0,0,1],i[KEY_M]=[0,0,0,1,2],i.silver=[1,100],i.sweepTicketBox=[0,0,0,0,1],i[RECRUIT_TICKET]=[0,0,0,0,1],i[HERO_REFRESH_TICKET]=[1,2,3,5,10],i),o=[cc.color(100,100,100),cc.color(0,100,0),cc.color(10,10,250),cc.color(250,0,250),cc.color(255,255,0),cc.color(255,0,0)];cc.Class({extends:cc.Component,properties:(a={heroPrefab:cc.Prefab,silverIcon:cc.SpriteFrame,vehiclePrefab:cc.Prefab,goldIcon:cc.SpriteFrame,diamondIcon:cc.SpriteFrame,energyIcon:cc.SpriteFrame,expIcon:cc.SpriteFrame,talentIcon:cc.SpriteFrame,midBoxKeyIcon:cc.SpriteFrame,bigBoxKeyIcon:cc.SpriteFrame,expProgressionTrackIcon:cc.SpriteFrame,spfItemUnlock:[cc.SpriteFrame]},a[BLUEPRINT_ATK+"Icon"]=cc.SpriteFrame,a[BLUEPRINT_HP+"Icon"]=cc.SpriteFrame,a[BLUEPRINT_SKILL+"Icon"]=cc.SpriteFrame,a.blueprintIcon=cc.SpriteFrame,a[SWEEP_TICKET+"Icon"]=cc.SpriteFrame,a.sweepTicketBoxIcon=cc.SpriteFrame,a.itemRanks=[cc.SpriteFrame],a.shardIcon=[cc.SpriteFrame],a.equipmentIcon=[cc.SpriteFrame],a.equipmentRarityIcon=[cc.SpriteFrame],a.rankSprite=cc.Sprite,a.maskNode=cc.Node,a.numLabel=cc.Label,a[RECRUIT_TICKET+"Icon"]=cc.SpriteFrame,a[HERO_REFRESH_TICKET+"Icon"]=cc.SpriteFrame,a),init:function(e,t){this.item=e;var i=this.maskNode;i.destroyAllChildren();var a="";if(e.i==HERO||e.i==VEHICLE){if(e.i==VEHICLE){var n=e.id,o=pc.getVehicleData(n),r=cc.instantiate(this.vehiclePrefab);i.addChild(r);var s=this.model=r.getComponent("VehicleModel");s.init(o,{}),s.play("stand"),a=LI(o.name),r.y=-40,r.scale=.6}else{var c=e.id,l=pc.getHeroData(c),d=cc.instantiate(this.heroPrefab);i.addChild(d);var h=this.model=d.getComponent("HeroModel");h.init(l,{}),h.play("stand"),a=l.name,d.y=-40,d.scale=.9}return t&&(t.string=a),this.rankSprite.spriteFrame=null,void(this.numLabel.string="")}a=LI(e.i),e.i==SHARD&&(a=ENTITY[e.id].name+a),e.i==EQUIPMENT&&null==e.isItemUnlock&&(e.rarity?(a=LI("equip_piece",{n:["\u767d","\u7eff","\u84dd","\u7d2b"][e.rarity]}),this.rankSprite.spriteFrame=this.itemRanks[e.rarity]):(a=LI("shard_f",{n:BackpackItemDefine[e.id].name}),this.rankSprite.spriteFrame=null));var u=new cc.Node;i.addChild(u),null!=e.id&&e.i==EQUIPMENT?null!=e.isItemUnlock?u.addComponent(cc.Sprite).spriteFrame=this.getIconFrameItemUnlock(equipment.getIdEByName(e.id)):"isPuzzle"in e&&!e.isPuzzle?u.addComponent(cc.Sprite).spriteFrame=this.getIconFrameItemUnlock(equipment.getIdEByName(e.id)):u.addComponent(cc.Sprite).spriteFrame=this.getIconFrame(e):u.addComponent(cc.Sprite).spriteFrame=this.getIconFrame(e),this.iconNode=u,this.name=a,this.setNum(e,t)},getIconFrame:function(e){if(e.i==EQUIPMENT){var t=e.id;if(e.rarity)return this.equipmentRarityIcon[e.rarity-1];for(var i in this.equipmentIcon){var a=this.equipmentIcon[i];if(t==a.name)return a}}else{if(e.i!=SHARD)return this[e.i+"Icon"];for(var n in t=e.id,this.shardIcon){var o=this.shardIcon[n];if(t==o.name)return o}}},getIconFrameItemUnlock:function(e){return this.spfItemUnlock[e]},getRank:function(){return this.rank||0},getColor:function(){var e=this.getRank();return o[e]||cc.color(255,255,255)},setNum:function(e,t){var i=0,a=n[e.i];if(a)for(var o in a){if(e.n<a[o])break;i=o}this.rank=i,this.rankSprite.spriteFrame=this.itemRanks[i],this.numLabel.string="x"+(e.n||0),"sweepTicketBox"==e.i&&(this.numLabel.string=""),t&&(t.string=this.name),null!=e.isItemUnlock&&(this.numLabel.string="",this.rankSprite.spriteFrame=this.itemRanks[5])},setGray:function(e){var t;t=e?"2d-gray-sprite":"2d-sprite",this.rankSprite.setMaterial(0,cc.Material.getBuiltinMaterial(t)),this.iconNode&&this.iconNode.getComponent(cc.Sprite).setMaterial(0,cc.Material.getBuiltinMaterial(t))},setTouchEnabled:function(e){this.node._touchListener.setEnabled(e)},onPopInfo:function(){menuManager.pop("item_info",{item:this.item})},start:function(){}}),cc._RF.pop()},{}],Joint:[function(e,t){"use strict";cc._RF.push(t,"f1291I8AYZMYrHV/apchSy1","Joint"),cc.Class({extends:e("../../core/base/Proto"),init:function(e,t,i){this.game=e,this.garrisonArray=[],this.garrisonMax=3,this.obj=i.obj,this.dx=t.x||0,this.dy=t.y||0,this.w=t.w||100,this.h=t.h||20,this.slotType=t.slot},garrisonUnit:function(e,t){e.attachedSlot||(e.onSlotIn(this),e.fly=!0,e.vx=0,e.vy=0,e.ropeLength=this.h*(10-this.garrisonArray.length)/10,e.ropePos=this.h*t,this.garrisonArray.push(e))},releaseUnit:function(e){e.attachedSlot&&(e.fly=!1,e.onSlotOut())},updateOffset:function(e){if(this.garrisonArray.length<this.garrisonMax){var t=this.game.getEntityList(),i=this.obj.team,a=this.obj.deg,n=this.obj.getPositionX(),o=this.obj.getPositionY(),r=c_degree2sin(a)*this.h,s=-c_degree2cos(a)*this.h,c=1/(this.h*this.h),l=c_abs(.5*r),d=c_abs(.5*s);for(var h in t){var u=t[h];if(u.team===i&&!u.isFly()&&!u.attachedSlot&&!u.isDead()&&u.climbFlag){var p=u.getPositionX(),f=u.getPositionY(),m=u.radius;if(c_abs(p-n-.5*r)<l+m+0&&c_abs(f-o-.5*s)<d+m+0){var g=((p-n)*r+(f-o)*s)*c;g>1?g=1:g<0&&(g=0);var v=n+g*r-p,y=o+g*s-f;v*v+y*y<(m+0)*(m+0)&&this.garrisonUnit(u,g)}}}}for(var b=this.garrisonArray,k=this.obj.deg,T=0,_=b.length;T<_;T++){var w=this.garrisonArray[T];if(w.isDead()||w.attachedSlot!==this)b.splice(T,1),T--,_--;else{w.ropePos<w.ropeLength&&(w.ropePos+=150*e);var E=this.obj.x+c_degree2sin(k)*w.ropePos,C=this.obj.y-c_degree2cos(k)*w.ropePos,S=E-w.x,I=C-w.y;if(w.applyMoveOffset(S,I),w.slotsList)for(var A in w.slotsList)w.slotsList[A].updateOffset(e,S,I)}}},onHurt:function(){},getRoot:function(){return this.obj},callDeath:function(e,t,i,a){for(var n in this.garrisonArray){var o=this.garrisonArray[n];o.isDead()||o.attachedSlot!==this||(o.onSlotOut(),o.callDeath(e,t,i,a))}},getGroundDegree:function(){return 0},getGroundLine:function(){return 0},getPositionX:function(){return this.dx+this.obj.getPositionX()},getPositionY:function(){return this.dy+this.obj.getPositionY()}}),cc._RF.pop()},{"../../core/base/Proto":"Proto"}],JoyButton:[function(e,t){"use strict";cc._RF.push(t,"1d4272wKS5Msa7JwZvoyGBL","JoyButton"),cc.Class({extends:cc.Component,properties:{node0:cc.Node,node1:cc.Node,key:cc.macro.KEY.space,fingerFrm:cc.SpriteFrame},init:function(e,t){this.game=e,this.touchCb=t.touchCb,this.checkButtonCb=t.checkButtonCb,this.checkTimer=0,this.touchType=BTN_UP,this.touch={},this.scale=this.node.scale,this.radius=t.r||80,this.rr=this.radius*this.radius,this.node0.active=!0,this.node1.active=!1},onEnable:function(){this.key&&(cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this))},onDisable:function(){this.key&&(cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this))},setType:function(e){if(2==e)this.disabled=!0,this.setGray(!0),this.finger&&(this.finger.destroy(),delete this.finger);else if(1==e){if(this.disabled=!1,this.setGray(!1),!this.finger){var t=this.finger=new cc.Node;this.node.addChild(t),t.addComponent(cc.Sprite).spriteFrame=this.fingerFrm,t.setAnchorPoint(.35,.85),t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.3,1.2),cc.moveTo(.3,0,10)),cc.spawn(cc.scaleTo(.3,1),cc.moveTo(.3,0,0))).repeatForever())}}else this.finger&&(this.finger.destroy(),delete this.finger),this.disabled=!1,this.setGray(!1)},setGray:function(e){e?(this.node0.color=cc.color(5,5,5),this.node1.color=cc.color(5,5,5)):(this.node0.color=cc.color(255,255,255),this.node1.color=cc.color(255,255,255))},check:function(e){this.checkButtonCb(this.touchType)?(this.checkTimer+=e,this.checkTimer>.3&&(this.onTouch(this.touchType),this.checkTimer=0,cc.log("check correct",this.touchType))):this.checkTimer=0},onTouch:function(e){this.touchType=e,this.touchCb(e)},onKeyDown:function(e){if(e.keyCode==this.key&&!this.keyDown){if(this.disabled)return;this.keyDown=!0,this.onTouch(BTN_DOWN)}},onKeyUp:function(e){e.keyCode==this.key&&this.keyDown&&(this.keyDown=!1,this.onTouch(BTN_UP))},onTouchBegan:function(e,t){if(!this.disabled){var i=this.node.convertToWorldSpaceAR(cc.v2(0,0)),a=e.x-i.x,n=e.y-i.y;if(a*a+n*n<this.rr)return this.onTouch(BTN_DOWN),this.touch[t]=!0,this.node0.active=!1,this.node1.active=!0,!0;if(this.finger){var o=cc.instantiate(this.node0);this.node.addChild(o,-1),o.opacity=0,o.scale=4,o.runAction(cc.sequence(cc.spawn(cc.scaleTo(.4,1),cc.fadeIn(.4)).easing(cc.easeBounceOut()),cc.destroySelf()))}}},onTouchMoved:function(e,t){this.touch[t]},onTouchEnded:function(e,t){if(this.touch[t])return this.onTouch(BTN_UP),this.touch[t]=!1,this.node0.active=!0,this.node1.active=!1,!0},onTouchCanceled:function(e,t){this.onTouchEnded(e,t)},clearTouch:function(){for(var e in this.touch)this.touch[e]&&this.onTouchEnded(null,e)}}),cc._RF.pop()},{}],JoystickButton:[function(e,t){"use strict";cc._RF.push(t,"f51daNBNUFDva+P9HU/gtZs","JoystickButton"),cc.Class({extends:cc.Component,properties:{icon:cc.Sprite,cd:cc.Sprite,cover:cc.Sprite,light:cc.Sprite,anime:cc.Animation,timeLabel:cc.Label},init:function(e,t){this.cb=t.cb,this.touch={},this.scale=this.node.scale,this.radius=t.r||80,this.rr=this.radius*this.radius,t.skill&&(this.enabled=!0,e.layer.bindScheduler(this.node),this.icons=t.icons,this.setIcon(t.icon),this.onSkillCD(t.skill),this.scheduleVS(this.updateReal,0)),t.key&&!this.key&&(cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.key=t.key),this.node.getComponent(cc.Button).interactable=!0,this.helpCb=t.helpCb},setIcon:function(e){var t=this;e&&cc.resources.load(e,cc.SpriteFrame,function(e,i){t.icon.spriteFrame=i})},onDestroy:function(){this.key&&(cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),delete this.key)},onKeyDown:function(e){e.keyCode==this.key&&this.cb(BTN_DOWN,0,0)},onKeyUp:function(e){e.keyCode==this.key&&this.cb(BTN_UP,0,0)},onClick:function(){this.cb(BTN_DOWN,0,0),this.cb(BTN_UP,0,0)},updatePos:function(e){this.startProgress>0||this.cb(e)},onTouchBegan:function(e,t){var i=this.node.convertToWorldSpaceAR(cc.v2(0,0)),a=e.x-i.x,n=e.y-i.y;if(a*a+n*n<this.rr)return this.x=e.x,this.y=e.y,this.updatePos(BTN_DOWN,e.x-this.x,e.y-this.y),this.touch[t]=!0,this.node.setScale(1.1*this.scale),!0},onTouchMoved:function(e,t){this.touch[t]&&this.updatePos(BTN_DOWN,e.x-this.x,e.y-this.y)},onTouchEnded:function(e,t){if(this.touch[t])return this.updatePos(BTN_UP,e.x-this.x,e.y-this.y),this.touch[t]=!1,this.node.setScale(1*this.scale),!0},onTouchCanceled:function(e,t){this.onTouchEnded(e,t)},shine:function(){this.light.enabled=!0;var e=this.light.node;e.opacity=0,e.runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.5),cc.fadeOut(.2),cc.fadeIn(.2),cc.fadeOut(.2))),this.anime.play()},onSkillSilence:function(){},onSkillRefresh:function(e,t){this.updateCd(t)},onSkillPause:function(e){this.progressAction=!e.frozen},onSkillCD:function(e){var t=e.cdTimer,i=e.castTimer||0,a=e.maxCDTimer;t<=0&&i<=0||(this.startProgress=t/a,this.endProgress=0,this.speed=t<=0?0:(this.endProgress-this.startProgress)/t,e.castAction?(this.castTimer=i,this.castTime=i,this.light.enabled=!0):(this.castTimer=0,this.light.enabled=!1),this.progressAction=!0,this.cover.fillRange=this.startProgress)},updateCd:function(e){this.progressAction&&(this.startProgress+=this.speed*e,this.startProgress<=this.endProgress?(this.startProgress=this.endProgress,this.progressAction=!1,this.shine(),this.timeLabel.string="",this.cd.fillRange=1):this.timeLabel.string=Math.round(100-100*this.startProgress)+"%",this.cover.fillRange=this.startProgress)},updateReal:function(e){if(this.castTimer>0)return this.castTimer-=e,this.castTimer<=0&&(this.light.enabled=!1),void(this.cd.fillRange=this.castTimer/this.castTime);this.updateCd(e)}}),cc._RF.pop()},{}],JoystickItem:[function(e,t){"use strict";cc._RF.push(t,"d8958GxcbxBV7FBEXAwdGiB","JoystickItem");var i=cc.Class({extends:cc.Component,properties:{item:"",icon:cc.Sprite,cd:cc.Sprite,numLabel:cc.Label,nameLabel:cc.Label},init:function(e){this.game=e,e.layer.bindScheduler(this.node),this.scheduleVS(this.updateReal,0);var t=new cc.Component.EventHandler;t.target=this.node,t.component="JoystickItem",t.handler="onClick",t.customEventData="",this.node.getComponent(cc.Button).clickEvents.push(t),this.updateData()},setIcon:function(e){var t=this;e&&cc.resources.load(e,cc.SpriteFrame,function(e,i){t.icon.spriteFrame=i})},onLoad:function(){this.cdTimer=0,this.castTimer=0,this.updateData(),i.list.includes(this)||(i.list.push(this),cc.game.on("add_item",this.onAddItem,this))},onDestroy:function(){var e=i.list.indexOf(this);e>=0&&(i.list.splice(e,1),cc.game.off("add_item",this.onAddItem,this))},onAddItem:function(e){if(e.id==this.item){var t=cc.Canvas.instance.node,i=e.pos||cc.v2(cc.winSize.width/2,cc.winSize.height/2),a=t.convertToNodeSpaceAR(i),n=t.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0))),o=cc.instantiate(this.icon.node);t.addChild(o,cc.macro.MAX_ZINDEX),o.color=cc.color(255,255,255),o.scale=1.5,o.opacity=0,o.x=a.x,o.y=a.y,o.runAction(cc.sequence(cc.delayTime(.3),cc.spawn(cc.scaleTo(.1,.7),cc.fadeIn(.2)),cc.bezierTo(.3,[cc.v2(a.x+kit.rnd(-200,200),a.y+kit.rnd(-200,200)),cc.v2(n.x+kit.rnd(-200,200),n.y+kit.rnd(200,0)),n]).easing(cc.easeIn(1)),cc.callFunc(function(){this.updateData()},this),cc.destroySelf()))}},updateData:function(){var e=chapter.data.combatItem[this.item];this.node.getComponent(cc.Button).interactable=this.game&&e>0,this.numLabel.string=e||0,this.cdTimer<=0&&(this.icon.node.color=e>0?cc.color(255,255,255):cc.color(50,50,50)),this.castTimer<=0&&(this.cd.fillRange=e>0?1:0)},onClick:function(){if(!(this.cdTimer>0||this.castTimer>0)){var e=COMBAT_ITEMS[this.item];this.game&&e&&(e.func.call(this,this.game),chapter.data.combatItem[this.item]--,this.updateData()),this.castTimer=10}},onCd:function(){chapter.data.combatItem[this.item]>0&&(this.cdTimer=10,this.icon.node.color=cc.color(150,50,50),this.cd.node.opacity=100)},updateReal:function(e){this.cdTimer>0&&(this.cdTimer-=e,this.cdTimer<=0&&(this.icon.node.color=cc.color(255,255,255),this.cd.node.opacity=255)),this.castTimer>0&&(this.castTimer-=e,this.cd.fillRange=this.castTimer/10,this.castTimer<=0&&this.updateData())},statics:{list:[]}});cc._RF.pop()},{}],JoystickRocker:[function(e,t){"use strict";cc._RF.push(t,"b2a10eXGgRLYIAG/DT1EHrC","JoystickRocker"),window.JOYSTICK_MODE=3,cc.Class({extends:cc.Component,properties:{btn:cc.Node},init:function(e,t){this.game=e,this.cb=t.cb,this.touchId=null,this.radius=100,this.follow=50,this.btn.opacity=0,this.canTouch=!0,this.aimPos=null,this.node.active=this.game.config.gunnerMode},onDestroy:function(){},setTouchEnabled:function(e){this.canTouch=e,this.btn.active=e},setVisible:function(e){this.btn.opacity=e?255:0},onKeyDown:function(e){var t=e.keyCode;if(!this.keys[t]){if(this.keys[t]=1,t==cc.macro.KEY.up)this.dy++;else if(t==cc.macro.KEY.down)this.dy--;else if(t==cc.macro.KEY.left)this.dx--;else{if(t!=cc.macro.KEY.right)return;this.dx++}0==this.dx&&0==this.dy||this.cb(BTN_DOWN,this.dx,this.dy)}},onKeyUp:function(e){var t=e.keyCode;if(this.keys[t]=0,t==cc.macro.KEY.up)this.dy--;else if(t==cc.macro.KEY.down)this.dy++;else if(t==cc.macro.KEY.left)this.dx++;else{if(t!=cc.macro.KEY.right)return;this.dx--}0==this.dx&&0==this.dy?this.cb(0,0):this.cb(BTN_UP,this.dx,this.dy)},updatePos:function(e,t){3==JOYSTICK_MODE&&(t.y+=120),t=1!=JOYSTICK_MODE&&t||this.aimPos;var i=this.node.getParent().convertToNodeSpaceAR(t);this.node.setPosition(i);var a=this.game.layer.camera.getScreenToWorldPoint(t);a=this.game.layer.midLayer.convertToNodeSpaceAR(a),this.cb(e,a.x,a.y)},onTouchBegan:function(e,t){if(this.canTouch){var i=cc.winSize.height-150;return null===this.touchId&&e.y<i?(this.touchId=t,this.aimPos||(this.aimPos=e),this.btn.opacity=255,this.btn.scale=1.2,this.updatePos(BTN_DOWN,e),this.touchPos=e,!0):void 0}},onTouchMoved:function(e,t){if(this.canTouch)return this.touchId==t?(this.aimPos&&(this.aimPos.x+=e.x-this.touchPos.x,this.aimPos.y+=e.y-this.touchPos.y,this.aimPos.x=kit.clamp(this.aimPos.x,0,cc.winSize.width),this.aimPos.y=kit.clamp(this.aimPos.y,350,cc.winSize.height)),this.updatePos(BTN_DOWN,e),this.touchPos=e,!0):void 0},onTouchEnded:function(e,t){if(this.canTouch){if(this.touchId==t)return this.touchId=null,this.updatePos(BTN_UP,e),this.btn.opacity=128,this.btn.scale=.7,this.aimPos&&(this.aimPos.x+=e.x-this.touchPos.x,this.aimPos.y+=e.y-this.touchPos.y,this.aimPos.x=kit.clamp(this.aimPos.x,0,cc.winSize.width),this.aimPos.y=kit.clamp(this.aimPos.y,350,cc.winSize.height)),this.touchPos=e,!0}else{var i,a,n,o=this.game.levelMgr.heroes[1];n=null==o?void 0:null==(i=o.mainTower)?void 0:null==(a=i.hero)?void 0:a.define.id,menuManager.chatOn(null,"\u8ba9\u6211\u4eec\u81ea\u5df1\u6765\uff01",2,{noFinger:1,noBlack:1,head:n,dy:330,dx:-160})}},onTouchCanceled:function(e,t){this.onTouchEnded(e,t)}}),cc._RF.pop()},{}],Joystick:[function(e,t){"use strict";cc._RF.push(t,"e1884bHCOBCTae5Ek1Gsr7v","Joystick"),e("../../../../Plugins/firebase/FirebaseTracking"),cc.Class({extends:cc.Component,properties:{rocker:cc.Node,shotBtn:cc.Node,skillNodeList:[cc.Node],chapterBoard:cc.Node,chapterBar:cc.Node,chapterName:cc.Label,itemBtnList:[cc.Node],itemBoard:cc.Node},onLoad:function(){this.enabled=!1},onRemove:function(){this.node.active=!1},setVisible:function(e){this.node.active=e},setRockerVisible:function(e){this.rocker.getComponent("JoystickRocker").setVisible(e)},setEnabled:function(e){for(var t in this.chapterBoard.active=e,this.itemBoard.active=e,this.rocker.active=e,this.skillNodeList)this.skillNodeList[t].active=e;this.node._touchListener&&this.node._touchListener.setEnabled(e)},init:function(e,t,i){this.define=i,this.obj=t,this.game=e,this.initUI(),this.initGuide()},initUI:function(){var e=this.game,t=e.sync,i=this.obj;this.btnList=[],this.skillBtnList=[],this.enabled=!0;var a=i.define;for(var n in a.towerSlots){var o=i.towers[n];o&&!o.isDead()&&this.btnList.push(o.avatar.hpBar)}for(var r=[{key:cc.macro.KEY.z,skillIndex:0,cb:function(e){t.sendSkill(i.uniqueID,0,e)}}],s=0;s<r.length;s++){var c=this.skillNodeList[s],l=r[s],d=r[s].skillIndex;void 0!==d&&(l.skill=i.skills[d],l.icon=i.skills[d].define.icon),l.game=e,(u=c.getComponent("JoystickButton")).init(e,r[s]),void 0!==d&&(this.skillBtnList[d]=u)}this.rocker&&((u=this.rocker.getComponent("JoystickRocker")).init(e,{cb:function(e,a,n){t.sendAttack(i.uniqueID,e,a,n)}}),this.btnList.push(u),2==this.game.config.auto&&u.setTouchEnabled(!1));var h=[0,1,2];for(s=0;s<h.length;s++){var u;(u=(c=this.itemBtnList[s]).getComponent("JoystickItem")).init(e,h[s])}this.chapterName.string=(e.config.name||"")+" "+(e.config.mapName||""),this.chapterBar.width=0},initGuide:function(){this.longTimeNoTouchTimer=0},update:function(e){this.obj;var t=this.game.levelMgr.distance;this.chapterBar.width=357*kit.clamp(this.game.levelMgr.x/t,0,1),this.longTimeNoTouchTimer+=e,this.longTimeNoTouchTimer>5&&(this.longTimeNoTouchTimer=0,cc.game.emit("longTimeNoTouch"))},initTouch:function(){var e=this.node;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this)},initKeyboard:function(){},onTouchBegan:function(e,t){for(var i in this.longTimeNoTouchTimer=0,this.btnList)if(this.btnList[i].onTouchBegan(e,t))return!0;return!0},onTouchMoved:function(e,t){for(var i in this.longTimeNoTouchTimer=0,this.btnList)if(this.btnList[i].onTouchMoved(e,t))return!0},onTouchEnded:function(e,t){for(var i in this.longTimeNoTouchTimer=0,this.btnList)if(this.btnList[i].onTouchEnded(e,t))return!0},onTouchCanceled:function(e,t){for(var i in this.btnList)if(this.btnList[i].onTouchCanceled(e,t))return!0},start:function(){this.initTouch(),this.initKeyboard()},onSkillUpdate:function(e,t){if(t==SKILL_STATUS.RESET)this.skillBtnList[+e.id].onSkillCD(e);else if(t==SKILL_STATUS.START_CAST)this.skillBtnList[+e.id].onSkillCD(e);else if(t==SKILL_STATUS.END_CAST){var i=this.skillBtnList[+e.id];i.onSkillCD(e),i.icons&&e.phase!=i.phase&&(i.phase=e.phase,i.setIcon(i.icons[e.phase]))}else t==SKILL_STATUS.FROZEN&&this.skillBtnList[+e.id].onSkillPause(e)},onSkillRefresh:function(e,t){this.skillBtnList[+e.id].onSkillRefresh(e,t)},onSkillSilence:function(e,t){this.skillBtnList[+e.id].onSkillSilence(e,t)}}),cc._RF.pop()},{"../../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],KillBuff:[function(e,t){"use strict";cc._RF.push(t,"87e41+bemdD443Xbh9+Bz9Y","KillBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.killBuff=e.killBuff;var t=this.obj;this.game.eventMgr.regist(t,"killEvent",this,this.killEvent)},killEvent:function(){this.obj.addBuff(this,this.killBuff)},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"killEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],KillExplosionBuff:[function(e,t){"use strict";cc._RF.push(t,"d33ff1UEfJLkLphGnlkNTQ4","KillExplosionBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.killBuff=e.killBuff;var t=this.obj;cc.warn("killEvent begin",t.define.name),this.game.eventMgr.regist(t,"killEvent",this,this.killEvent)},killEvent:function(e,t){cc.warn("killEvent",e.define.name,t.define.name);var i=this.define.bomb,a=i.r1,n=i.r0,o=i.kb,r=t.x,s=t.y,c=this.team,l=i.dmg0,d=(i.dmg1-l)/l,h=this.game.contactMgr.getContactList();for(var u in h){var p=h[u],f=p.getEntity();if(p._activeContact&&f.isInBorder()&&f.team!=c){var m=p.hitRadius+a,g=r-p.getPositionX(),v=s-p.getPositionY(),y=g*g+v*v;if(y<=m*m){var b=c_sqrt(y)+.1;if(b<=n)f.onHurt(this,l,i.weaponType,i.dmgType);else{var k=l*(1+d*(b-n)/(m-n));f.onHurt(this,k,i.weaponType,i.dmgType)}var T=o/(b*f.weight);if(f.onKnockback(-g*T,-v*T),f.isDead())if(f.y<=f.height+this.game.contactMgr.findGroundLine(f.x)){var _=g>0&&kit.rnd(-600,-350)||kit.rnd(350,600);f.applyVelocity(_,kit.rnd(1e3,1250))}else{var w=kit.rnd(750,1e3),E=(_=-g/(Math.abs(g)+Math.abs(v))*w,-v/(Math.abs(g)+Math.abs(v))*w);f.applyVelocity(_,E)}}}}var C=this.hurtDelayTime;i.effect&&this.game.callEffect(i.effect,r,s,a,C)},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"killEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],Knife:[function(e,t){"use strict";cc._RF.push(t,"9db2dh8RRBF7a4y07sk1672","Knife"),t.exports={shot:function(e,t,i){var a=i.team,n=i.obj,o=t.radius||30,r=i.bombDmg||t.dmg||111.11,s=e.contactMgr.getContactList(),c=i.x,l=i.y,d=n.deg,h=t.kb*c_degree2cos(d),u=t.kb*c_degree2sin(d),p=t.hitEffect||EFFECT.slashHit,f=t.buff,m=0,g=t.heal;for(var v in n.hurtDelayTime=.05,s){var y=s[v],b=y.getEntity();if(y._activeContact&&!b.isDead()&&a!=b.team){var k=c-y.x,T=l-y.y,_=b.radius+o;k*k+T*T<=_*_&&(b.onHurt(n,r),b.onKnockback(h/n.weight,u/n.weight),m+=r,f&&b.addBuff(n,f),e.callEffect(p,y.x,y.y,d,.05,.5*y.radius),b.hurtEffect||e.callEffect(EFFECT.spurt,b,d,t.kb,.05))}}m&&g&&n.onHeal(n,m*g)}},cc._RF.pop()},{}],LabelEffect:[function(e,t){"use strict";cc._RF.push(t,"c87b9+zegRLhLhcnjF976/E","LabelEffect");var i=cc.Enum({None:0,OneColor:1,TwoColor:2,TriColor:3}),a=cc.Enum({None:0,Lowp:1,Mediump:2,Highp:3}),n=cc.Enum({Line:0,Step:1,Cubic:2});function o(e){return[e.r/255,e.g/255,e.b/255,e.a/255]}cc.Class({extends:cc.Component,editor:{executeInEditMode:!0,executionOrder:0},properties:{shadowUse:!1,shadowOffset:{default:cc.v2(1,1),visible:function(){return this.shadowUse}},shadowColor:{default:cc.color(0,0,0,150),visible:function(){return this.shadowUse}},outlineUse:!1,outlineWidth:{default:1,visible:function(){return this.outlineUse}},outlineColor:{default:cc.color(0,0,0,255),visible:function(){return this.outlineUse}},outlineShadowUse:{default:!1,visible:function(){return this.outlineUse}},outlineShadowOffset:{default:cc.v2(1,1),visible:function(){return this.outlineUse&&this.outlineShadowUse}},outlineShadowColor:{default:cc.color(0,0,0,150),visible:function(){return this.outlineUse&&this.outlineShadowUse}},flowLightUse:!1,flowLightSpeed:{default:1,visible:function(){return this.flowLightUse}},flowLightRot:{default:0,visible:function(){return this.flowLightUse}},flowLightWidth:{default:15,visible:function(){return this.flowLightUse}},flowLightColor:{default:cc.color(255,255,255,255),visible:function(){return this.flowLightUse}},flowLightTime:{default:0,visible:function(){return this.flowLightUse}},_gradient:i.None,gradient:{get:function(){return this._gradient},set:function(e){this._gradient!==e&&(this._gradient=e)},type:i},_gradientMix:n.Line,gradientMix:{get:function(){return this._gradientMix},set:function(e){this._gradientMix!==e&&(this._gradientMix=e)},type:n},gradientRot:{default:0,visible:function(){return this._gradient!==i.None}},color1:{default:cc.color(255,0,0,255),visible:function(){return this._gradient!==i.None}},color2:{default:cc.color(0,255,0,255),visible:function(){return this._gradient>=i.TwoColor}},color3:{default:cc.color(0,0,255,255),visible:function(){return this._gradient>=i.TriColor}},_glow:a.None,glow:{get:function(){return this._glow},set:function(e){this._glow!==e&&(this._glow=e)},type:a},glowWidth:{default:10,visible:function(){return this._glow!==a.None}},glowDepth:{default:5,visible:function(){return this._glow!==a.None}},glowColor:{default:cc.color(255,255,255,255),visible:function(){return this._glow!==a.None}},arcUse:!1,_time:0,_mtl:cc.Material},onLoad:function(){this.initMat(),this._time=this.flowLightTime},initMat:function(){this._mtl=this.getComponent(cc.Label).getMaterial(0),this._mtl.define("USE_TEXTURE",!0,0),this.getComponent(cc.Label).setMaterial(0,this._mtl),this.use()},getVec2:function(e,t){return[e/this.node.width,t/this.node.height]},use:function(){var e=this._mtl;if(e){switch(e.setProperty("i_resolution",[this.node.width,this.node.height]),e.define("USE_SHADOW",this.shadowUse,0),this.shadowUse&&(e.setProperty("i_shadowOffset",this.getVec2(-this.shadowOffset.x,-this.shadowOffset.y)),e.setProperty("i_shadowColor",o(this.shadowColor))),e.define("USE_OUTLINE",this.outlineUse,0),this.outlineUse&&(e.setProperty("i_outlineWidth",this.getVec2(this.outlineWidth,this.outlineWidth)),e.setProperty("i_outlineColor",o(this.outlineColor)),e.define("USE_OUTLINE_SHADOW",this.outlineShadowUse,0),this.outlineUse&&(e.setProperty("i_olShadowOffset",this.getVec2(-this.outlineShadowOffset.x,-this.outlineShadowOffset.y)),e.setProperty("i_olShadowColor",o(this.outlineShadowColor)))),e.define("USE_GRADIENT",this.gradient,0),e.define("GRADIENT_MIX",this.gradientMix,0),this.gradient){case i.None:e.setProperty("i_color1",o(this.node.color));break;case i.TriColor:e.setProperty("i_color3",o(this.color3));case i.TwoColor:e.setProperty("i_color2",o(this.color2));case i.OneColor:e.setProperty("i_color1",o(this.color1)),e.setProperty("i_gRot",this.gradientRot)}e.define("USE_FLOW_LIGHT",this.flowLightUse,0),this.flowLightUse&&(e.setProperty("i_flRot",180*Math.atan(Math.tan(Math.PI*this.flowLightRot/180)*this.node.height/this.node.width)/Math.PI),e.setProperty("i_flWidth",this.flowLightWidth/this.node.width),e.setProperty("i_flColor",o(this.flowLightColor))),e.define("USE_GLOW",this.glow,0),this.glow!==a.None&&(e.setProperty("i_glowWidth",this.getVec2(this.glowWidth,this.glowWidth)),e.setProperty("i_glowDepth",this.glowDepth),e.setProperty("i_glowColor",o(this.glowColor))),e.define("USE_ARC",this.arcUse,0),this.updateRender(0)}},updateRender:function(e){if(this.flowLightUse){this._time+=e;var t=this._mtl;t&&t.setProperty("i_flTime",this.flowLightSpeed*this._time*60/this.node.width)}},update:function(e){this.updateRender(e)}}),cc._RF.pop()},{}],Laser:[function(e,t){"use strict";cc._RF.push(t,"c8e3dQDoU9GrobSuTtjISXh","Laser");var i=e("../components/visual/VirtualAvatar"),a=cc.Class({extends:e("../core/base/Proto"),init:function(e,t,i){this.define=t,this.config=i,this.game=e,this.obj=i.obj,this.team=i.team||0,this.dmg=i.dmg||t.dmg||0,this.knockBack=t.kb||0,this.radius=t.radius||0,this.timer=t.life||.3,this.attackTimer=.1;var a=t.disExtra||70;i.distance&&i.distance<t.distance?a+=i.distance:a+=t.distance,this.distance=a,this.height=1;var n=this.obj,o=n.scale;this.dx=t.dx*n.flipX*o,this.dy=t.dy*o,this.initStatus(),this.updateLogic(0)},initStatus:function(){this.initAvatar(),this.game.addUpdate(this),this.game.contactMgr.addBullet(this)},updateLogic:function(e){var t=this.obj,i=this.deg=t.deg,a=c_degree2cos(i),n=c_degree2sin(i),o=this.dx,r=this.dy,s=t.x+n*o+a*r,c=t.y-a*o+n*r;this.x0=s,this.y0=c,this.x=s+a*this.distance,this.y=c+n*this.distance,this.moveSpdX=a,this.moveSpdY=n,this.timer-=e,this.avatar&&this.avatar.refresh(this.x0,this.y0,this.x,this.y,0),this.timer<=0&&this.remove(BULLET_FADE_TYPE.TIME_OUT)},onTimeOut:function(){this.remove(BULLET_FADE_TYPE.TIME_OUT)},onFail:function(e,t){this.hurtDelayTime=0,this.x=e,this.y=t,this.avatar&&this.avatar.refresh(this.x0,this.y0,this.x,this.y,1)},onHitWall:function(e,t,i){var a=this.x-this.x0,n=this.y-this.y0;this.hurtDelayTime=1==i&&0!=a?STEP_TIME*(e-this.x0)/a:2==i&&0!=n?STEP_TIME*(t-this.y0)/n:0,this.x=e,this.y=t,this.avatar&&this.avatar.refresh(this.x0,this.y0,this.x,this.y,1)},onHit:function(e,t){if(!e.isDead()&&!(e.onBltContact&&e.onBltContact(this)||(this.hurtDelayTime=STEP_TIME*t,this.x=this.x0+(this.x-this.x0)*t,this.y=this.y0+(this.y-this.y0)*t,e.onHurt(this,this.dmg)))){if(this.knockBack){var i=this.knockBack/e.weight;e.onKnockback(this.moveSpdX*i,this.moveSpdY*i)}this.buff&&e.addBuff(this,this.buff),this.avatar&&this.avatar.refresh(this.x0,this.y0,this.x,this.y,2)}},initAvatar:function(){var e=this.obj;if(e.electricAvatar)this.avatar=e.electricAvatar,e.electricCount+=1,1==e.electricCount&&this.avatar.restart();else{var t=this.define,a=t.dx,n=t.dy;this.avatar=this.game.callEffect(t.effect,e.avatar,a,n)||i,e.electricAvatar=this.avatar,e.electricCount=1}},removeAvatar:function(){var e=this.obj;e.electricCount-=1,0==e.electricCount&&this.avatar.stop()},onRemove:function(){this.removeAvatar(),this.game.removeUpdate(this),this.game.contactMgr.removeBullet(this)}});a.shot=function(e,t,i){var n=i.deg||i.obj.deg,o=new a;return o.init(e,t,i,n),o},cc._RF.pop()},{"../components/visual/VirtualAvatar":"VirtualAvatar","../core/base/Proto":"Proto"}],LeaderBoardPopup:[function(e,t){"use strict";cc._RF.push(t,"d48115PnzNMXanoebtRjON6","LeaderBoardPopup");var i=e("../../utils/network/ApiClient"),a=e("../../utils/network/ApiClientPromise"),n=e("../../utils/network/ApiEndpoints");cc.Class({extends:e("../core/Menu"),properties:{itemRanker:cc.Prefab,itemReward:cc.Prefab,listTopPlayer:[cc.Node],listIconTopPlayer:[cc.SpriteFrame],toggleTypeRank:cc.ToggleContainer,scrollView:cc.ScrollView,content:cc.Node,contentBottom:cc.Node,loadingLabel:cc.Label,errorLabel:cc.Label,tabButtons:[cc.Node],rewardButton:cc.Button,TimeCoundownLabel:cc.Label},onLoad:function(){var e;this._super(),this.topVisible=((e={})[DIAMOND]=!1,e[GOLD]=!1,e[SWEEP_TICKET]=!1,e[ENERGY]=!1,e[EXP]=!1,e),this.leaderboardData={all:null,mainStory:null,bulletFly:null,shootTarget:null,makeChoice:null},this.currentTab="mainStory",this.isLoading=!1,this.loadingNode=null,this.loadingCount=0,this.timerData=null,this.lastRequestTime={},this.minRequestInterval=1e3,this.lastResetTime=null,this.timerUpdateInterval=null,menuManager.preload("loading")},onClose:function(){this._super(),cc.game.emit("hasUnclaimed",null)},start:function(){this._super(),this.initUI(),this.scrollCheckInterval=0,this.haveReward=!1},onEnable:function(){cc.log("[LeaderBoard] Popup opened, checking for expired timer"),this.leaderboardTimer&&this.leaderboardTimer.totalMilliseconds&&this.leaderboardTimer.totalMilliseconds<=0&&(cc.log("[LeaderBoard] Reset time has passed, clearing all cached data"),this.leaderboardData={all:null,mainStory:null,bulletFly:null,shootTarget:null,makeChoice:null},window.ApiClient&&window.ApiClient.clearCache&&window.ApiClient.clearCache("leaderboard"));var e=this;if(window.leaderboardOpenCount||(window.leaderboardOpenCount=0),window.leaderboardOpenCount++,cc.log("[LeaderBoard] Popup open count:",window.leaderboardOpenCount),cc.sys.isNative){cc.log("[LeaderBoard] Native platform detected, using staggered fetch"),this.fetchLeaderboardTimer();var t=1===window.leaderboardOpenCount?300:800;cc.log("[LeaderBoard] Delaying leaderboard fetch by",t,"ms"),setTimeout(function(){cc.log("[LeaderBoard] Now fetching leaderboard data"),e.fetchAllLeaderboards(),e.checkAndUpdateRewardNotification()},t)}else this.fetchAllLeaderboards(),this.fetchLeaderboardTimer(),this.checkAndUpdateRewardNotification();this.startTimerUpdates(),this.startLocalCountdown()},onDisable:function(){cc.log("[LeaderBoard] Popup closed, stopping timer updates"),this.stopTimerUpdates(),this.stopLocalCountdown(),this.loadingNode&&(this.loadingNode.destroy(),this.loadingNode=null),this.loadingCount=0},onDestroy:function(){this.stopTimerUpdates(),this.loadingNode&&(this.loadingNode.destroy(),this.loadingNode=null),this._super()},update:function(e){this.currentPlayerRankData&&(this.scrollCheckInterval+=e,this.scrollCheckInterval>=.1&&(this.scrollCheckInterval=0,this.checkPlayerItemVisibility(this.currentPlayerRankData)))},initUI:function(){var e=this;if(this.rewardButton.node.active="mainStory"!=this.currentTab,this.toggleTypeRank){var t=this.toggleTypeRank.toggleItems;t&&t.length>0&&(t[0]&&t[0].node.on("toggle",function(){e.switchTab("mainStory")}),t[1]&&t[1].node.on("toggle",function(){e.switchTab("bulletFly")}),t[2]&&t[2].node.on("toggle",function(){e.switchTab("shootTarget")}),t[3]&&t[3].node.on("toggle",function(){e.switchTab("makeChoice")}),t[4]&&t[4].node.on("toggle",function(){e.switchTab("all")}))}this.scrollView&&(this.scrollView.node.on("scrolling",function(){e.checkPlayerItemVisibility(e.currentPlayerRankData)},this),this.scrollView.node.on("scroll-ended",function(){e.checkPlayerItemVisibility(e.currentPlayerRankData)},this),this.scrollView.node.on("bounce-bottom",function(){e.checkPlayerItemVisibility(e.currentPlayerRankData)},this),this.scrollView.node.on("bounce-top",function(){e.checkPlayerItemVisibility(e.currentPlayerRankData)},this))},onShowWeeklyRewardPopup:function(){var e={mainStory:"main_story",bulletFly:"bullet_fly",shootTarget:"shoot_target",makeChoice:"make_choice"}[this.currentTab]||"main_story";window.menuManager&&(window.menuManager.currentPopupData={category:e}),menuManager.pop("reward_leader_board",{category:e,checkCb:function(){cc.log("Show weekly rewards for category:",e)}})},onShowGuidePopup:function(){menuManager.pop("guide_leader_board",{checkCb:function(){cc.log("shoow guide_leader_board")}})},makeRequest:function(e,t,o,r){var s,c=n.LEADERBOARD_BASE+e;cc.sys.isNative&&cc.log("[LeaderBoard] Making request to:",c);var l={timeout:1e4,retries:2};if("GET"===t)s=a.get(c,o,l);else{if("POST"!==t)return void i.request({endpoint:c,method:t,data:o,params:"GET"===t?o:null,decrypt:!0},function(e,t){e?r(null,e):r(t,null)});s=a.post(c,o,l)}s.then(function(e){cc.sys.isNative&&cc.log("[LeaderBoard] Request successful for:",c),r(e,null)}).catch(function(e){cc.sys.isNative&&console.error("[LeaderBoard] Request failed for:",c,e),r(null,e.message||e)})},fetchAllLeaderboards:function(){var e=this;if(!this.isLoading){this.isLoading=!0,this.showLoading(!0),cc.sys.isNative&&cc.log("[LeaderBoard] Fetching all leaderboards with staggered requests");var t=[{endpoint:n.LEADERBOARD_BASE+"/main-story",params:{limit:100},options:{timeout:1e4,retries:1}},{endpoint:n.LEADERBOARD_BASE+"/minigames/bullet-fly",params:{limit:100},options:{timeout:1e4,retries:1}},{endpoint:n.LEADERBOARD_BASE+"/minigames/shoot-target",params:{limit:100},options:{timeout:1e4,retries:1}},{endpoint:n.LEADERBOARD_BASE+"/minigames/make-choice",params:{limit:100},options:{timeout:1e4,retries:1}}];cc.sys.isNative&&(cc.log("[LeaderBoard] Making requests to endpoints:"),t.forEach(function(e,t){cc.log("[LeaderBoard] Request",t,":",e.endpoint)})),a.fetchAll(t).then(function(t){e.isLoading=!1,e.showLoading(!1),cc.sys.isNative&&(cc.log("[LeaderBoard] Received results count:",t?t.length:0),t&&t.forEach(function(e,t){e&&e.error?cc.log("[LeaderBoard] Result",t,"has error:",e.error):e?cc.log("[LeaderBoard] Result",t,"success, has leaderboard:",!!e.leaderboard):cc.log("[LeaderBoard] Result",t,"is null/undefined")})),t&&t[0]?t[0].error?(console.error("[LeaderBoard] Main story error:",t[0].error),e.leaderboardData.mainStory={leaderboard:[],player_rank:null,error:t[0].error}):null===t[0]?(console.warn("[LeaderBoard] Main story returned null from server"),e.leaderboardData.mainStory={leaderboard:[],player_rank:null}):(e.leaderboardData.mainStory=t[0],cc.sys.isNative?(cc.log("[LeaderBoard] Main story loaded - entries:",t[0].leaderboard?t[0].leaderboard.length:0),cc.log("[LeaderBoard] Main story structure - has leaderboard:",!!t[0].leaderboard,"has player_rank:",!!t[0].player_rank,"has total_players:",!!t[0].total_players)):cc.log("[LeaderBoard] Main story loaded")):(console.warn("[LeaderBoard] No main story data in results"),e.leaderboardData.mainStory={leaderboard:[],player_rank:null}),t&&t[1]?t[1].error?(console.error("[LeaderBoard] Bullet fly error:",t[1].error),e.leaderboardData.bulletFly={leaderboard:[],player_rank:null,error:t[1].error}):(e.leaderboardData.bulletFly=t[1],cc.sys.isNative?cc.log("[LeaderBoard] Bullet fly loaded - entries:",t[1].leaderboard?t[1].leaderboard.length:0):cc.log("[LeaderBoard] Bullet fly loaded")):(console.warn("[LeaderBoard] No bullet fly data in results"),e.leaderboardData.bulletFly={leaderboard:[],player_rank:null}),t&&t[2]?t[2].error?(console.error("[LeaderBoard] Shoot target error:",t[2].error),e.leaderboardData.shootTarget={leaderboard:[],player_rank:null,error:t[2].error}):(e.leaderboardData.shootTarget=t[2],cc.sys.isNative?cc.log("[LeaderBoard] Shoot target loaded - entries:",t[2].leaderboard?t[2].leaderboard.length:0):cc.log("[LeaderBoard] Shoot target loaded")):(console.warn("[LeaderBoard] No shoot target data in results"),e.leaderboardData.shootTarget={leaderboard:[],player_rank:null}),t&&t[3]?t[3].error?(console.error("[LeaderBoard] Make choice error:",t[3].error),e.leaderboardData.makeChoice={leaderboard:[],player_rank:null,error:t[3].error}):(e.leaderboardData.makeChoice=t[3],cc.sys.isNative?cc.log("[LeaderBoard] Make choice loaded - entries:",t[3].leaderboard?t[3].leaderboard.length:0):cc.log("[LeaderBoard] Make choice loaded")):(console.warn("[LeaderBoard] No make choice data in results"),e.leaderboardData.makeChoice={leaderboard:[],player_rank:null}),e.updateLeaderboardDisplay()}).catch(function(t){e.isLoading=!1,e.showLoading(!1);var i=t?t.message||t.toString():"Unknown error";console.error("[LeaderBoard] Failed to fetch leaderboards:",i),e.showError("Failed to load leaderboards")})}},fetchMainStoryLeaderboard:function(){var e=this;this.isLoading||(this.isLoading=!0,this.showLoading(!0),this.makeRequest("/main-story","GET",{limit:100},function(t,i){e.isLoading=!1,e.showLoading(!1),i?e.showError("Failed to load main story leaderboard: "+i):(cc.log("fetchMainStoryLeaderboard",t),t&&(e.leaderboardData.mainStory=t,e.updateLeaderboardDisplay()))}))},fetchMinigameLeaderboard:function(e){var t=this;if(!this.isLoading){var i=Date.now(),a=this.lastRequestTime[e]||0;if(i-a<this.minRequestInterval)cc.log("[LeaderBoard] Rate limit: Too soon to request",e,"again. Wait",this.minRequestInterval-(i-a),"ms");else{this.lastRequestTime[e]=i,this.isLoading=!0,this.showLoading(!0);var n="/minigames/"+e;this.makeRequest(n,"GET",{limit:100},function(i,a){if(t.isLoading=!1,t.showLoading(!1),a)t.showError("Failed to load "+e+" leaderboard: "+a);else if(cc.log("fetchMinigameLeaderboard",i),i){switch(e){case"bullet-fly":t.leaderboardData.bulletFly=i;break;case"shoot-target":t.leaderboardData.shootTarget=i;break;case"make-choice":t.leaderboardData.makeChoice=i}t.updateLeaderboardDisplay()}else{console.warn("[LeaderBoard] Received null data for",e,"- showing empty leaderboard");var n={leaderboard:[],player_rank:null,total_players:0,game_type:e};switch(e){case"bullet-fly":t.leaderboardData.bulletFly=n;break;case"shoot-target":t.leaderboardData.shootTarget=n;break;case"make-choice":t.leaderboardData.makeChoice=n}t.updateLeaderboardDisplay()}})}}},checkAndUpdateRewardNotification:function(){var e=this;if(cc.log("[LeaderBoard] checkAndUpdateRewardNotification called"),!window.net||!window.net.token)return cc.log("[LeaderBoard] net.token not ready, delaying reward notification check"),void setTimeout(function(){e.checkAndUpdateRewardNotification()},500);var t=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid");if(t){var a="main_story";switch(this.currentTab){case"bulletFly":a="bullet_fly";break;case"shootTarget":a="shoot_target";break;case"makeChoice":a="make_choice";break;case"mainStory":case"all":default:a="main_story"}var o={player_id:t,category:a};cc.log("[LeaderBoard] Checking unclaimed rewards for category:",a),i.get(n.weeklyRewards.checkUnclaimed,o,function(t,i){if(t)console.error("[LeaderBoard] Error checking unclaimed rewards:",t);else{cc.log("[LeaderBoard] Unclaimed check response:",i);var a=i&&!0===i.has_unclaimed;if(cc.log("[LeaderBoard] Has unclaimed rewards:",a),e.rewardButton&&e.rewardButton.node){var n=e.rewardButton.node.getChildByName("rp");n&&(n.active=a,a!=e.haveReward&&(e.haveReward=a,cc.game.emit("hasUnclaimed",{status:e.haveReward})),cc.log("[LeaderBoard] Notification node active:",a))}}})}else cc.log("[LeaderBoard] Player ID not available for reward check")},switchTab:function(e){if(this.currentTab=e,cc.log("switchTab",e),this.rewardButton.node.active="mainStory"!=this.currentTab,"mainStory"!=this.currentTab&&this.checkAndUpdateRewardNotification(),this.countdownEndTime&&Date.now()>=this.countdownEndTime)switch(cc.log("[LeaderBoard] Past reset time, clearing cache for tab:",e),e){case"all":this.leaderboardData.all=null;break;case"mainStory":this.leaderboardData.mainStory=null;break;case"bulletFly":this.leaderboardData.bulletFly=null;break;case"shootTarget":this.leaderboardData.shootTarget=null;break;case"makeChoice":this.leaderboardData.makeChoice=null}switch(e){case"all":this.leaderboardData.all?this.updateLeaderboardDisplay():this.fetchAllLeaderboards();break;case"mainStory":this.leaderboardData.mainStory?this.updateLeaderboardDisplay():this.fetchMainStoryLeaderboard();break;case"bulletFly":this.leaderboardData.bulletFly?this.updateLeaderboardDisplay():this.fetchMinigameLeaderboard("bullet-fly");break;case"shootTarget":this.leaderboardData.shootTarget?this.updateLeaderboardDisplay():this.fetchMinigameLeaderboard("shoot-target");break;case"makeChoice":this.leaderboardData.makeChoice?this.updateLeaderboardDisplay():this.fetchMinigameLeaderboard("make-choice")}},updateLeaderboardDisplay:function(){if(this.content){this.content.removeAllChildren();var e=null,t=[],i=null;switch(this.currentTab){case"all":(e=this.leaderboardData.all)&&(e.main_story&&e.main_story.leaderboard&&(t=e.main_story.leaderboard.slice(0,20)),e.main_story&&e.main_story.player_rank&&(i=e.main_story.player_rank));break;case"mainStory":(e=this.leaderboardData.mainStory)&&(t=e.leaderboard||[],i=e.player_rank);break;case"bulletFly":(e=this.leaderboardData.bulletFly)&&(t=e.leaderboard||[],i=e.player_rank);break;case"shootTarget":(e=this.leaderboardData.shootTarget)&&(t=e.leaderboard||[],i=e.player_rank);break;case"makeChoice":(e=this.leaderboardData.makeChoice)&&(t=e.leaderboard||[],i=e.player_rank)}cc.sys.isNative?(cc.log("updateLeaderboardDisplay - data exists:",!!e,"playerRank:",i),e&&t&&cc.log("updateLeaderboardDisplay - leaderboard count:",t.length)):cc.log("updateLeaderboardDisplay",e,i),cc.sys.isNative&&e&&cc.log("updateLeaderboardDisplay - has data for tab:",this.currentTab),this.updateTopPlayers(t);for(var a=0;a<t.length;a++){var n=this.createLeaderboardItem(t[a],a+1);n&&this.content.addChild(n)}this.updateMyRank(i)}},updateTopPlayers:function(e){try{if(this.listTopPlayer){for(var t=0;t<this.listTopPlayer.length;t++){var i=this.listTopPlayer[t];if(i){i.active=!0;var a=i.getChildByName("txt_player");if(a){var n=a.getComponent(cc.Label);n&&(n.string="...")}var o=i.getChildByName("stick");if(o&&this.listIconTopPlayer&&this.listIconTopPlayer[t]){var r=o.getComponent(cc.Sprite);r&&(r.spriteFrame=this.listIconTopPlayer[t])}}}if(e&&e.length>0){var s=Math.min(3,e.length,this.listTopPlayer.length);for(cc.log("[LeaderBoard] Updating top "+s+" players"),t=0;t<s;t++){var c=this.listTopPlayer[t],l=e[t];c&&l?(c.active=!0,this.setupTopPlayerDisplay(c,l,t+1)):console.warn("[LeaderBoard] Missing node or data for top player index "+t)}}}}catch(d){console.error("[LeaderBoard] Error updating top players:",d),window.FirebaseTracking&&window.FirebaseTracking.trackingCustomLog&&window.FirebaseTracking.trackingCustomLog("leaderboard_top_players_error",{error:d.toString(),stack:d.stack})}},setupTopPlayerDisplay:function(e,t,i){if(e&&t){var a=e.getChildByName("txt_player");if(a){var n=a.getComponent(cc.Label);n&&(n.string=t.displayName||"---")}var o=e.getChildByName("stick");if(o&&this.listIconTopPlayer&&this.listIconTopPlayer[i-1]){var r=o.getComponent(cc.Sprite);r&&(r.spriteFrame=this.listIconTopPlayer[i-1])}}},createLeaderboardItem:function(e,t){if(!this.itemRanker)return null;var i=cc.instantiate(this.itemRanker),a=i.getComponent("ItemRanker");if(a&&a.init(e,t),t<=3){var n=i.getChildByName("trophy");if(n&&(n.active=!0,n.getComponent(cc.Sprite))){var o=1===t?cc.Color.YELLOW:2===t?cc.Color.WHITE:new cc.Color(205,127,50);n.color=o}}return i},updateMyRank:function(e){var t;this.currentPlayerRankData=e,(t=this.contentBottom.getChildByName("ItemMainPlayerRanker")).setSiblingIndex(0),t.active=!0;var i=t.getComponent("ItemMainPlayerRank");i&&i.init(e),cc.sys.isNative?(cc.log("[updateMyRank] rankData exists:",!!e),e&&cc.log("[updateMyRank] rank:",e.rank,"username:",e.username)):cc.log("[updateMyRank]",e),this.checkPlayerItemVisibility(e)},checkPlayerItemVisibility:function(){},isItemVisibleInScrollView:function(e){if(!e||!this.scrollView||!this.content)return!1;var t=this.scrollView.node,i=t.getChildByName("view")||t.getChildByName("mask");i||(i=t);var a=this.getWorldBoundingBox(e),n=this.getWorldBoundingBox(i),o=this.boundingBoxesIntersect(a,n);return o&&!1===e.activeInHierarchy&&(o=!1),o},getWorldBoundingBox:function(e){if(!e)return null;var t=e.parent?e.parent.convertToWorldSpaceAR(e.position):e.position,i=e.width*e.scaleX,a=e.height*e.scaleY,n=i*(.5-e.anchorX),o=a*(.5-e.anchorY);return{xMin:t.x-i/2+n,xMax:t.x+i/2+n,yMin:t.y-a/2+o,yMax:t.y+a/2+o,width:i,height:a,center:t}},boundingBoxesIntersect:function(e,t){if(!e||!t)return!1;var i=e.xMin<t.xMax&&e.xMax>t.xMin,a=e.yMin<t.yMax&&e.yMax>t.yMin;return i&&a},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},showLoading:function(e){if(e){if(this.loadingCount++,cc.log("[LeaderBoard] showLoading: true, loadingCount:",this.loadingCount),1===this.loadingCount){if(window.menuManager&&menuManager.loadingPrefab&&!this.loadingNode){var t=cc.Canvas.instance.node;this.loadingNode=cc.instantiate(menuManager.loadingPrefab),t.addChild(this.loadingNode,2e3),cc.log("[LeaderBoard] Loading overlay created and added to canvas")}else menuManager.loadingPrefab||cc.log("[LeaderBoard] menuManager.loadingPrefab not available, using fallback");this.loadingLabel&&(this.loadingLabel.node.active=!0,this.loadingLabel.string="Loading...")}}else this.loadingCount--,cc.log("[LeaderBoard] showLoading: false, loadingCount:",this.loadingCount),this.loadingCount<=0&&(this.loadingCount=0,this.loadingNode&&(this.loadingNode.destroy(),this.loadingNode=null,cc.log("[LeaderBoard] Loading overlay destroyed")),this.loadingLabel&&(this.loadingLabel.node.active=!1));this.errorLabel&&(this.errorLabel.node.active=!1)},showError:function(e){this.errorLabel&&(this.errorLabel.node.active=!0,this.errorLabel.string=e),this.loadingLabel&&(this.loadingLabel.node.active=!1)},onRefreshClick:function(){switch(this.currentTab){case"all":this.fetchAllLeaderboards();break;case"mainStory":this.fetchMainStoryLeaderboard();break;case"bulletFly":this.fetchMinigameLeaderboard("bullet-fly");break;case"shootTarget":this.fetchMinigameLeaderboard("shoot-target");break;case"makeChoice":this.fetchMinigameLeaderboard("make-choice")}},_updateLeaderboardScore:function(t,i){var a=this,n=window.net||e("../../utils/network/net");if(!n||!n.token)return cc.warn("No authentication token available"),void(i&&i(!1,"No authentication token"));this.makeRequest(t.endpoint,"PUT",t.data,function(e,n){n?(cc.error(t.errorMessage+":",n),i&&i(!1,n)):(cc.log(t.successMessage+":",e),e&&void 0!==e.rank&&a.leaderboardData[t.cacheKey]&&(a.leaderboardData[t.cacheKey].player_rank=e),i&&i(!0,e),a.currentTab===t.tabName&&t.refreshMethod&&t.refreshMethod.call(a))})},updateMainStoryProgress:function(e,t,i){this._updateLeaderboardScore({endpoint:"/main-story",data:{chapter:parseInt(e)||0,stage:parseInt(t)||0},cacheKey:"mainStory",tabName:"mainStory",errorMessage:"Failed to update main story progress",successMessage:"Main story progress updated",refreshMethod:this.fetchMainStoryLeaderboard},i)},updateBulletFlyScore:function(e,t,i,a){this._updateLeaderboardScore({endpoint:"/minigames/bullet-fly",data:{highest_stage:parseInt(e)||0,maintain_time:parseInt(t)||0,total_score:parseInt(i)||0},cacheKey:"bulletFly",tabName:"bulletFly",errorMessage:"Failed to update Bullet Fly score",successMessage:"Bullet Fly score updated",refreshMethod:function(){this.fetchMinigameLeaderboard("bullet-fly")}},a)},updateShootTargetScore:function(e,t,i,a,n){this._updateLeaderboardScore({endpoint:"/minigames/shoot-target",data:{highest_stage:parseInt(e)||0,maintain_time:parseInt(t)||0,total_score:parseInt(i)||0,accuracy:parseFloat(a)||0},cacheKey:"shootTarget",tabName:"shootTarget",errorMessage:"Failed to update Shoot Target score",successMessage:"Shoot Target score updated",refreshMethod:function(){this.fetchMinigameLeaderboard("shoot-target")}},n)},updateMakeChoiceScore:function(e,t,i,a,n){this._updateLeaderboardScore({endpoint:"/minigames/make-choice",data:{highest_stage:parseInt(e)||0,maintain_time:parseInt(t)||0,total_score:parseInt(i)||0,correct_choices:parseInt(a)||0},cacheKey:"makeChoice",tabName:"makeChoice",errorMessage:"Failed to update Make Choice score",successMessage:"Make Choice score updated",refreshMethod:function(){this.fetchMinigameLeaderboard("make-choice")}},n)},statics:{updateProgress:function(e,t,a){if("undefined"!=typeof window&&!1===window.activeLeaderBoard)return cc.log("[LeaderBoardPopup] Leaderboard disabled (activeLeaderBoard = false), skipping update for type:",e),void(a&&a(!0,{success:!0,message:"Leaderboard disabled - data not sent to server",rank:0}));if(!i.getToken())return cc.warn("No authentication token for leaderboard update"),void(a&&a(!1,"No authentication token"));var o=n.getLeaderboardEndpoint(e,"update");if(!o)return cc.error("Unknown leaderboard type:",e),void(a&&a(!1,"Unknown leaderboard type"));var r={};switch(e){case"mainStory":case"main-story":r={chapter:t.chapter||0,stage:t.stage||0};break;case"bulletFly":case"bullet-fly":case"ballMode":r={highest_stage:t.highest_stage||0,maintain_time:t.maintain_time||0,total_score:t.total_score||0};break;case"shootTarget":case"shoot-target":case"gunnerMode":r={highest_stage:t.highest_stage||0,maintain_time:t.maintain_time||0,total_score:t.total_score||0,accuracy:t.accuracy||0};break;case"makeChoice":case"make-choice":r={highest_stage:t.highest_stage||0,maintain_time:t.maintain_time||0,total_score:t.total_score||0,correct_choices:t.correct_choices||0};break;default:return}cc.log("[LeaderBoardPopup] Sending leaderboard update for type:",e,"data:",r),i.put(o,r,function(e,t){e?(cc.error("[Leaderboard] Update failed:",e),a&&a(!1,e)):(cc.log("[Leaderboard] Update successful:",t),t&&void 0!==t.rank?(cc.log("[Leaderboard] Success! Player rank:",t.rank),a&&a(!0,t)):t&&t.data?(cc.log("[Leaderboard] Success! Player rank:",t.data.rank),a&&a(!0,t.data)):(cc.log("[Leaderboard] Update appears successful"),a&&a(!0,t)))})}},fetchLeaderboardTimer:function(){var e=this;a.get(n.leaderboard.timer,{},{timeout:5e3,retries:1}).then(function(t){if(t&&t.timer){e.leaderboardTimer=t.timer;var i=0;t.timer.totalMilliseconds&&(i=Date.now()+t.timer.totalMilliseconds),(!e.countdownEndTime||Math.abs(i-e.countdownEndTime)>5e3)&&(e.countdownEndTime=i,e.localCountdownInterval||e.startLocalCountdown()),t.timer.status&&t.timer.status.isInFreeTime&&cc.log("[LeaderBoard] Currently in free time period:",t.timer.status.freeTimeMessage),cc.log("[LeaderBoard] Timer fetched:",t.timer)}else console.warn("[LeaderBoard] No timer data in response")}).catch(function(t){console.error("[LeaderBoard] Failed to fetch timer:",t),e.localCountdownInterval||e.startLocalCountdown()})},startTimerUpdates:function(){this.stopTimerUpdates();var e=this,t=3e4;this.leaderboardTimer&&this.leaderboardTimer.totalMilliseconds&&(this.leaderboardTimer.totalMilliseconds<12e4?(t=5e3,cc.log("[LeaderBoard] Timer near expiry, updating every 5 seconds")):this.leaderboardTimer.totalMilliseconds<6e5&&(t=1e4,cc.log("[LeaderBoard] Timer < 10 minutes, updating every 10 seconds"))),this.timerUpdateInterval=setInterval(function(){e.updateCountdown()},t)},stopTimerUpdates:function(){this.timerUpdateInterval&&(clearInterval(this.timerUpdateInterval),this.timerUpdateInterval=null)},startLocalCountdown:function(){var e=this;this.stopLocalCountdown(),this.leaderboardTimer&&this.leaderboardTimer.totalMilliseconds&&(this.countdownEndTime=Date.now()+this.leaderboardTimer.totalMilliseconds),this.updateLocalCountdown(),this.localCountdownInterval=setInterval(function(){e.updateLocalCountdown()},1e3)},stopLocalCountdown:function(){this.localCountdownInterval&&(clearInterval(this.localCountdownInterval),this.localCountdownInterval=null)},updateLocalCountdown:function(){if(this.TimeCoundownLabel)if(this.countdownEndTime){var e=Date.now(),t=this.countdownEndTime-e;if(t<=0){if(this.TimeCoundownLabel.string="Resetting...",this.stopLocalCountdown(),!this.isRefreshing){this.isRefreshing=!0;var i=this;cc.log("[LeaderBoard] Timer reached 00:00, triggering full refresh"),this.leaderboardData={all:null,mainStory:null,bulletFly:null,shootTarget:null,makeChoice:null},setTimeout(function(){switch(cc.log("[LeaderBoard] Refreshing all data after reset"),i.leaderboardData={all:null,mainStory:null,bulletFly:null,shootTarget:null,makeChoice:null},i.currentTab){case"all":i.fetchAllLeaderboards();break;case"mainStory":i.fetchMainStoryLeaderboard();break;case"bulletFly":i.fetchMinigameLeaderboard("bullet-fly");break;case"shootTarget":i.fetchMinigameLeaderboard("shoot-target");break;case"makeChoice":i.fetchMinigameLeaderboard("make-choice")}i.fetchLeaderboardTimer(),i.isRefreshing=!1,i.startTimerUpdates()},2e3)}}else{var a=Math.floor(t/1e3),n="";if(this.leaderboardTimer&&this.leaderboardTimer.config&&("minutes"===this.leaderboardTimer.config.mode||this.leaderboardTimer.config.intervalMinutes)){var o=Math.floor(a/60),r=a%60;if(isNaN(o)||isNaN(r))return console.warn("[LeaderBoard] Invalid timer calculation:",t,a),void(this.TimeCoundownLabel.string="Loading...");n=o.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")}else{var s=Math.floor(a/86400),c=Math.floor(a%86400/3600);if(isNaN(s)||isNaN(c))return console.warn("[LeaderBoard] Invalid timer calculation:",t,a),void(this.TimeCoundownLabel.string="Loading...");n=s.toString().padStart(2,"0")+"d: "+c.toString().padStart(2,"0")+"h"}cc.log(n),this.TimeCoundownLabel.string=n}}else this.TimeCoundownLabel.string="Loading..."},updateCountdown:function(){var e=this;this.leaderboardTimer&&(this.leaderboardTimer.totalMilliseconds<=3e4||this.leaderboardTimer.totalSeconds<=30)?(cc.log("[LeaderBoard] Timer expired or near expiry, clearing cache and refreshing all data"),this.leaderboardData={all:null,mainStory:null,bulletFly:null,shootTarget:null,makeChoice:null},window.ApiClient&&window.ApiClient.clearCache&&window.ApiClient.clearCache("leaderboard"),setTimeout(function(){e.fetchAllLeaderboards(),e.fetchLeaderboardTimer(),window.weeklyRewardPopup&&window.weeklyRewardPopup.loadCurrentRewardWeekData()},2e3)):this.fetchLeaderboardTimer()},updateTimerDisplay:function(){if(this.leaderboardTimer&&this.TimeCoundownLabel){var e=this.leaderboardTimer,t="";if(e.status&&e.status.isInFreeTime)t=e.status.timeUntilActive?"Resetting: "+e.status.timeUntilActive.formatted:e.status.freeTimeMessage||"Resetting...";else if(e.countdown){var i=e.countdown.days,a=e.countdown.hours,n=e.countdown.minutes,o=e.countdown.seconds||0;t=i>0?i.toString().padStart(2,"0")+"d: "+a.toString().padStart(2,"0")+"h":a>0?a.toString().padStart(2,"0")+"h: "+n.toString().padStart(2,"0")+"m":n>0?n.toString().padStart(2,"0")+"m: "+o.toString().padStart(2,"0")+"s":o+"s"}else t="Loading...";this.TimeCoundownLabel.string=t}}}),cc._RF.pop()},{"../../utils/network/ApiClient":"ApiClient","../../utils/network/ApiClientPromise":"ApiClientPromise","../../utils/network/ApiEndpoints":"ApiEndpoints","../../utils/network/net":"net","../core/Menu":"Menu"}],LeechBuff:[function(e,t){"use strict";cc._RF.push(t,"7e791JsknJC06zdPm+mcvbs","LeechBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.obj;this.game.eventMgr.regist(e,"hitEvent",this,this.hitEvent)},hitEvent:function(e,t,i){var a=this.define;this.game.c_rnd(0,1)<a.chance&&this.obj.onHeal(this,i*a.rate)},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"hitEvent",this)}}),cc._RF.pop()},{"./Buff":"Buff"}],LevelManager:[function(e,t){"use strict";cc._RF.push(t,"6c525O12QhB04UpjwBWOQCT","LevelManager");var i=function(e,t){return ENTITY_VALUE[e.valueType].get(t)==e.value},a=function(e,t){return ENTITY_VALUE[e.valueType].get(t)>e.value},n=function(e,t){return ENTITY_VALUE[e.valueType].get(t)<e.value},o=function(e,t){return!t.isDead()},r=function(e,t){return t.x<e.left||t.x>e.right||t.y<e.bottom||t.y>e.top},s=function(e,t){return t.x>e.left&&t.x<e.right&&t.y>e.bottom&&t.y<e.top},c=function(e){return e.in<e.ct},l=function(e){return e.in==e.ct},d=function(e){return e.in>e.ct},h=function(e){this.runCreateObject(e.cfgData)},u=function(e){this.game.core.c_random()<e.v.r?this.onTrigger(e):e.n>1&&(e.n--,this.listenRandom(e))},p=e("../core/base/Entity"),f=e("../components/visual/Avatar"),m=e("../components/visual/ArmatureAvatar"),g=e("../entities/items/Drop"),v=cc.Class({initMap:function(e,t){this.define={name:"\u5173\u5361\u7ba1\u7406\u5668"},this.game=e,this.uniqueID=0,this.entityMap={},this.entityList=[],this.heroes={},this.teamTable=[],this.teamObjs=[],this.continue(t,!0);var i=e.config.drops;i?(this.dropList=i,this.dropNum=i.length,this.dropIndex=0,this.dropCt=0,this.computeNextDropIndex()):this.dropNum=0;var a=e.config.exp;this.expDrop=a&&this.dropExpCount&&a/this.dropExpCount||0,this.expGot=0,this.totalExp=a,cc.log("LevelManager expDrop per unit",a,this.expDrop,this.dropExpCount),this.initDamageStat(),cc.log("\u672c\u5173\u5173\u5361\u7cfb\u6570:",e.remotes.lvl,e.remotes.lvl2)},initDamageStat:function(){this.damageStat={}},calculateDamageStat:function(e,t,i){if(0!=e.team){var a=t.getOwner().define.id;this.damageStat[a]=this.damageStat[a]||0,this.damageStat[a]+=i}},computeNextDropIndex:function(){var e=Math.floor(this.dropMaxCount/this.dropNum);this.dropNextCt=this.dropIndex*e+kit.rndInt(1,e)},continue:function(e){this.ended=!1;var t=e.config||{};for(var i in this.noSkills=t.noSkills,this.gameTimer=t.time,this.distance=t.distance,this.appearMsgFlag=!t.inMsg,this.hpScale=t.hpScale,this.entityDataTable={},this.timers=[],this.funcs=[],this.odometer=[],this.odometerNeedUpdate=!1,this.eventMap={},this.msgTable={},this.listenTable={},DEED_TYPE){var a=DEED_TYPE[i];this.listenTable[a]={},this.listenTable[a][INDEX_TYPE.INDEX]={},this.listenTable[a][INDEX_TYPE.ID]={},this.listenTable[a][INDEX_TYPE.TEAM]={},this.listenTable[a][INDEX_TYPE.ME]={},this.listenTable[a][INDEX_TYPE.ALL]={}}this.createGroupList=[];var n={},o=e.entity;for(var r in this.dropMaxCount=0,this.dropExpCount=0,o){var s=o[r];if(s.me)this.runCreateObject(s);else{var c,l=ENTITY[s.i];l&&!l.noDrop&&this.dropMaxCount++,c=null!=l.exp?l.exp:1;var d=s.n||1;if(this.dropExpCount+=c*d,(0===s.t||s.t>0)&&l){var h=l.radius||30,u=(s.xx||0)+s.x-h;if(s.g&&n[s.g]){var p=n[s.g];p.list.push(s),p.x=Math.min(p.x,u)}else{var f={x:u,list:[s]};this.createGroupList.push(f),n[s.g]=f}}}var m=s.id;m&&(this.entityDataTable[m]=this.entityDataTable[m]||[]).push({cfgData:s})}this.createGroupList.sort(function(e,t){return t.x-e.x});var g=this.heroes[1];if(g){if(g.x=-650,DEV_MODE&&DEBUG_INVICIBLE)for(var v in g.undead=1,g.towers)g.towers[v].undead=1;g.setFlag(NO_ATTACK,!0),g.setInvincible(!0),this.moveSpd=g.moveSpd}this.game.layer.hideJoystickBtn(!1),this.appearDistance=+(t.inDis||0),this.appearDelay=+t.inDelay,this.moveSpdScale=+(t.spd||1),this.initCamera();var y=[],b=e.event;for(var i in b){var k=b[i];this.createTrigger(k,y)}for(var i in y)this.runTrigger(y[i])},getEventObjectCount:function(e){var t=0,i=e.event;for(var a in i){var n=i[a];if(!n.off){var o,r,s=n.act;for(var c in cc.log("checkEventObjectCount",s,ACT.CHOSE),s){var l=s[c];if(l.type!=ACT.CHOSE){if(c<=+o+r)l.addTeam=!0;else if(1==s[c].type){var d=s[c].i,h=this.entityDataTable[d];for(var u in h){var p=h[u].cfgData;if(1==p.team){var f=0;-1!=n.repeat?(f=p.n||1,f*=n.repeat||1,l.addTeam=null):l.addTeam=!0,f&&(t+=f)}}}}else o=c,r=l.n}}}cc.log("\u8ba1\u7b97\u4e8b\u4ef6\u540e\u751f\u6210\u5355\u4f4d\u6570:",t)},createTrigger:function(e,t){var i={id:e.id,off:e.off,repeat:e.repeat,cond:[],act:[]},a=e.cond;for(var n in a){var o=a[n];i.cond.push({event:i,v:o})}var r=e.act;for(var n in r){var s=r[n];i.act.push({event:i,v:s})}var c=i.id;c&&(this.eventMap[c]=this.eventMap[c]||[]).push(i),t.push(i)},runTrigger:function(e){if(!e.off&&!e.listened){var t=e.cond;if(t&&0!=t.length)for(var i in e.listened=!0,t){var a=t[i];if(void 0===a.active){a.active=0;var n=a.v.type;n==COND.TIMER?this.listenTimer(a):n==COND.DISTANCE?this.listenOdometer(a):n==COND.DEED?this.listenEvent(a,a.v.d||DEED_TYPE.DEATH,a.v.t||0,a.v.i):n==COND.POS?this.listenPos(a):n==COND.STATUS?this.listenStatus(a):n==COND.MSG?this.listenMsg(a):n==COND.RANDOM&&(a.v.n<0?a.n=1/0:a.n=a.v.n||1,this.listenRandom(a),this.game.editMode||a.v.q)&&(a.str="\u63b7\u9ab0\u5b50 - ",this.game.editMode&&a.event.id&&(a.str="["+a.event.id+"]"+a.str),this.game.layer.callQuest(a,function(){var e=this.cond;return e.active?e.str+"\u6210\u529f":e.str+(e.timer?Math.round(10*e.timer):"\u7acb\u5373")}))}}else{if(-1==e.repeat)throw new Error("\u672a\u8bbe\u5b9a\u6761\u4ef6\u7684\u65e0\u9650\u5faa\u73af\u4e8b\u4ef6!");this.runAllActs(e)}}},listenStatus:function(e){var t=this,r=e.v;r.n?(e.valueType=r.n,e.value=r.v||0,2==r.b?e.compareFunc=i:1==r.b?e.compareFunc=a:e.compareFunc=n):e.compareFunc=o,this.listenFunc(e);var s=r.q;if(this.game.editMode||s){if(s){var c=STATUS_QUEST_STR[s]+" - ";e.str=c.replace(/\{.+?\}/g,function(e){var i=e.substr(1,e.length-2);return"t"==i?t.getNameByIndex(r.t,r.i):"v"==i?r.v:void 0})}else e.str="\u72b6\u6001\u7edf\u8ba1 - ";this.game.editMode&&e.event.id&&(e.str="["+e.event.id+"]"+e.str),this.game.layer.callQuest(e,function(){var e=this.cond;return e.str+e.in+[">","<","=="][e.v.cb||0]+e.ct})}},listenPos:function(e){var t=this,i=e.v;e.left=c_getValue(i[1],-1/0),e.right=c_getValue(i[2],1/0),e.top=c_getValue(i[3],1/0),e.bottom=c_getValue(i[4],-1/0),1==i.b?e.compareFunc=r:e.compareFunc=s,this.listenFunc(e);var a=i.q;if(this.game.editMode||a){if(a){var n=POS_QUEST_STR[a]+" - ";e.str=n.replace(/\{.+?\}/g,function(e){var a=e.substr(1,e.length-2);return"t"==a?t.getNameByIndex(i.t,i.i):"v"==a?i.v:void 0})}else e.str="\u533a\u57df\u7edf\u8ba1 - ";this.game.editMode&&e.event.id&&(e.str="["+e.event.id+"]"+e.str),this.game.layer.callQuest(e,function(){var e=this.cond;return e.str+e.in+"/"+(e.ct||1)}),this.game.layer.callArea(e)}},listenFunc:function(e){e.in=0,e.ct=e.v.c||0,1==e.v.cb?e.triggerFunc=c:2==e.v.cb?e.triggerFunc=l:e.triggerFunc=d,this.funcs.push(e)},checkFunc:function(e,t,i){t.call(this,e,i)&&e.in++},checkListFunc:function(e){var t=e.v.t,i=e.v.i,a=e.compareFunc;if(e.in=0,t==INDEX_TYPE.ME)for(var n in this.heroes)this.checkFunc(e,a,this.heroes[n]);else for(var o=this.entityList,r=(n=0,o.length);n<r;n++){var s=o[n],c=s.config;if(c){if(t==INDEX_TYPE.ALL);else if(t==INDEX_TYPE.ID){if(c.id!=i)continue}else if(t==INDEX_TYPE.TEAM){if(s.team!=i)continue}else if(c.index!=i)continue;this.checkFunc(e,a,s)}}if(e.triggerFunc(e)){if(!e.active)return this.onTrigger(e),e.event.off}else e.active&&(e.active=0)},updateFunc:function(){for(var e=this.funcs,t=0,i=e.length;t<i;t++){var a=e[t];this.checkListFunc(a)&&(e.splice(t,1),t-=1,i-=1)}},listenOdometer:function(e){var t=e.v;e.distance=t.d||0,e.distanceFunc=this.onTrigger,this.odometer.push(e),this.odometerNeedUpdate=!0},listenTimer:function(e){var t=e.v;e.timer=t.t||0,e.timerFunc=this.onTrigger,this.timers.push(e);var i=t.q;if(this.game.editMode||i){if(i){var a=TIMER_QUEST_STR[i]+" - ";e.str=a.replace(/\{.+?\}/g,function(e){if("v"==e.substr(1,e.length-2))return t.t})}else e.str="\u8ba1\u65f6 - ";this.game.editMode&&e.event.id&&(e.str="["+e.event.id+"]"+e.str),this.game.layer.callQuest(e,function(){var e=this.cond,t=e.timer;return t>0?t*=10:t=0,e.str+Math.round(t)/10})}},updateTimer:function(e,t){for(var i=0,a=e.length;i<a;i++){var n=e[i];n.timer-=t,n.timer<=0&&(n.timerFunc.call(this,n),e.splice(i,1),i-=1,a-=1)}},listenRandom:function(e){var t=e.v.t||0;t<=0?u.call(this,e):(e.timer=t,e.timerFunc=u,this.timers.push(e))},listenMsg:function(e){var t=e.v.ct;e.triggerCt=t||1;var i=e.v.n,a=this.msgTable;(a[i]=a[i]||[]).push(e),(this.game.editMode||e.v.q)&&(e.str="Receive Message - ",this.game.editMode&&e.event.id&&(e.str="["+e.event.id+"]"+e.str),this.game.layer.callQuest(e,function(){var e=this.cond,t=e.v.ct||1;return e.str+(t-e.triggerCt)+"/"+t}))},sendMsg:function(e){var t=e.v.n;if(void 0!==t){var i=e.v.s;this.send(e,this.msgTable[t],i);var a=ACT_EVENT[t];a&&(cc.log("Default Message",a,t,i),a.func.call(this,i))}},listenEvent:function(e,t,i,a){var n=this;if(i==INDEX_TYPE.ALL)a=0;else if(i==INDEX_TYPE.ME)a=0;else if(void 0===a)return;var o=e.v,r=o.ct;e.triggerCt=r||1;var s,c=this.listenTable[t][i];(c[a]=c[a]||[]).push(e);var l=o.q;if(this.game.editMode||o.q){if(l){var d=DEED_QUEST_STR[l]+" - ";e.str=d.replace(/\{.+?\}/g,function(e){var t=e.substr(1,e.length-2);return"t"==t?n.getNameByIndex(o.t,o.i):"v"==t?o.ct:void 0})}else e.str=((s=o).t==INDEX_TYPE.ME?"\u73a9\u5bb6":s.t==INDEX_TYPE.ALL?"\u4efb\u610f\u5355\u4f4d":s.t==INDEX_TYPE.TEAM?0==s.i?"\u53cb\u519b":"\u654c\u4eba":s.t==INDEX_TYPE.ID&&s.i?ENTITY[s.i].name:"\u5355\u4f4d")+"\u6b7b\u4ea1 - ";this.game.editMode&&e.event.id&&(e.str="["+e.event.id+"]"+e.str),this.game.layer.callQuest(e,function(){var e=this.cond,t=o.ct||1;return e.str+(t-e.triggerCt)+"/"+t})}},sendEvent:function(e,t,i,a){if(i==INDEX_TYPE.ALL)a=0;else if(i==INDEX_TYPE.ME)a=0;else if(void 0===a)return;this.send(e,this.listenTable[t][i][a])},onEvent:function(e,t){this.sendEvent(e,t,INDEX_TYPE.INDEX,e.config.index),this.sendEvent(e,t,INDEX_TYPE.ID,e.define.id),this.sendEvent(e,t,INDEX_TYPE.TEAM,e.team),this.sendEvent(e,t,INDEX_TYPE.ALL),e.config.me&&this.sendEvent(e,t,INDEX_TYPE.ME)},send:function(e,t){if(t)for(var i=0,a=t.length;i<a;i++){var n=t[i];n.triggerCt&&(n.triggerCt--,n.triggerCt>0)||(this.onTrigger(n,e),t.splice(i,1),i--,a--)}},onTrigger:function(e){e.active=1;var t=e.event,i=t.cond;for(var a in i)if(!i[a].active)return;for(var a in i)delete(e=i[a]).active,this.game.layer.removeQuest(e),this.game.layer.removeArea(e);t.listened=!1,this.runAllActs(t)},runAllActs:function(e){if(!e.off){e.repeat?e.repeat>0&&(e.repeat--,e.repeat<=0&&(e.off=1)):e.off=1;for(var t=e.act,i=0,a=0,n=t.length;a<n;a++){var o=t[a],r=o.v,s=r.type;if(s==ACT.DELAY)i=r.t||0;else if(s==ACT.CHOSE){var c=r.n;if(c>0){var l=this.game.c_rndInt(1,c);this.runAct0(t[a+l],i),a+=c}}else this.runAct0(o,i)}this.runTrigger(e)}},runAct0:function(e,t){t>0?(e.timer=t,e.timerFunc=this.runAct,this.timers.push(e)):this.runAct(e)},runAct:function(e){var t=e.v,i=t.type;if(i==ACT.CREATE){if(void 0===(s=t.id))return;if(void 0!==t.x&&(o=t.x||0,void 0!==t.rx)){if(!(p=this.getObjectByIndex(t.t,t.i)))return void cc.warn("relative obj not exists",t.t,t.i);o+=p.getPositionX()}if(void 0!==t.y&&(r=t.y||0,void 0!==t.ry)){if(!(p=this.getObjectByIndex(t.t,t.i)))return void cc.warn("relative obj not exists",t.t,t.i);r+=p.getPositionY()}this.runCreateObjectByIndex(s,o,r)}else if(i==ACT.AVATAR)this.runActFunc(e,this.runAvatarFunc);else if(i==ACT.REMOVE)this.runActFunc(e,this.runRemoveFunc);else if(i==ACT.STATUS)this.runActFunc(e,this.runStatusFunc);else if(i==ACT.EFFECT){var a=t.e,n=ACT_EFFECT[a];if(!n)return;if(t.t||t.i)this.runActFunc(e,this.runEffectFunc);else if(!n.avatar){var o=t.x||0,r=t.y||0;n.func.call(this,null,o,r,t.s,t.args)}}else if(i==ACT.MSG)this.sendMsg(e);else if(i==ACT.SWITCH){var s=t.e,c=t.s,l=t.r;if(void 0===s)var d=[e.event];else if(!(d=this.eventMap[s]))return;for(var h in d){var u=d[h];if(!u)return;2==c?u.off?u.off=0:u.off=1:u.off=c,this.runTrigger(u),l&&this.runAllActs(u)}}else if(i==ACT.CAMERA);else if(i==ACT.AI){var p;if(p=this.getObjectByIndex(t.t,t.i)){var f=p.pilot;f&&f.initAI(!0,t.aiCfg)}}else i==ACT.CTRL?this.runActFunc(e,this.runCtrlFunc):i==ACT.QUEST&&this.runQuest(e)},getNameByIndex:function(e,t){if(e==INDEX_TYPE.ME)return"\u73a9\u5bb6";if(e==INDEX_TYPE.TEAM)return 0==t?"\u76df\u53cb":"\u654c\u4eba";if(e==INDEX_TYPE.ALL)return"\u4efb\u4f55\u4eba";if(t&&e==INDEX_TYPE.ID)return ENTITY[t].name;if(t){var i=this.entityDataTable[t][0].cfgData.i;return ENTITY[i].name}return"??"},runQuest:function(e){var t,i=this,a=e.v;a.q&&(t=QUEST_STR[a.q-1][a.s||0].replace(/\{.+?\}/g,function(e){var t=e.substr(1,e.length-2);return"t"==t?i.getNameByIndex(a.t,a.i):"v"==t?a.n:void 0})),this.game.layer.callMainQuest(t)},runSkill:function(e,t,i){var a=e.skills[t];if(a){var n=e.pilot,o=this.getObjectByIndex(i.t2,i.i2);n.callAssistTarget(o),a.refreshCdTimer(0),e.callSkill(t,i.a)}},runCtrlFunc:function(e,t){var i=e.v,a=i.b,n=t.pilot;if(a>0&&a<4)this.runSkill(t,a-1,i);else if(9==a)n.callAssistAttack(i.a);else if(10==a){var o=i.x,r=i.y;void 0===o&&void 0===r?n.callMoveCancel():(o=c_getValue(o,t.x),r=c_getValue(r,t.y))}else t.callMove(i.d||0,1==i.a?1:0)},runEffectFunc:function(e,t){var i=e.v,a=i.e,n=ACT_EFFECT[a];if(n){var o=i.x||0,r=i.y||0;n.func.call(this,t,o,r,i.s,i.args)}},runStatusFunc:function(e,t){var i=e.v,a=i.n,n=ENTITY_VALUE[a];n&&n.set.call(this,t,i.v,i.o)},runRemoveFunc:function(e,t){e.v.k?t.remove():t.callDeath(this,0)},runAvatarFunc:function(e,t){var i=e.v,a=i.n,n=i.p,o=i.s,r=t.avatar;r&&(2==n?r.setForcedLowerAnime(a,o):1==n?r.setForcedUpperAnime(a,o):r.setForcedAnime(a,o),r.refresh(.1))},runActFunc:function(e,t){var i=e.v.t,a=e.v.i;if(i!=INDEX_TYPE.ME){if(void 0!==a||i==INDEX_TYPE.ALL){var n=this.entityList;for(s=0;s<n.length;s++){var o=n[s],r=o.config;if(r){if(i==INDEX_TYPE.ALL);else if(i==INDEX_TYPE.ID){if(r.id!=a)continue}else if(i==INDEX_TYPE.TEAM){if(o.team!=a)continue}else if(r.index!=a)continue;t.call(this,e,o)}}}}else for(var s in this.heroes)t.call(this,e,this.heroes[s])},dropMoneyPack:function(e,t,i,a){void 0===i&&(i=1),void 0===a&&(a=0);for(var n=0;n<i;n++)this.dropMoney(e,t,1);for(var o=0;o<a;o++)this.dropMoney(e,t,5)},dropCombatItem:function(e){var t=this.game;if(!t.finished){var i,a={x:e.x,y:e.y,dropped:!0},n=kit.rndOne(COMBAT_ITEM_LIST);i={name:"\u9053\u5177",height:30,delay:1,avatar:{s:.8,ctor:f,frm:n.icon},onPick:function(e){chapter.data.combatItem[n.id]+=1;var i=e.avatar.node.convertToWorldSpaceAR(cc.v2(0,0));i=t.layer.camera.getWorldToScreenPoint(i),cc.game.emit("add_item",{pos:i,id:n.id})}};var o=new g;this.addEntity(o),o.init(t,i,a)}},dropMoney:function(e,t,i){void 0===i&&(i=1);var a=this.game;if(!a.finished){var n,o={x:e.x,y:e.y,dropped:!0};n={name:t,height:15+3*i,delay:2,avatar:{s:.5+.1*i,ctor:f,frm:t===GOLD?"item/gold":"item/exp"},onPick:function(e){chapter.add(t,i,"drop");var n=e.avatar.node.convertToWorldSpaceAR(cc.v2(0,0));n=a.layer.camera.getWorldToScreenPoint(n),cc.game.emit("add_drop",{pos:n,i:t,n:i,tid:"drop"})}};var r=new g;this.addEntity(r),r.init(a,n,o)}},dropBox:function(e){if(Math.random()>.3){var t=this.game.config.boxDropFunc;if(t){var i=t();if(i)return this.dropItem(e,i.id,i.lvl),void cc.log("dropBox",i.id,i.lvl)}}this.dropMoneyPack(e,GOLD,5,5)},tryGetExp:function(e){if(this.expDrop&&this.expGot<this.totalExp){var t=this.expDrop*(e.define.exp||1);chapter.addExp(t),this.expGot+=t,this.checkLvlUp=!0}},tryDrop:function(e){if(this.dropNum&&(this.dropCt++,this.dropCt>=this.dropNextCt&&this.dropIndex<this.dropNum)){var t=this.dropList.length;if(t>0){var i=kit.rndInt(0,t-1),a=this.dropList.splice(i,1)[0];cc.log("tryDrop",this.dropList),this.dropItem(e,a.id,a.lvl)}this.dropIndex++,this.computeNextDropIndex()}},dropItem:function(e,t,i){var a=this.game;if(!a.finished){var n,o={x:e.x,y:e.y,dropped:!0};cc.log("dropItem",t),n=ItemDefine[t],i=i||n.lvl,n.avatar.ctor=n.avatar.anime&&m||f,n.avatar.anime?n.avatar.s=.6:n.avatar.ay=.01,n.avatar.frm=n.avatar.sprite,n.onPick=function(e){var n,o=ItemDefine[t]&&ItemDefine[t].type,r=0;if(chapter.data.bag)for(var s in chapter.data.bag){var c=chapter.data.bag[s].id;ItemDefine[c].type==o&&r++}if(n="material"==o?20:12,!(chapter.data.bag&&r<n)){var l=a.effectMgr.createSprite(0,0,"effect/text/\u80cc\u5305\u5df2\u6ee1");return a.layer.addToUI(l),l.runAction(cc.sequence(cc.blink(.5,3),cc.delayTime(1),cc.destroySelf())),!0}chapter.data.bag.push({id:t,lvl:i}),(o=ItemDefine[t]&&ItemDefine[t].type)&&chapter.data.reddot[o]++;var d=e.avatar.node.convertToWorldSpaceAR(cc.v2(0,0));d=a.layer.camera.getWorldToScreenPoint(d),a.layer.bottomUI.addBagItem(t,i,d)};var r=new g;this.addEntity(r),r.init(a,n,o)}},runCreateObjectByIndex:function(e,t,i){var a=this.entityDataTable[e];if(a)for(var n in a){var o=a[n];if(!o)return;this.runCreateObject(o.cfgData,t,i)}},runCreateObject:function(e,t,i,a){var n=this.game,o=v.getConfig(n.remotes,e,a);if(o){var r=o.id;if(!r)return void cc.warn("runCreateObject no id!",o);var s,c=ENTITY[r];if(!c)return void cc.warn("runCreateObject "+r+" not defined!");if(t=c_getValue(t,o.x),i=c_getValue(i,o.y),e.dx){var l=this.game;t=l.levelMgr.heroes[l.me].getPositionX()+e.dx,cc.log("runCreate dx",t)}var d=e.n||1;if(e.m)for(var h=e.r||100,u=0;u<d;u++){var p=n.c_rnd(0,360),f=n.c_rnd(0,h);o.x=t+c_degree2cos(p)*f,o.y=i+c_degree2sin(p)*f,s=this.createObject(c,o)}else if(d>1)for(h=e.r||100,u=0;u<d;u++)o.x=t+c_degree2cos(u/d*360)*h,o.y=i+c_degree2sin(u/d*360)*h,s=this.createObject(c,o);else o.x=t,o.y=i,s=this.createObject(c,o);return s}},preCreateObject:function(e,t,i){this.game.callEffect(e,t,i,this.createObject.bind(this))},createObject:function(e,t,i){if(i||!e.preCreateEffect){var a=this.game,n=t.me;if(n&&this.heroes[n]){var o=this.heroes[n];return o.config.index=t.index,o}var r=new(e.ctor||p);if(this.addEntity(r),r.init(a,e,t),n&&(this.heroes[n]=r),a.remotes&&a.remotes.affix&&1==r.team)for(var s in cc.log("LevelManager affix",a.remotes.affix),a.remotes.affix){var c=a.remotes.affix[s];DifficultyAffixDefine[c].unitSpawnEffect(r,{team:1})}if(!t.summon&&0!=a.step){var l=e.bornEffect;a.callEffect(l,r.avatar)}if(r.junkFlag)return a.eventMgr.regist(r,"deathEvent",this,this.deathEvent),a.eventMgr.regist(r,"removeEvent",this,this.removeEvent),r;var d=r.team;if(!t.summon)for(var s in this.heroCheck&&!r.heroFlag||(this.teamObjs.push(r),this.teamTable[d]?this.teamTable[d]+=1:(this.teamCount+=1,this.teamTable[d]=1)),a.eventMgr.regist(r,"deathEvent",this,this.deathEvent),a.eventMgr.regist(r,"reviveEvent",this,this.reviveEvent),r.castDmgSum=0,r.castHealSum=0,r.skills)r.skills[s].castDmgSum=0;if(r.heroFlag&&(this.teamObjs.push(r),r.castDmgSum=0,r.castHealSum=0,r.dmgSum=0,a.eventMgr.regist(r,"hurtEvent",this,this.hurtEvent),a.eventMgr.regist(r,"healEvent",this,this.healEvent)),a.eventMgr.regist(r,"removeEvent",this,this.removeEvent),r.dmgSum=0,this.noSkills&&r.setFlag(NO_SKILLS,!0),this.hpScale&&!t.summon){var h=r.hp/r.hpMax,u=r.ep/r.epMax;r.attribute.addScale("hpMax",this.hpScale-1),r.attribute.addScale("epMax",this.hpScale-1),r.hp=h*r.hpMax,r.ep=u*r.epMax}return r}this.preCreateObject(e.preCreateEffect,e,t)},removeEvent:function(e){this.removeEntity(e);var t=e.config,i=e.team;e.heroFlag&&!e.deathAction&&(this.teamTable[i]-=1,0==this.teamTable[i]&&(this.teamCount-=1),t.me&&this.heroes[t.me]==e&&delete this.heroes[t.me])},removeEntity:function(e){delete this.entityMap[e.uniqueID];var t=this.entityList,i=t.indexOf(e);i>=0&&t.splice(i,1)},addEntity:function(e){this.uniqueID+=1;var t=e.uniqueID=this.uniqueID;this.entityMap[t]=e,this.entityList.push(e)},healEvent:function(e,t,i){t.getOwner().castHealSum+=i},hurtEvent:function(e,t,i,a){t.getOwner().castDmgSum+=i+a,e.dmgSum+=i+a;var n=t.getCaster();n.skillMark&&(n.castDmgSum+=i+a)},deathEvent:function(e){var t=this,i=this.game;if(this.lastDead=e,this.onEvent(e,DEED_TYPE.DEATH),!e.junkFlag){e.config,e.team,e.armorType==ARMOR_TYPE.machine?task.addDailyTaskCt("machineKilled"):e.armorType==ARMOR_TYPE.human&&task.addDailyTaskCt("humanKilled");var a=i.step*STEP_TIME;if(e.deadTime=a,!i.finished&&e.vehicleFlag&&e.config.me){var n=i.config.reviveFunc;if(n){var o=this.cameraType,r=this.cameraSpdX,s=this.cameraOffsetX;return void n(i,function(i){i?(t.setCameraType(o,r,s),e.addBuff(t,BUFF_DEFINE.revive)):t.sendMsg({v:{n:"fail"}})})}this.sendMsg({v:{n:"fail"}})}}},getLogs:function(e){var t=this.game.step*STEP_TIME,i="",a=function(e,t){for(var i=e.length;i<t;)e+="\u3000",i+=1;return e},n=function(t,i){void 0===i&&(i=6);for(var a=""+Math.floor(t),n=a.length;n<i;)a=e+a,n+=1;return a};for(var o in this.teamObjs){var r=this.teamObjs[o];if(!r.obj&&r.skills&&r.skills[2]){var s=r.deadTime||t;i=i+(a(r.define.name,4)+" \u961f\u4f0d:")+n(r.team,2)+" \u8f93\u51fa\u4f24\u5bb3: "+n(r.castDmgSum)+" ("+n(r.castDmgSum/s)+"|"+n(r.skills[0].castDmgSum/s)+"|"+n(r.skills[1].castDmgSum/s)+"|"+n(r.skills[2].castDmgSum/s)+") \u627f\u53d7\u4f24\u5bb3: "+n(r.dmgSum)+" ("+n(r.dmgSum/s)+") \u6cbb\u7597\u8f93\u51fa: "+n(r.castHealSum)+" ("+n(r.castHealSum/s)+")\n"}}return i},getObjectByIndex:function(e,t){if(e==INDEX_TYPE.ME)return this.heroes[t||1];if(void 0!==t||e==INDEX_TYPE.ALL)for(var i=this.entityList,a=0;a<i.length;a++){var n=i[a],o=n.config;if(o){if(e==INDEX_TYPE.ALL);else if(e==INDEX_TYPE.ID){if(o.id!=t)continue}else if(e==INDEX_TYPE.TEAM){if(n.team!=t)continue}else if(o.index!=t)continue;return n}}},getObject:function(e){return this.entityMap[e]},setCameraType:function(e,t,i){this.cameraType=e,this.cameraSpdX=t,this.cameraOffsetX=i,cc.log("setCameraType",this.cameraType,this.cameraSpdX,this.cameraOffsetX)},initCamera:function(){var e=this.heroes[1];this.cameraX=0,this.cameraY=e.getPositionY()-cc.winSize.height/2.3,this.cameraOffsetX=225,this.x=this.cameraX,this.game.layer.gameCamera.x=this.cameraX,this.fadeType=1,this.appearDelay?(e.callMove(0,0,!0),this.setCameraType(1,0,225)):(e.callMove(10,0,!0),this.setCameraType(1,this.moveSpd,225)),this.game.layer.gameCamera.updateStatus(0)},updateCamera:function(e){var t=0,i=1/GAME_VIEW_SCALE,a=this.heroes[1];if(1==this.cameraType)t=this.cameraSpdX*e,this.cameraX+=t;else if(2==this.cameraType){var n=a.getPositionX()+this.cameraOffsetX*i;if((t=n-this.cameraX)<0){var o=this.cameraSpdX*e;t=t<o?0:o,this.cameraX+=t}else{var r=this.cameraSpdX*e*5;t<=r?this.cameraX=n:(t=r,this.cameraX+=t)}}if(this.cameraY=a.getPositionY()-cc.winSize.height/2.3,this.game.layer.gameCamera.updateStatus(e),!this.lockDistance&&(this.x+=t,!this.ended)){for(var s=this.x+550*i,c=this.createGroupList;c.length>0;){var l=c[c.length-1];if(!(s>=l.x))break;for(var d in l.list){var u=l.list[d];0===u.t?this.runCreateObject(u):u.t>0&&this.timers.push({cfgData:u,timer:u.t||0,timerFunc:h})}c.pop()}if(this.checkPoint){if(1===this.checkPoint&&this.cameraX>this.checkPointDistance)if(this.heroes[1].isDead());else{var p=!1;for(var f in this.entityList){var m=this.entityList[f];if(m.bossFlag&&!m.isDead()&&1===m.team){p=!0;break}}p||(this.checkPoint=2,this.game.layer.theme.refreshCheckPoint(),this.sendMsg({v:{n:"win"}}))}}else if(this.x>=this.distance-720*i){this.checkPoint=1;var g=this.distance+this.cameraX-this.x;this.game.layer.theme.createCheckPoint(g),this.checkPointDistance=g+150*i}}},setFadeType:function(e){if(this.fadeType!=e){var t=this.heroes[1];if(1==this.fadeType){var i=this.moveSpdScale;this.fadeType=0,t.callMove(i,0,!0),this.setCameraType(2,this.moveSpd*i,225),t.setFlag(NO_ATTACK,!1),t.setInvincible(!1)}}},update:function(e){if(this.updateFunc(e),this.updateTimer(this.timers,e),this.updateCamera(e),1==this.fadeType){var t=1/GAME_VIEW_SCALE,i=this.heroes[1];if(this.appearDelay&&this.appearDelay>0)this.appearDelay-=e,this.appearDelay<=0&&i.callMove(10,0,!0);else{var a=i.getPositionX()+this.cameraOffsetX*t,n=this.appearDistance+this.cameraX,o=this.moveSpdScale;if(a>=n)this.fadeType=0,i.callMove(o,0,!0),this.setCameraType(2,this.moveSpd*o,225),i.setFlag(NO_ATTACK,!1),i.setInvincible(!1),this.game.layer.hideJoystickBtn(!0),this.appearMsgFlag&&this.game.layer.callStart();else{var r=c_clamp((n-a)/15+o+.2,0,10);i.callMove(r,0,!0)}}}else if(2==this.fadeType)if(this.x>this.fadeEndX)this.fadeType=0,this.heroes[1].callMove(0,0,!0),this.setCameraType(1,0,0);else{var s=this.fadeEndX-100-this.x,c=kit.clamp(s/700,0,.7*.2*BGM_VOLUME);cc.audioEngine.setMusicVolume(c)}if(this.ended&&!this.endCameraEffect){this.endCameraEffect=!0;var l=this.heroes[1];l.isDead()?this.setCameraType(2,this.moveSpd,0):(l.callMove(5),l.setUIVisible(!1),this.setCameraType(2,this.moveSpd,0),l&&(l.setFlag(NO_ATTACK,!0),l.setInvincible(!0),l.noHeal=!0))}for(this.odometerNeedUpdate&&(this.odometerNeedUpdate=!1,this.odometer.sort(function(e,t){return e.distance-t.distance}));this.odometer[0]&&this.x>=this.odometer[0].distance;){var d=this.odometer.shift();d.distanceFunc.call(this,d)}this.checkLvlUp&&(!this.ended&&chapter.checkLvlUp()&&menuManager.pop("talent_choose",{game:this.game,talent:this.game.remotes.talent}),this.checkLvlUp=null)},callFade:function(){var e=this.heroes[1];e.moveSpd=e.moveSpd||200,e.setInvincible(!0),e.callMove(5),this.setCameraType(2,this.moveSpd,0),this.fadeType=2,this.fadeEndX=this.x+800,this.game.layer.joystick.setVisible(!1)},onExit:function(){this.clear()},clear:function(){},getPrev:function(){return this},getOwner:function(){return this},getCaster:function(){return this},getCritChance:function(){return 0},getCritBonus:function(){return 1},getAtkScale:function(){return 1},statics:{computeBuffAndAttr:function(e){return cc.log("computeBuffAndAttr",e),JSON.parse(JSON.stringify(e))},getConfig:function(e,t){var i=function(e){return JSON.parse(JSON.stringify(e))},a=i(t);if(a.cfgData=t,a.index=t.id,a.id=t.i,void 0!==t.c&&e){var n=e.entity[t.c];n&&(cc.log("remote",n),void 0!==n.id&&(a.id=n.id),void 0!==n.hp&&(a.hp=n.hp),void 0!==n.star&&(a.star=n.star),void 0!==n.towers&&(a.towers=i(n.towers)),void 0!==n.heroes&&(a.heroes=i(n.heroes)),void 0!==n.bench&&(a.bench=i(n.bench)),void 0!==n.events&&(a.events=i(n.events)),void 0!==n.attr&&(a.attr=i(n.attr)),void 0!==n.cd&&(a.cd=i(n.cd)),a.name=n.name)}else{var o=t.lvl||0,r=o;e&&e.lvl&&(o+=e.lvl),e&&e.pw&&e.pw,pc.getEnemyAttr(o),e&&e.lvl2&&(r=e.lvl2),a.hp0=(a.hp0||1)+.1*r,a.atk0=(a.atk0||1)+.1*o}return a}}});cc._RF.pop()},{"../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../core/base/Entity":"Entity","../entities/items/Drop":"Drop"}],Light:[function(e,t){"use strict";cc._RF.push(t,"43ef7fWWl5HtaQp9oNlHJ0m","Light"),cc.Class({extends:cc.Component,properties:{circles:[cc.Node],blocks:[cc.Node],startColor:cc.color(191,251,255),endColor:cc.color(58,188,255),range:80},onLoad:function(){for(var e=this.circles.length,t=this.startColor,i=this.endColor,a=function e(){var a=this,n=a.parent;a.removeFromParent(!1),n.addChild(a),a.scale=0,a.opacity=255,a.color=t,a.runAction(cc.sequence(cc.spawn(cc.scaleTo(10,2).easing(cc.easeSineOut()),cc.fadeOut(10),cc.tintTo(10,i.r,i.g,i.b)),cc.callFunc(e,a)))},n=0;n<e;n++){var o=(n+1)/e,r=10*o;(d=this.circles[n]).color=cc.color(i.r+(t.r-i.r)*o,i.g+(t.g-i.g)*o,i.b+(t.b-i.b)*o),d.runAction(cc.tintTo(r,i.r,i.g,i.b)),d.scale=0,d.opacity=255;var s=d.runAction(cc.sequence(cc.spawn(cc.scaleTo(10,2).easing(cc.easeSineOut()),cc.fadeOut(10)),cc.callFunc(a,d)));s.step(0),s.step(10-r)}if(this.blocks.length){var c=this.range,l=function e(){var t=this;t.x=0,t.y=0,t.scale=1,t.opacity=255;var i=kit.rndInt(-120,120),a=kit.rnd(1,3);t.runAction(cc.sequence(cc.spawn(cc.moveBy(a,kit.degree2sin(i)*c,kit.degree2cos(i)*c),cc.fadeOut(a),cc.scaleTo(a,.3),cc.tintTo(a,58,188,255)).easing(cc.easeSineOut()),cc.callFunc(e,t)))};for(var n in this.blocks){var d;(d=this.blocks[n]).x=0,d.y=0,d.opacity=0,d.runAction(cc.sequence(cc.delayTime(kit.rnd(0,3)),cc.callFunc(l,d)))}}}}),cc._RF.pop()},{}],LinkMenu:[function(e,t){"use strict";cc._RF.push(t,"81e22eOJzlAWLoy9jBzR+Me","LinkMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{levelLabels:[cc.Label],carNodes:[cc.Node],vehiclePrefab:cc.Prefab},initStatus:function(){this.initLevel(),this.initVehicle()},initLevel:function(){var e=["atk","hp","skill"];for(var t in e)this.levelLabels[t].string=LI("lv")+(pc.getMaxLevel(e[t])+1)},initVehicle:function(){var e=this,t=excel.read("vehicle_list"),a=0;for(var n in pc.vehicleLink)pc.vehicleLink[n]&&a++;var o=function(n){var o=e.carNodes[n],r=t[n].id;if(pc.isVehicleUnlock(r)){var s=pc.getVehicleData(r),c=cc.instantiate(e.vehiclePrefab);o.getChildByName("avatar").addChild(c),(e.model=c.getComponent("VehicleModel")).init(s,{}),c.y-=40,c.scale=.4;var l=pc.vehicleLink[n];o.getChildByName("lock").active=!l;var d={i:DIAMOND,n:100*a};o.onTouch=function(){l?kit.info("\u5df2\u7ecf\u5f00\u542f\u5171\u9e23"):menuManager.pop("check",{price:d,info:"\u6d88\u8d39 "+d.n+" \u94bb\u5f00\u542f\u8fd9\u4e2a\u5171\u9e23?",checkCb:function(t){var a;t&&!money.check(d.i,d.n)&&net.updateData({price:d,set:(a={},a["vehicleLink."+n]=1,a)},function(t,a){i.FirebaseTracking.setDataBiRes("VehicleLink"),money.update(a),pc.setVehicleLinkStatus(n,1),e.initLevel(),e.initVehicle(),e.args.refreshCb(),cc.game.emit("use_money",{price:d,tid:"link",pos:o.convertToWorldSpaceAR(cc.v2(0,0))})})}})}}else o.onTouch=function(){kit.info("\u5c1a\u672a\u5f00\u542f\u8fd9\u4e2a\u8f7d\u5177")}};for(var r in this.carNodes)o(r)}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],LoadingEffect:[function(e,t){"use strict";cc._RF.push(t,"c1562OMqcBNSYLYGjJWpvqc","LoadingEffect"),cc.Class({extends:cc.Component,properties:{units:[cc.Node]},onLoad:function(){for(var e=0;e<this.units.length;e++)this.createUnit(e,.2*e)},createUnit:function(e,t){var i=this.units[e];i.opacity=0,i.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(.1,50),cc.delayTime(t),cc.callFunc(this.runUnit,i)))},runUnit:function(){this.runAction(cc.sequence(cc.spawn(cc.scaleTo(.2,1),cc.fadeIn(.2)),cc.delayTime(1.4),cc.spawn(cc.scaleTo(.2,0),cc.fadeOut(.2)),cc.delayTime(1.4)).repeatForever())}}),cc._RF.pop()},{}],LoadingMenu:[function(e,t){"use strict";cc._RF.push(t,"9fc94lOj5FPvrx6Y9z8PmcG","LoadingMenu");var i=e("../managers/EffectManager");cc.Class({extends:e("../ui/core/Menu"),properties:{noTopBar:!0,label:cc.Label,progressBar:cc.ProgressBar,runFreeFlag:!0},onLoad:function(){},start:function(){this.percent=0,this.label.string="0%"},initStatus:function(e){this.enabled=!1,this.startProgress=0,this.maxProgress=1,this.noWait=e.noWait,this.loadMap(e),this.noWait&&this.mgr.loadResStep(!0)},loadMap:function(e){var t=this;e.remoteFunc?e.remoteFunc(function(i,a,n){i?kit.info(LI("map_fail"),function(){menuManager.refresh()}):(e.remotes=n,e.mapData=a,t.initMgr(e,a,n))}):e.mapFile?map.load(e.mapFile,function(i,a){i?kit.info(LI("map_fail"),function(){menuManager.refresh()}):(e.mapData=a,t.initMgr(e,a,e.remotes))}):this.initMgr(e,e.mapData||DEFAULT_MAP,e.remotes)},initMgr:function(e){var t=this,a=this.mgr=new i;a.initRes(e,function(e){t.updateProgress(t.startProgress+(t.maxProgress-t.startProgress)*e)},function(){e.effectMgr=a;var t=e.menu||"game";menuManager.run(t,e)}),this.enabled=!0},updateProgress:function(e){this.label.string=Math.round(100*e)+"%",this.progressBar.progress=e},update:function(){this.noWait||this.mgr.loadResStep()}}),cc._RF.pop()},{"../managers/EffectManager":"EffectManager","../ui/core/Menu":"Menu"}],LocalLabel:[function(e,t){"use strict";cc._RF.push(t,"fba023NDOVB2JLbQd/lLxSi","LocalLabel"),cc.Class({extends:cc.Component,editor:{executionOrder:-1},properties:{_sid:{default:""},sid:{get:function(){return this._sid},set:function(e){this._sid=e,this.updateLabel()}}},updateLabel:function(){var e=this.getComponent(cc.Label)||this.getComponent(cc.RichText);e&&this._sid&&(e.string=LI(this._sid))},onLoad:function(){local.addComp(this),this.resetValue()},resetValue:function(){this.updateLabel()},onDestroy:function(){local.removeComp(this)}}),cc._RF.pop()},{}],LocalNode:[function(e,t){"use strict";cc._RF.push(t,"6c2e67kXxBBeqWnBl1UhDw3","LocalNode"),cc.Class({extends:cc.Component,editor:{executionOrder:-10},properties:{cnNode:cc.Node,enNode:cc.Node,sid:"",sValue:""},onLoad:function(){local.addComp(this),this.resetValue()},resetValue:function(){if(this.cnNode&&(this.cnNode.active="zh-cn"===LAN),this.enNode&&(this.enNode.active="zh-cn"!==LAN),this.sid&&this.sValue){var e=LI(this.sid);this.node.active=e===this.sValue}},onDestroy:function(){local.removeComp(this)}}),cc._RF.pop()},{}],LocalSprite:[function(e,t){"use strict";cc._RF.push(t,"3b4d1KGd/BDeIgDnKeV9HCV","LocalSprite"),cc.Class({extends:cc.Component,editor:{executionOrder:-1},properties:{cnFrame:cc.SpriteFrame,enFrame:cc.SpriteFrame,myFrame:cc.SpriteFrame},onLoad:function(){local.addComp(this),this.resetValue()},resetValue:function(){var e=this.getComponent(cc.Sprite);e&&("my"==CH?e.spriteFrame=this.myFrame:"zh-cn"==LAN?e.spriteFrame=this.cnFrame:e.spriteFrame=this.enFrame)},onDestroy:function(){local.removeComp(this)}}),cc._RF.pop()},{}],Locker:[function(e,t){"use strict";cc._RF.push(t,"db31cijKbdN3J5yVF7d4nMT","Locker"),cc.Class({extends:cc.Component,properties:{doorNode:cc.Node,lockLabel:cc.Label,lockNum:5},onLoad:function(){this.sensorCt=0,this.lockLabel&&(this.lockLabel.string="0/"+this.lockNum)},updateSensorCt:function(){this.sensorCt>=this.lockNum?this.doorNode&&(this.doorNode.active=!1):this.lockLabel&&(this.lockLabel.string=this.sensorCt+"/"+this.lockNum)},onBeginContact:function(){this.sensorCt++,this.updateSensorCt()},onEndContact:function(){this.sensorCt--,this.updateSensorCt()},onPreSolve:function(){},onPostSolve:function(){}}),cc._RF.pop()},{}],LoginMenu:[function(e,t){"use strict";cc._RF.push(t,"822570mVV5IkoCsGb9xWbbB","LoginMenu");var i,a=e("../../../Plugins/SDKManager"),n=e("../../../Plugins/firebase/FirebaseTracking"),o=(i=e("../../managers/TaskBattlePassInit"))&&i.__esModule?i:{default:i};function r(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=s(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var l=e("../../managers/RemoteConfigManager"),d=e("../../scripts/hotUpdate");cc.Class({extends:e("../core/Menu"),properties:{noTopBar:!0,label:cc.Label,progressBar:cc.ProgressBar,loginUI:cc.Node,loadingUI:cc.Node,retryUI:cc.Node,loginLabel:cc.Label,titleNode:cc.Node,srNumLabel:cc.Label,srNameLabel:cc.Label,cadpaNode:cc.Node},onLoad:function(){this.loginCt=3,this.percent=0,this.label.string="0%",this.progressBar.progress=0,this.loginUI.active=!1;var e=["google"].includes(CH);this.loginUI.find("check").active=!0;var t=this.loginUI.find("check/toggle",cc.Toggle);t.isChecked=!0,this.loginToggle=t,this.cadpaNode.active=!e,this.retryUI.on(cc.Node.EventType.TOUCH_START,this.downloadResource,this),this.retryUI.active=!1,this.retryUI.getChildByName("label").runAction(cc.sequence(cc.fadeOut(1),cc.fadeIn(1),cc.delayTime(.3)).repeatForever()),menuManager.init(this,"login");var i,a=this.loginUI.find("btns").children,n=[CH];["oppo"].includes(CH)&&(n=["normal"]),["google","taptap"].includes(CH)&&n.push("guest");for(var o=r(a);!(i=o()).done;)i.value;var s=sdk.pt();if(s&&s.getLaunchOptionsSync){var c=s.getLaunchOptionsSync();console.log("getLaunchOptionsSync:",c),this.launchArgs=c.query,this.launchScene=c.scene}else if(window.launchQuery){var l=window.launchQuery;this.launchArgs=l,this.launchScene=l.scene,l.physics&&(user.onlyPhysics=BUILD_VERSION>=l.physics,l.physicsLv?user.onlyPhysicsLevel=+l.physicsLv:user.onlyPhysicsLevel=0),l.gunner&&(user.onlyGunner=BUILD_VERSION>=l.gunner,l.gunnerLv?user.onlyGunnerLevel=+l.gunnerLv:user.onlyGunnerLevel=0,l.gunnerCh?user.onlyGunnerChapter=2:user.onlyGunnerChapter=0)}},reset:function(){this.loginCt--,cc.log("reset this.loginCt",this.loginCt),this.percent=0,this.maxTime=0,this.updateProgress(0),this.loginCt>0?this.downloadResource():(this.loginCt=2,this.retryUI.active=!0,this.loadingUI.active=!1)},initStatus:function(){this.updateProgress(0)},callLogin:function(e,t){this.nativePlatform=t||CH,this.loadingUI.active=!0,this.loginUI.active=!1,this.login()},callCADPA:function(){kit.openURL(URLS.cadpa)},runMainMenu:function(){var e=this;if(this.jumpProgress(1),cc.log("DEV_MODE",DEV_MODE),DEV_MODE&&DEBUG_MODE)cc.assetManager.loadBundle("editor",function(){menuManager.runReal(menuManager.getDefault("main"),{},!0)});else if(user.onlyPhysics)ballMode.start({mapIndex:user.onlyPhysicsLevel||0});else if(user.onlyGunner)gunnerMode.start({chapterIndex:user.onlyGunnerChapter||0,mapIndex:user.onlyGunnerLevel||0});else if(user.getGuide("chapter"))menuManager.run("main",{},!0);else if(window.sfwx&&sfwx.WxZtSdk){var t=user.uuid.substring("wx_mini_".length);sfwx.WxZtSdk.instance.getPlayableIndex(function(t){console.log("WxZtSdk getPlayableIndex",t),e.runGuide(t)},t)}else{var i,a;a=null==(i=this.launchArgs)?void 0:i.guanka,this.runGuide(a)}},runGuide:function(e){1==e?ballMode.start({chapterIndex:1,jumpToAdventure:!0}):2==e?gunnerMode.start({chapterIndex:1,jumpToAdventure:!0}):3==e?gunnerMode.start({chapterIndex:3,jumpToAdventure:!0}):chapter.canRecall(0)?chapter.continue():adventure.start(0)},downloadExcel:function(){var e=this;if(console.log("go excel.load===21==123"),this.waitProgress(2,.3,.4),!window.CHAPTER_HARD_FIX_CONFIG||!window.CHAPTER_DEFINE_ARRAY)try{var t=l.getInstance();t&&t.loadLocalConfigDefaults&&(t.loadLocalConfigDefaults(),console.log("[LoginMenu] Using RemoteConfigManager.loadLocalConfigDefaults()"))}catch(i){console.log("[LoginMenu] Load Error",i)}excel.load(function(){e.login()})},downloadData:function(e){var t=this;console.log("go downloadData",CH),this.waitProgress(5,.6,1);var i=e.loginData;net.postSilent("login",{game:"backpack",gameId:GAME_ID,userInfo:e.userInfo,loginData:i,oid:e.openId,v:MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION+"."+BUILD_VERSION+"-"+CODE_VERSION,ch:CH,os:OS},function(e,i){if(e)t.reset();else if(i.fail)kit.info(i.msg||"\u670d\u52a1\u5668\u62d2\u7edd");else{var a=i.hotfix;if(a)try{var r=a.json;r&&kit.eval(r),cc.log("hotfix:",a.v)}catch(p){cc.warn(p)}net.token=i.token,i.extra&&(user.session_key=i.extra.session_key),sdk.setConfigData(i);var s=i.doc;console.log("doc:",s),user.setOnlineData(s);var c=i.initConfig||{};if(console.log("initConfig:",c),c.physics&&(user.onlyPhysics=BUILD_VERSION>=c.physics,user.onlyPhysicsLevel=c.physicsLv),c.gunner&&(user.onlyGunner=BUILD_VERSION>=c.gunner,user.onlyGunnerLevel=c.gunnerLv,c.gunnerCh?user.onlyGunnerChapter=2:user.onlyGunnerChapter=0),user.feedback=c.feedback||0,user.tjMsg=c.tjMsg||0,user.feedSubscribeId=c.feedSubscribeId||"",user.buyVIPState=s.buyVIPState||0,user.claimVIPTime=s.claimVIPTime||0,user.buyMonthTime=s.buyMonthTime||0,user.claimMonthTime=s.claimMonthTime||0,money.setOnlineData(s),task.setOnlineData(s),pc.setOnlineData(s),shop.setOnlineData(s),equipment.setOnlineData(s),garage.setOnlineData(s),boxLvl.setOnlineData(s),daily.setOnlineData(s),!window.TaskBattlePassInit||!window.TaskBattlePassInit.isInitialized())try{o.default.init(),console.log("[LoginMenu] \u2705 Task & Battle Pass system initialized after login")}catch(f){console.error("[LoginMenu] \u274c Failed to initialize Task & Battle Pass:",f)}if(window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized())try{console.log("[LoginMenu] Loading Battle Pass data from server..."),window.TaskBattlePassInit.loadFromServer(s),console.log("[LoginMenu] \u2705 Battle Pass data loaded from server")}catch(f){console.error("[LoginMenu] \u274c Failed to load Battle Pass data:",f)}privacy.init(),chapter.load(),cc.log("\u73a9\u5bb6\u5173\u5361\u8fdb\u5ea6",pc.stageIndex),n.FirebaseTracking.logNewTutorial({Step:1,userID:user.uuid,Status:1}),sdk.setAdjustEvent("a3qkrc",""),console.log("\u5c1d\u8bd5\u83b7\u53d6\u73a9\u5bb6ab\u6d4b\u8bd5\u7c7b\u578b",user.abTestIndex);var l=function(){for(var e in CHAPTER_DEFINE_ARRAY){var t=CHAPTER_DEFINE_ARRAY[e];t.repeatFlag&&(t.rewardBox&&t.rewardBox[1]&&t.rewardBox[1].push({i:HERO_REFRESH_TICKET,n:1}),t.rewardBox&&t.rewardBox[2]&&t.rewardBox[2].push({i:RECRUIT_TICKET,n:1}))}cc.log("\u975eB\u7248\u73a9\u5bb6\u7684\u8f6e\u56de\u7ae0\u8282\u5956\u52b1\u6dfb\u52a0\u8000\u661f\u548c\u5237\u65b0\u5238"),user.checkDau(),user.checkLoginNewDay()};if(void 0===user.abTestIndex){console.log("\u672a\u53d1\u73b0ab\u6d4b\u7248\u672c");var d=c.abTest;if(console.log("\u5c1d\u8bd5\u83b7\u53d6ab\u6d4b\u8bd5\u5b57\u6bb5",d),pc.stageIndex>0&&(console.log("\u9996\u6b21\u83b7\u53d6ab\u6d4b\u7248\u672c\u5e76\u62e5\u6709\u5173\u5361\u8fdb\u5ea6\uff0c\u5224\u5b9a\u4e3a\u8001\u73a9\u5bb6\uff0c\u56fa\u5b9a\u5206\u914d\u7248\u672cA"),d=""),window.streamerMode&&(d=""),d){console.log("\u68c0\u6d4b\u6709ab\u6d4b\u8bd5\u4e14\u73a9\u5bb6\u672a\u5206\u914d\u6d4b\u8bd5\u7c7b\u578b");var h=d.split("|");console.log("ab\u6d4b\u8bd5\u5b57\u6bb5",h);var u=kit.rollWithPower(h);console.log("\u5206\u914dab\u6d4b\u8bd5\u7c7b\u578b",u),user.uploadAbTestIndex(u,l)}else l()}else l();i.dev&&(window.streamerMode?H5VERSION=1:DEV_MODE=1),TJ.onEvent("login",{uid:user.uuid,platform:i.platform,register:i.register,laber:"UserA"}),TJ.onEvent("user_add",{total_login_cnt:1}),t.runMainMenu()}},!1)},login:function(){var e=this;if(console.log("go login"),this.waitProgress(4,.4,.6),window.nativeSdk&&nativeSdk.initPrivacy&&nativeSdk.initPrivacy(),console.log(this.nativePlatform),["taptap","google","oppo"].includes(CH)&&!this.nativePlatform)return this.loginUI.active=!0,this.loadingUI.active=!1,void this.callLogin(null,"guest");var t=sdk.pt();if(t&&t.login)t.login({force:!1,success:function(t){var i;cc.sys.platform===cc.sys.WECHAT_GAME?i=window.ks?{platform:"ks",code:t.code}:{platform:"wx",code:t.code}:cc.sys.platform===cc.sys.BYTEDANCE_GAME?i={platform:"tt",code:t.code,anonymousCode:t.anonymousCode}:cc.sys.platform===cc.sys.OPPO_GAME&&(i={platform:"oppo",token:t.data.token}),e.downloadData({loginData:i})},fail:function(t){n.FirebaseTracking.logNewTutorial({Step:1,userID:user.uuid,Status:0}),console.log("login fail",t),kit.info(LI("login_null_msg")),e.reset()}});else if(window.nativeSdk&&nativeSdk.login)console.log("nativeSdk.login"),nativeSdk.login(this.nativePlatform||CH,function(t,i){if(console.log("nativeSdk.login cb",t,i),cc.isValid(e.node)){if(t||!i)return kit.info("\u767b\u5f55\u5931\u8d25"),e.loginUI.active=!0,void(e.loadingUI.active=!1);"string"==typeof i&&(i=JSON.parse(info)),e.downloadData({loginData:i})}});else{var i=cc.sys.localStorage.getItem("test_id");i||(i=this.formatTimestamp(Date.now()),cc.sys.localStorage.setItem("test_id",i)),this.downloadData({openId:i})}},formatTimestamp:function(e){var t=new Date(e);return"user_"+String(t.getDate()).padStart(2,"0")+String(t.getMonth()+1).padStart(2,"0")+t.getFullYear()+"_"+String(t.getUTCHours()).padStart(2,"0")+String(t.getUTCMinutes()).padStart(2,"0")+String(t.getSeconds()).padStart(2,"0")+kit.rndInt(0,9999)},downloadResource:function(){var e=this;console.log("go loadSubpackage11111"),this.retryUI.active=!1,this.loadingUI.active=!0,this.waitProgress(3,0,.3),d.check("",function(t,i,a,n){console.log("download progress",t,i,a,n),e.updateProgress(a/n,!0)},function(t,i,a,n){console.log("verify progress",t,i,a,n),e.updateProgress(t/i)},function(t,i){console.log("hotUpdate ret",t,i),i?(e.updateProgress(1,!0),setTimeout(function(){d.restart()},100)):e.downloadExcel()})},launch:function(){console.log("go launch"),a.SDKManager.Instance.StartFlowInitSDK(),console.log(" net.init();"),net.init(),console.log(" sdk.init();"),sdk.init(),console.log("   money.init();"),money.init(),console.log("      user.init();"),user.init(),console.log("       pvp.init();"),pvp.init(),console.log("            pc.init();"),pc.init(),console.log("            chapter.init();"),chapter.init(),console.log("              shop.init();"),shop.init(),console.log("               task.init();"),task.init(),console.log("                adventure.init()"),adventure.init(),this.downloadResource()},start:function(){var t=this;console.log("go start"),console.log("[LoginMenu] Initializing RemoteConfigManager...");try{var i=e("../../managers/RemoteConfigManager");if(i){var a=i.RemoteConfigManager||i;if("function"==typeof a.getInstance){var n=a.getInstance(),o=n.initialize();console.log("[LoginMenu] Waiting for RemoteConfigManager initialization..."),o&&"function"==typeof o.then?o.then(function(){console.log("[LoginMenu] RemoteConfigManager initialization complete"),t.launch()}).catch(function(e){console.error("[LoginMenu] RemoteConfigManager initialization failed:",e),n&&n.loadLocalConfigDefaults&&n.loadLocalConfigDefaults(),t.launch()}):(console.log("[LoginMenu] RemoteConfigManager initialized (non-promise)"),t.launch())}else console.log("[LoginMenu] RemoteConfigManager loaded but getInstance not found, using local configs"),a&&a.loadLocalConfigDefaults&&a.loadLocalConfigDefaults(),t.launch()}else t.launch()}catch(r){t.launch()}},waitProgress:function(e,t,i){this.timer=0,this.maxTime=e,this.p0=t,this.p1=i},jumpProgress:function(e){this.maxTime=0,this.updateProgress(e)},updateProgress:function(e){e<this.percent||(this.percent=e,this.label.string=Math.round(100*e)+"%",this.progressBar.progress=e)},update:function(e){this.maxTime&&this.timer<this.maxTime&&(this.timer+=e,this.timer>this.maxTime&&(this.timer=this.maxTime),this.updateProgress(this.p0+this.timer/this.maxTime*(this.p1-this.p0)))}}),cc._RF.pop()},{"../../../Plugins/SDKManager":"SDKManager","../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../managers/RemoteConfigManager":"RemoteConfigManager","../../managers/TaskBattlePassInit":"TaskBattlePassInit","../../scripts/hotUpdate":"hotUpdate","../core/Menu":"Menu"}],LootMenu:[function(e,t){"use strict";cc._RF.push(t,"9e39dUQMa9NvLIXS+9RjEqE","LootMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("./ShowMenu"),properties:{readyAudio:{type:cc.AudioClip,default:null},itemAudio:{type:cc.AudioClip,default:null},videoButtonNode:cc.Node,videoLabel:cc.Label,lootButtonNode:cc.Node,labelNode:cc.Node},onLoad:function(){},onDestroy:function(){this.onDestroyAd()},initStatus:function(e){this.speed=2,this.itemLayoutNode.active=!1,this.lightNode.opacity=0,this.coverNode.opacity=0,this.isBannerOpened()?this.board.y=70:this.board.y=0,this.itemList=[];var t=e.items;if(t){var i=t.length+(e.videoItems?e.videoItems.length:0),a=Math.ceil(i/4);for(var n in this.itemLayoutNode.height=190*a,i<=4&&(this.itemLayoutNode.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.CONTAINER,this.itemLayoutNode.getComponent(cc.Layout).type=cc.Layout.Type.HORIZONTAL),t)this.addItem(t[n])}this.itemNode.active=!1,menuManager.playEffect(this.readyAudio),this.videoButtonNode.active=!1,this.lootButtonNode.active=!1},onShow:function(){this.shown||(this.shown=!0,this.videoButtonNode.active=!0,this.lootButtonNode.active=!0,this.args.videoItems?this.videoLabel.string=this.args.videoStr||LI("double"):this.videoButtonNode.active=!1,this.args.guide&&(this.videoButtonNode.active=!1,menuManager.focusOn(this.lootButtonNode,"")))},onJump:function(){menuManager.playEffect(this.openAudio),this.lightNode.runAction(cc.spawn(cc.fadeIn(.3/this.speed),cc.scaleBy(.3/this.speed,7),cc.tintTo(.3/this.speed,255,255,255)).easing(cc.easeIn(1))),this.coverNode.runAction(cc.sequence(cc.fadeIn(.5/this.speed).easing(cc.easeIn(1)),cc.delayTime(.3/this.speed),cc.callFunc(function(){var e=this;this.itemLayoutNode.active=!0;var t=function(t){var i=e.itemList[t],a=(.3*t+.3)/e.speed;i.opacity=0,i.scale=.5,i.runAction(cc.sequence(cc.delayTime(a),cc.callFunc(function(){menuManager.playEffect(this.itemAudio),i.runAction(cc.spawn(cc.scaleTo(.2/this.speed,1),cc.fadeIn(.2/this.speed)));var e=i.itemShine;e&&(e.opacity=100,e.scale=.5,e.runAction(cc.spawn(cc.scaleTo(.5/this.speed,1),cc.fadeIn(.5/this.speed)).easing(cc.easeSineOut())))},e)))};for(var i in this.itemList)t(i);var a=.3*this.itemList.length;this.node.runAction(cc.sequence(cc.delayTime((a+.2+.5)/this.speed),cc.callFunc(this.onShow,this))),this.lightNode.runAction(cc.fadeOut(.2/this.speed))},this),cc.fadeOut(1.5/this.speed)))},start:function(){this.onJump()},onVideo:function(){var e=this,t=this.args.videoItems;if(t){var a=function(){var i=function(){var i=e.addItem(t[a]);i.opacity=0,i.scale=.5,i.active=!0,i.runAction(cc.sequence(cc.delayTime(.2*a/e.speed),cc.callFunc(function(){menuManager.playEffect(this.itemAudio),i.runAction(cc.spawn(cc.scaleTo(.2/this.speed,1),cc.fadeIn(.2/this.speed)));var e=i.itemShine;e&&(e.opacity=100,e.scale=.5,e.runAction(cc.spawn(cc.scaleTo(.5/this.speed,1),cc.fadeIn(.5/this.speed)).easing(cc.easeSineOut())))},e)))};for(var a in t)i()};cc.log("onVideo",t),sdk.useFree(this.args.tid||"box",function(n){n||(equipment.getItemFromReward([],t),net.updateData({items:t},function(t,n){i.FirebaseTracking.setDataBiRes("Ads_Loot"),money.update(n),e.videoButtonNode.active=!1,a()}),"x2_complete"==e.args.tid&&YMTJ("video","x2_complete"))})}},onLoot:function(){this.args.lootCb&&this.args.lootCb(),this.onGot()},onGot:function(){this.args;var e=this.got();this.videoButtonNode.active=!1,this.lootButtonNode.active=!1,this.args.guide&&(TJ.onGuideEvent({guide_id:86,guide_name:"\u5546\u5e97-\u9886\u53d6"}),user.setGuide("shop",1)),this.node.runAction(cc.sequence(cc.delayTime(e/this.speed),cc.callFunc(function(){this.close()},this)))}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","./ShowMenu":"ShowMenu"}],MAXDebug:[function(e,t){"use strict";cc._RF.push(t,"max-debug-util-001","MAXDebug");var i={isEnabled:!1,enable:function(){this.isEnabled&&(cc.log("MAXDebug: Enabling debug mode...",this.isEnabled),cc.sys.os!==cc.sys.OS_ANDROID&&cc.sys.os!==cc.sys.OS_IOS||(cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","enableDebugMode","()V"),this.isEnabled=!1,cc.log("MAXDebug: Debug mode ENABLED"),cc.log("MAXDebug: Check logcat/console for detailed MAX logs"),this.logStatus()))},enableTestMode:function(){var e=this;cc.log("MAXDebug: ACTIVATING TEST MODE..."),cc.log("MAXDebug: Test ads will be shown instead of live ads"),cc.sys.os===cc.sys.OS_ANDROID?(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","forceTestMode","()V"),cc.log("MAXDebug: ==================================="),cc.log("MAXDebug: TEST MODE ACTIVATED!"),cc.log("MAXDebug: - Test ads will be shown"),cc.log("MAXDebug: - No revenue will be generated"),cc.log("MAXDebug: - Safe for clicking during testing"),cc.log("MAXDebug: ==================================="),this.isEnabled||this.enable(),setTimeout(function(){cc.log("MAXDebug: Opening Mediation Debugger to verify test mode..."),e.showMediationDebugger()},2e3)):cc.warn("MAXDebug: Test mode only available on Android")},disableTestMode:function(){cc.log("MAXDebug: Disabling test mode..."),cc.sys.os===cc.sys.OS_ANDROID&&(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","disableTestMode","()V"),cc.log("MAXDebug: Test mode DISABLED - Live ads will be shown"))},disable:function(){cc.log("MAXDebug: Disabling debug mode..."),cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","disableDebugMode","()V"),this.isEnabled=!1,cc.log("MAXDebug: Debug mode DISABLED")},showMediationDebugger:function(){cc.log("MAXDebug: Opening MAX Mediation Debugger..."),cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_IOS?(cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","showMAXDebug","()V"),cc.log("MAXDebug: Mediation Debugger opened")):cc.warn("MAXDebug: Debugger only available on mobile devices")},showCreativeDebugger:function(){cc.log("MAXDebug: Opening Creative Debugger..."),cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_IOS?(cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","showCreativeDebugger","()V"),cc.log("MAXDebug: Creative Debugger opened"),cc.log("MAXDebug: You can now see recently displayed ads and report issues")):cc.warn("MAXDebug: Creative Debugger only available on mobile devices")},showDebugger:function(){this.showMediationDebugger()},getInfo:function(){return cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","getDebugInfo","()Ljava/lang/String;"):"Debug info only available on mobile devices"},logStatus:function(){if(cc.log("=== MAX SDK STATUS ==="),cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_IOS){var e=this.getInfo();cc.log(e),this.checkAdAvailability()}else cc.log("Running on non-mobile platform");cc.log("===================")},checkAdAvailability:function(){if(cc.log("=== AD AVAILABILITY ==="),"undefined"!=typeof MAX&&MAX.instance){var e=MAX.instance.isRewarded();cc.log("Rewarded Ad Ready: "+e);var t=MAX.instance.isInterstitial();cc.log("Interstitial Ad Ready: "+t),cc.log("Banner: Check visual display")}else cc.log("MAX not initialized yet")},loadRewardedAd:function(){cc.log("MAXDebug: Manually loading rewarded ad..."),cc.sys.os===cc.sys.OS_ANDROID&&(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","loadRewarded","()V"),cc.log("MAXDebug: Load command sent. Check logs for onAdLoaded or onAdLoadFailed"))},loadInterstitialAd:function(){cc.log("MAXDebug: Manually loading interstitial ad..."),cc.sys.os===cc.sys.OS_ANDROID&&(jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MAXNative","loadInterstitial","()V"),cc.log("MAXDebug: Load command sent. Check logs for callback"))},testRewardedAd:function(){cc.log("MAXDebug: Testing rewarded ad..."),"undefined"!=typeof MAX&&MAX.instance?MAX.instance.isRewarded()?(cc.log("MAXDebug: Showing rewarded ad..."),MAX.instance.showRewarded()):(cc.log("MAXDebug: Rewarded ad not ready. Attempting to load..."),this.loadRewardedAd(),setTimeout(function(){MAX.instance.isRewarded()?(cc.log("MAXDebug: Ad loaded! Showing now..."),MAX.instance.showRewarded()):cc.error("MAXDebug: Ad still not ready after loading. Check logs for errors")},3e3)):cc.error("MAXDebug: MAX not initialized")},testInterstitialAd:function(){cc.log("MAXDebug: Testing interstitial ad..."),"undefined"!=typeof MAX&&MAX.instance?MAX.instance.isInterstitial()?(cc.log("MAXDebug: Showing interstitial ad..."),MAX.instance.showInterstitial()):cc.log("MAXDebug: Interstitial ad not ready"):cc.error("MAXDebug: MAX not initialized")},monitorEvents:function(){if(cc.log("MAXDebug: Setting up event monitoring..."),"undefined"!=typeof MAX&&MAX.instance){var e={onInitialized:MAX.instance.onInitialized,onAdLoaded:MAX.instance.onAdLoaded,onAdLoadFailed:MAX.instance.onAdLoadFailed,onAdDisplayed:MAX.instance.onAdDisplayed,onAdDisplayFailed:MAX.instance.onAdDisplayFailed,onAdHidden:MAX.instance.onAdHidden,onAdClicked:MAX.instance.onAdClicked,onUserRewarded:MAX.instance.onUserRewarded};MAX.instance.onInitialized=function(){cc.log("MAXDebug EVENT: SDK Initialized"),e.onInitialized&&e.onInitialized.apply(this,arguments)},MAX.instance.onAdLoaded=function(){cc.log("MAXDebug EVENT: Ad Loaded"),e.onAdLoaded&&e.onAdLoaded.apply(this,arguments)},MAX.instance.onAdLoadFailed=function(t,i,a){cc.error("MAXDebug EVENT: Ad Load Failed",{type:t,unitId:i,error:a}),e.onAdLoadFailed&&e.onAdLoadFailed.apply(this,arguments)},MAX.instance.onAdDisplayed=function(t,i){cc.log("MAXDebug EVENT: Ad Displayed",{type:t,info:i}),e.onAdDisplayed&&e.onAdDisplayed.apply(this,arguments)},MAX.instance.onAdDisplayFailed=function(t,i,a){cc.error("MAXDebug EVENT: Ad Display Failed",{type:t,info:i,error:a}),e.onAdDisplayFailed&&e.onAdDisplayFailed.apply(this,arguments)},MAX.instance.onAdHidden=function(t,i){cc.log("MAXDebug EVENT: Ad Hidden",{type:t,info:i}),e.onAdHidden&&e.onAdHidden.apply(this,arguments)},MAX.instance.onAdClicked=function(t,i){cc.log("MAXDebug EVENT: Ad Clicked",{type:t,info:i}),e.onAdClicked&&e.onAdClicked.apply(this,arguments)},MAX.instance.onUserRewarded=function(t,i,a){cc.log("MAXDebug EVENT: User Rewarded",{type:t,info:i,reward:a}),e.onUserRewarded&&e.onUserRewarded.apply(this,arguments)},cc.log("MAXDebug: Event monitoring enabled")}else cc.error("MAXDebug: MAX not initialized")},createDebugUI:function(){var e=this;cc.log("MAXDebug: Creating debug UI...");var t=new cc.Node("MAXDebugPanel");t.width=200,t.height=400,t.x=cc.winSize.width-100,t.y=cc.winSize.height/2;var i=t.addComponent(cc.Graphics);return i.fillColor=new cc.Color(0,0,0,180),i.fillRect(-100,-200,200,400),[{label:"Mediation Debug",y:175,action:function(){return e.showMediationDebugger()}},{label:"Creative Debug",y:125,action:function(){return e.showCreativeDebugger()}},{label:"Test Rewarded",y:75,action:function(){return e.testRewardedAd()}},{label:"Test Interstitial",y:25,action:function(){return e.testInterstitialAd()}},{label:"Check Status",y:-25,action:function(){return e.logStatus()}},{label:"Toggle Debug",y:-75,action:function(){return e.isEnabled?e.disable():e.enable()}}].forEach(function(i){var a=new cc.Node("DebugButton");a.y=i.y,a.width=180,a.height=40,a.addComponent(cc.Sprite);var n=new cc.Node("Label"),o=n.addComponent(cc.Label);o.string=i.label,o.fontSize=14,o.lineHeight=20,n.color=cc.Color.WHITE,n.parent=a,a.addComponent(cc.Button).node.on("click",i.action,e),a.parent=t}),cc.director.getScene().addChild(t,9999),cc.game.addPersistRootNode(t),cc.log("MAXDebug: Debug UI created"),t}};t.exports=i,window.MAXDebug=i,cc._RF.pop()},{}],MAXImplement:[function(e,t,i){"use strict";cc._RF.push(t,"e2992ltpR9PLpWO4qAB6gId","MAXImplement"),Object.defineProperty(i,"__esModule",{value:!0}),i.getMAXPlatform=void 0,i.getMAXPlatform=function(){return new a};var a=function(){function e(){}return e.prototype.init=function(){window.MAX.instance.onInitialized()},e.prototype.showBanner=function(){},e.prototype.hideBanner=function(){},e.prototype.destroyBanner=function(){},e.prototype.showInterstitial=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.wait(1)];case 1:return e.sent(),window.MAX.instance.onAdHidden(1,"{}"),[2]}})})},e.prototype.isInterstitial=function(){return!0},e.prototype.showRewarded=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Promise.wait(.5)];case 1:return e.sent(),window.MAX.instance.onUserRewarded(2,"{}","{}"),[4,Promise.wait(.5)];case 2:return e.sent(),window.MAX.instance.onAdHidden(2,"{}"),[2]}})})},e.prototype.isRewarded=function(){return!0},e}();(function(){function e(){}e.prototype.init=function(t){jsb.reflection.callStaticMethod(e.CLASS_PATH,"init","(Ljava/lang/String;)V",JSON.stringify(t))},e.prototype.showBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showBanner","()V")},e.prototype.hideBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"hideBanner","()V")},e.prototype.destroyBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"destroyBanner","()V")},e.prototype.showInterstitial=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showInterstitial","()V")},e.prototype.isInterstitial=function(){return jsb.reflection.callStaticMethod(e.CLASS_PATH,"isInterstitial","()Z")},e.prototype.showRewarded=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showRewarded","()V")},e.prototype.isRewarded=function(){return jsb.reflection.callStaticMethod(e.CLASS_PATH,"isRewarded","()Z")},e.CLASS_PATH="org/cocos2dx/javascript/applovin/MAXNative"})(),function(){function e(){}e.prototype.init=function(t){jsb.reflection.callStaticMethod(e.CLASS_PATH,"initWithConfig:",JSON.stringify(t))},e.prototype.showBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showBanner")},e.prototype.hideBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"hideBanner")},e.prototype.destroyBanner=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"destroyBanner")},e.prototype.showInterstitial=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showInterstitial")},e.prototype.isInterstitial=function(){return jsb.reflection.callStaticMethod(e.CLASS_PATH,"isInterstitial")},e.prototype.showRewarded=function(){jsb.reflection.callStaticMethod(e.CLASS_PATH,"showRewarded")},e.prototype.isRewarded=function(){return jsb.reflection.callStaticMethod(e.CLASS_PATH,"isRewarded")},e.CLASS_PATH="ALMAXNative"}(),cc._RF.pop()},{}],MAX:[function(e,t,i){"use strict";cc._RF.push(t,"19e6c5UpldECrZMPaHTq3u3","MAX"),Object.defineProperty(i,"__esModule",{value:!0}),i.MAX=i.AdType=void 0;var a=e("../promise/PromiseExt"),n=e("./MAXImplement");(function(e){e[e.Banner=0]="Banner",e[e.Interstitial=1]="Interstitial",e[e.Rewarded=2]="Rewarded"})(i.AdType||(i.AdType={}));var o=function(){function e(){this._source=null,this._waitingTask=null,this._rewarded=!1,this._getRewarded=!1,this._initialized=!1,this.onInitializedListener=null,this.onComCallback=null,this.onPayCallback=null,this._productIdInfo=null,this._source=n.getMAXPlatform(),this._listeners=[void 0,void 0,void 0]}return Object.defineProperty(e.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),e.prototype.init=function(e,t){console.log("========= Init MAX Applovin"),this._initialized||(this.onInitializedListener=t,this._source.init(e))},e.prototype.setListener=function(e,t){this._listeners[e]=t},e.prototype.showBanner=function(){this.initialized&&this._source.showBanner()},e.prototype.hideBanner=function(){this.initialized&&this._source.hideBanner()},e.prototype.destroyBanner=function(){this.initialized&&this._source.destroyBanner()},e.prototype.setPayBack=function(e){this.onPayCallback=e},e.prototype.showInterstitial=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.initialized&&this.isInterstitial()?(this._waitingTask=new a.DeferredPromise,this._source.showInterstitial(),[4,this._waitingTask.promise]):[2];case 1:return e.sent(),this._waitingTask=null,[2]}})})},e.prototype.isInterstitial=function(){return this._source.isInterstitial()},e.prototype.showRewarded=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.initialized&&this.isRewarded()?(this.onComCallback=e,this._getRewarded=!1,this._rewarded=!1,this._waitingTask=new a.DeferredPromise,this._source.showRewarded(),[4,this._waitingTask.promise]):(kit.info(window.LI("ads_empty_msg")),[2,!1]);case 1:return t.sent(),[2,this._rewarded]}})})},e.prototype.isRewarded=function(){return this._source.isRewarded()},e.prototype.onInitialized=function(){var e;this._initialized=!0,null===(e=this.onInitializedListener)||void 0===e||e.call(this)},e.prototype.onAdExpanded=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdExpanded)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onAdCollapsed=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdCollapsed)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onAdLoaded=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdLoaded)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onAdDisplayed=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdDisplayed)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onAdHidden=function(e,t){var i,a,n;this._getRewarded&&this.onComCallback(0,VIDEO_FREE),null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdHidden)||void 0===a||a.call(i,JSON.parse(t)),null===(n=this._waitingTask)||void 0===n||n.resolve()},e.prototype.onAdClicked=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onAdClicked)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onAdLoadFailed=function(e,t,i){var a,n;null===(n=null===(a=this._listeners[e])||void 0===a?void 0:a.onAdLoadFailed)||void 0===n||n.call(a,t,JSON.parse(i))},e.prototype.onAdDisplayFailed=function(e,t,i){var a,n,o;null===(n=null===(a=this._listeners[e])||void 0===a?void 0:a.onAdDisplayFailed)||void 0===n||n.call(a,JSON.parse(t),JSON.parse(i)),null===(o=this._waitingTask)||void 0===o||o.resolve()},e.prototype.onUserRewarded=function(e,t,i){var a,n;this._getRewarded=!0,this._rewarded=!0,null===(n=null===(a=this._listeners[e])||void 0===a?void 0:a.onUserRewarded)||void 0===n||n.call(a,JSON.parse(t),JSON.parse(i))},e.prototype.onRewardedVideoStarted=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onRewardedVideoStarted)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.onRewardedVideoCompleted=function(e,t){var i,a;null===(a=null===(i=this._listeners[e])||void 0===i?void 0:i.onRewardedVideoCompleted)||void 0===a||a.call(i,JSON.parse(t))},e.prototype.PayResult=function(){setTimeout(function(){e.instance.onPayCallback(0,VIDEO_FREE)},100)},e.prototype.QuerySkuDetailsResult=function(e,t){this._productIdInfo=t},Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e._instance=void 0,e}();i.MAX=o,window.MAX=o,cc._RF.pop()},{"../promise/PromiseExt":"PromiseExt","./MAXImplement":"MAXImplement"}],MailListMenu:[function(e,t){"use strict";cc._RF.push(t,"08578NJoUVI+oxvVXsBHVuY","MailListMenu"),cc.Class({extends:e("../core/PopMenu"),properties:{layoutNode:cc.Node,itemNode:cc.Node,itemPrefab:cc.Prefab,emptyNode:cc.Node},initStatus:function(){this.itemList=[],this.itemNode.active=!1,this.initUI()},initUI:function(){var e=this,t=user.mailInfoTable,i=user.mailList,a=[];for(var n in i)t[i[n].id]||a.push(i[n].id);a.length>0?net.post("getMailInfoTable",{ids:a},function(i,n){for(var o in a)t[a[o]]=n.mailTable[a[o]];e.refreshUI()}):this.refreshUI()},refreshUI:function(){var e=this,t=user.mailList;this.emptyNode.active=t.length<=0;var i=function(i){var a=t[i],n=user.mailInfoTable[a.id],o=e.itemList[i];o||(o=cc.instantiate(e.itemNode),e.layoutNode.addChild(o),o.zIndex=i,e.itemList.push(o)),o.active=!0,a.time/1e3+a.exp<0&&(o.active=!1),o.getChildByName("title").getComponent(cc.Label).string=n.title||"- - -",o.getChildByName("exp").getComponent(cc.Label).string=kit.second2hour(a.time/1e3+a.exp)+"\u540e\u8fc7\u671f";var r=a.status>=2;o.getChildByName("bg0").active=!r,o.getChildByName("bg2").active=r;var s=o.getChildByName("head");s.opacity=r?50:255,cc.resources.load("ui/hero/head/"+(n.head||"h2"),cc.SpriteFrame,function(e,t){s.getComponent(cc.Sprite).spriteFrame=t});var c=o.getChildByName("layout"),l=n.items;if(!r&&l&&l.length>0){if(c.true=!1,!o.itemNodes)for(var d in c.destroyAllChildren(),o.itemNodes=[],l){var h=cc.instantiate(e.itemPrefab);c.addChild(h),h.getComponent("Item").init(l[d]),o.itemNodes.push(h)}}else c.active=!1;o.onTouch=function(){menuManager.pop("mail",{mail:a,closeCb:function(){e.refreshUI()}})}};for(var a in t)i(a)}}),cc._RF.pop()},{"../core/PopMenu":"PopMenu"}],MailMenu:[function(e,t){"use strict";cc._RF.push(t,"d8af7UhiK1MIb+btnFRR0B1","MailMenu");var i=e("../../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../core/PopMenu"),properties:{itemPrefab:cc.Prefab,layoutNode:cc.Node,titleLabel:cc.Label,authorLabel:cc.Label,msgText:cc.RichText,lootBtnNode:cc.Node,readBtnNode:cc.Node,headSprite:cc.Sprite},initStatus:function(e){this.msgText.onLink=function(e,t){cc.log("link",e,t),cc.sys.openURL(t)},this.mail=e.mail,this.initUI()},initUI:function(){var e=this,t=this.mail.id,i=user.mailInfoTable[t];i.full?this.refreshUI():net.post("getMail",{id:t},function(t,a){i.title=a.mail.title,i.author=a.mail.author,i.text=a.mail.text,i.full=!0,e.refreshUI()})},refreshUI:function(){var e=this,t=this.mail.id,i=user.mailInfoTable[t];this.titleLabel.string=i.title,this.authorLabel.string=i.author,this.msgText.string=i.text,cc.resources.load("ui/hero/head/"+(i.head||"h2"),cc.SpriteFrame,function(t,i){e.headSprite.spriteFrame=i});var a=i.items,n=!a||a.length<=0,o=this.mail.status>=2,r=this.layoutNode;if(r.active=!n,!n)for(var s in r.destroyAllChildren(),a){var c=cc.instantiate(this.itemPrefab);r.addChild(c),c.getComponent("Item").init(a[s]),c.getComponent("Item").setGray(o)}this.readBtnNode.active=o||n,this.lootBtnNode.active=!o&&!n},onLoot:function(){var e=this,t=this.mail.id,a=user.mailInfoTable[t].items;net.updateData({mail:{id:t,status:2},items:a},function(t,n){i.FirebaseTracking.setDataBiRes("MailMenu"),money.update(n),e.mail.status=2,e.refreshUI(),menuManager.pop("show",{items:a,tid:"mail",checkCb:function(){}})})}}),cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../core/PopMenu":"PopMenu"}],MainMenu:[function(e,t){"use strict";cc._RF.push(t,"b7bb14dt6ZMS5gA63cjcGvQ","MainMenu");var i,a=e("../../../Plugins/firebase/FirebaseTracking"),n=2,o=0,r=e("../../utils/network/ApiClient"),s=e("../../utils/network/ApiEndpoints");cc.Class(((i={extends:e("../core/Menu"),properties:{pageList:[cc.Node],pageIndexNode:cc.Node,pageBtnList:[cc.Node],rightFeatList:[cc.Node],topFeatList:[cc.Node],levelProgressionTrack:cc.Label,processProgressionTrack:cc.Sprite,btnLeaderBoard:cc.Button},onTest:function(){cc.log("onTest")},onLoad:function(){this._super(),this.pageList.forEach(function(e){e.active=!1}),this.pageIndex=n,this.pageIndexNode.x=o;var e=DEV_MODE&&DEBUG_MODE;e||pc.isChapterDone(3)||this._lockPageButton(this.pageBtnList[1]),e||pc.isChapterDone(4)||this._lockPageButton(this.pageBtnList[0]),cc.game.on("equipment_exp_change",this.checkEquipmentRedpoint,this),cc.game.on("UpdateExpProgression",this.updateLevelProgessionTrack.bind(this),this),cc.game.on("check_claim_reward",this.activeNotification.bind(this),this),cc.game.on("hasUnclaimed",this.updateRedPointLeaderBoard.bind(this),this),pc.getInforProgressisonTrack(),this.activeNotification(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},onDestroy:function(){cc.game.off("hasUnclaimed",this.updateRedPointLeaderBoard.bind(this))},_lockPageButton:function(e){e.notOpen=!0,this.setGray(e.getChildByName("icon"),!0),e.getChildByName("name").active=!1},updateLevelProgessionTrack:function(e){this.processProgressionTrack.fillRange=e.currentProcess,this.levelProgressionTrack.string=e.currentLevel},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY:console.log("KEY.back==============================================")}}}).onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this)},i.checkEquipmentRedpoint=function(){cc.log("checkEquipmentRedpoint",this.pageList);var e=this.pageList[3].getComponent("Menu").updateRedPoint(),t=this.pageBtnList[3].getChildByName("rp");t.active=e>0,t.getChildByName("num").getComponent(cc.Label).string=e},i.onEnable=function(){this.updateRedPointLeaderBoard(null)},i.start=function(){if(this.args.pop&&menuManager.pop(this.args.pop),cc.sys.platform===cc.sys.BYTEDANCE_GAME){var e=tt.getLaunchOptionsSync(),t=e.query||{};console.log("main menu start",e,t),t.feed_game_scene&&tt.reportScene({sceneId:7001})}},i.initStatus=function(e){if(menuManager.setDefault(),e.hot){var t=e.hot;delete e.hot;var i=["pilot","garage","map","equipment","shop"].indexOf(t);i>=0&&(this.pageIndex=i,this.pageIndexNode.x=this.pageBtnList[i].x)}var a=this.pageList[this.pageIndex];if(a.x=0,this.showPage(a),this.pageList[2].getComponent("Menu").prepareChapterIndex);else if(this.updateGuide());else if(chapter.canRecall())chapter.recall();else if(cc.sys.platform===cc.sys.BYTEDANCE_GAME&&!window.giftPopped&&!user.getGuide("giftCode_dy777")){var n=tt.getLaunchOptionsSync().scene;console.log("MainMenu initStatus tt launch from scene",n),"023040"!=n&&"103040"!=n||(menuManager.pop("gift_code",{code:"dy777"}),window.giftPopped=!0)}},i.activeNotification=function(){console.log("activeNotification",pc.isChapterDone(1)),pc.isChapterDone(1)&&(console.log("updateRedPoint",pc.updateRedPointSign(),pc.updateRedPointProgress()),this.rightFeatList[2].getChildByName("rp").active=pc.updateRedPointSign(),this.topFeatList[1].getChildByName("rp").active=pc.updateRedPointProgress(),this.updateRedPointLeaderBoard(null))},i.updateRedPointLeaderBoard=function(e){if(console.log("updateRedPointLeaderBoard",e),e)this.btnLeaderBoard.node.getChildByName("rp").active=e.status;else if(window.activeLeaderBoard){var t=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid");if(t){var i=["bullet_fly","shoot_target","make_choice"],a=i.length,n=!1;i.forEach(function(e){var i={player_id:t,category:e};r.get(s.weeklyRewards.checkUnclaimed,i,function(t,i){a--,t?console.error("[LeaderBoard] Error checking unclaimed rewards for "+e+":",t):(console.log("[LeaderBoard] Unclaimed check response for "+e+":",i),i&&!0===i.has_unclaimed&&(n=!0)),0===a&&cc.game.emit("hasUnclaimed",{status:n})})})}else console.log("[LeaderBoard] Player ID not available for reward check")}else console.log("[MainMenu] Leaderboard disabled (activeLeaderBoard = false), skipping weekly rewards check")},i.setButtonEnabled=function(e,t){e.getComponent(cc.Button).interactable=t;var i=e.getChildByName("icon");this.setGray(i,!t);var a=cc.color(255,255,255);i.color=a,e.getChildByName("name").color=a},i.updateGuide=function(){if(cc.log("updateGuide"),cc.log(this.pageIndex,"pageIndex"),DEV_MODE&&DEBUG_MODE)return!1;if(cc.Canvas.instance.node.focusNode)return!1;if(pc.isChapterDone(1)||this.disableIncompleteFeatures(),!pc.isChapterDone(2)){var e=this.rightFeatList[2];e.notOpen=!0,this.setGray(e.getChildByName("icon"),!0)}return!!(this.guideEquipmentSlot()||this.guideHeroRecruitment()||this.guideUnlockMiniGame()||this.guideHeroAttribute()||this.guideGara()||this.guideCrew()||this.guideHeroRefresh()||this.guideTalent()||this.guideFreeAds()||this.guideChapter())},i.disableIncompleteFeatures=function(){var e=this.topFeatList[1];e.notOpen=!0;var t=e.getChildByName("process_level");this.setGray(e.getChildByName("icon"),!0),this.setGray(t,!0),this.setGray(t.getChildByName("bar"),!0)},i.guideEquipmentSlot=function(){var e=this,t=equipment.get("current");return!(((null==t?void 0:t.length)||0)>=equipment.get("slotCt")||user.getGuide("equipmentSlot7")||7!=equipment.get("slotCt")||(3!=this.pageIndex&&(e.guideProgessionTrack(),3==user.getGuide("progressionTrack")&&(TJ.onGuideEvent({guide_id:40,guide_name:"\u5929\u8d4b"}),menuManager.focusOn(e.pageList[2].getComponent("Menu").btnClaimAllRewardChapter.node,null,function(){user.setGuide("progressionTrack",4),user.quickSave("guide.progressionTrack",4),cc.game.once("start_tutorial_equipment_slot",e.guideEquipmentSlot2.bind(e))}))),0))},i.guideEquipmentSlot2=function(){user.setGuide("progressionTrack",5);var e=this;menuManager.focusOn(e.pageBtnList[3],LI("zc_guide_16"),function(){var t=e.pageList[3].getComponent("Menu");TJ.onGuideEvent({guide_id:41,guide_name:"\u5929\u8d4b-\u8df3\u8f6c"});var i=t.unlockedLayoutNode.children[0];t.scrollNode.getComponent(cc.ScrollView).vertical=!1,i?menuManager.focusOn(i,LI("zc_guide_17"),function(){TJ.onGuideEvent({guide_id:42,guide_name:"\u5929\u8d4b-\u9009\u62e9"});var n=i.getComponent("EquipmentPageItem").expandBoard.getChildByName("\u79fb\u9664");menuManager.focusOn(n,"",function(){a.FirebaseTracking.logNewTutorial({Step:13,userID:user.uuid,Status:1}),t.scrollNode.getComponent(cc.ScrollView).vertical=!0,user.setGuide("equipmentSlot"+equipment.get("slotCt"),1),7==equipment.get("slotCt")&&(YMTJ("guide","guide017"),e.pageList[2].getComponent("Menu").sideBarPop=!0),menuManager.focusOn(e.pageList[3].getComponent("Menu").currentBgLayoutNode,"Upgrade gear and become battle-ready!",3,function(){},null,{dy:-50,noFinger:!0})})},null,null,{head:"h99"}):menuManager.focusOn(e.pageBtnList[2],null,function(){user.setGuide("progressionTrack",void 0),e.guideProgessionTrack()},null,null,{dx:-100})},null,null,{dx:-100})},i.guideHeroRecruitment=function(){if(this.pageBtnList[0].notOpen||pc.getHero("h2")||user.getGuide("hero")&&1!=user.getGuide("hero"))return!1;if(user.getGuide("hero")||user.setGuide("hero",1),0!=this.pageIndex)menuManager.focusOn(this.pageBtnList[0],LI("zc_guide_18"),function(){YMTJ("guide","guide018")},null,null,{dx:-110});else{var e=this.pageList[0].getComponent("Menu");menuManager.focusOn(e.recruitHeroBtn,LI("zc_guide_19"),function(){YMTJ("guide","guide019")},null,null,{dx:-110,dy:-150})}return!0},i.guide7Dlogin=function(){if(console.log("guide7Dlogin"),!pc.isChapterDone(2))return!1;var e=this;return 1==user.getGuide("unlockMiniGame")&&menuManager.focusOn(e.pageList[2].getComponent("MapPage").signNode,"",null,function(){user.getGuide("Dailylogin")||2!=e.pageIndex||2!=user.getGuide("chapter")||menuManager.focusOn(e.rightFeatList[2],null,null,function(){a.FirebaseTracking.LogCustomEvent("ButtonClick",{Status:1,cohort_day:user.countLoginDay,claim_time:Utils.getCurrentUTCTimestamp()})},null,null)},null,{dx:-100}),!0},i.guideUnlockMiniGame=function(){if(console.log("guideUnlockMiniGame",user.getGuide("unlockMiniGame")),null!=user.getGuide("unlockMiniGame")||!pc.isChapterDone(2))return!1;var e=this,t=this.pageList[2].getComponent("Menu").sideBoards[0];return this.pageList[2].getComponent("Menu").sideBoards[0],menuManager.focusOn(t,LI("zc_guide_mini_game"),3,function(){user.setGuide("unlockMiniGame",1),user.quickSave("guide.unlockMiniGame",1),e.guide7Dlogin()},null,{dx:-100,dy:-100,noTouch:!0,noFinger:!0}),!0},i.guideHeroAttribute=function(){if(this.pageBtnList[0].notOpen||2!=user.getGuide("hero")||!pc.getHero("h2"))return!1;if(0!=this.pageIndex)menuManager.focusOn(this.pageBtnList[0],"\u73b0\u5728\u4e58\u5458\u53ef\u4ee5\u83b7\u5f97\u5c5e\u6027\u4e86\uff01",function(){},null,null,{dx:-110});else{var e=this.pageList[0].getComponent("Menu");e.bottomScroll.vertical=!1,menuManager.focusOn(e.heroTable.h2,LI("zc_guide_21"),function(){e.bottomScroll.vertical=!0,YMTJ("guide","guide021"),menuManager.focusOn(e.heroStatRefreshBtnNode,LI("zc_guide_22"),function(){menuManager.chatOn(null,LI("zc_guide_23"),2,{dx:-100,dy:-150}),YMTJ("guide","guide022"),YMTJ("guide","guide023")},null,null,{dx:-120,dy:250})},null,null,{dx:-100,dy:150})}return!0},i.guideGara=function(){return!(this.pageBtnList[1].notOpen||2!=this.pageIndex||user.getGuide("guideGara")||!pc.isChapterDone(3))&&(console.log("guideGara"),menuManager.focusOn(this.pageBtnList[1],LI("zc_guide_40"),null,function(){user.setGuide("guideGara",1),user.quickSave("guide.guideGara",1),YMTJ("guide","guide030")},null,{dx:-50,dy:-300}),!0)},i.guideCrew=function(){},i.guideHeroRefresh=function(){if(this.pageBtnList[0].notOpen||!pc.getHero("h2")||3!=user.getGuide("hero")||!money.had(HERO_REFRESH_TICKET,1))return!1;if(0!=this.pageIndex);else{if(3!=user.getGuide("hero"))return;var e=this.pageList[0].getComponent("Menu");e.bottomScroll.vertical=!1,menuManager.focusOn(e.heroTable.h2,LI("zc_guide_25"),function(){e.bottomScroll.vertical=!0,menuManager.focusOn(e.heroStatCards[0].getChildByName("lock"),LI("zc_guide_26"),function(){user.setGuide("hero",4),user.quickSave("guide.hero",4),menuManager.chatOn(null,LI("zc_guide_27"),2,{dx:-120,dy:-150})},null,null,{dx:-120,dy:250})},null,null,{dx:-120,dy:150})}return!0},i.guideTalent=function(){var e=this;if(1!=user.getGuide("chapter")||user.getGuide("talent"))return!1;if(3!=this.pageIndex)TJ.onGuideEvent({guide_id:40,guide_name:"\u5929\u8d4b"}),menuManager.focusOn(this.pageBtnList[3],LI("zc_guide_13"),function(){YMTJ("guide","guide013")},null,null,{});else{var t=this.pageList[3].getComponent("Menu");TJ.onGuideEvent({guide_id:41,guide_name:"\u5929\u8d4b-\u8df3\u8f6c"});var i=t.currentLayoutNode.children[0];menuManager.focusOn(i,LI("zc_guide_14"),function(){TJ.onGuideEvent({guide_id:42,guide_name:"\u5929\u8d4b-\u9009\u62e9"});var t=i.getComponent("EquipmentPageItem").expandBoard.getChildByName("info");menuManager.focusOn(t,"",function(){i.getComponent("EquipmentPageItem").isGuilding=!0,TJ.onGuideEvent({guide_id:43,guide_name:"\u5929\u8d4b-\u70b9\u51fb"}),e.pageList[2].getComponent("Menu").sideBarPop=!0})},null,null,{head:"h99"})}return!0},i.guideFreeAds=function(){return 0==(user.getGuide("freeAds")||0)&&(2==this.pageIndex&&1==user.getGuide("chapter")&&(TJ.onGuideEvent({guide_id:40,guide_name:"freeAds"}),menuManager.focusOn(this.rightFeatList[1],null,function(){a.FirebaseTracking.logNewTutorial({Step:7,userID:user.uuid,Status:1})},null,null,{})),!0)},i.guideChapter=function(){return!user.getGuide("chapter")&&(pc.isChapterDone(0)?(user.setGuide("chapter",1),this.updateGuide()):ballMode.redirectToGuide&&(ballMode.redirectToGuide=!1,this.updateGuideChapterIndex(0)),!0)},i.guideProgessionTrack=function(){null==user.getGuide("progressionTrack")&&2==user.getGuide("chapter")&&null==user.getGuide("Dailylogin")&&menuManager.focusOn(this.topFeatList[1],null,null,function(){user.setGuide("progressionTrack",1)},null,null)},i.guideStartGameLobby=function(){if(1==user.getGuide("chapter")&&1==user.getGuide("freeAds")&&1==user.getGuide("onlineBox")&&2==this.pageIndex){var e=this.pageList[2].getComponent("Menu").startButtonNode;menuManager.focusOn(e,null,null,function(){a.FirebaseTracking.logNewTutorial({Step:8,userID:user.uuid,Status:1}),user.setGuide("freeAds",2),user.quickSave("guide.freeAds",2)},null,{noFinger:0,z:998})}},i.guideStartGame=function(){var e=this;menuManager.focusOn(this.pageBtnList[2],LI("zc_guide_6"),function(){e.pageList[2].getComponent("Menu")})},i.updateGuideChapterIndex=function(e){var t=this;this.guideChapterIndex=e;var i=this.pageList[2].getComponent("Menu");if(cc.log("updateGuideChapterIndex",e,i.chapterIndex),i.chapterPageView.touchScrollEnabled=!1,e>i.chapterIndex)menuManager.focusOn(i.rightButtonNode,"\u70b9\u8fd9\u91cc\u5207\u6362\u4e0b\u4e00\u7ae0",function(){},null,null,{fade:.5,fadeCb:function(){t.updateGuide()}});else if(e<i.chapterIndex)2==e&&i.chapterIndex-1==e?menuManager.focusOn(i.leftButtonNode,"",function(){},null,null,{fade:.5,fadeCb:function(){t.updateGuide()}}):menuManager.focusOn(i.leftButtonNode,"\u70b9\u8fd9\u91cc\u5207\u6362\u4e0a\u4e00\u7ae0",function(){},null,null,{fade:.5,fadeCb:function(){t.updateGuide()}});else if(0==e)menuManager.focusOn(i.startButtonNode,"\u54ce\u5440\uff01\u5931\u8d25\u4e86~\n\u6765\u8fd9\u91cc\u953b\u70bc\u4e00\u4e0b\u5427\uff01",function(){});else if(1==e)TJ.onGuideEvent({guide_id:44,guide_name:"\u7b2c\u4e8c\u7ae0"}),menuManager.focusOn(i.startButtonNode,"\u597d\u4e86\uff0c\u524d\u8fdb\uff01\n\u6218\u8f66\uff01",function(){TJ.onGuideEvent({guide_id:45,guide_name:"\u7b2c\u4e8c\u7ae0-\u70b9\u51fb"})});else if(2==e){var a=i.chapterPageView.getPages()[2].getChildByName("sweep");menuManager.focusOn(a,"",function(){i.chapterPageView.touchScrollEnabled=!0})}},i.onMenuReappear=function(){cc.log("onMenuReappear"),this.updateGuide(),this.page.getComponent("Menu").updateRedPoint(),this.guideStartGameLobby()},i.onSelectPage=function(e,t){var i=this;if(cc.log("onSelectPage",e,t),1==t&&this.pageBtnList[0].notOpen)kit.info(LI("chapter_unlock_5"));else if(2==t&&this.pageBtnList[1].notOpen)kit.info(LI("chapter_unlock_4"));else{var a=+t-1,r=this.pageList[a];if(r&&a!=this.pageIndex){var s=this.pageList[this.pageIndex],c=720*(this.pageIndex>a?1:-1);this.prePageTween&&this.prePageTween.stop(),this.pageTween&&this.pageTween.stop(),this.prePage&&(this.prePage.active=!1),this.prePage=s,cc.winSize.height<1280&&(c=c/cc.winSize.height*1280),this.prePageTween=cc.tween(s).to(.3,{x:c},{easing:"cubicInOut",t:1}).call(function(){i.prePage.active=!1,i.prePage=null,i.prePageTween=null}).start(),this.pageIndex=a,n=a,this.showPage(r),r.x=-c,this.pageTween=cc.tween(r).to(.3,{x:0},{easing:"cubicInOut",t:1}).call(function(){i.updateGuide(),i.pageTween=null;var e=r.getComponent("Menu").topVisible;e&&i.showTopBar({visible:e})}).start(),cc.tween(this.pageIndexNode).to(.3,{x:e.target.x},{easing:"cubicInOut",t:1}).start(),o=e.target.x}}},i.showPage=function(e){for(var t in this.page=e,e.active=!0,e.getComponent("Menu").initStatus({}),this.pageList){var i=this.pageList[t],a=this.pageBtnList[t].getChildByName("rp"),n=i.getComponent("Menu").updateRedPoint();i!=e?(a.active=n>0,a.getChildByName("num").getComponent(cc.Label).string=n):a.active=!1}equipment.checkSave()},i.onEditMode=function(){cc.assetManager.loadBundle("editor",function(e){e||menuManager.runReal("editor/test",null,!0)})},i.callPopFeedback=function(){menuManager.pop("feedback",{zIndex:99999})},i.callPopMenu=function(e,t){"progression_track"==t&&this.topFeatList[1].notOpen?kit.info(LI("chapter_unlock_2")):"sign"==t&&this.rightFeatList[2].notOpen?kit.info(LI("chapter_unlock_3")):menuManager.pop(t)},i.callPhysicsMode=function(){if(!H5VERSION&&!DEV_MODE){if(!pc.isChapterOpened(3))return kit.info(LI("chapter_unlock_3"));if(!user.checkOnlineTimeCD("physicsMode",18e5))return void kit.info(LI("cd"))}ballMode.start(),user.setOnlineTimer("physicsMode"),sdk.setAdjustEvent("bhnfmv",""),a.FirebaseTracking.gameMode="Minigame",window.TaskManager&&window.TaskManager.completeTask("task_8"),console.log("========= set game mode ccc ")},i.callGunnerMode=function(){H5VERSION||DEV_MODE||user.checkOnlineTimeCD("gunnerMode",18e5)?(gunnerMode.start(),user.setOnlineTimer("gunnerMode")):kit.info(LI("cd")),sdk.setAdjustEvent("2gr7z3",""),a.FirebaseTracking.gameMode="Minigame",window.TaskManager&&window.TaskManager.completeTask("task_8"),console.log("========= set game mode bbb ")},i.callGunnerMode2=function(){H5VERSION||DEV_MODE||user.checkOnlineTimeCD("gunnerMode2",18e5)?(gunnerMode.start({chapterIndex:2}),user.setOnlineTimer("gunnerMode2")):kit.info(LI("cd")),window.TaskManager&&window.TaskManager.completeTask("task_8"),sdk.setAdjustEvent("11h5mw",""),a.FirebaseTracking.gameMode="Minigame",console.log("========= set game mode aaa ")},i.callOnlineBox=function(){var e=this;user.checkOnlineTimeCD("onlineBox",18e5)&&user.setGuide("onlineBox",0);var t=user.getGuide("onlineBox")||0;if(t>1)kit.info(LI("cd"));else{var i=0==t;sdk.useFree("onlinebox",function(n){if(!n){var o=[{i:EQUIPMENT,rarity:2,n:2},{i:EQUIPMENT,rarity:1,n:5},{i:DIAMOND,n:10}],r=[],s=user.getGuide("freeAds")||0;if(window.TaskManager&&window.TaskManager.updateProgress("task_9",1),0==s)o.push({i:SWEEP_TICKET,n:10}),user.setGuide("freeAds",1),user.quickSave("guide.freeAds",1);else{var c=Utils.getWeightedRandomTicket();o.push({i:SWEEP_TICKET,n:c})}a.FirebaseTracking.LogCustomEvent("ButtonClick",{Status:1,cohort_day:user.countLoginDay,claim_time:Utils.getCurrentUTCTimestamp()}),equipment.getItemFromReward(r,o),user.setGuide("onlineBox",+t+1),i&&user.setOnlineTimer("onlineBox"),net.updateData({items:r},function(t,n){cc.Canvas.instance.node.focusNode=null,e.updateGuide(),a.FirebaseTracking.setDataBiRes("OnlineBox"),money.update(n),menuManager.pop("box",{items:r,tid:"onlineBox",checkCb:function(){var e=user.feedSubscribeId;cc.sys.platform===cc.sys.BYTEDANCE_GAME&&tt.checkFeedSubscribeStatus&&tt.requestFeedSubscribe&&i&&e&&tt.checkFeedSubscribeStatus({type:"play",scene:1,success:function(t){console.log("checkFeedSubscribeStatus success",t),t.status||tt.requestFeedSubscribe({type:"play",scene:1,contentIDs:[e],success:function(e){console.log("requestFeedSubscribe success",e),e.success&&kit.info(LI("subscribe_msg"))},fail:function(e){console.log("requestFeedSubscribe fail",e)}})},fail:function(e){console.log("checkFeedSubscribeStatus fail",e)}})}})}),i||YMTJ("video","onlinebox")}},i)}},i)),cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../utils/network/ApiClient":"ApiClient","../../utils/network/ApiEndpoints":"ApiEndpoints","../core/Menu":"Menu"}],MapDifficultyBoard:[function(e,t){"use strict";cc._RF.push(t,"5de80mBh/pHu6Jw6u9ucmea","MapDifficultyBoard");var i=e("../../Plugins/firebase/FirebaseTracking");e("../data/constants/GameConstants"),cc.Class({extends:cc.Component,properties:{titleLabelNode:cc.Node,rewardBoxNode:cc.Node,affixInstance:cc.Node,affixNode:cc.Node,affixBg:cc.Node},initStatus:function(e){cc.warn("MapDifficultyBoard initStatus",e),this.mapPage=e.mapPage,this.chooseMode=e.choose,this.displayDifficulty=e.display_difficulty,this.setDifficulty(e.difficulty)},onChooseDifficulty:function(){if(this.chooseMode){var e=this.getDifficultyTarget(),t=e-1;pc.isChapterOpened(e-1)||(t=adventure.stageToChapter(pc.stageIndex)),this.mapPage.chapterPageView.scrollToPage(t,.5),menuManager.close(),cc.warn("MapDifficultyBoard onChooseDifficulty",this.difficulty,t)}},setDifficulty:function(e){void 0===e&&(e=1),cc.warn("MapDifficultyBoard setDifficulty",e),this.difficulty=e,this.displayDifficulty||(this.displayDifficulty=e),this.updateDifficulty()},updateDifficulty:function(){cc.warn("MapDifficultyBoard updateDifficulty",this.displayDifficulty),this.titleLabelNode.getComponent(cc.Label).string=LI("loop_n",{n:this.displayDifficulty}),this.updateDifficultyRewardBox(),this.updateAffix()},updateAffix:function(){var e,t=this;if(this.chooseMode)this.affixBg.active=!1;else{var i;i=null==(e=DifficultyDefine[this.difficulty])?void 0:e.affix;var a=this.affixNode.getChildren();if(a)for(var n in a)a[n].destroy();if(i){this.affixBg.active=!0;var o=function(){(r=cc.instantiate(t.affixInstance)).active=!0;var e=r.getChildByName("sp").addComponent(cc.Sprite);s=DifficultyAffixDefine[i[n]],r.define=s,cc.resources.load(s.content,cc.SpriteFrame,function(t,i){e.spriteFrame=i}),t.affixNode.addChild(r)};for(var n in i){var r,s;o()}}else this.affixBg.active=!1}},popAffixInfo:function(e){var t=e.target.define;kit.info(t.des,null,2,300)},getDifficultyTarget:function(){var e=this.difficulty;return 6*Math.floor((e+1)/2)+1},updateDifficultyRewardBox:function(){var e=this.difficulty,t=this.getDifficultyTarget(),i=pc.getDifficultyBoxOpen(e),a=pc.isChapterDone(t-1)&&!i;cc.log("updateDifficultyRewardBox",e,t,i,a),this.rewardBoxNode,this.rewardBoxNode.getChildByName("box_close").active=!i,this.rewardBoxNode.getChildByName("box_open").active=i,this.rewardBoxNode.getChildByName("box_close").stopAllActions(),this.rewardBoxNode.getChildByName("box_close").angle=0,this.rewardBoxNode.isAvailable=a,this.rewardBoxNode.getChildByName("rp").active=a,a&&this.rewardBoxNode.getChildByName("box_close").runAction(cc.sequence(cc.sequence(cc.rotateTo(.05,5),cc.rotateTo(.05,-5)).repeat(4),cc.rotateTo(.05,0),cc.delayTime(1)).repeatForever())},openRewardBox:function(e){var t,a,n,o=this,r=e.target;if(n=null==(t=DifficultyDefine[1])?void 0:t.rewardBox)if(cc.log("MapDifficultyBoard openRewardBox"),r.isAvailable){n||kit.info("\u6ca1\u6709\u7ae0\u8282\u5bf9\u5e94\u5956\u52b1");var s=[];equipment.getItemFromReward(s,n),cc.log("openRewardBox",s,n),equipment.save(),net.updateData({items:s,set:(a={},a["difficultyBoxOpen."+this.difficulty]=1,a)},function(e,t){i.FirebaseTracking.setDataBiRes("MapDifficult"),money.update(t),pc.setDifficultyBoxOpen(o.difficulty),o.updateDifficultyRewardBox(),o.mapPage.updateRedPoint(),o.mapPage.updateDifficultyInfo(),menuManager.pop("loot",{items:s,tid:"\u96be\u5ea6\u5b9d\u7bb1",tname:"\u96be\u5ea6\u5b9d\u7bb1",lootCb:function(){}})})}else this.chooseMode||(this.mapPage.rewardBoxInfoNode.parent==r?this.mapPage.rewardBoxInfoNode.active=!this.mapPage.rewardBoxInfoNode.active:(this.mapPage.rewardBoxInfoNode.parent=r,this.mapPage.rewardBoxInfoNode.active=!0,cc.log("openRewardBox init info")),this.mapPage.rewardBoxInfoNode.active&&(this.mapPage.rewardBoxInfoNode.getComponent("ChapterBoxRewardInfo").init(n),this.mapPage.rewardBoxInfoNode.getChildByName("arrow").angle=180,this.mapPage.rewardBoxInfoNode.getChildByName("arrow").y=56.5,this.mapPage.rewardBoxInfoNode.y=-110))},popMapDifficultyBoard:function(){this.chooseMode?this.onChooseDifficulty():menuManager.pop("difficulty_select",{mapPage:this.mapPage})}}),window.DifficultyDefine={1:{rewardBox:[{i:DIAMOND,n:300},{i:HERO_REFRESH_TICKET,n:3},{i:RECRUIT_TICKET,n:1}]},2:{affix:["atk20"],rewardBox:[{i:EXP,n:100},{i:RECRUIT_TICKET,n:1},{i:HERO_REFRESH_TICKET,n:1}]},3:{affix:["atk20"],rewardBox:[{i:EXP,n:100},{i:RECRUIT_TICKET,n:1},{i:HERO_REFRESH_TICKET,n:1}]},4:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},5:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},6:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},7:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},8:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},9:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},10:{affix:["atk20"],rewardBox:[{i:EXP,n:100}]},11:{affix:["atk20","hp20"],rewardBox:[{i:DIAMOND,n:300},{i:HERO_REFRESH_TICKET,n:3},{i:RECRUIT_TICKET,n:1}]},12:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100},{i:RECRUIT_TICKET,n:1},{i:HERO_REFRESH_TICKET,n:1}]},13:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100},{i:RECRUIT_TICKET,n:1},{i:HERO_REFRESH_TICKET,n:1}]},14:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},15:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},16:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},17:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},18:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},19:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]},20:{affix:["atk20","hp20"],rewardBox:[{i:EXP,n:100}]}},cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../data/constants/GameConstants":"GameConstants"}],MapDifficultySelect:[function(e,t){"use strict";cc._RF.push(t,"ce2e6DkHkJAGI4mz21KvKHv","MapDifficultySelect"),e("../data/constants/GameConstants"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{difficultyBoardInstance:cc.Node,layoutNode:cc.Node,scrollViewNode:cc.Node},initStatus:function(e){var t=adventure.stageToChapter(pc.stageIndex),i=this.getDifficulty(t);cc.log("MapDifficultySelect stageIndex",pc.stageIndex,"leng ",i,t),t>=window.CHAPTER_DEFINE_ARRAY.length&&(i-=1);for(var a=(i+1)/2,n=1;n<=a;n++){console.log(111111111);var o=cc.instantiate(this.difficultyBoardInstance);o.active=!0;var r=n,s=2*(n-1)+1;o.getComponent("MapDifficultyBoard").initStatus({difficulty:s,choose:1,display_difficulty:r,mapPage:e.mapPage}),this.layoutNode.addChild(o)}},getDifficulty:function(e){return e<=0?1:2*Math.floor((e-1)/6)+1}}),cc._RF.pop()},{"../data/constants/GameConstants":"GameConstants","../ui/core/PopMenu":"PopMenu"}],MapPage:[function(e,t){"use strict";cc._RF.push(t,"d336e8gQaJGBY6Y5YhI1QxK","MapPage");var i=e("../../Plugins/firebase/FirebaseTracking"),a=e("../utils/AnimUtils"),n=null,o=null;window.initDesktopIcon=function(e,t){if(void 0===t&&(t=!1),e.active=!1,user.checkOnlineTimeNextDay("desktop")&&user.setGuide("desktop",0),!user.getGuide("desktop")){var a=function(){if(e.active=!1,user.setGuide("desktop",1),user.setOnlineTimer("desktop",!0),!t){var a=[{i:DIAMOND,n:100}];net.updateData({items:a},function(e,t){i.FirebaseTracking.setDataBiRes("MapPage1"),money.update(t),kit.info("\u6dfb\u52a0\u5230\u684c\u9762\u6210\u529f",function(){menuManager.pop("show",{items:a})})})}};if(cc.sys.platform===cc.sys.BYTEDANCE_GAME&&tt.addShortcut||cc.sys.platform===cc.sys.OPPO_GAME&&qg.installShortcut){e.active=!0,e.scale=1,e.stopAllActions(),e.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever());var n=function(){cc.sys.platform===cc.sys.BYTEDANCE_GAME?tt.checkShortcut({success:function(e){console.log("\u68c0\u67e5\u5feb\u6377\u65b9\u5f0f",e.status),e.status.exist&&a()},fail:function(e){console.log("\u68c0\u67e5\u5feb\u6377\u65b9\u5f0f\u5931\u8d25",e.errMsg)}}):cc.sys.platform===cc.sys.OPPO_GAME&&qg.hasShortcutInstalled({success:function(e){console.log("oppo\u68c0\u67e5\u5feb\u6377\u65b9\u5f0f",e),e&&a()},fail:function(e){console.log("\u68c0\u67e5\u5feb\u6377\u65b9\u5f0f\u5931\u8d25",e)}})};e.onTouch=function(){cc.sys.platform===cc.sys.BYTEDANCE_GAME?tt.addShortcut({success:function(){console.log("\u6dfb\u52a0\u684c\u9762\u6210\u529f"),cc.sys.os===cc.sys.OS_ANDROID&&tt.checkShortcut?n():a()},fail:function(e){console.log("\u6dfb\u52a0\u684c\u9762\u5931\u8d25",e.errMsg),kit.info("\u6dfb\u52a0\u5230\u684c\u9762\u5931\u8d25")}}):qg.installShortcut({success:function(){console.log("\u6dfb\u52a0\u684c\u9762\u6210\u529f"),n()},fail:function(e){console.log("\u6dfb\u52a0\u684c\u9762\u5931\u8d25",e),kit.info("\u6dfb\u52a0\u5230\u684c\u9762\u5931\u8d25")}})},cc.sys.platform===cc.sys.BYTEDANCE_GAME&&cc.sys.os===cc.sys.OS_ANDROID&&tt.checkShortcut&&n()}else e.active="tt"===CH,e.scale=1,e.stopAllActions(),e.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever()),e.onTouch=function(){a()}}},window.initSideBarIcon=function(e,t){void 0===t&&(t=!1),e&&(n=e,o||(o=function(e){if(n&&cc.isValid(n)&&!user.getGuide("sideBar")&&"021036"===e.scene){if(console.log("\u6dfb\u52a0\u4fa7\u8fb9\u680f\u6210\u529f"),user.setGuide("sideBar",1),user.setOnlineTimer("sideBar",!0),!t){var a=[{i:DIAMOND,n:100}];net.updateData({items:a},function(e,t){i.FirebaseTracking.setDataBiRes("MapPage_AddSideBar"),money.update(t),kit.info("\u6210\u529f\u4ece\u4fa7\u8fb9\u680f\u8fdb\u5165",function(){menuManager.pop("show",{items:a}),YMTJ("guide","add_sidebar")})})}n.active=!1}},cc.sys.platform===cc.sys.BYTEDANCE_GAME&&tt.onShow(function(e){console.log("top onShow",e),o(e)})),e.active=!1,user.checkOnlineTimeNextDay("sideBar")&&user.setGuide("sideBar",0),user.getGuide("sideBar")||(cc.sys.platform===cc.sys.BYTEDANCE_GAME?tt.checkScene({scene:"sidebar",success:function(i){console.log("check scene success: ",i.isExist),i.isExist&&(e.active=!0,e.scale=1,e.stopAllActions(),e.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever()),e.onTouch=function(){menuManager.pop("side_bar_help",{initCb:function(e,i){i.node.find("board/reward").active=!t},checkCb:function(e){e&&tt.navigateToScene({scene:"sidebar",success:function(){console.log("navigate to scene success")},fail:function(e){console.log("navigate to scene fail: ",e),kit.info("\u8df3\u8f6c\u4fa7\u8fb9\u680f\u5931\u8d25")}})}})},o(tt.getLaunchOptionsSync()))},fail:function(e){console.log("check scene fail:",e)}}):(e.active="tt"===CH,e.scale=1,e.stopAllActions(),e.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever()),e.onTouch=function(){menuManager.pop("side_bar_help",{initCb:function(e,i){i.node.find("board/reward").active=!t},checkCb:function(e){e&&o({scene:"021036"})}})})))},window.TEST_ALL_CHAPTER=!1,cc.Class({extends:e("../ui/core/Menu"),properties:{mapNode:cc.Node,mapPoints:[cc.Node],sideBoards:[cc.Node],chapterPageView:cc.PageView,chapterPageDefault:cc.Node,chapterPageEnd:cc.Node,mapIndexNode:cc.Node,startButtonNode:cc.Node,rightButtonNode:cc.Node,leftButtonNode:cc.Node,avatarNode:cc.Node,pointNode:cc.Node,debugNode:cc.Node,signNode:cc.Node,offlineTaskNode:cc.Node,dailyTaskNode:cc.Node,stageTaskNode:cc.Node,trainNode:cc.Node,mailNode:cc.Node,lzNode:cc.Node,moreGameNode:cc.Node,moreRewardNode:cc.Node,desktopNode:cc.Node,sideBarNode:cc.Node,rewardBoxNoes:[cc.Node],rewardBoxInfoNode:cc.Node,feedBackBtn:cc.Node,difficultyNode:cc.Node,difficultyTargetLabel:cc.Label,difficultyBoardNode:cc.Node,difficultyBoardExpandNode:cc.Node,btnClaimAllRewardChapter:cc.Button},onEnable:function(){this.btnClaimAllRewardChapter&&(this.isClaimingRewards=!1)},onDisable:function(){this.btnClaimAllRewardChapter&&(this.isClaimingRewards=!1)},onLoad:function(){var e;if(this.lzNode.active=window.miniGameCommon&&cc.sys.os===cc.sys.OS_ANDROID&&1!=user.abTestIndex,this.chapterPageView.node.on("scrolling",this.onChapterScrolling,this),this.chapterPageView.touchScrollEnabled=!0,window.DEBUG_MODE&&(this.debugNode.active=DEBUG_MODE),this.btnClaimAllRewardChapter){var t=this.btnClaimAllRewardChapter.clickEvents;t&&t.length>0&&(this.btnClaimAllRewardChapter.clickEvents=[]),this.btnClaimAllRewardChapter.node.off("click");var i=this;this.btnClaimAllRewardChapter.node.on("click",function(){i.onClickClaimAllRewards()},this),this.btnClaimAllRewardChapter.node.active=!1,this.isClaimingRewards=!1}this.chapterPageView._onTouchBegan=function(){this.touchScrollEnabled&&cc.PageView.prototype._onTouchBegan.apply(this,arguments)},this.chapterPageView._onTouchMoved=function(){this.touchScrollEnabled&&cc.PageView.prototype._onTouchMoved.apply(this,arguments)},this.chapterPageView._onTouchEnded=function(){this.touchScrollEnabled&&cc.PageView.prototype._onTouchEnded.apply(this,arguments)},this.chapterPageView._onTouchCancelled=function(){this.touchScrollEnabled&&cc.PageView.prototype._onTouchCancelled.apply(this,arguments)},this.topVisible=((e={})[DIAMOND]=!1,e[ENERGY]=!0,e[SWEEP_TICKET]=!0,e[EXP]=!1,e[GOLD]=!1,e),this.chapterIndex=pc.getChapterIndex(),window._taskNavSkipPopup&&window._taskNavIsMinigameNav?(this.isTaskNavigation=!0,adventure.showMinigameSuggestionAfterNav=!0,window._taskNavSkipPopup=!1,window._taskNavIsMinigameNav=!1):window._taskNavSkipPopup&&window._taskNavIsIdleNav?(this.isTaskNavigation=!0,adventure.showIdleSuggestionAfterNav=!0,window._taskNavSkipPopup=!1,window._taskNavIsIdleNav=!1):window._taskNavSkipPopup&&window._taskNavIsMapNav?(this.isTaskNavigation=!0,adventure.showMapSuggestionAfterNav=!0,window._taskNavSkipPopup=!1,window._taskNavIsMapNav=!1):window._taskNavSkipPopup&&void 0!==window._taskNavPrepareChapterIndex&&null!==window._taskNavPrepareChapterIndex?(this.isTaskNavigation=!0,this.prepareChapterIndex=window._taskNavPrepareChapterIndex,this.chapterIndex=window._taskNavPrepareChapterIndex,adventure.prepareChapterIndex=window._taskNavPrepareChapterIndex,adventure.skipChapterPopup=!0,adventure.skipChapterLock=window._taskNavSkipLock||!0,window._taskNavIsBattleNav&&(adventure.showBattleSuggestionAfterNav=!0,window._taskNavIsBattleNav=!1),window._taskNavIsSweepNav&&(adventure.showSweepSuggestionAfterNav=!0,window._taskNavIsSweepNav=!1),window._taskNavSuppressChapterPopup&&(adventure.suppressChapterPopup=!0),window._taskNavPrepareChapterIndex=null,window._taskNavSkipPopup=!1,window._taskNavSkipLock=!1):window._taskNavSuppressChapterPopup||adventure.suppressChapterPopup?(this.isTaskNavigation=!0,adventure.prepareChapterIndex=null,window._taskNavSuppressChapterPopup=!1,adventure.suppressChapterPopup=!1):(this.isTaskNavigation=!1,void 0!==adventure.prepareChapterIndex&&null!==adventure.prepareChapterIndex&&adventure.prepareChapterIndex<CHAPTER_DEFINE_ARRAY.length&&(this.prepareChapterIndex=adventure.prepareChapterIndex,this.chapterIndex=adventure.prepareChapterIndex-1,adventure.prepareChapterIndex=null)),this.chapterPageView.removeAllPages();var a=pc.getChapterProgress()||CHAPTER_DEFINE_ARRAY.length,n=+a+3;for(var o in n<7&&(n=7),this.showChapter=n,cc.log("maxChapter & showChapter",a+","+n),CHAPTER_DEFINE_ARRAY)if(!(o>n-1)){var r=CHAPTER_DEFINE_ARRAY[o],s=cc.instantiate(this.chapterPageDefault);this.chapterPageView.insertPage(s,o);var c=this.mapPoints[o];this.initPage(r,s,c,o)}n>=CHAPTER_DEFINE_ARRAY.length&&this.chapterPageView.addPage(cc.instantiate(this.chapterPageEnd)),this.chapterPageDefault.active=!1,this.chapterPageEnd.active=!1,this.initLine(),this.feedBackBtn.active=!!user.feedback},updateRedPoint:function(){var e=0,t=this.chapterPageView.getPages(),i=this.chapterIndex,a=0,n=0;for(var o in CHAPTER_DEFINE_ARRAY)if(t[o]){var r=o==adventure.stageToChapter(pc.stageIndex);r&&e++,r&&(o>i?n++:o<i&&a++)}for(var s=1;s<=this.showChapter;s++)for(var c=this.chapterIndex<=0&&[3,4,5]||[4,7,10],l=pc.getChapterStage(s-1),d=pc.isChapterDone(s-1),h=0;h<3;h++){var u=pc.getChapterBoxOpen(s-1,h);(l>c[h]||d)&&!u&&(e++,+i+1<s?n++:+i+1>s&&a++)}var p=adventure.stageToChapter(pc.stageIndex),f=adventure.chapterToDifficulty(p),m=adventure.chapterToDifficulty(pc.chapterIndex),g=0;for(s=1;s<=f;s++)u=pc.getDifficultyBoxOpen(s),pc.isChapterDone(adventure.getDifficultyTarget(s)-1)&&!u&&(e++,s!=m&&g++);return cc.log("MapPage updateRedPoint progress difficulty difficultyRedCt,currentDifficulty",p,f,g,m,pc.chapterIndex),this.difficultyBoardExpandNode.getChildByName("rp").active=g>0,this.leftButtonNode.getChildByName("rp").active=a>0,this.rightButtonNode.getChildByName("rp").active=n>0,e},start:function(){var e=this,t=this.chapterIndex,i=(t+Math.floor((this.getDifficulty()+1)/2)-1)%7;this.chapterPageView._updatePageView(),this.chapterPageView.scrollToPage(t,0);var a=this.mapPoints[i];if(a){this.setMapPos(a.x,a.y),this.mapIndex=i,this.mapIndexTarget=t,this.refreshStartButton(t);var n=this.prepareChapterIndex;null!=n&&(this.prepareChapterIndex=0,this.isTaskNavigation?(adventure.skipChapterPopup=!1,adventure.skipChapterLock=!1,this.isTaskNavigation=!1,e.chapterPageView.scrollToPage(n,1)):menuManager.pop("chapter_new",{chapterIndex:n,noBlock:1,closeCb:function(){e.chapterPageView.scrollToPage(n,1);var t=e.chapterPageView.getPages()[n];t.getChildByName("lock").runAction(cc.sequence(cc.delayTime(1),cc.spawn(cc.scaleBy(.3,2),cc.fadeOut(.3)),cc.callFunc(function(){this.setGray(t.getChildByName("bg"),!1),t.getChildByName("lock").active=!1},e)))}})),initDesktopIcon(this.desktopNode),initSideBarIcon(this.sideBarNode),this.handleTaskNavigationSuggestions(),this.setupDailyTaskNotification()}},initStatus:function(){var e=pc.getChooseVehicle(),t=pc.getVehicleData(e.id);cc.log(e,t);var i=this.avatarNode.getChildByName("vehicle_model").getComponent("VehicleModel");i.init(t,{driver:1,team:pc.getTeam()}),i.play("walk");var a=this.chapterPageView.getPages();for(var n in CHAPTER_DEFINE_ARRAY){var o=a[n];o&&this.initSweep(o,n)}this.updateRewardBox(),this.updateDifficultyInfo(),this.updateIndexName(),this.sideBarPop&&this.sideBarNode&&this.sideBarNode.active&&this.sideBarNode.onTouch&&(this.sideBarNode.onTouch(),this.sideBarPop=!1)},initLine:function(){for(var e=this.mapPoints,t=0;t<e.length-1;t++){for(var i=!this.canRunPageIndex(t+1),a=0,n=this.getPosByLine(t,0),o=this.getPosByLine(t,1),r=30,s=1;s<=1e3;s++){var c=this.getPosByLine(t,s/1e3);if((r+=kit.norm(c.x-n.x,c.y-n.y))>=30){if(kit.norm(c.x-o.x,c.y-o.y)<15)break;r-=30,a++;var l=cc.instantiate(this.pointNode);this.mapNode.addChild(l),l.setPosition(c.x,c.y),l.zIndex=-1,l.scale=a%4==0&&1e3-s>100?1.2:.8,i&&this.setGray(l,!0)}n=c}if(!this.canRunPageIndex(t)){var d=e[t];this.setGray(d.getChildByName("\u6218\u65d7"),!0),this.setGray(d.getChildByName("\u7ae0\u8282\u70b9"),!0)}}this.pointNode.active=!1},getPosByLine:function(e,t){var i=this.mapPoints.length,a=this.mapPoints[e],n=1;t<0&&(t=-t,n=-1);var o=this.mapPoints[(e+n+i)%i],r=this.mapPoints[(e+2*n+i)%i],s=(o.x-(r.x-o.x)+a.x+o.x)/3,c=(o.y-(r.y-o.y)+a.y+o.y)/3,l=this.mapPoints[(e-n+i)%i],d=(a.x-(l.x-a.x)+a.x+o.x)/3,h=(a.y-(l.y-a.y)+a.y+o.y)/3,u=t,p=1-t;return{x:a.x*p*p*p+3*d*u*p*p+3*s*u*u*p+o.x*u*u*u,y:a.y*p*p*p+3*h*u*p*p+3*c*u*u*p+o.y*u*u*u}},initPage:function(e,t,i,a){if(e){if(t){var n=t.getChildByName("bg"),o=THEME_DEFINE[e.theme].ui;cc.resources.load(o,cc.SpriteFrame,function(e,t){n.getComponent(cc.Sprite).spriteFrame=t}),t.getChildByName("name").getComponent(cc.Label).string=e.indexName+" "+e.name;var r=pc.isChapterOpened(a);a!=this.prepareChapterIndex||adventure.skipChapterLock||(r=!1);var s=e.stage.length,c=0;r&&(c=pc.getChapterStage(a));var l=pc.isChapterDone(a);t.getChildByName("progress").active=!l,t.getChildByName("progress").getComponent(cc.Label).string=c+"/"+s,this.setGray(n,!r),t.getChildByName("lock").active=!r}i&&(i.getChildByName("name").getComponent(cc.Label).string=e.indexName,i.mapIndex=a)}},updateIndexName:function(){for(var e in this.mapPoints){var t=this.mapPoints[e];if(t){var i=+e,a=this.getDifficulty(),n=Math.floor((a+1)/2);if(t.active=!0,1==n){var o=i;(r=CHAPTER_DEFINE_ARRAY[o])&&(t.getChildByName("name").getComponent(cc.Label).string=r.indexName)}else if(0!==i){var r;o=6*(n-1)+i,(r=CHAPTER_DEFINE_ARRAY[o])&&(t.getChildByName("name").getComponent(cc.Label).string=r.indexName)}else t.active=!1}}},initSweep:function(e,t){var i=this,a=e.getChildByName("sweep");if(a)if(task.isChapterSweepOpened(t)){a.active=!0;var n=0!=task.getChapterSweepStatus(t),o=task.getChapterSweepTime(t);n&&o>0&&(cc.warn("initSweep action",o/1e3),this.node.stopAction(a.refreshAction),a.refreshAction=this.node.runAction(cc.sequence(cc.delayTime(o/1e3),cc.callFunc(function(){this.initSweep(e,t)},this)))),a.onTouch=function(){money.check(ENERGY,5)||(daily.sweepCt?i.onSweep(a,e):sdk.useFree("home_sweep",function(t){t||i.onSweep(a,e,!0)}))};var r=n&&o<=0,s=a.getChildByName("icon"),c=a.getChildByName("icon2"),l=a.getChildByName("label").getComponent(cc.Label);s.stopAllActions(),c.active=!0,c.stopAllActions(),l.string=r?"\u626b\u8361\u5b8c\u6bd5":n?"\u626b\u8361\u4e2d":LI("sweep_start"),this.updateSweepBtn(e)}else a.active=!1},updateSweepBtn:function(e){var t=e.getChildByName("sweep");t.getChildByName("ctLeft").getComponent(cc.Label).string=daily.sweepCt&&LI("daily_times_available",{n:daily.sweepCt})||"",t.getChildByName("adIcon").active=!daily.sweepCt},onSelectPoint:function(){},onChapterChange:function(e,t){var i=+t,a=this.chapterPageView.getCurrentPageIndex()+i;CHAPTER_DEFINE_ARRAY,this.chapterPageView.scrollToPage(a,.5)},onChapterScrolling:function(){var e=this.chapterPageView.getScrollOffset(),t=this.chapterPageView.getMaxScrollOffset(),i=this.chapterPageView.getCurrentPageIndex();i>=CHAPTER_DEFINE_ARRAY.length||(this.mapIndexTarget=-e.x/t.x*(this.chapterPageView.getPages().length-1),i!=this.chapterIndex&&(this.btnClaimAllRewardChapter&&(this.btnClaimAllRewardChapter.node.stopAllActions(),this.btnClaimAllRewardChapter.node.scale=1,this.isClaimingRewards=!1),this.chapterIndex=i,this.refreshStartButton(i),pc.setChapterIndex(i),this.updateRedPoint(),this.updateRewardBox(),this.updateIndexName(),this.updateDifficultyInfo()))},update:function(e){var t=this.getDifficulty(),i=Math.floor((t+1)/2),a=(this.mapIndexTarget+i-1)%7;if(a!==this.mapIndex){var n=(a-this.mapIndex+17.5)%7-3.5;Math.abs(n)<.01?this.mapIndex=a:this.mapIndex=(this.mapIndex+(n>0?e:-e)+7)%7;var o=this.mapIndex,r=kit.clamp(Math.floor(o),0,this.mapPoints.length-1),s=o-r,c=this.getPosByLine(r,s);this.setMapPos(c.x,c.y)}},refreshStartButton:function(e){var t=CHAPTER_DEFINE_ARRAY[e];t?(this.startButtonNode.getChildByName("label").getComponent(cc.Label).string=t.energy,this.startButtonNode.getChildByName("name").getComponent(cc.Label).string=LI("chapter_start")):this.startButtonNode.getChildByName("name").getComponent(cc.Label).string="\u656c\u8bf7\u671f\u5f85",this.startButtonNode.getChildByName("rp").active=t&&e==adventure.stageToChapter(pc.stageIndex),this.setGray(this.startButtonNode,!this.canRunPageIndex(e))},setMapPos:function(e,t){this.mapIndexNode.x=e,this.mapIndexNode.y=t,this.mapNode.x=kit.clamp(-e,-850,850),this.mapNode.y=kit.clamp(-t,-120,90)},canRunPageIndex:function(e){return TEST_ALL_CHAPTER||e<CHAPTER_DEFINE_ARRAY.length&&pc.isChapterOpened(e)},onChapterTest:function(e){var t=this,a=this.chapterIndex;if(DEV_MODE&&DEBUG_MODE||this.canRunPageIndex(a)){var n=equipment.get("slotCt"),o=equipment.getValidEquipmentCount();if(console.log("[MapPage] Equipment check - SlotCt:",n,"Valid equipment count:",o,"Current array:",equipment.get("current")),o<Math.min(6,n))kit.info(LI("tip_empty_slot"));else{var r=CHAPTER_DEFINE_ARRAY[a].energy;money.check(ENERGY,r)||net.updateData({price:{i:ENERGY,n:r},set:{chapterIndex:a}},function(n,o){if(!n){pc.needUpdate=!1,i.FirebaseTracking.setDataBiRes("MapPage2"),money.update(o);var s=e.target;money.getNum(ENERGY)<ENERGY_DEF.max&&money.scheduleEnergy(),cc.game.emit("use_money",{pos:s.convertToWorldSpaceAR(cc.v2(0,0)),tid:"adventure_start",i:ENERGY,n:-r});var c=menuManager.popCover({noLoading:!0});s.runAction(cc.sequence(cc.delayTime(.7),cc.callFunc(function(){menuManager.closeCover(c),adventure.start(a)},t)))}})}}else kit.info(LI("unlock_0"))},getDifficulty:function(e){return(e=null!=e?e:this.chapterIndex)<=0?1:2*Math.floor((e-1)/6)+1},getDifficultyTarget:function(){var e=this.getDifficulty();return 6*Math.floor((e+1)/2)+1},updateDifficultyInfo:function(){var e=this.getDifficulty(),t=adventure.stageToChapter(pc.stageIndex);this.difficultyNode.active=t>=7;var i=this.getDifficultyTarget(),a=Math.floor((e+1)/2);cc.log("MapPage updateDifficultyInfo",e,i,"indexRound",a),this.difficultyTargetLabel.string=LI("bth_tip",{n:i}),this.difficultyBoardNode.getComponent("MapDifficultyBoard").initStatus({difficulty:e,display_difficulty:a,mapPage:this})},hasAnyChapterRewardsAvailable:function(){for(var e=0;e<CHAPTER_DEFINE_ARRAY.length;e++){var t=CHAPTER_DEFINE_ARRAY[e];if(t.rewardBox)for(var i=pc.getChapterStage(e),a=pc.isChapterDone(e),n=e<=0&&[3,4,5]||[4,7,10],o=0;o<t.rewardBox.length;o++){var r=pc.getChapterBoxOpen(e,o);if((i>=n[o]||a)&&!r)return!0}}return!1},updateRewardBox:function(){var e=this.chapterIndex<=0&&[3,4,5]||[4,7,10],t=pc.getChapterStage(this.chapterIndex),i=pc.isChapterDone(this.chapterIndex);for(var a in this.rewardBoxNoes){var n=pc.getChapterBoxOpen(this.chapterIndex,a);this.rewardBoxNoes[a].getChildByName("box_close").active=!n,this.rewardBoxNoes[a].getChildByName("box_open").active=n;var o=(t>=e[a]||i)&&!n;this.rewardBoxNoes[a].getChildByName("box_close").stopAllActions(),this.rewardBoxNoes[a].getChildByName("box_close").angle=0,this.rewardBoxNoes[a].isAvailable=o,this.rewardBoxNoes[a].boxIndex=a,this.rewardBoxNoes[a].getChildByName("rp").active=o,o&&this.rewardBoxNoes[a].getChildByName("box_close").runAction(cc.sequence(cc.sequence(cc.rotateTo(.05,5),cc.rotateTo(.05,-5)).repeat(4),cc.rotateTo(.05,0),cc.delayTime(1)).repeatForever()),this.rewardBoxNoes[a].getChildByName("label").getComponent(cc.Label).string=LI("chapter_box_lvn",{n:e[a]})}this.rewardBoxInfoNode.active=!1;var r=this.hasAnyChapterRewardsAvailable();if(this.btnClaimAllRewardChapter&&(this.btnClaimAllRewardChapter.node.active=r,r)){for(var s=0,c=0;c<CHAPTER_DEFINE_ARRAY.length;c++){var l=CHAPTER_DEFINE_ARRAY[c];if(l.rewardBox)for(var d=pc.getChapterStage(c),h=pc.isChapterDone(c),u=c<=0&&[3,4,5]||[4,7,10],p=0;p<l.rewardBox.length;p++){var f=pc.getChapterBoxOpen(c,p);(d>=u[p]||h)&&!f&&s++}}var m=this.btnClaimAllRewardChapter.node.getChildByName("label");m&&(m.getComponent(cc.Label).string="Claim All ("+s+")")}},openRewardBox:function(e,t){var a,n=this,o=e.target,r=CHAPTER_DEFINE_ARRAY[this.chapterIndex].rewardBox,s=r[t-1];if(!o.isAvailable)return this.rewardBoxInfoNode.parent==o?this.rewardBoxInfoNode.active=!this.rewardBoxInfoNode.active:(this.rewardBoxInfoNode.parent=o,this.rewardBoxInfoNode.active=!0,cc.log("openRewardBox init info")),void(this.rewardBoxInfoNode.active&&(this.rewardBoxInfoNode.getComponent("ChapterBoxRewardInfo").init(s),this.rewardBoxInfoNode.getChildByName("arrow").angle=0,this.rewardBoxInfoNode.getChildByName("arrow").y=-60,this.rewardBoxInfoNode.y=110));r||kit.info("\u6ca1\u6709\u7ae0\u8282\u5bf9\u5e94\u5956\u52b1");var c=[];equipment.getItemFromReward(c,s),cc.log("openRewardBox",c,r),equipment.save(),net.updateData({items:c,set:(a={},a["chapterBoxOpen."+this.chapterIndex+"."+o.boxIndex]=1,a)},function(e,t){i.FirebaseTracking.setDataBiRes("MapPage_ChapterBox"),money.update(t),pc.setChapterBoxOpen(n.chapterIndex,o.boxIndex),n.updateRewardBox(),menuManager.pop("loot",{items:c,tid:"\u7ae0\u8282\u5b9d\u7bb1",tname:"\u7ae0\u8282\u5b9d\u7bb1",lootCb:function(){}})})},onClickClaimAllRewards:function(){this.isClaimingRewards||(this.isClaimingRewards=!0,this.btnClaimAllRewardChapter,this.openAllChaptersAvailableRewardBoxes(),this.isClaimingRewards=!1)},groupRewards:function(e){for(var t={},i=0;i<e.length;i++){var a=e[i],n=a.i;a.id&&(n+="."+a.id),t[n]?t[n].n=(t[n].n||1)+(a.n||1):(t[n]={i:a.i,n:a.n||1},a.id&&(t[n].id=a.id),a.star&&(t[n].star=a.star),a.level&&(t[n].level=a.level))}var o=[];for(var n in t)o.push(t[n]);return o.sort(function(e,t){return e.i!==t.i?e.i.localeCompare(t.i):(t.n||1)-(e.n||1)}),o},openAllChaptersAvailableRewardBoxes:function(){for(var e=this,t=[],a=0,n={},o=0;o<CHAPTER_DEFINE_ARRAY.length;o++){var r=CHAPTER_DEFINE_ARRAY[o];if(r.rewardBox)for(var s=pc.getChapterStage(o),c=pc.isChapterDone(o),l=o<=0&&[3,4,5]||[4,7,10],d=0;d<r.rewardBox.length;d++){var h=pc.getChapterBoxOpen(o,d);if((s>=l[d]||c)&&!h){var u=[];equipment.getItemFromReward(u,r.rewardBox[d]);for(var p=0;p<u.length;p++)t.push(u[p]);n["chapterBoxOpen."+o+"."+d]=1,a++}}}if(0===a)return kit.info("No reward boxes available across all chapters"),void(this.isClaimingRewards=!1);var f=this.groupRewards(t);cc.log("Grouped "+t.length+" items into "+f.length+" stacks"),equipment.save(),net.updateData({items:f,set:n},function(t,o){if(!t&&o){for(var r in i.FirebaseTracking.setDataBiRes("MapPage_AllChapterBoxes_Bulk"),money.update(o),n){var s=r.split(".");if("chapterBoxOpen"===s[0]){var c=parseInt(s[1]),l=parseInt(s[2]);pc.setChapterBoxOpen(c,l)}}e.updateRewardBox(),menuManager.pop("loot",{items:f,tid:"\u5168\u7ae0\u8282\u5b9d\u7bb1 x"+a,tname:"All Chapters Reward Boxes",lootCb:function(){cc.log("All "+a+" reward boxes from all chapters opened successfully!"),4==user.getGuide("progressionTrack")&&cc.game.emit("start_tutorial_equipment_slot"),e.updateRewardBox()}})}else cc.error("Failed to claim rewards:",t),kit.info("Failed to claim rewards. Please try again.");e.isClaimingRewards=!1})},openAllAvailableRewardBoxes:function(){var e=this,t=CHAPTER_DEFINE_ARRAY[this.chapterIndex].rewardBox;if(t){for(var a=[],n=[],o={},r=0;r<this.rewardBoxNoes.length;r++){var s=this.rewardBoxNoes[r];s.isAvailable&&a.push({index:r,node:s,rewards:t[r]})}if(0!==a.length){for(var c=0;c<a.length;c++){var l=a[c],d=[];equipment.getItemFromReward(d,l.rewards);for(var h=0;h<d.length;h++)n.push(d[h]);o["chapterBoxOpen."+this.chapterIndex+"."+l.index]=1}cc.log("Opening all available boxes:",a.length,"Total items:",n),equipment.save(),net.updateData({items:n,set:o},function(t,o){if(!t&&o){i.FirebaseTracking.setDataBiRes("MapPage_ChapterBox_Bulk"),money.update(o);for(var r=0;r<a.length;r++)pc.setChapterBoxOpen(e.chapterIndex,a[r].index);e.updateRewardBox(),menuManager.pop("loot",{items:n,tid:"\u7ae0\u8282\u5b9d\u7bb1 x"+a.length,tname:"\u7ae0\u8282\u5b9d\u7bb1\u6279\u91cf\u9886\u53d6",lootCb:function(){cc.log("All reward boxes opened successfully!")}})}})}else kit.info("No reward boxes available to open")}else kit.info("\u6ca1\u6709\u7ae0\u8282\u5bf9\u5e94\u5956\u52b1")},openAllRewardBoxesSequential:function(e){for(var t=this,i=[],a=0;a<this.rewardBoxNoes.length;a++)this.rewardBoxNoes[a].isAvailable&&i.push(a+1);if(0===i.length)return kit.info("No reward boxes available"),void(e&&e(!1));var n=0;(function a(){if(n<i.length){var o={target:t.rewardBoxNoes[i[n]-1]},r=menuManager.pop;menuManager.pop=function(e,t){"loot"===e&&(t.lootCb=function(){menuManager.pop=r,n++,setTimeout(a,500)}),r.call(menuManager,e,t)},t.openRewardBox(o,i[n])}else cc.log("All boxes opened sequentially!"),e&&e(!0)})()},handleTaskNavigationSuggestions:function(){var e=this;adventure.showIdleSuggestionAfterNav&&(adventure.showIdleSuggestionAfterNav=!1,this.scheduleOnce(function(){var t=e.sideBoards[1].getChildByName("onlineBox");t&&a.showHandSuggestion(t,e.node,{offsetX:10,offsetY:0,duration:6,moveDistance:20,moveSpeed:.5})},.5)),adventure.showMinigameSuggestionAfterNav&&(adventure.showMinigameSuggestionAfterNav=!1,this.scheduleOnce(function(){var t=e.sideBoards[0];if(t){var i=t.height;a.showHandSuggestion(t,e.node,{offsetX:10,offsetY:-i/2,duration:6,moveDistance:20,moveSpeed:.5})}},.5)),adventure.showBattleSuggestionAfterNav&&(adventure.showBattleSuggestionAfterNav=!1,this.scheduleOnce(function(){e.startButtonNode&&a.showHandSuggestion(e.startButtonNode,e.node,{offsetX:0,offsetY:0,duration:6,moveDistance:20,moveSpeed:.5})},.5)),adventure.showSweepSuggestionAfterNav&&(adventure.showSweepSuggestionAfterNav=!1,this.scheduleOnce(function(){var t=e.chapterPageView.getPages()[e.chapterIndex];if(t){var i=t.getChildByName("sweep");i&&a.showHandSuggestion(i,e.node,{offsetX:0,offsetY:0,duration:6,moveDistance:20,moveSpeed:.5})}},.5)),adventure.showMapSuggestionAfterNav&&(adventure.showMapSuggestionAfterNav=!1,this.scheduleOnce(function(){e.startButtonNode&&a.showHandSuggestion(e.startButtonNode,e.node,{offsetX:0,offsetY:0,duration:6,moveDistance:20,moveSpeed:.5})},.5))},onSweep:function(e,t,a){var n=this;cc.log("onSweep",e);var o=this.chapterIndex,r=(CHAPTER_DEFINE_ARRAY[o],5);if(this.guideMode&&(r=0),!money.check(ENERGY,r)){var s=this.chapterIndex,c=CHAPTER_DEFINE_ARRAY[s],l=(c.stage.length,[]);equipment.getItemFromReward(l,c.item),net.updateData({price:{i:ENERGY,n:r},min:daily.sweepCt&&{daily_sweepCt:1},add:daily.sweepCt&&{daily_sweepCt:-1,daily_totalSweepCt:1},items:l},function(o,s){if(!o){null!=s.doc.daily_sweepCt&&(daily.sweepCt=s.doc.daily_sweepCt),cc.log("MapPage dailySweepCt",daily.sweepCt,s.doc),n.guideMode=!1,i.FirebaseTracking.setDataBiRes("MapPage_DailySweep"),money.update(s),window.TaskManager&&window.TaskManager.completeTask("task_2"),cc.game.emit("use_money",{pos:e.convertToWorldSpaceAR(cc.v2(0,0)),tid:"adventure_sweep",i:ENERGY,n:-r});var c=s.doc.daily_totalSweepCt||0;menuManager.pop("loot",{items:l,tid:"x2_complete",tname:"\u5238\u626b\u8361",videoItems:l,lootCb:function(){a&&YMTJ("video","sweep"),YMTJ("lv","wipe_out_"+c)}}),n.updateSweepBtn(t)}})}},setupDailyTaskNotification:function(){var e=this;this.updateDailyTaskNotification(),window.TaskManager&&(window.TaskManager.on("taskCompleted",function(){e.updateDailyTaskNotification()}),window.TaskManager.on("rewardClaimed",function(){e.updateDailyTaskNotification()}),window.TaskManager.on("progressReset",function(){e.updateDailyTaskNotification()})),window.DailyMilestones&&(window.DailyMilestones.on("milestoneAvailable",function(){e.updateDailyTaskNotification()}),window.DailyMilestones.on("milestoneClaimed",function(){e.updateDailyTaskNotification()}),window.DailyMilestones.on("pointsAdded",function(){e.updateDailyTaskNotification()}),window.DailyMilestones.on("progressReset",function(){e.updateDailyTaskNotification()})),window.WeeklyMilestones&&(window.WeeklyMilestones.on("milestoneAvailable",function(){e.updateDailyTaskNotification()}),window.WeeklyMilestones.on("milestoneClaimed",function(){e.updateDailyTaskNotification()}),window.WeeklyMilestones.on("pointsAdded",function(){e.updateDailyTaskNotification()}),window.WeeklyMilestones.on("progressReset",function(){e.updateDailyTaskNotification()})),console.log("[MapPage] Daily task notification system setup complete")},updateDailyTaskNotification:function(){if(this.dailyTaskNode){var e=this.dailyTaskNode.getChildByName("rp");if(e){var t=!1;console.log("[MapPage] ========== UPDATE NOTIFICATION START =========="),console.log("[MapPage] Initial hasRewards:",t);try{if(console.log("[MapPage] Checking tasks..."),window.TaskManager){var i=window.TaskManager.getAllProgress(),a=0,n=0,o=0;i.forEach(function(e,i){a++,e.completed&&n++,e.claimed&&o++,e.completed&&!e.claimed&&(t=!0,console.log("[MapPage] \u2705 Task reward available:",i))}),console.log("[MapPage] Task stats - Total:",a,"Completed:",n,"Claimed:",o),console.log("[MapPage] Task check complete, hasRewards:",t)}else console.log("[MapPage] TaskManager not available")}catch(l){console.error("[MapPage] ERROR in task check:",l),console.error("[MapPage] Error stack:",l.stack)}console.log("[MapPage] Daily task aaaaaa bb");try{if(console.log("[MapPage] Checking daily milestones..."),window.DailyMilestones){console.log("[MapPage] Inside daily milestones check");var r=window.DailyMilestones.getAllMilestones();for(var s in console.log("[MapPage] dailyMilestones config:",r),r)if(window.DailyMilestones.isMilestoneAvailable(s)){t=!0,console.log("[MapPage] Daily milestone reward available:",s);break}console.log("[MapPage] Daily milestone check complete, hasRewards:",t)}}catch(l){console.error("[MapPage] ERROR in daily milestone check:",l),console.error("[MapPage] Error stack:",l.stack)}try{if(console.log("[MapPage] Checking weekly milestones..."),window.WeeklyMilestones){console.log("[MapPage] Inside weekly milestones check");var c=window.WeeklyMilestones.getAllMilestones();for(var s in console.log("[MapPage] weeklyMilestones config:",c),c)if(window.WeeklyMilestones.isMilestoneAvailable(s)){t=!0,console.log("[MapPage] Weekly milestone reward available:",s);break}console.log("[MapPage] Weekly milestone check complete, hasRewards:",t)}}catch(l){console.error("[MapPage] ERROR in weekly milestone check:",l),console.error("[MapPage] Error stack:",l.stack)}try{console.log("[MapPage] ========== FINAL RESULT =========="),console.log("[MapPage] Final hasRewards:",t),console.log("[MapPage] rpNode.active (before):",e.active),e.active=t,console.log("[MapPage] rpNode.active (after):",e.active),console.log("[MapPage] Red point status:",t?"\ud83d\udd34 SHOW":"\u26aa HIDE"),console.log("[MapPage] ========== UPDATE NOTIFICATION END ==========")}catch(l){console.error("[MapPage] ERROR setting rpNode.active:",l),console.error("[MapPage] rpNode:",e),console.error("[MapPage] hasRewards:",t)}}else console.warn("[MapPage] Red point (rp) node not found in dailyTaskNode")}else console.warn("[MapPage] dailyTaskNode not found")}}),window.daily={setOnlineData:function(e){null!=e.daily_sweepCt?daily.sweepCt=e.daily_sweepCt:daily.sweepCt=5,daily.refreshTime=e.daily_refreshTime||0,cc.log("garage setOnlineData",e);for(var t=1;t<=4;t++)null!=e["daily_greenDiamond_free"+t]?daily["greenDiamond_free"+t]=e["daily_greenDiamond_free"+t]:daily["greenDiamond_free"+t]=1,null!=e["daily_greenDiamond_pay"+t]?daily["greenDiamond_pay"+t]=e["daily_greenDiamond_pay"+t]:daily["greenDiamond_pay"+t]=1,null!=e["daily_greenDiamond_reward"+t]?daily["greenDiamond_reward"+t]=e["daily_greenDiamond_reward"+t]:daily["greenDiamond_reward"+t]=0;daily.checkRefresh()},checkRefresh:function(){if(!(sdk.now()<daily.refreshTime)){for(var e={daily_refreshTime:kit.getNextDate(sdk.now()).getTime(),daily_sweepCt:5,energyDailyCt:5},t=1;t<=4;t++)e["daily_greenDiamond_free"+t]=1,e["daily_greenDiamond_pay"+t]=1,e["daily_greenDiamond_reward"+t]=1==daily["greenDiamond_reward"+t]&&2;user.setGuide("giftCode_dy777",0),net.postSilent("updateData",{set:e},function(e,t){if(!e){daily.sweepCt=t.doc.daily_sweepCt,daily.refreshTime=t.doc.daily_refreshTime,money.energyDailyCt=t.doc.energyDailyCt;for(var i=1;i<=4;i++)null!=t.doc["daily_greenDiamond_free"+i]?daily["greenDiamond_free"+i]=t.doc["daily_greenDiamond_free"+i]:daily["greenDiamond_free"+i]=1,null!=t.doc["daily_greenDiamond_pay"+i]?daily["daily_greenDiamond_pay"+i]=t.doc["daily_greenDiamond_pay"+i]:daily["daily_greenDiamond_pay"+i]=1,null!=t.doc["daily_greenDiamond_reward"+i]&&(daily["greenDiamond_reward"+i]=t.doc["daily_greenDiamond_reward"+i])}})}}},cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/Menu":"Menu","../utils/AnimUtils":"AnimUtils"}],MenuManager:[function(e,t){"use strict";cc._RF.push(t,"a11e3uHEW1DyY+MA1q1hte1","MenuManager");var i={readyForRestart:!1,init:function(){var e=sdk.pt();e&&e.getManager&&(console.log("wxHofix.onUpdateReady"),e.getUpdateManager().onUpdateReady(function(){console.log("wxHofix.readyForRestart"),i.readyForRestart=!0,"main"==menuManager.currentName()&&i.check()}))},check:function(){var e=sdk.pt();e&&e.getUpdateManager&&i.readyForRestart&&"main"==menuManager.currentName()&&menuManager.pop("notice",{title:LI("update"),info:LI("update_msg"),btn:LI("confirm"),noWait:!0,checkCb:function(){return wx.getUpdateManager().applyUpdate(),!0}})}};cc.Class({extends:cc.Component,properties:{clickAudio:{type:cc.AudioClip,default:null},loadingPrefab:cc.Prefab,whiteBlock:cc.SpriteFrame,coverPrefab:cc.Prefab,blockPrefab:cc.Prefab,focusPrefab:cc.Prefab,topBarPrefab:cc.Prefab,mainScene:"scene/main"},onShow:function(e){var t=e.query;console.log("onShow:",JSON.stringify(e));var i=menuManager.currentRun();if(t&&t.i);else{var a=e.scene;"login"==i.menuName?i.launchScene=a:"021001"==a&&user.lootFavorite()}},onHide:function(){},onLoad:function(){if(!window.menuManager){if(cc.game.addPersistRootNode(this.node),window.menuManager=this,cc.Button.prototype){var e=cc.Button.prototype._onTouchEnded;cc.Button.prototype._onTouchEnded=function(t){e.call(this,t),menuManager.playClick()}}BGM_VOLUME=kit.getValue(storage.getInt("BGM_VOLUME"),BGM_VOLUME),SE_VOLUME=kit.getValue(storage.getInt("SE_VOLUME"),SE_VOLUME),VIBRATE=kit.getValue(storage.getInt("VIBRATE"),VIBRATE),PERSONAL_ADS=kit.getValue(storage.getInt("PERSONAL_ADS"),PERSONAL_ADS),window.nativeSdk&&nativeSdk.blockPersonalizedAds&&nativeSdk.blockPersonalizedAds(!PERSONAL_ADS);var t=sdk.pt();t&&t.setKeepScreenOn&&t.setKeepScreenOn({keepScreenOn:!0}),cc.sys.platform===cc.sys.WECHAT_GAME?(t.showShareMenu&&t.showShareMenu({withShareTicket:!1,menus:["shareAppMessage","shareTimeline"]}),t.onShareAppMessage&&t.onShareAppMessage(function(){return{}}),t.onShareTimeline&&t.onShareTimeline(function(){return{}}),t.onShow(this.onShow),t.onHide(this.onHide)):(cc.sys.platform,cc.sys.BYTEDANCE_GAME),i.init()}},setDefault:function(e){void 0===e&&(e=this.menu.menuName),cc.sys.localStorage.setItem("default_menu",e)},getDefault:function(e){var t=cc.sys.localStorage.getItem("default_menu");return console.log("getDefault",t||e),t||e},init:function(e,t){this.popQuene=[],this.menuStack=[],this.menu=e,e.popMenuStack=[],e.menuName=t},currentRunCfg:function(){if(this.menuStack.length>0)return this.menuStack[this.menuStack.length-1]},currentRun:function(){if(this.menu)return this.menu},currentPop:function(){var e=this.menu;if(!e)return null;var t=e.popMenuStack;return t&&t.length>0?t[t.length-1].menu:void 0},current:function(){var e=this.menu;if(!e)return null;var t=e.popMenuStack;return t&&t.length>0?t[t.length-1].menu:e},currentName:function(){var e=this.current();return e&&e.menuName?e.menuName:"unknown"},queueCheck:function(e){var t=this;if(this.queueMenu==e)for(this.queueMenu=null;this.popQuene&&this.popQuene.length>0;){var i=this.popQuene.shift();if(this.pop(i.name,i.args,function(e,a){i.noBusy||(t.queueMenu=a)}),!i.noBusy)return}},queue:function(e,t,i){var a=this;this.queueMenu?this.popQuene.push({name:e,args:t,noBusy:i}):(this.queueMenu=-1,this.pop(e,t,function(e,t){i||(a.queueMenu=t)}))},push:function(e,t,i){this.pushReal("scene/"+e,t,i)},pushReal:function(e,t,i){if(i)this.menuStack=[{name:e,args:t}],this.loading||this.menuStack.push(this.currentRunCfg());else{var a=this.menuStack.length+(this.loading?0:-1);this.menuStack.splice(a,0,{name:e,args:t})}},snapshot:function(){this.currentRunCfg().popMenuStack=this.menu.popMenuStack},popCover:function(e){var t,i=(t=void 0===e?{}:e).noLoading,a=t.prefab,n=t.time,o=1e3+2*(this.menu.popMenuStack.length+1),r=cc.Canvas.instance.node,s=cc.instantiate(a||this.blockPrefab),c=s.getComponent("Transition");if(c.fadeIn(),r.addChild(s,o),!i){var l=cc.instantiate(this.loadingPrefab);s.addChild(l)}return n&&s.runAction(cc.sequence(cc.delayTime(n),cc.destroySelf())),c},closeCover:function(e){cc.isValid(e)&&e.fadeOut()},close:function(e,t){var i=this.menu,a=i.popMenuStack;if(a&&!(a.length<=0)){var n=!1;if(arguments.length<2)t=e,e=a[a.length-1].menu,a.length-=1,n=!0,cc.log("menuManager.close top",e.menuName);else{for(var o=a.length-1;o>=0;o--)if(e==a[o].menu){o==a.length-1&&(n=!0),a.splice(o,1);break}cc.log("menuManager.close",e.menuName)}if(!this.loading)if(0==a.length)this.onMenuBlock(0);else{var r=a[a.length-1].menu;if(r.noBlock)this.onMenuBlock(0);else{var s=1e3+2*a.length;this.onMenuBlock(s)}}e.onMenuClose(t),n&&this.current().onMenuReappear(),this.queueCheck(e)}},onMenuBlock:function(e){cc.log("onMenuBlock zIndex",e);var t=cc.Canvas.instance.node,i=t.blockCover;if(e)if(i)i.node.zIndex=e-1;else{var a=cc.instantiate(this.coverPrefab);t.addChild(a,e-1);var n=a.getComponent("Transition");n.fadeIn(),t.blockCover=n}else i&&(i.fadeOut(),delete t.blockCover)},pop:function(e,t,i){"object"==typeof e?this.popReal(e,t,i):this.popReal("pop/"+e,t,i)},popReal:function(e,t,i){var a=this;if(cc.log("menuManager.pop",e),this.loading)cc.warn("menuManager is loading now!");else{this.loading=!0;var n=this.menu.popMenuStack,o=1e3+2*(n.length+1);t&&t.zIndex&&(o=t.zIndex);var r=cc.Canvas.instance.node,s=t&&t.noBlock;if(!s){this.onMenuBlock(o);var c=cc.instantiate(this.loadingPrefab);r.addChild(c,o)}var l=this.current();l&&l.onMenuCover();var d=function(e,l){if(a.loading=!1,c&&c.destroy(),e)return cc.error("loadPrefab err",h,e),void kit.info(LI("load_ui_err0"));t=t||{};var d=cc.instantiate(l);r.addChild(d,o);var u=d.getComponent("Menu");u.menuName=h,u.noBlock=s,u.init(t,!0),u.popFreeFlag||n.push({name:h,menu:u,args:t}),i&&i(null,u)},h=e;"object"==typeof e?(h=e.name||"?",d(0,e)):cc.assetManager.loadBundle("scene",function(e,t){if(e)return d(e);t.load(h,cc.Prefab,d)})}},preload:function(e){cc.director.preloadScene(e,function(e){e&&cc.warn("menuManager preload err!",e)})},run:function(e,t,i,a){this.runReal("scene/"+e,t,i,a)},runReal:function(e,t,a,n){var o=this;if(void 0===n&&(n=!1),cc.log("menuManager.run",e),this.loading)cc.warn("menuManager is loading now!");else{this.loading=!0;var r,s=this.current();s&&s.onMenuLeave();var c=this.menu;if(c&&!n){var l=cc.Canvas.instance.node,d=1e3+2*c.popMenuStack.length;this.onMenuBlock(d),r=cc.instantiate(this.loadingPrefab),l.addChild(r,d)}cc.director.preloadScene(e,function(s){if(s)return o.loading=!1,cc.error("loadScene err",e,s),c&&!n&&(o.onMenuBlock(0),r&&r.destroy()),void kit.info(LI("load_ui_err0"));cc.director.loadScene(e,function(){o.loading=!1,o.queueMenu=null,o.popQuene=[],t=t||{};var n=cc.Canvas.instance.node,r=o.menu=n.getComponent("Menu");if(!r.runFreeFlag)if(a)o.menuStack=[{name:e,args:t}];else{var s=o.currentRunCfg();s&&s.name!=e&&o.menuStack.push({name:e,args:t})}r.popMenuStack=[],r.menuName=e,r.init(t,!1),i.check()})})}},back:function(e,t){if(void 0===e&&(e=1),void 0===t&&(t={}),cc.log("menuManager.back",e,this.menuStack.length,t),this.loading)cc.error("this.back: busy now");else if(e>0&&this.menuStack.length>e){this.menuStack.length-=e;var i=this.currentRunCfg();this.runReal(i.name,i.args);var a=i.popMenuStack;if(a&&a.length>0){for(var n in a)var o=a[n],r=this.pop(o.name,o.args);i.popMenuStack=null,r.onMenuBack()}else this.menu.onMenuBack()}else this.runReal(this.mainScene,t,!0)},checkGuideFinish:function(e,t){var i=cc.Canvas.instance.node;i.focusNode&&i.focusNode.checkFinish(e,t)},focusOn:function(e,t,i,a,n,o){if(e&&this.focusPrefab){"function"==typeof i&&(a=i,i=0);var r=cc.Canvas.instance.node;r.focusNode&&r.focusNode.remove();var s=cc.instantiate(this.focusPrefab),c=s.getComponent("Focus"),l=o&&o.pos,d=o&&o.size,h=o&&o.head,u=o&&o.dx,p=o&&o.dy,f=o&&o.noFinger,m=o&&o.dragToNode,g=o&&o.noBlack,v=o&&o.dragBy,y=o&&o.dragBetween,b=o&&o.dragBetweenLinePos,k=o&&o.dragFromNode,T=o&&o.noTouch,_=o&&o.fade,w=o&&o.fadeCb,E=o&&o.flipHead;c.init({node:e,cond:o&&o.cond,info:t,delay:i,event:n,fade:_,fadeCb:w,pos:l,size:d,head:h,dx:u,dy:p,noFinger:f,dragToNode:m,noBlack:g,dragBy:v,dragBetween:y,dragBetweenLinePos:b,dragFromNode:k,noTouch:T,flipHead:E,cb:function(e){r.focusNode==c&&delete r.focusNode,a&&a(e)}}),r.addChild(s,o&&o.z||9998),r.focusNode=c}},hotOn:function(e,t,i,a,n){if(e&&this.focusPrefab){var o=cc.Canvas.instance.node;o.focusNode&&o.focusNode.remove();var r=cc.instantiate(this.focusPrefab),s=n&&n.pos,c=n&&n.size,l=(n&&n.dragToNode,n&&n.dragBy),d=n&&n.dx,h=n&&n.dy,u=n&&n.head,p=r.getComponent("Focus");p.initHot({cond:n&&n.cond,info:t,head:u,node:e,delay:i,noFinger:n&&n.noFinger,pos:s,size:c,dragBy:l,cb:a,dx:d,dy:h}),o.addChild(r,cc.macro.MAX_ZINDEX),o.focusNode=p}},chatOn:function(e,t,i,a,n){if(this.focusPrefab){var o=cc.Canvas.instance.node;o.focusNode&&o.focusNode.remove();var r=cc.instantiate(this.focusPrefab),s=a&&a.pos,c=a&&a.size,l=a&&a.noFinger,d=a&&a.head,h=a&&a.dx,u=a&&a.dy,p=a&&a.noBlack,f=r.getComponent("Focus");f.initChat({cond:a&&a.cond,info:t,node:e,delay:i,noFinger:l,pos:s,size:c,head:d,cb:n,dx:h,dy:u,noBlack:p}),o.addChild(r,a&&a.z||9998),o.focusNode=f}},refresh:function(){var e=this.currentRunCfg();e&&this.runReal(e.name,e.args)},stopBgm:function(){void 0!==this.music&&(cc.audioEngine.stop(this.music),delete this.music)},resumeBgm:function(){if(this.musicAudio){var e=this.musicAudio;delete this.musicAudio,this.playBgm(e)}},playBgm:function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=1),cc.audioEngine.setMusicVolume(i),this.musicAudio!=e&&(this.musicAudio=e,void 0!==this.music&&(cc.audioEngine.stop(this.music),delete this.music),e&&BGM_VOLUME&&(this.music=cc.audioEngine.playMusic(e,!!t)))},playClick:function(){this.playEffect(this.clickAudio,0,1)},playEffect:function(e,t,i){if(void 0===i&&(i=1),i*=.2,e&&SE_VOLUME)return cc.audioEngine.play(e,!!t,i)},createSprite:function(e,t,i){var a=new cc.Node;a.x=e,a.y=t;var n=a.addComponent(cc.Sprite);return cc.resources.load(i,cc.SpriteFrame,function(e,t){n.spriteFrame=t}),a.sprite=n,a},createArmature:function(e,t,i){i||(i=t,t=null);var a=new cc.Node,n=a.addComponent(dragonBones.ArmatureDisplay);return this.loadArmature(n,e,i,t),a.armatureDisplay=n,a},loadArmature:function(e,t,i,a){var n="anime/"+t+"_ske",o="anime/"+t+"_tex";e.dragonAsset=null,e.dragonAtlasAsset=null,e.armatureName=null;var r=a||t;cc.resources.load(n,dragonBones.DragonBonesAsset,function(t,a){t?cc.log("load DragonBonesAsset err",t):cc.resources.load(o,dragonBones.DragonBonesAtlasAsset,function(t,n){t?cc.log("load DragonBonesAtlasAsset err",t):cc.isValid(e)&&(e.dragonAsset=a,e.dragonAtlasAsset=n,e.armatureName=r,e.enabled=!0,i&&i(t,e))})})},createAnimation:function(e,t){var i,a=(i=new cc.Node).addComponent(cc.Sprite),n=i.addComponent(cc.Animation);return this.loadAnimation(a,n,e,t),i.sprite=a,i.animation=n,i},loadAnimation:function(e,t,i,a){var n=this;cc.log("loadAnimation",i),cc.resources.load(i,cc.SpriteAtlas,function(o,r){o?cc.log("load  Animation SpriteAtlas err",i,o):cc.isValid(e)&&n.bindAnimation(e,t,r,a)})},bindAnimation:function(e,t,i,a){var n=a.speed,o=a.repeat,r=i.getSpriteFrames();if(a.rand){for(var s=[],c=0,l=r.length;c<l;c++)s.push(r.splice(kit.rndInt(0,r.length-1),1)[0]);r=s}e.trim=!1,e.sizeMode=cc.Sprite.SizeMode.RAW;var d=cc.AnimationClip.createWithSpriteFrames(r,r.length);d.name="1",d.speed=n||1,o==AnimationWrap.Reserve?d.wrapMode=cc.WrapMode.Reverse:o<0?d.wrapMode=cc.WrapMode.Loop:(d.wrapMode=cc.WrapMode.Normal,d.repeatCount=o||1),t.addClip(d),this.playAnimation(e,t,a)},playAnimation:function(e,t,i){var a=i.delay,n=function(){this.node.destroy()};i.alive?t._animationFinish&&(t.off("finished",n,t),t._animationFinish=null):t._animationFinish||(t.on("finished",n,t),t._animationFinish=n),a?(t.node.runActionVS(cc.sequence(cc.delayTime(a),cc.callFunc(function(){t.play("1")},t))),e.spriteFrame=null):t.play("1")}}),cc._RF.pop()},{}],Menu:[function(e,t){"use strict";cc._RF.push(t,"e24e4jpYaFGAYXQP1ANxtpc","Menu");var i=e("../../../Plugins/firebase/FirebaseTracking");cc.Class({extends:cc.Component,properties:{floatId:cc.String,floatAdNode:cc.Node,bannerId:cc.String,bgm:{type:cc.AudioClip,default:null},topEnergyVisible:!0,humanPrefab:cc.Prefab,rightNodes:[cc.Node],verticalNodes:[cc.Node]},onLoad:function(){this.onLoadAd()},onDestroy:function(){this.onDestroyAd()},isAdOpened:function(){return!0},onLoadAd:function(){this.isAdOpened()&&(this.floatId&&this.floatAdNode&&(this.floatLoaded||(this.floatLoaded=!0,sdk.showFloat(this.floatId,this.floatAdNode))),this.bannerId&&(this.bannerLoaded||(this.bannerLoaded=!0,sdk.showBanner(this.bannerId))))},onDestroyAd:function(){this.floatId&&this.floatAdNode&&this.floatLoaded&&(this.floatLoaded=!1,sdk.hideFloat(this.floatId)),this.bannerId&&this.bannerLoaded&&(this.bannerLoaded=!1,sdk.removeBanner(this.bannerId))},isBannerOpened:function(){return this.isAdOpened()&&this.bannerId&&sdk.isBannerOpened()},start:function(){},resizeBackground:function(){var e=this.node.getChildByName("bg");e&&cc.winSize.height>e.height&&e.setScale(cc.winSize.height/e.height)},setGray:function(e,t){var i;e instanceof cc.Sprite||(e=e.getComponent(cc.Sprite)),i=t?"2d-gray-sprite":"2d-sprite",e.setMaterial(0,cc.Material.getBuiltinMaterial(i))},init:function(e,t){if(this.args=e,this.resizeBackground(),t||(this.noTopBar||this.showTopBar({visible:{diamond:!1,sweepTicket:!1,energy:this.topEnergyVisible}}),menuManager.playBgm(this.bgm)),cc.winSize.height<1280){var i=cc.winSize.height/1280;for(var a in this.verticalNodes)this.verticalNodes[a].scale=i;this.topBar&&(this.topBar.scale=i)}var n=sdk.pt();if(n&&n.getMenuButtonBoundingClientRect){var o=n.getMenuButtonBoundingClientRect(),r=cc.view.getDevicePixelRatio(),s=cc.view.getScaleY()/r,c=o.bottom/s;for(var a in this.rightNodes){var l=this.rightNodes[a].getComponent(cc.Widget);l&&(l.top=c)}}this.initStatus(e);var d=this.args.initCb;d&&d.call(this,e,this)},showTopBar:function(e){if(!this.topBar){var t=cc.Canvas.instance.node;this.topBar=cc.instantiate(menuManager.topBarPrefab),t.addChild(this.topBar,9999),cc.warn("showTopBar"),this.scheduleOnce(function(){console.log("======== reset level id = null"),i.FirebaseTracking.levelID=""},2)}this.topBar.getComponent("TopBar").init(e)},hideTopBar:function(){this.topBar&&(this.topBar.destroy(),delete this.topBar)},initStatus:function(){},onMenuClose:function(e){var t,i;cc.log("onMenuClose",this.menuName),this.node.destroy(),(i=null==(t=this.args)?void 0:t.closeCb)&&i.call(this,e)},onMenuLeave:function(){},onMenuBack:function(){},onMenuCover:function(){this.onDestroyAd()},onMenuReappear:function(){this.onLoadAd()},close:function(e){cc.log("menu close",e),menuManager.close(this,e)},back:function(){menuManager.back()},onClose:function(e,t){this.close(t)},onBack:function(){this.back()},callPopMenu:function(e,t){menuManager.pop(t)},callRunMenu:function(e,t){menuManager.run(t)}}),cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],MerchantSellPop:[function(e,t){"use strict";cc._RF.push(t,"8294fLC9jZNd7L9h965qce8","MerchantSellPop"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{cost:cc.Label},initTouch:function(){var e=this.node;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this),this.touch={}},initStatus:function(e){this.args=e,this.game=e.game,this.itemId=e.itemId,this.lvl=e.lvl,this.block=e.block,this.initUI()},initUI:function(e){void 0===e&&(e=1);var t=new cc.Node;t.y=45,this.node.addChild(t);var i=t.addComponent("checkpointAvatar"),a=ItemDefine[this.itemId],n=this.lvl||ItemDefine[this.itemId].lvl;i.init(a,n,this.game),this.cost.string=Math.floor(this.args.cost)},onTouchBegan:function(){},onTouchMoved:function(){},onTouchEnded:function(){},onTouchCanceled:function(){},sell:function(){this.close();var e=this.args.cost;chapter.add(GOLD,e,"cp_sell");for(var t=0;t<=10;t++){var i=this.node.convertToWorldSpaceAR(cc.v2(0,0));i=this.game.camera.getWorldToScreenPoint(i),cc.game.emit("add_drop",{pos:cc.v2(i.x+kit.rnd(-100,100),i.y+kit.rnd(-100,100)),tid:"cp_sell",i:GOLD,n:e/11})}this.block.content.define.id,this.block.content.remove()},closeMenu:function(){}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],Merchant:[function(e,t){"use strict";var i;cc._RF.push(t,"4b5eb8k6yVG75gOT/sUPYaF","Merchant");var a={item:{power:10,price:2,define:function(){var e=["atkSpeed","invincible","bomb"][kit.rndInt(0,2)],t={id:e,type:"other",lvl:3,name:("atkSpeed"==e?"\u6b65\u5766\u534f\u540c":"invincible"==e&&"\u5f3a\u529b\u62a4\u76fe")||"bomb"==e&&"\u70ae\u706b\u652f\u63f4",des:{invincible:"\u5c55\u5f00\u9632\u62a4\u7f69\uff0c\u6218\u8f66\u548c\u6b66\u5668\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u4e0d\u4f1a\u6536\u5230\u4efb\u4f55\u4f24\u5bb3",atkSpeed:"\u547c\u53eb\u4e00\u540d\u5f3a\u529b\u8001\u5175\u4e00\u8d77\u6218\u6597",bomb:"\u547c\u53eb\u540e\u65b9\u70ae\u706b\u8f70\u70b8\uff0c\u8fde\u7eed\u653b\u51fb\u654c\u65b9"}[e],avatar:{sprite:("atkSpeed"==e?"buff/\u96c7\u4f63\u5175":"invincible"==e&&"buff/\u62a4\u76fe")||"bomb"==e&&"buff/\u8f70\u70b8"}};return cc.log("Merchant define",t.id),t},buyFunc:function(e){cc.log("Merchant buyFunc",e.id),chapter.data.combatItem[e.id]++,cc.game.emit("add_item",{id:e.id}),this.game.showJoystick()}},weapon_1:{power:10,price:3,lvl:1,define:function(){return ItemDefine[["machine_gun","cannon","flame_thrower"][kit.rndInt(0,2)]]}},weapon_2:{power:5,price:6,lvl:2,define:function(){return ItemDefine[["machine_gun","cannon","flame_thrower"][kit.rndInt(0,2)]]}},weapon_3:{power:2,price:11,lvl:3,define:function(){return ItemDefine[["machine_gun","cannon","flame_thrower"][kit.rndInt(0,2)]]}},weapon_4:{power:1,price:20,lvl:4,define:function(){return ItemDefine[["machine_gun","cannon","flame_thrower"][kit.rndInt(0,2)]]}},weapon_5:{power:1,price:36,lvl:5,define:function(){return ItemDefine[["machine_gun","cannon","flame_thrower"][kit.rndInt(0,2)]]}},item_1:{power:10,price:1,define:function(){var e=[];for(var t in ItemDefine){var i=ItemDefine[t];"equipment"!=i.type||i.lvl&&1!=i.lvl||e.push(i)}return e[kit.rndInt(0,e.length-1)]}},item_2:{power:10,price:2,define:function(){var e=[];for(var t in ItemDefine){var i=ItemDefine[t];"equipment"==i.type&&2==i.lvl&&e.push(i)}return e[kit.rndInt(0,e.length-1)]}},item_3:{power:10,price:4,define:function(){var e=[];for(var t in ItemDefine){var i=ItemDefine[t];"equipment"==i.type&&3==i.lvl&&e.push(i)}return e[kit.rndInt(0,e.length-1)]}},item_4:{power:5,price:7,define:function(){var e=[];for(var t in ItemDefine){var i=ItemDefine[t];"equipment"==i.type&&4==i.lvl&&e.push(i)}return e[kit.rndInt(0,e.length-1)]}},item_5:{power:2,price:13,define:function(){var e=[];for(var t in ItemDefine){var i=ItemDefine[t];"equipment"==i.type&&5==i.lvl&&e.push(i)}return e[kit.rndInt(0,e.length-1)]}},fix_vehicle_1:{max:1,power:10,price:[2,4,8,16,32],define:{name:"\u6218\u8f66\u7ef4\u4fee",type:"other",lvl:3,des:"\u5feb\u901f\u5c06\u6218\u8f66HP+35%",avatar:{sprite:"checkpoint/train/\u7ef4\u4fee\u8f6635%"}},buyFunc:function(){this.game.repairTank2(.35)}},fix_vehicle_2:{max:1,power:10,price:[4,8,16,32,64],define:{des:"\u4e00\u6b21\u6027\u5c06\u6218\u8f66HP+100%",name:"\u6218\u8f66\u7ef4\u4fee",type:"other",lvl:4,avatar:{sprite:"checkpoint/train/\u7ef4\u4fee\u8f66\u5168\u90e8"}},buyFunc:function(){this.game.repairTank2(1)}},vehicle_bonus_hp:{max:1,power:10,price:[3,6,12,24,48],define:{des:"\u63d0\u5347\u6218\u8f66\u7684HP\u4e0a\u9650 30%",name:"\u8f66\u4f53\u88c5\u7532",type:"other",lvl:4,avatar:{sprite:"checkpoint/train/\u8f66\u6700\u5927HP+30%"}},buyFunc:function(){this.game.empowerTank2(.3)}},fix_weapon_1:{max:1,power:10,price:[2,4,8,16,32],define:{name:"\u6b66\u5668\u7ef4\u4fee",type:"other",lvl:3,des:"\u5c06\u6240\u6709\u6b66\u5668HP+30%",avatar:{sprite:"checkpoint/train/\u7ef4\u4fee\u6b66\u566830%"}},buyFunc:function(){this.game.repairAllWeaponTeam2(.35)}},fix_weapon_2:{max:1,power:10,price:[4,8,16,32,64],define:{name:"\u6b66\u5668\u7ef4\u4fee",type:"other",lvl:4,des:"\u5c06\u6240\u6709\u6b66\u5668HP+100%",avatar:{sprite:"checkpoint/train/\u7ef4\u4fee\u6b66\u5668\u5168\u90e8"}},buyFunc:function(){this.game.repairAllWeaponTeam2(1)}},bonus_silver:{max:1,power:10,price:0,ad:1,define:{name:"\u89c6\u9891\u798f\u5229",type:"other",lvl:4,avatar:{sprite:"checkpoint/train/\u5927\u8d27\u5e01"}},buyFunc:function(){chapter.add(SILVER,5,"cp_buy"),cc.game.emit("use_drop",{tid:"cp_buy",i:SILVER,n:5})}},ult_dmg:{max:1,power:10,price:[2,4,8,16,32],define:{name:"\u5fc5\u6740\u52a0\u5f3a",type:"other",lvl:3,des:"\u5fc5\u6740\u7684\u4f24\u5bb3+50%",avatar:{sprite:"checkpoint/train/\u5927\u62db\u5a01\u529b"}},buyFunc:function(){chapter.data.events.push({eventId:"skill_power4"})}},ult_cd:{max:1,power:10,price:1,define:{name:"\u5fc5\u6740\u52a0\u5feb",type:"other",lvl:1,des:"\u5fc5\u6740cd\u52a0\u5feb25%",avatar:{sprite:"checkpoint/train/\u5927\u62dbCD"}},buyFunc:function(){chapter.data.events.push({eventId:"skill_cd"})}},ult_combo:{max:1,power:10,price:2,define:{name:"\u5fc5\u6740\u8fde\u53d1",type:"other",lvl:2,des:"\u5fc5\u6740\u8fde\u53d1\u7684\u6982\u7387+25%",avatar:{sprite:"checkpoint/train/\u53cc\u91cd\u5927\u62db"}},buyFunc:function(){chapter.data.events.push({eventId:"skill_combo"})}}},n=[],o={fix_vehicle_1:1,fix_vehicle_2:1,fix_weapon_1:1,fix_weapon_2:1};for(var r in a)a[r].id=r,o[r]||n.push(a[r]);cc.Class(((i={extends:cc.Component,properties:{items:[cc.Node],trainItem:cc.Node,trainItemLayout:cc.Node,sellTabs:[cc.Node]},initTouch:function(){var e=this.node;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this),this.touch={}},init:function(e,t){this.game=e,this.adItemBought={},t?this.initTrainItems():this.initItems()},initUI:function(t){void 0===t&&(t=1);var i=this.sellSlot.addComponent(e("./itemBlock"));i.init(this.game,{}),this.sellBlock=i,this.game.addCheckBlock(i);var a=this;i.setContentGetCb(function(){var e=i.content;if("weapon"==e.define.type){var t=(1==(n=e.lvl)?100:2==n&&200)||3==n&&400;t/=3}else if("equipment"==e.define.type){var n;t=(1==(n=e.lvl)?40:2==n&&80)||3==n&&160,t/=3}menuManager.pop("sell_item",{block:i,game:a.game,itemId:i.content.define.id,lvl:i.content.lvl,cost:t})})},setBonusMoneyAdFree:function(){this.node.getChildByName("\u5e7f\u544a\u6309\u94ae").getChildByName("\u5e7f\u544aicon").active=!1,this.bonusMoneyAdFree=!0},popSellItem:function(){},pickMerchantDefFromTrainPool:function(e){return e=e,this.draw(e)},draw:function(e){var t,i=e,a=0,n={};for(var o in i){var r=i[o].power;this.adItemBought[i[o].id]&&(r=0,n[i[o].id]=r),a+=r}cc.log("list before",i);var s=Math.random()*a,c=0;for(var o in i)if(0!=n[i[o].id]&&s<=(c+=n[i[o].id]||i[o].power)){t=o,cc.log("draw:",i[o].id,t);break}var l=t&&e[t];return l&&l.max&&e.splice(t,1),l},initTrainItems:function(){this.items=this.items||[];for(var e=kit.clone(n),t=1;t<=9;t++){var i=this.items[t-1]||cc.instantiate(this.trainItem);i.opacity=255,i.sold=!1,i.active=!0;var o,r=e;if(1==t){var s=this.game.args.vehicleConfig;(o=this.game.getTankRepairPrice(s.hp))>0&&(r=[a.fix_vehicle_1,a.fix_vehicle_2])}2==t&&(o=this.game.getRepairAllWeaponTeamPrice())>0&&(r=[a.fix_weapon_1,a.fix_weapon_2]),3==t&&(r=[a.weapon_1,a.weapon_2,a.weapon_3,a.weapon_4,a.weapon_5]);var c=this.pickMerchantDefFromTrainPool(r),l=c.define;if("function"==typeof l&&(l=l()),i.merchantDefine=c,(o=c.price).constructor==Array){var d=chapter.data.trainItemBuy[c.id]||0;d>o.length-1&&(d=o.length-1),o=o[d]}cc.log("initTrainItems price",l.name,o),this.initItem(i,l,c.lvl,o),i.getChildByName("ad").active=c.ad,this.items[t-1]||(this.trainItemLayout.addChild(i),this.items.push(i))}},initItems:function(){for(var e in this.weaponPool=["machine_gun","flame_thrower","cannon"],this.equipmentPool=[["ab","ac","bc"],["ab2","ac2","bc2"],["ab3","ac3","bc3"]],this.materialPool=[["a","b","c","d"],["e","f","g","h"],["i","j","k"]],this.consumablePool=["invincible","infinite_ammo","atkSpeed"],this.items){var t=Math.random(),i=(t<.7?1:t<.9&&2)||3;if(0==e){var a=this.weaponPool[kit.rndInt(0,this.weaponPool.length-1)],n=ItemDefine[a];cc.log("initItems id",a);var o=(1==i?50:2==i&&100)||3==i&&200||4==i&&400||5==i&&800;this.initItem(this.items[e],n,i,o)}else if(1==e)a=(r=this.equipmentPool[i-1])[kit.rndInt(0,r.length-1)],n=ItemDefine[a],cc.log("initItems id",a),o=(1==i?20:2==i&&40)||3==i&&80||4==i&&160||5==i&&320,this.initItem(this.items[e],n,null,o);else if(2==e){var r;a=(r=this.materialPool[i-1])[kit.rndInt(0,r.length-1)],n=ItemDefine[a],cc.log("initItems id",a),o=(1==i?15:2==i&&20)||3==i&&40||80,this.initItem(this.items[e],n,null,o)}else 3==e?(n=ItemDefine.expPack,this.initItem(this.items[e],n,null,50,!0)):4==e?(n=ItemDefine["equipmentPack"+i],this.initItem(this.items[e],n,null,n.cost)):5==e&&(n=ItemDefine["materialPack"+i],this.initItem(this.items[e],n,null,n.cost));this.items[e].opacity=255,this.items[e].sold=!1}this.showBlocks(null,"weapon")},initItem:function(e,t,i,a,n){cc.log("initItem",t,a),e.getChildByName("price").getComponent(cc.Label).string=a||t.cost||0,e.getChildByName("title").getComponent(cc.Label).string=t.name;var o=e.getChildByName("content");(o.getComponent("checkpointAvatar")||o.addComponent("checkpointAvatar")).init(t,i||t.lvl,this.game,!0),e.cost=a||t.cost||0,e.itemDef=t,e.lvl=i||t.lvl,e.infiniteBuy=n,cc.log("initItem",e)},getBagItemsCount:function(e){var t=this.game.bagUI.getComponent("bottomUI")[e+"Blocks"],i=0;for(var a in t)t[a].content&&i++;return i},popInfoBox:function(e){var t=e.target,i=this,a=t.itemDef;t.merchantDefine&&t.merchantDefine.ad?this.buyTrainItem(e):cc.resources.load("checkpoint/itemInfoBox",cc.Prefab,function(n,o){var r=cc.instantiate(o);r.getComponent("itemInfoBox").init(i.game,a,e.target.lvl||a.lvl||1,null,function(){i.buyTrainItem(e)},t.cost),r.x=0,r.y=0,i.game.node.addChild(r,1e3)})},buyTrainItem:function(e,t){var i=e.target;if(t&&(i=i.parent),console.log("buyItem",i),!i.sold){var a=i.itemDef;if("equipmentPack"==a.type&&this.getBagItemsCount("equipment")>12)kit.info("\u7a7a\u95f4\u4e0d\u8db3");else if("materialPack"==a.type&&this.getBagItemsCount("material")>15)kit.info("\u7a7a\u95f4\u4e0d\u8db3");else{var n=this,o=function(){if(i.infiniteBuy||(i.opacity=100,i.sold=!0),i.merchantDefine&&(chapter.data.trainItemBuy[i.merchantDefine.id]=chapter.data.trainItemBuy[i.merchantDefine.id]||0,chapter.data.trainItemBuy[i.merchantDefine.id]++),i.merchantDefine&&i.merchantDefine.buyFunc)i.merchantDefine.buyFunc.bind(n)(a);else{var e=a.id,t=n.game.node.convertToWorldSpaceAR(cc.v2(0,0));n.game.addBagItem(e,i.lvl||a.lvl||1,t);var o=ItemDefine[e]&&ItemDefine[e].type;o&&(chapter.data.reddot[o]++,n.game.updateReddot())}};if(i.merchantDefine&&i.merchantDefine.ad)sdk.useFree("trainMerchant",function(e){e||(o(),n.adItemBought[i.merchantDefine.id]=!0)});else{var r=i.cost;if(chapter.get(SILVER)<r)return void kit.info("\u91d1\u94b1\u4e0d\u8db3");chapter.add(SILVER,-r,"cp_buy"),cc.game.emit("use_drop",{tid:"cp_buy",i:SILVER,n:-r}),o()}}}},buyItem:function(e,t){var i=10!=t&&this.items[t]||e.target;if(console.log("buyItem",i),!i.sold){var a=i.itemDef;if("equipmentPack"==a.type&&this.getBagItemsCount("equipment")>12)kit.info("\u7a7a\u95f4\u4e0d\u8db3");else if("materialPack"==a.type&&this.getBagItemsCount("material")>15)kit.info("\u7a7a\u95f4\u4e0d\u8db3");else{var n=i.cost;if(chapter.get(GOLD)<n)kit.info("\u91d1\u94b1\u4e0d\u8db3");else{chapter.add(GOLD,-n,"cp_buy"),cc.game.emit("use_drop",{tid:"cp_buy",i:GOLD,n:-n}),i.infiniteBuy||(i.opacity=100,i.sold=!0);var o=a.id;if("consumable"==a.type){chapter.data.combatItem[a.gameId]++;var r=this.game.node.convertToWorldSpaceAR(cc.v2(0,0));cc.game.emit("add_item",{pos:r,id:a.id})}else if("expPack"==a.type)chapter.add(EXP,20,"exp_pack"),cc.game.emit("add_drop",{i:EXP,tid:"exp_pack",n:20});else if("equipmentPack"==a.type){for(var s=i.lvl,c=1;c<=3;c++)l=1==c?s:kit.rndInt(1,3),o=(d=this.equipmentPool[l-1])[kit.rndInt(0,d.length-1)],r=this.game.node.convertToWorldSpaceAR(cc.v2(100*c-200,0)),this.game.addBagItem(o,l,r);this.game.bagUI.getComponent("bottomUI").showBlocks("equipment")}else if("materialPack"==a.type){for(s=i.lvl,c=1;c<=5;c++){var l,d;l=1==c?s:kit.rndInt(1,3),o=(d=this.materialPool[l-1])[kit.rndInt(0,d.length-1)],r=this.game.node.convertToWorldSpaceAR(cc.v2(100*c-300,0)),this.game.addBagItem(o,l,r)}this.game.bagUI.getComponent("bottomUI").showBlocks("material")}else console.log(this),r=this.game.node.convertToWorldSpaceAR(cc.v2(0,0)),this.game.addBagItem(o,i.lvl||a.lvl||1,r);this.game.bagUI.getComponent("bottomUI").showBlocks(ItemDefine[o].type)}}}},onTouchBegan:function(){},onTouchMoved:function(){},onTouchEnded:function(){},onTouchCanceled:function(){},closeMenu:function(){this.sellBlock.content&&this.game.moveToBag(this.sellBlock.content),this.game.popMerchant(!1)},getMoney:function(e){var t=function(t){t||e.target.opacity<255||(chapter.add(GOLD,50,"cp_free"),cc.game.emit("add_drop",{tid:"cp_free",i:GOLD,n:50}),e.target.opacity=100)}.bind(this);this.bonusMoneyAdFree?t():sdk.useFree("merchant_money",t)},refreshItems:function(e){e.target.opacity<255||(chapter.get(GOLD)<50?kit.info("\u91d1\u94b1\u4e0d\u8db3"):(chapter.add(GOLD,-50,"cp_refresh"),cc.game.emit("use_drop",{tid:"cp_refresh",i:GOLD,n:-50}),this.initItems(),e.target.opacity=100))},refreshItems2:function(e){var t=this;e.target.opacity<255||sdk.useFree("refreshItems2",function(e){e||t.initTrainItems()})}}).closeMenu=function(){this.game.cancelSpecialMode()},i.showBlocks=function(e,t){var i;for(var a in i="weapon"==t?0:"equipment"==t?1:2,this.sellTabs)this.sellTabs[a].opacity=128;this.sellTabs[i].opacity=255,this.game.bagUI.getComponent("bottomUI").showBlocks(t)},i)),cc._RF.pop()},{"./itemBlock":"itemBlock"}],MeshSprite:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"488acSg24BLe7ofNx9TlSDi","MeshSprite");var o=cc.gfx,r=function(e,t,i){return e+i*(t-e)};cc.Class({extends:cc.Component,properties:{offset:cc.v2(0,0),vertexes:[cc.Vec2],spriteFrame:{default:null,type:cc.SpriteFrame}},start:function(){},setPolyBySprite:function(){if(this.spriteFrame){var e=this.spriteFrame.getRect(),t=e.x-e.width/2,i=e.y-e.height/2,a=e.y+e.height/2,n=e.x+e.width/2;this.vertexes=[cc.v2(t,i),cc.v2(n,i),cc.v2(n,a),cc.v2(t,a)],this.uv=null,this._refreshAll()}},setPoly:function(e,t){e?(this.vertexes=e,this.uv=t,this._refreshAll()):this.setPolyBySprite()},getPoly:function(){return this.vertexes},_refreshAll:function(){this._initRender(),this._applySpriteFrame(),this._applyVertexes()},setMaterial:function(e,t){this._materialUpdate=!0,this.material=t,this.materialIndex=e},_initRender:function(){if(this.renderer){if(this.vertexesLength!=this.vertexes.length)throw new Error("vertexes length not match")}else{this.renderer=this.node.getComponent(cc.MeshRenderer)||this.node.addComponent(cc.MeshRenderer);var e=new cc.Mesh;e.init(new o.VertexFormat([{name:o.ATTR_POSITION,type:o.ATTR_TYPE_FLOAT32,num:2},{name:o.ATTR_UV0,type:o.ATTR_TYPE_FLOAT32,num:2}]),this.vertexes.length,!0),this.mesh=e,this.vertexesLength=this.vertexes.length}},_applyVertexes:function(){var e=this.mesh;if(e.setVertices(o.ATTR_POSITION,this.vertexes),this._calculateUV(),this.vertexes.length>3){for(var t=[],i=this.vertexes.length,a=0;a<i/2;a++)t.push(a),t.push(a+1),t.push(i-1-a),t.push(a+1),t.push(i-2-a),t.push(i-1-a);e.setIndices(t)}else 3===this.vertexes.length&&e.setIndices([0,1,2]);this.renderer.mesh=e},_calculateUV:function(){var e=this.mesh;if(this.spriteFrame){for(var t,a=this.spriteFrame.uv,n=this.spriteFrame.getRect(),s=a[0],c=a[6],l=a[3],d=a[5],h=[],u=i(this.uv||this.vertexes);!(t=u()).done;){var p=t.value,f=r(s,c,(p.x-n.x+n.width/2+this.offset.x)/n.width),m=r(l,d,(p.y-n.y+n.height/2-this.offset.y)/n.height);h.push(cc.v2(f,m))}e.setVertices(o.ATTR_UV0,h)}},_applySpriteFrame:function(){if(this._materialUpdate){this._materialUpdate=!1;var e=this.material,t=this.materialIndex;e||(e=cc.Material.getBuiltinMaterial("unlit")),this.renderer.setMaterial(t,e)}if(this.spriteFrame){var i=this.renderer.getMaterial(0);if(i){var a=this.spriteFrame.getTexture();i.define("USE_DIFFUSE_TEXTURE",!0),i.setProperty("diffuseTexture",a),i.setProperty("diffuseColor",this.node.color)}}}}),cc._RF.pop()},{}],MissileSprite:[function(e,t){"use strict";cc._RF.push(t,"44c50BkoMRJkpSH005w33db","MissileSprite"),cc.Class({extends:e("./BulletSprite"),updateRender:function(e){var t,i=this.obj;this.updateCircle(e)?(this.dx=(i.x-this.x)/STEP_TIME,this.dy=(i.y-this.y)/STEP_TIME,this.circled=!1,t=i.deg):(this.circled=!0,t=this.stepDeg>0?(this.startDeg+this.stepDeg+90+360)%360:(this.startDeg+this.stepDeg-90+360)%360);var a=kit.includeDegree(t,this.deg);this.dr=a/STEP_TIME},updateCircle:function(){var e=this.obj,t=e.x00,i=e.x0,a=e.x,n=e.y00,o=e.y0,r=e.y;if(o==n||o==r)return!0;var s=-(i-t)/(o-n),c=-(a-i)/(r-o);if(Math.abs(s-c)<.001)return!0;var l=(i+t)/2,d=(o+n)/2,h=(a+i)/2,u=(r+o)/2;this.cx=(u-d-c*h+s*l)/(s-c),this.cy=d+s*(u-d-c*h+c*l)/(s-c),this.r=kit.norm(i-this.cx,o-this.cy);var p=kit.vector2Degree(i-this.cx,o-this.cy),f=kit.vector2Degree(a-this.cx,r-this.cy),m=kit.includeDegree(f,p);this.startDeg=p,this.stepDeg=m,this.rate=0},updateReal:function(e){if(this.circled){var t=this.rate+10*e;this.rate=t,t>1&&(t=1);var i=this.startDeg+t*this.stepDeg;this.x=kit.degree2cos(i)*this.r+this.cx,this.y=kit.degree2sin(i)*this.r+this.cy}else this.x+=this.dx*e,this.y+=this.dy*e;this.deg=(this.deg+this.dr*e+360)%360;var a=this.node;a.x=this.x,a.y=this.y,a.angle=this.deg}}),cc._RF.pop()},{"./BulletSprite":"BulletSprite"}],Missile:[function(e,t){"use strict";cc._RF.push(t,"cd904nthN5IU4Xd6c2Ntnd2","Missile"),cc.Class({extends:e("./Bomb"),initStatus:function(){this._super(),this.target=this.config.target;var e=this.define;this.x00=this.x0-this.moveSpdX*STEP_TIME,this.y00=this.y0-this.moveSpdY*STEP_TIME,this.delayTimer=.05,this.moveSpdMax=this.moveSpd;var t=c_getValue(e.moveSpdTime,1);this.moveSpdSpd=this.moveSpdMax/t,this.moveSpd=c_getValue(e.moveSpdScale0,.5)*this.moveSpdMax,this.rttSpdMax=e.rttSpd||30,this.rttSpd=c_getValue(e.rttSpdScale0,0)*this.rttSpdMax;var i=c_getValue(e.rttSpdTime,1);this.rttSpdSpd=this.rttSpdMax/i,this.seekTimer=0,this.offsetDeg=c_getValue(e.offsetDeg,30),this.seekTargetTimer=this.define.seekTargetTime||0},seekTarget:function(){if(!this.target){var e=this.team;if(1==e)this.target=this.game.levelMgr.heroes[1];else{for(var t=this.game.getEntityList(),i=[],a=0;a<t.length;a++){var n=t[a];n._activeContact&&n.isInBorder()&&!n._sensor&&!n.isDead()&&n.team!=e&&i.push(n)}i.length>0&&(this.target=i[this.game.c_rndInt(0,i.length-1)])}}},updateLogic:function(e){var t=this.target;if(this.deg0=this.deg,this.moveSpd<this.moveSpdMax&&(this.moveSpd+=this.moveSpdSpd*e),t||(this.seekTargetTimer-=e,this.seekTargetTimer<=0&&(t=this.seekTarget())),t&&!t.isDead()&&t.isInBorder())if(this.delayTimer>0)this.delayTimer-=e;else{this.rttSpd<this.rttSpdMax&&(this.rttSpd+=this.rttSpdSpd*e),this.seekTimer-=e,this.seekTimer<=0&&(this.seekDeg=this.game.c_rnd(-this.offsetDeg,this.offsetDeg),this.seekTimer=.2);var i=t.x-this.x,a=t.y-this.y,n=c_vector2Degree(i,a)+this.seekDeg,o=this.rttSpd,r=c_includeDegree(n,this.deg);if(c_abs(r)<1)this.deg=n;else if(c_abs(r)>0){var s=r/c_abs(r)*o*e*5;c_abs(s)>c_abs(r)&&(s=r),this.deg=(this.deg+s+360)%360}}var c=c_degree2cos(this.deg),l=c_degree2sin(this.deg);this.moveSpdX=this.moveSpd*c,this.moveSpdY=this.moveSpd*l,this.x00=this.x0,this.y00=this.y0,this._super(e)}}),cc._RF.pop()},{"./Bomb":"Bomb"}],MoneyBar:[function(e,t){"use strict";cc._RF.push(t,"b9761IahctC6rKOdNx0mzco","MoneyBar"),cc.Class({extends:cc.Component,properties:{coinAudio:{type:cc.AudioClip,default:null},upAudio:{type:cc.AudioClip,default:null},buyAudio:{type:cc.AudioClip,default:null},goldLabel:cc.Label,gold:cc.Node,silverLabel:cc.Label,silver:cc.Node,expLabel:cc.Label,exp:cc.Node},onLoad:function(){this.showTable={},cc.game.on("add_drop",this.onAddMoney,this),cc.game.on("use_drop",this.onUseMoney,this),this.layout=this.getComponent(cc.Layout),this.initMoney(GOLD,this.goldLabel,this.gold,1e3),this.initMoney(EXP,this.expLabel,this.exp,10),this.initMoney(SILVER,this.silverLabel,this.silver,100);var e=sdk.pt();if(e&&e.getMenuButtonBoundingClientRect){var t=e.getMenuButtonBoundingClientRect(),i=cc.view.getDevicePixelRatio(),a=sdk.getSafeAreaRect(),n=cc.winSize.height-a.y-a.height,o=t.bottom*i/cc.view.getScaleX()-n;this.node.getComponent(cc.Widget).top=o}},getMoneyData:function(e){return chapter.data[e]||0},init:function(e){this.args=e,this.money=e.money,this.visible=e.visible,this.initMoney(GOLD,this.goldLabel,this.gold,1e3),this.initMoney(EXP,this.expLabel,this.exp,10),this.initMoney(SILVER,this.silverLabel,this.silver,100)},initMoney:function(e,t,i,a){cc.log("initMoney",e,t,i,a);var n=this.getMoneyData(e),o=n>0;this.money&&void 0!==this.money[e]&&(n=this.money[e],o=!0),this.visible&&this.visible[e]&&(o=!0);var r=i.getParent();this.showTable[e]={type:e,s:a,n0:n,n1:n,label:t,node:i,fly:0},r.active=o,t.string=Math.floor(n)},updateMoney:function(e){e.n1!=e.n0&&(Math.abs(e.n1-e.n0)<1?e.n0=e.n1:e.n0=e.n0+.1*(e.n1-e.n0),e.label.string=Math.round(e.n0))},update:function(){for(var e in this.showTable)this.updateMoney(this.showTable[e])},onUseMoney:function(e){var t=e.i,i=this.showTable[t],a=kit.clamp(Math.round(-(e.n||1)/i.s),1,10),n=i.node,o=n.getParent();i.fly++,o.active=!0,this.layout.updateLayout(),o.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){i.fly--,0==i.fly&&(i.n1=this.getMoneyData(t))},this))),i.n1+=e.n,menuManager.playEffect(this.buyAudio,0);for(var r=cc.Canvas.instance.node,s=e.pos||cc.v2(cc.winSize.width/2,cc.winSize.height/2),c=r.convertToNodeSpaceAR(s),l=r.convertToNodeSpaceAR(o.convertToWorldSpaceAR(cc.v2(0,0))),d=0;d<a;d++){var h=cc.instantiate(n);r.addChild(h,cc.macro.MAX_ZINDEX),h.scale=1,h.x=l.x+kit.rnd(-50,50),h.y=l.y+kit.rnd(-50,50),h.runAction(cc.sequence(cc.bezierTo(.5,[cc.v2(l.x+kit.rnd(-200,200),l.y+kit.rnd(-200,0)),cc.v2(c.x+kit.rnd(-150,150),c.y+kit.rnd(-50,50)),c]).easing(cc.easeInOut(1)),cc.destroySelf()))}},onAddMoney:function(e){var t=e.add;if(t)for(var i in this.showTable)this.addMoney(i,t[i],e.pos);else this.addMoney(e.i,e.n,e.pos)},addMoney:function(e,t,i){if(e&&t){var a=this.showTable[e];if(a){var n=kit.clamp(Math.round((t||1)/a.s),1,10),o=a.node,r=o.getParent();r.active=!0,a.fly++,this.layout.updateLayout(),r.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){a.fly--,0==a.fly&&(a.n1=this.getMoneyData(e))},this))),r.runAction(cc.sequence(cc.delayTime(.3),cc.callFunc(function(){a.n1+=t,menuManager.playEffect(this.upAudio,0)},this)));var s=cc.Canvas.instance.node,c=(i=i||cc.v2(cc.winSize.width/2,cc.winSize.height/2),s.convertToNodeSpaceAR(i)),l=s.convertToNodeSpaceAR(r.convertToWorldSpaceAR(cc.v2(0,0)));menuManager.playEffect(e==ENERGY?this.energyAudio:this.coinAudio,0);for(var d=0;d<n;d++){var h=cc.instantiate(o);s.addChild(h,cc.macro.MAX_ZINDEX),h.scale=1,h.x=c.x+kit.rnd(-20,20),h.y=c.y+kit.rnd(-20,20),h.runAction(cc.sequence(cc.bezierTo(.3,[cc.v2(c.x+kit.rnd(-200,200),c.y+kit.rnd(-200,200)),cc.v2(l.x+kit.rnd(-200,200),l.y+kit.rnd(-200,0)),l]).easing(cc.easeIn(1)),cc.destroySelf()))}}}},start:function(){}}),cc._RF.pop()},{}],MoneyPack:[function(e,t){"use strict";cc._RF.push(t,"21e65QG5VNG24g1J2ZfxUJN","MoneyPack"),e("../../scripts/define");var i=e("../environment/MyTower"),a=(e("../projectiles/Bomb"),e("../projectiles/MissileSprite"),e("../projectiles/BallBulletSprite"),e("../../ai/units/AIMyTower"),e("../../components/visual/Avatar"));ENTITY.moneyPack={id:"moneyPack",hero:!0,category:"moneyPack",name:"\u94b1\u5305",avatar:{ctor:a,frm:"avatar/backpack/item/\u94b1\u888b\u5b50",moveSpd:150,ay:.01},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},createCb:function(){}},ENTITY.moneyPack_2={id:"moneyPack_2",hero:!0,category:"moneyPack",name:"\u94b1\u53052",avatar:{ctor:a,frm:"avatar/backpack/item/\u94b1\u888b\u5b502",moveSpd:150,ay:.01},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},createCb:function(){}},ENTITY.moneyPack_3={id:"moneyPack_3",hero:!0,category:"moneyPack",name:"\u94b1\u53053",avatar:{ctor:a,frm:"avatar/backpack/item/\u94b1\u888b\u5b503",moveSpd:150,ay:.01},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},createCb:function(){}},ENTITY.moneyPack_4={id:"moneyPack_4",hero:!0,category:"moneyPack",name:"\u94b1\u53054",avatar:{ctor:a,frm:"avatar/backpack/item/\u94b1\u888b\u5b504",moveSpd:150,ay:.01},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},createCb:function(){}},cc._RF.pop()},{"../../ai/units/AIMyTower":"AIMyTower","../../components/visual/Avatar":"Avatar","../../scripts/define":"define","../environment/MyTower":"MyTower","../projectiles/BallBulletSprite":"BallBulletSprite","../projectiles/Bomb":"Bomb","../projectiles/MissileSprite":"MissileSprite"}],MortarBomb:[function(e,t){"use strict";cc._RF.push(t,"e9535hNkf9GypkyNxwpEaHQ","MortarBomb"),cc.Class({extends:e("./ContactBullet"),initStatus:function(){var e;this._super();var t=this.define.bomb;t&&(this.bombDmg=this.config.bombDmg||t.dmg0,this.bombStep=(t.dmg1-t.dmg0)/t.dmg0),this.x00=this.x0,this.y00=this.y0,this.seekTarget(),this.tx=(null==(e=this.target)?void 0:e.x)||this.x+kit.rnd(500,1e3)},seekTarget:function(){if(!this.target){var e=this.team;if(1==e)this.target=this.game.levelMgr.heroes[1];else{for(var t=this.game.getEntityList(),i=[],a=0;a<t.length;a++){var n=t[a];n._activeContact&&n.isInBorder()&&!n._sensor&&!n.isDead()&&n.team!=e&&i.push(n)}i.length>0&&(this.target=i[this.game.c_rndInt(0,i.length-1)])}}},onRemove:function(e){var t=this.config.cb;t&&!t(this)||this.explosion(e),this._super(e)},remove:function(e){this.removed||(this.removed=!0,this.define.latency?(this.define.bomb.preEffect&&this.game.callEffect(this.define.bomb.preEffect,this.x,this.y,this.define.bomb.r1),this.explodeTimer=this.define.latency):this.onRemove(e))},updateLogic:function(e){if(this._super(e),this.explodeTimer&&(this.explodeTimer-=e,this.explodeTimer<=0&&(this.onRemove(BULLET_FADE_TYPE.TIME_OUT),this.explodeTimer=null)),this.y>1500&&!this.dropBomb){this.x=this.tx+kit.rnd(-20,20),this.deg=-90,this.dropBomb=!0;var t=c_degree2cos(this.deg),i=c_degree2sin(this.deg);this.moveSpdX=this.moveSpd*t,this.moveSpdY=this.moveSpd*i}},explosion:function(e){var t=this.define.bomb;if(!t.exploFunc||!t.exploFunc.call(this,e)){var i=t.r1,a=t.r0,n=this.bombDmg,o=this.bombStep,r=t.kb,s=this.x,c=this.y,l=this.team,d=this.obj;d.bltExploRange&&(i*=d.bltExploRange);var h=this.game.contactMgr.getContactList();for(var u in h){var p=h[u],f=p.getEntity();if(p._activeContact&&f.isInBorder()&&f.team!=l){var m=p.hitRadius+i,g=s-p.getPositionX(),v=c-p.getPositionY(),y=g*g+v*v;if(y<=m*m){var b=c_sqrt(y)+.1;if(b<=a)f.onHurt(this,n,t.weaponType,t.dmgType);else{var k=n*(1+o*(b-a)/(m-a));f.onHurt(this,k,t.weaponType,t.dmgType)}var T=t.buff;T&&f.addBuff(this,T);var _=r/(b*f.weight);if(f.onKnockback(-g*_,-v*_),f.isDead())if(f.y<=f.height+this.game.contactMgr.findGroundLine(f.x)){var w=g>0&&kit.rnd(-600,-350)||kit.rnd(350,600);f.applyVelocity(w,kit.rnd(1e3,1250))}else{var E=kit.rnd(750,1e3),C=(w=-g/(Math.abs(g)+Math.abs(v))*E,-v/(Math.abs(g)+Math.abs(v))*E);f.applyVelocity(w,C)}}}}var S=this.hurtDelayTime;t.effect&&this.game.callEffect(t.effect,s,c,i,S)}}}),cc._RF.pop()},{"./ContactBullet":"ContactBullet"}],Mortar:[function(e,t){"use strict";cc._RF.push(t,"dfc283huqBJsbJMiZ8lInYx","Mortar"),e("../../scripts/define");var i=e("../environment/MyTower"),a=e("../../ai/units/AIMyTower"),n=[{t:.4,x:133,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.launchSmokeAvatar},{t:.4,x:133,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.launchSmokeAvatar},{t:.4,x:133,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.launchSmokeAvatar},{t:2.5,ani:0}];BULLET_DEFINE.mortar=[{ctor:e("./MortarBomb"),name:"\u70ae\u5f39",noContact:1,avatar:{ctor:e("./BallBulletSprite"),frm:"avatar/daodan",sx:1,sy:1,noBlend:!0},bomb:{r1:70,r0:50,dmg1:150,dmg0:150,kb:300,effect:EFFECT.mortarBomb,weaponType:WEAPON_TYPE.building},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:1555,spdFluc:0,gravity:-55,distance:3450,disExtra:100},{name:"\u673a\u67aa\u8fc7\u70ed",avatar:{sx:.4,sy:.6,sx1:.5,sy1:1,st:.02,frm:"avatar/98k",hitEffect:EFFECT.yellowHit,noBlend:!0,hitFloorEffect:EFFECT.hitFloorSmoke},length:20,kb:.02,n:1,wd:0,d:14,spd:2200,spdFluc:.2,distance:1e3,thrDecline:1,thrChance:0}],ENTITY.mortar={id:"mortar",hero:!0,category:"mortar",name:"\u8feb\u51fb\u70ae",avatar:{animeName:"daodan",anime:"weapon/daodan",s:1,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:47,bombDmg:47,blt:BULLET_DEFINE.mortar,bltMax:40,bltReload:1,attackCenter:cc.v2(5.775,0),attackVolume:.3,attackSequence:n,attackAngle:[-40,100],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23,fixAtkDeg:90}},RES[MACHINE_GUN]=[{anime:"weapon/jiqiang"},"avatar/98k","sound/machine_gun",RES.yellowHit],ENTITY.mortar_2={id:"mortar_2",hero:!0,category:"mortar",name:"\u8feb\u51fb\u70ae2",avatar:{animeName:"daodan2",anime:"weapon/daodan",s:1,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:71,bombDmg:71,blt:BULLET_DEFINE.mortar,bltMax:40,bltReload:1,attackCenter:cc.v2(12.25*1.1,-5.5),attackVolume:.3,attackSequence:n,attackAngle:[-40,100],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23,fixAtkDeg:90}},ENTITY.mortar_3={id:"mortar_3",hero:!0,category:"mortar",name:"\u8feb\u51fb\u70ae3",avatar:{animeName:"daodan3",anime:"weapon/daodan",s:1,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:107,bombDmg:107,blt:BULLET_DEFINE.mortar,bltMax:40,bltReload:1,attackCenter:cc.v2(12.25*1.1,-5.5),attackVolume:.3,attackSequence:n,attackAngle:[-40,100],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23,fixAtkDeg:90}},ENTITY.mortar_4={id:"mortar_4",hero:!0,category:"mortar",name:"\u8feb\u51fb\u70ae4",avatar:{animeName:"daodan4",anime:"weapon/daodan",s:1,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:161,bombDmg:161,blt:BULLET_DEFINE.mortar,bltMax:40,bltReload:1,attackCenter:cc.v2(12.25*1.1,-5.5),attackVolume:.3,attackSequence:n,attackAngle:[-40,100],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23,fixAtkDeg:90}},cc._RF.pop()},{"../../ai/units/AIMyTower":"AIMyTower","../../scripts/define":"define","../environment/MyTower":"MyTower","./BallBulletSprite":"BallBulletSprite","./MortarBomb":"MortarBomb"}],Mover:[function(e,t){"use strict";cc._RF.push(t,"a851aWqJUNOUIH7utFtR5Ix","Mover"),cc.Class({extends:cc.Component,properties:{left:-100,right:100,speed:50,rotate:0},onLoad:function(){this.body=this.getComponent(cc.RigidBody),this.body.type=cc.RigidBodyType.Kinematic,this.x0=this.node.x+this.left,this.x1=this.node.x+this.right,this.v0=cc.v2(Math.abs(this.speed),0),this.v1=cc.v2(-Math.abs(this.speed),0),this.body.linearVelocity=this.v0,this.body.angularVelocity=this.rotate},update:function(){this.node.x<this.x0?this.body.linearVelocity=this.v0:this.node.x>this.x1&&(this.body.linearVelocity=this.v1)}}),cc._RF.pop()},{}],Multiplier:[function(e,t){"use strict";cc._RF.push(t,"63217CSO+pPI7Ed4G3lXvPn","Multiplier"),cc.Class({extends:cc.Component,properties:{multiTime:2,multiLabel:cc.Label},onLoad:function(){this.multiLabel&&(this.multiLabel.string="x"+this.multiTime),this.cloneList=[]},cloneBall:function(e){if(e){var t=e.node;if(!(t.cloneHeight<=this.node.y)){t.cloneHeight=this.node.y;for(var i=t.getComponent(cc.RigidBody).linearVelocity,a=this.multiTime,n=1;n<a;n++)this.cloneList.push({v:i,angle:t.angle,x:t.x,y:t.y,ballIndex:t.ballIndex})}}},update:function(){var e=this.cloneList;if(!(e.length<=0)){var t=e.shift(),i=t.ballIndex,a=pinballManager.createBall(i);a.x=t.x+kit.rnd(-10,10),a.y=t.y+kit.rnd(-10,10),a.angle=t.angle,a.cloneHeight=this.node.y,a.getComponent(cc.RigidBody).linearVelocity=t.v}},onBeginContact:function(e,t,i){var a=i.getComponent("Ball");this.cloneBall(a)},onEndContact:function(){}}),cc._RF.pop()},{}],MyTower:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"8441bH6UP1PMZj93b6q1Ue0","MyTower"),e("../../components/attributes/Attribute"),e("../projectiles/Bullet");var o=e("../../components/combat/buffs/Buff");window.HEAT_MODE=5,cc.Class({extends:e("../../core/base/Entity"),getOwner:function(){return this},getCaster:function(){return this},getGlobal:function(e){var t=this.getBase();if(t){var i=t.config.attr;if(i){var a=i.global;if(a)return a[e]}}},getAtkScale:function(e,t,i,a){var n=this.getBase(),o=this._super();if(n){var r=1;if(e.bossFlag){var s=this.getBase();s&&s.attribute.get("atk2Boss")&&(r+=+s.attribute.get("atk2Boss"))}return r*o*n.getAtkScale(e,t,i,a)}return o},init:function(e,t,i){if(this.towerFlag=!0,this.define=t,this.config=i,this.game=e,this.hero=i.hero,this.removeTimer=i.life||10,cc.log("MyTower init",this.define.id,this._y),this.initFlags(),this.initAttributes(),this.initStatus(),this.initBuffs(),this.initPilot(),cc.log("MyTower init 2",this.define.id,this._y),this.initAvatar(),t.noContact||this.game.contactMgr.addEntity(this),this.game.addRender(this),this.game.addUpdate(this),this.initShapes(),this.initBonus(),this.hp<=0&&this.initDeath(),this._inBorder=!0,cc.log("MyTower config",i),this.config.buff){var a=BuffDefine[this.config.buff];this.addBuff(this,a,{})}this.define.buff&&(a=this.define.buff,this.addBuff(this,a,{})),t.createCb&&t.createCb.call(this),this.initTalent(),window.pinballManager&&pinballManager.addTower(this)},initTalent:function(){var e=this.game.remotes.talent;Talent.effect("unitSpawnEffect",e,this)},onHurt:function(){this.obj&&this.obj.onHurt.apply(this.obj,arguments)},initBonus:function(){this.game;var e=this.config;this.define,cc.warn("Turret Buff Overview",this.define.name,this.config.towerIndex);var t=e.buffList,i=e.attrList;if(t)for(var a in t)cc.warn("buffList",a,t[a].debugName),this.addBuff(this,t[a]);if(i){for(var n in i)cc.warn("attrList",n,i[n].debugName,JSON.stringify(i[n]));this.addBuff(this,{symbol:o.getSymbol(),Buff:o,t:1/0,attr:i})}var r=["atkSpd","critChance","critBonus","bltHurtScale","explodeHurtScale","fireHurtScale","crashHurtScale"];for(var s in r){var c=r[s],l=this.getGlobal(c);l&&(cc.warn("global add scale",this.define.name,c,+l),this.attribute.addScale(c,+l))}var d=this.getGlobal("hp4weapon");d&&this.attribute.addScale("hpMax",+d),this.hp=this.hpMax,void 0!==e.hp&&(this.hp=c_clamp(this.hpMax*e.hp,0,this.hpMax))},initDeath:function(){if(!this.deathAction){this.deathAction=!0,this.setFlag(NO_ATTACK,!0),this.setFlag(NO_MOVE,!0),this.setFlag(NO_ROTATE,!0),this.setFlag(NO_ENTITY,!0);var e=this.avatar;e.setForcedAnime("dead",1,0,1),e.refresh(0,!0,!0),this.hero&&this.hero.initDeath()}},initStatus:function(){this._super();var e=this.define,t=this.config,i=t.base,a=t.slot;i&&(this.obj=t.base,this.deg=0,this._x=a.dx||0,this._y=a.dy||0,this.team=i.team),a.backpack&&(this.unitType=BackpackItemDefine[a.backpack.id].type),this.heatMin=e.heatMin||99,this.heatUp=e.heatUp||0,this.heatUpOnShot=e.heatUpOnShot||0},initAttributes:function(){var e=this;this._super();var t=this.define,i=(this.config,this.attribute);this.heat=0,i.init("heatMax",t.heatMax||100,1e10,0,function(t){e.heatMax=t,e.heat>t&&(e.heat=t)}),i.init("heatTime",2,1e10,0,function(t){e.heatTime=t}),this.heatTimer=this.heatTime;var a=1,n=this.getGlobal("atk4heat");n&&(a=+n+1),i.init("heatScale",a,1e10,0,function(t){e.heatScale=t}),i.init("heatDown",t.heatDown||-20,0,-1e10,function(t){e.heatDown=t}),i.init("heatOverDown",t.heatOverDown||t.heatDown||-20,0,-1e10,function(t){e.heatOverDown=t})},onContact:function(e){e.armorType!==ARMOR_TYPE.machine&&e.armorType!==ARMOR_TYPE.building||this.onHurt(e,Math.pow(e.hp,e.crashScale),null,DMG_TYPE.crash),e.applyVelocity&&e.applyVelocity(2,300),e.callDeath(this,0)},getHeatScale:function(){return this.heatScale},getBase:function(){return this.obj},getPositionX:function(){return this.obj?this.obj.x+this._x:this._x},getPositionY:function(){return this.obj?this.obj.y+this._y:this._y},getDegree:function(){return this.obj?this.obj.deg+this._deg:this._deg},startHeatMode:function(){if(!this.heatOn){this.heatOn=!0,this.bltCt=this.bltMax,this.reloadAction=!1;var e=this.define.heat,t=e.attr;for(var i in t)this.attribute.add(i,t[i]);e.attackVolume&&(this.attackVolume=e.attackVolume),e.attackSound&&(this.attackSound=e.attackSound),e.attackSequence&&(this.config.canon4combo&&e.attackSequence4?this.attackSequence=e.attackSequence4:this.attackSequence=e.attackSequence,this.clearAttack(),this.startAttack()),e.add&&(this.heat+=e.add),this.game.callEffect(EFFECT.overHeatSmokePersist,this)}},getFlag:function(e){return!(!this.obj||e!==NO_ATTACK||!this.obj.getFlag(e))||this._super(e)},stopHeatMode:function(){if(this.heatOn){this.heatOn=!1;var e=this.define.heat,t=e.attr;for(var i in t)this.attribute.add(i,-t[i]);e.attackVolume&&(this.attackVolume=this.define.attackVolume),e.attackSound&&(this.attackSound=this.define.attackSound),e.attackSequence&&(this.attackSequence=this.define.attackSequence,this.clearAttack(),this.startAttack())}},addHeat:function(e){this.heat+=e,this.heat>=this.heatMax&&(this.callHeatOver(!0),this.heat=this.heatMax)},isHeatOver:function(){return this.heatOver||this.heatTimer<=0},updateHeatMode:function(e){this.heatTimer<=0?(this.heat+=this.heatOverDown*e,this.heat<0&&(this.heat=0,this.heatTimer=this.heatTime,this.heatOver=!1)):this.heatPressed?this.heatOn&&(this.getFlag(NO_ATTACK)||this.addHeat(this.heatUp*e)):(this.heatOver?this.heat+=this.heatOverDown*e:this.heat+=this.heatDown*e,this.callHeatOver(!1),this.heat<0&&(this.heat=0)),this.heatOver&&this.heatTimer>0&&(this.heatTimer-=e);var t=this.define.overHeat;if(this.isHeatOver()&&!this.heatOverBuff){this.heatOverBuff=!0;var i=t.attr;for(var a in i)this.attribute.add(a,i[a]);t&&t.attackSound&&this.resetAttackSound(t.attackSound),t&&t.attackSequence&&(this.attackSequence=t.attackSequence)}else if(!this.isHeatOver()&&this.heatOverBuff){this.heatOverBuff=!1;var n=t.attr;for(var o in n)this.attribute.add(o,-n[o]);if(this.heatOn){var r=this.define.heat;t&&t.attackSound&&r.attackSound&&this.resetAttackSound(r.attackSound),t&&t.attackSequence&&r.attackSequence&&(this.config.canon4combo&&r.attackSequence4?this.attackSequence=r.attackSequence4:this.attackSequence=r.attackSequence)}else t&&t.attackSound&&this.resetAttackSound(this.define.attackSound),t&&t.attackSequence&&(this.attackSequence=this.define.attackSequence)}},resetAttackSound:function(e){this.attackSound=e,void 0!==this.attackAudio&&(this.stopAttackSound(),this.startAttackSound())},callHeatOver:function(e){e?this.heatOver||(this.heatOver=!0,this.game.effectMgr.playEffect("sound/overheat",null,2),cc.game.emit("overHeat")):this.heatOver&&this.heat<=this.heatMin&&(this.heatOver=!1,this.heatTimer=this.heatTime)},callHeat:function(e){this.heatPressed=e===BTN_DOWN,this.heatPressed&&this.startHeatMode()},shot:function(e){this._super(e),this.heatOn&&this.bltMax>0&&(this.bltCt=this.bltMax),this.heatTimer>0&&this.heatOn&&this.heatUpOnShot&&this.addHeat(this.heatUpOnShot)},updateAttack:function(e){if(window.pinballManager){if(this.pinballCt>0&&!this.isDead()){var t;this.pinballCt--;for(var a=i(this.attackSequence);!(t=a()).done;){var n=t.value;n.blt&&this.shot(n)}}}else this._super(e)},stopAttack:function(){if(this.heatOn&&!this.heatPressed&&this.stopHeatMode(),this.autoAttack&&!this.getFlag(NO_ATTACK)){this.attackIndex=0;var e=this.attackSequence[0];void 0!==e.ani?(this.attackPlay=e.ani,this.attackPlay&&this.avatar.refresh(.1,!0)):(this.attackPlay=1,this.avatar.refresh(.1,!0)),this.attack(),this.avatar.refresh(ZERO,!0)}else this.clearAttack()},updateDeath:function(e){this.deathAction?this.removeTimer:this.lifeTimer&&this.lifeTimer>0&&(this.lifeTimer-=e,this.lifeTimer<=0&&this.callDeath(this))},callDeath:function(e,t,i,a){if(!this.deathAction){var n=this.game,o=this.define;this.hp=0,this.deathAction=!0,this.removeTimer=.1,this.setFlag(NO_ATTACK,!0),this.setFlag(NO_MOVE,!0),this.setFlag(NO_ROTATE,!0),this.setFlag(NO_ENTITY,!0);var r=this.avatar,s=(e.hurtDelayTime||.05)+.1;this.deathFade=!0,r.setForcedAnime("dead",1,s,1),r.refresh(.3,!0,!0);var c=o.deathEffect||EFFECT.towerDeath;n.callEffect(c,r),n.eventMgr.check(this,"deathEvent",e,t,i),n.eventMgr.on(e.getOwner(),"killEvent",this,t,i),this.hero&&this.hero.callDeath(e,t,i,a)}},callVehicleDeath:function(e,t,i){var a=this.game;this.define,this.deathAction||(this.hp=0,this.deathAction=!0,this.setFlag(NO_ATTACK,!0),this.setFlag(NO_MOVE,!0),this.setFlag(NO_ROTATE,!0),this.setFlag(NO_ENTITY,!0),a.eventMgr.check(this,"deathEvent",e,t,i),a.eventMgr.on(e.getOwner(),"killEvent",this,t,i)),a.callEffect(EFFECT.towerDeath2,this.avatar)},callVehicleRevive:function(e,t){if(this.game,this.define,this.deathAction){this.deathAction=!1,this.setFlag(NO_ATTACK,!1),this.setFlag(NO_MOVE,!1),this.setFlag(NO_ROTATE,!1),this.setFlag(NO_ENTITY,!1);var i=this.avatar;i.setForcedAnime(),i.refresh(.5),i.setVisible(!0),i.setUIVisible(!0),this.onHeal(e,t)}},updateLogic:function(e){this.pilot.updateLogic(e),this.updateDeath(e),this.updateHeatMode(e),this.updateRotate(e),this.updateAttack(e)},setUIVisible:function(e){this.avatar.setUIVisible(e)}}),cc._RF.pop()},{"../../components/attributes/Attribute":"Attribute","../../components/combat/buffs/Buff":"Buff","../../core/base/Entity":"Entity","../projectiles/Bullet":"Bullet"}],MyVehicle:[function(e,t){"use strict";cc._RF.push(t,"b84de7KHiFAW6X3umv3h4Y7","MyVehicle"),e("../components/attributes/Attribute"),e("../entities/projectiles/Bullet");var i=e("../components/combat/buffs/Buff"),a=e("../managers/LevelManager"),n={v1:147,v3:167};cc.Class({extends:e("../entities/vehicles/Vehicle"),getGlobal:function(e){var t=this.config.attr;if(t){var i=t.global;if(i)return i[e]}},initTemp:function(){},init:function(e,t,i){i=a.computeBuffAndAttr(i),this.initTemp(t,i),this.aiMode=e.config.auto,cc.warn("MyVehicle config",i),this.vehicleFlag=!0,this.define=t,this.config=i,this.game=e,this.initFlags(),this.initAttributes(),this.initStatus(),this.initBuffs(),this.game.addUpdate(this),this.game.addRender(this),this.game.contactMgr.addEntity(this),this.initPhysics(),this.initAvatar(),this.initSub(),this.initSkills(),this.initPilot(),this.initDebug(),this.initShapes(),this._inBorder=!0,this.initBonus(),this.initTalent(),this.hp=this.hpMax,void 0!==i.hp&&(this.hp=c_clamp(this.hpMax*i.hp,0,this.hpMax))},initShapes:function(){var e;this.shapes=[],this.backpack&&(e=this.backpack),e&&this.addBlockShape(e.blockData)},createShape:function(e){var t=e.x,i=e.y,a=e.radius,n=this,o={ox:t,oy:i,uniqueID:-this.uniqueID,get x(){return n.x+this.ox},get y(){return n.y+this.oy},getPositionX:function(){return n.x+this.ox},getPositionY:function(){return n.y+this.oy},isInBorder:function(){return n.isInBorder()},updateOxy:function(e){var a=c_degree2sin(e),n=c_degree2cos(e);this.ox=t*n-i*a,this.oy=t*a+i*n},radius:a,hitRadius:a,getEntity:function(){return n}};return this.game.contactMgr.addEntity(o),o},addBlockShape:function(e){if(!this.blockAdded){this.blockAdded=!0;var t=0,i=[];for(var a in cc.log("addBlock",e),e){var n=null;for(var o in e[a])e[a][o]&&(n=o);if(n){var r={radius:45,hitRadius:45},s=72*(n-2),c=76.5*(6-a);r.x=s,r.y=c,i.push(r),t=a}}for(var a in i)i[a].y-=45*(6-t)-150,this.shapes.push(this.createShape(i[a]));cc.log("addBlockShape",i)}},initTalent:function(){var e=this.game.remotes.talent;Talent.effect("unitSpawnEffect",e,this)},initBonus:function(){this.game;var e=this.config;this.define,cc.warn("Tank Buff Overview",this.define.name);var t=this.getGlobal("cd0"),a=this.config.cd;if(a)for(var n in a){var o=a[n];t&&(cc.warn("global cd a",this.define.name,t),o=c_clamp(o-t,0,1)),this.setSkillCDPercent(n,o)}else t&&(cc.warn("global cd b",this.define.name,t),this.setSkillCDPercent(n,1-t));var r=e.buffList,s=e.attrList;if(r)for(var c in r)cc.warn("buffList",c,r[c].debugName),this.addBuff(this,r[c]);if(s){for(var l in s)cc.warn("attrList",l,s[l].debugName,JSON.stringify(s[l]));this.addBuff(this,{symbol:i.getSymbol(),Buff:i,t:1/0,attr:s})}var d=this.getGlobal("hp4vehicle");d&&(this.attribute.addScale("hpMax",+d),cc.warn("hp4vehicle to",this.hpMax));var h=["bltHurtScale","explodeHurtScale","fireHurtScale","crashHurtScale"];for(var u in h){var p=h[u],f=this.getGlobal(p);f&&(cc.warn("global add scale",this.define.name,p,+f),this.attribute.addScale(p,+f))}var m=this.getGlobal("revive");m&&this.addBuff(this,BUFF_DEFINE.avoidDeath,{hp:+m})},initSub:function(){var e,t,i,a,n,o;this.subDeg=null,this.aiTimer=5,this.game;var r=this.config;for(var s in this.define,cc.log("MyVehicle config",r,null==(e=chapter)?void 0:null==(t=e.data)?void 0:null==(i=t.backpack)?void 0:i.blockData,this.game.remotes),this.backpack=this.game.remotes.backpack||(null==(a=chapter)?void 0:null==(n=a.data)?void 0:n.backpack),this.backpack&&(this.backpack=kit.clone(this.backpack)),null!=(o=this.backpack)&&o.blockData&&this.avatar.prepareToAddBlock(this.backpack.blockData),this.heroes={},r.heroes)r.heroes[s];for(var c in this.towers={},this.initTowerSlotsFromTowers(),r.towers){var l=r.towers[c];this.addTower(l,c)}this.stackHeight=1,this.avatar.addStage(this.stackHeight)},changeTower:function(e,t){this.config.towers[e].i=t,this.towers[e].remove(),this.addTower(this.config.towers[e],e)},addHero:function(e,t){if(e&&e.i){var i=this.define,a=this.game,n=ENTITY[e.i];e.base=this,e.slot=i.heroSlots[t];var o=a.levelMgr.createObject(n,e);return this.heroes[t]=o,o}},initTowerSlotsFromTowers:function(){if(this.config.towers[0]&&this.config.towers[0].backpack){var e=this.config.towers,t=[];for(var i in e){var a=BackpackItemDefine[e[i].backpack.id],n=45*(e[i].x-2)+(a.unitDx||0),o={name:"yuandian",dy:45*(6-e[i].y)-2-45*(6-e[i].stage),dx:n,backpack:e[i].backpack};t.push(o)}this.towerSlots=t}else this.towerSlots=this.define.towerSlots;cc.log("initTowerSlotsFromTowers towerSlots",e)},checkBackpackTowerUpgrade:function(e){for(var t in this.config.towers)if(this.config.towers[t].backpack.id==e&&BackpackItemDefine[e].upgrade)return this.towers[t]},addBackpackTower:function(e){for(var t in this.config.towers)if(this.config.towers[t].backpack.id==e){var i=BackpackItemDefine[e].upgrade;if(i){var a=BackpackItemDefine[i].unitID;return this.changeTower(t,a),this.subDeg=null,this.updateSub(),this.towers[t]}}if(BackpackUtil.pushItem(e,this.backpack)){this.config.towers=BackpackUtil.transformBlockItemDataToTowersData(this.backpack),this.initTowerSlotsFromTowers();var n=this.config.towers[this.config.towers.length-1];return this.addTower(n,this.config.towers.length-1),this.subDeg=null,this.updateSub(),this.towers[this.config.towers.length-1]}},addTower:function(e,t){if(e&&e.i){this.define;var i=this.game,a=ENTITY[e.i];e.towerIndex=t,e.base=this,e.slot=this.towerSlots[t],e.hero=this.heroes[t],e.m||(e.ai=1),cc.log("Vehicle addTower",e);var n=i.levelMgr.createObject(a,e);(this.game.config.gunnerMode||e.m&&!this.mainTower)&&(this.mainTower=n,n.mainFlag=!0,n.callAutoAttack(!0),2==this.aiMode&&(n.pilot.initAI(1),n.callHeat(BTN_DOWN))),this.towers[t]=n}},updateSub:function(e){var t=this._deg;if(this.subDeg!=t){this.subDeg=t;var i=c_degree2sin(t),a=c_degree2cos(t),o=this.config,r=this.define;for(var s in o.heroes){var c=this.heroes[s];if(c){var l=r.heroSlots[s],d=l.dx||0,h=l.dy||0;c._x=d*a-h*i,c._y=d*i+h*a,c._deg=t}}for(var u in o.towers){var p=this.towers[u];if(p){var f=this.towerSlots[u],m=1.7*(f.dx||0),g=1.7*(f.dy||0)+n[this.define.id];p._x=m*a-g*i,p._y=m*i+g*a,p._deg=t}}for(var v in this.shapes)this.shapes[v].updateOxy(t)}if(this.fighters){if(this.game.finished){for(var y in this.fighters){var b=this.fighters[y],k=b.x-this.x,T=b.y-(this.y+100);this.isDead()?b.callDeath(this,0):(this.avatar.setBenchVisible(b.benchIndex,!0,k,T),b.remove())}this.fighters=null}}else if(!this.getFlag(NO_ATTACK)&&!this.game.finished){var _=this.config;for(var w in this.fighters=[],_.bench)if(_.bench[w].fighter){this.avatar.setBenchVisible(w,!1);var E=this.game.levelMgr.createObject(ENTITY.xuela,{x:this.x,y:this.y+100,attr:_.attr&&_.attr.tower,team:0,ai:1});E.benchIndex=w,this.fighters.push(E)}}if(1==this.aiMode&&!this.getFlag(NO_ATTACK)&&(this.aiTimer-=e,this.aiTimer<0)){this.aiTimer=5;var C=this.mainTower;C&&C.pilot&&!C.pilot.isAiEnabled()&&(C.pilot.initAI(1),C.callHeat(BTN_DOWN),C.callAutoAttack(!0),this.game.layer.joystick.setRockerVisible(!1))}},setInvincible:function(e){this.setFlag(NO_HURT,e);var t=this.towers;for(var i in t)t[i].setFlag(NO_HURT,e)},onContact:function(e){var t=e.bossFlag;if(!t&&e.attachedSlot){var i=e.attachedSlot.getRoot();i&&i.bossFlag&&(t=!0)}if(e.armorType!==ARMOR_TYPE.machine&&e.armorType!==ARMOR_TYPE.building||this.onHurt(e,e.hp*e.crashScale,null,DMG_TYPE.crash),e.applyVelocity&&(t?(console.log("::check ",this.moveSpdNow),e.applyVelocity(1e3+.8*this.moveSpdNow,0)):e.applyVelocity(2*this.moveSpdNow,300+2*this.moveSpdNow)),t)if(this.getFlag(NO_HURT)||this.deathAction){if(!e.getFlag(NO_HURT)&&!e.deathAction){var a=this.hp*(this.crashScale||.1);e.onHurt(this,a,null,DMG_TYPE.crash)}}else this.callDeath(e,0);else e.callDeath(this,0)},onHurt:function(){this._super.apply(this,arguments)},callChange:function(e){if(!this.changeLock){var t=this.towers[e],i=this.mainTower;if(i!==t){var a=!1;i&&(i.pilot.initAI(1),i.mainFlag=!1,a=i.heatMode,i.callHeat(BTN_UP)),2==this.aiMode?(t.callHeat(BTN_DOWN),t.pilot.initAI(1)):t.pilot.initAI(),t.callAutoAttack(!0),a&&t.callHeat(BTN_DOWN),this.mainTower=t,t.mainFlag=!0,this.flagEffect&&this.flagEffect.recycleFunc(),this.flagEffect=this.game.callEffect(EFFECT.mainTower,t.avatar)}}},callAim:function(e,t,i){if(2!=this.aiMode)if(this.aiTimer=5,this.game.config.gunnerMode)for(var a in this.towers){var n=this.towers[a];n&&n.pilot&&(n.pilot.isAiEnabled()&&(n.pilot.initAI(),n.callAutoAttack(!0)),n.pilot.callAim(e,t,i))}else{var o=this.mainTower;o&&o.pilot&&(o.pilot.isAiEnabled()&&(o.pilot.initAI(),o.callAutoAttack(!0)),o.pilot.callAim(e,t,i))}},callMove:function(e,t,i){this.getFlag(NO_MOVE)?(this.moveScaleX=e,this.moveAction=!1):this.moveAction&&this.moveScaleX===e||(this.moveScaleX=e,this.moveAction=0!==e),i&&(this.moveSpdNow=this.moveSpd*this.moveScaleX,this.avatar.refresh())},updateMove:function(e){if(this.moveAction&&!this.getFlag(NO_MOVE)){var t=this.moveSpdNow,i=this.moveSpd*this.moveScaleX;t!=i&&(t>i?(t-=1e3*e)<i&&(t=i):(t+=500*e)>i&&(t=i),this.moveSpdNow=t,this.avatar.refresh()),this._physic_vx=t}},updateLogic:function(e){this.pilot.updateLogic(e),this.updateDeath(e),this.updateMove(e),this.updateSkills(e),this.updatePhysics(e),this.updateMoveOffset(e),this.updateSub(e)},updateDeath:function(e){if(this.deathAction){if(this.deathFade&&this.deathTimer>0){var t=this.game,i=this.define,a=this.moveSpd;if(this.x+=a*this.moveScaleX*(this.deathTimer/2)*e,this.deathTimer-=e,this.deathTimer<=0){var n=this.avatar,o=i.deathEffect||EFFECT.vehicleExplosion;t.callEffect(o,n,0),this.deathFade=!1}}}else this.lifeTimer&&this.lifeTimer>0&&(this.lifeTimer-=e,this.lifeTimer<=0&&this.callDeath(this))},callDeath:function(e,t,i,a){if(!this.deathAction){var n=this.game,o=this.define;for(var r in this.hp=0,this.towers)this.towers[r].callDeath(e,t,i,a);for(var s in this.deathAction=!0,this.deathFade=!0,this.deathTimer=2.3,this.skills)this.skills[s].interrupt(),this.skills[s].froze(!0);this.setFlag(NO_MOVE,!0),this.setFlag(NO_ENTITY,!0),this.setFlag(NO_ATTACK,!0);var c=this.avatar,l=(e.hurtDelayTime||.05)+.1;this.deathFade=!0,c.setForcedAnime("dead",1,l,1),c.refresh(.3,!0,!0);var d=o.deathEffect||EFFECT.vehicleExplosion;for(var h in n.callEffect(d,c,0),this.towers)this.towers[h].callVehicleDeath(e,t,i,a);for(var u in this.heroes)this.heroes[u].callVehicleDeath(e,t,i,a);c.callVehicleDeath(),n.eventMgr.check(this,"deathEvent",e,t,i),n.eventMgr.on(e.getOwner(),"killEvent",this,t,i)}},onRevive:function(e,t){if(this.deathAction){this.deathAction=!1,this.setFlag(NO_MOVE,!1),this.setFlag(NO_ENTITY,!1),this.setFlag(NO_ATTACK,!1);var i=this.avatar;if(i.setForcedAnime(),i.refresh(.5),this.onHeal(e,t),this.skills)for(var a in this.skills)this.skills[a].froze(!1);for(var n in this.deg=0,this._physic_vr=0,this.towers){var o=this.towers[n];o.callVehicleRevive(e,t/this.hpMax*o.hpMax)}for(var r in this.heroes)this.heroes[r].callVehicleRevive(e,0);i.callVehicleRevive()}},setUIVisible:function(e){for(var t in this.flagEffect&&(this.flagEffect.active=!1),this.towers)this.towers[t].setUIVisible(e);this.avatar.setUIVisible(e)}}),cc._RF.pop()},{"../components/attributes/Attribute":"Attribute","../components/combat/buffs/Buff":"Buff","../entities/projectiles/Bullet":"Bullet","../entities/vehicles/Vehicle":"Vehicle","../managers/LevelManager":"LevelManager"}],NativeUtils:[function(e,t){"use strict";cc._RF.push(t,"63639LctsxJzLz+8XY/fEdM","NativeUtils");var i={isAndroid:function(){return console.log("[NativeUtils-TRACE] isAndroid() called"),cc.sys.os===cc.sys.OS_ANDROID},isNative:function(){return console.log("[NativeUtils-TRACE] isNative() called"),!1},initializeRemoteConfig:function(){if(console.log("[NativeUtils-TRACE] initializeRemoteConfig() called"),this.isAndroid()){try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","setJavaScriptReady","()V"),console.log("[NativeUtils] JavaScript marked as ready for Remote Config callbacks")}catch(e){console.error("[NativeUtils] Failed to mark JavaScript as ready:",e)}console.log("[NativeUtils] Remote Config already initialized in AppActivity")}},fetchAndActivateRemoteConfig:function(){if(console.log("[NativeUtils-TRACE] fetchAndActivateRemoteConfig() called"),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","fetchAndActivate","()V")}catch(e){console.error("[NativeUtils] Failed to fetch RemoteConfig:",e)}},getRemoteConfigString:function(e){if(console.log("[NativeUtils-TRACE] getRemoteConfigString() called with key:",e),!this.isAndroid())return null;try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","getString","(Ljava/lang/String;)Ljava/lang/String;",e)}catch(t){return console.error("[NativeUtils] Failed to get string:",t),null}},getRemoteConfigBoolean:function(e){if(console.log("[NativeUtils-TRACE] getRemoteConfigBoolean() called with key:",e),!this.isAndroid())return!1;try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","getBoolean","(Ljava/lang/String;)Z",e)}catch(t){return console.error("[NativeUtils] Failed to get boolean:",t),!1}},getRemoteConfigNumber:function(e){if(console.log("[NativeUtils-TRACE] getRemoteConfigNumber() called with key:",e),!this.isAndroid())return 0;try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","getDouble","(Ljava/lang/String;)D",e)}catch(t){return console.error("[NativeUtils] Failed to get number:",t),0}},getAllRemoteConfigValues:function(){if(console.log("[NativeUtils-TRACE] getAllRemoteConfigValues() called"),!this.isAndroid())return"{}";try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/RemoteConfig","getAllValues","()Ljava/lang/String;")||"{}"}catch(e){return console.error("[NativeUtils] Failed to get all values:",e),"{}"}},logAnalyticsEvent:function(e,t){if(console.log("[NativeUtils-TRACE] logAnalyticsEvent() called with event:",e),this.isAndroid())try{setTimeout(function(){try{var i=t?JSON.stringify(t):"{}";try{JSON.parse(i)}catch(a){console.error("[NativeUtils] Invalid JSON for analytics:",i),i="{}"}jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/FirebaseTracking","logEvent","(Ljava/lang/String;Ljava/lang/String;)V",e,i)}catch(n){console.error("[NativeUtils] Failed to log analytics event:",n)}},100)}catch(i){console.error("[NativeUtils] Failed to setup analytics event:",i)}},setAnalyticsUserProperty:function(e,t){if(console.log("[NativeUtils-TRACE] setAnalyticsUserProperty() called with name:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/FirebaseTracking","setUserProperty","(Ljava/lang/String;Ljava/lang/String;)V",e,t)}catch(i){console.error("[NativeUtils] Failed to set user property:",i)}},setAnalyticsUserId:function(e){if(console.log("[NativeUtils-TRACE] setAnalyticsUserId() called with userId:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/FirebaseTracking","setUserId","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to set user ID:",t)}},logCrashlytics:function(e){if(console.log("[NativeUtils-TRACE] logCrashlytics() called with message:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/FirebaseCrashlytics","log","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to log to Crashlytics:",t)}},recordException:function(e){if(console.log("[NativeUtils-TRACE] recordException() called with message:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/firebase/FirebaseCrashlytics","recordException","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to record exception:",t)}},showMaxRewardedAd:function(e){if(console.log("[NativeUtils-TRACE] showMaxRewardedAd() called with placement:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MaxAds","showRewardedAd","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to show MAX rewarded ad:",t)}},showMaxInterstitial:function(e){if(console.log("[NativeUtils-TRACE] showMaxInterstitial() called with placement:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/applovin/MaxAds","showInterstitial","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to show MAX interstitial:",t)}},initializeIAP:function(){if(console.log("[NativeUtils-TRACE] initializeIAP() called"),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/iap/InAppPurchase","initialize","()V")}catch(e){console.error("[NativeUtils] Failed to initialize IAP:",e)}},purchaseProduct:function(e){if(console.log("[NativeUtils-TRACE] purchaseProduct() called with productId:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/iap/InAppPurchase","purchase","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to purchase product:",t)}},getDeviceId:function(){if(console.log("[NativeUtils-TRACE] getDeviceId() called"),!this.isAndroid())return"unknown";try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/utils/DeviceUtils","getDeviceId","()Ljava/lang/String;")||"unknown"}catch(e){return console.error("[NativeUtils] Failed to get device ID:",e),"unknown"}},getAppVersion:function(){if(console.log("[NativeUtils-TRACE] getAppVersion() called"),!this.isAndroid())return"1.0.0";try{return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/utils/DeviceUtils","getAppVersion","()Ljava/lang/String;")||"1.0.0"}catch(e){return console.error("[NativeUtils] Failed to get app version:",e),"1.0.0"}},showToast:function(e){if(console.log("[NativeUtils-TRACE] showToast() called with message:",e),this.isAndroid())try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/utils/DeviceUtils","showToast","(Ljava/lang/String;)V",e)}catch(t){console.error("[NativeUtils] Failed to show toast:",t)}},vibrate:function(e){if(console.log("[NativeUtils-TRACE] vibrate() called with duration:",e),this.isAndroid()){e=e||100;try{jsb.reflection.callStaticMethod("org/cocos2dx/javascript/utils/DeviceUtils","vibrate","(I)V",e)}catch(t){console.error("[NativeUtils] Failed to vibrate:",t)}}}};"undefined"!=typeof window&&(window.NativeUtils=i),cc._RF.pop()},{}],NetMenu:[function(e,t){"use strict";cc._RF.push(t,"0cf89ecuNdPE6HnTeA5xCUO","NetMenu"),cc.Class({extends:e("./CheckMenu"),properties:{timeLabel:cc.Label,retryButton:cc.Button,loginButton:cc.Button},initStatus:function(e){e.title&&this.titleLabel&&(this.titleLabel.string=e.title),e.info&&this.infoText&&(this.infoText.string=e.info),e.btn&&this.btnLabel&&(this.btnLabel.string=e.btn),this.timer=e.time,this.setTime(this.timer),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){this.timer--,this.setTime(this.timer)},this)).repeat(this.timer)),this.loginButton.node.active=!e.noLogin},setTime:function(e){e&&e>0?(this.timeLabel.string=kit.second2date(e),this.retryButton.interactable=!1):(this.timeLabel.string="",this.retryButton.interactable=!0)},waitOnClose:function(){}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],NetSync:[function(e,t){"use strict";cc._RF.push(t,"33682prw5BIyJ4M7LdmRZgb","NetSync"),cc.Class({extends:e("./Sync"),init:function(e){cc.log("net sync.init"),this.game=e,this.index=0,this.status={};var t=this.actionList=[],i=e.config;this.rid=i.rid,this.zOrder=0,this.crcStep=0,this.waitStep=0,this.maxWaitStep=100,this.tryGetActionCt=0,this.waitGetActionCt=5;var a=-1;net.on("battle.step",function(i){var n=+i.s;for(t[n]=i.a;t[a+1];)a+=1;if(e.noSync)e.setSpeed(1);else{var o=c_floor(e.step/STEP_RATE);a-o>5?e.setSpeed(3):a-o>2?e.setSpeed(2):e.setSpeed(1)}}),net.on("battle.out",function(){cc.log("outBattle"),e.sync.noRestart=!0,e.callFinish(!0,LI("pvp_out"))}),net.on("battle.finish",function(){cc.log("finishBattle"),e.noSync=!0}),net.on("battle.restart",function(t){cc.log("battle.restart",t),e.sync.noWait=!0}),net.on("battle.error",function(e){console.log("battle.error",e)})},onEnter:function(){this.sendReady(3)},onExit:function(){cc.log("net sync.onExit"),this._super(),delete this.actionList,net.removeAllListeners("battle.step"),net.removeAllListeners("battle.ready"),net.removeAllListeners("battle.out"),net.removeAllListeners("battle.finish"),net.removeAllListeners("battle.restart"),net.removeAllListeners("battle.error")},onCancel:function(e){void 0===e&&(e=1);var t=this.game;t.config,t.noSync=!0,net.request("battle.handler.out",{score:t.score,rid:this.rid},function(t){t&&cc.log("\u7ea6\u6218\u9000\u51fa"),net.disconnect(),menuManager.back(e)})},onFinish:function(){var e=this.game;e.config,net.request("battle.handler.end",{score:e.score,rid:this.rid},function(e){e&&cc.log("\u7ea6\u6218\u7ed3\u7b97")})},sendRestart:function(e){cc.log("sendRestart"),net.request("battle.handler.restart",{rid:this.rid},function(t){t||cc.log("sendRestart fail"),e&&e(t)})},sendReady:function(e){var t=this;cc.log("sendReady:"+e),net.request("battle.handler.ready",{rid:this.rid},function(i){if(!i)return cc.log("sendReady fail"),void(--e>0?setTimeout(function(){t.sendReady(e)},1e3):(cc.log("sendReady fail offline"),t.offline()));t.start()})},sendCrc:function(e,t){net.notify("battle.handler.checkCrc",{rid:this.rid,crc:e,step:t})},offline:function(){this.disconnected||(this.disconnected=!0,cc.log("sync offline"),this.game.noSync=!0,kit.info(LI("net_disconnect"),function(){menuManager.back()}))},sendGetActions:function(){var e=this;if(cc.log("sendGetActions",this.tryGetActionCt),this.tryGetActionCt+=1,this.tryGetActionCt>4)return cc.log("forced offline!"),void this.offline();var t=this.game,i=this.actionList;net.reqSilent("battle.handler.getActions",{step:t.step,rid:this.rid},function(a,n){if(a){e.tryGetActionCt=0;var o=n.list;if(o)if(cc.log("getActions",o.length),0==o.length||1==o.length&&!o[0].a)e.waitGetActionCt--,1==e.waitStatus&&(e.waitStatus=2),0==e.waitGetActionCt&&t.config.pauseFunc(t),t.callEffect(EFFECT.connectWait,e.waitGetActionCt<0?0:e.waitGetActionCt);else for(var r=0,s=o.length;r<s;r++){var c=o[r];i[c.s]=c.a}else e.offline()}else cc.log("\u83b7\u53d6\u52a8\u4f5c\u5931\u8d25")})},getActions:function(){this.waitStep+=1,!this.game.ended&&this.waitStep>this.maxWaitStep&&(this.waitStep=0,this.maxWaitStep+=30,this.sendGetActions(),this.waitStatus||(this.waitStatus=1,this.game.callEffect(EFFECT.connectShow)))},start:function(){cc.log("sync start"),this.game.start()},insertActions:function(){for(var e in this.status){var t=this.status[e];if(t){var i={z:this.zOrder++};i[SIGN_INDEX]=t[SIGN_INDEX],i[SIGN_MOVE]=t[SIGN_MOVE],i[SIGN_ATTACK]=t[SIGN_ATTACK],i[SIGN_SELECT]=t[SIGN_SELECT],i[SIGN_SKILLS[0]]=t[SIGN_SKILLS[0]],i[SIGN_SKILLS[1]]=t[SIGN_SKILLS[1]],i[SIGN_SKILLS[2]]=t[SIGN_SKILLS[2]],i[SIGN_SKILLS[3]]=t[SIGN_SKILLS[3]],net.notify("battle.handler.action",i)}}this.status={}},update:function(){this.game.noSync||this.insertActions()},updateLogic:function(){var e=this.game;if(!e.noSync){var t=e.step,i=c_floor(t/STEP_RATE);if(t%STEP_RATE==0){this.crcStep++,i%20==0&&this.crcStep>10&&(this.crcStep=0,this.sendCrc(this.getCrc(),i));var a=this.actionList[i],n=0;if(!a)return this.getActions(),!0;for(this.waitStatus&&(this.waitStatus=0,this.maxWaitStep=100,e.callEffect(EFFECT.connectHide));n<a.length;){var o=a[n];if(n+=1,o[SIGN_INDEX]){var r=e.levelMgr.getObject(o[SIGN_INDEX]);r&&this.applyActions(r,o)}}}}}}),cc._RF.pop()},{"./Sync":"Sync"}],NewOperatorGetPopMenu:[function(e,t){"use strict";cc._RF.push(t,"09c5cyCVUFBPqIFIVLwaFTb","NewOperatorGetPopMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{light:cc.Node,nameLabel:cc.Label,closeText:cc.Node,avatarNode:cc.Node},isAdOpened:function(){return pc.stageIndex>0},initStatus:function(e){this.game=e.game,this.operator=e.operator,this.game.pushTimeScale(0),this.light.runAction(cc.rotateBy(3,360).repeatForever()),this.node.scale=0,this.node.runAction(cc.scaleTo(.6,1).easing(cc.easeElasticOut(1)));var t=this.operator,i=ENTITY[t].name;this.avatarNode.getChildByName("hero_model").getComponent("HeroModel").init(ENTITY[t]),this.nameLabel.string=i,this.closeText.runAction(cc.sequence(cc.fadeIn(1),cc.fadeOut(1),cc.delayTime(.2)).repeatForever())},close:function(){menuManager.close(),this.game.popTimeScale(0)}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],NukeSkill:[function(e,t){"use strict";cc._RF.push(t,"46ca8C23ntJXJVXgyzRDOgt","NukeSkill");var i=e("../../../entities/projectiles/BallBulletSprite"),a=e("../../../entities/projectiles/Bomb"),n=e("../../../entities/projectiles/Bullet");e("../../../entities/projectiles/IncendiaryBomb"),cc.Class({extends:e("./Skill"),startCast:function(){var e=this.obj;this.timer=0,this.smokeIndex=0,this.bombIndex=0,this.smokeMax=1,e.config.skillBlt&&(this.smokeMax+=e.config.skillBlt);var t=e.skillScale;this.blt=[{name:"\u70ae\u5f39",ctor:a,noContact:1,avatar:{ctor:i,frm:"bullet/nuke/blt",sx:.6,sy:.6,noBlend:!0},bomb:{r1:2e3,r0:1e3,dmg1:350*t,dmg0:350*t,kb:300,effect:EFFECT.bombNuke,preEffect:EFFECT.bombNukePre},latency:.5,kb:.3,length:20,n:1,wd:0,d:0,spd:444,spdFluc:0,gravity:-2e3,distance:80,disExtra:0}],this.attackSequence=[{t:.7,x:-20,y:50,blt:1,sound:"sound/cannon_fire"},{t:1}],this.game.callEffect(EFFECT.slowMotion,e.avatar,this.define.t,this.clearBullet.bind(this))},clearBullet:function(){var e=this.obj,t=(e.avatar,this.game.contactMgr.bulletList);for(var i in t)t[i].team!==e.team&&t[i].onTimeOut();var a=this.game.contactMgr.getContactList();for(var n in a){var o=a[n],r=o.getEntity();o._activeContact&&r.isInBorder()&&r.team!==e.team&&(r.onHurt(this,100*e.skillScale,null,null),this.game.callEffect(EFFECT.preUltDamage,r.avatar))}},updateCast:function(e){var t=this.obj.avatar;this.smokeIndex<this.smokeMax?(this.timer-=e,this.timer<=0&&(this.smokeIndex,this.timer=.1,this.smokeIndex++,this.shot(this.attackSequence[0],t.x+500,t.y+1e3,-180))):this.bombIndex<this.smokeMax&&(this.timer-=e,this.timer<=0&&(this.timer=.2,this.bombIndex++))},shot:function(e,t,i,a){var o=this.obj,r=this.blt[e.blt-1],s=(e.x||0)*o.flipX*o.scale,c=(e.y||0)*o.scale;r.offsets&&(o._bltOffsetIndex||(o._bltOffsetIndex=r.offsets.length),o._bltOffsetIndex-=1,s+=r.offsets[o._bltOffsetIndex].x,c+=r.offsets[o._bltOffsetIndex].y),t=t,i=i;var l=90+a,d=c_degree2cos(l),h=c_degree2sin(l),u=+h*s+d*c,p=-d*s+h*c;(r.shot||n.shot)(this.game,r,{distance:void 0,target:void 0,deg:l,obj:o,x:t,y:i,team:o.team,dmg:this.bltDmg,moveSpdX:o.getSpdX()}),e.effect&&this.game.callEffect(e.effect,o.avatar,u,p,l),e.sound&&this.game.playEffect(e.sound),this.bltMax>0&&(this.bltCt-=1)},bomb:function(e){for(var t=this.game.contactMgr.getContactList(),i=0,a=t.length;i<a;i++){var n=t[i],o=n.getEntity();Math.abs(n.getPositionX()-e)<200&&n.getPositionY()<900&&o.onHurt(this,1e3)}},endCast:function(){}}),cc._RF.pop()},{"../../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","../../../entities/projectiles/IncendiaryBomb":"IncendiaryBomb","./Skill":"Skill"}],NumBar:[function(e,t){"use strict";cc._RF.push(t,"a4c6dcm2idE0oEADT4jxpop","NumBar"),cc.Class({extends:cc.Component,properties:{hpNumLabel:cc.Label},init:function(e,t,i){var a=Math.min(Math.floor(1.5*(t.radius||1)),100);this.w=a,this.h=9,this.game=e,this.obj=t,t.hp,t.hpMax,this.w,this.hp=t.hp,this.hpNumLabel.string=Math.ceil(this.hp),this.node.setPosition(i.x,i.y+.5*this.w+15)},setVisible:function(e){this.node.active=e,e&&this.lateUpdate(0)},refresh:function(){var e=this.obj;this.hp=e.hp,this.hp<=0?this.node.active=!1:(e.hp,e.hpMax,this.w,this.hpNumLabel.string=Math.ceil(e.hp))},lateUpdate:function(){var e=this.obj;if(e.removed)this.node.destroy();else{var t=this.node;this.hp!=e.hp&&(this.hp<=0&&t.runAction(cc.fadeIn(.1)),this.refresh());var i=e.avatar;if(i){var a=i.getPosition();t.setPosition(a.x-10,a.y+15)}}}}),cc._RF.pop()},{}],OfflineTaskMenu:[function(e,t){"use strict";cc._RF.push(t,"6fa1dA0jp1L/pTaBlNG2jEA","OfflineTaskMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{layoutNode:cc.Node,itemNode:cc.Node,itemPrefab:cc.Prefab},onLoad:function(){},start:function(){},initStatus:function(){this.itemList=[],this.itemNode.active=!1,this.initUI()},initUI:function(){this.refreshUI()},refreshUI:function(){for(var e in OFFLINE_TASK){var t=OFFLINE_TASK[e],i=this.itemList[e];i||(i=cc.instantiate(this.itemNode),this.layoutNode.addChild(i),i.zIndex=e,i.active=!0,this.itemList.push(i)),this.refreshTaskBoard(i,t,+e)}this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.delayTime(task.getOfflineTaskRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.post("updateOfflineTask",{},function(t,i){cc.log("updateOfflineTask",i),task.loadOfflineTaskData(i),e.refreshUI()})},this)))},refreshTaskBoardByTime:function(e,t,i,a){var n=cc.find("progress/label",e).getComponent(cc.Label),o=cc.find("progress/bar",e).getComponent(cc.Sprite);a<=0?(o.fillRange=1,n.string="\u5df2\u5b8c\u6210",e.getChildByName("end").active=!0,e.getChildByName("work").active=!1,e.getChildByName("avatar").active=!1,e.getChildByName("item").active=!0):(o.fillRange=1-a/t.time/1e3,n.string=kit.second2date(a/1e3),e.getChildByName("end").active=!1,e.getChildByName("work").active=!0,e.getChildByName("avatar").active=!0,e.getChildByName("item").active=!1)},refreshTaskBoard:function(e,t,a){var n=this,o=task.getOfflineTaskHero(a),r=pc.getHero(o),s=pc.getHeroData(o),c=e.getChildByName("avatar"),l=c.getChildByName("hero_model").getComponent("HeroModel");l.hid!=o&&l.init(s,r),e.getChildByName("item").destroyAllChildren();var d={i:SHARD,id:o,n:t.n},h=cc.instantiate(this.itemPrefab);e.getChildByName("item").addChild(h),h.getComponent("Item").init(d);var u=task.getOfflineTaskStatus(a);e.getChildByName("name").getComponent(cc.Label).string=t.name,e.stopAllActions();var p=task.getOfflineTaskData(a).ct;if(e.getChildByName("num").getComponent(cc.Label).string=p+"/"+t.max,e.getChildByName("info").getComponent(cc.Label).string=kit.second2date(t.time),e.getChildByName("end").active=!1,e.getChildByName("start").active=!1,e.getChildByName("progress").active=!1,e.getChildByName("work").active=!1,e.getChildByName("limit").active=!1,c.active=!0,e.getChildByName("item").active=!1,0==u)p>=t.max?e.getChildByName("limit").active=!0:e.getChildByName("start").active=!0,e.onTouch=function(){task.getOfflineTaskData(a).ct>=t.max?kit.info("\u5df2\u7ecf "+t.max+" \u6b21\u4e86,\u660e\u5929\u518d\u6765\u5427"):net.updateData({offlineTask:{index:a,status:1,type:0,time:1e3*t.time}},function(i,o){cc.log("updateOfflineTask",i,o),task.updateOfflineTaskData(a,o.task),n.refreshTaskBoard(e,t,a)})},l.play("stand");else if(1==u){e.getChildByName("progress").active=!0;var f=task.getOfflineTaskTime(a);this.refreshTaskBoardByTime(e,t,a,f),f>0?(e.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){var i=task.getOfflineTaskTime(a);this.refreshTaskBoardByTime(e,t,a,i)},this)).repeatForever()),l.play("walk")):(c.active=!1,e.getChildByName("item").active=!0),e.onTouch=function(){if(task.getOfflineTaskTime(a)>0)kit.info("\u4efb\u52a1\u8fdb\u884c\u4e2d");else{var o=task.getOfflineTaskData(a),r=task.rndOfflineTaskHeroIndex(a);cc.log("rndOfflineTaskHeroIndex",r);var s=[d];net.updateData({offlineTask:{index:a,type:r,status:0},items:s},function(r,c){cc.log("updateOfflineTask",r,c),i.FirebaseTracking.setDataBiRes("UpdateOfflineTask"),money.update(c),task.updateOfflineTaskData(a,c.task),n.refreshTaskBoard(e,t,a),menuManager.pop("show",{items:s,tid:"offline_task",checkCb:function(){if(o.ct>1&&o.seed%2==0){var e=[getRndItemFromBox(bigBoxRndList)];menuManager.pop("video",{title:"\u989d\u5916\u4ea7\u51fa",items:e,checkCb:function(t){if(t)return sdk.useFree("offline_task",function(t){t||net.updateData({items:e},function(t,a){cc.log(t,a),t||(i.FirebaseTracking.setDataBiRes("UpdateOfflineTask_Ads"),money.update(a),menuManager.close(),menuManager.pop("show",{items:e,tid:"offline_task"}))})}),!0}})}}})})}}}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],OnlineBoxMenu:[function(e,t){"use strict";cc._RF.push(t,"7c82d+TumpKJLHioE1EEIrV","OnlineBoxMenu");var i=e("../../Plugins/firebase/FirebaseTracking");window.ONLINE_BOX_DEFINE=[{name:"1",time:30,items:[{i:EXP,n:10}]},{name:"2",time:300,items:[{i:EXP,n:20},{i:DIAMOND,n:5}]},{name:"3",time:900,items:[{i:EXP,n:30},{i:DIAMOND,n:10}]},{name:"4",time:1800,items:[{i:EXP,n:40},{i:ENERGY,n:5}]},{name:"5",time:3600,items:[{i:EXP,n:50},{i:TALENT,n:1}]}],cc.Class({extends:e("../ui/core/PopMenu"),properties:{layoutNode:cc.Node,itemNode:cc.Node,itemPrefab:cc.Prefab,timeLabel:cc.Label,progress:cc.Sprite,btnNodes:[cc.Node]},onLoad:function(){},start:function(){},initStatus:function(){this.itemList=[],this.itemNode.zIndex=0,this.itemList.push(this.itemNode);for(var e=1;e<ONLINE_BOX_DEFINE.length;e++){var t=cc.instantiate(this.itemNode);this.layoutNode.addChild(t),t.zIndex=-e,this.itemList.push(t)}this.maxIndex=shop.onlineBoxIndex,this.initUI()},initUI:function(){var e=this;this.refreshUI(),this.node.stopAllActions(),cc.log("shop.getOnlineRefreshTime()/1000",shop.getOnlineRefreshTime()/1e3),this.node.runAction(cc.sequence(cc.delayTime(shop.getOnlineRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.post("updateOnlineBox",{},function(t,i){cc.log("updateOnlineBox",i),shop.loadOnlineBoxData(i),e.initUI()})},this))),this.schedule(function(){e.refreshTimeBar()},1)},refreshTimeBar:function(){var e=shop.getOnlineBoxTime()/1e3,t=0,i=.027;this.maxIndex>0&&(i=.973/(ONLINE_BOX_DEFINE.length-1),t=.027+(this.maxIndex-1)*i);var a=ONLINE_BOX_DEFINE[this.maxIndex];if(a){var n=ONLINE_BOX_DEFINE[this.maxIndex-1],o=e/a.time;n&&(o=(e-n.time)/(a.time-n.time)),this.progress.fillRange=t+i*o,e>=a.time&&this.maxIndex<ONLINE_BOX_DEFINE.length&&(this.maxIndex++,this.refreshUI())}else this.progress.fillRange=1;this.timeLabel.string="\u5728\u7ebf\u65f6\u957f: "+kit.second2date(e)},refreshUI:function(){this.refreshTimeBar();var e=shop.getOnlineBoxTime()/1e3,t=!0;for(var i in ONLINE_BOX_DEFINE){var a=ONLINE_BOX_DEFINE[i],n=this.itemList[i],o=a.time,r=kit.second2hour(o);n.getChildByName("name").getComponent(cc.Label).string="\u7d2f\u8ba1\u5728\u7ebf "+r;var s=shop.onlineBoxIndex>i,c=e>=o;if(n.getChildByName("done").active=s,n.getChildByName("bg0").active=!c,n.getChildByName("bg1").active=c&&!s,n.getChildByName("bg2").active=c&&s,c&&!s&&(t=!1),!n.itemNodes){n.itemNodes=[];var l=n.getChildByName("layout");l.destroyAllChildren();var d=a.items;for(var h in d){var u=cc.instantiate(this.itemPrefab);l.addChild(u),u.getComponent("Item").init(d[h]),n.itemNodes.push(u)}}for(var p in n.itemNodes)n.itemNodes[p].getComponent("Item").setGray(s)}for(var f in this.btnNodes)this.setGray(this.btnNodes[f],t)},onLoot:function(e,t){var a=this,n=[],o=0,r=shop.getOnlineBoxTime()/1e3;for(var s in ONLINE_BOX_DEFINE){var c=ONLINE_BOX_DEFINE[s];s>=shop.onlineBoxIndex&&r>=c.time&&(o++,n=n.concat(c.items))}if(n.length){var l=function(){net.updateData({items:n,add:{onlineBoxIndex:o}},function(e,t){i.FirebaseTracking.setDataBiRes("OnlineBox"),money.update(t),shop.onlineBoxIndex=t.onlineBoxIndex,a.maxIndex=shop.onlineBoxIndex,a.refreshUI(),menuManager.pop("loot",{items:n,tid:"online_box",lootCb:function(){}})})};if(t){for(var d in n){var h=n[d];n[d]={i:h.i,n:3*h.n,id:h.id}}sdk.useFree("online_box",function(e){e||l()})}else l()}else kit.info("\u6ca1\u6709\u53ef\u4ee5\u9886\u53d6\u7684\u793c\u5305")}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],OnlineBoxTimer:[function(e,t){"use strict";cc._RF.push(t,"e92edIfOMRBDom8dY7w1Dvo","OnlineBoxTimer"),cc.Class({extends:cc.Component,properties:{icon:cc.Node,timerLabel:cc.Label,timerId:"",timerCD:0,adIcon:cc.Node},onLoad:function(){var e=user.getGuide("onlineBox")||0,t=e<2||user.checkOnlineTimeCD(this.timerId,this.timerCD);this.setGray(this.icon,!t),this.timerLabel.node.active=!user.checkOnlineTimeCD(this.timerId,this.timerCD),this.adIcon.active=1==e&&!user.checkOnlineTimeCD(this.timerId,this.timerCD)},setGray:function(e,t){var i;e instanceof cc.Sprite||(e=e.getComponent(cc.Sprite)),i=t?"2d-gray-sprite":"2d-sprite",e.setMaterial(0,cc.Material.getBuiltinMaterial(i))},update:function(){this.timerLabel.string=user.getOnlineTimerString(this.timerId,this.timerCD);var e=user.getGuide("onlineBox")||0,t=e<2||user.checkOnlineTimeCD(this.timerId,this.timerCD);this.setGray(this.icon,!t),this.timerLabel.node.active=!user.checkOnlineTimeCD(this.timerId,this.timerCD),this.adIcon.active=1==e&&!user.checkOnlineTimeCD(this.timerId,this.timerCD)},start:function(){}}),cc._RF.pop()},{}],OnlineBox:[function(e,t){"use strict";cc._RF.push(t,"44f07JWgOVEJrKoy8qpPnAC","OnlineBox"),cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label,rpNode:cc.Node},onLoad:function(){this.rpNode.active=!1},onClick:function(){menuManager.pop("online_box")},update:function(){var e=ONLINE_BOX_DEFINE[shop.onlineBoxIndex],t=shop.getOnlineBoxTime()/1e3;e?t>=e.time?(this.timeLabel.string="",this.rpNode.active=!0):(this.timeLabel.string=kit.second2date(e.time-t),this.rpNode.active=!1):(this.timeLabel.string="",this.rpNode.active=!1)}}),cc._RF.pop()},{}],OnlineTimer:[function(e,t){"use strict";cc._RF.push(t,"dda76ax0RVMlpyRztkyqBJT","OnlineTimer"),cc.Class({extends:cc.Component,properties:{icon:cc.Node,timerLabel:cc.Label,timerId:"",timerCD:0},onLoad:function(){var e=user.checkOnlineTimeCD(this.timerId,this.timerCD);this.setGray(this.icon,!e),this.timerLabel.node.active=!e},setGray:function(e,t){var i;e instanceof cc.Sprite||(e=e.getComponent(cc.Sprite)),i=t?"2d-gray-sprite":"2d-sprite",e.setMaterial(0,cc.Material.getBuiltinMaterial(i))},update:function(){this.timerLabel.string=user.getOnlineTimerString(this.timerId,this.timerCD);var e=user.checkOnlineTimeCD(this.timerId,this.timerCD);this.setGray(this.icon,!e),this.timerLabel.node.active=!e},start:function(){}}),cc._RF.pop()},{}],OverHeatBuff:[function(e,t){"use strict";cc._RF.push(t,"6f72fb6m7dHPa4+/5cqMYW+","OverHeatBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.define;this.hpCost=e.hp,this.costTime=e.dt||1,this.costTimer=0},update:function(e){this.obj.isHeatOver()&&(this.costTimer-=e,this.costTimer<=0&&(this.costTimer=this.costTime,this.obj.onHurt(this,this.hpCost)))},end:function(){}}),cc._RF.pop()},{"./Buff":"Buff"}],OverlapBuff:[function(e,t){"use strict";cc._RF.push(t,"6ed54ZIw1JHr7CvxTKvDZaS","OverlapBuff"),cc.Class({extends:e("./Buff"),cover:function(){this.overlapCt<this.overlapMax&&(this.overlapCt++,this.addAttr(this.define.attr))},begin:function(){this.overlapCt=0,this.overlapMax=this.define.max||0},end:function(){for(var e=0;e<this.overlapCt;e++)this.removeAttr(this.define.attr)}}),cc._RF.pop()},{"./Buff":"Buff"}],PakoLoader:[function(require,module,exports){(function(global){"use strict";cc._RF.push(module,"b482a3EicFOMJId94dXlZMR","PakoLoader");var PakoLoader={ensurePakoLoaded:function ensurePakoLoaded(){if("undefined"!=typeof window&&window.pako)return!0;if(void 0!==global&&global.pako)return!0;try{if(void 0!==require){var pako=require("pako");return"undefined"!=typeof window&&(window.pako=pako),void 0!==global&&(global.pako=pako),cc.log("[PakoLoader] Pako loaded successfully via require"),!0}}catch(e){cc.warn("[PakoLoader] Failed to require pako:",e.message)}if(cc.sys.isNative)try{cc.loader.loadRes("libs/pako.min",function(err,asset){!err&&asset?(eval(asset.text||asset),cc.log("[PakoLoader] Pako loaded from resources")):cc.error("[PakoLoader] Failed to load pako from resources:",err)})}catch(e){cc.error("[PakoLoader] Error loading pako on native:",e)}return!1},createFallback:function(){"undefined"==typeof window||window.pako||(window.pako={inflate:function(e,t){return cc.warn("[PakoLoader] Using fallback - no decompression"),t&&"string"===t.to?String.fromCharCode.apply(null,e):e},deflate:function(e){return cc.warn("[PakoLoader] Using fallback - no compression"),e}})},init:function(){this.ensurePakoLoaded()||(cc.error("[PakoLoader] Pako not available, creating fallback"),this.createFallback())}};cc.sys.isNative&&PakoLoader.init(),module.exports=PakoLoader,cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{pako:"pako"}],PassiveItem:[function(e,t){"use strict";cc._RF.push(t,"bc591mI8QBID7FfNZOp9Bji","PassiveItem"),e("./define");var i=e("../entities/environment/MyTower"),a=(e("../entities/projectiles/Bomb"),e("../entities/projectiles/MissileSprite"),e("../entities/projectiles/BallBulletSprite"),e("../ai/units/AIMyTower"),e("../components/visual/Avatar"));ENTITY.healPack={id:"healPack",hero:!0,category:"healPack",name:"\u56de\u8840\u9053\u5177",avatar:{ctor:a,frm:"avatar/backpack/item/\u590d\u5408\u5316\u5b66\u5242",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:2,createCb:function(){var t={symbol:"healPack",ctor:e("../components/combat/buffs/RecoverBuff"),hp:2};this.config.base.addBuff(this,t),cc.log("healPack createCB")}},ENTITY.healPack_2={id:"healPack_2",hero:!0,category:"healPack",name:"\u56de\u8840\u9053\u51772",avatar:{ctor:a,frm:"avatar/backpack/item/\u590d\u5408\u5316\u5b66\u52422",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:3,createCb:function(){var t={symbol:"healPack",ctor:e("../components/combat/buffs/RecoverBuff"),hp:3};this.config.base.addBuff(this,t),cc.log("healPack createCB")}},ENTITY.healPack_3={id:"healPack_3",hero:!0,category:"healPack",name:"\u56de\u8840\u9053\u51773",avatar:{ctor:a,frm:"avatar/backpack/item/\u590d\u5408\u5316\u5b66\u52423",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:5,createCb:function(){var t={symbol:"healPack",ctor:e("../components/combat/buffs/RecoverBuff"),hp:5};this.config.base.addBuff(this,t),cc.log("healPack createCB")}},ENTITY.healPack_4={id:"healPack_4",hero:!0,category:"healPack",name:"\u56de\u8840\u9053\u51774",avatar:{ctor:a,frm:"avatar/backpack/item/\u590d\u5408\u5316\u5b66\u52424",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:8,createCb:function(){var t={symbol:"healPack",ctor:e("../components/combat/buffs/RecoverBuff"),hp:8};this.config.base.addBuff(this,t),cc.log("healPack createCB")}},ENTITY.armorPack={id:"armorPack",hero:!0,category:"armorPack",name:"\u56de\u7532\u9053\u5177",avatar:{ctor:a,frm:"avatar/backpack/item/BOX",ay:.01,moveSpd:150},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:1,createCb:function(){var t={symbol:"armorPack",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:1,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")}},ENTITY.armorPack_2={id:"armorPack_2",hero:!0,category:"armorPack",name:"\u56de\u7532\u9053\u51772",avatar:{ctor:a,frm:"avatar/backpack/item/BOX2",ay:.01,moveSpd:150},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:2,createCb:function(){var t={symbol:"armorPack",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:2,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")}},ENTITY.armorPack_3={id:"armorPack_3",hero:!0,category:"armorPack",name:"\u56de\u7532\u9053\u51773",avatar:{ctor:a,frm:"avatar/backpack/item/BOX3",ay:.01,moveSpd:150},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:3,createCb:function(){var t={symbol:"armorPack",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:3,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")}},ENTITY.armorPack_4={id:"armorPack_4",hero:!0,category:"armorPack",name:"\u56de\u7532\u9053\u51774",avatar:{ctor:a,frm:"avatar/backpack/item/BOX4",ay:.01,moveSpd:150},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},infoNum:5,createCb:function(){var t={symbol:"armorPack",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:5,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")}},ENTITY.fuelTank={id:"fuelTank",hero:!0,category:"fuelTank",name:"\u56de\u8840\u6cb9\u7bb1",avatar:{ctor:a,frm:"avatar/backpack/item/\u6cb9\u7bb1",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,attackCenter:cc.v2(20,40),attackAngle:[-40,80],infoNum:.008,createCb:function(){var t={symbol:"fuelTank",ctor:e("../components/combat/buffs/RecoverBuff"),hpPercent:.008};this.config.base.addBuff(this,t),cc.log("fuelTank createCB")}},ENTITY.fuelTank_2={id:"fuelTank_2",hero:!0,category:"fuelTank",name:"\u56de\u8840\u6cb9\u7bb1",avatar:{ctor:a,frm:"avatar/backpack/item/\u6cb9\u7bb12",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,attackCenter:cc.v2(20,40),attackAngle:[-40,80],infoNum:.01,createCb:function(){var t={symbol:"fuelTank",ctor:e("../components/combat/buffs/RecoverBuff"),hpPercent:.01};this.config.base.addBuff(this,t),cc.log("fuelTank createCB")}},ENTITY.fuelTank_3={id:"fuelTank_3",hero:!0,category:"fuelTank",name:"\u56de\u8840\u6cb9\u7bb13",avatar:{ctor:a,frm:"avatar/backpack/item/\u6cb9\u7bb13",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,attackCenter:cc.v2(20,40),attackAngle:[-40,80],infoNum:.012,createCb:function(){var t={symbol:"fuelTank",ctor:e("../components/combat/buffs/RecoverBuff"),hpPercent:.012};this.config.base.addBuff(this,t),cc.log("fuelTank createCB")}},ENTITY.fuelTank_4={id:"fuelTank_4",hero:!0,category:"fuelTank",name:"\u56de\u8840\u6cb9\u7bb14",avatar:{ctor:a,frm:"avatar/backpack/item/\u6cb9\u7bb14",moveSpd:150,ay:.01},ctor:i,noContact:!0,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,attackCenter:cc.v2(20,40),attackAngle:[-40,80],infoNum:.014,createCb:function(){var t={symbol:"fuelTank",ctor:e("../components/combat/buffs/RecoverBuff"),hpPercent:.014};this.config.base.addBuff(this,t),cc.log("fuelTank createCB")}},ENTITY.energyBarrier={id:"energyBarrier",hero:!0,category:"energyBarrier",name:"\u80fd\u91cf\u5c4f\u969c",avatar:{ctor:a,frm:"avatar/backpack/item/\u5c4f\u969c",ay:.01,moveSpd:150},ctor:e("../ui/widgets/bars/EnergyBarrier"),radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltMax:1,bltReload:.1,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackAngle:[-40,80],infoNum:1,shapes:[{x:0,y:90,radius:45,hitRadius:45}],createCb:function(){var t={symbol:"energyBarrier",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:1,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")}},ENTITY.energyBarrier_2=kit.clone(ENTITY.energyBarrier),ENTITY.energyBarrier_2.id+="_2",ENTITY.energyBarrier_2.category+="_2",ENTITY.energyBarrier_2.avatar.frm+="2",ENTITY.energyBarrier_2.infoNum=2,ENTITY.energyBarrier_2.createCb=function(){var t={symbol:"energyBarrier",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:2,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")},ENTITY.energyBarrier_3=kit.clone(ENTITY.energyBarrier),ENTITY.energyBarrier_3.id+="_3",ENTITY.energyBarrier_3.category+="_3",ENTITY.energyBarrier_3.avatar.frm+="3",ENTITY.energyBarrier_3.infoNum=3,ENTITY.energyBarrier_3.createCb=function(){var t={symbol:"energyBarrier",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:3,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")},ENTITY.energyBarrier_4=kit.clone(ENTITY.energyBarrier),ENTITY.energyBarrier_4.id+="_4",ENTITY.energyBarrier_4.category+="_4",ENTITY.energyBarrier_4.avatar.frm+="4",ENTITY.energyBarrier_4.infoNum=5,ENTITY.energyBarrier_4.createCb=function(){var t={symbol:"energyBarrier",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:5,stayOnBroken:1};this.config.base.addBuff(this,t),cc.log("armorPack createCB")},cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../components/combat/buffs/BigShieldBuff":"BigShieldBuff","../components/combat/buffs/RecoverBuff":"RecoverBuff","../components/visual/Avatar":"Avatar","../entities/environment/MyTower":"MyTower","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/MissileSprite":"MissileSprite","../ui/widgets/bars/EnergyBarrier":"EnergyBarrier","./define":"define"}],PauseMenu:[function(e,t){"use strict";cc._RF.push(t,"4f7d8c+Z05Fo5IwHLiEHTGI","PauseMenu");var i=e("../../../Plugins/ADManager"),a=e("../../../Plugins/firebase/FirebaseTracking"),n=e("../../../Plugins/SDKManager");cc.Class({extends:e("../menus/SettingMenu"),properties:{debugNode:cc.Node,backBtnNode:cc.Node},initStatus:function(e){console.log("======== 000000"),this._super(e),this.debugNode.active=H5VERSION||DEV_MODE,this.backBtnNode.active=!user.onlyPhysics&&!user.onlyGunner},onCheck:function(e,t){if(console.log("======== 1111111111 "+e+" - t : "+t),2==t&&("Minigame"==a.FirebaseTracking.gameMode||"Backpack"==n.SDKManager.Instance.CurrentScreen)){var o=n.SDKManager.Instance.endLevelTimer(),r=a.FirebaseTracking.levelID,s=n.SDKManager.Instance.generateUniqueID(r),c=n.SDKManager.Instance.getAttempts(r),l=i.ADManager.Instance.IsReviveAds?1:0;a.FirebaseTracking.logGameOver(s,o,l,0,1,c)}var d=this.args.checkCb;d&&d.call(this,t)?console.log("======== 111111111 aaaaaaaa"):(console.log("======== 1111111111 bbbbbbbb"),this.close(t))},onWin:function(e,t){console.log("======== 222222222");var i=menuManager.currentRun().game;if(i)setTimeout(function(){return menuManager.close()},1),t&&adventure.mapList&&(adventure.mapIndex=adventure.mapList.length),i.levelMgr.sendMsg({v:{n:"win"}});else{var a=menuManager.currentRun().args.vehicleConfig;a&&(t?(setTimeout(function(){return menuManager.close()},1),adventure.mapIndex=adventure.mapList.length,adventure.chapterWin(null,a,0)):(adventure.mapIndex++,kit.info("Go to Stage"+(adventure.mapIndex+1))))}},onLoot:function(e){console.log("======== 333333333333");var t=menuManager.currentRun(),i=t.game;chapter.add(GOLD,999,"test"),cc.game.emit("add_drop",{i:GOLD,n:999,tid:"test"});for(var a=excel.read("chapter_task")[1],n=ItemDrop.getDropsFromExcelData(6,a),o=0;o<n.length;o++){var r=n[o],s=r.id,c=r.lvl,l=e.target.convertToWorldSpaceAR(cc.v2(150*(-(n.length-1)/2+o),10));i?i.layer.bottomUI.addBagItem(s,c,l):(cc.log("addBagItem",s,c,l),t.addBagItem(s,c,l),t.bagUI.getComponent("bottomUI").showBlocks(ItemDefine[s].type)),chapter.data.bag.push({id:s,lvl:c});var d=ItemDefine[s]&&ItemDefine[s].type;d&&chapter.data.reddot[d]++}}}),cc._RF.pop()},{"../../../Plugins/ADManager":"ADManager","../../../Plugins/SDKManager":"SDKManager","../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../menus/SettingMenu":"SettingMenu"}],PilotPage:[function(e,t){"use strict";cc._RF.push(t,"a0fb12EEzNDcKEiio6NzT/P","PilotPage");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/Menu"),properties:{teamNode:cc.Node,bottomScroll:cc.ScrollView,bottomLayout:cc.Layout,bottomWidget:cc.Widget,layoutNode:cc.Node,heroBoard:cc.Node,emptyBoard:cc.Node,memberLayoutNode:cc.Node,memberShowNode:cc.Node,memberNode:cc.Node,memberEmptyNode:cc.Node,teamBackNode:cc.Node,teamSwitchNode:cc.Node,teamEmptyList:[cc.Node],teamFigureList:[cc.Node],recruitNode:cc.Node,recruitHeroBtn:cc.Node,heroStatBoard:cc.Node,heroStatBackBtnNode:cc.Node,heroStatRefreshBtnNode:cc.Node,heroStatRefreshBtnNumLabel:cc.Label,heroStatRefreshBtnCtLabel:cc.Label,heroStatRefreshTipsNode:cc.Node,heroStatCards:[cc.Node],heroRaritySpriteFrame:[cc.SpriteFrame],heroRarityIconSpriteFrame:[cc.SpriteFrame],heroStatIconSpriteFrame:[cc.SpriteFrame],heroStatComboIconSpriteFrame:[cc.SpriteFrame],heroStatModelNode:cc.Node,heroStatBonusEffectX2Node:cc.Node,heroStatBonusEffectX3Node:cc.Node,backgroundNode:cc.Node,luckyGetAudio:{type:cc.AudioClip,default:null},luckyGet2Audio:{type:cc.AudioClip,default:null}},onLoad:function(){var e,t=this;this.enableHeroStatBoard(),this.switchTeamMode(!1),this.heroTable={},this.heroBoard.active=!1,this.teamNodeTable={},this.memberNode.active=!1,this.memberEmptyNode.active=!1,this.emptyBoard.active=!1,this.teamListData=pc.getTeam(),this.teamSwitchNode.onTouch=function(){t.switchTeamMode(!0)},this.teamBackNode.onTouch=function(){var e=kit.clamp(pc.getHeroList().length,0,4);t.teamListData.length<e?menuManager.pop("check",{title:"\u4e58\u5458\u4e0d\u8db3",info:"\u8fd8\u6709\u4e58\u5458\u4f4d\u7f6e,\u4e0d\u4e0a\u5417?",checkCb:function(e){e&&t.switchTeamMode(!1)}}):t.switchTeamMode(!1)},this.topVisible=((e={})[GOLD]=!1,e[DIAMOND]=!1,e[SWEEP_TICKET]=!1,e[EXP]=!1,e[ENERGY]=!1,e),this.initBackground()},initBackground:function(){var e=menuManager.createAnimation("avatar/block/firepit",{repeat:-1,speed:2});this.backgroundNode.getChildByName("firepit").addChild(e);var t=this.backgroundNode.getChildByName("pilot"),i=pc.getHeroList(),a=[];for(var n in i)a.push(i[n]);var o=[1,2,3,4];for(n=1;n<=4&&0!=a.length;n++){var r=a.splice(kit.rndInt(0,a.length-1),1)[0].id,s=pc.getHero(r),c=pc.getHeroData(r),l=cc.instantiate(cc.find("model",t));l.active=!0,cc.log("heroNode",l,a,r);var d=l.getChildByName("hero_model").getComponent("HeroModel");d.init(c,s),d.play("stand");var h=o.splice(kit.rndInt(0,o.length-1),1)[0];t.getChildByName("pos"+h).addChild(l)}},addHeroToBackground:function(e){for(var t=this.backgroundNode.getChildByName("pilot"),i=1;i<=4;i++){var a=t.getChildByName("pos"+i);if(!(a.children.length>0)){var n=pc.getHero(e),o=pc.getHeroData(e),r=cc.instantiate(cc.find("model",t));r.active=!0;var s=r.getChildByName("hero_model").getComponent("HeroModel");s.init(o,n),s.play("stand"),a.addChild(r);break}}},checkCanRecruit:function(){var e=[],t=excel.read("hero_list");for(var i in t){cc.log("recruitHero",t[i]);var a=pc.getHero(t[i].id);cc.log("hero",a),(!a||a.star<5)&&e.push(t[i].id)}return e.length>0},initRecruitNode:function(){var e;cc.log("initRecruitNode",this.recruitNode,this.recruitNode.getChildByName("draft")),this.recruitNode.getChildByName("draft").getComponent("DraftMenu").init({}),user.getGuide("hero")<=1&&(e=!0),this.recruitNode.active=e||money.had(RECRUIT_TICKET,1),this.updateRecruitNode()},updateRecruitNode:function(){var e,t=this;cc.log("updateRecruitNode",user.getGuide("hero")),user.getGuide("hero")<=1&&(e=!0),this.recruitHeroBtn.onTouch=function(){e||money.had(RECRUIT_TICKET,1)?t.checkCanRecruit()?(t.recruitHeroBtn.active=!1,t.recruitNode.active=!0,t.recruitNode.getChildByName("draft").getComponent("DraftMenu").onDraft(function(e){t.recruitHero(e)},function(e){menuManager.pop("show",{items:[{i:HERO,id:e}],tid:"hero_info",checkCb:function(){}}),t.initPilots(),t.initTeam(),t.recruitHeroBtn.active=!0,t.updateRecruitNode()})):kit.info(LI("hero_tip2")):kit.info(LI("hero_tip1"))},this.updateRecruitBtn()},updateRecruitBtn:function(){var e,t=money.getNum(RECRUIT_TICKET);1==user.getGuide("hero")&&t<1&&(t=1,e=!0,cc.log("updateRecruitBtn isGuide")),this.recruitHeroBtn.active=!0;var i=this.recruitHeroBtn.getChildByName("num").getComponent(cc.Label);cc.log("updateRecruitBtn",i),i.string=t+"/1",i.node.color=(e||money.had(RECRUIT_TICKET,1))&&cc.color(15,80,120)||cc.color(255,0,0),this.recruitHeroBtn.getChildByName("rp").active=money.had(RECRUIT_TICKET,1)},addHero:function(e,t){var a=this,n=pc.getHeroData(e),o=pc.getHero(e);if((o?o.star:0)>=5)kit.info(LI("tip_max"));else{var r={i:RECRUIT_TICKET,n:1};(o=o||{id:e,star:0}).star+=1,o.lvl=1,cc.log("PilotPage addHero",o),1==user.getGuide("hero")?(user.setGuide("hero",2),r=null):1==o.star&&(o.stat={0:n.stat[0],1:n.stat[1],2:n.stat[2]});var s={};s[HERO+"."+e+".refreshCt"]=1,o.refreshCt=1,net.updateData({heroes:[o],set:s,price:r},function(e,n){cc.log("PilotPage addHero updateData",n),e?kit.info("\u64cd\u4f5c\u5931\u8d25"):(i.FirebaseTracking.setDataBiRes("PilotPage_AddHero"),money.update(n),pc.setHero(o),t&&t(o.id),1==o.star&&(a.addHeroToBackground(o.id),YMTJ("lv","call_crew_"+pc.heroList.length)))})}},updateRedPoint:function(){for(var e=0,t=(kit.clamp(pc.getHeroList().length,0,4),excel.read("hero_list")),i=0;i<t.length;i++){var a=t[i].id,n=pc.getHero(a);if((n?n.star:0)<5&&money.had(RECRUIT_TICKET,1)){e=1;break}}return e},initStatus:function(){this.initPilots(),this.initTeam(),this.initRecruitNode()},recruitHero:function(e){var t=excel.read("hero_list");cc.log("recruitHero",t);var i=[];for(var a in t){cc.log("recruitHero",t[a]);var n=pc.getHero(t[a].id);cc.log("hero",n),(!n||n.star<5)&&i.push(t[a].id)}var o=i[kit.rndInt(0,i.length-1)];cc.log("recruitHero getGuide hero",user.getGuide("hero")),1==user.getGuide("hero")&&(o="h2",YMTJ("guide","guide020")),this.addHero(o,e)},switchTeamMode:function(e){for(var t in this.teamMode=e,this.memberLayoutNode.active=e,this.memberShowNode.active=!e,this.teamBackNode.active=e,this.teamSwitchNode.active=!e,this.bottomLayout.spacingY=e?0:35,this.bottomLayout.updateLayout(),this.bottomWidget.top=e?.63:.5,function e(t){var i=t.getComponent(cc.Widget);if(i){i.updateAlignment();var a=t.getChildren();for(var n in a)e(a[n])}}(this.bottomWidget.node),this.bottomScroll._calculateBoundary(),this.teamListData,this.heroTable){var i=this.heroTable[t];if(i.active){var a=i.hid;this.refreshHeroBoardByTeam(i,a)}}},refreshHeroBoardByTeam:function(){},initTeam:function(){var e=this,t=kit.clamp(pc.getHeroList().length,0,4);this.teamSwitchNode.getChildByName("rp").active=this.teamListData.length<t;var i=this.teamListData;for(var a in cc.log("this.teamListData",this.teamListData),this.teamNodeTable)this.teamNodeTable[a].active=!1;for(var n=0,o=function(t){var a=i[t],o=e.teamFigureList[t],r=void 0;if(a){o.active=!0;var s=pc.getHero(a),c=pc.getHeroData(a),l=cc.find("figure/hero_model",o).getComponent("HeroModel");l.init(c,s),l.play("stand"),o.onTouch=function(){menuManager.pop("hero_info",{hid:a,refreshCb:function(){e.initPilots(),e.initTeam()}})},(r=e.teamNodeTable[a])||(r=cc.instantiate(e.memberNode),e.memberLayoutNode.addChild(r),e.teamNodeTable[a]=r,e.initTeamBoard(r,a,t)),e.refreshTeamBoard(r,a,+t+1)}else o.active=!1,o.onTouch=function(){},(r=e.teamEmptyList[n])||(r=cc.instantiate(e.memberEmptyNode),e.memberLayoutNode.addChild(r),e.teamEmptyList[n]=r),n++;r.getChildByName("index").getComponent(cc.Label).string=+t+1,r.active=!0,r.zIndex=t},r=0;r<4;r++)o(r);for(;n<this.teamEmptyList.length;n++)this.teamEmptyList[n].active=!1;this.memberLayoutNode.sortAllChildren(),this.memberLayoutNode.getComponent(cc.Layout).updateLayout()},initTeamBoard:function(e,t,i){var a=this,n=pc.getHero(t),o=pc.getHeroData(t),r=cc.find("avatar/hero_model",e).getComponent("HeroModel");r.init(o,n),r.play("stand"),e.heroModel=r;var s=e.getChildByName("card").getComponent(cc.Sprite);cc.resources.load(o.card,cc.SpriteFrame,function(e,t){s.spriteFrame=t}),e.getChildByName("leader").active=0==i,e.getChildByName("name").getComponent(cc.Label).string=o.name,e.getChildByName("career").getComponent(cc.Label).string=o.career,e.getChildByName("index").getComponent(cc.Label).string=+i+1,e.onTouch=function(){if(a.teamMode){var e=a.teamListData,i=e.indexOf(t);if(i>=0){for(var n in e.splice(i,1),a.heroTable){var o=a.heroTable[n];if(o.active&&o.hid==t){a.refreshHeroBoardByTeam(o,t);break}}pc.setTeam(e)}a.initTeam()}else menuManager.pop("hero_info",{hid:t,refreshCb:function(){a.initPilots(),a.initTeam()}})}},refreshTeamBoard:function(e,t,i){for(var a=pc.getHero(t),n=(pc.getHeroData(t),a?a.star:0),o=e.getChildByName("stars").getChildren(),r=0;r<5;r++)o[r].active=r<n;var s=this.heroTable[t];s&&(s.getChildByName("select").getChildByName("index").getComponent(cc.Label).string=i)},initPilots:function(){var e=excel.read("hero_list"),t=0;for(var i in cc.log("initPilots list",e),this.heroTable)this.heroTable[i].active=!1;for(var a=0;a<e.length;a++){var n=e[a].id,o=this.heroTable[n];o||(o=cc.instantiate(this.heroBoard),this.layoutNode.addChild(o),this.heroTable[n]=o),o.active=!0,t++,this.refreshHeroBoard(o,n)}if(!this.emptyList){this.emptyList=[];for(var r=t;r<12;r++){var s=cc.instantiate(this.emptyBoard);this.layoutNode.addChild(s),s.active=!0,this.emptyList.push(s)}}},refreshHeroBoardStat:function(e){if(cc.log("refreshHeroBoardStat",e),e.stat){var t=pc.getHeroStatScale(e.id),i=this.heroTable[e.id];for(var a in e.stat){var n=HeroStatDefine[e.stat[a]].rarity,o=t[e.stat[a]]>1;i.getChildByName("stat").children[a].active=!0,i.getChildByName("stat").children[a].getComponent(cc.Sprite).spriteFrame=o&&this.heroStatComboIconSpriteFrame[n]||this.heroStatIconSpriteFrame[n]}}},refreshHeroBoard:function(e,t){var i,a=this,n=pc.getHero(t),o=pc.getHeroData(t);e.hid=t,i=n?n.star:0;var r=cc.find("avatar/hero_model",e).getComponent("HeroModel");r.init(o,n),r.setGray(!i),n&&(e.getChildByName("bg").getComponent(cc.Sprite).spriteFrame=this.heroRaritySpriteFrame[n.star-1],e.getChildByName("bg").getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.heroRarityIconSpriteFrame[n.star-1],this.refreshHeroBoardStat(n)),e.getChildByName("name").getComponent(cc.Label).string=LI("hero_"+t);for(var s=e.getChildByName("stars").getChildren(),c=0;c<5;c++)s[c].active=c<i;var l=money.getNum([SHARD]+"."+t),d=pc.getHeroUpgradePrice(i),h=cc.find("progress/bar",e);h.color=i?cc.color(78,206,255):cc.color(114,255,79);var u=h.getComponent(cc.Sprite),p=cc.find("progress/label",e).getComponent(cc.Label);i<5?(u.fillRange=l/d,p.string=l+"/"+d):(u.fillRange=0,p.string=l+"/ - - -"),e.getChildByName("lock").active=!i&&l<d,e.getChildByName("bg").opacity=i?255:100,e.getChildByName("rp").active=!1,this.refreshHeroBoardByTeam(e,t),e.zIndex=-i,e.onTouch=function(){if(a.teamMode){var n=a.teamListData,o=n.indexOf(t);o>=0?n.splice(o,1):i>0&&n.length<4&&n.push(t),a.refreshHeroBoardByTeam(e,t),pc.setTeam(n),a.initTeam()}else{if(!pc.getHero(t))return void kit.info(LI("unlock_0"));a.enableHeroStatBoard(!0,t)}}},enableHeroStatBoard:function(e,t){var i=this;this.heroStatBoard.active=e,t&&(this.heroStatBackBtnNode.onTouch=function(){i.enableHeroStatBoard(!1)}),e?(this.heroStatBoardId=t,this.updateRefreshStatBtn(t),this.initHeroStatCards(t),this.updateHeroStatModel(t)):this.updateRecruitBtn()},updateHeroStatModel:function(e){var t=pc.getHero(e),i=pc.getHeroData(e);this.heroStatModelNode.getComponent("HeroModel").init(i,t)},updateRefreshStatBtn:function(e){var t=this,a=pc.getHero(e),n=!a.stat||this.heroStatRefreshBtnNode.isFree;this.heroStatRefreshBtnNode.getChildByName("adIcon").active=!n,this.heroStatRefreshBtnNode.onTouch=function(){if(!t.heroStatLockCt||n||money.had(HERO_REFRESH_TICKET,t.heroStatLockCt))if(cc.log("updateRefreshStatBtn free hero",n,a),n||a.refreshCt&&!(a.refreshCt<1))if(t.heroStatLockCt>=3)kit.info(LI("rolling_tip3"));else{var e=menuManager.popCover({noLoading:!0,time:5});sdk.useFree("reroll_skill",function(o){if(!o){var r,s,c={};for(var l in t.heroStatCards){var d=t.heroStatCards[l].getComponent("PilotStatCard").startRoll();c[l]=d}if(a.stat=c,!n){var h,u;a.refreshCt&&a.refreshCt--;var p=HERO+"."+a.id+".refreshCt";(h={})[p]=-1,r=h,(u={})[p]=1,s=u}cc.log("updateRefreshStatBtn",a.stat),2==user.getGuide("hero")&&user.setGuide("hero",3),net.updateData({heroes:[a],price:!n&&t.heroStatLockCt&&{i:HERO_REFRESH_TICKET,n:t.heroStatLockCt},add:r,min:s},function(n,o){if(!n){cc.log("updateRefreshStatBtn updateData",o),i.FirebaseTracking.setDataBiRes("PilotPage_StatCard"),money.update(o),pc.setHero(a);var r=pc.getHeroStatNum(a.id),s=pc.getHeroStatScale(a.id);for(var c in t.heroStatCards)cc.log("updateRefreshStatBtn stat",r,a.stat[c],a.stat,c),t.heroStatCards[c].getComponent("PilotStatCard").setNum(r[a.stat[c]],s[a.stat[c]],!0);for(var c in t.rollingEndChecked=!1,t.heroStatCards)t.heroStatCards[c].getComponent("PilotStatCard").startRollAnimation(function(){t.checkRollingEnd(a,e)})}}),n||YMTJ("video","crew_refresh")}},n)}else kit.info(LI("rolling_tip2"));else kit.info(LI("rolling_tip4"))},cc.log("PilotPage updateRefreshStatBtn hero.refreshCt",a.refreshCt),this.setGray(this.heroStatRefreshBtnNode,!n&&!a.refreshCt),this.heroStatRefreshTipsNode.active=!n&&!a.refreshCt;var o=this.heroStatRefreshBtnNumLabel;cc.log("updateRecruitBtn",o),this.heroStatLockCt?(o.node.parent.active=!0,o.string=money.getNum(HERO_REFRESH_TICKET)+"/"+this.heroStatLockCt,o.node.color=money.had(HERO_REFRESH_TICKET,1)&&cc.color(255,255,255)||cc.color(255,0,0)):o.node.parent.active=!1},checkRollingEnd:function(e,t){if(!this.rollingEndChecked){for(var i in this.heroStatCards)if(this.heroStatCards[i].getComponent("PilotStatCard").getActionRolling())return;this.rollingEndChecked=!0;var a=0;for(var i in this.heroStatCards)this.heroStatCards[i].getComponent("PilotStatCard").onAllRollingEnd(),this.heroStatCards[i].getComponent("PilotStatCard").isBingo&&a++;2==a&&(this.heroStatBonusEffectX2Node.active=!0,this.heroStatBonusEffectX2Node.scale=0,this.heroStatBonusEffectX2Node.opacity=255,this.heroStatBonusEffectX2Node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(1.5,1.6),cc.scaleTo(.1,0))),menuManager.playEffect(this.luckyGetAudio)),3==a&&(this.heroStatBonusEffectX3Node.active=!0,this.heroStatBonusEffectX3Node.scale=0,this.heroStatBonusEffectX3Node.opacity=255,this.heroStatBonusEffectX3Node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(1.5,1.6),cc.scaleTo(.1,0))),menuManager.playEffect(this.luckyGetAudio),menuManager.playEffect(this.luckyGet2Audio)),this.refreshHeroBoardStat(e),this.updateRefreshStatBtn(e.id),menuManager.closeCover(t)}},initHeroStatCards:function(e){var t=pc.getHeroData(e),i=pc.getHero(e),a=pc.getHeroStatNum(e),n=pc.getHeroStatScale(i.id);for(var o in this.heroStatCards){for(var r=i.stat&&i.stat[o],s=[],c=1;c<=i.star;c++)for(var l in t.stat){var d=t.stat[l];d+=c>1&&c||"",s.push(d)}this.heroStatCards[o].getComponent("PilotStatCard").init(r,s,this),r&&this.heroStatCards[o].getComponent("PilotStatCard").setNum(a[r],n[r])}this.updateHeroStatLock()},updateHeroStatLock:function(){var e=0;for(var t in this.heroStatCards)this.heroStatCards[t].getComponent("PilotStatCard").isLock&&e++;this.heroStatLockCt=e,this.updateRefreshStatBtn(this.heroStatBoardId)}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/Menu":"Menu"}],PilotStatCard:[function(e,t){"use strict";cc._RF.push(t,"9d9e30jjxFGcYOcXZnfy1ye","PilotStatCard"),cc.Class({extends:cc.Component,properties:{titleLabel:cc.RichText,desLabel:cc.Label,bonusDesLabel:cc.Label,raritySpriteFrames:[cc.SpriteFrame],lockBtnNode:cc.Node,contentLayoutNode:cc.Node,contentInstance:cc.Node,bingoNode:cc.Node,unknownNode:cc.Node,luckyRollAudio:{type:cc.AudioClip,default:null}},onLoad:function(){},init:function(e,t,i){var a=this;for(var n in this.statId=e,this.statList=t||[e],this.isLock=!1,this.lockBtnNode.getChildByName("1").active=!this.isLock,this.lockBtnNode.getChildByName("2").active=this.isLock,this.lockBtnNode.onTouch=function(){a.isLock=!a.isLock,a.lockBtnNode.getChildByName("1").active=!a.isLock,a.lockBtnNode.getChildByName("2").active=a.isLock,i.updateHeroStatLock()},this.contentLayoutNode.destroyAllChildren(),t)this.createContent(t[n]);this.node.runAction(cc.sequence(cc.delayTime(.01),cc.callFunc(function(){a.setLayoutPosition(e)}))),this.updateUI(),cc.log("PilotStatCard",e,t),this.bingoNode.stopAllActions(),this.bingoNode.opacity=0},setLayoutPosition:function(e,t){var i=this;for(var a in this.contentLayoutNode.children)if(this.contentLayoutNode.children[a].statId==e)return void(t?(this.actionRolling=!0,this.contentLayoutNode.runAction(cc.sequence(cc.moveTo(.2,cc.v2(this.contentLayoutNode.x,-43.651-153*a)).easing(cc.easeElasticOut(1)),cc.callFunc(function(){i.actionRolling=!1,t()})))):this.contentLayoutNode.y=-43.651-153*a)},getActionRolling:function(){return this.actionRolling},getLayoutPostion:function(e){for(var t in this.contentLayoutNode.children)if(this.contentLayoutNode.children[t].statId==e)return-43.651-153*t},updateBingoEffect:function(e){4==this.bingoScale?(this.bingoNode.scale=1.1,this.bingoNode.runAction(cc.sequence(cc.fadeIn(.5),cc.fadeOut(.5)).repeatForever()),e&&this.bonusDesLabel.node.runAction(cc.sequence(cc.scaleBy(.1,1.3),cc.scaleBy(.1,1/1.3),cc.delayTime(.5)).repeatForever())):(this.bingoNode.scale=1,this.bingoNode.runAction(cc.sequence(cc.fadeIn(.5),cc.fadeOut(.5)).repeatForever()),e&&this.bonusDesLabel.node.runAction(cc.sequence(cc.scaleBy(.1,1.2),cc.scaleBy(.1,1/1.2),cc.delayTime(.5)).repeatForever()))},update:function(e){if(this.bonusRollingSpeed&&(cc.log("PilotStatcard update bonusRollingSpeed",this.bonusRollingSpeed),this.bonusDesLabelTarget>this.bonusDesLabelCurrent?(this.bonusDesLabelCurrent=kit.numApproach(this.bonusDesLabelCurrent,this.bonusDesLabelTarget,this.bonusRollingSpeed*e),this.bonusDesLabel.string="+"+Math.round(1e3*this.bonusDesLabelCurrent)/10+"%"):(this.bonusRollingSpeed=null,this.isBingo&&this.updateBingoEffect(!0))),this.isRolling){if(this.contentLayoutNode.y-=2200*e,this.isRolling-=e,kit.timer(this,"sound",.1,e)&&menuManager.playEffect(this.luckyRollAudio),this.canStopRolling){var t=this.setLayoutPosition(this.statId,this.rollEndCB);cc.log("PilotStatcard targetY",this.statId,this.contentLayoutNode.y,t,this.isRolling),this.isRolling=!1,this.canStopRolling=!1,this.updateUI()}this.contentLayoutNode.y<-43.651-153*this.contentLayoutNode.children.length&&(this.contentLayoutNode.y=this.contentLayoutNode.y+153*(this.contentLayoutNode.children.length+1),this.isRolling<=0&&(this.canStopRolling=!0))}},createContent:function(e){var t=HeroStatDefine[e],i=cc.instantiate(this.contentInstance);i.statId=e,i.active=!0,this.contentLayoutNode.addChild(i),cc.resources.load(t.content,cc.SpriteFrame,function(e,t){i.getChildByName("content").getComponent(cc.Sprite).spriteFrame=t}),i.getComponent(cc.Sprite).spriteFrame=this.raritySpriteFrames[t.rarity]},updateUI:function(){var e=this.statId;if(!e)return this.titleLabel.node.active=!1,this.desLabel.node.active=!1,this.bonusDesLabel.node.active=!1,this.contentLayoutNode.active=!1,this.bingoNode.active=!1,this.lockBtnNode.active=!1,void(this.unknownNode.active=!0);this.titleLabel.node.active=!0,this.desLabel.node.active=!0,this.contentLayoutNode.active=!0,this.bingoNode.active=this.isBingo,this.unknownNode.active=!1,this.lockBtnNode.active=!0;var t=HeroStatDefine[e];this.titleLabel.string="<outline color=black width=2>"+t.title+"</outline>",this.lockBtnNode.active=!0},startRoll:function(){return this.isLock?this.statId:(this.statId=this.statList[kit.rndInt(0,this.statList.length-1)],this.statId)},startRollAnimation:function(e){if(this.titleLabel.node.active=!1,this.desLabel.node.active=!1,this.bonusDesLabel.node.active=!1,this.unknownNode.active=!1,this.lockBtnNode.active=!1,this.bingoNode.active=!1,this.isLock)return this.statId;this.isRolling=1,this.rollEndCB=e},onAllRollingEnd:function(){cc.log("PilotStatCard onAllRollingEnd bonusDesLabel target current",this.bonusDesLabelTarget,this.bonusDesLabelCurrent),this.bonusDesLabelTarget>this.bonusDesLabelCurrent&&(this.bonusRollingSpeed=2*(this.bonusDesLabelTarget-this.bonusDesLabelCurrent),this.bonusDesLabel.node.active=!0),this.updateUI()},setNum:function(e,t,i){void 0===e&&(e=1);var a=this.statId,n=(HeroStatDefine[a],e/t);t>1?i?(this.bonusDesLabel.string="",this.bonusDesLabelTarget=e-n,this.bonusDesLabelCurrent=0,this.bonusDesLabel.node.active=!0):(this.bonusDesLabelTarget=0,this.bonusDesLabelCurrent=0,this.bonusDesLabel.node.active=!0,this.bonusDesLabel.string="+"+Math.round(1e3*(e-n))/10+"%"):(this.bonusDesLabelTarget=0,this.bonusDesLabelCurrent=0,this.bonusDesLabel.node.active=!1),cc.log("PilotStatCard setNum",this.statId,n,this.bonusDesLabelTarget),e=Math.round(1e3*n)/10+"%",this.desLabel.string="+"+e,this.isBingo=t>1,this.bingoScale=t,this.bonusDesLabel.node.stopAllActions(),this.bonusDesLabel.node.scale=1,this.updateUI(),this.updateBingoEffect()}}),cc._RF.pop()},{}],Pilot:[function(e,t){"use strict";cc._RF.push(t,"57856loakJNkIPeA8qVR64N","Pilot");var i=e("../../ai/core/Assist"),a=e("../../ai/behaviors/movement/AISimple");cc.Class({init:function(e,t,i,a,n){this.game=e,this.obj=t,this.define=i||{},this.config=a,this.ui=n,this.initAI(a.ai,a.aiCfg)},initAI:function(t,i){if(t){var n=this.define.ctor||a;if(i){var o=kit.parse(i);n=o.ctor&&e(o.ctor)||n,o.ctor=n,o.cover?(o.cover=null,this.define=o):this.define=kit.mergeObjs(o,this.define)}this.setAI(n)}else this.setAI();this.aiEnabled=t},setAI:function(e){var t=new(e||i);t.init(this.game,this.obj,this.define,this.config),this.ai=t},isAiEnabled:function(){return this.aiEnabled},updateLogic:function(e){this.obj.isDead()||this.disabled||this.ai.updateLogic(e)},onSkillUpdate:function(e,t){this.ui&&this.ui.onSkillUpdate(e,t),SKILL_STATUS.READY},onSkillRefresh:function(e,t){this.ui&&this.ui.onSkillRefresh(e,t)},onSkillSilence:function(e,t){this.ui&&this.ui.onSkillSilence(e,t)},setEnabled:function(e){if(e)this.disabled=!1;else{this.disabled=!0;var t=this.obj;t.callMove(t.deg,0),t.callAutoAttack(!1),t.callRotate()}this.ui&&this.ui.setEnabled(e)},remove:function(){this.ui&&this.ui.onRemove(),this.game.removeUpdate(this)},callAssistTarget:function(e){this.ai.setForcedTarget(e)},callAssistSkill:function(e,t,i){this.ai.setSkill(e,t,i)},callAssistAttack:function(e,t,i){this.ai.setAttack(e,t,i)},callAim:function(e,t,i){this.ai.callAim(e,t,i)},callSkill:function(e,t){this.ai.callSkill(e,t)}}),cc._RF.pop()},{"../../ai/behaviors/movement/AISimple":"AISimple","../../ai/core/Assist":"Assist"}],Pinball:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"a03bcTSS5FCqJ7U4tbM1N85","Pinball"),cc.Class({extends:cc.Component,properties:{ballNodes:[cc.Node],basketNode:cc.Node,ctLabel:cc.Label,maxCt:30,dropTime:1,guideNode:cc.Node,hpNode:cc.Node,hpLabel:cc.Label,ballLayer:cc.Node},onLoad:function(){for(var e in this.node.opacity=0,this.node.runAction(cc.sequence(cc.delayTime(1),cc.fadeIn(.5))),this.towerTable={machine_gun:[],cannon:[]},window.pinballManager=this,this.ballCycleList=[],this.ballNodes)this.ballNodes[e].active=!1,this.ballCycleList[e]=[];var t=cc.director.getPhysicsManager();t.enabled=!0,t.enabledAccumulator=!0,t.FIXED_TIME_STEP=.1,t.MAX_ACCUMULATOR=.1,t.VELOCITY_ITERATIONS=1,t.POSITION_ITERATIONS=1;var i=this.node;i.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation();e.getID(),this.pos0=t,this.guideNode.active=!1},this),i.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation();e.getID(),this.updateBasket(t.x-this.pos0.x),this.pos0=t},this),i.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation();e.getID(),this.updateBasket(t.x-this.pos0.x)},this),this.timer=0,this.dropEnabled=!0,this.ct=this.maxCt,this.ctLabel.string=this.ct},onDestroy:function(){window.pinballManager=null},update:function(e){var t=this.baseObj;if(t){this.hp!==t.hp&&(this.hp=t.hp,this.hpLabel.string=Math.ceil(this.hp),this.hpNode.width=this.hp/t.hpMax*708);var i=t.game;i&&(i.finished?(this.dropEnabled=!1,!this.finished&&t.hp>0&&(this.finished=!0,this.node.runAction(cc.sequence(cc.fadeOut(1),cc.destroySelf())))):this.minTimeScale!==i.minTimeScale&&(this.minTimeScale=i.minTimeScale,cc.director.getPhysicsManager().enabled=!!this.minTimeScale,this.dropEnabled=!!this.minTimeScale))}if(this.dropEnabled&&(this.timer+=e,this.timer>this.dropTime&&(this.timer-=this.dropTime,this.ct>0))){this.ct--,this.ctLabel.string=this.ct;var a=this.createBall(kit.rndInt(0,this.ballNodes.length-1));a.x=this.basketNode.x+kit.rnd(-1,1),a.y=this.basketNode.y,a.angle=kit.rnd(0,360),a.multiplier=null,a.getComponent(cc.RigidBody).linearVelocity=cc.v2(0,0)}},updateBasket:function(e){this.basketNode.x=kit.clamp(this.basketNode.x+e,-320,320)},createBall:function(e){var t=cc.instantiate(this.ballNodes[e]);return t.parent=this.ballLayer,t.ballIndex=e,t.active=!0,t},checkBall:function(e){var t=this.baseObj;t&&(t.hp<=0||t.game.finished)?e.node.y<-500&&this.destroyBall(e):e.node.y<-280&&this.destroyBall(e)},destroyBall:function(e){var t;e.node.destroy();for(var a=e.bulletType,n=i(this.towerTable[a]);!(t=n()).done;)t.value.pinballCt++},addTower:function(e){var t=e.config.backpack.id;this.towerTable[t].push(e),e.pinballCt=0;var i=e.config.base;this.baseObj=i}}),cc._RF.pop()},{}],PlatformSprite:[function(e,t){"use strict";cc._RF.push(t,"d61d7bADPlCK7Nw3/4dN1Kl","PlatformSprite"),cc.Class({extends:cc.Component,init:function(e,t,i,a){if(this.define=i,this.game=e,e.layer.bindScheduler(this.node),i.frm||i.anime)var n=this.addComponent(cc.Sprite);if(i.frm&&e.effectMgr.loadSpriteFromAtlas(n,null,i.frm),i.anime){var o=i.anime,r=this.addComponent(cc.Animation);e.effectMgr.loadAnimation(n,r,o.atlas,o),n.node.scale*=ANIME_SCALE}this.x=a.x,this.y=a.y,this.deg=t.deg;var s=this.node;s.x=this.x,s.y=this.y},setVisible:function(e){this.node.active=e},setLocalZOrder:function(e){this.node.zIndex=e},getLocalZOrder:function(){return this.node.zIndex},getRotation:function(){return this.node.angle},getScale:function(){return this.node.scale},getScaleY:function(){return this.node.scaleY},addChild:function(e,t){this.node.addChild(e,t)},remove:function(){this.node.destroy()}}),cc._RF.pop()},{}],Platform:[function(e,t){"use strict";cc._RF.push(t,"8661dEo9uNL7aBLAc5rTk0z","Platform"),cc.Class({extends:e("../../core/base/Proto"),properties:{_x:0,x:{get:function(){return this._x},set:function(e){this._x=e}},_y:0,y:{get:function(){return this._y},set:function(e){this._y=e}},_deg:0,deg:{get:function(){return this._deg},set:function(e){this._deg=e}}},init:function(e,t,i){this.game=e,this.define=t,this.config=i,this.initAvatar(),this._x=i.x,this._y=i.y,this.groundIndex=i.ground||0,this.radius=t.radius,this.game.addUpdate(this),this.game.contactMgr.addPlatform(this)},initAvatar:function(){this.avatar=this.game.addAvatar(this,this.define.avatar,this.config)},updateLogic:function(){var e=this.game.levelMgr.cameraX,t=c_abs(this._x-e),i=400/GAME_VIEW_SCALE+this.radius,a=t<i;this._inDone=this._inDone||a,this._inDone&&t>i&&this.remove()},remove:function(){if(!this.removed){this.removed=!0;var e=this.game;e.removeUpdate(this),e.contactMgr.removePlatform(this),this.avatar.remove(),delete this.avatar}},getGroundDegree:function(){return 0},getGroundLeft:function(){return this._x-this.getGroundWidth()/2},getGroundRight:function(){return this._x+this.getGroundWidth()/2},getGroundLine:function(){return this._y+this.define.dy},getGroundWidth:function(){return this.define.w},callDeath:function(){}}),cc._RF.pop()},{"../../core/base/Proto":"Proto"}],PoisonBuff:[function(e,t){"use strict";cc._RF.push(t,"86d83CJ0q9IG7sXcP1/HZzZ","PoisonBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){this.obj;var e=this.define;this.dmg=e.dmg||0,this.timer=e.dt||.1,this.hurtColor=cc.color(0,255,0),this._critChance=0},update:function(e){if(this.timer-=e,this.timer<=0){this.timer=this.define.dt;var t=this.obj;t.onHurt(this,this.dmg),this.game.callEffect(EFFECT.bleed,t.x,t.y,0)}},end:function(){}}),cc._RF.pop()},{"./Buff":"Buff"}],PopMenu:[function(e,t){"use strict";cc._RF.push(t,"69e032wZO5ARY/Me7Qup5pd","PopMenu"),cc.Class({extends:e("./Menu"),properties:{board:cc.Node},waitOnClose:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchClose,this)},onTouchClose:function(){this.args.noWait||this.close()},onLoad:function(){this.waitOnClose();var e=this.board;e&&(e.opacity=0,e.y-=100)},onPlace:function(){this.onLoadAd()},start:function(){var e;e=this.isBannerOpened()?70:0;var t=this.board;t?t.runAction(cc.sequence(cc.spawn(cc.fadeIn(.2),cc.moveBy(.2,0,e+100).easing(cc.easeBounceOut())),cc.callFunc(this.onPlace,this))):this.onPlace()}}),cc._RF.pop()},{"./Menu":"Menu"}],PowerBullet:[function(e,t){"use strict";cc._RF.push(t,"53c95YhX8pAzLEUcbAYv4s1","PowerBullet"),cc.Class({extends:e("./Bullet"),initStatus:function(){this.initAvatar(),this.game.addUpdate(this),this.game.addRender(this),this.game.contactMgr.addBullet(this),this.map={},this.bulletMark=!1,this._ignoreGround=this.define.noWall},onHit:function(e,t){if(!e.isDead()&&!(e.onBltContact&&e.onBltContact(this)||this.map[e.uniqueID])){this.map[e.uniqueID]=!0,this.hurtDelayTime=STEP_TIME*t;var i=this.define;if(e.onHurt(this,this.dmg,i.weaponType,i.dmgType),e.hurtEffect||this.game.callEffect(EFFECT.spurt,e,this.deg,this.knockBack,this.hurtDelayTime),this.knockBack){var a=this.knockBack/e.weight;e.onKnockback(this.moveSpdX*a,this.moveSpdY*a)}if(this.buff&&e.addBuff(this,this.buff),e.isDead()){var n=this.moveSpdX>0&&kit.rnd(150,225)||-kit.rnd(150,225),o=kit.rnd(0,0);e.y>this.game.contactMgr.findGroundLine(e.x)+e.height&&(o=0,n=kit.rnd(55,111)),e.applyVelocity(n,o)}this.avatar&&this.avatar.hitEffect&&this.game.callEffect(this.avatar.hitEffect,e.x,e.y,e.deg,e.hurtDelayTime,e.hitRadius)}}}),cc._RF.pop()},{"./Bullet":"Bullet"}],Power:[function(e,t){"use strict";cc._RF.push(t,"92674ZJNfdBFoObelaQUx9W","Power"),cc.Class({extends:cc.Component,properties:{pvpType:"",buyMode:!1,useMode:!1,upAudio:{type:cc.AudioClip,default:null},buyAudio:{type:cc.AudioClip,default:null},icon:cc.Node},onLoad:function(){this.buyMode&&cc.game.on("add_power",this.onAddMoney,this),this.useMode&&cc.game.on("use_power",this.onUseMoney,this)},init:function(e){this.args=e;var t=this.pvpType=e.pvp;this.num=pvp.getModePower(t),this.refreshPowerList(this.num)},refreshPowerList:function(e){for(var t=this.pvpType,i=pvp.getModeDefine(t),a=this.node.getChildByName("list"),n=0;n<i.maxPower;n++){var o=a.getChildByName(""+n);o.active=!0,o.getChildByName("icon").active=n<e}for(var r=i.maxPower;r<5;r++)a.getChildByName(""+r).active=!1},onUseMoney:function(e){if(e.pvp==this.pvpType){menuManager.playEffect(this.buyAudio,0),this.num+=e.n,this.refreshPowerList(this.num);for(var t=cc.Canvas.instance.node,i=e.pos||cc.v2(cc.winSize.width/2,cc.winSize.height/2),a=t.convertToNodeSpaceAR(i),n=t.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0))),o=0;o<-e.n;o++){var r=cc.instantiate(this.icon);t.addChild(r,cc.macro.MAX_ZINDEX),r.active=!0,r.scale=2,r.x=n.x+kit.rnd(-50,50),r.y=n.y+kit.rnd(-50,50),r.runAction(cc.sequence(cc.bezierTo(.5,[cc.v2(n.x+kit.rnd(-200,200),n.y+kit.rnd(-200,0)),cc.v2(a.x+kit.rnd(-150,150),a.y+kit.rnd(-50,50)),a]).easing(cc.easeInOut(1)),cc.destroySelf()))}}},onAddMoney:function(e){if(cc.log(e,this.pvpType),e.pvp==this.pvpType){this.node.runAction(cc.sequence(cc.delayTime(.8),cc.callFunc(function(){menuManager.playEffect(this.upAudio,0),this.num+=e.n,this.refreshPowerList(this.num)},this)));for(var t=cc.Canvas.instance.node,i=e.pos||cc.v2(cc.winSize.width/2,cc.winSize.height/2),a=t.convertToNodeSpaceAR(i),n=t.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2(0,0))),o=0;o<e.n;o++){var r=cc.instantiate(this.icon);t.addChild(r,cc.macro.MAX_ZINDEX),r.active=!0,r.scale=1.5,r.x=a.x+kit.rnd(-20,20),r.y=a.y+kit.rnd(-20,20),r.runAction(cc.sequence(cc.jumpTo(.5+.05*o,a.x+kit.rnd(-150,150),a.y-20,40,2),cc.bezierTo(.3,[cc.v2(a.x+kit.rnd(-200,200),a.y+kit.rnd(-200,200)),cc.v2(n.x+kit.rnd(-200,200),n.y+kit.rnd(-200,0)),n]).easing(cc.easeIn(1)),cc.destroySelf()))}}}}),cc._RF.pop()},{}],PressToStartPopMenu:[function(e,t){"use strict";cc._RF.push(t,"ebabcp+uzxDR7E+odxbYXft","PressToStartPopMenu"),cc.Class({extends:e("../ui/core/Menu"),properties:{text:cc.Node,text2:cc.Node},init:function(e){this.game=e.game,this.game.pushTimeScale(0),this.text.scale=0,this.text.runAction(cc.sequence(cc.scaleTo(.1,1.3),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever()),this.text2.runAction(cc.sequence(cc.fadeIn(1),cc.fadeOut(1),cc.delayTime(.2)).repeatForever()),TJ.onGuideEvent({guide_id:2,guide_name:"\u7b2c\u4e00\u7ae0-\u8fdb\u5165"})},close:function(){menuManager.close(),this.game.popTimeScale(0),TJ.onGuideEvent({guide_id:3,guide_name:"\u7b2c\u4e00\u7ae0-\u542f\u52a8"})}}),cc._RF.pop()},{"../ui/core/Menu":"Menu"}],PrisonerAvatar:[function(e,t){"use strict";cc._RF.push(t,"81285pDtuRFaItH8wur1ZIE","PrisonerAvatar"),cc.Class({extends:e("./ArmatureAvatar"),initAnime:function(){this._super();var e=this.define;this.cage=this.game.effectMgr.createSprite(0,10,"avatar/cage"),this.node.addChild(this.cage),this.cage.scale=e.s||1,this.game.callEffect(EFFECT.avatarPrisoner,this)},updateRender:function(){var e=this.obj;this.setFlipX(e.flipX),this.needRefresh&&(e.isDead()?this.callAnime("slute",1,1):this.callAnime("stand",1),(!this.forcedAnimeName||this.forcedAnimeDelay<=0)&&(this.fadeTime=null,this.needRefresh=!1,this.forcedRefresh=!1),this.effect&&this.effect.refresh(this)),this.updateStatus()}}),cc._RF.pop()},{"./ArmatureAvatar":"ArmatureAvatar"}],ProgressionTrack:[function(e,t){"use strict";cc._RF.push(t,"d818eseO/9DDqCFOWpx+kuF","ProgressionTrack");var i=e("../../../../Plugins/firebase/FirebaseTracking");window.configRewardProgressionTrack=[{index:0,levelProgressionTrack:1,expRequired:100,reward:{item1:{id:4,i:"bouncing_ball"}}},{index:1,levelProgressionTrack:2,expRequired:800,reward:{item1:{i:SWEEP_TICKET,n:3}}},{index:2,levelProgressionTrack:3,expRequired:1200,reward:{item1:{i:GOLD,n:1e3}}},{index:3,levelProgressionTrack:4,expRequired:1800,reward:{item1:{id:3,i:"fly_shield"}}},{index:4,levelProgressionTrack:5,expRequired:2800,reward:{item1:{i:RECRUIT_TICKET,n:2}}},{index:5,levelProgressionTrack:6,expRequired:3700,reward:{item1:{id:5,i:"fuelTank"}}},{index:6,levelProgressionTrack:7,expRequired:4700,reward:{item1:{i:GOLD,n:2e3}}},{index:7,levelProgressionTrack:8,expRequired:5800,reward:{item1:{i:GOLD,n:2e3}}},{index:8,levelProgressionTrack:9,expRequired:7e3,reward:{item1:{i:RECRUIT_TICKET,n:2}}},{index:9,levelProgressionTrack:10,expRequired:8200,reward:{item1:{id:6,i:"energyBarrier"}}}],cc.Class({extends:e("../../core/PopMenu"),properties:{itemPrefab:cc.Prefab,rootItemNode:cc.Node,expProgressionTrackLb:cc.Label,expLevel:cc.Label,levelProgressionTrackLb:cc.Label,processExp:cc.Sprite,btnClose:cc.Node,scrollViewCpm:cc.ScrollView},onLoad:function(){this.currLevel=0,this.listItem=[]},onEnable:function(){cc.Canvas.instance&&cc.Canvas.instance.node&&(cc.Canvas.instance.node.focusNode=null)},onDisable:function(){cc.Canvas.instance&&cc.Canvas.instance.node&&(cc.Canvas.instance.node.focusNode=null);var e=cc.find("Canvas/mainMenu");e&&e.getComponent("MainMenu")&&e.getComponent("MainMenu").updateGuide()},initStatus:function(){this.currentExp=money.getNum(EXP_PROGRESSION_TRACK),this.currentProgressionTrack=pc.getProgressisonTrack(),this.updateUI(),this.initGuide()},updateUI:function(){this.rootItemNode.removeAllChildren();for(var e=0;e<configRewardProgressionTrack.length;e++){var t=configRewardProgressionTrack[e],i=cc.instantiate(this.itemPrefab),a=i.getComponent("ItemProgressionTrack");this.rootItemNode.addChild(i),this.currLevel=t.expRequired<=this.currentExp?t.levelProgressionTrack:this.currLevel,a.initializeStatus(t,this.currentProgressionTrack[""+e]),this.listItem.push(a)}this.expProgressionTrackLb.string=this.currentExp,this.levelProgressionTrackLb.string="LEVEL "+this.currLevel,this.updateLabelLevel()},initGuide:function(){if(console.log(user.getGuide("progressionTrack")),1==user.getGuide("progressionTrack")&&2==user.getGuide("chapter")){var e=this;i.FirebaseTracking.LogCustomEvent("ButtonClick",{Status:1,cohort_day:user.countLoginDay,claim_time:Utils.getCurrentUTCTimestamp()}),this.scheduleOnce(function(){e.scrollViewCpm.scrollToTop(.5),e.scheduleOnce(function(){var t=e.listItem[e.listItem.length-1];t&&t.btnClaim&&menuManager.focusOn(t.btnClaim,null,null,function(){menuManager.pop("show_guide_progression_track",{checkCb:function(){e.scrollViewCpm.scrollToBottom(.5),e.scheduleOnce(function(){e.listItem&&e.listItem[0]&&e.listItem[0].btnClaim?menuManager.focusOn(e.listItem[0].btnClaim,null,null,function(){i.FirebaseTracking.logNewTutorial({Step:12,userID:user.uuid,Status:1}),user.setGuide("progressionTrack",3),user.quickSave("guide.progressionTrack",3),cc.game.once("claimNewEquipment",e.onDoneGuide.bind(e))},null,null):(user.setGuide("progressionTrack",3),user.quickSave("guide.progressionTrack",3))},.6)}})},null,null,!1)},.6)},.1)}},updateLabelLevel:function(){var e,t,i=null==(e=configRewardProgressionTrack[this.currLevel])?void 0:e.expRequired,a=(null==(t=configRewardProgressionTrack[this.currLevel-1])?void 0:t.expRequired)||0;console.log("maxExp , minExp",i,a);var n=(this.currentExp-a)/(i-a);this.processExp.fillRange=Math.max(0,Math.min(1,n)),this.expLevel.string=this.currLevel,user.levelProgression=this.currLevel,cc.game.emit("UpdateExpProgression",{currentExp:this.currentExp,currentLevel:this.currLevel,currentProcess:this.processExp.fillRange})},onDoneGuide:function(){cc.Canvas.instance&&cc.Canvas.instance.node&&(cc.Canvas.instance.node.focusNode=null),menuManager.focusOn(this.btnClose,null,null,function(){cc.Canvas.instance.node.focusNode=null;var e=cc.find("Canvas/mainMenu");e&&e.getComponent("MainMenu")&&e.getComponent("MainMenu").updateGuide()},null,null)},onClickGuide:function(){menuManager.pop("show_guide_progression_track",{})}}),cc._RF.pop()},{"../../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../core/PopMenu":"PopMenu"}],PromiseExt:[function(e,t,i){"use strict";cc._RF.push(t,"44312EGkONHpbmQ1pY8jskl","PromiseExt"),Object.defineProperty(i,"__esModule",{value:!0}),i.DeferredPromise=void 0;var a=0;Promise.wait=function(e,t){return t||(t=cc.director.getScene()),new Promise(function(i){e>0?cc.director.getScheduler().schedule(function(){return i()},t,e,0,0,!1):i()})},Promise.waitUntil=function(e,t,i){return void 0===i&&(i=0),new Promise(function(n){t||(t={id:"Promise.waitUntil_"+a++});var o=function(){e()&&(cc.director.getScheduler().unschedule(o,t),n())};cc.director.getScheduler().schedule(o,t,i,cc.macro.REPEAT_FOREVER,0,!1)})},Promise.task=function(){return new n};var n=function(){function e(){var e=this;this._succeed=!1,this._failed=!1,this.promise=new Promise(function(t,i){e.res=t,e.rej=i})}return e.prototype.resolve=function(e){this._succeed=!0,this.res(e)},e.prototype.reject=function(e){this._failed=!0,this.rej(e)},Object.defineProperty(e.prototype,"succeed",{get:function(){return this._succeed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"failed",{get:function(){return this._failed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"completed",{get:function(){return this._succeed||this._failed},enumerable:!1,configurable:!0}),e}();i.DeferredPromise=n,cc._RF.pop()},{}],Proto:[function(e,t){"use strict";cc._RF.push(t,"95f0cbfEMZGxrezbDmzqgc1","Proto"),cc.Class({properties:{_critChance:-1,_critBonus:-1,_atkScale:-1},getPrev:function(){return this.obj},getOwner:function(){return this.obj?this.getPrev().getOwner():this},getCaster:function(){return this.getPrev().getCaster()},getAtkScale:function(e,t,i,a){return this._atkScale>=0?this._atkScale:this.getPrev().getAtkScale(e,t,i,a)},getCritChance:function(){return this._critChance>=0?this._critChance:this.getPrev().getCritChance()},getCritSufferChance:function(){return this._critSuffer>=0?this._critSuffer:this.getPrev().getCritSufferChance()},getCritBonus:function(){return this._critBonus>=0?this._critBonus:this.getPrev().getCritBonus()},getDmgScale:function(){return 1},isHeatOver:function(){return!1},onContact:function(){},onKnockback:function(){},onHurt:function(){},addBuff:function(){},getBuff:function(){},isInBorder:function(){return!0},isDead:function(){},isFly:function(){},updateLogic:function(){},getSpdX:function(){return 0}}),cc._RF.pop()},{}],PvpBar:[function(e,t){"use strict";cc._RF.push(t,"978b6vzCmlH+I0BB6nNXsaa","PvpBar"),cc.Class({extends:cc.Component,properties:{leftBoard:[cc.Node],rightBoard:[cc.Node],label0:cc.Label,label1:cc.Label,leftName:cc.Label,rightName:cc.Label},setScoreLabel:function(e){this.label0.string=e,this.label1.string=e},init:function(e){this.game=e,this.scores=[0,0],this.setScoreLabel("0 - 0"),this.initUI()},initUI:function(){},initList:function(e){var t=this.game,i=e.config;t.me==i.me?this.leftObj&&this.leftObj.config.revive==e.revive||(this.leftName.string=i.name||"",this.updateList(this.leftBoard,e),this.leftObj=e):this.rightObj&&this.rightObj.config.revive==e.revive||(this.rightName.string=i.name||"",this.updateList(this.rightBoard,e),this.rightObj=e)},updateList:function(e,t){var i,a=t.config.revive,n=a.remoteList,o=a.deathCt,r=1;for(var s in n)s==o?i=e[0]:(i=e[r],r++),i.getComponent("TeamHead").init(n[s],s<o)},update:function(){var e=this.game.levelMgr.roundScore;e[0]==this.scores[0]&&e[1]==this.scores[1]||(this.scores[0]=e[0],this.scores[1]=e[1],this.setScoreLabel(e[0]+" - "+e[1]),this.leftObj&&this.updateList(this.leftBoard,this.leftObj),this.rightObj&&this.updateList(this.rightBoard,this.rightObj))}}),cc._RF.pop()},{}],QuestBar:[function(e,t){"use strict";cc._RF.push(t,"e53ac5AGuRFBomOjhvKmlRn","QuestBar"),cc.Class({extends:cc.Component,properties:{label:cc.Label},init:function(e,t,i){this.updateFunc=i,this.cond=t,this.game=e;var a=this.node,n=255;t.v.q||(n=100),a.x-=50,a.opacity=0,a.runAction(cc.spawn(cc.moveBy(.2,50,0),cc.fadeTo(.2,n)))},update:function(e){var t=this.updateFunc(e);t&&(this.label.string=t)},up:function(e){this.node.runAction(cc.moveBy(.1,0,e))},remove:function(e){this.enabled=!1,this.update(),this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.moveBy(.5,-50,0).easing(cc.easeBounceOut()),cc.fadeOut(.2),cc.callFunc(function(){var t=e.indexOf(this);if(!(t<0)){e.splice(t,1);for(var i=t;i<e.length;i++)e[i].up(50)}},this),cc.destroySelf()))}}),cc._RF.pop()},{}],QuickRecoverOnLowBuff:[function(e,t){"use strict";cc._RF.push(t,"31c1bzCGjhJ9oULWoJPBNCz","QuickRecoverOnLowBuff"),cc.Class({extends:e("./Buff"),cover:function(e){cc.log("QuickRecoverOnLowBuff cover",e.buff),this.buff=e.buff},begin:function(){var e=this.define;this.hpPercent=e.hpPercent||.4;var t=this.obj;this.game.eventMgr.regist(t,"hurtEvent",this,this.hurtEvent),this.buff=this.define.buff,cc.log("QuickRecoverOnLowBuff begin",this.obj)},applyBuff:function(){if(cc.log("QuickRecoverOnLowBuff applyBuff"),this.obj.towers)for(var e in this.obj.towers)"fuelTank"==this.obj.towers[e].unitType&&(this.obj.towers[e].addBuff(this,this.buff),cc.log("QuickRecoverOnLowBuff applyBuff index",this.buff))},hurtEvent:function(e){if(cc.log("QuickRecoverOnLowBuff hurtEvent",e.hp,e.hpMax*this.hpPercent,e.hpMax,this.hpPercent),e.hp<=e.hpMax*this.hpPercent)return this.applyBuff(),this.callEnd(),!0},end:function(){var e=this.obj;this.game.eventMgr.unregist(e,"hurtEvent",this),cc.log("QuickRecoverOnLowBuff end")}}),cc._RF.pop()},{"./Buff":"Buff"}],RecommendBar:[function(e,t){"use strict";cc._RF.push(t,"f7c7aBn+5BPrKOCKnMxMq1V","RecommendBar"),cc.Class({extends:cc.Component,properties:{adNode:cc.Node,max:0,time:5,nativeGridAd:!1,wxFloatId:0},onLoad:function(){if("tt"!=CH){for(var e=this.uiList=[],t=this.max||12,i=0;i<t;i++){var a=cc.instantiate(this.adNode);this.adNode.parent.addChild(a),e[i]=a}this.adNode.active=!1,this.refreshList()}else this.node.active=!1},onDestroy:function(){},refreshList:function(){var e=this,t=window.mpsdk;if(t){var i=this.max||12,a=this.uiList;t.Ad.getSuggestList(!1,this.max,pc.getChapterIndex()).then(function(n){console.log("\u5e7f\u544a\u5217\u8868",n);for(var o=function(){var e=n[r],i=a[r];if(!e)return i.active=!1,"continue";i.active=!0,(s=i.getChildByName("name"))&&(s.getComponent(cc.Label).string=e.title);var o=i.getChildByName("icon").getComponent(cc.Sprite);cc.assetManager.loadRemote(e.icon,function(e,t){if(!e&&t&&cc.isValid(o)){var i=new cc.SpriteFrame;i.setTexture(t),o.spriteFrame=i,o.node.width=100,o.node.height=100}}),i.onTouch=function(){t.Ad.click(e)}},r=0;r<i;r++){var s;o()}e.node.runAction(cc.sequence(cc.delayTime(e.time),cc.callFunc(e.refreshList,e)))})}}}),cc._RF.pop()},{}],RecommendBtn:[function(e,t){"use strict";cc._RF.push(t,"86a10moMNRAzK1BaCEng23J","RecommendBtn"),cc.Class({extends:e("../ui/widgets/buttons/ClickButton"),onLoad:function(){this._super(),this.node.active=!1},callMoreGame:function(){cc.sys.platform!=cc.sys.BYTEDANCE_GAME?menuManager.pop("more_game"):tt.showMoreGamesModal&&tt.showMoreGamesModal({appLaunchOptions:TT_APP_LIST,success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})},onTouch:function(){this.callMoreGame()}}),cc._RF.pop()},{"../ui/widgets/buttons/ClickButton":"ClickButton"}],RecommendIcon:[function(e,t){"use strict";cc._RF.push(t,"b0bb7NqFslHx5oWkQUvsi5m","RecommendIcon"),window.TT_APP_LIST=[{name:"\u70ed\u8840\u4e4c\u9f99\u7403",icon:"rxwlq.png",appId:"tt7dd50b68e2eecb9b",query:"",extraData:{}},{name:"\u672b\u65e5\u8fb9\u7f18",icon:"mrby.png",appId:"tt7dd50b68e2eecb9b",query:"",extraData:{}},{name:"\u73a9\u67aa",icon:"wq.png",appId:"tteef2984f71d86077",query:"",extraData:{}},{name:"\u70ed\u8840\u7ec6\u80de",icon:"rxxb.png",appId:"tt8e6ef8d311445b72",query:"",extraData:{}},{name:"98k",icon:"98k.png",appId:"tt24885235bba24bf4",query:"",extraData:{}},{name:"\u6c42\u751f\u4e4b\u65e5",icon:"qszr.png",appId:"tt7e4a08f7e1606db0",query:"",extraData:{}}],cc.Class({extends:cc.Component,properties:{icon:cc.Sprite,time:5},onLoad:function(){"tt"!=CH?(this.refreshIcon(),this.node.runAction(cc.sequence(cc.delayTime(3),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1),cc.scaleTo(.15,1.1),cc.scaleTo(.15,1),cc.scaleTo(.2,1.1),cc.scaleTo(.2,1)).repeatForever())):this.node.active=!1},setIcon:function(e){var t=this.icon;if(cc.isValid(t)){var i=new cc.SpriteFrame;i.setTexture(e),t.spriteFrame=i,t.node.width=100,t.node.height=100,this.node.runAction(cc.sequence(cc.delayTime(this.time),cc.callFunc(this.refreshIcon,this)))}},refreshIcon:function(){var e=this;if(cc.sys.platform!=cc.sys.BYTEDANCE_GAME){var t=window.mpsdk;t&&t.Ad.getRecommendInfo(pc.getChapterIndex()).then(function(t){console.log("\u5e7f\u544a\u6570\u636e",t),e.adInfo=t,cc.assetManager.loadRemote(t.icon,function(t,i){!t&&i&&e.setIcon(i)})})}else{var i=[];for(var a in TT_APP_LIST)TT_APP_LIST[a].icon&&i.push(TT_APP_LIST[a].icon);var n="sdk/icon/"+kit.rndOne(i);cc.assetManager.loadRemote(n,function(t,i){!t&&i&&e.setIcon(i)})}},onClick:function(){if(cc.sys.platform!=cc.sys.BYTEDANCE_GAME){var e=window.mpsdk;e&&this.adInfo&&e.Ad.click(this.adInfo)}else tt.showMoreGamesModal&&tt.showMoreGamesModal({appLaunchOptions:TT_APP_LIST,success:function(e){console.log("success",e)},fail:function(e){console.log("fail",e)}})}}),cc._RF.pop()},{}],RecoverBuff:[function(e,t){"use strict";cc._RF.push(t,"cd787YcKW1Jxoh/0KvHegDX","RecoverBuff"),cc.Class({extends:e("./Buff"),cover:function(){this.hp+=this.define.hp||0,this.hpPercent+=this.define.hpPercent||0},begin:function(){var e=this.define;this.time=e.dt||1,this.timer=this.time,this.hp=e.hp||0,this.hpPercent=e.hpPercent||0},getTowersStat:function(e){var t=1;if(this.obj.towers)for(var i in this.obj.towers)"heal"!=this.obj.towers[i].unitType&&"fuelTank"!=this.obj.towers[i].unitType||(t+=this.obj.towers[i][e]-1);return t},update:function(e){if(this.timer-=e*this.getTowersStat("atkSpd"),this.timer<=0){this.timer=this.time;var t=this.obj,i=this.hp;this.hpPercent&&(i+=t.hpMax*this.hpPercent),t.onHeal(this,i*this.getTowersStat("_atkScale"))}},end:function(){}}),cc._RF.pop()},{"./Buff":"Buff"}],RemoteConfigManager:[function(e,t){"use strict";function i(){i=function(){return e};var e={},t=Object.prototype,a=t.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(B){l=function(e,t,i){return e[t]=i}}function d(e,t,i,a){var o=t&&t.prototype instanceof p?t:p,r=Object.create(o.prototype),s=new S(a||[]);return n(r,"_invoke",{value:_(e,i,s)}),r}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(B){return{type:"throw",arg:B}}}e.wrap=d;var u={};function p(){}function f(){}function m(){}var g={};l(g,r,function(){return this});var v=Object.getPrototypeOf,y=v&&v(v(I([])));y&&y!==t&&a.call(y,r)&&(g=y);var b=m.prototype=p.prototype=Object.create(g);function k(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function T(e,t){function i(n,o,r,s){var c=h(e[n],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&a.call(d,"__await")?t.resolve(d.__await).then(function(e){i("next",e,r,s)},function(e){i("throw",e,r,s)}):t.resolve(d).then(function(e){l.value=e,r(l)},function(e){return i("throw",e,r,s)})}s(c.arg)}var o;n(this,"_invoke",{value:function(e,a){function n(){return new t(function(t,n){i(e,a,t,n)})}return o=o?o.then(n,n):n()}})}function _(e,t,i){var a="suspendedStart";return function(n,o){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw o;return{value:void 0,done:!0}}for(i.method=n,i.arg=o;;){var r=i.delegate;if(r){var s=w(r,i);if(s){if(s===u)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===a)throw a="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a="executing";var c=h(e,t,i);if("normal"===c.type){if(a=i.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(a="completed",i.method="throw",i.arg=c.arg)}}}function w(e,t){var i=t.method,a=e.iterator[i];if(void 0===a)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),u;var n=h(a,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,u;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(a.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=m,n(b,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:f,configurable:!0}),f.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(T.prototype),l(T.prototype,s,function(){return this}),e.AsyncIterator=T,e.async=function(t,i,a,n,o){void 0===o&&(o=Promise);var r=new T(d(t,i,a,n),o);return e.isGeneratorFunction(i)?r:r.next().then(function(e){return e.done?e.value:r.next()})},k(b),l(b,c,"Generator"),l(b,r,function(){return this}),l(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),i=[];for(var a in t)i.push(a);return i.reverse(),function e(){for(;i.length;){var a=i.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=I,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,a){return r.type="throw",r.arg=e,t.next=i,a&&(t.method="next",t.arg=void 0),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],r=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var s=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),C(i),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var a=i.completion;if("throw"===a.type){var n=a.arg;C(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:I(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},e}function a(e,t,i,a,n,o,r){try{var s=e[o](r),c=s.value}catch(l){return void i(l)}s.done?t(c):Promise.resolve(c).then(a,n)}function n(e){return function(){var t=this,i=arguments;return new Promise(function(n,o){var r=e.apply(t,i);function s(e){a(r,n,o,s,c,"next",e)}function c(e){a(r,n,o,s,c,"throw",e)}s(void 0)})}}cc._RF.push(t,"e60dfuo4MpPEoM6XNeJtLyu","RemoteConfigManager");var o,r,s,c=cc.Class({extends:cc.Component,statics:{_instance:null,getInstance:function(){return this._instance||(this._instance=new c),this._instance}},ctor:function(){this.isFetching=!1,this.fetchTimeout=null,this.FETCH_TIMEOUT=5e3,this.isInitialized=!1,this.fetchPromiseResolve=null,this.fetchPromiseReject=null,this.mapDataDefault={}},initialize:(s=n(i().mark(function e(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,!this.isInitialized){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,this.setDefaultConfigValues();case 5:return e.abrupt("return",new Promise(function(e){if(t.isInitialized=!0,t.setupCallbacks(),NativeUtils.isAndroid()){var i=!1;try{"undefined"!=typeof jsb&&jsb.reflection&&(i=!0)}catch(a){cc.log("[Remote Config]",a)}if(i)try{NativeUtils.initializeRemoteConfig(),console.log("[RemoteConfigManager] initializeRemoteConfig"),t.fetchWithTimeout().then(function(){e()}).catch(function(i){console.error("[RemoteConfigManager] Remote config fetch failed:",i),t.setDefaultConfigValues(),e()})}catch(n){console.error("[RemoteConfigManager] Initialization error:",n),t.setDefaultConfigValues(),e()}else t.setDefaultConfigValues(),e()}else t.setDefaultConfigValues(),e()}));case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)}),setupCallbacks:function(){var e=this;if(window.RemoteConfigCallbacks||(window.RemoteConfigCallbacks={}),window.RemoteConfigManager=window.RemoteConfigManager||{},window.RemoteConfigManager.onRemoteConfigFetched=function(t){e.clearFetchTimeout(),e.isFetching=!1,t.updated},window.RemoteConfigManager.onRemoteConfigError=function(t){console.error("[RemoteConfigManager] Fetch error:",t),e.clearFetchTimeout(),e.isFetching=!1,e.setDefaultConfigValues(),e.fetchPromiseResolve&&(e.fetchPromiseResolve(),e.fetchPromiseResolve=null,e.fetchPromiseReject=null)},window.RemoteConfigManager.onRemoteConfigUpdate=function(t){if("string"==typeof t)try{console.log("[RemoteConfigManager] onRemoteConfigUpdate:",t);var i=JSON.parse(t);e.applyRemoteConfigValues(i)}catch(a){console.error("[RemoteConfigManager] Failed to parse configs string:",a.message)}else"object"==typeof t?e.applyRemoteConfigValues(t):console.error("[RemoteConfigManager] Unexpected configs type:",typeof t);e.fetchPromiseResolve&&(e.fetchPromiseResolve(),e.fetchPromiseResolve=null,e.fetchPromiseReject=null)},window.RemoteConfigManager.pendingCallbacks&&Array.isArray(window.RemoteConfigManager.pendingCallbacks)){var t=window.RemoteConfigManager.pendingCallbacks;window.RemoteConfigManager.pendingCallbacks=[];for(var i=0;i<t.length;i++){var a=t[i];window.RemoteConfigManager[a.name]&&window.RemoteConfigManager[a.name](a.data)}}window.RemoteConfigManagerInstance=e},getDefaultConfigValues:(r=n(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadLocalConfigDefaults();case 2:return e.abrupt("return",this.mapDataDefault);case 3:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)}),setDefaultConfigValues:(o=n(i().mark(function e(){var t,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitialized){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getDefaultConfigValues();case 4:t=e.sent,window.BATTLE_PASS_REWARD_CONFIG=t.BattlePassRewardConfig,window.REARD_COMPLETE_STAGE=t.RewardCompleteStage,window.TASK_CONFIG=t.TaskConfig,window.TASK_MILESTONE_CONFIG=t.TaskMilestoneConfig,window.CHAPTER_HARD_FIX_CONFIG=t.ChapterHardFixConfig,window.CHAPTER_DEFINE_ARRAY=window.initChapterDefineFromData(t.ChapterConfig),window.DRAW_RULES_CONFIG=t.draw_rules_config,(a=t.draw_rules_config)&&(window.attempt_n=a.attempt_n,window.hp_normal=a.hp_normal,window.hp_hurt=a.hp_hurt,window.hp_damage=a.hp_damage),NativeUtils.isAndroid()?this.setNativeDefaults():this.setWebDefaults();case 15:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)}),setNativeDefaults:function(){window.BONUS_BLOCK_THRESHOLD=98,window.DRAW_BLOCK_BONUS_AD=398,window.DRAW_BLOCK_BONUS=78,window.NO_SAME_ITEM_DRAW_COUNT=2,window.ITEM_TYPE_WEIGHTS=.25,window.DRAW_ITEMS_POWER={},window.RARITY_UPGRADE_CONFIG={},window.GAME_CONFIG={hp_consecutive:.8,multiplier_diff:1.2},window.FEATURE_TOGGLE={draw_rules_mode:!1,multiplier_mode:!1}},setWebDefaults:function(){window.DRAW_ITEMS_POWER={rarity:{rare0:120,rare1:12,rare2:8,block:15},shape:{1:0,2:0,3:0,4:0},diversity:.1},window.RARITY_UPGRADE_CONFIG={bonusRarity1_chance:.1,bonusRarity1_target:2,bonusRarity1_adChance:.7},window.BONUS_BLOCK_THRESHOLD=99,window.DRAW_BLOCK_BONUS_AD=299,window.DRAW_BLOCK_BONUS=89,window.NO_SAME_ITEM_DRAW_COUNT=2,window.ITEM_TYPE_WEIGHTS=0,window.FEATURE_TOGGLE={draw_rules_mode:!1,multiplier_mode:!1},window.GAME_CONFIG={hp_consecutive:.8,multiplier_diff:1.2},this.setupRemoteConfigValues()},fetchWithTimeout:function(){var e=this;return new Promise(function(t,i){if(e.isFetching)t();else{e.isFetching=!0,e.fetchPromiseResolve=t,e.fetchPromiseReject=i,e.fetchTimeout=setTimeout(function(){e.isFetching=!1,e.clearFetchTimeout(),e.setDefaultConfigValues(),t()},e.FETCH_TIMEOUT);try{"undefined"!=typeof NativeUtils&&"function"==typeof NativeUtils.fetchAndActivateRemoteConfig?NativeUtils.fetchAndActivateRemoteConfig():(e.clearFetchTimeout(),e.isFetching=!1,e.setDefaultConfigValues(),t())}catch(a){console.error("[RemoteConfigManager] Fetch error:",a),e.clearFetchTimeout(),e.isFetching=!1,e.setDefaultConfigValues(),t()}}})},clearFetchTimeout:function(){this.fetchTimeout&&(clearTimeout(this.fetchTimeout),this.fetchTimeout=null)},manualChapterConversion:function(e){for(var t=[],i=Object.keys(e).sort(),a=0;a<i.length;a++){var n=e[i[a]];n&&t.push(n)}return t},processConfigParameter:function(e,t,i){if(e[t])try{var a;a="string"==typeof e[t]?JSON.parse(e[t]):e[t],window[i]=a,console.log("[RemoteConfigManager] "+i+" loaded:",window[i])}catch(n){console.error("[RemoteConfigManager] Error parsing "+t+":",n.message)}},applyRemoteConfigValues:function(e){console.log("[RemoteConfigManager] applyRemoteConfigValues START");var t=Object.keys(e);if(console.log("[RemoteConfigManager] Config keys (",t.length,"):",t.join(", ")),e.chapter_config)try{var i,a=i="string"==typeof e.chapter_config?JSON.parse(e.chapter_config):e.chapter_config;if("object"!=typeof i||Array.isArray(i))Array.isArray(i)?a=i:console.error("[RemoteConfigManager] Unexpected chapter_config format:",typeof i);else if("function"==typeof window.initChapterDefineFromData)try{a=window.initChapterDefineFromData(i)}catch(o){console.error("[RemoteConfigManager] Error in initChapterDefineFromData:",o),a=this.manualChapterConversion(i)}else a=this.manualChapterConversion(i);window.CHAPTER_DEFINE_ARRAY=a}catch(o){console.error("[RemoteConfigManager] Error parsing chapter_config:",o.message)}if(e.chapter_hard_fix_config)try{var n;n="string"==typeof e.chapter_hard_fix_config?JSON.parse(e.chapter_hard_fix_config):e.chapter_hard_fix_config,window.CHAPTER_HARD_FIX_CONFIG=n}catch(o){console.error("[RemoteConfigManager] Dont have data remote of chapter_hard_fix_config",o.message)}this.processConfigParameter(e,"draw_rules_config","DRAW_RULES_CONFIG"),window.DRAW_RULES_CONFIG&&(window.attempt_n=window.DRAW_RULES_CONFIG.attempt_n,window.hp_normal=window.DRAW_RULES_CONFIG.hp_normal,window.hp_hurt=window.DRAW_RULES_CONFIG.hp_hurt,window.hp_damage=window.DRAW_RULES_CONFIG.hp_damage,console.log("[RemoteConfigManager] Threshold values from remote config:"),console.log("  - attempt_n:",window.attempt_n),console.log("  - hp_normal:",window.hp_normal),console.log("  - hp_hurt:",window.hp_hurt),console.log("  - hp_damage:",window.hp_damage)),this.processConfigParameter(e,"game_config","GAME_CONFIG"),this.processConfigParameter(e,"rarity_upgrade_config","RARITY_UPGRADE_CONFIG"),this.processConfigParameter(e,"draw_items_power","DRAW_ITEMS_POWER"),this.processConfigParameter(e,"feature_toggle","FEATURE_TOGGLE"),void 0!==e.bonus_block_threshold&&(window.BONUS_BLOCK_THRESHOLD=e.bonus_block_threshold),window.REMOTE_CONFIG_LOADED=!0,this.setupRemoteConfigValues()},setupRemoteConfigValues:function(){window.FEATURE_TOGGLE&&window.FEATURE_TOGGLE.multiplier_mode?window.GAME_CONFIG?(window.hp_consecutive=window.GAME_CONFIG.hp_consecutive,window.multiplier_diff=window.GAME_CONFIG.multiplier_diff,console.log("[RemoteConfigManager] Multiplier values from GAME_CONFIG:"),console.log("  - hp_consecutive:",window.hp_consecutive),console.log("  - multiplier_diff:",window.multiplier_diff),void 0===window.multiplier_diff&&console.error("[RemoteConfigManager] ERROR: multiplier_diff is undefined in GAME_CONFIG"),void 0===window.hp_consecutive&&console.error("[RemoteConfigManager] ERROR: hp_consecutive is undefined in GAME_CONFIG")):console.error("[RemoteConfigManager] ERROR: GAME_CONFIG not found"):console.log("[RemoteConfigManager] Multiplier mode disabled")},cleanup:function(){this.clearFetchTimeout(),this.isFetching=!1},getStatus:function(){return this.isFetching?"fetching":NativeUtils.isAndroid()?"ready":"local_only"},loadLocalConfigDefaults:function(){console.log("[RemoteConfigManager] loadLocalConfigDefaults");var e=this,t=["ChapterConfig","ChapterHardFixConfig","draw_rules_config","RateIdleRewardConfig","weeklyRewards","BattlePassRewardConfig","RewardCompleteStage","TaskConfig","TaskMilestoneConfig"];return new Promise(function(i){var a=0,n=t.length;t.forEach(function(t){cc.resources.load("config/"+t,function(o,r){if(o)return console.error("Failed to load config local",o),void(++a===n&&(console.log("All configs loaded",e.mapDataDefault),i(e.mapDataDefault)));e.mapDataDefault[t]=r.json,++a===n&&(console.log("All configs loaded",e.mapDataDefault),i(e.mapDataDefault))})})})},loadConfigDefalts:function(){}});t.exports=c,cc._RF.pop()},{}],RenameMenu:[function(e,t){"use strict";cc._RF.push(t,"f917359/ctFvI5PcVZEyYFJ","RenameMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{editBox:cc.EditBox,fuckwordsFile:{default:null,type:cc.TextAsset},yesBtnNode:cc.Node,noBtnNode:cc.Node,priceLabel:cc.Label},initReg:function(){if(!this.regExp){for(var e=(a=this.fuckwordsFile.text).split("\u3001"),t=/[(){[*+?.\\^$|]/g,i=0;i<e.length;i++){var a=e[i];e[i]=a.replace(t,"\\$&")}var n=new RegExp("(?:"+e.join("|")+")","gi");this.regExp=n}},checkReg:function(e){if("string"!=typeof e)return cc.error("TypeError: "+e+" word is not a string!"),0;var t=e.match(this.regExp)||[];return cc.log(e+" checked!",t),t.length>0},initStatus:function(e){this.initReg(),this.editBox.string=user.getUserName()||rnd_name(),this.yesBtnNode.getChildByName("diamond").active=!e.force,this.yesBtnNode.getChildByName("free").active=e.force,this.noBtnNode.active=!e.force,this.priceNum=5,this.priceLabel.string=this.priceNum},onCheck:function(e){var t=this,a=this.editBox.string;if(a){if(a!=user.getUserName())if(this.checkReg(a))kit.info(LT("\u8fd9\u4e2a\u540d\u5b57\u4e0d\u53ef\u4f7f\u7528"));else{var n;if(!this.args.force){if(money.check(DIAMOND,this.priceNum))return;n={i:DIAMOND,n:this.priceNum}}var o={};o.name=a,net.post("updateData",{price:n,set:o},function(n,o){cc.log(n,o),n||(user.setUserName(a),cc.game.emit("name_change"),kit.info(LT("\u6539\u540d\u6210\u529f")),t.args.force?t.close(!0):(i.FirebaseTracking.setDataBiRes("Rename"),money.update(o),cc.game.emit("use_money",{pos:e.target.convertToWorldSpaceAR(cc.v2(0,0)),tid:"rename",i:DIAMOND,n:-t.priceNum})))})}}else kit.info(LT("\u8bf7\u8f93\u5165\u4e00\u4e2a\u540d\u5b57"))},onRandom:function(){this.editBox.string=rnd_name()}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],ResLoader:[function(e,t){"use strict";cc._RF.push(t,"bd106CpdcFKuqjepZfEeiiT","ResLoader"),cc._RF.pop()},{}],RestrainBuff:[function(e,t){"use strict";cc._RF.push(t,"18819YWkEhDhJR+HXECZABi","RestrainBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.obj;e.setFlag(NO_ATTACK,!0),e.setFlag(NO_MOVE,!0),e.avatar.refresh()},end:function(){var e=this.obj;e.setFlag(NO_ATTACK,!1),e.setFlag(NO_MOVE,!1),e.avatar.refresh()}}),cc._RF.pop()},{"./Buff":"Buff"}],ReviveBuff:[function(e,t){"use strict";cc._RF.push(t,"fdcebHqicRA4LVGOqlSoL78","ReviveBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.obj;this.status=0,this.timer=.5,e.deathFade&&e.deathTimer>0&&(this.timer+=e.deathTimer+1,this.timer>5&&(this.timer=5)),e.setFlag(NO_ATTACK,!0),e.setFlag(NO_MOVE,!0),e.setInvincible(!0),this.effectList=[]},update:function(e){this.timer-=e;var t=this.game,i=this.obj;if(this.timer<=0)if(0==this.status){i.onRevive(this,i.hpMax),this.status=1,this.timer=1;var a=this.define.protectEffect;this.effectList.push(t.callEffect(a,i.avatar))}else 1==this.status&&(this.status=2,i.setFlag(NO_ATTACK,!1),i.setFlag(NO_MOVE,!1))},end:function(){var e=this.obj;for(var t in this.status<2&&(0==this.status&&e.onRevive(this,e.hpMax),e.setFlag(NO_ATTACK,!1),e.setFlag(NO_MOVE,!1)),this.effectList){var i=this.effectList[t];i&&i.remove()}this.effectList=[],e.setInvincible(!1)}}),cc._RF.pop()},{"./Buff":"Buff"}],ReviveMenu:[function(e,t){"use strict";cc._RF.push(t,"a04c1/IcShDgYgDzZhujB6Q","ReviveMenu"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{timeLabel:cc.Label,reviveBtnNode:cc.Node,cancelBtnNode:cc.Node,coverNode:cc.Node},initStatus:function(e){e.title&&(this.titleLabel.string=e.title),this.game=e.game,this.timer=e.time||10,this.timeLabel.string=this.timer,this.coverNode.opacity=0,this.reviveBtnNode.active=!1,this.cancelBtnNode.active=!1},onPlace:function(){this._super(),this.game.pushTimeScale(0),this.node.getChildByName("bg"),this.coverNode.runAction(cc.fadeTo(.2,150)),this.reviveBtnNode.active=!0,this.cancelBtnNode.active=!0,this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){if(this.timer<=0)return this.game.popTimeScale(0),void this.close(!1);this.timer-=1,this.timeLabel.string=this.timer},this)).repeatForever())},onCheck:function(e,t){var i=this;if(t){this.node.stopAllActions();var a=this.args.eventName||"get_revived";sdk.useTicket(a,function(e,t){e||(i.coverNode.runAction(cc.fadeOut(.5)),i.board.runAction(cc.fadeOut(.5)),i.game.popTimeScale(0),i.scheduleOnce(function(){i.close(!0),t&&YMTJ("video",a)},.5))})}else this.game.popTimeScale(0),this.close(!1)},start:function(){var e;e=this.isBannerOpened()?70:0,this.board.runAction(cc.sequence(cc.delayTime(4.5),cc.callFunc(this.onPlace,this),cc.spawn(cc.fadeIn(.2),cc.moveBy(.2,0,e+100).easing(cc.easeBounceOut()))))}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],RewardBtn:[function(e,t){"use strict";cc._RF.push(t,"5a3b359glhED5P5z5v6DN37","RewardBtn"),cc.Class({extends:e("../ui/widgets/buttons/ClickButton"),onLoad:function(){this._super(),this.node.active=!1},callMoreReward:function(){menuManager.pop("more_reward")},onTouch:function(){this.callMoreReward()}}),cc._RF.pop()},{"../ui/widgets/buttons/ClickButton":"ClickButton"}],RewardMenu:[function(e,t){"use strict";cc._RF.push(t,"c666dU2jrlNPLOJAnH7Fbp3","RewardMenu");var i=e("../../Plugins/firebase/FirebaseTracking"),a={loadData:function(){return a.data||(a.data=privacy.decodeToJson("recommend_reward")||{}),a.data},saveData:function(){privacy.encodeFromJson("recommend_reward",a.data)},getData:function(e){return a.loadData()[e]},canReward:function(e){var t=a.getData(e);if(!t||t.time<Date.now())return!0},isFirstClick:function(e){if(!a.getData(e))return!0},listen:function(e){if(console.log("recommend listen"),!a.listened){if(cc.sys.platform==cc.sys.WECHAT_GAME){if(window.bl)return;wx.onShow(a.onShow)}a.listened=!0}a.clickDate=Date.now(),a.listenId=e,delete a.showId},jump:function(e,t){console.log("recommend jump"),a.clickId=e,a.clickCb=t,a.showId==e&&(console.log("recommend jump loot"),a.loot())},clear:function(){delete a.clickDate,delete a.clickId,delete a.clickCb,delete a.listenId,delete a.showId},loot:function(){var e=a.clickDate,t=a.clickId;if(e&&t){if(delete a.clickDate,delete a.clickId,delete a.showId,!a.canReward(t))return console.log("recommend next day"),void kit.info("\u4eca\u5929\u5df2\u7ecf\u9886\u53d6\u8fc7\u5956\u52b1\u4e86");if(Date.now()-e<15e3)return console.log("recommend short time",e),void kit.info("\u9700\u8981\u8bd5\u73a9\u4e00\u6bb5\u65f6\u95f4");var n=50,o=DIAMOND;a.isFirstClick(t)||(n=20);var r={};r[o]=n,net.post("updateData",{add:r},function(e,n){if(cc.log(e,n),!e){i.FirebaseTracking.setDataBiRes("RecommendReward"),money.update(n);var o=a.getData(t);o||(o=a.data[t]={count:0});var r=new Date;r.setDate(r.getDate()+1),r.setHours(0),r.setMinutes(0),r.setSeconds(0),o.time=r.getTime(),o.count++,a.saveData(),a.clickCb()}})}},onShow:function(e){a.clickId&&a.clickDate?(console.log("recommend onShow loot",e),a.loot()):a.listenId&&(console.log("recommend onShow wait",e),a.showId=a.listenId)}};cc.Class({extends:e("../ui/core/PopMenu"),properties:{adNode:cc.Node},initStatus:function(){},onDestroy:function(){this._super(),a.clear()},onLoad:function(){this._super();for(var e=this.uiList=[],t=this.max||12,i=0;i<t;i++){var a=cc.instantiate(this.adNode);this.adNode.parent.addChild(a),e[i]=a,a.active=!1}this.adNode.active=!1,this.refreshList()},refreshNode:function(e,t){var i=this,n=e.getChildByName("name");n&&(n.getComponent(cc.Label).string=t.title);var o=e.getChildByName("icon").getComponent(cc.Sprite);cc.assetManager.loadRemote(t.icon,function(e,t){if(!e&&t&&cc.isValid(o)){var i=new cc.SpriteFrame;i.setTexture(t),o.spriteFrame=i,o.node.width=80,o.node.height=80}});var r=t.id,s=50,c=DIAMOND;if(a.isFirstClick(r)||(s=20),cc.find("price/label",e).getComponent(cc.Label).string="x"+s,!a.canReward(r))return e.opacity=100,e.onTouch=function(){kit.info("\u4e00\u5929\u540e\u53ef\u518d\u6b21\u9886\u53d6")},void(e.zIndex=1);e.zIndex=0,e.opacity=255,e.onTouch=function(){a.listen(r),mpsdk.Ad.click(t,0,!0).then(function(n){console.log("ad click",n),a.jump(r,function(){i.refreshNode(e,t),kit.info("\u8bd5\u73a9\u6210\u529f",function(){cc.game.emit("add_money",{pos:e.convertToWorldSpaceAR(cc.v2(0,0)),i:c,n:s})})})}).catch(function(e){console.log("ad click err",e),kit.info("\u8df3\u8f6c\u53d6\u6d88")})}},refreshList:function(){var e=this,t=window.mpsdk;if(t){var i=this.max||12,a=this.uiList;t.Ad.getExcitationList(!0,this.max,pc.getChapterIndex()).then(function(t){console.log("\u5e7f\u544a\u5217\u8868",t);for(var n=0;n<i;n++){var o=t[n],r=a[n];o?(r.active=!0,e.refreshNode(r,o)):r.active=!1}})}else{i=this.max||12,a=this.uiList;for(var n=0;n<i;n++)a[n].active=!0}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],Rope:[function(e,t){"use strict";cc._RF.push(t,"1a2772VEl9NyqTeFZcKgvIn","Rope"),e("../components/attributes/Attribute"),e("../entities/projectiles/Bullet"),e("../components/combat/buffs/Buff"),e("../components/Slot"),cc.Class({extends:e("../core/base/Entity"),init:function(e,t,i){this.define=t,this.config=i,this.game=e,this.initFlags(),this.initAttributes(),this.initStatus(),this.game.addUpdate(this),this.game.addRender(this),this.initPhysics(),this.initAvatar(),this.initPilot(),this.initDebug(),this.initSlots(),t.createCb&&t.createCb.call(this)},updatePhysics:function(e){var t=this._deg;t>180&&(t-=360),this._physic_vr+=.01*-t,this._super(e)},updateLogic:function(e){this.pilot.updateLogic(e),this.updateMove(e),this.updatePhysics(e),this.updateMoveOffset(e)},callDeath:function(){}}),cc._RF.pop()},{"../components/Slot":"Slot","../components/attributes/Attribute":"Attribute","../components/combat/buffs/Buff":"Buff","../core/base/Entity":"Entity","../entities/projectiles/Bullet":"Bullet"}],SDKManager:[function(e,t,i){"use strict";cc._RF.push(t,"736cb/7YUdMA5QTg9ijuOfB","SDKManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.SDKManager=i.delay=void 0;var a=e("./ADManager"),n=e("./applovin/MAX"),o=cc._decorator,r=o.ccclass;o.property,i.delay=function(e){return __awaiter(this,void 0,Promise,function(){return __generator(this,function(){return[2,new Promise(function(t){return setTimeout(t,e)})]})})};var s=function(){function e(){this.HaveBanner=!1,this.HaveInterstitial=!1,this.HaveReward=!0,this.pausedTime=0,this.CurrentScreen="Gameplay"}var t;return t=e,Object.defineProperty(e,"Instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),e.prototype.loadAdCumValue=function(){var e=cc.sys.localStorage.getItem("adcumvalue");null===e||isNaN(parseFloat(e))?(e="0",this._adCumValue=0):this._adCumValue=parseFloat(e)},e.prototype.setAdCumValue=function(e){e>0&&(this._adCumValue+=e,cc.sys.localStorage.setItem("adcumvalue",this._adCumValue.toString()))},e.prototype.getAdCumValue=function(){return this._adCumValue},e.prototype.StartFlowInitSDK=function(){return __awaiter(this,void 0,Promise,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.loadAdCumValue(),e=this.initSDK(),[4,Promise.all([e])];case 1:return t.sent(),[2]}})})},e.prototype.initSDK=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.initMAX(),[2]})})},e.prototype.initMAX=function(){n.MAX.instance.init({banner:"",interstitial:"",rewarded:"725bfc6149134eb2",autoRefresh:!0},function(){a.ADManager.Instance.initAdSDK()})},e.prototype.startLevelTimer=function(){this.startTime=Date.now(),this.pausedTime=0},e.prototype.pauseLevelTimer=function(){this.pauseStart=Date.now()},e.prototype.resumeLevelTimer=function(){var e=Date.now();this.pausedTime+=e-this.pauseStart},e.prototype.endLevelTimer=function(){return this.endTime=Date.now(),Math.floor((this.endTime-this.startTime-this.pausedTime)/1e3)},e.prototype.getTimeSpent=function(){var e=Date.now();return Math.floor((e-this.startTime)/1e3)},e.prototype.getAttempts=function(e){var t=e,i=cc.sys.localStorage.getItem(t);return i||(i="0"),parseInt(i)},e.prototype.incrementAttempts=function(e){var t=e,i=this.getAttempts(e);i+=1,cc.sys.localStorage.setItem(t,i.toString())},e.prototype.getDailyCount=function(){var e=cc.sys.localStorage.getItem("dailyCount");return e||(e="0"),parseInt(e)},e.prototype.incrementDailyCount=function(){var e=this.getDailyCount();e+=1,cc.sys.localStorage.setItem("dailyCount",e.toString())},e.prototype.getEndlessCount=function(){var e=cc.sys.localStorage.getItem("endlessCount");return e||(e="0"),parseInt(e)},e.prototype.incrementEndlessCount=function(){var e=this.getEndlessCount();e+=1,cc.sys.localStorage.setItem("endlessCount",e.toString())},e.prototype.handleLevelStart=function(e){this.incrementAttempts(e),this.startLevelTimer()},e.prototype.getCurrentDate=function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,a=i<10?"0"+i:i.toString(),n=e.getDate();return""+t+a+(n<10?"0"+n:n.toString())},e.prototype.generateUniqueID=function(e){return e+"i"+this.getAttempts(e)+"a"+this.getCurrentDate()+"d"},e.prototype.generateUniqueID_DailyEndless=function(e){return e+"i"+this.getCurrentDate()+"d"},e._instance=null,t=__decorate([r("SDKManager")],e)}();i.SDKManager=s,cc._RF.pop()},{"./ADManager":"ADManager","./applovin/MAX":"MAX"}],SettingMenu:[function(e,t){"use strict";cc._RF.push(t,"8f773cX6lJI/KuUtMiNvoO1","SettingMenu"),cc.Class({extends:e("../core/PopMenu"),properties:{aboutLabel:cc.Label,clubNode:cc.Node,privacyNode:cc.Node,logoutNode:cc.Node,discordNode:cc.Node,UIDLabel:cc.Label,privacyLabel:cc.RichText,copyNode:cc.Node},onSwitch:function(e,t){var i;cc.log(e,t),window[t]=!window[t],i=window[t]?1:0,storage.set(t,i)},initStatus:function(){if(this.aboutLabel){var e,t=new Date(BUILD_TIME);e="potato"==CH?"":LT("\u53d1\u6761\u6e38\u620f");var i=MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION+"."+BUILD_VERSION+"-"+CODE_VERSION,a="[0.0.0] ";window.nativeSdk&&nativeSdk.getVersion&&(a="["+nativeSdk.getVersion()+"] ");var n=t.toLocaleString("en-US",{timeZone:"UTC"}),o="\n("+GetABTestStr()+")";this.aboutLabel.string=e+" v"+i+a+n+o,this.aboutLabel.node.onTouch=function(){var e=user.getUID(),t=sdk.pt();if(t){if(t.setClipboardData)return void t.setClipboardData({data:e,success:function(){kit.info("\u590d\u5236ID\u5230\u526a\u8d34\u677f")},fail:function(e){console.log("fail",e)}})}else if(window.nativeSdk){if(nativeSdk.writeToClipboard)return nativeSdk.writeToClipboard(e),void kit.info("\u590d\u5236ID\u5230\u526a\u8d34\u677f")}else if(window.navigator&&navigator.clipboard)return void navigator.clipboard.writeText(e).then(function(){kit.info("\u590d\u5236ID\u5230\u526a\u8d34\u677f")});console.warn("\u4e0d\u652f\u6301\u526a\u8d34\u677f")}}this.privacyNode&&(this.privacyNode.active=["taptap","oppo"].includes(CH)),this.clubNode&&(this.clubNode.active="wx"===CH),this.logoutNode&&(this.logoutNode.active=["taptap","google"].includes(CH)),this.discordNode&&(this.discordNode.active=["google"].includes(CH)),this.UIDLabel&&(this.UIDLabel.string="UID:"+cc.sys.localStorage.getItem("test_id")),this.privacyLabel&&userProtocol.setLoginRichText(this.privacyLabel)},onCopyText:function(){console.log("copyNode"+sdk.now());var e=cc.sys.localStorage.getItem("test_id");sdk.CopyText(e)},onPlace:function(){this._super(),this.createButton()},onDestroy:function(){this._super(),this.wxClubBtn&&this.wxClubBtn.destroy()},createButton:function(){if(this.clubNode&&"wx"===CH&&cc.sys.platform===cc.sys.WECHAT_GAME&&wx.createGameClubButton){var e=cc.view.getDevicePixelRatio(),t=cc.view.getScaleX()/e,i=cc.view.getScaleY()/e,a=this.clubNode.getBoundingBoxToWorld();console.log("createGameClubButton",a),this.wxClubBtn=wx.createGameClubButton({type:"text",text:"",style:{left:a.x*t,top:(cc.winSize.height-a.y-a.height)*i,width:a.width*t,height:a.height*i}}),this.wxClubBtn.show()}},callUserProtocol:function(){kit.openURL(URLS.identify_protocol)},callPrivacyProtocol:function(){kit.openURL(URLS.privacy_protocol)},callIdentifyProtocol:function(){window.nativeSdk&&nativeSdk.openIdentifyProtocol&&nativeSdk.openIdentifyProtocol()},callPermissionList:function(){kit.openURL(URLS.permission_list)},callSDKList:function(){kit.openURL(URLS.sdk_list)},callUserInfoList:function(){kit.openURL(URLS.user_info)},callPayment:function(){kit.openURL(URLS.payment)},callUserInfo:function(){var e="\u3000\u3000\u5b9e\u540d\u72b6\u6001\uff1a\u3000\u5df2\u5b9e\u540d\n\u3000\u3000\u6e38\u620f\u540d\u79f0\uff1a\u3000"+GAME_TITLE+"\n\u3000\u3000\u4e0b\u8f7d\u6e20\u9053\uff1a\u3000www.fattoy.cn\n\u3000\u3000\u7248\u672c\u53f7\uff1a\u3000\u3000"+MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION+"."+BUILD_VERSION+"-"+CORE_VERSION+"<size=16>\n\n * \u6e29\u99a8\u63d0\u793a: \u82e5\u9700\u8981\u4fdd\u5b58\u5f53\u524d\u4fe1\u606f, \u8bf7\u5c06\u8be5\u9875\u9762\u8fdb\u884c\u622a\u56fe\u4fdd\u5b58</size>";menuManager.pop("notice",{noCancel:1,title:"\u4e2a\u4eba\u4fe1\u606f",infoAlign:cc.RichText.HorizontalAlign.LEFT,info:e})},callLogout:function(){window.nativeSdk&&nativeSdk.logout?(nativeSdk.logout(CH),user.logout()):user.logout()},callDiscord:function(){cc.sys.openURL("https://discord.gg/XMfYPYvJ7p")},onTestCrash:function(){menuManager.pop("check",{title:"Test Crash",info:"This will trigger a test crash for Crashlytics.\n\nAre you sure?",checkCb:function(){console.log("window.crashlytics ",window.crashlytics),window.crashlytics?setTimeout(function(){window.crashlytics.log("Test crash initiated from settings menu"),window.crashlytics.setCustomKey("test_crash",!0),window.crashlytics.setCustomKey("crash_time",sdk.now()),window.crashlytics.setUserId(user.getUID()),window.crashlytics.testCrash()},100):(console.error("Crashlytics not initialized"),kit.info("Crashlytics not available"))}})}}),cc._RF.pop()},{"../core/PopMenu":"PopMenu"}],Shine:[function(e,t){"use strict";cc._RF.push(t,"15a7d+2VKVA35vYaazBsC87","Shine"),cc.Class({extends:cc.Component,properties:{lines:[cc.Node],light:cc.Node},onLoad:function(){this.node;var e=function e(){var t=kit.rnd(1,1.5),i=.7*t,a=.8*t;this.angle=this.angle0+kit.rnd(-10,10),this.runAction(cc.sequence(cc.spawn(cc.fadeTo(i,100),cc.scaleTo(i,1,1)),cc.spawn(cc.fadeTo(a,255),cc.scaleTo(a,.7,.8)),cc.spawn(cc.fadeTo(i,0),cc.scaleTo(i,1.1,1)),cc.callFunc(e,this)))};for(var t in this.lines){var i=this.lines[t];i.angle0=i.angle,i.opacity=kit.rnd(0,255),e.call(i)}this.light.runAction(cc.sequence(cc.scaleTo(1.5,1.2),cc.scaleTo(2,1)).repeatForever())}}),cc._RF.pop()},{}],ShopPage:[function(e,t){"use strict";cc._RF.push(t,"a6f20vmMzdIoa4b05pIe1eS","ShopPage");var i=e("../../../Plugins/firebase/FirebaseTracking"),a=e("../../utils/AnimUtils");window.midBoxRndList=[{c:.2,i:TALENT,n:[{c:.25,v:1},{c:.5,v:2},{c:.25,v:3}]},{c:.3,i:SHARD,id:["h1","h2","h3","h4","h5","h6"],n:[{c:.25,v:1},{c:.5,v:2},{c:.25,v:3}]},{c:.3,i:SHARD,id:["v1","v2","v3"],n:[{c:.25,v:1},{c:.5,v:2},{c:.25,v:3}]},{c:.2,i:EXP,n:[{c:.25,v:50},{c:.5,v:100},{c:.25,v:150}]},{c:.05,i:[BLUEPRINT_ATK,BLUEPRINT_HP,BLUEPRINT_SKILL],n:1}],window.bigBoxRndList=[{c:.2,i:TALENT,n:[{c:.3,v:2},{c:.3,v:3},{c:.3,v:5},{c:.1,v:10}]},{c:.3,i:SHARD,id:["h1","h2","h3","h4","h5","h6"],n:[{c:.3,v:2},{c:.3,v:3},{c:.3,v:5},{c:.1,v:10}]},{c:.3,i:SHARD,id:["v1","v2","v3"],n:[{c:.3,v:2},{c:.3,v:3},{c:.3,v:5},{c:.1,v:10}]},{c:.2,i:EXP,n:[{c:.3,v:100},{c:.3,v:150},{c:.3,v:250},{c:.1,v:500}]},{c:.15,i:[BLUEPRINT_ATK,BLUEPRINT_HP,BLUEPRINT_SKILL],n:[{c:.3,v:1},{c:.3,v:2},{c:.1,v:3}]},{c:.1,i:SWEEP_TICKET,n:[{c:.3,v:1},{c:.1,v:2}]}],window.SHOP_ITEM_LIST_DIAMOND=[{item:{i:EQUIPMENT,n:5,rarity:1},price:{i:DIAMOND,n:6}},{item:{i:EQUIPMENT,n:10,rarity:1},price:{i:DIAMOND,n:12}},{item:{i:EQUIPMENT,n:20,rarity:1},price:{i:DIAMOND,n:24}},{item:{i:EQUIPMENT,n:3,rarity:2},price:{i:DIAMOND,n:21}},{item:{i:EQUIPMENT,n:5,rarity:2},price:{i:DIAMOND,n:36}},{item:{i:EQUIPMENT,n:10,rarity:2},price:{i:DIAMOND,n:72}},{item:{i:EQUIPMENT,n:1,rarity:3},price:{i:DIAMOND,n:54}},{item:{i:EQUIPMENT,n:2,rarity:3},price:{i:DIAMOND,n:108}},{item:{i:EQUIPMENT,n:3,rarity:3},price:{i:DIAMOND,n:162}},{item:{i:SHARD,id:"v1",n:1},price:{i:DIAMOND,n:50}},{item:{i:SHARD,id:"v1",n:2},price:{i:DIAMOND,n:100}},{item:{i:SHARD,id:"v1",n:3},price:{i:DIAMOND,n:150}},{item:{i:SHARD,id:"v3",n:1},price:{i:DIAMOND,n:50}},{item:{i:SHARD,id:"v3",n:2},price:{i:DIAMOND,n:100}},{item:{i:SHARD,id:"v3",n:3},price:{i:DIAMOND,n:150}},{item:{i:RECRUIT_TICKET,n:1},price:{i:DIAMOND,n:1e3}},{item:{i:HERO_REFRESH_TICKET,n:1},price:{i:DIAMOND,n:100}}],window.SHOP_ITEM_LIST_MONEY=[{item:{i:EQUIPMENT,n:5,rarity:1},price:{i:GOLD,n:24}},{item:{i:EQUIPMENT,n:10,rarity:1},price:{i:GOLD,n:48}},{item:{i:EQUIPMENT,n:20,rarity:1},price:{i:GOLD,n:96}},{item:{i:EQUIPMENT,n:3,rarity:2},price:{i:GOLD,n:86}},{item:{i:EQUIPMENT,n:5,rarity:2},price:{i:GOLD,n:144}},{item:{i:EQUIPMENT,n:10,rarity:2},price:{i:GOLD,n:288}},{item:{i:SHARD,id:"v1",n:1},price:{i:GOLD,n:200}},{item:{i:SHARD,id:"v1",n:2},price:{i:GOLD,n:400}},{item:{i:SHARD,id:"v1",n:3},price:{i:GOLD,n:600}},{item:{i:SHARD,id:"v3",n:1},price:{i:GOLD,n:200}},{item:{i:SHARD,id:"v3",n:2},price:{i:GOLD,n:400}},{item:{i:SHARD,id:"v3",n:3},price:{i:GOLD,n:600}},{item:{i:HERO_REFRESH_TICKET,n:1},price:{i:GOLD,n:400}}],window.MID_BUYBOX_DROP_LIST={1:[{i:EQUIPMENT,rarity:3,n:5}],2:[{i:EQUIPMENT,rarity:3,n:50}]},window.MID_BOX_DROP_LIST={1:[{i:EQUIPMENT,rarity:1,n:12}],2:[{i:EQUIPMENT,rarity:1,n:14}],3:[{i:EQUIPMENT,rarity:1,n:16},{i:EQUIPMENT,rarity:2,n:1}],4:[{i:EQUIPMENT,rarity:1,n:18},{i:EQUIPMENT,rarity:2,n:2}],5:[{i:EQUIPMENT,rarity:1,n:20},{i:EQUIPMENT,rarity:2,n:3}],6:[{i:EQUIPMENT,rarity:1,n:22},{i:EQUIPMENT,rarity:2,n:4}],7:[{i:EQUIPMENT,rarity:1,n:24},{i:EQUIPMENT,rarity:2,n:5}],8:[{i:EQUIPMENT,rarity:1,n:26},{i:EQUIPMENT,rarity:2,n:6}],9:[{i:EQUIPMENT,rarity:1,n:28},{i:EQUIPMENT,rarity:2,n:7}],10:[{i:EQUIPMENT,rarity:1,n:30},{i:EQUIPMENT,rarity:2,n:8}],11:[{i:EQUIPMENT,rarity:1,n:32},{i:EQUIPMENT,rarity:2,n:9}]},window.BIG_BOX_DROP_LIST={1:[{i:EQUIPMENT,rarity:1,n:40},{i:EQUIPMENT,rarity:2,n:5}],2:[{i:EQUIPMENT,rarity:1,n:50},{i:EQUIPMENT,rarity:2,n:10}],3:[{i:EQUIPMENT,rarity:1,n:60},{i:EQUIPMENT,rarity:2,n:20},{i:EQUIPMENT,rarity:3,n:1}],4:[{i:EQUIPMENT,rarity:1,n:70},{i:EQUIPMENT,rarity:2,n:30},{i:EQUIPMENT,rarity:3,n:1}],5:[{i:EQUIPMENT,rarity:1,n:80},{i:EQUIPMENT,rarity:2,n:40},{i:EQUIPMENT,rarity:3,n:1}],6:[{i:EQUIPMENT,rarity:1,n:90},{i:EQUIPMENT,rarity:2,n:50},{i:EQUIPMENT,rarity:3,n:2}],7:[{i:EQUIPMENT,rarity:1,n:95},{i:EQUIPMENT,rarity:2,n:60},{i:EQUIPMENT,rarity:3,n:2}],8:[{i:EQUIPMENT,rarity:1,n:110},{i:EQUIPMENT,rarity:2,n:70},{i:EQUIPMENT,rarity:3,n:3}],9:[{i:EQUIPMENT,rarity:1,n:125},{i:EQUIPMENT,rarity:2,n:80},{i:EQUIPMENT,rarity:3,n:3}],10:[{i:EQUIPMENT,rarity:1,n:140},{i:EQUIPMENT,rarity:2,n:90},{i:EQUIPMENT,rarity:3,n:4}],11:[{i:EQUIPMENT,rarity:1,n:155},{i:EQUIPMENT,rarity:2,n:100},{i:EQUIPMENT,rarity:3,n:4}]},window.getRndItem=function(e,t){void 0===t&&(t=kit);var i={i:e.i,id:e.id,n:e.n};return Array.isArray(i.i)&&(i.i=t.rndOne(i.i)),Array.isArray(i.id)&&(i.id=t.rndOne(i.id)),Array.isArray(i.n)&&(i.n=t.rndOne(i.n).v),i},window.getRndItemFromBox=function(e){var t=kit.rndOneC(e);return t.rndList?getRndItemFromBox(t.rndList):getRndItem(t)},cc.Class({extends:e("../core/Menu"),properties:{smallBoxNode:cc.Node,smallBoxBtnNode:cc.Node,smallBoxCtLabel:cc.Label,smallBoxTimeLabel:cc.Label,midBoxNode:cc.Node,midBoxBtnNode:cc.Node,midBoxCtLabel:cc.Label,midBoxPriceA:cc.Node,midBoxPriceB:cc.Node,midBoxPriceC:cc.Node,midBoxTimeLabel:cc.Label,bigBoxNode:cc.Node,bigBoxBtnNode:cc.Node,bigBoxFreeBtnNode:cc.Node,bigBoxPriceA:cc.Node,bigBoxPriceB:cc.Node,bigBoxCtLabel:cc.Label,bigBoxTimeLabel:cc.Label,itemBoxNodes:[cc.Node],itemBoxTimeLabel:cc.Label,itemPrefab:cc.Prefab,boxLvlExpLabel:cc.Label,boxLvlExpProgress:cc.Node,boxLvlLabel:cc.Label,buyGoldNode1:cc.Node,buyGoldNode2:cc.Node,buyGoldNode3:cc.Node,buyGoldNode1PriceA:cc.Node,buyGoldNode1PriceB:cc.Node,buyDimondNode1:cc.Node,buyDimondNode2:cc.Node,buyDimondNode3:cc.Node,buyDimondNode4:cc.Node,buyDimondNode5:cc.Node,buyDimondNode6:cc.Node,buyDimondNode7:cc.Node,buyDimondNode8:cc.Node,buyDimondNode9:cc.Node,buyVIPCard:cc.Node,buyVIPCardFree:cc.Node,buyMonthCard:cc.Node,buyMonthCardFree:cc.Node,buyPriceLabel1:cc.Label,buyPriceLabel2:cc.Label,buyPriceLabel3:cc.Label,buyPriceLabel4:cc.Label,buyPriceLabel5:cc.Label,buyPriceLabel6:cc.Label,buyPriceLabel7:cc.Label,buyPriceLabel8:cc.Label,buyPriceLabel9:cc.Label,buyPriceLabel10:cc.Label,buyPriceLabel11:cc.Label,dailyTitleLabel:cc.Label,chestTitleLabel:cc.Label,libao1Itemlist:[cc.Node],libao2Itemlist:[cc.Node],libao3Itemlist:[cc.Node],VIPItemlist:[cc.Node],monthItemlist:[cc.Node],refreshCtLabel:cc.RichText},onLoad:function(){var e;this.topVisible=((e={})[DIAMOND]=!0,e[GOLD]=!0,e[SWEEP_TICKET]=!0,e[ENERGY]=!1,e[EXP]=!1,e),this.currentSuggestion=null,this.scheduleOnce(this.handleTaskNavigationSuggestion,.5)},handleTaskNavigationSuggestion:function(){if(window._taskNavShopType){var e=window._taskNavShopType,t=null;console.log("[ShopPage] Task navigation detected, type:",e),"daily"===e&&this.dailyTitleLabel?(t=this.dailyTitleLabel.node,console.log("[ShopPage] Targeting dailyTitleLabel for task_5/task_6")):"chest"===e&&this.chestTitleLabel&&(t=this.chestTitleLabel.node,console.log("[ShopPage] Targeting chestTitleLabel for task_7")),window._taskNavShopType=null,t&&(console.log("[ShopPage] Showing persistent suggestion on target node"),this.currentSuggestion=a.showHandSuggestion(t,t.parent,{offsetX:0,offsetY:0,duration:60,moveDistance:20,moveSpeed:.5,syncPosition:!0}))}},dismissSuggestion:function(){this.currentSuggestion&&(console.log("[ShopPage] Dismissing suggestion animation"),this.currentSuggestion.handNode&&cc.isValid(this.currentSuggestion.handNode)?(this.currentSuggestion.handNode.destroy(),console.log("[ShopPage] Hand node destroyed successfully")):console.log("[ShopPage] Hand node not yet loaded or already destroyed"),this.currentSuggestion=null)},updateRedPoint:function(){var e=0;cc.log("updateRedPoint");var t=11==shop.getSmallBoxCount()||sdk.now()>shop.smallBoxTime;return this.smallBoxBtnNode.getChildByName("rp").active=t,t&&e++,t=sdk.now()>shop.midBoxTime,this.midBoxPriceC.getChildByName("rp").active=t,t&&e++,t=1==shop.bigBoxCt||sdk.now()>shop.bigBoxTime,this.bigBoxBtnNode.getChildByName("rp").active=t,t&&e++,t=11==boxLvl.getFreeCt("small_gold"),this.buyGoldNode1.getChildByName("rp").active=t,t&&e++,e},initStatus:function(){this.dismissSuggestion(),this.initBox(),this.updatePriceLabel()},onPopBoxInfo:function(e,t){var i=t;menuManager.pop("item_info",{spriteFrame:e.target.getComponent(cc.Sprite).spriteFrame,name:LI(i),info:LI(i+"_info")})},initBox:function(){cc.log("initBox========================================"),this.initSmallBox(),this.initBigBox(),this.initMidBox(),this.initItemBoxes(),this.updateBoxLvlProgress(),this.initBuyGold(),this.initDimondGold(),this.updateRefreshCtLabel()},initItemBoxes:function(){var e=shop.refreshCt<20,t=shop.refreshCt<11;this.itemBoxTimeLabel.string=LI("shop_refresh_time",{n:kit.second2date(shop.getItemBoxRefreshTime()/1e3)});var i,a=shop.itemBoxSeed,n=[],o=[],r=equipment.get("items"),s={};for(var c in r)EquipmentDefine[c].rarity&&(s[EquipmentDefine[c].rarity]=!0);for(var l in SHOP_ITEM_LIST_DIAMOND)(h=SHOP_ITEM_LIST_DIAMOND[l].item).i==EQUIPMENT&&null!=h.rarity&&!s[h.rarity]||!(h.i!=RECRUIT_TICKET&&h.i!=HERO_REFRESH_TICKET||pc.isChapterDone(6))||h.i==SHARD&&!pc.isChapterDone(3)||n.push(SHOP_ITEM_LIST_DIAMOND[l]);for(var d in SHOP_ITEM_LIST_MONEY){var h;(h=SHOP_ITEM_LIST_MONEY[d].item).i==EQUIPMENT&&null!=h.rarity&&!s[h.rarity]||!(h.i!=RECRUIT_TICKET&&h.i!=HERO_REFRESH_TICKET||pc.isChapterDone(6))||h.i==SHARD&&!pc.isChapterDone(3)||o.push(SHOP_ITEM_LIST_MONEY[d])}var u=kit.core(a);if(e||!pc.isChapterDone(3)){var p=o[i=u.rndInt(0,o.length-1)];o.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(1,getRndItem(p.item),p.price)}else this.initItemBox(1,{i:SHARD,id:u.rndOne(["v3"]),n:u.rndOne([2])});t?(p=n[i=u.rndInt(0,n.length-1)],n.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(0,getRndItem(p.item),p.price)):this.initItemBox(0,{i:"sweepTicketBox",n:1}),p=o[i=u.rndInt(0,o.length-1)],o.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(2,getRndItem(p.item),p.price),p=o[i=u.rndInt(0,o.length-1)],o.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(3,getRndItem(p.item),p.price),p=n[i=u.rndInt(0,n.length-1)],n.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(4,getRndItem(p.item),p.price),p=n[i=u.rndInt(0,n.length-1)],n.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(5,getRndItem(p.item),p.price),p=n[i=u.rndInt(0,n.length-1)],n.splice(i,1),p=equipment.checkRandItem(p,!0,a),this.initItemBox(6,getRndItem(p.item),p.price),this.updatePriceLabel(),this.itemBoxNodes[0].stopAllActions(),this.itemBoxNodes[0].runAction(cc.sequence(cc.delayTime(shop.getItemBoxRefreshTime()/1e3),cc.callFunc(function(){var e,t=this;net.updateData({set:(e={itemBoxTime:kit.getNextDate(sdk.now()).getTime(),shopRefreshCt:20,itemBoxSeed:kit.rndInt(1,2e3)},e["itemBoxStatus.0"]=0,e["itemBoxStatus.1"]=0,e["itemBoxStatus.2"]=0,e["itemBoxStatus.3"]=0,e["itemBoxStatus.4"]=0,e["itemBoxStatus.5"]=0,e["itemBoxStatus.6"]=0,e["itemBoxStatus.7"]=0,e)},function(e,i){i=i.doc,shop.refreshCt=i.shopRefreshCt||0,t.updateRefreshCtLabel(),cc.log("updateItemBox",e,i),shop.itemBoxSeed=i.itemBoxSeed||0,shop.itemBoxTime=i.itemBoxTime||0,shop.itemBoxStatus=i.itemBoxStatus,t.initItemBoxes()})},this)))},updatePriceLabel:function(){for(var e in this.itemBoxNodes){var t=this.itemBoxNodes[e].getChildByName("btn_price");t&&t.price&&(t.getChildByName("priceLabel").color=money.had(t.price.i,t.price.n)&&cc.color(255,255,255)||cc.color(255,0,0))}this.bigBoxPriceB.getChildByName("price").color=money.had(DIAMOND,200)&&cc.color(255,255,255)||cc.color(255,0,0),this.midBoxPriceB.getChildByName("price").color=money.had(DIAMOND,30)&&cc.color(255,255,255)||cc.color(255,0,0),this.buyGoldNode2.getChildByName("priceLabel").color=money.had(DIAMOND,500)&&cc.color(255,255,255)||cc.color(255,0,0),this.buyGoldNode3.getChildByName("priceLabel").color=money.had(DIAMOND,1500)&&cc.color(255,255,255)||cc.color(255,0,0)},initItemBox:function(e,t,a){var n=this;cc.log("initItemBox",e,t,a);var o=this.itemBoxNodes[e],r=shop.getItemBoxStatus(e),s=o.itemNode;s||(s=cc.instantiate(this.itemPrefab),o.getChildByName("item").addChild(s,-1),o.itemNode=s);var c=o.getChildByName("btn_ad");c&&(c.active=!r&&!a),o.getChildByName("btn_price").active=!r&&!!a;var l=o.getChildByName(c&&!a?"btn_ad":"btn_price"),d=o.getChildByName("name").getComponent(cc.Label);s.getComponent("Item").init(t,d),this.setGray(o.getChildByName("bg"),r),s.getComponent("Item").setGray(r),o.getChildByName("done").active=r,l.price=a,a&&(l.getChildByName("diamond").active=a.i==DIAMOND,l.getChildByName("gold").active=a.i==GOLD,l.getChildByName("priceLabel").getComponent(cc.Label).string=a.n),l.onTouch=function(){if(r)kit.info("Bought it, please wait for the refresh");else{var o=[],s=[t],c=function(){var r;if(cc.log("initItemBox onTouch item",t),"sweepTicketBox"==t.i){t.i=SWEEP_TICKET;var c=kit.rndInt(1,100),d=[0,0,30,50,75,90,94,98,99,100],h=1;for(var u in d){if(!(c>=d[u]))break;h=+u+1}t.n=h}equipment.getItemFromReward(o,s),net.updateData({items:o,set:(r={},r["itemBoxStatus."+e]=1,r),price:a},function(r,s){r?kit.info("Purchase failed"):(a?window.TaskManager&&(n.dismissSuggestion(),window.TaskManager.completeTask("task_5")):window.TaskManager&&(n.dismissSuggestion(),window.TaskManager.completeTask("task_6")),cc.log("itemBoxes onTouch Cb data",s),i.FirebaseTracking.setDataBiRes("Shop_ItemBox1"),money.update(s),n.updatePriceLabel(),a&&cc.game.emit("use_money",{price:a,noFly:1,tid:"item_box",pos:l.convertToWorldSpaceAR(cc.v2(0,0))}),shop.setItemBoxStatus(e,1),n.initItemBox(e,t),menuManager.pop("show",{items:o,tid:"item_box",checkCb:function(){}}))})};if(a){if(money.check(a.i,a.n,function(){var e=boxLvl.getFreeCt("small_gold");if(e){var t=[{i:GOLD,n:500}];menuManager.pop("video",{title:LI("free_gold"),items:t,count:11!=e&&LI("free_btn",{n:boxLvl.getFreeCt("small_gold")})||"",type:11==e&&"free",checkCb:function(a){a&&sdk.useFree("s_free_gold",function(a){a||(11!=e&&YMTJ("video","shop_coins"),net.updateData({price:{i:"boxLvl_smallGoldFreeCt",n:1},items:t},function(e,a){cc.log(e,a),e||(cc.log("goldBox",t,a),boxLvl.reduceFreeCt("small_gold"),i.FirebaseTracking.setDataBiRes("Shop_Ads_SmallGold"),money.update(a),n.updatePriceLabel(),n.initBuyGold(),menuManager.pop("show",{items:t,tid:"small_box",checkCb:function(){}}))}))},11==e)}})}}))return;c()}else t.i,sdk.useFree("s_free_videoticket",function(e){e||("sweepTicketBox"==t.i?YMTJ("video","shop_Coupons"):YMTJ("video","shop_fragment"),c())})}}},initMidBox:function(){var e=this,t=sdk.now()>shop.midBoxTime;this.midBoxCtLabel.string=shop.midBoxKey+" / 1",this.midBoxTimeLabel.node.active=!t,this.midBoxTimeLabel.string="\u514d\u8d39\u5012\u8ba1\u65f6:"+kit.second2date(shop.getMidBoxRefreshTime()/1e3),this.midBoxPriceA.active=!1,this.midBoxPriceB.active=!0,this.midBoxPriceC.active=!1,t&&(this.midBoxPriceA.active=!1,this.midBoxPriceB.active=!1,this.midBoxPriceC.active=!0),shop.midBoxKey;var a={i:DIAMOND,n:30},n=[];t&&(a={i:DIAMOND,n:0});var o=!1;this.midBoxBtnNode.onTouch=function(){if(o)cc.log("Opening box... Please wait.");else if(o=!0,t||money.had(DIAMOND,30)){cc.log("items",n),equipment.getItemFromReward(n,MID_BOX_DROP_LIST[boxLvl.getLvl()]),boxLvl.addExp(30),e.updateBoxLvlProgress();var r={items:n,set:{boxLvl_lvl:boxLvl.getLvl(),boxLvl_exp:boxLvl.getExp(),midBoxTime:t&&36e5+sdk.now()}};if(shop.midBoxKey>0);else if(!t){if(money.check(a.i,a.n))return;r.price=a}cc.log("midBoxTime updateData",r),net.updateData(r,function(s,c){t&&(shop.midBoxTime=c.doc.midBoxTime||0),cc.log("shop.midBoxTime",c,shop.midBoxTime),o=!1,window.TaskManager&&(e.dismissSuggestion(),window.TaskManager.completeTask("task_7")),i.FirebaseTracking.setDataBiRes("Shop_MidBox"),money.update(c),r.price&&cc.game.emit("use_money",{price:a,noFly:1,tid:"mid_box",pos:e.midBoxBtnNode.convertToWorldSpaceAR(cc.v2(0,0))}),e.initMidBox(),e.updateRedPoint(),e.updatePriceLabel(),menuManager.pop("box",{items:n,guide:0,videoStr:"\u989d\u5916\u83b7\u5f97\n2 \u4e2a\u5956\u52b1",tid:"mid_box",tname:"\u5927\u5b9d\u7bb1",lootCb:function(){}})})}else kit.info(LI("tip_diamond_lack"))},t||(this.midBoxNode.stopAllActions(),this.midBoxNode.runAction(cc.sequence(cc.delayTime(shop.getMidBoxRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.updateData({set:{midBoxTime:sdk.now()}},function(t,i){shop.midBoxTime=i.doc.midBoxTime||0,e.initMidBox()})},this))))},updateBoxLvlProgress:function(){var e=BoxLvlExoDefine[boxLvl.getLvl()-1];cc.log("updateBoxLvlProgress",e,boxLvl.getLvl());var t=0;e&&(t=boxLvl.getExp()/BoxLvlExoDefine[boxLvl.getLvl()-1])>1&&(t=1),this.boxLvlExpLabel.string=e&&boxLvl.getExp()+"/"+BoxLvlExoDefine[boxLvl.getLvl()-1]||LI("level_max"),this.boxLvlExpProgress.oWidth=this.boxLvlExpProgress.oWidth||this.boxLvlExpProgress.width,this.boxLvlExpProgress.width=this.boxLvlExpProgress.oWidth*t,this.boxLvlLabel.string="LV."+boxLvl.getLvl()},initBigBox:function(){var e=this,t=1==shop.bigBoxCt;this.bigBoxFreeBtnNode.active=t,this.bigBoxTimeLabel.node.active=!t,this.bigBoxTimeLabel.string="Free Timer:"+kit.second2date(shop.getBigBoxRefreshTime()/1e3),this.bigBoxCtLabel.string=shop.bigBoxKey+" / 1",this.bigBoxPriceA.active=!1,this.bigBoxPriceB.active=!0,shop.midBoxKey;var a={i:DIAMOND,n:200},n=!1;this.bigBoxBtnNode.onTouch=function(t,o){if(n)cc.log("Waiting for loot box result. Please wait...");else if(o||money.had(DIAMOND,200)){n=!0;var r=[];r.push({i:GOLD,n:500}),equipment.getItemFromReward(r,BIG_BOX_DROP_LIST[boxLvl.getLvl()]),boxLvl.addExp(200),e.updateBoxLvlProgress(),cc.log("items",r);var s={set:{boxLvl_lvl:boxLvl.getLvl(),boxLvl_exp:boxLvl.getExp()},items:r};o&&(a={i:"bigBoxCt",n:1}),s.price=a,net.updateData(s,function(t,c){n=!1,null!=c.doc.bigBoxCt&&(shop.bigBoxCt=c.doc.bigBoxCt),cc.log("initBigBox onTouch updateData",c,shop.bigBoxCt),window.TaskManager&&(e.dismissSuggestion(),window.TaskManager.completeTask("task_7")),i.FirebaseTracking.setDataBiRes("Shop_BigBox"),money.update(c),e.updatePriceLabel(),s.price&&cc.game.emit("use_money",{price:a,noFly:1,tid:"big_box",pos:e.bigBoxBtnNode.convertToWorldSpaceAR(cc.v2(0,0))}),e.initBigBox(),e.updateRedPoint();for(var l=[],d=0;d<2;d++)l.push(getRndItemFromBox(bigBoxRndList));menuManager.pop("box",{items:r,videoStr:"\u989d\u5916\u83b7\u5f97\n2 \u4e2a\u5956\u52b1",tid:"big_box",tname:"\u8d85\u5927\u5b9d\u7bb1",lootCb:function(){o&&YMTJ("video","freeBigBox")}})})}else kit.info(LI("tip_diamond_lack"))},this.bigBoxFreeBtnNode.onTouch=function(t){sdk.useFree("s_free_megachest",function(i){i||e.bigBoxBtnNode.onTouch(t,!0)})},this.bigBoxNode.stopAllActions(),cc.log("test date value",shop.bigBoxTime,sdk.now(),Date.now(),shop.getBigBoxRefreshTime()/1e3),this.bigBoxNode.runAction(cc.sequence(cc.delayTime(shop.getBigBoxRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.updateData({set:{bigBoxTime:kit.getNextDate(sdk.now()).getTime(),bigBoxCt:1}},function(t,i){i=i.doc,shop.bigBoxCt=i.bigBoxCt||0,shop.bigBoxKey=i.bigBoxKey||0,shop.bigBoxTime=i.bigBoxTime||0,cc.log("updateBigBox",i,i.bigBoxTime,shop.bigBoxTime,shop.bigBoxTime-sdk.now()),e.initBigBox()})},this)))},initSmallBox:function(){var e=this;cc.log("initSmallBox"),this.smallBoxCtLabel.string=LI("shop_times_available",{n:shop.getSmallBoxCount()});var t=DIAMOND,a=11==shop.getSmallBoxCount();a?(this.smallBoxBtnNode.getChildByName("icon").active=!1,this.smallBoxBtnNode.getChildByName("label").x=0,this.smallBoxCtLabel.node.active=!1):(this.smallBoxBtnNode.getChildByName("icon").active=!0,this.smallBoxBtnNode.getChildByName("label").x=18,this.smallBoxCtLabel.node.active=!0),this.setGray(this.smallBoxBtnNode.getChildByName("btn"),shop.getSmallBoxCount()<=0),this.smallBoxBtnNode.onTouch=function(){if(shop.getSmallBoxCount()<=0)kit.info(LI("tip_timesout"));else{var n=[{i:t,n:100}];sdk.useFree("s_free_100diamond",function(t){t||(a||YMTJ("video","shop_Diamonds"),net.updateData({add:{smallBoxCt:-1},min:{smallBoxCt:1},items:n},function(t,a){window.TaskManager&&(e.dismissSuggestion(),window.TaskManager.completeTask("task_6")),i.FirebaseTracking.setDataBiRes("Shop_Ads_SmallBox"),money.update(a),e.updatePriceLabel(),a=a.doc,shop.smallBoxCt=a.smallBoxCt||0,e.initSmallBox(),menuManager.pop("show",{items:n,tid:"small_box",checkCb:function(){}})}))},a)}},this.smallBoxNode.stopAllActions(),cc.log("shop.getSmallBoxRefreshTime()",shop.getSmallBoxRefreshTime()),this.smallBoxNode.runAction(cc.sequence(cc.delayTime(shop.getSmallBoxRefreshTime()/1e3),cc.callFunc(function(){var e=this;net.updateData({set:{smallBoxTime:kit.getNextDate(sdk.now()).getTime(),smallBoxCt:11}},function(t,i){i=i.doc,cc.log("updateSmallBox",i),shop.smallBoxCt=i.smallBoxCt||0,shop.smallBoxTime=i.smallBoxTime||0,e.initSmallBox()})},this)))},update:function(){this.bigBoxTimeLabel.string=LI("shop_refresh_time",{n:kit.second2date(shop.getBigBoxRefreshTime()/1e3)}),this.midBoxTimeLabel.string=LI("shop_refresh_time",{n:kit.second2date(shop.getMidBoxRefreshTime()/1e3)}),this.itemBoxTimeLabel.string=LI("shop_refresh_time",{n:kit.second2date(shop.getItemBoxRefreshTime()/1e3)})},initDimondGold:function(){this.GetPayInfoMess("backpackmaster.diamond100",this.buyPriceLabel1),this.buyDimondNode1.onTouch=function(){cc.log("buyDimondNode1"+sdk.now()),sdk.buyDiamond("backpackmaster.diamond100",function(){var e=[{i:DIAMOND,n:100}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox100"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.diamond500",this.buyPriceLabel2),this.buyDimondNode2.onTouch=function(){cc.log("backpackmaster.diamond500"),sdk.buyDiamond("backpackmaster.diamond500",function(){var e=[{i:DIAMOND,n:560}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox500"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.diamond1000",this.buyPriceLabel3),this.buyDimondNode3.onTouch=function(){cc.log("buyDimondNode3"),sdk.buyDiamond("backpackmaster.diamond1000",function(){var e=[{i:DIAMOND,n:1160}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+9.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox1000"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.diamond2000",this.buyPriceLabel4),this.buyDimondNode4.onTouch=function(){cc.log("buyDimondNode4"),sdk.buyDiamond("backpackmaster.diamond2000",function(){var e=[{i:DIAMOND,n:2600}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+19.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox1000"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.diamond5000",this.buyPriceLabel5),this.buyDimondNode5.onTouch=function(){cc.log("buyDimondNode5"),sdk.buyDiamond("backpackmaster.diamond5000",function(){var e=[{i:DIAMOND,n:7600}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+49.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox5000"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.diamond10000",this.buyPriceLabel6),this.buyDimondNode6.onTouch=function(){cc.log("buyDimondNode6"),sdk.buyDiamond("backpackmaster.diamond10000",function(){var e=[{i:DIAMOND,n:18e3}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+99.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_SmallBox10000"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("show",{items:e,tid:"small_box",checkCb:function(){}}))})})},this.GetPayInfoMess("backpackmaster.bundle1",this.buyPriceLabel7);var e=[{i:SHARD,id:"v3",n:5},{i:DIAMOND,n:200},{i:GOLD,n:500}];for(var t in e)this.libao1Itemlist[t].getComponent("Item").init(e[t],"");this.buyDimondNode7.onTouch=function(){console.log("buyDimondNode7"),sdk.buyDiamond("backpackmaster.bundle1",function(){var e=[{i:SHARD,id:"v3",n:5},{i:DIAMOND,n:200},{i:GOLD,n:500}];console.log("buyDimondNode7==="),net.updateData({set:{buyCost:boxLvl.getBuyCost()+.99},items:e},function(t,a){console.log(t,a),t||(console.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_NewbiePack"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})};var a=[{i:RECRUIT_TICKET,n:10},{i:HERO_REFRESH_TICKET,n:10},{i:DIAMOND,n:500},{i:GOLD,n:1e3}];for(var t in a)this.libao2Itemlist[t].getComponent("Item").init(a[t],"");this.GetPayInfoMess("backpackmaster.bundle2",this.buyPriceLabel8),this.buyDimondNode8.onTouch=function(){cc.log("buyDimondNode8"),sdk.buyDiamond("backpackmaster.bundle2",function(){var e=[{i:RECRUIT_TICKET,n:10},{i:HERO_REFRESH_TICKET,n:10},{i:DIAMOND,n:500},{i:GOLD,n:1e3}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+9.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_CrewPack"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})};var n=[{i:EXP,n:5e3},{i:SHARD,id:"v3",n:50},{i:DIAMOND,n:1e3},{i:GOLD,n:5e3}];for(var t in n)this.libao3Itemlist[t].getComponent("Item").init(n[t],"");this.GetPayInfoMess("backpackmaster.bundle3",this.buyPriceLabel9),this.buyDimondNode9.onTouch=function(){cc.log("buyDimondNode9"),sdk.buyDiamond("backpackmaster.bundle3",function(){var e=[{i:EXP,n:5e3},{i:SHARD,id:"v3",n:50},{i:DIAMOND,n:1e3},{i:GOLD,n:5e3}];net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_IAP_TankPack"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})},this.updateCardState();var o=this;this.GetPayInfoMess("backpackmaster.lifetimecard",this.buyPriceLabel10);var r=[{i:DIAMOND,n:1e3},{i:ENERGY,n:10}];for(var t in r)this.VIPItemlist[t].getComponent("Item").init(r[t],"");this.buyVIPCard.onTouch=function(){cc.log("buyVIPCard"+sdk.now()),sdk.buyDiamond("backpackmaster.lifetimecard",function(){var e=[];e.push({i:DIAMOND,n:3e3}),net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99,buyVIPState:1},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),user.buyVIPState=1,i.FirebaseTracking.setDataBiRes("Shop_IAP_LifetimeCard"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),o.updateCardState(),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})},this.buyVIPCardFree.onTouch=function(){if(cc.log("buyVIPCardFree"+sdk.now()),o.isClaimGold()){var e=[];e.push({i:DIAMOND,n:200}),e.push({i:ENERGY,n:10}),net.updateData({set:{claimVIPTime:sdk.now()},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_VipCardFree"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),user.claimVIPTime=a.doc.claimVIPTime,o.updateCardState(),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})}else kit.info(LI("tip_timesout"))};var s=[{i:DIAMOND,n:100},{i:SWEEP_TICKET,n:20},{i:HERO_REFRESH_TICKET,n:3}];for(var t in s)this.monthItemlist[t].getComponent("Item").init(s[t],"");this.GetPayInfoMess("backpackmaster.monthlycard",this.buyPriceLabel11),this.buyMonthCard.onTouch=function(){cc.log("buyMonthCard"+sdk.now()),sdk.buyDiamond("backpackmaster.monthlycard",function(){var e=[];e.push({i:DIAMOND,n:100}),e.push({i:SWEEP_TICKET,n:20}),net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99,buyMonthTime:sdk.now()+2592e6},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),user.buyMonthTime=a.doc.buyMonthTime,i.FirebaseTracking.setDataBiRes("Shop_IAP_MonthlyCard"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),o.updateCardState(),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})},this.buyMonthCardFree.onTouch=function(){if(cc.log("buyMonthCardFree"+sdk.now()),o.isClaimMonthGold()){var e=[];e.push({i:DIAMOND,n:100}),e.push({i:SWEEP_TICKET,n:20}),e.push({i:HERO_REFRESH_TICKET,n:3}),net.updateData({set:{claimMonthTime:sdk.now()},items:e},function(t,a){cc.log(t,a),t||(cc.log("BuyDimond",e,a),i.FirebaseTracking.setDataBiRes("Shop_MonthCardFree"),money.update(a),boxLvl.setBuyCost(a.doc.buyCost),user.claimMonthTime=a.doc.claimMonthTime,o.updateCardState(),menuManager.pop("box",{items:e,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})}else kit.info(LI("tip_timesout"))}},updateCardState:function(){this.buyVIPCard.active=0==user.buyVIPState,this.buyVIPCardFree.active=1==user.buyVIPState,1==user.buyVIPState&&(this.buyVIPCardFree.getChildByName("rp").active=this.isClaimGold(),this.setGray(this.buyVIPCardFree.getChildByName("btn"),!this.isClaimGold())),sdk.now()<user.buyMonthTime?(this.buyMonthCard.active=!1,this.buyMonthCardFree.active=!0,this.buyMonthCardFree.getChildByName("rp").active=this.isClaimMonthGold(),this.setGray(this.buyMonthCardFree.getChildByName("btn"),!this.isClaimMonthGold())):(this.buyMonthCard.active=!0,this.buyMonthCardFree.active=!1)},isClaimGold:function(){return 0==user.claimVIPTime||new Date(sdk.now()).toLocaleDateString()!=new Date(user.claimVIPTime).toLocaleDateString()},isClaimMonthGold:function(){return sdk.now()<user.buyMonthTime&&new Date(sdk.now()).toLocaleDateString()!=new Date(user.claimMonthTime).toLocaleDateString()},GetPayInfoMess:function(e,t){if(null!=MAX.instance._productIdInfo){var i=MAX.instance._productIdInfo.split("*");for(var a in i){var n=i[a].split("&");n[0]==e&&(t.string=n[1]+n[2])}}},initBuyGold:function(){var e=this,t=boxLvl.getFreeCt("small_gold"),a=11==t;cc.log("initBuyGold freeCt",t),this.buyGoldNode1PriceA.active=a,this.buyGoldNode1PriceB.active=!a,this.buyGoldNode1.getChildByName("bg"),this.setGray(this.buyGoldNode1.getChildByName("btn"),0==t),this.buyGoldNode1PriceB.getChildByName("cost").getComponent(cc.Label).string=0==t&&LI("ad_done")||LI("free_n",{n:t}),this.buyGoldNode1.onTouch=function(){if(t<=0)kit.info(LI("tip_timesout"));else{var n=[{i:GOLD,n:500}];sdk.useFree("shop_coins",function(t){t||(a||YMTJ("video","shop_coins"),net.updateData({price:{i:"boxLvl_smallGoldFreeCt",n:1},items:n},function(t,a){t||(cc.log("goldBox",n,a),boxLvl.reduceFreeCt("small_gold"),i.FirebaseTracking.setDataBiRes("Shop_Ads_SmallBox"),money.update(a),e.updatePriceLabel(),e.initBuyGold(),menuManager.pop("show",{items:n,tid:"small_box",checkCb:function(){}}))}))},a)}};var n={i:DIAMOND,n:500};this.buyGoldNode2.onTouch=function(){if(money.getNum(DIAMOND)<=500)kit.info(LI("tip_diamond_lack"));else{var t=[{i:GOLD,n:2500}];net.updateData({price:n,items:t},function(a,n){a||(i.FirebaseTracking.setDataBiRes("Shop_Gold2500"),money.update(n),e.updatePriceLabel(),shop.smallBoxCt=n.smallBoxCt||0,e.initBuyGold(),menuManager.pop("show",{items:t,tid:"small_box",checkCb:function(){}}))})}};var o={i:DIAMOND,n:1500};this.buyGoldNode3.onTouch=function(){if(money.getNum(DIAMOND)<=1500)kit.info(LI("tip_diamond_lack"));else{var t=[{i:GOLD,n:1e4}];net.updateData({price:o,items:t},function(a,n){i.FirebaseTracking.setDataBiRes("Shop_Gold1500"),money.update(n),e.updatePriceLabel(),e.initBuyGold(),menuManager.pop("show",{items:t,tid:"small_box",checkCb:function(){}})})}}},refreshItems:function(){var e=this;sdk.useFree("s_free_refresh",function(t){var i;t||(shop.refreshCt<=0?kit.info(LI("tip_timesout")):(YMTJ("video","shop_Refresh"),net.updateData({price:{i:"shopRefreshCt",n:1},set:(i={},i["itemBoxStatus.0"]=0,i["itemBoxStatus.1"]=0,i["itemBoxStatus.2"]=0,i["itemBoxStatus.3"]=0,i["itemBoxStatus.4"]=0,i["itemBoxStatus.5"]=0,i["itemBoxStatus.6"]=0,i["itemBoxStatus.7"]=0,i.itemBoxSeed=kit.rndInt(1,2e3),i)},function(t,i){i=i.doc,shop.itemBoxSeed=i.itemBoxSeed||0,shop.refreshCt=i.shopRefreshCt||0,e.updateRefreshCtLabel(),cc.log("refreshItems refreshCt",shop.refreshCt,i),shop.itemBoxStatus=i.itemBoxStatus,e.initItemBoxes()})))})},updateRefreshCtLabel:function(){this.refreshCtLabel.string=LI("shop_times_available",{n:shop.refreshCt})},popBoxInfo:function(){menuManager.pop("box_info",{})}}),window.BoxLvlExoDefine=[400,1300,2200,3100,4e3,4900,5800,6700,7600,8500];var n={version:2,exp:0,lvl:1,smallGoldFreeCt:11};window.boxLvl={init:function(){boxLvl.load(),boxLvl.data||(boxLvl.data=JSON.parse(JSON.stringify(n)))},setOnlineData:function(e){var t=e.boxLvl_smallGoldFreeCt||0,i=e.boxLvl_exp||0,a=e.boxLvl_lvl||1;boxLvl.data={smallGoldFreeCt:t,exp:i,lvl:a},cc.log("boxLvl setOnlineData",e),boxLvl.smallGoldRefreshTime=e.boxLvl_smallGold_refreshTime||0,this.checkRefresh(),this.setBuyCost(e.buyCost||0)},checkRefresh:function(){sdk.now()<boxLvl.smallGoldRefreshTime||net.postSilent("updateData",{set:{boxLvl_smallGoldFreeCt:11,boxLvl_smallGold_refreshTime:kit.getNextDate(sdk.now()).getTime()}},function(e,t){e||(cc.log("boxLvl checkRefresh cb",t),boxLvl.data.smallGoldFreeCt=t.doc.boxLvl_smallGoldFreeCt,boxLvl.smallGoldRefreshTime=t.doc.boxLvl_smallGold_refreshTime)})},load:function(){boxLvl.data=this.loadSaveData("boxlvl_data"),cc.log("boxlvl_data load",boxLvl.data)},getFreeCt:function(){return boxLvl.data.smallGoldFreeCt},reduceFreeCt:function(){return boxLvl.data.smallGoldFreeCt--,this.save(),boxLvl.data.smallGoldFreeCt},loadSaveData:function(e){var t=privacy.decodeToJson(e);if(t&&2===t.version)return t},remove:function(){equipment.data=null,privacy.remove("boxlvl_data")},save:function(){},addExp:function(e){this.data.exp+=e,this.data.exp>=BoxLvlExoDefine[this.data.lvl-1]&&(this.data.exp-=BoxLvlExoDefine[this.data.lvl-1],this.data.lvl++),boxLvl.save()},getLvl:function(){return this.data.lvl},getExp:function(){return this.data.exp},setBuyCost:function(e){boxLvl.buyCost=e},getBuyCost:function(){return boxLvl.buyCost}},cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../utils/AnimUtils":"AnimUtils","../core/Menu":"Menu"}],ShotSeqBuff:[function(e,t){"use strict";cc._RF.push(t,"8ceb2EWCGlAnKtFs0WQtl7j","ShotSeqBuff");var i=e("../../../entities/projectiles/Bullet");e("../../../entities/projectiles/BallBulletSprite"),e("../../../entities/projectiles/Bomb"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){this.obj,this.blt=this.define.blt,this.dx=this.define.dx||0,this.dx0=this.define.dx0||0,this.attackSequence=[],this.waveN=this.define.waveN||0,this.waveDT=this.define.waveDT||0,this.n=this.define.n||16;for(var e=1;e<=this.n;e++){var t=this.waveN&&e%this.waveN==0,i=this.dx*((e-1)%this.waveN+1)+this.dx0,a={t:(this.define.dt||.5)+(t&&this.waveDT||0),deg:this.define.deg||-30,blt:1,dx:i,sound:"sound/cannon_fire"};this.attackSequence.push(a)}cc.log("bombItem",this.attackSequence),this.attackIndex=0,this.attackTimer=0,this.x=this.obj.x,this.y=this.obj.y,this.dmg=this.define.dmg,this.config&&this.config.atkScale&&(this.dmg*=this.config.atkScale)},end:function(){},update:function(e){this.attackTimer-=e;var t=this.attackSequence[this.attackIndex];this.attackTimer<=0&&t&&(t.blt&&this.shot(t),this.attackTimer=t.t,this.attackIndex++)},getPosition:function(){return cc.v2(this.x,this.y)},getPositionX:function(){return this.x},getPositionY:function(){return this.y},shot:function(e){var t=this.blt[e.blt-1],a=e.x||0,n=e.y||0,o=this.obj.x+(!this.define.noRnd&&this.game.c_rnd(-600,0)||0),r=this.obj.y+1500,s=0;e.deg&&(s+=e.deg);var c=c_degree2cos(s),l=c_degree2sin(s),d=+l*a+c*n,h=-c*a+l*n;cc.log("x",o+d+(e.dx||0)),(t.shot||i.shot)(this.game,t,{obj:this.obj,x:o+d+(e.dx||0),y:r+h+(e.dy||0),team:this.obj.team,dmg:this.dmg,deg:s}),e.effect&&this.game.callEffect(e.effect,this,d,h,s),e.sound&&this.game.playEffect(e.sound)}}),cc._RF.pop()},{"../../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../../entities/projectiles/Bomb":"Bomb","../../../entities/projectiles/Bullet":"Bullet","./Buff":"Buff"}],ShowMenu:[function(e,t){"use strict";cc._RF.push(t,"46d02wBWG9D1rHWMjQV8pqO","ShowMenu"),cc.Class({extends:e("./ItemMenu"),properties:{openAudio:{type:cc.AudioClip,default:null},coverNode:cc.Node,lightNode:cc.Node},onLoad:function(){},initStatus:function(){this.itemLayoutNode.active=!1,this.lightNode.opacity=0,this.coverNode.opacity=0,this.initItems(),this.onShow()},onShow:function(){menuManager.playEffect(this.openAudio),this.speed=2,this.lightNode.runAction(cc.spawn(cc.fadeIn(.1),cc.scaleBy(.2,7),cc.tintTo(.1,255,255,255)).easing(cc.easeIn(1))),this.coverNode.runAction(cc.sequence(cc.fadeIn(.2).easing(cc.easeIn(1)),cc.delayTime(.05),cc.callFunc(function(){for(var e in this.itemLayoutNode.active=!0,this.itemList)this.itemList[e].x=720*((+e+.5)/this.itemList.length-.5);this.node.runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(this.onCheck,this))),this.lightNode.runAction(cc.scaleTo(.1,0))},this),cc.fadeOut(.75)))},start:function(){},onCheck:function(e,t){var i=this.args,a=this.got();this.node.runAction(cc.sequence(cc.delayTime(a/this.speed),cc.callFunc(function(){var e=i.checkCb;e&&e(t)||this.close(t)},this)))}}),cc._RF.pop()},{"./ItemMenu":"ItemMenu"}],ShowNewEquipment:[function(e,t){"use strict";cc._RF.push(t,"4bfb9gbpjlDO4VzNzBnfVC3","ShowNewEquipment"),cc.Class({extends:e("./ItemMenu"),properties:{openAudio:{type:cc.AudioClip,default:null},listSpfEquipment:[cc.SpriteFrame],itemESpr:cc.Node,iconBox:cc.Node,layoutEffect:cc.Node},onLoad:function(){},start:function(){},initStatus:function(){this.onShow()},onShow:function(){var e=this;menuManager.playEffect(this.openAudio),this.speed=2,console.log("_______"),console.log(this.args),this.itemESpr.getComponent(cc.Sprite).spriteFrame=this.listSpfEquipment[this.args.items.id],this.itemESpr.active=!1,this.itemESpr.opacity=0,this.layoutEffect.active=!1,this.playBoxOpenAnim(),cc.tween(this.node).delay(1.5).call(function(){return e.onCheck()}).start()},playBoxOpenAnim:function(){var e=this;if(this.iconBox){this.iconBox.scale=0;var t=cc.instantiate(this.shinePrefab);this.layoutEffect.addChild(t),cc.tween(this.iconBox).to(.2,{scale:1.2},{easing:"backOut"}).call(function(){e.itemESpr.active=!0,e.layoutEffect.active=!0,cc.tween(e.itemESpr).to(.1,{opacity:255},{easing:"sineOut"}).start()}).to(.05,{scale:1}).start()}},onCheck:function(e,t){var i=this.args,a=this.got();this.node.runAction(cc.sequence(cc.delayTime(a/this.speed),cc.callFunc(function(){var e=i.checkCb;e&&e(t)},this)))},onCloseClick:function(){this.onClose(),console.log(11111,user.getGuide("progressionTrack")),3==user.getGuide("progressionTrack")&&cc.game.emit("claimNewEquipment")}}),cc._RF.pop()},{"./ItemMenu":"ItemMenu"}],SignItem:[function(e,t){"use strict";cc._RF.push(t,"6f645vQTeRJFa+ksAS8qmCb","SignItem");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:cc.Component,properties:{indexDay:cc.Label,selectNode:cc.Node,watchVideoNode:cc.Node,normalRewardRoot:cc.Node,enhancedRewardRoot:cc.Node,itemRewardPrefab:cc.Prefab,spRankItem:cc.Sprite,spfRankItem:[cc.SpriteFrame],spLockRewardNormal:cc.Node,spLockRewardEnhanced:cc.Node,btnGetRewardNormal:cc.Button,btnGetRewardEnhanced:cc.Button,iconClaimedNormal:cc.Node,iconClaimedEnhanced:cc.Node,iconAds:cc.Node},initializeStatus:function(e,t){this.signItemData=e,this.indexDay.string=this.signItemData.index,this.normalReward=this.signItemData.normalReward,this.enhancedReward=this.signItemData.enhancedReward,this.listItemReward=[],this.curentStateReward=t,console.log("initializeStatus 2 ",this.signItemData,this.signItemData.index,this.curentStateReward),this.curentTypeDay="",this.updateSignUI(),user.getGuide("Dailylogin")},updateSignUI:function(){this.signItemData&&0!==Object.keys(this.signItemData).length&&(this.spRankItem.spriteFrame=this.spfRankItem[this.signItemData.rankIndex],this._clearRewardNodes(),this.normalReward.item1.i==EQUIPMENT&&equipment.isLock(this.normalReward.item1.id)&&this.normalReward.item1.id&&(this.normalReward.item1.isItemUnlock=equipment.getIdEByName(this.normalReward.item1.id)),this._addRewardItems(this.normalReward,this.normalRewardRoot),this._addRewardItems(this.enhancedReward,this.enhancedRewardRoot),console.log("@@@",this.normalReward))},_clearRewardNodes:function(){this.normalRewardRoot.removeAllChildren(),this.enhancedRewardRoot.removeAllChildren(),this.listItemReward=[]},_addRewardItems:function(e,t){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=e[i],n=cc.instantiate(this.itemRewardPrefab),o=n.getComponent("Item");t.addChild(n),o.init(a),this.listItemReward.push(o)}},setCurrentTypeDay:function(e){this.curentTypeDay=e,console.log("[check]",this.curentTypeDay," Reward : ",this.curentStateReward),this.selectNode.active="Today"===this.curentTypeDay,this._updateRewardState("normalReward",this.curentStateReward.normalReward,this.spLockRewardNormal,this.btnGetRewardNormal,this.iconClaimedNormal),this._updateRewardState("enhancedReward",this.curentStateReward.enhancedReward,this.spLockRewardEnhanced,this.btnGetRewardEnhanced,this.iconClaimedEnhanced)},_updateRewardState:function(e,t,i,a){if(0===t)switch(this.curentTypeDay){case"Available":case"Today":i.active=!1,a.node.active=!0;break;default:a.node.active=!1}else this.isFullClaimed(e,!0)},isFullClaimed:function(e,t){"normalReward"===e?(this.spLockRewardNormal.active=t,this.btnGetRewardNormal.node.active=!t,this.iconClaimedNormal.active=t):(this.spLockRewardEnhanced.active=t,this.btnGetRewardEnhanced.node.active=!t,this.iconClaimedEnhanced.active=t,this.iconAds.active=!t)},onClickGetNormalReward:function(){var e;if(console.log("onClickGetNormalReward","this.curentTypeDay",this.curentTypeDay),"Available"===this.curentTypeDay||"Today"===this.curentTypeDay){var t=this.signItemData.index-1;if(i.FirebaseTracking.LogCustomEvent("Login7d",{reward_id:"[Free]_D"+this.signItemData.index,userID:user.uuid,cohort_day:user.countLoginDay,claim_time:""+Utils.getCurrentUTCTimestamp()}),console.log("onClickGetNormalReward",this.normalReward),this.normalReward.item1.i==EQUIPMENT){var a=this.normalReward.item1,n=equipment.isLock(a.id);if(console.log("onClickGetNormalReward",n),n&&this.normalReward.item1.id){console.log("33333333333333333333333333");var o={id:window.equipment.getIdEByName(a.id),i:a.id},r=window.equipment.unlockByName(o.i);console.log("----"),console.log(r),console.log("reward ",o),console.log("-----",window.equipment.data),net.updateData({add:r},function(e,t){console.log("unlock ",e,t),window.equipment.save(),menuManager.pop("show_new_equiment",{items:o,lootCb:function(){}})})}else{console.log("444444444444444444");var s=[];window.equipment.getItemFromReward(s,this.normalReward),console.log("[check",this.normalReward),console.log("reward",s),net.updateData({items:s},function(){menuManager.pop("show",{tid:"sign",items:s,checkCb:function(){}})})}}else{console.log(22222222222222223e6);var c=this.normalReward.item1;net.updateData({items:[c]},function(e,t){console.log("[updatedData]",t),money.update(t),menuManager.pop("show",{tid:"sign",items:[c],checkCb:function(){}})})}i.FirebaseTracking.setDataBiRes("SignMenu"),user.stateRewardSign[t]||(user.stateRewardSign[t]=Object.assign({},this.curentStateReward)),user.stateRewardSign[t].normalReward=1,this.isFullClaimed("normalReward",!0),net.updateData({add:{signIndex:1},set:(e={},e["stateRewardSign."+t+".normalReward"]=1,e["stateRewardSign."+t+".enhancedReward"]=user.stateRewardSign[t].enhancedReward,e)},function(e,t){cc.game.emit("check_claim_reward"),console.log("[check]","OutputData",user.signCount,user.signIndex,t,e),user.signIndex=t.doc.signIndex})}},onClickGetEnhancedReward:function(){if(console.log("onClickGetEnhancedReward","this.curentTypeDay",this.curentTypeDay),"Available"===this.curentTypeDay||"Today"===this.curentTypeDay){var e=this;i.FirebaseTracking.LogCustomEvent("Login7d",{reward_id:"[Ads]_D"+e.signItemData.index,userID:user.uuid,cohort_day:user.countLoginDay,claim_time:""+Utils.getCurrentUTCTimestamp()}),sdk.useFree("sign",function(t){if(console.log("[check] WatchVideo",t),t);else{var a=[];equipment.getItemFromReward(a,e.enhancedReward),console.log("[check",a),net.updateData({items:a},function(t,n){var o;console.log("[check]","[updatedData]",n),money.update(n),i.FirebaseTracking.setDataBiRes("SignMenu");var r=e.signItemData.index-1;user.stateRewardSign[r]||(user.stateRewardSign[r]=Object.assign({},e.curentStateReward)),user.stateRewardSign[r].enhancedReward=1,cc.game.emit("check_claim_reward"),e.isFullClaimed("enhancedReward",!0),net.updateData({set:(o={},o["stateRewardSign."+r+".normalReward"]=user.stateRewardSign[r].normalReward,o["stateRewardSign."+r+".enhancedReward"]=1,o)},function(){}),menuManager.pop("show",{tid:"sign",items:a,checkCb:function(){}})})}})}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],SignMenu:[function(e,t){"use strict";cc._RF.push(t,"d1d13g3JapIc6wM7tfGrX96","SignMenu"),e("../../Plugins/firebase/FirebaseTracking");var i=[{index:1,title:"Day",rankIndex:0,normalReward:{item1:{i:GOLD,n:2e3}},enhancedReward:{item1:{i:EQUIPMENT,rarity:1,n:20},item2:{i:GOLD,n:2e3}}},{index:2,title:"Day",rankIndex:0,normalReward:{item1:{i:EQUIPMENT,id:"cannon",rarity:1,n:5,isPuzzle:!1}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:1e3}}},{index:3,title:"Day",rankIndex:0,normalReward:{item1:{i:EQUIPMENT,id:"laser",rarity:1,n:5,isPuzzle:!1}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:2e3}}},{index:4,title:"Day",rankIndex:0,normalReward:{item1:{i:SWEEP_TICKET,n:10}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:2e3}}},{index:5,title:"Day",rankIndex:1,normalReward:{item1:{i:GOLD,n:4e3}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:3e3}}},{index:6,title:"Day",rankIndex:2,normalReward:{item1:{i:HERO_REFRESH_TICKET,n:5}},enhancedReward:{item1:{i:EQUIPMENT,rarity:2,n:20},item2:{i:GOLD,n:5e3}}},{index:7,title:"Day",rankIndex:3,normalReward:{item1:{i:EQUIPMENT,id:"tesla",rarity:1,n:5,isPuzzle:!1}},enhancedReward:{item1:{i:DIAMOND,n:1e3},item2:{i:GOLD,n:5e3}}}],a=[{index:1,title:"Day",rankIndex:0,normalReward:{item1:{i:GOLD,n:1e3}},enhancedReward:{item1:{i:EQUIPMENT,rarity:1,n:20},item2:{i:GOLD,n:2e3}}},{index:2,title:"Day",rankIndex:0,normalReward:{item1:{i:RECRUIT_TICKET,n:3}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:1e3}}},{index:3,title:"Day",rankIndex:0,normalReward:{item1:{i:SWEEP_TICKET,n:10}},enhancedReward:{item1:{i:EQUIPMENT,rarity:2,n:10},item2:{i:GOLD,n:2e3}}},{index:4,title:"Day",rankIndex:0,normalReward:{item1:{i:GOLD,n:3e3}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:2e3}}},{index:5,title:"Day",rankIndex:1,normalReward:{item1:{i:DIAMOND,n:500}},enhancedReward:{item1:{i:DIAMOND,n:500},item2:{i:GOLD,n:3e3}}},{index:6,title:"Day",rankIndex:2,normalReward:{item1:{i:EQUIPMENT,rarity:1,n:20}},enhancedReward:{item1:{i:EQUIPMENT,rarity:2,n:20},item2:{i:GOLD,n:5e3}}},{index:7,title:"Day",rankIndex:3,normalReward:{item1:{i:EQUIPMENT,rarity:2,n:20}},enhancedReward:{item1:{i:EQUIPMENT,rarity:3,n:10},item2:{i:GOLD,n:5e3}}}];cc.Class({extends:e("../ui/core/PopMenu"),properties:{layoutNode:cc.Node,itemSignPrefab:cc.Prefab,itemRewardPrefab:cc.Prefab,signLootButtonNodes:[cc.Node],listItemReward:void 0},onLoad:function(){},start:function(){this.itemSignNode=[],console.log("Check Daily",user.weekSign,user.signIndex,user.signCount,user.weekSign>0),this.signRewardDefine=[],user.weekSign>0?this.signRewardDefine=a:this.signRewardDefine=i,console.log("Check Daily",this.signRewardDefine),this.initializeSignStatus(),this.initGuide()},initGuide:function(){if(1!=user.getGuide("Dailylogin")&&2==user.getGuide("chapter")){var e=this,t=new cc.Node("btn");t.addComponent(cc.Button),t.setContentSize(e.itemSignList[0].node.getChildByName("lock_normal").getContentSize().clone()),t.setPosition(e.itemSignList[0].node.getChildByName("lock_normal").getPosition().clone()),t.zIndex=999,e.itemSignList[0].node.addChild(t),menuManager.focusOn(e.itemSignList[0].node.getChildByName("btn"),"Now go claim your rewards and upgrade your gear to prepare for the upcoming battle!",null,function(){user.setGuide("Dailylogin",1),user.quickSave("guide.Dailylogin",1),e.itemSignList[0].node.removeChild(t,!0)},null,{dx:-100,dy:80})}},initializeSignStatus:function(){console.log("initializeSignStatus");var e=this;this.itemSignList=[],this.itemSignPrefab.zIndex=0;for(var t=0;t<7;t++){var i=cc.instantiate(this.itemSignPrefab),a=i.getComponent("SignItem");this.layoutNode.addChild(i),a.initializeStatus(this.signRewardDefine[t],user.stateRewardSign[t]||{normalReward:0,enhancedReward:0}),i.zIndex=t,this.itemSignNode.push(i),this.itemSignList.push(a)}user.refreshSignData(function(){e.initializeSignUI()})},initializeSignUI:function(){cc.log("sign initializeSignUI",user.signIndex,user.signCount),console.log(user.signIndex,user.signCount),this.updateSignUI(user.signIndex,user.signCount)},updateSignUI:function(e,t){console.log("currentSignIndex ->>> ",e,"--","currentSignCount",t);var i=t%7,a=Math.floor(t/7);console.log("[check]","dayOfWeek",i,"weekIndex",a);for(var n=0;n<this.signRewardDefine.length;n++){this.signRewardDefine[n];var o,r=this.itemSignList[n];console.log(n,i),o=n<i?"Available":n==i?"Today":n==i+1?"Tomorrow":"",console.log("[check]","currentTypeDay",n,o),r.setCurrentTypeDay(o)}},claimSignReward:function(){},onClickLoot:function(e,t){var i=user.signIndex%7,a=user.signCount;a>=2||i+a>=7?kit.info("\u660e\u5929\u518d\u6765\u5427"):this.claimSignReward(this.selectedSignReward,t)}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],SimpleComplete:[function(e,t){"use strict";cc._RF.push(t,"afe8bKL2IdAs4EpX2elpEst","SimpleComplete"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{},onLoad:function(){},start:function(){},initStatus:function(e){this.args=e;var t=this.game=e.game;this.chapterIndex=e.chapterIndex,this.node.runAction(cc.sequence(cc.delayTime(2.5),cc.callFunc(function(){t&&(t.layer.hidePauseBtn(!1),t.layer.hideOtherBtn(!1),t.layer.joystick.setEnabled(!1));var e=this.args.hideCb;e&&e()},this),cc.delayTime(2),cc.callFunc(function(){this.close();var e=this.args.nextCb;e&&e()},this)))}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],SingleBuff:[function(e,t){"use strict";cc._RF.push(t,"1c460maqPhOkLDyyzKlbilT","SingleBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){this.teamTable=this.game.levelMgr.teamTable},update:function(){var e=this.obj,t=e.team,i=this.config.atk;this.teamTable[t]>1?this.single&&(this.single=!1,e.attribute.mutScale("atkScale",-i),cc.log("down atkScale",e.getAtkScale())):this.single||(this.single=!0,e.attribute.mutScale("atkScale",i),cc.log("up atkScale",e.getAtkScale()))},end:function(){}}),cc._RF.pop()},{"./Buff":"Buff"}],Skill:[function(e,t){"use strict";cc._RF.push(t,"65053dZPBtNk6ebS1k3fOID","Skill");var i=e("../../attributes/AttributeAgent");cc.Class({extends:e("../../../core/base/Proto"),getCaster:function(){return this},init:function(e,t,a){this.game=e,this.define=t,this.config=a,this.obj=a.obj,this.id=a.index,this.chargeAction=!1,this.castAction=!1,this.cd1=t.cd||.1,this.cd0=t.cd0||this.cd1||.1,void 0!==e.cdScale&&(this.cd1*=e.cdScale,this.cd0*=e.cdScale),DEV_MODE&&DEBUG_MODE&&DEBUG_SKILL&&(this.cd1=this.cd1*(1-DEBUG_SKILL)+.1,this.cd0=this.cd0*(1-DEBUG_SKILL)+.1),this.cdTimer=this.cd0,this.maxCDTimer=this.cd1,this.agent=new i,this.agent.init(this),this.initStatus(),this.initEnergy(),this.skillMark=!0},initStatus:function(){},remove:function(){this.interrupt();var e=this.define.ult,t=this.obj;e&&(this.game.eventMgr.unregist(t,"hurtEvent",this),this.game.eventMgr.unregist(t,"killEvent",this))},reset:function(){this.ready=!1,this.frozen=!1,this.cdTimer=this.cd0,this.obj.pilot.onSkillUpdate(this,SKILL_STATUS.RESET)},froze:function(e){this.frozen=e,this.obj.pilot.onSkillUpdate(this,SKILL_STATUS.FROZEN)},silence:function(e){this.silent=e,this.obj.pilot||cc.log(this.define.name),this.obj.pilot.onSkillSilence(this,e)},initEnergy:function(){var e=this.define.ult,t=this.obj;e&&(this.game.eventMgr.regist(t,"hurtEvent",this,this.hurtEvent),this.game.eventMgr.regist(t,"killEvent",this,this.killEvent),this.heroEnergy=e.heroEnergy,this.heroEnergyStep=e.heroEnergyStep,this.hpEnergy=e.hurtEnergy,this.energyToTime=e.energyToTime)},chargeEnergy:function(e){if(!this.ready&&!this.frozen){var t=this.obj,i=e*this.energyToTime;this.cdTimer-=i*t.skillCD,this.cdTimer<=0&&(this.ready=!0),t.pilot.onSkillRefresh(this,i)}},refreshCdTimer:function(e){var t=this.cdTimer-e;this.cdTimer=e,e<=0&&(this.ready=!0),this.obj.pilot.onSkillRefresh(this,t)},killEvent:function(){this.chargeEnergy(this.heroEnergy)},hurtEvent:function(e,t,i){var a=0;a+=i/this.obj.hpMax*this.hpEnergy,this.chargeEnergy(a)},updateLogic:function(e){var t=this.obj;if(this.chargeAction)this.chargetTimer-=e,this.chargetTimer<=0&&this.isCharged?(this.isCharged=!1,this.checkCast()):this.updateCharge(e);else if(this.castAction)if(this.castTimer-=e,this.castTimer<=ZERO)if(this.callEndCast(),this.inCombo)this.inCombo=!1;else{var i=t.skillCombo||0;this.game.c_rnd(0,1)<i&&(this.inCombo=!0,this.ready=!0,this.checkCharge(),this.isCharged=!0)}else this.updateCast(e);else this.ready||this.frozen||(this.cdTimer-=e*t.skillCD,this.cdTimer<=ZERO&&(this.ready=!0,t.pilot.onSkillUpdate(this,SKILL_STATUS.READY)))},interrupt:function(){this.chargeAction&&this.callEndCharge(!0),this.castAction&&this.callEndCast()},callEndCharge:function(e){this.chargeAction&&(e&&this.game.callEffect(EFFECT.endSkill,this),this.chargeAction=!1,this.endCharge(e),this.agent.clear(),this.obj.pilot.onSkillUpdate(this,SKILL_STATUS.END_CHARGE))},callEndCast:function(){this.castAction&&(this.game.callEffect(EFFECT.endSkill,this),this.castAction=!1,this.endCast(),this.agent.clear(),this.obj.pilot.onSkillUpdate(this,SKILL_STATUS.END_CAST))},call:function(e,t,i){this.castDeg=t,this.castSpd=i,e?this.checkCharge():this.chargeAction&&(this.isCharged=!0)},checkCharge:function(){if(!this.silent&&!this.chargeAction&&!this.castAction&&this.ready&&!this.startCharge()){var e=this.obj;return this.game.callEffect(EFFECT.startSkill,this),this.chargeAction=!0,this.chargetTimer=this.define.ct||0,e.pilot.onSkillUpdate(this,SKILL_STATUS.START_CHARGE),!0}},startCharge:function(){},updateCharge:function(){},endCharge:function(){},checkCast:function(){if(!this.silent&&!this.castAction&&this.ready)return this.callEndCharge(),this.casting(),!0;this.callEndCharge(!0)},casting:function(){var e=this.obj;this.startCast(),this.castAction=!0,this.ready=!1,this.cdTimer=this.cd1,this.castTimer=this.define.t,e.pilot.onSkillUpdate(this,SKILL_STATUS.START_CAST)},startCast:function(){},updateCast:function(){},endCast:function(){},startSmoothMove:function(e,t){this.SMMDeg=e,this.SMMRttSpd=t||20},updateSmoothMove:function(e,t,i){var a=this.obj,n=this.SMMRttSpd,o=c_includeDegree(t,this.SMMDeg);if(c_abs(o)<1)this.SMMDeg=t;else{var r=c_clamp(o*n*e*.1,-n,n);c_abs(r)>c_abs(o)&&(r=o),this.SMMDeg=(this.SMMDeg+r+360)%360}var s=i*a.moveSpd*e;a.dx=c_degree2cos(this.SMMDeg)*s,a.dy=c_degree2sin(this.SMMDeg)*s,a.deg=this.SMMDeg},replaceBlt:function(){if(!this.backupBlt){this.backupBlt={};var e=this.obj,t=this.define.replaceBlt;for(var i in t)this.backupBlt[i]=e[i],e[i]=t[i]}},restoreBlt:function(){if(this.backupBlt){var e=this.obj,t=this.backupBlt;for(var i in t)e[i]=t[i];delete this.backupBlt}},replacePilot:function(){if(!this.backupPilot){this.backupPilot={};var e=this.obj.pilot,t=this.define.replacePilot;for(var i in t)this.backupPilot[i]=e[i],e[i]=t[i];e.seekTimer=3}},restorePilot:function(){if(this.backupPilot){var e=this.obj.pilot,t=this.backupPilot;for(var i in t)e[i]=t[i];delete this.backupPilot}},startBulletMove:function(e,t,i,a){var n=this.obj;this.timer=a,this.height=1,this.deg=e,this.team=n.team,this.moveSpdX=c_degree2cos(e)*t,this.moveSpdY=c_degree2sin(e)*t,this.x0=n.x,this.y0=n.y,this.x=this.x0,this.y=this.y0,this.simpleCompute=!0,this.radius=i,this.game.contactMgr.addBullet(this)},updateBulletMove:function(e){var t=this.obj;this.timer>0&&(this.timer<=e&&(e=this.timer),this.timer-=e,this.x0=this.x,this.y0=this.y,this.x=this.x0+this.moveSpdX*e,this.y=this.y0+this.moveSpdY*e,t.x=this.x,t.y=this.y)},endBulletMove:function(){this.game.contactMgr.removeBullet(this)},getAllTarget:function(e,t,i,a){for(var n=this.game.getEntityList(),o=[],r=0;r<n.length;r++){var s=n[r];if(s._activeContact&&s.isInBorder()&&!s._sensor&&!s.isDead()&&s.team!=a){var c=s.x-e,l=s.y-t;c*c+l*l<i*i&&o.push(s)}}return o},aoe:function(e,t,i,a,n,o,r,s,c){var l=this.game.contactMgr.getContactList();for(var d in l){var h=l[d],u=h.getEntity();if(h._activeContact&&u.isInBorder()&&u.team!==e){var p=l[d].hitRadius+n,f=t-h.getPositionX(),m=i-h.getPositionY(),g=f*f+m*m;if(g<=p*p){var v=c_sqrt(g)+.1;if(v<=a)u.onHurt(this,o);else{var y=o+(r-o)*(v-a)/(p-a);u.onHurt(this,y)}c&&u.addBuff(this,c);var b=s/(v*u.weight);u.onKnockback(-f*b,-m*b)}}}}}),cc._RF.pop()},{"../../../core/base/Proto":"Proto","../../attributes/AttributeAgent":"AttributeAgent"}],Slot:[function(e,t){"use strict";cc._RF.push(t,"8439dZxu1FMYqI0u+0Nb66H","Slot"),cc.Class({extends:e("../core/base/Proto"),init:function(e,t,i){this.game=e,this.garrisonArray=[],this.garrisonMax=3,this.obj=i.obj,this.dx=t.x||0,this.dy=t.y||0,this.hw=(t.w||100)/2,this.hh=(t.h||20)/2,this.cover=t.cover,this.slotType=t.slot,this.subFlag=t.sub,this.safeSlotOut=t.safeSlotOut,this.moveOffset=0},garrisonUnit:function(e){e.attachedSlot||(e.onSlotIn(this),e.y=this.getPositionY(),this.cover&&e.setFlag(NO_CONTACT,!0),this.garrisonArray.push(e))},releaseUnit:function(e){e.attachedSlot&&(this.cover&&e.setFlag(NO_CONTACT,!1),e.onSlotOut())},updateOffset:function(e,t,i){for(var a=this.garrisonArray,n=0,o=a.length;n<o;n++){var r=this.garrisonArray[n];r.isDead()||r.attachedSlot!==this?(a.splice(n,1),n--,o--):r.applyMoveOffset(t,i)}if(this.garrisonArray.length<this.garrisonMax){var s=this.game.getEntityList(),c=this.obj.team;for(var l in s){var d=s[l];if(!(d.team!==c||d.isFly()||d.landed||d.attachedSlot||d.isDead())&&d.slotType===this.slotType){var h=d.x-this.getPositionX(),u=d.y-d.height-this.getPositionY();c_abs(h)<this.hw&&c_abs(u)<this.hh&&this.garrisonUnit(d)}}}},onHurt:function(e,t,i){if(this.subFlag){var a=this.getRoot();a&&a.onHurt(e,t,i,DMG_TYPE.platform)}},getRoot:function(){var e=this.obj;return e.subFlag?e.attachedSlot?e.attachedSlot.getRoot():void 0:e},callDeath:function(e,t,i,a){if(this.subFlag&&this.obj.attachedSlot)for(var n in this.garrisonArray){var o=this.garrisonArray[n];!o.isDead()&&o.attachedSlot===this&&o.subFlag&&(o.attachedSlot.releaseUnit(o),this.obj.attachedSlot.garrisonUnit(o))}else for(var r in this.garrisonArray){var s=this.garrisonArray[r];s.isDead()||s.attachedSlot!==this||(s.onSlotOut(),this.safeSlotOut||s.define.safeSlotOut||s.callDeath(e,t,i,a))}},getGroundDegree:function(){return 0},getGroundLine:function(){return this.getPositionY()},getPositionX:function(){return this.dx+this.obj.x},getPositionY:function(){return this.dy+this.obj.y+this.moveOffset}}),cc._RF.pop()},{"../core/base/Proto":"Proto"}],Spider:[function(e,t){"use strict";cc._RF.push(t,"ad702uOYqdMH5oBhwmpn1uQ","Spider"),cc.Class({extends:e("../core/base/Entity"),updatePhysics:function(e){this.stopPhysicsTimer>0?this.stopPhysicsTimer-=e:this._super(e)},callDeath:function(e,t,i,a){this._super(e,t,i,a),this.stopPhysicsTimer=1.3}}),cc._RF.pop()},{"../core/base/Entity":"Entity"}],SplitArrow:[function(e,t){"use strict";cc._RF.push(t,"4f743DLAh9F7ad1zJRfiDiX","SplitArrow");var i=cc.Class({extends:e("./Bullet"),attack:function(e,t,i,a){if(this.distance){var n=.3*this.distance;n<200?n=200:n>300&&(n=300)}var o={x:e,y:t,deg:i,team:this.team,obj:this.obj,distance:n,dmg:.4*this.dmg};this.splitCfg=o,this.splitDef=a,this.continue()},through:function(e){this.attack(e.x,e.y,this.deg,this.define.son1),this.throughObject=e},explosion:function(){this.attack(this.x,this.y,this.deg,this.define.son2)},reflect:function(e,t,i){if(0!=i){if(1==i){var a=(180-this.deg+360)%360;e-=this.moveSpdX/this.moveSpd}else 2==i&&(a=(360-this.deg)%360,t-=this.moveSpdY/this.moveSpd);this.attack(e,t,a,this.define.son1)}},updateLogic:function(e){if(this.delayRemove){var t=this.splitCfg,a=this.splitDef,n=this.throughObject;return n&&(t.ignoreObject=n,t.x=this.x+(n.x-t.x),t.y=this.y+(n.y-t.y)),i.shot(this.game,a,t),this.define.avatar&&this.game.callEffect(this.define.avatar.hitEffect,t.x,t.y,t.deg,this.hurtDelayTime,.5),void this.game.removeUpdate(this)}this._super(e)},continue:function(){this.removed&&(this.removed=!1),this.game.addUpdate(this),this.delayRemove=!0},onTimeOut:function(){this._super(),this.explosion()},onHitWall:function(e,t,i){this._super(e,t,i),this.reflect(e,t,i)},onHit:function(e,t){if(this._super(e,t))return this.through(e,t),!0}});cc._RF.pop()},{"./Bullet":"Bullet"}],StackBuff:[function(e,t){"use strict";cc._RF.push(t,"753e51kXyJHTLyjmnXeEAzc","StackBuff"),cc.Class({extends:e("./Buff"),cover:function(){var e=this.stack;if(this.stack++,this.stack>=this.stackMax&&(this.stack=this.stackMax),e!=this.stack){this.removeAttr(this.attr);var t=kit.clone(this.define.attr);for(var i in t)t[i][2]*=this.stack;this.attr=this.addAttr(t),cc.log("StackBuff cover",this.stack,this.attr,t,this.obj.attribute.get(t[0][1]))}},begin:function(){this.obj,this.stackMax=this.define.stack,this.stack=1},end:function(){},condition:function(){},update:function(){}}),cc._RF.pop()},{"./Buff":"Buff"}],StageTaskMenu:[function(e,t){"use strict";cc._RF.push(t,"58fd2JncQ5LeoS4PTEpI+NS","StageTaskMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{layoutNode:cc.Node,itemNode:cc.Node,itemPrefab:cc.Prefab,scroll:cc.ScrollView},onLoad:function(){},start:function(){this.selectOne&&(this.layoutNode.getComponent(cc.Layout).updateLayout(),this.scroll.scrollToOffset(cc.v2(this.layoutNode.x,-this.selectOne.y-this.scroll.node.height/2),0))},initStatus:function(){this.itemList=[],this.itemNode.active=!1,this.initUI()},initUI:function(){for(var e in STAGE_TASK){var t=STAGE_TASK[e],i=this.itemList[e];i||(i=cc.instantiate(this.itemNode),this.layoutNode.addChild(i),i.zIndex=e,i.active=!0,this.itemList.push(i)),this.refreshTaskBoard(i,t)}},refreshTaskBoard:function(e,t){var a=this,n=adventure.chapterToStage(t.chapter-1,t.map-1),o=task.getStageTaskStatus(n)||0,r=e.getChildByName("layout");r.destroyAllChildren();var s=[];for(var c in t.items){var l=t.items[c];s.push(l);var d=cc.instantiate(this.itemPrefab);r.addChild(d),d.getComponent("Item").init(l),d.getComponent("Item").setGray(o>1)}e.getChildByName("index").getComponent(cc.Label).string=adventure.stageToName(n);for(var h=0;h<4;h++)e.getChildByName("bg"+h).active=!1;if(e.opacity=255,pc.stageIndex>n)if(o>1)e.getChildByName("bg3").active=!0,e.onTouch=function(){kit.info("\u9886\u8fc7\u4e86")};else{this.selectOne||(this.selectOne=e,cc.log(t)),o>0?e.getChildByName("bg2").active=!0:e.getChildByName("bg1").active=!0;var u=function(o){sdk.useFree("stage_task",function(r){if(!r){var c=task.getStageTaskStatus(n);c>1||(c=2,net.updateData({stageTask:{index:n,status:c},items:s},function(r,l){r||(i.FirebaseTracking.setDataBiRes("Ads_RefreshTask"),money.update(l),task.setStageTaskStatus(n,c),a.refreshTaskBoard(e,t),o&&menuManager.close(),menuManager.pop("show",{items:s,tid:"stage_task"}))}))}})};e.onTouch=function(){1!=o?(o=t.noVideo?2:1,net.updateData({stageTask:{index:n,status:o},items:s},function(r,c){i.FirebaseTracking.setDataBiRes("RefreshTask"),money.update(c),task.setStageTaskStatus(n,o),a.refreshTaskBoard(e,t),menuManager.pop("show",{items:s,tid:"stage_task",checkCb:function(){o<2&&menuManager.pop("video",{title:"\u989d\u5916\u4ea7\u51fa",items:s,checkCb:function(e){if(e)return u(!0),!0}})}})})):u()}}else this.selectOne||(this.selectOne=e),e.getChildByName("bg0").active=!0,e.onTouch=function(){kit.info("\u8fdb\u5ea6\u8fd8\u4e0d\u591f")}}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],Startup:[function(e,t){"use strict";cc._RF.push(t,"cb7e1NghwhFp4VrPcxp+P+J","Startup"),cc.Class({extends:cc.Component,properties:{label:cc.Label,logo0:cc.Node,logo1:cc.Node,logoNode:cc.Node},onLoad:function(){if(console.log("Check OS : ",cc.sys.os),this.loadCt=0,console.log("Startup onLoad"),this.initCrashlytics(),window.location){var e=window.location.search,t={};if(e){var i=e.substr(1).split("&");for(var a in i){var n=i[a].split("=");t[n[0]]=n[1]}}window.launchQuery=t,console.log("launchQuery",t),t.title&&(window.GAME_TITLE=decodeURIComponent(t.title)),t.sr&&(window.GAME_SR_NUM=decodeURIComponent(t.sr))}},onRun:function(){this.loadCt--,console.log("Startup onRun",this.loadCt),0===this.loadCt&&(cc.sys.isNative,cc.director.loadScene("scene/login"))},loadBundle:function(e,t){this.label.string="Loading...",cc.assetManager.loadBundle(e,t),console.log("loadBundle",e)},loadAllBundles:function(){var e=this;this.loadCt++,this.loadBundle("script",function(t){e.loadBundle("scene",function(i){e.loadBundle("res",function(a){console.log(t,i,a),e.onRun()}),e.loadLocal()})})},loadLocal:function(){var e=this;this.loadCt++,local.load(function(){e.onRun()})},showLogo:function(){this.logo0.active=!0,this.logo1.active="google"!==CH,this.loadCt++,this.logoNode.active=!0,this.logoNode.opacity=0,this.logoNode.runAction(cc.sequence(cc.fadeIn(2.5),cc.delayTime(.5),cc.callFunc(this.onRun,this)))},start:function(){console.log("Startup start"),this.loadAllBundles(),this.showLogo()},initCrashlytics:function(){try{var t=e("../Plugins/firebase/Crashlytics");window.crashlytics=t.crashlytics,window.crashlytics&&(window.crashlytics.init(),console.log("Crashlytics initialized in Startup"),window.crashlytics.log("Game started - "+(new Date).toISOString()))}catch(i){console.error("Failed to initialize Crashlytics:",i)}}}),cc._RF.pop()},{"../Plugins/firebase/Crashlytics":"Crashlytics"}],Star:[function(e,t){"use strict";cc._RF.push(t,"d03b3ymlm5BxZPu91yvo9Ln","Star"),cc.Class({extends:cc.Component,properties:{blocks:[cc.Node]},onLoad:function(){var e=this.node.getParent().width||60,t=this.node.getParent().height||60,i=function i(){var a=this;a.x=kit.rnd(-e/2,e/2),a.y=kit.rnd(t/2-10,t/2),a.scale=.5,a.opacity=255,a.color=cc.color(191,251,255);var n=kit.rnd(.5,1.5);a.runAction(cc.sequence(cc.spawn(cc.jumpBy(n,kit.rnd(-80,80),kit.rnd(20,40),kit.rnd(20,30),1),cc.fadeOut(n),cc.scaleTo(n,1)).easing(cc.easeSineOut()),cc.callFunc(i,a)))};for(var a in this.blocks){var n=this.blocks[a];n.x=0,n.y=0,n.opacity=0,n.runAction(cc.sequence(cc.delayTime(kit.rnd(0,3)),cc.callFunc(i,n)))}}}),cc._RF.pop()},{}],StatsCalculator:[function(e,t){"use strict";cc._RF.push(t,"e90a0PhfShMNYjseMebwRvI","StatsCalculator");var i={lastKnownMaxHP:null,setLastMaxHP:function(e){e&&e>0&&(this._lastMaxHP=e,"undefined"!=typeof window&&(window._statsCalculatorMaxHP=e))},getMaxHPForCalculation:function(e){var t=e;return!t||t<=0?this._lastMaxHP&&this._lastMaxHP>0?t=this._lastMaxHP:"undefined"!=typeof window&&window._statsCalculatorMaxHP&&window._statsCalculatorMaxHP>0?(t=window._statsCalculatorMaxHP,this._lastMaxHP=window._statsCalculatorMaxHP):t=1e3:this.setLastMaxHP(t),t},calculateTotalATK:function(e){var t=0;if(!e||!e.length)return 0;for(var i=0;i<e.length;i++){var a=e[i];if(a&&a.pos){var n=window.BackpackItemDefine&&window.BackpackItemDefine[a.id];if(n&&"weapon"===n.infoType){var o=n.unitID,r=0;if(window.ENTITY&&window.ENTITY[o]){var s=window.ENTITY[o],c=s.bltDmg||s.bombDmg;c?r=c:s.blt&&s.blt[0]&&(r=s.blt[0].dmg||s.blt[0].bomb&&s.blt[0].bomb.dmg0||0)}var l=r,d=n.type||a.id.replace(/\d+$/,""),h=0;try{window.equipment&&"function"==typeof window.equipment.getStat&&(h=window.equipment.getStat(d,"atk")||0)}catch(p){cc.log(p)}if(h>0){var u=h*Math.pow(1.5,n.rarity||0);l=Math.floor(r+u)}else l=r;t+=l}}}return Math.floor(10*t)/10},calculateHPRegenPerSec:function(e,t){var i=0;if(!e||!e.length)return 0;var a=null;t&&("number"==typeof t?a=t:t.hpMax&&(a=t.hpMax)),a=this.getMaxHPForCalculation(a);for(var n=[],o=0;o<e.length;o++){var r=e[o];if(r&&r.id&&(r.pos||r.position)){var s=BackpackItemDefine[r.id];if(s){var c=r.id.replace(/\d+$/,"");if("heal"===s.type||"heal"===s.infoType||"fuelTank"===c){var l=ENTITY[s.unitID];if(!l||!l.infoNum)continue;var d=this.calculateItemHealing(r,s,l,a);d.finalRegen>0&&(i+=d.finalRegen,n.push(d))}}}}return Math.round(100*i)/100},calculateItemHealing:function(e,t,i,a){var n=e.id.replace(/\d+$/,""),o=!1,r="",s=0;if("fuelTank"===n){o=!0,s=i.infoNum;var c=0;try{window.equipment&&"function"==typeof window.equipment.getStat&&(c=window.equipment.getStat(t.type||n,"heal")||0)}catch(p){cc.log("[StatsCalculator] Could not get equipment stat bonus:",p)}var l=e.rarity||t.rarity||0,d=0+a*s;return r=(100*s).toFixed(1)+"%",{id:e.id,type:n,isPercentage:o,baseRegen:i.infoNum*a,finalRegen:d,percentDisplay:r,rarity:l,statBonus:c,hpPercent:s}}o=!1;var h=i.infoNum,u=0;try{window.equipment&&"function"==typeof window.equipment.getStat&&(u=window.equipment.getStat(t.type||n,"heal")||0)}catch(p){cc.log("[StatsCalculator] Could not get equipment stat bonus:",p)}return l=e.rarity||t.rarity||0,d=u?Math.floor(h+u*Math.pow(1.5,l)):h,{id:e.id,type:n,isPercentage:o,baseRegen:h,finalRegen:d,percentDisplay:r,rarity:l,statBonus:u}},calculateArmorRegenPerSec:function(e){var t=0;if(!e||!e.length)return 0;for(var i=0;i<e.length;i++){var a=e[i];if(a&&a.pos){var n=window.BackpackItemDefine&&window.BackpackItemDefine[a.id];if(n&&"armor"===n.infoType){var o=0,r=a.id.replace(/\d+$/,"");if(window.equipment&&window.equipment.data)if(window.equipment.data.current&&window.equipment.data.current[a.id])(s=window.equipment.data.current[a.id]).level&&s.level;else if(window.equipment.data.current&&window.equipment.data.current[r]){var s;(s=window.equipment.data.current[r]).level&&s.level}else if(window.equipment.data.items&&window.equipment.data.items[a.id])(c=window.equipment.data.items[a.id]).level&&c.level;else if(window.equipment.data.items&&window.equipment.data.items[r]){var c;(c=window.equipment.data.items[r]).level&&c.level}var l=n.unitID;if(l&&window.ENTITY&&window.ENTITY[l]){var d=window.ENTITY[l];void 0!==d.infoNum&&null!==d.infoNum&&(o=d.infoNum)}var h=0;try{window.equipment&&"function"==typeof window.equipment.getStat&&(h=window.equipment.getStat(a.id.replace(/\d+$/,""),"armor")||0)}catch(m){}var u=a.rarity;if(null==u&&(u=n.rarity||0),h){var p=o,f=Math.pow(1.5,u);o=Math.floor(p+h*f)}t+=o}}}return t},getAllStats:function(e,t){return t&&("number"==typeof t||t.hpMax&&t.hpMax),this._loggedDefines||(this._loggedDefines=!0),{totalATK:this.calculateTotalATK(e),hpRegenPerSec:this.calculateHPRegenPerSec(e,t),armorRegenPerSec:this.calculateArmorRegenPerSec(e)}},calculateAndSyncStats:function(e,t){var i=this.getAllStats(e,t);return this.syncedStats={totalATK:i.totalATK,hpRegenPerSec:i.hpRegenPerSec,armorRegenPerSec:i.armorRegenPerSec,lastUpdated:Date.now(),maxHPUsed:null},t?"number"==typeof t?this.syncedStats.maxHPUsed=t:t.hpMax&&(this.syncedStats.maxHPUsed=t.hpMax):this.syncedStats.maxHPUsed=this.getMaxHPForCalculation(null),"undefined"!=typeof window&&(window.syncedStatsCalculatorData=this.syncedStats),i},clearSyncedStats:function(){this.syncedStats=null,"undefined"!=typeof window&&(window.syncedStatsCalculatorData=null)},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":Math.floor(e).toString()},getSyncedStats:function(){return this.syncedStats?this.syncedStats:"undefined"!=typeof window&&window.syncedStatsCalculatorData?(this.syncedStats=window.syncedStatsCalculatorData,this.syncedStats):null}};t.exports=i,"undefined"!=typeof window&&(window.StatsCalculator=i),cc._RF.pop()},{}],StatsDisplayOverlay:[function(e,t){"use strict";cc._RF.push(t,"d78ceMJQLVBRrGoFGkgINnq","StatsDisplayOverlay"),cc.Class({extends:cc.Component,properties:{statsContainer:cc.Node,damageContainer:cc.Node,recoveryContainer:cc.Node,equipmentLabel:cc.Label,statItemPrefab:cc.Prefab,fadeInDuration:.3,displayDelay:1},initWithStats:function(e){e?this.stats=e:console.warn("[StatsDisplayOverlay] No statistics provided")},setupDisplay:function(){this.node&&(this.node.opacity=0),this.displayDamageStats(),this.displayRecoveryStats(),this.displayEquipment(),this.scheduleOnce(function(){this.fadeIn()},this.displayDelay)},displayDamageStats:function(){if(this.stats&&this.stats.damageByWeapon){var e=0,t=[];for(var i in this.stats.damageByWeapon){var a=this.stats.damageByWeapon[i];a>0&&(e+=a,t.push({type:this.getWeaponDisplayName(i),damage:a,icon:i}))}if(t.sort(function(e,t){return t.damage-e.damage}),this.damageContainer){this.addStatHeader(this.damageContainer,"Total Damage",this.formatNumber(e));for(var n=0;n<t.length;n++)this.addStatItem(this.damageContainer,t[n].type,this.formatNumber(t[n].damage),t[n].icon)}}},displayRecoveryStats:function(){this.stats&&this.stats.recovery&&this.recoveryContainer&&(this.stats.recovery.hp>0&&this.addStatItem(this.recoveryContainer,"HP Recovered",this.formatNumber(this.stats.recovery.hp),"heal"),this.stats.recovery.armor>0&&this.addStatItem(this.recoveryContainer,"Armor Recovered",this.formatNumber(this.stats.recovery.armor),"armor"))},displayEquipment:function(){if(this.stats&&this.stats.equipmentEncoded&&this.equipmentLabel){var e=this.stats.equipmentRaw?this.stats.equipmentRaw.length:0;this.equipmentLabel.string="Equipment: "+e+" towers deployed"}},addStatHeader:function(e,t,i){var a=new cc.Node("StatHeader");a.parent=e;var n=a.addComponent(cc.Label);return n.string=t+": "+i,n.fontSize=24,n.lineHeight=30,a},addStatItem:function(e,t,i){var a;if(this.statItemPrefab)a=cc.instantiate(this.statItemPrefab);else{var n=(a=new cc.Node("StatItem")).addComponent(cc.Label);n.string=t+": "+i,n.fontSize=20,n.lineHeight=25}return a.parent=e,a},getWeaponDisplayName:function(e){return{sniper:"Sniper",machinegun:"Machine Gun",firethrower:"Flamethrower",mortar:"Mortar",armor:"Armor",heal:"Heal Tower",bouncingball:"Bouncing Ball",cannon:"Cannon",laser:"Laser",tesla:"Tesla",flyshield:"Fly Shield",fueltank:"Fuel Tank",energybarrier:"Energy Barrier"}[e]||e},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":Math.floor(e).toString()},fadeIn:function(){this.node&&this.node.runAction(cc.fadeIn(this.fadeInDuration))},statics:{attachToGameOverScreen:function(e,t){var i=e.getChildByName("StatsOverlay");if(i)return(n=i.getComponent("StatsDisplayOverlay"))&&n.initWithStats(t),i;var a=new cc.Node("StatsOverlay");a.parent=e,a.x=0,a.y=-100;var n=a.addComponent("StatsDisplayOverlay"),o=new cc.Node("DamageContainer");o.parent=a,o.y=100;var r=new cc.Node("RecoveryContainer");r.parent=a,r.y=0;var s=new cc.Node("EquipmentContainer");s.parent=a,s.y=-100;var c=s.addComponent(cc.Label);return c.fontSize=18,n.damageContainer=o,n.recoveryContainer=r,n.equipmentLabel=c,n.initWithStats(t),a}}}),cc._RF.pop()},{}],StatsLoader:[function(e,t){"use strict";cc._RF.push(t,"4ecd2bkyBJF6a6bu7NhtaUg","StatsLoader"),cc.Class({extends:cc.Component,onLoad:function(){console.log("[StatsLoader] Loading statistics modules...");try{if(!window.StatsTracker){var t=e("./StatsTracker");t&&(window.StatsTracker=t,console.log("[StatsLoader] StatsTracker loaded successfully"))}if(!window.EquipmentEncoder){var i=e("../utils/EquipmentEncoder");i&&(window.EquipmentEncoder=i,console.log("[StatsLoader] EquipmentEncoder loaded successfully"))}if(!window.StatsStorage){var a=e("./StatsStorage");a&&(window.StatsStorage=a,console.log("[StatsLoader] StatsStorage loaded successfully"))}console.log("[StatsLoader] All statistics modules loaded"),window.StatsTracker&&window.StatsTracker.initSession&&console.log("[StatsLoader] StatsTracker ready for session initialization")}catch(n){console.warn("[StatsLoader] Failed to load some statistics modules:",n)}},statics:{ensureLoaded:function(){if(!window.StatsTracker||!window.EquipmentEncoder||!window.StatsStorage){if(console.log("[StatsLoader] Some modules not loaded, attempting to load..."),!window.StatsTracker)try{window.StatsTracker=e("./StatsTracker")}catch(t){console.warn("[StatsLoader] Failed to load StatsTracker:",t)}if(!window.EquipmentEncoder)try{window.EquipmentEncoder=e("../utils/EquipmentEncoder")}catch(t){console.warn("[StatsLoader] Failed to load EquipmentEncoder:",t)}if(!window.StatsStorage)try{window.StatsStorage=e("./StatsStorage")}catch(t){console.warn("[StatsLoader] Failed to load StatsStorage:",t)}}return{tracker:!!window.StatsTracker,encoder:!!window.EquipmentEncoder,storage:!!window.StatsStorage}}}}),cc._RF.pop()},{"../utils/EquipmentEncoder":"EquipmentEncoder","./StatsStorage":"StatsStorage","./StatsTracker":"StatsTracker"}],StatsStorage:[function(e,t){"use strict";cc._RF.push(t,"9964cmw+01EibcWfbqRD5pJ","StatsStorage"),window.StatsStorage={STORAGE_KEY:"epic_idle_war_stats",HISTORY_KEY:"epic_idle_war_stats_history",CUMULATIVE_KEY:"epic_idle_war_stats_cumulative",MAX_HISTORY_SIZE:10,saveStats:function(e){if(e)try{e.timestamp=Date.now(),this.saveToHistory(e),this.updateCumulativeStats(e),cc.sys.localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),console.log("[StatsStorage] Statistics saved successfully")}catch(t){console.warn("[StatsStorage] Failed to save statistics:",t)}},saveToHistory:function(e){try{var t=cc.sys.localStorage.getItem(this.HISTORY_KEY),i=t?JSON.parse(t):[];i.unshift(e),i.length>this.MAX_HISTORY_SIZE&&(i=i.slice(0,this.MAX_HISTORY_SIZE)),cc.sys.localStorage.setItem(this.HISTORY_KEY,JSON.stringify(i))}catch(a){console.warn("[StatsStorage] Failed to save to history:",a)}},updateCumulativeStats:function(e){try{var t=cc.sys.localStorage.getItem(this.CUMULATIVE_KEY),i=t?JSON.parse(t):this.initCumulativeStats();if(e.damageByWeapon)for(var a in e.damageByWeapon)i.damageByWeapon[a]||(i.damageByWeapon[a]=0),i.damageByWeapon[a]+=e.damageByWeapon[a];e.recovery&&(i.recovery.hp+=e.recovery.hp||0,i.recovery.armor+=e.recovery.armor||0),i.gamesPlayed++,i.lastUpdated=Date.now(),cc.sys.localStorage.setItem(this.CUMULATIVE_KEY,JSON.stringify(i))}catch(n){console.warn("[StatsStorage] Failed to update cumulative stats:",n)}},initCumulativeStats:function(){return{gamesPlayed:0,damageByWeapon:{sniper:0,machinegun:0,firethrower:0,mortar:0,armor:0,heal:0,bouncingball:0,cannon:0,laser:0,tesla:0,flyshield:0,fueltank:0,energybarrier:0},recovery:{hp:0,armor:0},firstPlayed:Date.now(),lastUpdated:Date.now()}},loadStats:function(){try{var e=cc.sys.localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch(t){return console.warn("[StatsStorage] Failed to load statistics:",t),null}},loadHistory:function(){try{var e=cc.sys.localStorage.getItem(this.HISTORY_KEY);return e?JSON.parse(e):[]}catch(t){return console.warn("[StatsStorage] Failed to load history:",t),[]}},loadCumulative:function(){try{var e=cc.sys.localStorage.getItem(this.CUMULATIVE_KEY);return e?JSON.parse(e):this.initCumulativeStats()}catch(t){return console.warn("[StatsStorage] Failed to load cumulative stats:",t),this.initCumulativeStats()}},clearAllStats:function(){try{cc.sys.localStorage.removeItem(this.STORAGE_KEY),cc.sys.localStorage.removeItem(this.HISTORY_KEY),cc.sys.localStorage.removeItem(this.CUMULATIVE_KEY),console.log("[StatsStorage] All statistics cleared")}catch(e){console.warn("[StatsStorage] Failed to clear statistics:",e)}},getStatsSummary:function(){var e=this.loadCumulative(),t=this.loadHistory();return{gamesPlayed:e.gamesPlayed,totalDamage:this.calculateTotalDamage(e.damageByWeapon),totalRecovery:e.recovery.hp+e.recovery.armor,recentGames:t.length,averageDamage:e.gamesPlayed>0?this.calculateTotalDamage(e.damageByWeapon)/e.gamesPlayed:0}},calculateTotalDamage:function(e){var t=0;for(var i in e)t+=e[i]||0;return t}},cc.sys&&console.log("[StatsStorage] Statistics storage system initialized"),cc._RF.pop()},{}],StatsTracker:[function(e,t){"use strict";cc._RF.push(t,"18ebdo6lJ1FtamH+zwI+1an","StatsTracker"),window.StatsTracker={sessionStats:null,initSession:function(){this.sessionStats={damageByWeapon:{sniper:0,machinegun:0,firethrower:0,mortar:0,armor:0,heal:0,bouncingball:0,cannon:0,laser:0,tesla:0,flyshield:0,fueltank:0,energybarrier:0},recovery:{hp:0,armor:0},startTime:Date.now(),endTime:null,enemiesKilled:0,goldEarned:0,expGained:0,equipment:[],equipmentEncoded:""},console.log("[StatsTracker] Session initialized at "+new Date(this.sessionStats.startTime).toISOString())},trackDamage:function(e,t){if(this.sessionStats||(console.warn("[StatsTracker] Session not initialized, initializing now"),this.initSession()),"number"!=typeof t||t<0)console.warn("[StatsTracker] Invalid damage amount:",t);else{var i=this.mapWeaponType(e);this.sessionStats.damageByWeapon.hasOwnProperty(i)&&(this.sessionStats.damageByWeapon[i]+=t)}},trackHPRecovery:function(e){this.sessionStats||this.initSession(),"number"==typeof e&&e>0&&(this.sessionStats.recovery.hp+=e)},trackArmorRecovery:function(e){this.sessionStats||this.initSession(),"number"==typeof e&&e>0&&(this.sessionStats.recovery.armor+=e)},trackEnemyKill:function(){this.sessionStats||this.initSession(),this.sessionStats.enemiesKilled++},trackGoldEarned:function(e){this.sessionStats||this.initSession(),"number"==typeof e&&e>0&&(this.sessionStats.goldEarned+=e)},trackExpGained:function(e){this.sessionStats||this.initSession(),"number"==typeof e&&e>0&&(this.sessionStats.expGained+=e)},setEquipmentConfiguration:function(e,t){this.sessionStats||this.initSession(),this.sessionStats.equipment=e||[],this.sessionStats.equipmentEncoded=t||""},mapWeaponType:function(e){if(null==e)return console.warn("[StatsTracker] Null/undefined weapon type"),null;if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)return console.warn("[StatsTracker] Invalid weapon type:",e,"type:",typeof e),null;var t=e.replace(/\d+$/,"").toLowerCase();return{arm:"armor",armor:"armor",heal:"heal",fuel:"fueltank",fueltank:"fueltank",matrix:"energybarrier",energybarrier:"energybarrier",energybarrier_:"energybarrier",laser:"laser",tesla:"tesla",mortar:"mortar",cannon:"cannon",fly_shield:"flyshield",flyshield:"flyshield",machine_gun:"machinegun",machinegun:"machinegun",fire_thrower:"firethrower",firethrower:"firethrower",sniper:"sniper",bouncing_ball:"bouncingball",bouncingball:"bouncingball",fla:"firethrower",magun:"machinegun",roc:"mortar",can:"cannon",snip:"sniper",ball:"bouncingball",arrow:"flyshield"}[t]||t},getGameOverSummary:function(){if(!this.sessionStats)return console.warn("[StatsTracker] No session data available"),null;this.sessionStats.endTime=Date.now();var e=(this.sessionStats.endTime-this.sessionStats.startTime)/1e3,t=0;for(var i in this.sessionStats.damageByWeapon)t+=this.sessionStats.damageByWeapon[i];return{time_played:Math.round(e),equipment:this.sessionStats.equipmentEncoded,dmg_sniper:Math.round(10*this.sessionStats.damageByWeapon.sniper)/10,dmg_machinegun:Math.round(10*this.sessionStats.damageByWeapon.machinegun)/10,dmg_firethrower:Math.round(10*this.sessionStats.damageByWeapon.firethrower)/10,dmg_mortar:Math.round(10*this.sessionStats.damageByWeapon.mortar)/10,dmg_bouncingball:Math.round(10*this.sessionStats.damageByWeapon.bouncingball)/10,dmg_cannon:Math.round(10*this.sessionStats.damageByWeapon.cannon)/10,dmg_laser:Math.round(10*this.sessionStats.damageByWeapon.laser)/10,dmg_tesla:Math.round(10*this.sessionStats.damageByWeapon.tesla)/10,dmg_flyshield:Math.round(10*this.sessionStats.damageByWeapon.flyshield)/10,total_damage:Math.round(10*t)/10,hprecovery:Math.round(10*this.sessionStats.recovery.hp)/10,armorrecovery:Math.round(10*this.sessionStats.recovery.armor)/10,total_recovery:Math.round(10*(this.sessionStats.recovery.hp+this.sessionStats.recovery.armor))/10,enemies_killed:this.sessionStats.enemiesKilled,gold_earned:this.sessionStats.goldEarned,exp_gained:this.sessionStats.expGained}},resetSession:function(){this.sessionStats=null,console.log("[StatsTracker] Session reset")},getCurrentStats:function(){return this.sessionStats},getSessionStats:function(){return this.sessionStats?{damageByWeapon:this.sessionStats.damageByWeapon,recovery:this.sessionStats.recovery,equipmentEncoded:this.sessionStats.equipmentEncoded,equipmentRaw:this.sessionStats.equipment,startTime:this.sessionStats.startTime,endTime:Date.now(),timePlayed:(Date.now()-this.sessionStats.startTime)/1e3,enemiesKilled:this.sessionStats.enemiesKilled,goldEarned:this.sessionStats.goldEarned,expGained:this.sessionStats.expGained}:(console.warn("[StatsTracker] No session data available"),null)},isActive:function(){return null!==this.sessionStats}},void 0!==t&&t.exports&&(t.exports=StatsTracker),cc._RF.pop()},{}],StunBuff:[function(e,t){"use strict";cc._RF.push(t,"69082C+63dLWqNS1BxtMtWb","StunBuff"),cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){var e=this.obj;for(var t in e.setFlag(NO_ATTACK,!0),e.setFlag(NO_MOVE,!0),e.setFlag(NO_ROTATE,!0),e.setFlag(NO_SKILLS,!0),e.skills)e.skills[t].interrupt();e.avatar.refresh(.01,!0,!0)},end:function(){var e=this.obj;e.setFlag(NO_ATTACK,!1),e.setFlag(NO_MOVE,!1),e.setFlag(NO_ROTATE,!1),e.setFlag(NO_SKILLS,!1)}}),cc._RF.pop()},{"./Buff":"Buff"}],SubArrow:[function(e,t){"use strict";cc._RF.push(t,"2ca926t0y5HxKG0CUQATTHG","SubArrow"),cc.Class({extends:e("./Bullet"),onHit:function(e,t){if(e!=this.config.ignoreObject)return this._super(e,t)}}),cc._RF.pop()},{"./Bullet":"Bullet"}],SummonBuff:[function(e,t){"use strict";cc._RF.push(t,"0c16aBQaUtJX5mG42ylCHql","SummonBuff");var i=e("../../../entities/projectiles/Bullet");cc.Class({extends:e("./Buff"),cover:function(){},begin:function(){if(this.summonTimer=this.define.dt,this.deg=this.define.deg||0,this.define.rocketOffset){var e=0,t=this.obj.buffTable;for(var i in t)t[i].rocketOffset&&e++;this.rocketOffset=this.define.rocketOffset,this.deg=this.rocketOffset*e}this.dx=this.define.dx||0,this.dy=this.define.dy||0,this.atkSeq=this.define.atkSeq,this.atkSeq&&(this.atkIndex=0,this.atkTimer=this.atkSeq[this.atkIndex].t)},update:function(e){if(!this.obj.getFlag(NO_ATTACK))return this.atkSeq?(this.atkTimer-=e,void(this.atkTimer<=0&&(null!=this.atkSeq[this.atkIndex].blt&&this.attack(),this.atkIndex++,this.atkIndex>this.atkSeq.length-1&&(this.atkIndex=0),this.atkTimer=this.atkSeq[this.atkIndex].t))):void(this.summonTimer>0&&(this.summonTimer-=e,this.summonTimer<=0&&(this.summonTimer=this.define.dt,this.attack())))},attack:function(){var e=this.obj,t=this.define.summon;if("entity"==t.type);else{var a=t;(a.shot||i.shot)(this.game,a,{obj:e,x:e.x+this.dx,y:e.y+this.dy,deg:e.deg+this.deg,team:e.team,dmg:this.define.bltDmg})}},end:function(){}}),cc._RF.pop()},{"../../../entities/projectiles/Bullet":"Bullet","./Buff":"Buff"}],SweepMenu:[function(e,t){"use strict";cc._RF.push(t,"a87083fQgpKRaFlSXaPm1zL","SweepMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{titleLabel:cc.Label,timeLabel:cc.Label,layoutNode:cc.Node,itemPrefab:cc.Prefab,itemNode:cc.Node,startBoard:cc.Node,energyLabel:cc.Label,sweepPriceLabel:cc.Label,sweepNode:cc.Node,normalNode:cc.Node,startBtnNode:cc.Node,workBoard:cc.Node,progressLabel:cc.Label,progressSprite:cc.Sprite,quickBtnSprite:cc.Sprite,lootBoard:cc.Node},initStatus:function(e){var t=e.chapterIndex,i=CHAPTER_DEFINE_ARRAY[t],a=i.stage.length;this.time=1800*a,this.titleLabel.string=i.indexName+" "+i.name,this.timeLabel.string=kit.second2hour(this.time);var n=i.item;for(var o in n)this.addItem(n[o]);t>1&&(this.addItem({i:"blueprint",n:2}),this.addItem({i:"blueprint",n:2}),this.addItem({i:EXP,n:10*a})),this.initUI(),user.getGuide("sweep")||(this.guideMode=!0,menuManager.focusOn(this.startBtnNode,"",function(){user.setGuide("sweep",1)}))},addItem:function(e){var t=cc.instantiate(this.itemNode);this.layoutNode.addChild(t);var i=cc.instantiate(this.itemPrefab);t.addChild(i,-1),t.itemNode=i,i.getComponent("Item").init(e),t.itemCfg=e},initUI:function(){this.node.stopAllActions();var e=this.args.chapterIndex,t=task.getChapterSweepStatus(e),i=task.getChapterSweepTime(e)<=0;this.startBoard.active=!t,this.workBoard.active=!i&&t,this.lootBoard.active=i&&t,t?i?this.initLootBoard():this.initWorkBoard():this.initStartBoard()},initLootBoard:function(){},initStartBoard:function(){var e=this.args.chapterIndex,t=1,i=CHAPTER_DEFINE_ARRAY[e].energy;this.guideMode&&(i=0,t=0),this.energyLabel.string=i;var a=money.getNum(SWEEP_TICKET);a>=t?(this.sweepNode.active=!0,this.normalNode.active=!1,this.sweepPriceLabel.string=a+" / "+t):(this.sweepNode.active=!1,this.normalNode.active=!0),this.startBtnNode.getChildByName("rp").active=a>=t||money.had(ENERGY,i)},initWorkBoard:function(){var e=this,t=this.args.chapterIndex,i=(CHAPTER_DEFINE_ARRAY[t],this.time),a=function(){var a=task.getChapterSweepTime(t);e.progressSprite.fillRange=1-a/i/1e3,e.progressLabel.string=kit.second2date(a/1e3),a<=0&&e.initUI()};a(),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){a()},this)).repeatForever());var n=task.getChapterSweepStatus(t);this.setGray(this.quickBtnSprite,1!=n)},getItems:function(){var e=this.args.chapterIndex,t=CHAPTER_DEFINE_ARRAY[e],i=t.stage.length,a=[].concat(t.item);if(e>1){for(var n=[BLUEPRINT_ATK,BLUEPRINT_HP,BLUEPRINT_SKILL],o=0;o<2;o++){var r=n.splice(kit.rndInt(0,n.length-1),1)[0];a.push(getRndItem({i:r,n:2}))}a.push({i:EXP,n:10*i})}return a},onSweep:function(e){var t=this,a=this.args.chapterIndex,n=CHAPTER_DEFINE_ARRAY[a].energy;if(this.guideMode&&(n=0),!money.check(ENERGY,n)){var o,r,s=this.getItems(),c=1;this.guideMode&&(c=0),money.getNum(SWEEP_TICKET)>=c?net.updateData({price:{i:ENERGY,n:n},min:(o={},o[SWEEP_TICKET]=c,o),add:(r={},r[SWEEP_TICKET]=-c,r),items:s},function(a,o){a||(t.guideMode=!1,i.FirebaseTracking.setDataBiRes("SweepTicket"),money.update(o),cc.game.emit("use_money",{pos:e.target.convertToWorldSpaceAR(cc.v2(0,0)),tid:"adventure_sweep",i:ENERGY,n:n}),menuManager.pop("loot",{items:s,tid:"x2_complete",tname:"\u5238\u626b\u8361",videoItems:s,lootCb:function(){}}),t.initUI())}):net.updateData({price:{i:ENERGY,n:n},sweep:{index:a,status:1,time:1e3*this.time}},function(o,r){o||(t.guideMode=!1,i.FirebaseTracking.setDataBiRes("Sweep"),money.update(r),task.setChapterSweepData(a,r.sweep),cc.game.emit("use_money",{pos:e.target.convertToWorldSpaceAR(cc.v2(0,0)),tid:"adventure_sweep",i:ENERGY,n:n}),t.initUI())})}},onQuick:function(){var e=this,t=this.args.chapterIndex;1==task.getChapterSweepStatus(t)?sdk.useFree("x2_sweep",function(i){if(!i){var a=task.getChapterSweepTime(t);a-=1e3*e.time/2,DEV_MODE&&DEBUG_MODE&&(a=1e4),net.updateData({sweep:{index:t,status:2,time:a}},function(i,a){i||(task.setChapterSweepData(t,a.sweep),e.initUI())})}}):kit.info("\u5df2\u7ecf\u52a0\u901f\u8fc7\u4e86")},onLoot:function(){var e=this,t=this.args.chapterIndex,a=(CHAPTER_DEFINE_ARRAY[t],this.getItems());net.updateData({sweep:{index:t,status:0},items:a},function(n,o){n||(i.FirebaseTracking.setDataBiRes("Sweep_onLoot"),money.update(o),task.setChapterSweepData(t,o.sweep),menuManager.pop("loot",{items:a,tid:"adventure_sweep",tname:"\u5238\u626b\u8361",videoItems:a,lootCb:function(){}}),e.initUI())})}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],SwitchButton:[function(e,t){"use strict";cc._RF.push(t,"7058fGtlWpFLp6kEbfYty0I","SwitchButton"),cc.Class({extends:cc.Component,properties:{bg:cc.Node,ball:cc.Node,label:cc.Label,value:"BGM_VOLUME"},onLoad:function(){this.refresh(window[this.value]),this.node.on("click",this.onSwitch,this)},start:function(){},onSwitch:function(){var e;window[this.value]=!window[this.value],e=window[this.value]?1:0,storage.set(this.value,e),this.refresh(window[this.value]),"BGM_VOLUME"==this.value?window[this.value]?menuManager.resumeBgm():menuManager.stopBgm():"SE_VOLUME"==this.value?window[this.value]||cc.audioEngine.stopAllEffects():"PERSONAL_ADS"==this.value&&window.nativeSdk&&nativeSdk.blockPersonalizedAds&&nativeSdk.blockPersonalizedAds(!PERSONAL_ADS)},refresh:function(e){if(this.ball&&this.bg&&this.label)this.ball.x=e?25:-25,this.ball.color=e?cc.color(255,255,255):cc.color(235,53,83),this.label.string=LI(e?"on":"off"),this.label.node.x=e?-20:20,this.label.node.color=e?cc.color(255,255,255):cc.color(235,53,83);else{var t=this.node.getChildByName("ON"),i=this.node.getChildByName("OFF");e?(t.active=!0,i.active=!1):(t.active=!1,i.active=!0)}}}),cc._RF.pop()},{}],Sync:[function(e,t){"use strict";cc._RF.push(t,"226ee8uKitJTLknFxujrjfD","Sync"),cc.Class({init:function(e,t){this.game=e,this.index=0,this.replayData=!!t,this.status={},this.actionList=t||[]},save:function(){this.game,this.replayData},onEnter:function(){this.game.start()},onExit:function(){this.save()},getCrc:function(){for(var e=0,t=this.game.levelMgr.entityList,i=0;i<t.length;i++){var a=t[i];e^=a.x+a.y+a.hp}return e},getTable:function(e){var t=this.status,i=t[e];return i||((i={})[SIGN_INDEX]=e,t[e]=i),i},sendButtonStatus:function(e,t,i){var a=this.getTable(e);i==BTN_UP&&a[t]==BTN_DOWN?a[t]=BTN_CLICK:a[t]=i},sendSkill:function(e,t,i){this.sendButtonStatus(e,SIGN_SKILLS[t],i)},sendMove:function(e,t){this.getTable(e)[SIGN_MOVE]=[t]},sendAttack:function(e,t,i,a){this.getTable(e)[SIGN_ATTACK]=[t,i,a]},sendChange:function(e,t){this.getTable(e)[SIGN_CHANGE]=t},insertActions:function(){var e=[];for(var t in this.status){var i=this.status[t];if(i){var a={};a[SIGN_INDEX]=i[SIGN_INDEX],a[SIGN_CHANGE]=i[SIGN_CHANGE],a[SIGN_MOVE]=i[SIGN_MOVE],a[SIGN_ATTACK]=i[SIGN_ATTACK],a[SIGN_SKILLS[0]]=i[SIGN_SKILLS[0]],a[SIGN_SKILLS[1]]=i[SIGN_SKILLS[1]],a[SIGN_SKILLS[2]]=i[SIGN_SKILLS[2]],a[SIGN_SKILLS[3]]=i[SIGN_SKILLS[3]],e.push(a)}}this.status={},this.actionList.push(e)},applyActions:function(e,t){var i;void 0!==(i=t[SIGN_CHANGE])&&e.callChange(i),(i=t[SIGN_ATTACK])&&e.callAim(i[0],i[1],i[2]);for(var a=0;a<4;a++)(i=t[SIGN_SKILLS[a]])&&e.callSkill(a,i)},update:function(){},updateLogic:function(){var e=this.game,t=e.step,i=c_floor(t/STEP_RATE);if(t%STEP_RATE==0){this.replayData||this.insertActions();var a=this.actionList[i],n=0;if(!a)return!0;for(;n<a.length;){var o=a[n];if(n+=1,o[SIGN_INDEX]){var r=e.levelMgr.getObject(o[SIGN_INDEX]);r&&this.applyActions(r,o)}}}}}),cc._RF.pop()},{}],TJ:[function(e,t){"use strict";cc._RF.push(t,"00de1tRrNhMxaFuQQlvgBj+","TJ"),e("./setting"),window.TJ={onAdEvent:function(e,t){t.type,t.pos},onGuideEvent:function(e){e.guide_id,e.guide_name},onEvent:function(e,t){console.log("onEvent",e,t),window.nativeSdk&&nativeSdk.onEvent&&nativeSdk.onEvent(e,JSON.stringify(t))},mp:function(){},mpVideo:function(){},updateHeader:function(){}},window.YMTJ_VERSION=MAJOR_VERSION+"."+MINOR_VERSION+"."+REVISION_VERSION;var i={0:"userA",1:"userB"};window.GetABTestStr=function(){return null!=user.abTestIndex&&i[user.abTestIndex]||"userC"},window.YMTJ=function(e,t,i){var a,n,o=GetABTestStr();TJ.onEvent(e,((a={group:o,tjVersion:user.tjVersion})[t]=1,a.ecpm=i,a)),window.sfData&&(sfData.trackEvent(e,o,t),console.log("SFTJ",e,user.tjVersion+"_"+t)),t&&"string"==typeof t&&((n={})[o]=user.tjVersion+"_"+t,t=n),console.log("YMTJ",user.abTestIndex,o,e,t);var r=sdk.pt();if(r&&r.uma&&(r.uma.trackEvent(e,t),console.log("YMTJ",e,t)),user.tjMsg&&BUILD_VERSION>=user.tjMsg){var s="\u4e8b\u4ef6id:"+e+"\n\u4e8b\u4ef6\u53c2\u6570:"+(t&&JSON.stringify(t)||"\u65e0");kit.info(s,null,2)}},cc._RF.pop()},{"./setting":"setting"}],TalentDefine:[function(e,t){"use strict";cc._RF.push(t,"493623nNZ9LCaosBkFYkR8Y","TalentDefine");var i=e("../components/combat/buffs/Buff");e("../data/constants/GameConstants"),e("../components/visual/ArmatureAvatar"),e("../entities/projectiles/PowerBullet"),e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),window.loadTalentDefine=function(){for(var t in window.TalentDefine={vehicle_fire_distance:{unique:"vehicle_fire_distance",rarity:2,equipment:1,template:{id:"blt",bltMul:{distance:1.1,spd:1.1},unitType:"fire_thrower"},content:"\u55b7\u706b\u5668/\u706b\u7130\u8ddd\u79bb"},vehicle_atkSpd:{title:"\u706b\u8f66\u653b\u901f",unique:"vehicle_atkSpd",rarity:1,equipment:1,template:{id:"attribute",attr:"atkSpd",num:.05},templateFunc:function(e,t){e.num=+t.num}},backpack_init_equipment:{title:"\u521d\u59cb\u88c5\u5907",unique:"backpack_init_equipment",rarity:1,equipment:1,backpackInit:function(e,t){var i=t.num;e.pushItem(i)}},backpack_init_rarity1:{title:"\u521d\u59cb\u62bd\u53d62\u7ea7\u88c5\u5907\u6982\u7387\u589e\u52a0",unique:"backpack_init_equipment",rarity:1,equipment:1,backpackInit:function(e,t){e.bonusRarity1=e.bonusRarity1||0,e.bonusRarity1+=t.num}},backpack_init_refresh_bonus:{title:"\u521d\u59cb\u6709\u989d\u5916\u4e00\u6b21\u514d\u8d39\u5237\u65b0",unique:"backpack_init_refresh_bonus",rarity:1,equipment:1,backpackInit:function(e){e.freeDrawCt++}},moneypack:{title:"\u88c5\u5907\u7ed9\u94b1",unique:"moneypack",rarity:1,equipment:1,endgame:function(e,t){var i,a;null!=(i=chapter)&&null!=(a=i.data)&&a.gold&&(chapter.data.gold+=t.num||0)},des:"\u6bcf\u56de\u5408\u7ed9\u83b7\u5f97\u91d1\u5e01",content:"\u5229\u606f"},armor:{title:"\u88c5\u5907\u56de\u7532",unique:"armor",rarity:1,equipment:1,template:{id:"buff",buff:{symbol:"armorPack",ctor:e("../components/combat/buffs/BigShieldBuff"),recoverFix:1,stayOnBroken:1},unitType:"hero"},templateFunc:function(e,t){e.buff.recoverFix=t.num}},heal:{title:"\u88c5\u5907\u56de\u8840",unique:"heal",rarity:1,equipment:1,template:{id:"buff",buff:{symbol:"healPack",ctor:e("../components/combat/buffs/RecoverBuff"),hp:3},unitType:"hero"},templateFunc:function(e,t){e.buff.hp=t.num}},hp:{title:"\u88c5\u5907\u751f\u547d",unique:"hp",rarity:1,equipment:1,template:{id:"attribute",attr:"hpMax",add:1,num:.2},templateFunc:function(e,t){e.num=t.num}},atk:{title:"\u88c5\u5907\u653b\u51fb",unique:"atk",rarity:1,equipment:1,template:{id:"attribute",attr:"bltDmg",add:1,num:.2,self:1},template2:{id:"attribute",attr:"bombDmg",add:1,num:.2,self:1},templateFunc:function(e,t){e.num=t.num},templateFunc2:function(e,t){e.num=t.num}},atkScale_vehicle:{title:"\u6218\u8f66\u653b\u51fb",unique:"atk",rarity:1,equipment:1,template:{id:"attribute",attr:"bltDmg",add:1,num:.2,unitType:"hero"},template2:{id:"attribute",attr:"bombDmg",add:1,num:.2,unitType:"hero"},templateFunc:function(e,t){e.num=t.num},templateFunc2:function(e,t){e.num=t.num}},atkScale_1:{title:"\u4f24\u5bb3lv1",unique:"atkScale_1",rarity:1,template:{id:"attribute",attr:"atkScale",num:.05,unitType:"hero"},des:LI("tco_26"),content:"\u6240\u6709\u6b66\u5668"},atkScale_2:{title:"\u4f24\u5bb3lv2",unique:"atkScale_2",rarity:2,template:{id:"attribute",attr:"atkScale",num:.1,unitType:"hero"},des:LI("tco_27"),content:"\u6240\u6709\u6b66\u5668"},atkScale_3:{title:"\u4f24\u5bb3lv3",unique:"atkScale_3",rarity:3,template:{id:"attribute",attr:"atkScale",num:.15,unitType:"hero"},des:LI("tco_28"),content:"\u6240\u6709\u6b66\u5668"},atkSpd_1:{title:"\u901f\u5ea6lv1",unique:"atkSpd_1",rarity:1,template:{id:"attribute",attr:"atkSpd",num:.05},des:LI("tco_1"),content:"\u653b\u901f"},atkSpd_2:{title:"\u901f\u5ea6lv2",unique:"atkSpd_2",rarity:2,template:{id:"attribute",attr:"atkSpd",num:.1},des:LI("tco_2"),content:"\u653b\u901f"},atkSpd_3:{title:"\u901f\u5ea6lv3",unique:"atkSpd_3",rarity:3,template:{id:"attribute",attr:"atkSpd",num:.15},des:LI("tco_3"),content:"\u653b\u901f"},hp_1:{title:"\u8840\u91cflv1",unique:"hp_1",rarity:1,template:{id:"attribute",attr:"hpMax",num:.05},des:LI("tco_4"),content:"\u6240\u6709\u9632\u5177"},hp_2:{title:"\u8840\u91cflv2",unique:"hp_2",rarity:2,template:{id:"attribute",attr:"hpMax",num:.1},des:LI("tco_5"),content:"\u6240\u6709\u9632\u5177"},hp_3:{title:"\u8840\u91cflv3",unique:"hp_3",rarity:3,template:{id:"attribute",attr:"hpMax",num:.15},des:LI("tco_6"),content:"\u6240\u6709\u9632\u5177"},atk_scale_with_backpack:{title:"atk_scale_with_backpack",unique:"atk_scale_with_backpack",rarity:3,template:{id:"attribute",num:1,attr:"atkScale"},templateFunc:function(e){var t,i,a=0;if(null!=(t=chapter)&&null!=(i=t.data)&&i.backpack){var n=chapter.data.backpack;for(var o in n.blockItemData)n.blockItemData[o].pos&&(a+=1)}e.num=.02*a},des:LI("tco_39"),content:"\u7edf\u5e05\u624b\u5957"},upgrade_random_item:{title:"upgrade_random_item",unique:"upgrade_random_item",rarity:3,effect:function(e){var t,i;if(null!=(t=chapter)&&null!=(i=t.data)&&i.backpack){var a=chapter.data.backpack,n=[];for(var o in a.blockItemData){var r=a.blockItemData[o];(u=BackpackItemDefine[r.id].upgrade)&&r.pos&&n.push(r)}if(n.length){var s=n[kit.rndInt(0,n.length-1)],c=e.game.levelMgr.heroes[1];if(c){var l=c.towers;for(var o in l){var d,h;if((h=null==(d=l[o].config.slot)?void 0:d.backpack)&&JSON.stringify(h)==JSON.stringify(s)){var u=BackpackItemDefine[s.id].upgrade;s.id=u;var p=BackpackItemDefine[u].unitID;c.changeTower(o,p)}}}}}},des:LI("tco_38"),content:"\u953b\u9020"},backpack_refresh_bonus:{title:"\u6bcf\u56de\u5408\u9996\u6b21\u5237\u65b0\u989d\u5916\u4e00\u4ef6\u88c5\u5907",unique:"backpack_refresh_bonus",rarity:2,backpack:function(e){e.bonusRefreshItem1++},des:LI("tco_15"),content:"\u5237\u65b0\u52a0\u4e00"},atk2Boss_1:{title:"atk2Boss_1",unique:"atk2Boss_1",rarity:1,template:{id:"attribute",attr:"atk2Boss",add:1,num:.25,unitType:"hero"},des:LI("tco_16"),content:"\u5bf9BOSS"},atk2Boss_2:{title:"atk2Boss_2",unique:"atk2Boss_2",rarity:2,template:{id:"attribute",attr:"atk2Boss",add:1,num:.5,unitType:"hero"},des:LI("tco_17"),content:"\u5bf9BOSS"},atk2Boss_3:{title:"atk2Boss_3",unique:"atk2Boss_3",rarity:3,template:{id:"attribute",attr:"atk2Boss",add:1,num:1,unitType:"hero"},des:LI("tco_18"),content:"\u5bf9BOSS"},interest_1:{title:"\u5229\u606flv1",unique:"interest_1",rarity:1,effect:function(){var e=Math.floor(.05*chapter.data.gold);e>30&&(e=30),chapter.data.gold+=e},des:LI("tco_21"),content:"\u5229\u606f"},interest_2:{title:"\u5229\u606flv2",unique:"interest_2",rarity:2,effect:function(){var e=Math.floor(.1*chapter.data.gold);e>30&&(e=30),chapter.data.gold+=e},des:LI("tco_22"),content:"\u5229\u606f"},interest_3:{title:"\u5229\u606flv3",unique:"interest_3",rarity:3,effect:function(){var e=Math.floor(.15*chapter.data.gold);e>30&&(e=30),chapter.data.gold+=e},des:LI("tco_23"),content:"\u5229\u606f"},money_1:{title:"\u94b1lv1",unique:"money_1",rarity:1,effect:function(){chapter.data.gold+=10},des:LI("tco_11"),content:"\u7acb\u5373\u91d1\u5e01"},money_2:{title:"\u94b1lv2",unique:"money_2",rarity:2,effect:function(){chapter.data.gold+=30},des:LI("tco_12"),content:"\u7acb\u5373\u91d1\u5e01"},money_3:{title:"\u94b1lv3",unique:"money_3",rarity:3,effect:function(){chapter.data.gold+=50},des:LI("tco_13"),content:"\u7acb\u5373\u91d1\u5e01"},moneypack_1:{title:"\u7ed9\u94b1lv1",unique:"moneypack_1",rarity:2,endgame:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.gold&&(chapter.data.gold+=5)},des:LI("tco_33"),content:"\u5229\u606f"},moneypack_2:{title:"\u7ed9\u94b1lv2",unique:"moneypack_2",rarity:3,endgame:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.gold&&(chapter.data.gold+=10)},des:LI("tco_34"),content:"\u5229\u606f"},atkSpd_from_armor_1:{title:"\u624b\u5957lv1",unique:"atkSpd_from_armor_1",rarity:2,template:{id:"attribute",attr:"atkSpd",num:.2,suround:["armor",2],tag:"physics"},des:LI("tco_31"),content:"\u5de5\u5177\u7bb1/\u76f8\u90bb\u653b\u901f20",needEquip:"armor"},atkSpd_from_armor_2:{title:"\u624b\u5957lv2",unique:"atkSpd_from_armor_2",rarity:3,template:{id:"attribute",attr:"atkSpd",num:.3,suround:["armor",2],tag:"physics"},des:LI("tco_32"),content:"\u5de5\u5177\u7bb1/\u76f8\u90bb\u653b\u901f30",needEquip:"armor"},exp_1:{title:"\u7ecf\u9a8clv1",unique:"exp_1",rarity:1,endgame:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.expScale&&(chapter.data.expScale+=.1)},des:LI("tco_8"),content:"\u7ecf\u9a8c\u4e66"},exp_2:{title:"\u7ecf\u9a8clv2",unique:"exp_2",rarity:2,endgame:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.expScale&&(chapter.data.expScale+=.2)},des:LI("tco_9"),content:"\u7ecf\u9a8c\u4e66"},exp_3:{title:"\u7ecf\u9a8clv3",unique:"exp_3",rarity:3,endgame:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.expScale&&(chapter.data.expScale+=.3)},des:LI("tco_10"),content:"\u7ecf\u9a8c\u4e66"},machine_gun_stack_atk:{rarity:2,unique:"machine_gun_stack_atk",template:{id:"buff",buff:{ctor:e("./AddBuffOnShot"),shotBuff:{symbol:i.getSymbol(),ctor:e("../components/combat/buffs/StackBuff"),stack:3,attr:[[ADD_SCALE,"atkScale",.1]],t:1}},unitType:"machine_gun"},des:LI("tco_51"),content:"\u673a\u67aa/\u673a\u67aa\u53e0\u52a0",needEquip:"machine_gun"},machine_gun_atkSpd:{unique:"machine_gun_atkSpd",rarity:3,template:{id:"attribute",attr:"atkSpd",num:.3,unitType:"machine_gun"},des:LI("tco_40"),content:"\u673a\u67aa/\u673a\u67aa\u653b\u901f",needEquip:"machine_gun"},machine_gun_critChance:{unique:"machine_gun_crit",rarity:2,template:{id:"attribute",attr:"critChance",num:.5,add:1,unitType:"machine_gun"},des:LI("tco_52"),content:"\u673a\u67aa/\u673a\u67aa\u66b4\u51fb",needEquip:"machine_gun"},machine_gun_critBonus:{unique:"machine_gun_critBonus",rarity:1,template:{id:"attribute",attr:"critBonus",num:.3,unitType:"machine_gun"},des:LI("tco_68"),content:"\u673a\u67aa/\u673a\u67aa\u7206\u4f24",needEquip:"machine_gun"},armor_atkSpd:{unique:"armor_atkSpd",rarity:2,template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"armor"},des:LI("tco_53"),content:"\u5de5\u5177\u7bb1/\u62a4\u76fe\u6062\u590d\u901f\u5ea6",needEquip:"armor"},armor_atkScale:{unique:"armor_atkScale",rarity:1,template:{id:"attribute",attr:"atkScale",num:.2,unitType:"armor"},des:LI("tco_69"),content:"\u5de5\u5177\u7bb1/\u6062\u590d\u62a4\u7532\u91cf",needEquip:"armor"},sniper_chain:{unique:"rifleman_chain",rarity:2,template:{id:"blt",bltAdd:{chain:1},unitType:"sniper"},des:LI("tco_29"),content:"\u5c0f\u5175/\u5f39\u5c04",needEquip:"sniper"},sniper_atkScale:{unique:"sniper_atkScale",rarity:2,template:{id:"attribute",attr:"atkScale",num:.25,unitType:"sniper"},des:LI("tco_54"),content:"\u5c0f\u5175/\u653b\u51fb\u529b",needEquip:"sniper"},sniper_crit:{unique:"sniper_atkScale",rarity:1,template:{id:"attribute",attr:"critChance",num:.25,add:1,unitType:"sniper"},des:LI("tco_70"),content:"\u5c0f\u5175/\u66b4\u51fb\u73871",needEquip:"sniper"},sniper_blt_n:{unique:"sniper_blt_n",rarity:3,template:{id:"blt",bltAdd:{n:1,d:.5},unitType:"sniper"},des:LI("tco_41"),content:"\u5c0f\u5175/\u5b50\u5f39\u6570+1",needEquip:"sniper"},cannon_crit:{unique:"cannon_crit",rarity:1,template:{id:"attribute",attr:"critChance",num:.5,add:1,unitType:"cannon"},des:LI("tco_71"),content:"\u706b\u70ae/\u66b4\u51fb\u7387",needEquip:"cannon"},cannon_blt_n:{unique:"cannon_blt_n",rarity:3,template:{id:"blt",bltAdd:{n:1,d:.5},unitType:"cannon"},des:LI("tco_42"),content:"\u706b\u70ae/\u70ae\u5f39X2",needEquip:"cannon"},cannon_atkScale:{unique:"cannon_atkScale",rarity:2,template:{id:"attribute",attr:"atkScale",num:.5,add:1,unitType:"cannon"},des:LI("tco_55"),content:"\u706b\u70ae/\u653b\u51fbUP",needEquip:"cannon"},cannon_blastRadius:{unique:"cannon_blastRadius",rarity:1,template:{id:"blt",bltMul:{bomb:{r0:1.3,r1:1.3}},unitType:"cannon"},des:LI("tco_72"),content:"\u706b\u70ae/\u534a\u5f84",needEquip:"cannon"},fire_atkScale:{unique:"fire_atkScale",rarity:2,template:{id:"attribute",attr:"atkScale",num:1,unitType:"fire_thrower"},des:LI("tco_14"),content:"\u55b7\u706b\u5668/\u706b\u7130\u4f24\u5bb3",needEquip:"fire_thrower"},fire_atkSpd:{unique:"fire_atkSpd",rarity:1,template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"fire_thrower"},des:LI("tco_73"),content:"\u55b7\u706b\u5668/\u706b\u7130\u653b\u901f",needEquip:"fire_thrower"},fire_distance:{unique:"fire_distance",rarity:2,template:{id:"blt",bltMul:{distance:1.3,spd:1.3},unitType:"fire_thrower"},des:LI("tco_56"),content:"\u55b7\u706b\u5668/\u706b\u7130\u8ddd\u79bb",needEquip:"fire_thrower"},fire_3x:{unique:"fire_3x",rarity:3,template:{id:"blt",bltAdd:{n:2,wd:1,d:40},unitType:"fire_thrower"},des:LI("tco_43"),content:"\u55b7\u706b\u5668/\u4e09\u53c9\u706b\u7130",needEquip:"fire_thrower"},mortar_crit:{unique:"mortar_crit",rarity:2,template:{id:"buff",buff:{ctor:e("../components/combat/buffs/BltPerShotBuff"),symbol:"mortar_crit",nShot:3,stat:{critChance:1}},unitType:"mortar"},des:LI("tco_7"),content:"\u5bfc\u5f39/\u7b2c\u4e09\u8f6e\u7206\u70b8",needEquip:"mortar"},mortar_crit2:{unique:"mortar_crit2",rarity:1,template:{id:"buff",buff:{ctor:e("../components/combat/buffs/BltPerShotBuff"),symbol:"mortar_crit",nShot:-1},unitType:"mortar"},talentNeed:"mortar_crit",des:LI("tco_74"),content:"\u5bfc\u5f39/\u56fa\u5b9a\u66b4\u51fb\u6b21\u6570-1",needEquip:"mortar"},mortar_atkScale2:{unique:"mortar_atkScale2",rarity:2,template:{id:"attribute",attr:"atkScale",num:.5,unitType:"mortar"},des:LI("tco_57"),content:"\u5bfc\u5f39/\u5bfc\u5f39\u4f24\u5bb3\u63d0\u5347",needEquip:"mortar"},mortar_atkScale:{unique:"mortar_atkScale",rarity:3,template:{id:"attribute",attr:"critBonus",num:1.5,unitType:"mortar"},des:LI("tco_44"),content:"\u5bfc\u5f39/\u5bfc\u5f39\u66b4\u51fb\u4f24\u5bb3+150%",needEquip:"mortar"},atk_from_heal_1:{unique:"atk_from_heal_1",rarity:2,template:{id:"attribute",attr:"atkScale",num:.2,suround:["heal",2],tag:"energy"},des:LI("tco_19"),content:"\u71c3\u6c14\u7f50/\u71c3\u6c14\u7f50",needEquip:"heal"},atk_from_heal_2:{unique:"atk_from_heal_2",rarity:3,template:{id:"attribute",attr:"atkScale",num:.3,suround:["heal",2],tag:"energy"},des:LI("tco_20"),content:"\u71c3\u6c14\u7f50/\u5143\u7d20\u6b66\u5668UP2",needEquip:"heal"},heal_atkSpd:{unique:"heal_atkSpd",rarity:2,template:{id:"attribute",attr:"atkSpd",num:.2,unitType:"heal"},des:LI("tco_58"),content:"\u71c3\u6c14\u7f50/\u56de\u8840\u901f\u5ea6",needEquip:"heal"},heal_atkScale:{unique:"heal_atkScale",rarity:1,template:{id:"attribute",attr:"atkScale",num:.2,unitType:"heal"},des:LI("tco_75"),content:"\u71c3\u6c14\u7f50/\u56de\u8840",needEquip:"heal"},bouncing_ball_more_hit:{unique:"bouncing_ball_more_hit",rarity:2,template:{id:"buff",buff:{ctor:e("../components/combat/buffs/BltPerShotBuff"),symbol:"bouncing_ball_more_hit",nShot:3,stat:{n:2,d:10}},unitType:"bouncing_ball"},des:LI("tco_62"),content:"\u94c1\u7403/\u6b21\u6570+1",needEquip:"bouncing_ball"},bouncing_ball_more_jump:{unique:"bouncing_ball_more_jump",rarity:1,template:{id:"blt",bltAdd:{jump:2},unitType:"bouncing_ball"},des:LI("tco_77"),content:"\u94c1\u7403/\u5f39\u8df3\u6b21\u6570",needEquip:"bouncing_ball"},bouncing_atkScale:{unique:"bouncing_atkScale",rarity:3,template:{id:"attribute",attr:"atkScale",num:.2,unitType:"bouncing_ball"},des:LI("tco_47"),content:"\u94c1\u7403/\u653b\u51fb\u529bUP",needEquip:"bouncing_ball"},bouncing_double_shot:{unique:"bouncing_double_shot",rarity:2,template:{id:"blt",bltAdd:{n:1,d:.5},unitType:"bouncing_ball"},des:LI("tco_63"),content:"\u94c1\u7403/\u653b\u51fb\u8fde\u51fb",needEquip:"bouncing_ball"},tesla_chain:{unique:"tesla_chain",rarity:2,template:{id:"blt",bltAdd:{chain:1},unitType:"tesla"},des:LI("tco_30"),content:"\u7535\u5854/\u5f39\u5c04+1",needEquip:"tesla"},tesla_stun:{unique:"tesla_stun",rarity:3,template:{id:"blt",bltAdd:{buff:{noBoss:1,ctor:e("../components/combat/buffs/StunBuff"),symbol:e("../components/combat/buffs/Buff").getSymbol(),t:.5}},unitType:"tesla"},des:LI("tco_46"),content:"\u7535\u5854/\u9ebb\u75f9",needEquip:"tesla"},tesla_vulnerable:{unique:"tesla_vulnerable",rarity:2,template:{id:"blt",bltAdd:{buff:{attr:[[MUT_SCALE,"fireHurtScale",1.2]],symbol:e("../components/combat/buffs/Buff").getSymbol(),t:.3}},unitType:"tesla"},talentNeed:"tesla_stun",des:LI("tco_61"),content:"\u7535\u5854/\u611f\u7535",needEquip:"tesla"},tesla_more_target:{unique:"tesla_more_target",rarity:1,template:{id:"blt",bltAdd:{hitCt:1},unitType:"tesla"},des:LI("tco_76"),content:"\u7535\u5854/\u76ee\u6807+1",needEquip:"tesla"},fly_shield_kb:{unique:"fly_shield_kb",rarity:1,template:{id:"blt",bltAdd:{kb:.05},unitType:"fly_shield"},des:LI("tco_24"),content:"\u5f13\u7bad/\u51fb\u9000",needEquip:"fly_shield"},fly_shield_range:{unique:"fly_shield_kb",rarity:2,template:{id:"blt",bltMul:{radius:1.25},unitType:"fly_shield"},des:LI("tco_64"),content:"\u5f13\u7bad/\u6269\u5927\u8303\u56f4",needEquip:"fly_shield"},fly_shield_vulnerable:{unique:"fly_shield_vulnerable",rarity:3,template:{id:"blt",bltAdd:{buff:{attr:[[MUT_SCALE,"bltHurtScale",1.2]],symbol:e("../components/combat/buffs/Buff").getSymbol(),t:1.5}},unitType:"fly_shield"},des:LI("tco_48"),content:"\u5f13\u7bad/\u91cd\u4f24",needEquip:"fly_shield"},fly_shield_morecrit:{unique:"fly_shield_unknown2",rarity:2,template:{id:"blt",bltAdd:{buff:{attr:[[ADD,"critSuffer",.6]],symbol:e("../components/combat/buffs/Buff").getSymbol(),t:2}},unitType:"fly_shield"},talentNeed:"fly_shield_vulnerable",des:LI("tco_65"),content:"\u5f13\u7bad/\u7834\u4f24\u98ce",needEquip:"fly_shield"},laser_atkSpd:{unique:"laser_atkSpd",rarity:1,template:{id:"attribute",attr:"atkSpd",num:1.15,unitType:"laser"},des:LI("tco_25"),content:"\u6fc0\u5149\u70ae/CD",needEquip:"laser"},laser_atkScale:{unique:"laser_atkScale",rarity:2,template:{id:"attribute",attr:"atkScale",num:1.15,unitType:"laser"},des:LI("tco_59"),content:"\u6fc0\u5149\u70ae/\u653b\u51fbUP",needEquip:"laser"},laser_radius:{unique:"laser_radius",rarity:2,template:{id:"blt",bltMul:{radius:1.2},unitType:"laser"},des:LI("tco_60"),content:"\u6fc0\u5149\u70ae/\u6fc0\u5149\u8303\u56f4",needEquip:"laser"},laser_slow:{unique:"laser_slow",rarity:3,template:{id:"blt",bltAdd:{buff:{t:1,symbol:i.getSymbol(),noBoss:1,attr:[[MUT_SCALE,"moveSpd",.75]]}},unitType:"laser"},des:LI("tco_45"),content:"\u6fc0\u5149\u70ae/\u5149\u654f\u6027\u969c\u788d",needEquip:"laser"},fuelTank_hpBonus:{unique:"fuelTank_hpBonus",rarity:1,template:{id:"attribute",attr:"hpMax",num:100,add:1},templateFunc:function(e){var t,i,a,n=0;if(a=null==(t=chapter)?void 0:null==(i=t.data)?void 0:i.backpack,cc.log("fuelTank_hpBonus",a),a){for(var o in a.blockItemData){var r=a.blockItemData[o],s=BackpackItemDefine[r.id];if(r.pos&&"fuelTank"==s.type){var c=equipment.getStats(s.type);if(c&&c.hp&&TalentDefine.hp){var l=c.hp*Math.pow(1.5,s.rarity);cc.log("fuelTank_hpBonus\u88c5\u5165\u88c5\u5907\u5916\u90e8\u6570\u503c",l),n+=l}s.talent&&"object"==typeof s.talent&&(cc.log("fuelTank_hpBonus\u88c5\u5165\u88c5\u5907\u672c\u8eab\u6570\u503c",s.talent.num),n+=s.talent.num)}}cc.log("fuelTank_hpBonus\u8ba1\u7b97fuelTank\u6240\u83b7\u5f97\u7684\u603b\u751f\u547d\u503c",n),e.num=.2*n}},des:LI("tco_78"),content:"\u6cb9\u7bb1/\u8840\u91cfUP",needEquip:"fuelTank"},fuelTank_healBonus:{unique:"fuelTank_healBonus",rarity:2,template:{id:"attribute",attr:"atkScale",num:.2,unitType:"fuelTank"},des:LI("tco_66"),content:"\u6cb9\u7bb1/\u5b50\u5f39\u6570+1",needEquip:"fuelTank"},fuelTank_quickHeal:{unique:"fuelTank_quickHeal",rarity:3,template:{id:"buff",buff:{ctor:e("../components/combat/buffs/QuickRecoverOnLowBuff"),symbol:"fuelTank_quickHeal",hpPercent:.15,buff:{t:4,attr:[[ADD_SCALE,"atkSpd",1]]}},unitType:"hero"},des:LI("tco_49"),content:"\u6cb9\u7bb1/\u7d27\u6025\u5feb\u4fee",needEquip:"fuelTank"},fuelTank_quickHeal2:{unique:"fuelTank_quickHeal2",rarity:2,template:{id:"buff",buff:{ctor:e("../components/combat/buffs/QuickRecoverOnLowBuff"),hpPercent:.15,buff:{t:4,attr:[[ADD_SCALE,"atkSpd",111]]},symbol:"fuelTank_quickHeal"},unitType:"hero"},des:LI("tco_67"),content:"\u6cb9\u7bb1/\u5feb\u4fee\u6548\u679c",talentNeed:"fuelTank_quickHeal",needEquip:"fuelTank"},energyBarrier_dmg:{unique:"energyBarrier_dmg",rarity:2,template:{id:"unitFunc",func:function(e){e.bltContactEnabled=!0,e.empowerBlt=!0},unitType:"energyBarrier"},des:LI("tco_81"),content:"\u5c4f\u969c/\u589e\u4f24",needEquip:"energyBarrier"},energyBarrier_duplicate:{unique:"energyBarrier_duplicate",rarity:2,template:{id:"unitFunc",func:function(e){e.bltContactEnabled=!0,e.duplicateBlt=!0,cc.log("TalentDefine energyBarrier_duplicate func",e)},unitType:"energyBarrier"},des:LI("tco_79"),content:"\u5c4f\u969c/\u5206\u88c2",needEquip:"energyBarrier"},energyBarrier_affectMultiple:{unique:"energyBarrier_affectMultiple",rarity:3,template:{id:"unitFunc",func:function(e){e.bltContactEnabled=!0,e.affectMultiple=!0},unitType:"energyBarrier"},des:LI("tco_82"),content:"\u5c4f\u969c/\u53e0\u52a0",needEquip:"energyBarrier"},energyBarrier_atkScale:{unique:"energyBarrier_atkScale",rarity:1,template:{id:"attribute",attr:"atkScale",num:.2,unitType:"armor"},des:LI("tco_80"),content:"\u5c4f\u969c/\u62a4\u7532\u6062\u590d\u91cf",needEquip:"armor"}},window.TalentPool={},TalentDefine)TalentDefine[t].id=t,TalentDefine[t].hide||TalentDefine[t].equipment||(window.TalentPool[t]=TalentDefine[t]),null==TalentDefine[t].rarity&&(TalentDefine[t].rarity=1);window.InfinitePool={},window.TalentConfig={lvlUpRange:[1,4],lvlUpBonus:{5:[1,1,1],10:[2,2,2]},adBonus:[1,0,0],rarity:{1:{rollPower:700},2:{rollPower:120},3:{rollPower:20},4:{rollPower:10}},relic:{1:{n:1,rollPower:[1e3,120,0,0]},2:{n:2,rollPower:[1e3,170,14,0]},3:{n:3,rollPower:[500,100,20,10]},4:{n:3,rollPower:[500,100,50,30]}}};var a=function(e,t){if(!t||t.constructor!=Array)return e==t;for(var i in t)if(t[i]==e)return!0},n=function(e,t){var i;return i=e.define.unitType?e.define.unitType:e.define.hero?"hero":"unit",e.unitType&&(i=e.unitType),cc.log("typeEqual",i,t),i==t};window.TalentTemplateDefine={buff:{effect:function(e,t,i){var o=(i=i||this.template).buff;if(cc.log("TalentTemplateDefine buff effect 1",o,i),i.self)return t.unitId=e.define.unitId,void(e.heroUnit&&e.heroUnit.addBuff(e,o,{}));cc.log("TalentTemplateDefine buff effect 2",o,i);for(var r=e.game.getEntityList(),s=0;s<r.length;s++){var c=r[s];!c.isInBorder()||c.isDead()||1===c.team||i.unitId&&!a(c.define.id,i.unitId)||i.unitType&&!n(c,i.unitType)||c.addBuff(e,o,{})}},unitSpawnEffect:function(e,t,i){i=i||this.template;var o=t.unitId||i.unitId;if(cc.log("TalentTemplateDefine buff unitSpawnEffect 1",i,e.define.id,o,a(e.define.id,o)),!(o&&!a(e.define.id,o)||i.unitType&&!n(e,i.unitType))){var r=i.buff;cc.log("TalentTemplateDefine buff unitSpawnEffect 2",e.define.id,o),e.addBuff(e,r,{})}}},bulletOnShot:{effect:function(t,o,r){r=r||this.template;var s={ctor:e("../components/combat/buffs/BulletOnShot"),symbol:i.getSymbol(),attackSequence:r.attackSequence,blt:r.blt,attackCtNeed:r.attackCtNeed,dmg:r.dmg,bltDmgK:r.bltDmgK};if(cc.log("bulletOnShot buff def",s),r.self)return o.unitId=t.define.unitId,void(t.heroUnit&&t.heroUnit.addBuff(t,s,{}));for(var c=t.game.getEntityList(),l=0;l<c.length;l++){var d=c[l];!d.isInBorder()||d.isDead()||1===d.team||r.unitId&&!a(d.define.id,r.unitId)||r.unitType&&!n(d,r.unitType)||d.addBuff(t,s,{})}},unitSpawnEffect:function(t,o,r){r=r||this.template;var s=o.unitId||r.unitId;if(!(s&&!a(t.define.id,s)||r.unitType&&!n(t,r.unitType))){var c={ctor:e("../components/combat/buffs/BulletOnShot"),symbol:i.getSymbol(),attackSequence:r.attackSequence,blt:r.blt,attackCtNeed:r.attackCtNeed,dmg:r.dmg,bltDmgK:r.bltDmgK};t.addBuff(t,c,{})}}},attribute:{effect:function(e,t,a){a=a||this.template;var n={ctor:i,symbol:i.getSymbol(),cond:a.cond,attr:[[a.mul&&MUT_SCALE||a.add&&ADD||ADD_SCALE,a.attr,a.num]],effect:a.effect,effectCfg:a.effectCfg};a.attr2&&a.num2&&n.attr.push([a.mul2&&MUT_SCALE||a.add2&&ADD||ADD_SCALE,a.attr2,a.num2]);for(var o=e.game.getEntityList(),r=0;r<o.length;r++){var s=o[r];if("hpMax"==a.attr){var c=s.hpMax;this.unitSpawnEffect(s,t,a),s.hp+=s.hpMax-c}else this.unitSpawnEffect(s,t,a)}},unitSpawnEffect:function(e,t,o){var r=(o=o||this.template).num;if(o.reviveStack&&(t.reviveCt=t.reviveCt||0,t.reviveCt++,t.reviveCt>o.reviveStack&&(t.reviveCt=o.reviveStack),r*=t.reviveCt),o.self){var s,c;c=null==(s=e.config.slot)?void 0:s.backpack;var l=t.backpack;if(l&&(!c||JSON.stringify(c)!=JSON.stringify(l)))return}var d=t.unitId||o.unitId;if(!(d&&!a(e.define.id,d)||o.unitType&&!n(e,o.unitType))){if(null!=t.team){if(cc.log("TalentDefine attribute unitSpawnEffect saveData team",t.team),e.team!=t.team)return}else if(1==e.team)return;if(o.suround){if(!e.config.slot||!e.getBase)return;cc.log("\u53d1\u73b0\u5929\u8d4b\u4e3a\u5149\u73af\u5929\u8d4b id backpack suround",e.define.id,e.config.slot.backpack,o.suround);var h=e.getBase().config.towers,u=0;for(var p in h){var f=h[p].backpack;BackpackItemDefine[f.id].type==o.suround[0]&&(f.pos,cc.log("\u53d1\u73b0\u80cc\u5305\u4e2d\u5149\u73af\u7269\u54c1\uff0c\u5f00\u59cb\u83b7\u5f97\u8ddd\u79bb",f,e.config.slot.backpack,get2ItemDistance(f,e.config.slot.backpack)),get2ItemDistance(f,e.config.slot.backpack)<o.suround[1]&&(cc.log("\u5355\u4f4d\u8ddd\u79bb\u5904\u4e8e\u5149\u73af\u4e4b\u4e2d\uff0c\u68c0\u67e5\u5149\u73af\u662f\u5426\u4e3a\u6709tag\u6761\u4ef6\u5e76\u4e14\u5355\u4f4d\u62e5\u6709\u8be5tag",o.tag,checkItemTag(e.config.slot.backpack,o.tag)),o.tag&&!checkItemTag(e.config.slot.backpack,o.tag)||(u++,cc.log("\u7b26\u5408\u6761\u4ef6\uff0c\u6b63\u5f0f\u52a0\u6210\u8be5\u5149\u73af\u7269\u54c1\u589e\u76ca\u6570\u503c\u548c\u53d1\u73b0\u5149\u73af\u7269\u54c1\u6570",r,u))))}if(cc.log("\u80cc\u5305\u91cc\u53d1\u73b0\u5bf9\u81ea\u5df1\u751f\u6548\u5149\u73af\u7269\u54c1\u6570\u91cf",u,e.define.id,e.config.slot.backpack),0==u)return;r*=u}if(cc.log("talent template attribute \u5f71\u54cd",e.define.id,r),!(o.armorType&&e.armorType!=o.armorType||1==o.fly&&!e.isFly()||-1==o.fly&&e.isFly())){var m={ctor:i,symbol:i.getSymbol(),attr:[[o.mul&&MUT_SCALE||o.add&&ADD||ADD_SCALE,o.attr,r]],effect:o.effect,effectCfg:o.effectCfg};o.attr2&&o.num2&&m.attr.push([o.mul2&&MUT_SCALE||o.add2&&ADD||ADD_SCALE,o.attr2,o.num2]),e.addBuff(e,m,{})}}}},card:{effect:function(e,t,i){i=i||this.template,e.game;var a=e.game.layer.bottomUI;if(cc.log("card talent obj",e),i.cardId){var n=a.getCard(i.cardId);if(n&&(i.attr&&(i.add?n.attribute.add(i.attr,i.num):i.mul?n.attribute.mutScale(i.attr,i.num):n.attribute.addScale(i.attr,i.num)),i.val))for(var o in i.val)"skillBuff"==o?n[o]?n[o].push(i.val[o]):n[o]=[i.val[o]]:n[o]=i.val[o]}else if(i.cardType){var r=a.getCardsList();for(var s in r){if("hero"==i.cardType&&r[s].hero&&(i.attr&&(i.add?r[s].attribute.add(i.attr,i.num):i.mul?r[s].attribute.mutScale(i.attr,i.num):r[s].attribute.addScale(i.attr,i.num)),i.val))for(var o in i.val)"skillBuff"==o?r[s][o]?r[s][o].push(i.val[o]):r[s][o]=[i.val[o]]:r[s][o]=i.val[o];if("unit"==i.cardType&&!r[s].hero&&(i.attr&&(i.add?r[s].attribute.add(i.attr,i.num):i.mul?r[s].attribute.mutScale(i.attr,i.num):r[s].attribute.addScale(i.attr,i.num)),i.val))for(var o in i.val)"skillBuff"==o?r[s][o]?r[s][o].push(i.val[o]):r[s][o]=[i.val[o]]:r[s][o]=i.val[o]}}}},ult:{effect:function(e,t,i){i=i||this.template,cc.log("talent template ult",i);var a=kit.clone(e.skillCfg),n=kit.clone(i.ult),o=i.ultAdd,r=i.ultMul;a=kit.mergeObjs2(n,a),a=kit.addObjs(a,o),a=kit.mulObjs(a,r),cc.log("talentDefine skillCfg changed",a,e),e.skillCfg=a}},ai:{effect:function(e,t,i){if((i=i||this.template).self){if(t.unitId=e.define.unitId,e.heroUnit){var o=e.heroUnit,r=kit.clone(i.ai);if(r=kit.mergeObjs2(r,o.define.pilot),i.aiAdd&&(r=kit.addObjs(r,i.aiAdd),i.aiAdd.attackRange&&r.attackRange.constructor==Array))for(var s in r.attackRange)r.attackRange[s]+=i.aiAdd.attackRange;if(i.aiMul&&(r=kit.mulObjs(r,i.aiMul),i.aiMul.attackRange&&r.attackRange.constructor==Array))for(var s in r.attackRange)r.attackRange[s]*=i.aiMul.attackRange;var c=o.pilot;c&&(c.initAI(!0,r,!0),o.avatar&&(o.avatar.setForcedAnime(),o.avatar.setWalkAnime(),o.avatar.refresh()))}}else for(var l=e.game.getEntityList(),d=0;d<l.length;d++){var h=l[d];if(!(!h.isInBorder()||h.isDead()||1===h.team||i.unitId&&!a(h.define.id,i.unitId)||i.unitType&&!n(h,i.unitType)||i.armorType&&h.armorType!=i.armorType)){if(cc.log("aiCfg",h.define.pilot),r=kit.clone(i.ai),r=kit.mergeObjs2(r,h.define.pilot),i.aiAdd&&(r=kit.addObjs(r,i.aiAdd),i.aiAdd.attackRange&&r.attackRange.constructor==Array))for(var u in cc.log("aiCfg aiAdd found and attackRange",r,i.aiAdd.attackRange),r.attackRange)r.attackRange[u]+=i.aiAdd.attackRange;if(i.aiMul&&(r=kit.mulObjs(r,i.aiMul),i.aiMul.attackRange&&r.attackRange.constructor==Array))for(var u in r.attackRange)r.attackRange[u]*=i.aiMul.attackRange;cc.log("changed aiCfg",r);var p=h.pilot;p&&(p.initAI(!0,r,!0),h.avatar&&(h.avatar.setForcedAnime(),h.avatar.setWalkAnime(),h.avatar.refresh()))}}},unitSpawnEffect:function(e,t,i){i=i||this.template;var o=t.unitId||i.unitId;if(!(o&&!a(e.define.id,o)||i.unitType&&!n(e,i.unitType)||i.armorType&&e.armorType!=i.armorType)){cc.log("aiCfg",e.define.pilot);var r=kit.clone(i.ai);if(r=kit.mergeObjs2(r,e.define.pilot),i.aiAdd&&(r=kit.addObjs(r,i.aiAdd),i.aiAdd.attackRange&&r.attackRange.constructor==Array))for(var s in r.attackRange)r.attackRange[s]+=i.aiAdd.attackRange;if(i.aiMul&&(r=kit.mulObjs(r,i.aiMul),i.aiMul.attackRange&&r.attackRange.constructor==Array))for(var s in r.attackRange)r.attackRange[s]*=i.aiMul.attackRange;cc.log("changed aiCfg",r);var c=e.pilot;c&&(c.initAI(!0,r,!0),e.avatar&&(e.avatar.setForcedAnime(),e.avatar.setWalkAnime(),e.avatar.refresh()))}}},blt:{effect:function(e,t,i){if(i=i||this.template,cc.log("TalentDefine blt effect",i),i.self){if(t.unitId=e.define.unitId,e.heroUnit){var o=kit.clone(e.heroUnit.blt),r=i.bltAdd,s=i.bltMul;for(var c in o)if(!i.index||c==i.index-1){var l=kit.clone(i.blt);o[c]=kit.mergeObjs2(l,o[c]),o[c]=kit.addObjs(o[c],r),o[c]=kit.mulObjs(o[c],s)}e.heroUnit.blt=o}}else for(var d=e.game.getEntityList(),h=0;h<d.length;h++){var u=d[h];if(!(!u.isInBorder()||u.isDead()||1===u.team||i.unitId&&!a(u.define.id,i.unitId)||i.unitType&&!n(u,i.unitType))){for(var c in o=kit.clone(u.blt),r=i.bltAdd,s=i.bltMul,o)i.index&&c!=i.index-1||(l=kit.clone(i.blt),o[c]=kit.mergeObjs2(l,o[c]),o[c]=kit.addObjs(o[c],r),o[c]=kit.mulObjs(o[c],s));u.blt=o}}},unitSpawnEffect:function(e,t,i){i=i||this.template,cc.log("TalentDefine blt unitSpawnEffect",i);var o=t.unitId||i.unitId;if(!(o&&!a(e.define.id,o)||i.unitType&&!n(e,i.unitType))){var r=kit.clone(e.blt),s=i.bltAdd,c=i.bltMul,l=kit.clone(i.blt);for(var d in cc.log("blt change before",r,i),r)i.index&&d!=i.index-1||(l=kit.clone(i.blt),r[d]=kit.mergeObjs2(l,r[d]),r[d]=kit.addObjs(r[d],s),r[d]=kit.mulObjs(r[d],c));cc.warn("blt change after:template & currentBlt",i,r),e.blt=r}}},attackSequence:{effect:function(e,t,i){if((i=i||this.template).index||i.seq)if(i.self){if(t.unitId=e.define.unitId,e.heroUnit){e.heroUnit.setAttackSequence(i.index,i.seq),e.heroUnit.attackIndex=0;var o=e.heroUnit.attackSequence[0];e.heroUnit.attackTimer=o.t}}else for(var r=e.game.getEntityList(),s=0;s<r.length;s++){var c=r[s];!c.isInBorder()||c.isDead()||1===c.team||i.unitId&&!a(c.define.id,i.unitId)||i.unitType&&!n(c,i.unitType)||(c.setAttackSequence(i.index,i.seq),c.attackIndex=0,o=c.attackSequence[0],c.attackTimer=o.t)}else cc.log("talentDefine attackSequence\u7f3a\u5c11index\u548cseq",i)},unitSpawnEffect:function(e,t,i){i=i||this.template;var o=t.unitId||i.unitId;if(i.index||i.seq){if(!(o&&!a(e.define.id,o)||i.unitType&&!n(e,i.unitType))){e.setAttackSequence(i.index,i.seq),e.attackIndex=0;var r=e.attackSequence[0];e.attackTimer=r.t}}else cc.log("talentDefine attackSequence\u7f3a\u5c11index\u548cseq",i)}},luckyUnit:{effect:function(e,t,i){i=i||this.template;var o=e.game.layer.bottomUI;cc.log("TalentDefine luckyUnit",i);var r=o.luckyUnit;for(var s in r){r[s];var c=ENTITY[s];i.unitId&&!a(s,i.unitId)||i.unitType&&!n({define:c},i.unitType)||i.armorType&&c.armorType!=i.armorType||1==i.fly&&!c.fly||-1==i.fly&&c.fly||o.addLuckyUnit(s,{power:i.power,chance:i.chance})}}},avatar:{effect:function(e,t,i){var o;i=i||this.template;var r=e.game.layer.bottomUI;if(cc.log("talentDefine avatar",i),i.cardId){if(e=r.getCard(i.cardId),cc.log("talentDefine avatar card",i.cardId,e),!e)return;e.unitAvatarDefine=i.avatar,o=e.define.unitId}else o=i.unitId;for(var s=e.game.getEntityList(),c=0;c<s.length;c++){var l,d,h=s[c];cc.log("test talent avatar",h.define.id,o,a(h.define.id,o)),!h.isInBorder()||h.isDead()||1===h.team||o&&!a(h.define.id,o)||i.unitType&&!n(h,i.unitType)||null!=(l=h.avatar)&&l.changeDisplay&&(null==(d=h.avatar)||d.changeDisplay(i.avatar))}}},unitFunc:{effect:function(e,t,i){i=i||this.template;for(var a=e.game.getEntityList(),n=0;n<a.length;n++){var o=a[n];this.unitSpawnEffect(o,t,i)}},unitSpawnEffect:function(e,t,i){cc.log("talent template unitFunc unitSpawnEffect",i);var o=(i=i||this.template).num;if(i.reviveStack&&(t.reviveCt=t.reviveCt||0,t.reviveCt++,t.reviveCt>i.reviveStack&&(t.reviveCt=i.reviveStack),o*=t.reviveCt),i.self){var r,s;s=null==(r=e.config.slot)?void 0:r.backpack;var c=t.backpack;if(c&&(!s||JSON.stringify(s)!=JSON.stringify(c)))return}var l=t.unitId||i.unitId;if(!(l&&!a(e.define.id,l)||i.unitType&&!n(e,i.unitType))){if(null!=t.team){if(cc.log("TalentDefine attribute unitSpawnEffect saveData team",t.team),e.team!=t.team)return}else if(1==e.team)return;if(i.suround){if(!e.config.slot||!e.getBase)return;cc.log("\u53d1\u73b0\u5929\u8d4b\u4e3a\u5149\u73af\u5929\u8d4b id backpack suround",e.define.id,e.config.slot.backpack,i.suround);var d=e.getBase().config.towers,h=0;for(var u in d){var p=d[u].backpack;BackpackItemDefine[p.id].type==i.suround[0]&&(p.pos,cc.log("\u53d1\u73b0\u80cc\u5305\u4e2d\u5149\u73af\u7269\u54c1\uff0c\u5f00\u59cb\u83b7\u5f97\u8ddd\u79bb",p,e.config.slot.backpack,get2ItemDistance(p,e.config.slot.backpack)),get2ItemDistance(p,e.config.slot.backpack)<i.suround[1]&&(cc.log("\u5355\u4f4d\u8ddd\u79bb\u5904\u4e8e\u5149\u73af\u4e4b\u4e2d\uff0c\u68c0\u67e5\u5149\u73af\u662f\u5426\u4e3a\u6709tag\u6761\u4ef6\u5e76\u4e14\u5355\u4f4d\u62e5\u6709\u8be5tag",i.tag,checkItemTag(e.config.slot.backpack,i.tag)),i.tag&&!checkItemTag(e.config.slot.backpack,i.tag)||(h++,cc.log("\u7b26\u5408\u6761\u4ef6\uff0c\u6b63\u5f0f\u52a0\u6210\u8be5\u5149\u73af\u7269\u54c1\u589e\u76ca\u6570\u503c\u548c\u53d1\u73b0\u5149\u73af\u7269\u54c1\u6570",o,h))))}if(cc.log("\u80cc\u5305\u91cc\u53d1\u73b0\u5bf9\u81ea\u5df1\u751f\u6548\u5149\u73af\u7269\u54c1\u6570\u91cf",h,e.define.id,e.config.slot.backpack),0==h)return;o*=h}cc.log("talent template attribute \u5f71\u54cd",e.define.id,o),i.armorType&&e.armorType!=i.armorType||1==i.fly&&!e.isFly()||-1==i.fly&&e.isFly()||i.func(e)}}}},window.TalentDefineInit=function(){var e=function(){var e=TalentDefine[t],i=void 0,a=void 0,n=void 0,o=void 0;e.template&&(i=TalentTemplateDefine[e.template.id])&&(i.effect&&(e.effect=i.effect),i.unitSpawnEffect&&(e.unitSpawnEffect=i.unitSpawnEffect)),e.template2&&(a=TalentTemplateDefine[e.template2.id],e.template3&&(n=TalentTemplateDefine[e.template3.id]),e.template4&&(o=TalentTemplateDefine[e.template4.id]),a&&(e.effect=function(e,t){i&&i.effect&&i.effect.bind(this)(e,t),a&&a.effect&&a.effect.bind(this)(e,t,this.template2),n&&n.effect&&n.effect.bind(this)(e,t,this.template3),o&&o.effect&&o.effect.bind(this)(e,t,this.template4)},e.unitSpawnEffect=function(e,t){i&&i.unitSpawnEffect&&i.unitSpawnEffect.bind(this)(e,t),a&&a.unitSpawnEffect&&a.unitSpawnEffect.bind(this)(e,t,this.template2),n&&n.unitSpawnEffect&&n.unitSpawnEffect.bind(this)(e,t,this.template3),o&&o.unitSpawnEffect&&o.unitSpawnEffect.bind(this)(e,t,this.template4)}))};for(var t in TalentDefine)e()}},cc._RF.pop()},{"../components/combat/buffs/BigShieldBuff":"BigShieldBuff","../components/combat/buffs/BltPerShotBuff":"BltPerShotBuff","../components/combat/buffs/Buff":"Buff","../components/combat/buffs/BulletOnShot":void 0,"../components/combat/buffs/QuickRecoverOnLowBuff":"QuickRecoverOnLowBuff","../components/combat/buffs/RecoverBuff":"RecoverBuff","../components/combat/buffs/StackBuff":"StackBuff","../components/combat/buffs/StunBuff":"StunBuff","../components/visual/ArmatureAvatar":"ArmatureAvatar","../data/constants/GameConstants":"GameConstants","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/PowerBullet":"PowerBullet","./AddBuffOnShot":"AddBuffOnShot"}],TalentMenu:[function(e,t){"use strict";cc._RF.push(t,"3a78b6gnkhMYZl9qx4WEIzb","TalentMenu");var i=e("../../../Plugins/firebase/FirebaseTracking"),a=e("../../scripts/Talent");e("../../scripts/TalentDefine"),cc.Class({extends:e("../core/Menu"),properties:{cardNode:cc.Node,layoutNode:cc.Node,bgFrames:[cc.SpriteFrame],adBtn1:cc.Node,adBtn2:cc.Node},updateAdBtn:function(){this.adBtn1.getChildByName("ct").getComponent(cc.Label).string=chapter.data.changeTalentOptionsCt+"/10",this.adBtn2.getChildByName("ct").getComponent(cc.Label).string=chapter.data.selectAllTalents+"/3",this.adBtn1.active=chapter.data.changeTalentOptionsCt>0,this.adBtn2.active=chapter.data.selectAllTalents>0},initStatus:function(e,t){this.excludeObj=t||{},this.obj=e.obj,this.game=e.game,this.talent=e.talent,this.deck=e.deck,this.game.pushTimeScale(0),this.card=e.card;var i=equipment&&equipment.get("current"),n=this,o=[];cc.log("TalentMenu talentsData",this.talent);var r=a.getPool(this.talent,TalentPool,function(e){if(n.excludeObj&&n.excludeObj[e.id])return!1;var t=!0;if(i&&t&&e.needEquip){for(var o in t=!1,i)if(i[o]==e.needEquip&&equipment.isTalentOwned(i[o],e.id)){t=!0;break}if(!t)return}var r=!0;if(e.talentNeed){var s=e.talentNeed;for(var o in s.constructor!=Array&&(s=[s]),s){var c=s[o];if(c.constructor==Array){var l=!1;for(var o in c)if(a.getData(n.game.remotes.talent,c[o])){l=!0;break}if(!l){r=!1;break}}else if(!a.getData(n.game.remotes.talent,c)){r=!1;break}}}return t&&r}),s=[];o&&(s=s.concat(o),cc.log("TalentMenu fixedShow",s)),cc.log("TalentMenu options pool",r);var c=a.pickFromPool(r,3,null,[TalentDefine.atkScale_1,TalentDefine.atkSpd_1,TalentDefine.hp_1],null,function(e){var t=kit.rollWithPower([.65,.3,.05]);return e.rarity==+t+1});for(var l in s=s.concat(c),cc.log("TalentMenu pickFromPool",s),this.game.forcedTalentOptions&&(s=this.game.forcedTalentOptions,this.game.forcedTalentOptions=null),s=this.initGuide(s))this.excludeObj[s[l].id]=!0;this.game.guideTalent,this.cards=[];var d=s.length;for(d>3&&(d=3),d<1&&(this.isClosing=!0),l=0;l<d;l++){var h=cc.instantiate(this.cardNode);h.active=!0,this.initOption(h,s[l]),this.layoutNode.addChild(h),this.cards.push(h),h.scale=0,h.runAction(cc.sequence(cc.delayTime(.1*l),cc.scaleTo(.1,1.2),cc.scaleTo(.05,1)))}this.adBtn1.runAction(cc.sequence(cc.delayTime(3*.1),cc.scaleTo(.1,1.2),cc.scaleTo(.05,1))),this.adBtn2.runAction(cc.sequence(cc.delayTime(.4),cc.scaleTo(.1,1.2),cc.scaleTo(.05,1))),this.updateAdBtn()},initOption:function(e,t){e.define=TalentDefine[t.id];var i=a.getInfo(t.id);cc.log("TalentMenu initOption",t.id,e.define);var n=e.getChildByName("icon").getComponent(cc.Sprite);this.game.effectMgr.loadSprite(n,i.iconImgPath),this.game.effectMgr.loadSprite(n,i.iconImgPath),e.getChildByName("text").getComponent(cc.RichText).string="<outline color=black width=2>"+i.des+"</outline>",e.getComponent(cc.Sprite).spriteFrame=this.bgFrames[i.rarity-1]},initArmature:function(){var e=ENTITY[this.card.define.unitId].avatar2,t=e.anime||"hero_torbjorn",i=e.animeName,a=this.game.effectMgr.createArmature(t,i,function(){});a.scale=e.s||1,this.armatureNode.addChild(a)},initHead:function(){var e=pc.getHeroCard(this.card.define.id);this.game.effectMgr.loadSprite(this.headSprite,e)},checkGuide:function(){this.isGuiding&&(sdk.setFibaseEvent("tutorial",'{"step4_tutorial5":""}'),sdk.setFibaseEvent("tutorial",'{"step8_tutorial2":""}'),menuManager.focusOn(this.cards[0],LI("zc_guide_7"),null,function(){YMTJ("guide","guide007")},null,{head:"h99",dy:0,dx:-80,z:999999}))},update:function(){this.game.chapterFinish&&!this.chapterFinish&&(menuManager.close(),this.game.popTimeScale(0),this.chapterFinish=!0)},start:function(){var e=this;this.scheduleOnce(function(){e.canChoose=!0,e.isClosing&&(menuManager.close(),this.game.popTimeScale(0))},.2)},onClick:function(e){if(this.canChoose){var t=e.target,a=t.define;if(cc.log("TalentMenu onClick",e,t),i.FirebaseTracking.logNewTutorial({Step:3,userID:user.uuid,Status:1}),!a.notTalent){if(!this.game.infiniteMode){var n=a.effect,o={id:a.id};this.talent.push(o),n&&(a.templateFunc&&a.template&&a.templateFunc.bind(this)(a.template,o),a.templateFunc2&&a.template2&&a.templateFunc2.bind(this)(a.template2,o),n.bind(a)(this,o)),this.game.pickedTalent=this.game.pickedTalent||[],this.game.pickedTalent.push(o),this.game.layer.bottomUI.addTalentIcon(a,!0),this.game.infiniteMode?this.endGameInfiniteMode():(menuManager.close(),this.game.popTimeScale(0))}cc.log("talentOption onClick pickedHeroTalent",this.game.pickedHeroTalent)}}},onClickAll:function(){var e=this;sdk.useTicket("get_all_skill",function(t,i){if(!t){for(var a in chapter.data.selectAllTalents--,e.cards){var n=e.cards[a].define;if(!n.notTalent){if(!e.game.infiniteMode){var o=n.effect,r={id:n.id};e.talent.push(r),o&&o.bind(n)(e,r),e.game.pickedTalent=e.game.pickedTalent||[],e.game.pickedTalent.push(r),e.game.layer.bottomUI.addTalentIcon(n,!0)}cc.log("talentOption onClick pickedHeroTalent",e.game.pickedHeroTalent)}}e.game.infiniteMode?e.endGameInfiniteMode():(menuManager.close(),e.game.popTimeScale(0)),chapter.add("videoCt"),i&&YMTJ("video","lv_T_all")}})},changeOptions:function(){var e=this;sdk.useTicket("get_reroll_skill",function(t,i){if(!t){for(var a in e.cards)e.cards[a].destroy();chapter.data.changeTalentOptionsCt--,e.game.popTimeScale(0),e.initStatus(e.args,e.excludeObj),chapter.add("videoCt"),i&&YMTJ("video","lv_T_replace")}})},initGuide:function(e){var t=user.getGuide("talent_choose");return 0!==this.game.config.mapIndex||0!=this.game.config.chapterIndex||t||(this.isGuiding=!0,e=[TalentDefine.atkSpd_from_armor_1,TalentDefine.atkScale_1,TalentDefine.hp_1],user.setGuide("talent_choose",1)),1!==this.game.config.mapIndex||0!=this.game.config.chapterIndex||this.game.guided||(this.game.guided=!0,e=[TalentDefine.machine_gun_stack_atk,TalentDefine.sniper_chain,TalentDefine.atkSpd_3]),0!=this.game.config.chapterIndex?e:(3==chapter.get("lvl")&&(e=[TalentDefine.atkSpd_1,TalentDefine.hp_3,TalentDefine.mortar_crit]),4==chapter.get("lvl")&&(e=[TalentDefine.exp_3,TalentDefine.money_2,TalentDefine.fire_atkScale]),e)}}),cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../scripts/Talent":"Talent","../../scripts/TalentDefine":"TalentDefine","../core/Menu":"Menu"}],TalentPage:[function(e,t){"use strict";cc._RF.push(t,"278afRNpDREvJ408zPkhG/4","TalentPage");var i=e("../../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../core/Menu"),properties:{talentBgs:[cc.SpriteFrame],talentIcons:cc.SpriteAtlas,talentTabs:[cc.Node],talentNodes:[cc.Node],upgradeBoard:cc.Node,coverNodes:[cc.Node],upgradeBtnNode:cc.Node,talentBoard:cc.Node,upgradeAnime:cc.Animation},onLoad:function(){var e;this.pageIndex=0,this.talentIndexes=[0,9,18],this.upgradeBoard.active=!1,this.talentList=[];for(var t=0;t<9;t++){var i=cc.instantiate(this.talentBoard);this.talentNodes[t].addChild(i),this.talentList[t]=i}this.talentBoard.active=!1,this.topVisible=((e={})[DIAMOND]=!0,e[TALENT]=!0,e[SWEEP_TICKET]=!1,e[EXP]=!1,e[ENERGY]=!1,e)},updateRedPoint:function(){for(var e=0,t=[0,0,0],i=0;i<3;i++)for(var a=0;a<9;a++){var n=a+9*i,o=pc.getTalentLevel(n);t[i]+=o}for(var r=0;r<3;r++){for(var s=0,c=0;c<9;c++){var l=c+9*r,d=excel.read("talent_list")[l];if(!(t[r]<d.lvl)){var h=pc.getTalentLevel(l),u=h+1;h<5&&money.had(TALENT,u)&&(e++,s++)}}this.talentTabs[r].getChildByName("rp").active=this.pageIndex!=r&&s>0}for(var p=0;p<27;p++);return e},initStatus:function(){this.updateLevelSum(),this.initUI(),this.onSelectTalent(this.talentIndexes[this.pageIndex])},onToggle:function(e,t){this.pageIndex=t-1,this.updateLevelSum(),this.initUI(),this.onSelectTalent(this.talentIndexes[this.pageIndex]),this.updateRedPoint()},initUI:function(){for(var e=this.pageIndex,t=0;t<9;t++){var i=t+9*e;this.refreshTalent(i)}this.refreshRed(),this.refreshCover(this.coverNodes[0],10),this.refreshCover(this.coverNodes[1],20)},updateLevelSum:function(){for(var e=0,t=this.pageIndex,i=0;i<9;i++){var a=i+9*t;e+=pc.getTalentLevel(a)}this.lvlSum=e},refreshCover:function(e,t){var i=this.lvlSum;if(i>=t)e.active=!1;else{e.active=!0,e.getChildByName("lvl").getComponent(cc.Label).string=i+" / "+t;var a=["\u72c2\u66b4","\u9002\u5e94","\u751f\u5b58"][this.pageIndex]+"\u7b49\u7ea7";e.getChildByName("name").getComponent(cc.Label).string=a}},refreshTalent:function(e){var t=this,i=this.talentList[e%9],a=excel.read("talent_list")[e],n=pc.getTalentLevel(e);i.getChildByName("label").getComponent(cc.Label).string=n+" / 5",i.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.talentIcons.getSpriteFrame(a.icon),i.getChildByName("bg").getComponent(cc.Sprite).spriteFrame=this.talentBgs[this.pageIndex],this.setGray(i.getChildByName("icon"),0==n),i.getChildByName("icon").color=0==n?cc.color(90,90,90):cc.color(255,255,255),i.onTouch=function(){t.onSelectTalent(e,!0)},this.refreshTalentSelect(e)},refreshRed:function(){for(var e=this.pageIndex,t=0;t<9;t++){var i=t+9*e,a=excel.read("talent_list")[i],n=this.talentList[i%9];if(this.lvlSum<a.lvl)n.getChildByName("rp").active=!1;else{var o=pc.getTalentLevel(i),r=o+1,s=this.talentIndexes[this.pageIndex]==i;n.getChildByName("rp").active=!s&&o<5&&money.had(TALENT,r)}}},refreshTalentSelect:function(e,t){var i=this.talentList[e%9],a=this.talentIndexes[this.pageIndex]==e;i.getChildByName("select_anime").active=a;var n=i.getChildByName("select");t&&a?(n.active=!0,n.stopAllActions(),n.opacity=255,n.scale=1,n.runAction(cc.spawn(cc.fadeOut(.5),cc.scaleBy(.5,2)))):n.active=!1},onSelectTalent:function(e,t){var a=this,n=excel.read("talent_list")[e];if(this.lvlSum<n.lvl)kit.info(LI("unlock_0"));else{this.talentIndexes[this.pageIndex]=e,void 0!==this.selectedIndex&&this.refreshTalentSelect(this.selectedIndex),this.selectedIndex=e,this.refreshTalent(e,t),this.refreshRed();var o=pc.getTalentLevel(e),r=this.upgradeBoard;r.active=!0,r.getChildByName("lvl").getComponent(cc.Label).string=LI("lv")+" "+o,r.getChildByName("name").getComponent(cc.Label).string=n.name;var s=o;0==o?(s=1,r.getChildByName("info").opacity=50):r.getChildByName("info").opacity=255,cc.log(o,s,n["v"+s],n.attrValue,n.attrInfo);var c=kit.formatValue(n["v"+s],n.attrValue),l=n.attrInfo.replace(/\{.+?\}/g,function(){return c});r.getChildByName("info").getComponent(cc.Label).string=l;var d=o+1;r.getChildByName("num").getComponent(cc.Label).string=o>=5?LI("level_max"):d,r.scale=1,t&&(r.stopAllActions(),r.runAction(cc.sequence(cc.scaleTo(.1,1.05),cc.scaleTo(.1,1))));var h=r.getChildByName("btn"),u=o>=5||!money.had(TALENT,d);this.setGray(h,u),h.getChildByName("rp").active=!u,h.onTouch=function(){var t;o>=5?kit.info(LI("tip_max")):money.check(TALENT,d)||net.updateData({price:{i:TALENT,n:d},add:(t={},t["talentList."+e]=1,t)},function(t,n){i.FirebaseTracking.setDataBiRes("Talent_Upgrade"),money.update(n),pc.setTalentLevel(e,o+1),a.onSelectTalent(e),a.updateLevelSum(),a.refreshCover(a.coverNodes[0],10),a.refreshCover(a.coverNodes[1],20),a.refreshRed(),a.upgradeAnime.play(),cc.game.emit("use_money",{i:TALENT,n:-d,pos:h.convertToWorldSpaceAR(cc.v2(0,0)),tid:"talent_upgrade"}),task.addDailyTaskCt("talentUpgrade")})}}}}),cc._RF.pop()},{"../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../core/Menu":"Menu"}],Talent:[function(e,t){"use strict";cc._RF.push(t,"13ad9kCvjdF+4mXjfw8GMv2","Talent"),window.Talent=cc.Class({init:function(e,t){for(var i in this.game=t,this.mods={},this.updateAfterInit={},this.talentData=e,e){var a=TalentDefine[e[i].id],n=!1;a.relic&&!e[i].initRelic&&(e[i].initRelic=!0,n=!0),a.consume&&e[i].consume<=0?a.onConsumeEnd&&a.onConsumeEnd():a.effect.bind(this)(null,n)}for(var i in this.updateAfterInit)e=this.updateAfterInit[i],this.update(e,null,!1)},checkUnitSpawnEffect:function(e,t,i){for(var a in this.talentData){var n=TalentDefine[this.talentData[a].id],o=n.unitSpawnEffect;if(o){if(n.event!=t)continue;(!n.chanceObj||Math.random()<n.chanceObj)&&(n.condFuncObj&&!n.condFuncObj(this,e,i)||o.bind(n)(e,this.talentData[a]))}}},getRarityCfg:function(){return this.rarityCfg||TalentConfig.rarity},addMod:function(e,t){this.mods[e]?this.mods[e]+=t:this.mods[e]=t},effectById:function(e,t){TalentDefine[t].effect(e,"fromChoose")},getPoolById:function(e,t){var i=TalentPoolDefine[e];return console.log("getPoolById",i),this.getPool(i,t)},getPool:function(e,t,i,a){e=e||TalentPool;var n=this.talentData,o=[],r=0,s=9;if(a&&a.lvlup){var c=TalentConfig.lvlUpRange;r=c[0],s=c[1]}var l={},d={},h={},u={};for(var p in n){var f=n[p].id;l[f]||(l[f]=0),l[f]++;var m=TalentDefine[f].unique;console.log("Register unique 3-choice group",m),m&&(d[m]=!0);var g=TalentDefine[f].conditionOffer;g&&(h[g]=!0),TalentDefine[f].class&&(u[TalentDefine[f].class]=!0)}var v=Object.keys(u).length>=3;for(var p in console.log("conditionOffer",g),e){if(i){var y=!1;for(var b in i)if(i[b]==e[p].id){y=!0;break}if(y)continue}if(!t||t(TalentDefine[p])){var k=TalentDefine[p].rarity||0;if(!(k>s||k<r))if(TalentDefine[p].unique&&d[TalentDefine[p].unique])console.log("Existing unique 3-pick group",TalentDefine[p].unique,"Prevent 3-pick from appearing",p);else if(!TalentDefine[p].class||u[TalentDefine[p].class]||!v){var T;if(TalentDefine[p].conditionNeed){var _=TalentDefine[p].conditionNeed;if(_.constructor==Array){for(var p in T=!0,_)if(!h[_[p]]){T=!1;break}}else T=h[_]}else T=!0;(!l[p]||!TalentDefine[p].limit||l[p]<TalentDefine[p].limit)&&T&&o.push(e[p])}}}return o},save:function(e){if(!e.noTalent){this.talentData=this.talentData||[],this.talentData;var t={id:e.id};return this.talentData.push(t),t}},remove:function(e,t){var i=t.id,a=this.talentData;for(var n in a)if(a[n].id==i)return TalentDefine[i].remove&&TalentDefine[i].remove(e,!0),a.splice(n,1),void console.log("talent remove",i,a,e.game.gameManager.config.talent)},upgrade:function(e,t,i){i=i||1;for(var a=t,n=1;n<=i;n++){var o=t.upgrade&&TalentDefine[t.upgrade];if(!o)break;t=o}this.remove(e,a),a.remove?this.effect(e,t):Talent.save(t);var r=this.talentData;console.log("talent upgrade",a,r)},updateByUnique:function(e,t,i){var a=this.talentData;for(var n in a)if(TalentDefine[a[n].id].unique==e){var o=a[n];this.update(o,t,i)}},updateById:function(e,t,i){var a=this.talentData;for(var n in a)if(a[n].id==e){var o=a[n];this.update(o,t,i)}},update:function(e,t,i){if(i)this.updateAfterInit[e.id]=e;else{var a=TalentDefine[e.id];a.remove&&(a.remove.bind(e)(t,!0),a.effect.bind(e)(t,!0))}},getUnlockTalent:function(e,t){var i=[];for(var a in t=UnlockTalentForShowDefine[e]){console.log(e,a,t[a]);var n=TalentDefine[t[a]];n.chapter==e&&i.push({icon:"uiz/chooseBonus/icon/"+n.content,name:n.title})}return i},checkCanUpgradeBonus:function(){var e=this.talentData;for(var t in e){var i=TalentDefine[e[t].id].upgrade;if(i&&TalentDefine[i])return!0}},getData:function(e){var t=this.talentData;for(var i in t)if(t[i].id==e)return t[i]},statics:{getData:function(e,t){var i=e;for(var a in i)if(i[a].id==t)return i[a]},getPool:function(e,t,i,a,n){t=t||TalentPool;var o=e,r=[],s=0,c=9;if(n&&n.lvlup){var l=TalentConfig.lvlUpRange;s=l[0],c=l[1]}var d={},h={},u={},p={};for(var f in cc.log("Talent getPool",o),o){var m=o[f].id;d[m]||(d[m]=0),d[m]++;var g=TalentDefine[m].unique;console.log("Register unique 3-pick group",g),g&&(h[g]=!0);var v=TalentDefine[m].conditionOffer;v&&(u[v]=!0),TalentDefine[m].class&&(p[TalentDefine[m].class]=!0)}var y=Object.keys(p).length>=3;for(var f in console.log("conditionOffer",v),t){if(a){var b=!1;for(var k in a)if(a[k]==t[f].id){b=!0;break}if(b)continue}if(!i||i(TalentDefine[f])){var T=TalentDefine[f].rarity||0;if(!(T>c||T<s))if(TalentDefine[f].unique&&h[TalentDefine[f].unique])console.log("Existing unique 3-pick group",TalentDefine[f].unique,"Prevent 3-pick from appearing",f);else if(!TalentDefine[f].class||p[TalentDefine[f].class]||!y){var _;if(TalentDefine[f].conditionNeed){var w=TalentDefine[f].conditionNeed;if(w.constructor==Array){for(var f in _=!0,w)if(!u[w[f]]){_=!1;break}}else _=u[w]}else _=!0;(!d[f]||!TalentDefine[f].limit||d[f]<TalentDefine[f].limit)&&_&&r.push(t[f])}}}return r},pickFromPool:function(e,t,i,a,n,o){var r,s;kit.shuffle(e),t.constructor==Array?(r=t.length,kit.shuffle(t),s=!0):r=v=t||1,console.log("Talent pickFromPool array & options",e,t),i=i||{},n=n;for(var c=0,l=0;l<r;l++){var d=s&&t[l]+TalentConfig.lvlUpRange[0];d&&d>TalentConfig.lvlUpRange[1]&&(d=TalentConfig.lvlUpRange[1]),console.log("Talent shuffleWithBonus rarityNeed",d,l);for(var h=0+c;h<e.length;h++){var u=e[h].rarity||0,p=e[h].unique&&i[e[h].unique]||e[h].show1&&i[e[h].show1],f=n&&n[e[h].id];if((!o||(g=o(e[h])))&&!(null!=d&&u!=d||p||f)){console.log("Talent rarityNeed find",h,d,e[h].id,n),e[h].unique&&(i[e[h].unique]=!0),e[h].show1&&(i[e[h].show1]=!0),n&&(n[e[h].id]=!0);var m=e.splice(h,1);e.splice(0,0,m[0]),c++;break}}}console.log("Talent pickFromPool final array",e);var g=e.splice(0,c);if(console.log("Number of drawn results",c,r),g.length<r&&a){a=a,kit.shuffle(a),console.log("Current default pool: ",a),console.log("Current pool: ",g),console.log("ID Check Pool: ",n);var v=r-g.length;for(l=0;l<a.length&&(console.log(l,a[l].id),0!=v);l++)n&&n[a[l].id]||(g.push(a[l]),n&&(n[a[l].id]=!0),a.splice(l,1),l--,v--);kit.shuffle(g),console.log("Use backup 3-pick if target lacks, then merge : ",g,"Original count & Draw count:",g.length,r)}return g},getInfo:function(e){var t=TalentDefine[e];return{iconImgPath:("zh-cn"!=LAN?"ui/talent_en/":"ui/talent/")+t.content,title:t.title,des:t.des,rarity:t.rarity}},effect:function(e,t,i){var a=t;if(a)for(var n in a){var o=a[n],r=TalentDefine[o.id];r&&r[e]&&(r.templateFunc&&r.templateFunc.bind(this)(r.template,o),r.templateFunc2&&r.templateFunc2.bind(this)(r.template2,o),r[e].bind(r)(i,o))}}}}),cc._RF.pop()},{}],Tank2:[function(e,t){"use strict";cc._RF.push(t,"5f381MFznpF2If8m29ARWiR","Tank2"),cc.Class({extends:e("./Vehicle"),onHurt:function(e,t,i,a){this._super(e,t,i,a),this.applyVelocity(-this.flipX*t/this.hpMax*4800,0)},applyVelocity:function(){},updateMove:function(e){this.knockbackTimer>0&&(this.knockbackTimer-=e,this.knockbackTimer<=0&&this.knockback&&(this.knockback=!1,this.setFlag(NO_MOVE,!1))),this._super(e)}}),cc._RF.pop()},{"./Vehicle":"Vehicle"}],TaskBattlePassInit:[function(e,t,i){"use strict";cc._RF.push(t,"5150fnDe9NP1bcE/8a6XSGN","TaskBattlePassInit"),Object.defineProperty(i,"__esModule",{value:!0});var a=e("./TaskManager"),n=e("./TaskMilestoneManager"),o=e("./TaskResetManager"),r=e("./BattlePassManager"),s=e("./BattlePassSeasonManager"),c=function(){function e(){}return e.init=function(){if(this.initialized)console.warn("[TaskBattlePassInit] Already initialized");else{console.log("[TaskBattlePassInit] Initializing Task & Battle Pass system...");try{window.TaskManager=new a.default,window.DailyMilestones=new n.default("milestone_daily"),window.WeeklyMilestones=new n.default("milestone_weekly"),window.TaskResetManager=new o.default,window.BattlePassManager=new r.default,window.BattlePassSeasonManager=new s.default,this.setupEventListeners(),this.checkResets(),window.BattlePassManager.checkSeasonReset(),this.initialized=!0,console.log("[TaskBattlePassInit] \u2705 Initialization complete")}catch(e){console.error("[TaskBattlePassInit] \u274c Initialization failed:",e)}}},e.setupEventListeners=function(){window.TaskManager.on("taskCompleted",function(e){console.log("[TaskBattlePassInit] Task "+e.taskId+" completed (ready to claim)"),window.TaskBattlePassServer&&window.TaskBattlePassServer.saveTaskCompletion(e.taskId,0)}),window.TaskManager.on("rewardClaimed",function(e){console.log("[TaskBattlePassInit] Task "+e.taskId+" reward claimed: +"+e.points+" points"),window.DailyMilestones.addPoints(e.points),window.WeeklyMilestones.addPoints(e.points),window.BattlePassManager.addExp(e.points),window.TaskBattlePassServer&&window.TaskBattlePassServer.saveTaskClaim(e.taskId,e.points)}),window.DailyMilestones.on("milestoneAvailable",function(e){console.log("[TaskBattlePassInit] Daily milestone available: "+e.milestoneId)}),window.DailyMilestones.on("milestoneClaimed",function(e){console.log("[TaskBattlePassInit] Daily milestone claimed: "+e.milestoneId),window.TaskBattlePassServer&&!e.skipServerSave&&window.TaskBattlePassServer.saveMilestoneClaim("daily",e.milestoneId)}),window.WeeklyMilestones.on("milestoneAvailable",function(e){console.log("[TaskBattlePassInit] Weekly milestone available: "+e.milestoneId)}),window.WeeklyMilestones.on("milestoneClaimed",function(e){console.log("[TaskBattlePassInit] Weekly milestone claimed: "+e.milestoneId),window.TaskBattlePassServer&&!e.skipServerSave&&window.TaskBattlePassServer.saveMilestoneClaim("weekly",e.milestoneId)}),window.BattlePassManager.on("expGained",function(e){console.log("[TaskBattlePassInit] Battle Pass EXP gained: +"+e.amount+" (Total: "+e.totalExp+", Level: "+e.currentLevel+")"),window.TaskBattlePassServer&&window.TaskBattlePassServer.saveBattlePassProgress()}),window.BattlePassManager.on("levelUp",function(e){console.log("[TaskBattlePassInit] Battle Pass Level Up: "+e.oldLevel+" \u2192 "+e.newLevel)}),window.BattlePassManager.on("rewardClaimed",function(e){console.log("[TaskBattlePassInit] Battle Pass reward claimed: Level "+e.level+" ("+e.type+")"),window.TaskBattlePassServer&&window.TaskBattlePassServer.saveBattlePassRewardClaim(e.level,e.type)}),window.BattlePassManager.on("seasonReset",function(e){console.log("[TaskBattlePassInit] New season started: "+e.seasonId)})},e.checkResets=function(){window.TaskResetManager.checkDailyReset()&&(console.log("[TaskBattlePassInit] Triggering daily reset"),window.TaskManager.resetProgress(),window.DailyMilestones.resetProgress()),window.TaskResetManager.checkWeeklyReset()&&(console.log("[TaskBattlePassInit] Triggering weekly reset"),window.WeeklyMilestones.resetProgress())},e.loadFromServer=function(e){if(this.initialized){if(console.log("[TaskBattlePassInit] \ud83d\udce5 Loading progress from server"),console.log("[TaskBattlePassInit] \ud83d\udce5 Server data:",e),e.dailyTasks&&(console.log("[TaskBattlePassInit] Loading daily tasks:",e.dailyTasks),window.TaskManager.setProgress(e.dailyTasks)),"number"==typeof e.dailyPoints&&(console.log("[TaskBattlePassInit] Loading daily points:",e.dailyPoints),window.DailyMilestones.setPoints(e.dailyPoints)),e.dailyMilestones){console.log("[TaskBattlePassInit] Loading daily milestones:",e.dailyMilestones);var t=[];for(var i in e.dailyMilestones)!0===e.dailyMilestones[i]&&t.push(i);console.log("[TaskBattlePassInit] Claimed daily milestones:",t),window.DailyMilestones.setClaimedMilestones(t)}if("number"==typeof e.weeklyPoints&&(console.log("[TaskBattlePassInit] Loading weekly points:",e.weeklyPoints),window.WeeklyMilestones.setPoints(e.weeklyPoints)),e.weeklyMilestones){console.log("[TaskBattlePassInit] Loading weekly milestones:",e.weeklyMilestones);var a=[];for(var i in e.weeklyMilestones)!0===e.weeklyMilestones[i]&&a.push(i);console.log("[TaskBattlePassInit] Claimed weekly milestones:",a),window.WeeklyMilestones.setClaimedMilestones(a)}e.lastDailyReset&&(console.log("[TaskBattlePassInit] Loading last daily reset:",e.lastDailyReset),window.TaskResetManager.setLastDailyReset(e.lastDailyReset)),e.lastWeeklyReset&&(console.log("[TaskBattlePassInit] Loading last weekly reset:",e.lastWeeklyReset),window.TaskResetManager.setLastWeeklyReset(e.lastWeeklyReset)),e.battlePass&&(console.log("[TaskBattlePassInit] Loading Battle Pass:",e.battlePass),window.BattlePassManager.setProgress(e.battlePass)),console.log("[TaskBattlePassInit] \u2705 Progress loaded from server")}else console.error("[TaskBattlePassInit] Not initialized")},e.isInitialized=function(){return this.initialized},e.initialized=!1,e}();window.TaskBattlePassInit=c,i.default=c,cc._RF.pop()},{"./BattlePassManager":"BattlePassManager","./BattlePassSeasonManager":"BattlePassSeasonManager","./TaskManager":"TaskManager","./TaskMilestoneManager":"TaskMilestoneManager","./TaskResetManager":"TaskResetManager"}],TaskBattlePassServer:[function(e,t){"use strict";cc._RF.push(t,"dfe0fM01gRGipurE1fc8lVr","TaskBattlePassServer");var i,a=(i=e("../TimeManager"))&&i.__esModule?i:{default:i},n={DEV_MODE:!1,getCurrentTime:function(){return this.DEV_MODE?Date.now():void 0!==a.default&&a.default.Instance?a.default.Instance.now():(console.warn("[TaskBattlePassServer] TimeManager not available, using Date.now()"),Date.now())},loadFromServer:function(e){if(cc.log("[TaskBattlePassServer] Loading data from server"),window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized()){if(e.dailyTasks&&window.TaskManager.setProgress(e.dailyTasks),"number"==typeof e.dailyPoints&&window.DailyMilestones.setPoints(e.dailyPoints),e.dailyMilestones){var t=[];for(var i in e.dailyMilestones)!0===e.dailyMilestones[i]&&t.push(i);window.DailyMilestones.setClaimedMilestones(t)}if("number"==typeof e.weeklyPoints&&window.WeeklyMilestones.setPoints(e.weeklyPoints),e.weeklyMilestones){var a=[];for(var i in e.weeklyMilestones)!0===e.weeklyMilestones[i]&&a.push(i);window.WeeklyMilestones.setClaimedMilestones(a)}e.lastDailyReset&&window.TaskResetManager.setLastDailyReset(e.lastDailyReset),e.lastWeeklyReset&&window.TaskResetManager.setLastWeeklyReset(e.lastWeeklyReset),e.battlePass&&(cc.log("[TaskBattlePassServer] \ud83d\udce5 Loading Battle Pass data:",JSON.stringify(e.battlePass,null,2)),cc.log("[TaskBattlePassServer] \ud83d\udce5 Claimed rewards:",e.battlePass.claimedRewards),window.BattlePassManager.setProgress(e.battlePass)),cc.log("[TaskBattlePassServer] \u2705 Data loaded from server"),this.checkAndHandleResets()}else console.error("[TaskBattlePassServer] System not initialized!")},checkAndHandleResets:function(){window.TaskResetManager&&(window.TaskResetManager.checkDailyReset()&&(cc.log("[TaskBattlePassServer] Daily reset detected"),this.handleDailyReset()),window.TaskResetManager.checkWeeklyReset()&&(cc.log("[TaskBattlePassServer] Weekly reset detected"),this.handleWeeklyReset()))},handleDailyReset:function(){var e=this.getCurrentTime();cc.log("[TaskBattlePassServer] handleDailyReset - currentTime:",e);var t={set:{dailyTasks:{},dailyPoints:0,dailyMilestones:{},lastDailyReset:e}};cc.log("[TaskBattlePassServer] Sending daily reset data to server:",JSON.stringify(t)),net.updateData(t,function(e){e?console.error("[TaskBattlePassServer] Failed to save daily reset:",e):(cc.log("[TaskBattlePassServer] Daily reset saved to server"),window.TaskManager.resetProgress(),window.DailyMilestones.resetProgress())})},handleWeeklyReset:function(){var e=this.getCurrentTime();cc.log("[TaskBattlePassServer] handleWeeklyReset - currentTime:",e);var t={set:{weeklyPoints:0,weeklyMilestones:{},lastWeeklyReset:e}};cc.log("[TaskBattlePassServer] Sending weekly reset data to server:",JSON.stringify(t)),net.updateData(t,function(e){e?console.error("[TaskBattlePassServer] Failed to save weekly reset:",e):(cc.log("[TaskBattlePassServer] Weekly reset saved to server"),window.WeeklyMilestones.resetProgress())})},handleWeeklyAndDailyReset:function(){var e=this.getCurrentTime();cc.log("[TaskBattlePassServer] handleWeeklyAndDailyReset - currentTime:",e);var t={set:{dailyTasks:{},dailyPoints:0,dailyMilestones:{},lastDailyReset:e,weeklyPoints:0,weeklyMilestones:{},lastWeeklyReset:e}};cc.log("[TaskBattlePassServer] Sending combined reset data to server:",JSON.stringify(t)),net.updateData(t,function(e){e?console.error("[TaskBattlePassServer] Failed to save combined reset:",e):(cc.log("[TaskBattlePassServer] Weekly + Daily reset saved to server"),window.TaskManager.resetProgress(),window.DailyMilestones.resetProgress(),window.WeeklyMilestones.resetProgress())})},saveTaskCompletion:function(e){cc.log("[TaskBattlePassServer] Saving task completion:",e,"(ready to claim)");var t={};t["dailyTasks."+e+".completed"]=!0,t["dailyTasks."+e+".claimed"]=!1;var i={set:t};cc.log("[TaskBattlePassServer] \ud83d\udce4 Sending data to server via net.updateData():"),cc.log("[TaskBattlePassServer] \ud83d\udce4 Payload:",JSON.stringify(i,null,2)),net.updateData(i,function(e,t){e?console.error("[TaskBattlePassServer] \u274c Failed to save task completion:",e):(cc.log("[TaskBattlePassServer] \u2705 Task completion saved to server"),cc.log("[TaskBattlePassServer] \u2705 Server response:",t))})},saveTaskClaim:function(e,t){cc.log("[TaskBattlePassServer] Saving task claim:",e,"+"+t+" points");var i={};i["dailyTasks."+e+".claimed"]=!0;var a={set:i,add:{dailyPoints:t,weeklyPoints:t,"battlePass.exp":t}};cc.log("[TaskBattlePassServer] \ud83d\udce4 Sending data to server via net.updateData():"),cc.log("[TaskBattlePassServer] \ud83d\udce4 Payload:",JSON.stringify(a,null,2)),net.updateData(a,function(e,t){if(e)console.error("[TaskBattlePassServer] \u274c Failed to save task claim:",e);else if(cc.log("[TaskBattlePassServer] \u2705 Task claim saved to server"),cc.log("[TaskBattlePassServer] \u2705 Server response:",t),t&&t.doc&&t.doc.battlePass){var i=t.doc.battlePass,a=window.BattlePassManager.calculateLevel(i.exp),o=i.level||0;a>o&&(cc.log("[TaskBattlePassServer] \ud83c\udf89 Battle Pass level up detected:",o,"\u2192",a),n.saveBattlePassLevel(a))}})},saveMilestoneClaim:function(e,t){cc.log("[TaskBattlePassServer] Saving milestone claim:",e,t);var i={};i[("daily"===e?"dailyMilestones":"weeklyMilestones")+"."+t]=!0;var a={set:i};cc.log("[TaskBattlePassServer] \ud83d\udce4 Sending data to server via net.updateData():"),cc.log("[TaskBattlePassServer] \ud83d\udce4 Payload:",JSON.stringify(a,null,2)),net.updateData(a,function(e,t){e?console.error("[TaskBattlePassServer] \u274c Failed to save milestone claim:",e):(cc.log("[TaskBattlePassServer] \u2705 Milestone claim saved to server"),cc.log("[TaskBattlePassServer] \u2705 Server response:",t))})},saveMultipleMilestoneClaims:function(e,t,i){if(!t||0===t.length)return cc.log("[TaskBattlePassServer] No milestones to save"),void(i&&i(new Error("No milestones to save")));cc.log("[TaskBattlePassServer] Batch saving",t.length,e,"milestone claims");var a={},n="daily"===e?"dailyMilestones":"weeklyMilestones";t.forEach(function(e){a[n+"."+e]=!0});var o={set:a};cc.log("[TaskBattlePassServer] \ud83d\udce4 Batch sending data to server via net.updateData():"),cc.log("[TaskBattlePassServer] \ud83d\udce4 Payload:",JSON.stringify(o,null,2)),net.updateData(o,function(e,t){e?(console.error("[TaskBattlePassServer] \u274c Failed to save batch milestone claims:",e),i&&i(e)):(cc.log("[TaskBattlePassServer] \u2705 Batch milestone claims saved to server"),cc.log("[TaskBattlePassServer] \u2705 Server response:",t),i&&i(null,t))})},saveBattlePassLevel:function(e){cc.log("[TaskBattlePassServer] Saving Battle Pass level:",e),net.updateData({set:{"battlePass.level":e}},function(e){e?console.error("[TaskBattlePassServer] Failed to save Battle Pass level:",e):cc.log("[TaskBattlePassServer] Battle Pass level saved")})},saveBattlePassRewardClaim:function(e,t){var i;cc.log("[TaskBattlePassServer] Saving Battle Pass reward claim:",e,t),i="extra"===t?"extra_"+e:"level_"+e+"_"+t,cc.log("[TaskBattlePassServer] Reward key:",i);var a={};a["battlePass.claimedRewards."+i]=!0,net.updateData({set:a},function(e){e?console.error("[TaskBattlePassServer] Failed to save Battle Pass reward claim:",e):cc.log("[TaskBattlePassServer] Battle Pass reward claim saved")})},saveBattlePassProgress:function(){if(window.BattlePassManager){var e=window.BattlePassManager.getProgress();cc.log("[TaskBattlePassServer] Saving complete Battle Pass progress"),net.updateData({set:{battlePass:e}},function(e){e?console.error("[TaskBattlePassServer] Failed to save Battle Pass progress:",e):cc.log("[TaskBattlePassServer] Battle Pass progress saved")})}},saveAllProgress:function(){if(cc.log("[TaskBattlePassServer] \ud83d\udd04 Saving all progress to server..."),window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized()){var e=this.getCurrentServerData(),t={set:{dailyTasks:e.dailyTasks,dailyPoints:e.dailyPoints,dailyMilestones:e.dailyMilestones,weeklyPoints:e.weeklyPoints,weeklyMilestones:e.weeklyMilestones,lastDailyReset:e.lastDailyReset,lastWeeklyReset:e.lastWeeklyReset,battlePass:e.battlePass}};cc.log("[TaskBattlePassServer] \ud83d\udce4 Sending ALL data to server via net.updateData():"),cc.log("[TaskBattlePassServer] \ud83d\udce4 Payload:",JSON.stringify(t,null,2)),net.updateData(t,function(e,t){e?console.error("[TaskBattlePassServer] \u274c Failed to save all progress:",e):(cc.log("[TaskBattlePassServer] \u2705 All progress saved to server"),cc.log("[TaskBattlePassServer] \u2705 Server response:",t))})}else console.error("[TaskBattlePassServer] System not initialized!")},getCurrentServerData:function(){return window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized()?{dailyTasks:window.TaskManager.getServerData(),dailyPoints:window.DailyMilestones.getCurrentPoints(),dailyMilestones:this.getMilestonesServerData("daily"),weeklyPoints:window.WeeklyMilestones.getCurrentPoints(),weeklyMilestones:this.getMilestonesServerData("weekly"),lastDailyReset:window.TaskResetManager.getLastDailyReset(),lastWeeklyReset:window.TaskResetManager.getLastWeeklyReset(),battlePass:window.BattlePassManager.getProgress()}:null},getMilestonesServerData:function(e){var t="daily"===e?window.DailyMilestones:window.WeeklyMilestones;if(!t)return{};var i=t.getClaimedMilestones(),a={};return i.forEach(function(e){a[e]=!0}),a}};window.TaskBattlePassServer=n,t.exports=n,cc._RF.pop()},{"../TimeManager":"TimeManager"}],TaskItemReward:[function(e,t){"use strict";cc._RF.push(t,"0ac35FlIp9C06PzywzlZAkA","TaskItemReward"),cc.Class({extends:cc.Component,properties:{frameRaritySpr:cc.Sprite,itemReward:cc.Node,listFrameRarity:[cc.SpriteFrame],iconNotifi:cc.Sprite,tickNode:cc.Node,claimed:cc.Node},init:function(e,t,i,a,n){this.milestoneId=e,this.data=t,this.currentPoints=i,this.claimedMilestones=a,this.type=n,this.initReward(),this.updateUI(),this.updateNotificationIcon(),this.setupEventListeners()},initReward:function(){this.itemRewardCpm=this.itemReward.getComponent("Item");var e=this.data.rewards;1!=e.length?e.forEach(function(e,t){console.log("[TaskItemReward] Box reward",t+":",e)}):this.itemRewardCpm.getComponent("Item").init(this.data.rewards[0])},updateUI:function(){var e=this.node.getChildByName("pointsLabel");e&&(e.getComponent(cc.Label).string=this.data.point),this.frameRaritySpr.spriteFrame=this.listFrameRarity[this.data.rarity],this.updateClaimedState()},updateNotificationIcon:function(){if(this.iconNotifi&&this.iconNotifi.node){var e=this.currentPoints>=this.data.point,t=this.claimedMilestones.has(this.milestoneId),i=e&&!t,a=this.node.getChildByName("icon_arrow");if(a){var n=new cc.Color;e?cc.Color.fromHEX(n,"#31bcf2"):cc.Color.fromHEX(n,"#3C2A13"),a.color=n}this.iconNotifi.node.active=i}},updateClaimedState:function(){var e=this.claimedMilestones.has(this.milestoneId);this.tickNode&&cc.isValid(this.tickNode)&&(this.tickNode.active=e),this.claimed&&cc.isValid(this.claimed)&&(this.claimed.active=e),console.log("[TaskItemReward] Updated claimed state:",{milestoneId:this.milestoneId,isClaimed:e,tickNodeActive:this.tickNode?this.tickNode.active:"N/A",claimedNodeActive:this.claimed?this.claimed.active:"N/A"})},setupEventListeners:function(){var e=this,t="daily"===this.type?window.DailyMilestones:window.WeeklyMilestones;t&&(t.on("milestoneClaimed",function(t){t.milestoneId===e.milestoneId&&(console.log("[TaskItemReward] Milestone claimed:",e.milestoneId),e.iconNotifi.node.active=!1,e.claimedMilestones.add(e.milestoneId),e.updateClaimedState())}),t.on("pointsAdded",function(){e.currentPoints=t.getCurrentPoints(),e.updateNotificationIcon()}))},onDestroy:function(){var e="daily"===this.type?window.DailyMilestones:window.WeeklyMilestones;e&&(e.off("milestoneClaimed"),e.off("pointsAdded"))}}),cc._RF.pop()},{}],TaskItem:[function(e,t){"use strict";cc._RF.push(t,"21a18TYCPNFRoTHi3MWXSuF","TaskItem"),cc.Class({extends:cc.Component,properties:{titleLabel:cc.Label,descLabel:cc.Label,pointsLabel:cc.Label,progressLabel:cc.Label,progressBar:cc.Sprite,btnAction:cc.Button,lbBtnAction:cc.Label,frameRaritySpr:cc.Sprite,listFrameRarity:[cc.SpriteFrame],sprBgBtn:[cc.SpriteFrame],materialGray:{default:null,type:cc.Material,url:"internal/resources/materials/builtin-2d-gray-sprite.mtl"}},init:function(e){if(this.taskId=e.taskId,this.onClaimCallback=e.onClaim,this.onGoCallback=e.onGo,this.difficulty=e.difficulty,this.isAnimating=!1,this.titleLabel&&(this.titleLabel.string=e.title),this.descLabel&&(this.descLabel.string=e.description),this.pointsLabel&&(this.pointsLabel.string="+"+e.points),this.progressLabel&&(this.progressLabel.string=e.currentProgress+"/"+e.targetProgress),this.progressBar){var t=e.targetProgress>0?e.currentProgress/e.targetProgress:0;this.progressBar.fillRange=t}this.updateUI(),this.updateButtonState(e.completed,e.claimed)},updateUI:function(){this.frameRaritySpr.spriteFrame=this.listFrameRarity[this.difficulty]},updateButtonState:function(e,t){if(this.btnAction){var i=this,a=this.btnAction.node.getComponent(cc.Sprite);t?(this.lbBtnAction&&(this.lbBtnAction.string="Claimed"),this.btnAction.interactable=!1,this.btnAction.node.off("click"),a&&this.sprBgBtn&&this.sprBgBtn.length>1&&(a.spriteFrame=this.sprBgBtn[1]),a&&this.materialGray&&a.setMaterial(0,this.materialGray)):e?(this.lbBtnAction&&(this.lbBtnAction.string="Claim"),this.btnAction.interactable=!0,this.btnAction.node.off("click"),this.btnAction.node.on("click",function(e){console.log("[TaskItem] \u2550\u2550\u2550 CLICK HANDLER TRIGGERED \u2550\u2550\u2550"),console.log("[TaskItem] TaskID:",i.taskId),console.log("[TaskItem] Event:",e),console.log("[TaskItem] isAnimating before check:",i.isAnimating),i.isAnimating?console.warn("[TaskItem] \u274c Animation in progress, ignoring click"):(console.log("[TaskItem] \u2705 Setting isAnimating = true and disabling button"),i.isAnimating=!0,i.btnAction.interactable=!1,i.onClaimCallback?(console.log("[TaskItem] \u2705 Calling onClaimCallback for:",i.taskId),i.onClaimCallback(i.taskId)):console.error("[TaskItem] \u274c No onClaimCallback defined!"),console.log("[TaskItem] \u2550\u2550\u2550 CLICK HANDLER COMPLETE \u2550\u2550\u2550"))},this),a&&this.sprBgBtn&&this.sprBgBtn.length>1&&(a.spriteFrame=this.sprBgBtn[1]),a&&a.setMaterial(0,null)):(this.lbBtnAction&&(this.lbBtnAction.string="Go"),this.btnAction.interactable=!0,this.btnAction.node.off("click"),this.btnAction.node.on("click",function(){i.onGoCallback&&i.onGoCallback(i.taskId)},this),a&&this.sprBgBtn&&this.sprBgBtn.length>0&&(a.spriteFrame=this.sprBgBtn[0]),a&&a.setMaterial(0,null))}},updateProgress:function(e,t){if(this.progressLabel&&(this.progressLabel.string=e+"/"+t),this.progressBar){var i=t>0?e/t:0;this.progressBar.fillRange=i}},setCompleted:function(){this.updateButtonState(!0,!1)},setClaimed:function(){this.updateButtonState(!0,!0)},playClaimAnimation:function(e,t,i){var a=this;if(console.log("[TaskItem] \u2550\u2550\u2550 ANIMATION START \u2550\u2550\u2550"),console.log("[TaskItem] TaskID:",this.taskId),console.log("[TaskItem] isAnimating:",this.isAnimating),!this.pointsLabel||!e||!t)return console.error("[TaskItem] \u274c Missing labels for animation - cannot proceed"),this.isAnimating=!1,void(this.btnAction.interactable=!0);console.log("[TaskItem] \u2705 Validation passed, starting animation...");try{var n=cc.Canvas.instance.node,o=this.pointsLabel.node.convertToWorldSpaceAR(cc.v2(0,0)),r=n.convertToNodeSpaceAR(o),s=e.node||e,c=t.node||t,l=s.convertToWorldSpaceAR(cc.v2(0,0)),d=n.convertToNodeSpaceAR(l),h=c.convertToWorldSpaceAR(cc.v2(0,0)),u=n.convertToNodeSpaceAR(h),p=function(e,t){var i=cc.instantiate(a.pointsLabel.node);i.name="FlyingPoint",i.setPosition(r),i.scale=1,n.addChild(i,cc.macro.MAX_ZINDEX);var o=cc.v2(r.x+.5*(e.x-r.x),r.y+150),s=cc.v2(r.x+.75*(e.x-r.x),e.y+50);cc.tween(i).delay(t).to(.2,{scale:1.5,opacity:255},{easing:"sineOut"}).bezierTo(.6,cc.v2(o.x,o.y),cc.v2(s.x,s.y),cc.v2(e.x,e.y),{easing:"sineInOut"}).to(.3,{scale:.5},{easing:"sineIn"}).to(.2,{opacity:0},{easing:"sineIn"}).call(function(){i.destroy()}).start()};p(d,0),p(u,.1),window.menuManager&&window.menuManager.playEffect&&window.menuManager.playEffect(null,0),console.log("[TaskItem] \u2550\u2550\u2550 HIDING IMMEDIATELY \u2550\u2550\u2550"),console.log("[TaskItem] TaskID:",a.taskId),a.node.active=!1,a.isAnimating=!1,i?(console.log("[TaskItem] \u2705 Calling onComplete callback immediately"),i(),console.log("[TaskItem] \u2705 onComplete callback finished")):console.warn("[TaskItem] \u26a0\ufe0f No onComplete callback provided"),console.log("[TaskItem] \u2550\u2550\u2550 CLEANUP DONE (immediate) \u2550\u2550\u2550")}catch(f){console.error("[TaskItem] \u274c Animation error for",this.taskId,":",f),this.isAnimating=!1,this.btnAction.interactable=!0,console.warn("[TaskItem] \u26a0\ufe0f Animation failed - button re-enabled for retry")}}}),cc._RF.pop()},{}],TaskManager:[function(e,t,i){"use strict";cc._RF.push(t,"task-manager-typescript-001","TaskManager"),Object.defineProperty(i,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.config=new Map,t.progress=new Map,t.configLoaded=!1,t.debugServerSyncEnabled=!1,t.loadConfig(),t}return __extends(t,e),t.prototype.loadConfig=function(){var e=this;ConfigSourceManager.loadConfig("TaskConfig",function(t,i){if(t)console.error("[TaskManager] Failed to load TaskConfig:",t);else{for(var a in i){var n=i[a];e.config.set(a,n)}e.configLoaded=!0,cc.log("[TaskManager] Config loaded successfully, total tasks:",e.config.size),e.emit("configLoaded",{taskCount:e.config.size})}})},t.prototype.getTasks=function(){return this.config},t.prototype.getTaskConfig=function(e){return this.config.get(e)},t.prototype.updateProgress=function(e,t){if(void 0===t&&(t=1),cc.log("[TaskManager] updateProgress"),this.configLoaded){var i=this.config.get(e);if(i)if(i.task.num<=1)console.warn("[TaskManager] "+e+" is an instant task (num=1), use completeTask() instead");else{var a=this.progress.get(e)||{completed:!1,claimed:!1,progress:0};a.completed?console.warn("[TaskManager] "+e+" already completed"):(a.progress=(a.progress||0)+t,this.progress.set(e,a),cc.log("[TaskManager] "+e+" progress: "+a.progress+"/"+i.task.num+" (+"+t+")"),this.emit("progressUpdated",{taskId:e,progress:a.progress,target:i.task.num,increment:t}),a.progress>=i.task.num?(cc.log("[TaskManager] "+e+" reached target, auto-completing"),this.completeTask(e)):this.saveToServer())}else console.error("[TaskManager] Task not found:",e)}else console.warn("[TaskManager] Config not loaded yet, ignoring updateProgress for:",e)},t.prototype.completeTask=function(e){if(this.configLoaded){var t=this.config.get(e);if(t){var i=this.progress.get(e)||{completed:!1,claimed:!1};if(i.completed)console.warn("[TaskManager] "+e+" already completed");else{i.completed=!0,i.progress=t.task.num,this.progress.set(e,i),cc.log("[TaskManager] Task completed: "+e+", points: "+t.point_reward),this.debugServerSyncEnabled&&(cc.log("[TaskManager] \ud83d\udd0d DEBUG: About to emit 'taskCompleted' event"),cc.log("[TaskManager] \ud83d\udd0d DEBUG: This will trigger TaskBattlePassInit listener \u2192 saveTaskCompletion()"));var a={taskId:e,points:t.point_reward};this.emit("taskCompleted",a),this.debugServerSyncEnabled&&cc.log("[TaskManager] \ud83d\udd0d DEBUG: Event emitted, server save should happen now via net.updateData()")}}else console.error("[TaskManager] Task not found:",e)}else console.warn("[TaskManager] Config not loaded yet, ignoring completeTask for:",e)},t.prototype.claimReward=function(e){var t=this.progress.get(e);if(t)if(t.completed)if(t.claimed)console.warn("[TaskManager] "+e+" reward already claimed");else{t.claimed=!0,this.progress.set(e,t);var i=this.config.get(e);cc.log("[TaskManager] Reward claimed: "+e+", points: "+(null==i?void 0:i.point_reward)),this.debugServerSyncEnabled&&(cc.log("[TaskManager] \ud83d\udd0d DEBUG: About to emit 'rewardClaimed' event"),cc.log("[TaskManager] \ud83d\udd0d DEBUG: This will trigger TaskBattlePassInit listener \u2192 saveTaskClaim()")),this.emit("rewardClaimed",{taskId:e,points:(null==i?void 0:i.point_reward)||0}),this.debugServerSyncEnabled&&cc.log("[TaskManager] \ud83d\udd0d DEBUG: Event emitted, server save should happen now via net.updateData()")}else console.warn("[TaskManager] Cannot claim reward - "+e+" not completed");else console.warn("[TaskManager] No progress found for "+e)},t.prototype.getProgress=function(e){return this.progress.get(e)},t.prototype.getAllProgress=function(){return this.progress},t.prototype.setProgress=function(e){for(var t in this.progress.clear(),e){var i=e[t];if(i.completed&&(!i.progress||0===i.progress)){var a=this.config.get(t);a&&(i.progress=a.task.num,cc.log("[TaskManager] Migrated old data for "+t+": progress set to "+i.progress))}this.progress.set(t,i)}cc.log("[TaskManager] Progress loaded from server:",this.progress.size,"tasks")},t.prototype.resetProgress=function(){this.progress.clear(),cc.log("[TaskManager] All task progress reset"),this.emit("progressReset",{})},t.prototype.checkReset=function(){cc.log("[TaskManager] checkReset() called - implement reset logic if needed")},t.prototype.getStats=function(){var e={totalTasks:this.config.size,completedTasks:0,claimedTasks:0,inProgressTasks:0};return this.progress.forEach(function(t){t.claimed?e.claimedTasks++:t.completed?e.completedTasks++:t.progress&&t.progress>0&&e.inProgressTasks++}),e},t.prototype.debugCompleteAllTasks=function(){var e=this;cc.log("[TaskManager] DEBUG: Completing all tasks...");var t=0;return this.config.forEach(function(i,a){var n=e.progress.get(a);n&&n.completed||(e.completeTask(a),t++)}),cc.log("[TaskManager] DEBUG: Completed "+t+" tasks"),t},t.prototype.debugResetAllTasks=function(){cc.log("[TaskManager] DEBUG: Resetting all tasks...");var e=this.progress.size;return this.progress.clear(),cc.log("[TaskManager] DEBUG: Reset "+e+" tasks"),this.emit("progressReset",{}),e},t.prototype.debugResetTask=function(e){this.config.has(e)?(this.progress.delete(e),cc.log("[TaskManager] DEBUG: Reset task "+e)):console.error("[TaskManager] DEBUG: Task "+e+" does not exist")},t.prototype.debugServerSync=function(e){this.debugServerSyncEnabled=!0,e?(cc.log("[TaskManager] \ud83d\udd0d DEBUG: Server sync logging ENABLED"),cc.log("[TaskManager] Auto-save triggers:"),cc.log("  - taskCompleted event \u2192 saveTaskCompletion()"),cc.log("  - rewardClaimed event \u2192 saveTaskClaim()"),cc.log("  - Check TaskBattlePassInit.ts lines 92-115 for event handlers")):cc.log("[TaskManager] DEBUG: Server sync logging DISABLED")},t.prototype.saveToServer=function(){window.TaskBattlePassServer?(cc.log("[TaskManager] \ud83d\udcbe Triggering server save..."),window.TaskBattlePassServer.saveAllProgress()):console.warn("[TaskManager] \u26a0\ufe0f TaskBattlePassServer not available, cannot save to server")},t.prototype.isConfigLoaded=function(){return this.configLoaded},t.prototype.getServerData=function(){var e={};return this.progress.forEach(function(t,i){e[i]={completed:t.completed,claimed:t.claimed,progress:t.progress}}),e},t}(e("../core/EventSystem").default);i.default=a,cc._RF.pop()},{"../core/EventSystem":"EventSystem"}],TaskMilestoneManager:[function(e,t,i){"use strict";cc._RF.push(t,"5c130AL2kZLP4UhSC9VmKWd","TaskMilestoneManager"),Object.defineProperty(i,"__esModule",{value:!0});var a=function(e){function t(t){var i=e.call(this)||this;if(i.config={},i.currentPoints=0,i.claimedMilestones=new Set,i.configLoaded=!1,"milestone_daily"!==t&&"milestone_weekly"!==t)throw console.error("[MilestoneManager] Invalid config type:",t),new Error("configType must be 'milestone_daily' or 'milestone_weekly'");return i.configType=t,i.loadConfig(),i}return __extends(t,e),t.prototype.loadConfig=function(){var e=this;ConfigSourceManager.loadConfig("TaskMilestoneConfig",function(t,i){if(t)console.error("[MilestoneManager] Failed to load TaskMilestoneConfig:",t);else{e.config=i[e.configType]||{},e.configLoaded=!0;var a=Object.keys(e.config).length;console.log("[MilestoneManager] "+e.configType+" loaded, total milestones:",a),e.emit("configLoaded",{type:e.configType,milestoneCount:a})}})},t.prototype.addPoints=function(e){if(this.configLoaded)if(e<=0)console.warn("[MilestoneManager] Invalid points:",e);else{var t=this.currentPoints;this.currentPoints+=e,console.log("[MilestoneManager] "+this.configType+" points: "+t+" \u2192 "+this.currentPoints+" (+"+e+")"),this.emit("pointsAdded",{type:this.configType,added:e,oldTotal:t,newTotal:this.currentPoints}),this.checkMilestones()}else console.warn("[MilestoneManager] Config not loaded yet, ignoring addPoints")},t.prototype.setPoints=function(e){this.currentPoints=e,this.checkMilestones()},t.prototype.checkMilestones=function(){for(var e in this.config){var t=this.config[e];this.currentPoints>=t.point&&!this.claimedMilestones.has(e)&&(console.log("[MilestoneManager] Milestone available: "+e+" ("+t.point+" points)"),this.emit("milestoneAvailable",{milestoneId:e,milestone:t,currentPoints:this.currentPoints}))}},t.prototype.claimMilestone=function(e){var t=this.config[e];return t?this.claimedMilestones.has(e)?(console.warn("[MilestoneManager] Milestone already claimed:",e),!1):this.currentPoints<t.point?(console.warn("[MilestoneManager] Not enough points for "+e+" (need "+t.point+", have "+this.currentPoints+")"),!1):(this.claimedMilestones.add(e),console.log("[MilestoneManager] Milestone claimed: "+e+", rewards:",t.rewards),this.emit("milestoneClaimed",{milestoneId:e,rewards:t.rewards,rarity:t.rarity}),!0):(console.error("[MilestoneManager] Milestone not found:",e),!1)},t.prototype.getClaimableMilestones=function(){var e=[];for(var t in this.config){var i=this.config[t],a=this.currentPoints>=i.point,n=this.claimedMilestones.has(t);a&&!n&&e.push({milestoneId:t,rewards:i.rewards,rarity:i.rarity})}return e},t.prototype.claimMilestonesByIds=function(e){var t=this;e.forEach(function(e){if(!t.claimedMilestones.has(e)){t.claimedMilestones.add(e);var i=t.config[e];console.log("[MilestoneManager] \u2705 Milestone claimed (server confirmed): "+e),t.emit("milestoneClaimed",{milestoneId:e,rewards:i.rewards,rarity:i.rarity,skipServerSave:!0})}})},t.prototype.claimAllMilestones=function(){var e=[];for(var t in this.config){var i=this.config[t],a=this.currentPoints>=i.point,n=this.claimedMilestones.has(t);a&&!n&&(this.claimedMilestones.add(t),console.log("[MilestoneManager] Milestone claimed: "+t+", rewards:",i.rewards),e.push({milestoneId:t,rewards:i.rewards,rarity:i.rarity}),this.emit("milestoneClaimed",{milestoneId:t,rewards:i.rewards,rarity:i.rarity}))}return e.length>0&&console.log("[MilestoneManager] Claimed "+e.length+" "+this.configType+" milestones"),e},t.prototype.getCurrentPoints=function(){return this.currentPoints},t.prototype.getClaimedMilestones=function(){return this.claimedMilestones},t.prototype.getMilestone=function(e){return this.config[e]},t.prototype.getAllMilestones=function(){return this.config},t.prototype.setClaimedMilestones=function(e){this.claimedMilestones.clear();for(var t=0,i=e;t<i.length;t++){var a=i[t];this.claimedMilestones.add(a)}console.log("[MilestoneManager] Claimed milestones loaded from server:",this.claimedMilestones.size)},t.prototype.resetProgress=function(){this.currentPoints=0,this.claimedMilestones.clear(),console.log("[MilestoneManager] "+this.configType+" reset"),this.emit("progressReset",{type:this.configType})},t.prototype.getStats=function(){var e={type:this.configType,currentPoints:this.currentPoints,totalMilestones:Object.keys(this.config).length,claimedMilestones:this.claimedMilestones.size,availableMilestones:0};for(var t in this.config){var i=this.config[t];this.currentPoints>=i.point&&!this.claimedMilestones.has(t)&&e.availableMilestones++}return e},t.prototype.isMilestoneAvailable=function(e){var t=this.config[e];return!!t&&this.currentPoints>=t.point&&!this.claimedMilestones.has(e)},t.prototype.getType=function(){return this.configType},t.prototype.isConfigLoaded=function(){return this.configLoaded},t}(e("../core/EventSystem").default);i.default=a,cc._RF.pop()},{"../core/EventSystem":"EventSystem"}],TaskPopup:[function(e,t){"use strict";cc._RF.push(t,"cce696nNZ5MIZdOhn9AUoEc","TaskPopup");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{taskListContent:cc.Node,taskItemPrefab:cc.Prefab,dailyProgressBar:cc.Sprite,dailyProgressLabel:cc.Label,dailyPointLabel:cc.Label,dailyResetTimerLabel:cc.Label,dailyMilestoneContent:cc.Node,dailyMilestonePrefab:cc.Prefab,weeklyProgressBar:cc.Sprite,weeklyProgressLabel:cc.Label,weeklyPointLabel:cc.Label,weeklyResetTimerLabel:cc.Label,weeklyMilestoneContent:cc.Node,weeklyMilestonePrefab:cc.Prefab,btnClaimAllDaily:cc.Button,btnClaimAllWeekly:cc.Button,notifyLabel:cc.Label,materialGray:{default:null,type:cc.Material,url:"internal/resources/materials/builtin-2d-gray-sprite.mtl"},debugPopup:cc.Node,battlePopup:cc.Node,notifyTaskButton:cc.Node,notifyBattlePassButton:cc.Node},onLoad:function(){this.taskItems=[],this.dailyMilestoneItems=[],this.weeklyMilestoneItems=[],this.isInitialized=!1,this.isAnyTaskAnimating=!1,this._super()},start:function(){this.isInitialized||(window.TaskBattlePassInit&&window.TaskBattlePassInit.isInitialized()?(this.initStatus(),this.isInitialized=!0):console.error("[TaskPopup] Task system not initialized!"))},initStatus:function(){this.setupEventListeners(),this.refreshTaskList(),this.refreshDailyMilestones(),this.refreshWeeklyMilestones(),this.updateProgressBars(),this.updateNotifications(),this.schedule(this.updateTimers,1)},setupEventListeners:function(){var e=this;window.TaskManager&&(window.TaskManager.on("taskCompleted",function(){e.refreshTaskList(),e.updateProgressBars(),e.updateNotifications()}),window.TaskManager.on("rewardClaimed",function(){e.refreshTaskList(),e.updateNotifications()}),window.TaskManager.on("progressReset",function(){e.refreshTaskList(),e.updateProgressBars(),e.updateNotifications()})),window.DailyMilestones&&(window.DailyMilestones.on("milestoneAvailable",function(){e.updateClaimAllButtonState(),e.updateNotifications()}),window.DailyMilestones.on("pointsAdded",function(){e.updateProgressBars(),e.updateClaimAllButtonState(),e.updateNotifications()}),window.DailyMilestones.on("milestoneClaimed",function(){e.updateClaimAllButtonState(),e.updateNotifications()}),window.DailyMilestones.on("progressReset",function(){e.refreshDailyMilestones(),e.updateProgressBars(),e.updateNotifications()})),window.WeeklyMilestones&&(window.WeeklyMilestones.on("milestoneAvailable",function(){e.updateClaimAllButtonState(),e.updateNotifications()}),window.WeeklyMilestones.on("pointsAdded",function(){e.updateProgressBars(),e.updateClaimAllButtonState(),e.updateNotifications()}),window.WeeklyMilestones.on("milestoneClaimed",function(){e.updateClaimAllButtonState(),e.updateNotifications()}),window.WeeklyMilestones.on("progressReset",function(){e.refreshWeeklyMilestones(),e.updateProgressBars(),e.updateNotifications()})),window.BattlePassManager&&(window.BattlePassManager.on("expGained",function(){e.updateNotifications()}),window.BattlePassManager.on("levelUp",function(){e.updateNotifications()}),window.BattlePassManager.on("rewardClaimed",function(){e.updateNotifications()}),window.BattlePassManager.on("premiumPurchased",function(){e.updateNotifications()}))},refreshTaskList:function(){if(window.TaskManager)if(this.taskListContent&&cc.isValid(this.taskListContent)){this.taskListContent.removeAllChildren(),this.taskItems=[];var e=window.TaskManager.getTasks(),t=[];e.forEach(function(e,i){var a=window.TaskManager.getProgress(i)||{completed:!1,claimed:!1};t.push({id:i,config:e,progress:a})}),t.sort(function(e,t){var i=e.progress.completed&&!e.progress.claimed,a=t.progress.completed&&!t.progress.claimed;if(i&&!a)return-1;if(!i&&a)return 1;var n=e.config.task.difficulty||0,o=t.config.task.difficulty||0;return n!==o?n-o:parseInt(e.id.split("_")[1])-parseInt(t.id.split("_")[1])});for(var i=0;i<t.length;i++){var a=t[i],n=this.createTaskItem(a.id,a.config);this.taskListContent.addChild(n),this.taskItems.push(n)}this.updateNotifyLabel()}else console.warn("[TaskPopup] taskListContent not available, skipping refresh")},createTaskItem:function(e,t){var i=cc.instantiate(this.taskItemPrefab),a=this,n=window.TaskManager.getProgress(e)||{completed:!1,claimed:!1,progress:0},o=t.task.info.replace("{n}",t.task.num),r=t.task.description,s=t.point_reward,c=t.task.num,l=n.progress||0;n.completed&&0===l&&(l=c);var d=t.task.difficulty,h=i.getComponent("TaskItem");return h?h.init({taskId:e,title:o,description:r,points:s,difficulty:d,currentProgress:l,targetProgress:c,completed:n.completed,claimed:n.claimed,onClaim:function(e){a.onClaimTaskReward(e)},onGo:function(e){a.onGoToTask(e)}}):console.error("[TaskPopup] TaskItem component not found on prefab!"),n.claimed&&(i.active=!1),i},refreshDailyMilestones:function(){if(window.DailyMilestones)if(this.dailyMilestoneContent&&cc.isValid(this.dailyMilestoneContent)){this.dailyMilestoneContent.removeAllChildren(),this.dailyMilestoneItems=[];var e=window.DailyMilestones.getAllMilestones(),t=window.DailyMilestones.getCurrentPoints(),i=window.DailyMilestones.getClaimedMilestones();for(var a in e){var n=e[a],o=this.createMilestoneItem(a,n,t,i,"daily");this.dailyMilestoneContent.addChild(o),this.dailyMilestoneItems.push(o)}this.updateClaimAllButtonState()}else console.warn("[TaskPopup] dailyMilestoneContent not available, skipping refresh")},refreshWeeklyMilestones:function(){if(window.WeeklyMilestones)if(this.weeklyMilestoneContent&&cc.isValid(this.weeklyMilestoneContent)){this.weeklyMilestoneContent.removeAllChildren(),this.weeklyMilestoneItems=[];var e=window.WeeklyMilestones.getAllMilestones(),t=window.WeeklyMilestones.getCurrentPoints(),i=window.WeeklyMilestones.getClaimedMilestones();for(var a in e){var n=e[a],o=this.createMilestoneItem(a,n,t,i,"weekly");this.weeklyMilestoneContent.addChild(o),this.weeklyMilestoneItems.push(o)}this.updateClaimAllButtonState()}else console.warn("[TaskPopup] weeklyMilestoneContent not available, skipping refresh")},createMilestoneItem:function(e,t,i,a,n){var o="daily"===n?this.dailyMilestonePrefab:this.weeklyMilestonePrefab,r=cc.instantiate(o);return r.getComponent("TaskItemReward").init(e,t,i,a,n),r},calculateMilestoneFillRange:function(e,t,i){if(e<=0)return 0;for(var a=0;a<t.length;a++){var n=t[a],o=i[a];if(e<n){var r=a>0?t[a-1]:0,s=a>0?i[a-1]:0;return s+(e-r)/(n-r)*(o-s)}if(e===n)return o}return i[i.length-1]},updateProgressBars:function(){if(window.DailyMilestones&&window.WeeklyMilestones){var e=[.16,.36,.56,.76,1],t=window.DailyMilestones.getCurrentPoints(),i=(window.DailyMilestones.getStats(),this.getMaxMilestonePoints("daily"));if(this.dailyProgressBar){var a=this.calculateMilestoneFillRange(t,[20,40,60,80,100],e);this.dailyProgressBar.fillRange=a}this.dailyProgressLabel&&(this.dailyProgressLabel.string=t+"/"+i),this.dailyPointLabel&&(this.dailyPointLabel.string=t.toString());var n=window.WeeklyMilestones.getCurrentPoints(),o=(window.WeeklyMilestones.getStats(),this.getMaxMilestonePoints("weekly"));if(this.weeklyProgressBar){var r=this.calculateMilestoneFillRange(n,[140,280,420,560,700],e);this.weeklyProgressBar.fillRange=r}this.weeklyProgressLabel&&(this.weeklyProgressLabel.string=n+"/"+o),this.weeklyPointLabel&&(this.weeklyPointLabel.string=n.toString())}},updateClaimAllButtonState:function(){this.updateDailyClaimAllButton(),this.updateWeeklyClaimAllButton()},updateDailyClaimAllButton:function(){if(this.btnClaimAllDaily){var e=!1;if(window.DailyMilestones){var t=window.DailyMilestones.getAllMilestones(),i=window.DailyMilestones.getCurrentPoints(),a=window.DailyMilestones.getClaimedMilestones();for(var n in t){var o=i>=t[n].point,r=a.has(n);if(o&&!r){e=!0;break}}}this.updateButtonState(this.btnClaimAllDaily,e,"Daily")}},updateWeeklyClaimAllButton:function(){if(this.btnClaimAllWeekly){var e=!1;if(window.WeeklyMilestones){var t=window.WeeklyMilestones.getAllMilestones(),i=window.WeeklyMilestones.getCurrentPoints(),a=window.WeeklyMilestones.getClaimedMilestones();for(var n in t){var o=i>=t[n].point,r=a.has(n);if(o&&!r){e=!0;break}}}this.updateButtonState(this.btnClaimAllWeekly,e,"Weekly")}},updateButtonState:function(e,t){if(e&&cc.isValid(e.node)){e.interactable=t;var i=e.node.getComponent(cc.Sprite);i&&(e._originalMaterial||(e._originalMaterial=i.getMaterial(0)),t?i.setMaterial(0,e._originalMaterial):this.materialGray&&i.setMaterial(0,this.materialGray))}},updateNotifications:function(){this.updateTaskNotification(),this.updateBattlePassNotification()},updateTaskNotification:function(){if(this.notifyTaskButton&&cc.isValid(this.notifyTaskButton)){var e=!1;window.TaskManager&&window.TaskManager.getTasks().forEach(function(t,i){var a=window.TaskManager.getProgress(i);a&&a.completed&&!a.claimed&&(e=!0)}),!e&&window.DailyMilestones&&window.DailyMilestones.getClaimableMilestones().length>0&&(e=!0),!e&&window.WeeklyMilestones&&window.WeeklyMilestones.getClaimableMilestones().length>0&&(e=!0),this.notifyTaskButton.active=e}},updateBattlePassNotification:function(){var e="[BP_NOTIFY_DEBUG]";if(this.notifyBattlePassButton&&cc.isValid(this.notifyBattlePassButton)){var t=!1;if(window.BattlePassManager){var i=window.BattlePassManager.getProgress(),a=i.level,n=i.premium,o=i.claimedRewards||{};if(console.log(e+" \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),console.log(e+" Current Level:",a),console.log(e+" Has Premium:",n),console.log(e+" Claimed Rewards:",o),0===a)return console.log(e+" Skipping - Player at level 0"),console.log(e+" Final Result: HIDE"),console.log(e+" \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),void(this.notifyBattlePassButton.active=!1);console.log(e+" Checking levels 0 to "+(a-1));for(var r=0;r<a;r++){var s="level_"+r+"_free",c=o[s];if(console.log(e+"   Level "+r+" free: "+(c?"CLAIMED \u2713":"UNCLAIMED \u2717")),!c){console.log(e+" \u26a0\ufe0f UNCLAIMED FREE: "+s),t=!0;break}if(n){var l="level_"+r+"_premium",d=o[l];if(console.log(e+"   Level "+r+" premium: "+(d?"CLAIMED \u2713":"UNCLAIMED \u2717")),!d){console.log(e+" \u26a0\ufe0f UNCLAIMED PREMIUM: "+l),t=!0;break}}}if(t||console.log(e+" \u2713 All level rewards claimed"),!t&&a>=30){var h=window.BattlePassManager.getExtraProgress(),u=window.BattlePassManager.getCurrentExtraChest();if(console.log(e+" Extra Chest Index:",u),console.log(e+" Extra Progress:",h.currentExp+"/"+h.nextLevelExp),u<5){var p="extra_"+u;h.currentExp>=h.nextLevelExp&&!o[p]&&(console.log(e+" \u26a0\ufe0f UNCLAIMED EXTRA: "+p),t=!0)}}console.log(e+" Final Result: "+(t?"SHOW":"HIDE")),console.log(e+" \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550")}this.notifyBattlePassButton.active=t}},getMaxMilestonePoints:function(e){var t="daily"===e?window.DailyMilestones:window.WeeklyMilestones;if(!t)return 0;var i=t.getAllMilestones(),a=0;for(var n in i)i[n].point>a&&(a=i[n].point);return a},updateTimers:function(){if(window.TaskResetManager){var e=window.TaskResetManager.checkWeeklyReset(),t=window.TaskResetManager.checkDailyReset();(e||t)&&window.TaskBattlePassServer&&(e?window.TaskBattlePassServer.handleWeeklyAndDailyReset():window.TaskBattlePassServer.handleDailyReset());var i=window.TaskResetManager.getTimeUntilDailyReset(),a=window.TaskResetManager.formatTimeRemaining(i);this.dailyResetTimerLabel&&(this.dailyResetTimerLabel.string="Reset in: "+a);var n=window.TaskResetManager.getTimeUntilWeeklyReset(),o=window.TaskResetManager.formatTimeRemainingWithDays(n);this.weeklyResetTimerLabel&&(this.weeklyResetTimerLabel.string="Weekly Reset: "+o)}},onClaimTaskReward:function(e){var t=this;if(console.log("[CLAIM_REWARD] \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),console.log("[CLAIM_REWARD] onClaimTaskReward called for:",e),console.log("[CLAIM_REWARD] isAnyTaskAnimating:",this.isAnyTaskAnimating),console.log("[CLAIM_REWARD] \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),this.isAnyTaskAnimating)console.warn("[CLAIM_REWARD] \u274c Another task is animating, ignoring click for:",e);else if(window.TaskManager){this.isAnyTaskAnimating=!0,console.log("[CLAIM_REWARD] \u2705 Global animation lock SET");for(var a=null,n=null,o=0;o<this.taskItems.length;o++){var r=this.taskItems[o],s=r.getComponent("TaskItem");if(s&&s.taskId===e){a=r,n=s;break}}if(!a||!n)return console.warn("[CLAIM_REWARD] \u274c Task item not found for animation:",e),this.isAnyTaskAnimating=!1,console.log("[CLAIM_REWARD] \u26a0\ufe0f Global animation lock RESET (error path)"),window.TaskManager.claimReward(e),this.refreshTaskList(),void i.FirebaseTracking.setDataBiRes("Task_Claim_"+e);console.log("[CLAIM_REWARD] \u2705 Found task item, calling playClaimAnimation..."),n.playClaimAnimation(this.dailyPointLabel,this.weeklyPointLabel,function(){console.log("[CLAIM_REWARD] \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),console.log("[CLAIM_REWARD] \ud83c\udf89 Animation complete callback triggered!"),console.log("[CLAIM_REWARD] TaskID:",e),console.log("[CLAIM_REWARD] \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550"),console.log("[CLAIM_REWARD] Claiming reward in TaskManager..."),window.TaskManager.claimReward(e),console.log("[CLAIM_REWARD] Updating progress bars..."),t.updateProgressBars(),console.log("[CLAIM_REWARD] Updating notifications..."),t.updateNotifications(),console.log("[CLAIM_REWARD] Updating notify label..."),t.updateNotifyLabel(),console.log("[CLAIM_REWARD] Tracking Firebase event..."),i.FirebaseTracking.setDataBiRes("Task_Claim_"+e),t.isAnyTaskAnimating=!1,console.log("[CLAIM_REWARD] \u2705 Global animation lock RESET (success path)"),console.log("[CLAIM_REWARD] \u2550\u2550\u2550 CALLBACK COMPLETE \u2550\u2550\u2550")}),console.log("[CLAIM_REWARD] \u23f3 playClaimAnimation called, waiting for animation...")}},onGoToTask:function(e){if(!window.DEFINE_GO_TO)return console.error("[TaskPopup] DEFINE_GO_TO not loaded!"),void this.onMenuClose();if(!window.TaskManager)return console.error("[TaskPopup] TaskManager not loaded!"),void this.onMenuClose();var t=window.TaskManager.getTaskConfig(e);if(!t)return console.error("[TaskPopup] Task config not found for:",e),void this.onMenuClose();var i=t.go_to_id;if(i){var a=window.DEFINE_GO_TO.get(i);if(!a)return console.error("[TaskPopup] Navigation definition not found:",i),void kit.info("Navigation not available");if(a.unlockChapter&&window.pc&&!window.pc.isChapterDone(a.unlockChapter)){if("undefined"!=typeof kit&&"undefined"!=typeof LI){var n="chapter_unlock_"+(a.unlockChapter+1);kit.info(LI(n))}return void console.warn("[TaskPopup] \u274c Navigation locked - Chapter",a.unlockChapter,"required")}this.onMenuClose();var o=null;"GO_TO_SHOP"===i?"task_5"===e||"task_6"===e?o="daily":"task_7"===e&&(o="chest"):"GO_TO_GARAGE"===i&&("task_3"===e?o="upgrade":"task_4"===e&&(o="starup")),o&&a.navigate?a.navigate(o)||console.error("[TaskPopup] Navigation failed for task:",e,"go_to_id:",i):window.DEFINE_GO_TO.navigateTo(i)||console.error("[TaskPopup] Navigation failed for task:",e,"go_to_id:",i)}else console.error("[TaskPopup] go_to_id not defined for task:",e)},onClaimMilestone:function(e,t){var a="daily"===e?window.DailyMilestones:window.WeeklyMilestones;a&&a.claimMilestone(t)&&("daily"===e?this.refreshDailyMilestones():this.refreshWeeklyMilestones(),i.FirebaseTracking.setDataBiRes("Milestone_Claim_"+e+"_"+t))},onClaimAllDailyClicked:function(){if(window.DailyMilestones){var e=window.DailyMilestones.getClaimableMilestones();if(e.length>0){var t=this,a=e.map(function(e){return e.milestoneId}),n=[];e.forEach(function(e){n.push(e.rewards[0])}),console.log("[BP_REWARD_DEBUG] Daily raw rewards array:",n);var o={};n.forEach(function(e,t){o["item"+(t+1)]=e}),console.log("[BP_REWARD_DEBUG] Daily converted to object:",o);var r=[];window.equipment.getItemFromReward(r,o),console.log("[BP_REWARD_DEBUG] Daily converted rewards:",r),net.updateData({items:r},function(e,n){if(e)return console.error("[BP_REWARD_DEBUG] \u274c Failed to send daily rewards to server:",e),void kit.info("Failed to save rewards to server. Please try again.");"undefined"!=typeof money&&"function"==typeof money.update&&money.update(n),window.TaskBattlePassServer?window.TaskBattlePassServer.saveMultipleMilestoneClaims("daily",a,function(e){e?(console.error("[TaskPopup] \u274c Failed to save daily milestones:",e),kit.info("Failed to save rewards to server. Please try again.")):(window.DailyMilestones.claimMilestonesByIds(a),t.updateClaimAllButtonState(),console.log("[BP_REWARD_DEBUG] Showing daily popup with items:",r),menuManager.pop("loot",{tid:"sign",items:r,checkCb:function(){console.log("[BP_REWARD_DEBUG] Daily popup closed")}}),i.FirebaseTracking.setDataBiRes("Task_ClaimAllDaily"))}):(window.DailyMilestones.claimMilestonesByIds(a),t.updateClaimAllButtonState(),menuManager.pop("loot",{tid:"sign",items:r,checkCb:function(){}}),i.FirebaseTracking.setDataBiRes("Task_ClaimAllDaily"))})}else kit.info("No daily rewards available to claim")}},onClaimAllWeeklyClicked:function(){if(window.WeeklyMilestones){var e=window.WeeklyMilestones.getClaimableMilestones();if(e.length>0){var t=this,a=e.map(function(e){return e.milestoneId}),n=[];e.forEach(function(e){n.push(e.rewards[0])}),console.log("[BP_REWARD_DEBUG] Weekly raw rewards array:",n);var o={};n.forEach(function(e,t){o["item"+(t+1)]=e}),console.log("[BP_REWARD_DEBUG] Weekly converted to object:",o);var r=[];window.equipment.getItemFromReward(r,o),console.log("[BP_REWARD_DEBUG] Weekly converted rewards:",r),net.updateData({items:r},function(e,n){if(e)return console.error("[BP_REWARD_DEBUG] \u274c Failed to send weekly rewards to server:",e),void kit.info("Failed to save rewards to server. Please try again.");"undefined"!=typeof money&&"function"==typeof money.update&&money.update(n),window.TaskBattlePassServer?window.TaskBattlePassServer.saveMultipleMilestoneClaims("weekly",a,function(e){e?(console.error("[TaskPopup] \u274c Failed to save weekly milestones:",e),kit.info("Failed to save rewards to server. Please try again.")):(window.WeeklyMilestones.claimMilestonesByIds(a),t.updateClaimAllButtonState(),console.log("[BP_REWARD_DEBUG] Showing weekly popup with items:",r),menuManager.pop("loot",{tid:"sign",items:r,checkCb:function(){console.log("[BP_REWARD_DEBUG] Weekly popup closed")}}),i.FirebaseTracking.setDataBiRes("Task_ClaimAllWeekly"))}):(window.WeeklyMilestones.claimMilestonesByIds(a),t.updateClaimAllButtonState(),menuManager.pop("loot",{tid:"sign",items:r,checkCb:function(){}}),i.FirebaseTracking.setDataBiRes("Task_ClaimAllWeekly"))})}else kit.info("No weekly rewards available to claim")}},onDoneAllTasksClicked:function(){if(window.TaskManager){var e=window.TaskManager.debugCompleteAllTasks();e>0?(window.TaskManager.saveToServer&&window.TaskManager.saveToServer(),this.refreshTaskList(),this.updateProgressBars(),"undefined"!=typeof kit&&kit.info("Completed "+e+" tasks!"),i.FirebaseTracking.setDataBiRes("Task_DebugDoneAll")):"undefined"!=typeof kit&&kit.info("All tasks already completed")}else console.error("[TaskPopup] TaskManager not available")},onResetAllTasksClicked:function(){if(window.TaskManager&&window.DailyMilestones&&window.WeeklyMilestones){var e=window.TaskManager.debugResetAllTasks();window.DailyMilestones.resetProgress&&window.DailyMilestones.resetProgress(),window.WeeklyMilestones.resetProgress&&window.WeeklyMilestones.resetProgress(),window.TaskManager.saveToServer&&window.TaskManager.saveToServer(),this.refreshTaskList(),this.refreshDailyMilestones(),this.refreshWeeklyMilestones(),this.updateProgressBars();var t="Reset "+e+" tasks + daily & weekly points!";"undefined"!=typeof kit&&kit.info(t),i.FirebaseTracking.setDataBiRes("Task_DebugResetAll")}else console.error("[TaskPopup] Task system not available")},onResetDailyTimerClicked:function(){if(window.TaskResetManager){window.TaskResetManager.debugForceDailyReset(),window.TaskManager&&window.TaskManager.resetProgress(),window.DailyMilestones&&window.DailyMilestones.resetProgress();var e="undefined"!=typeof TimeManager?TimeManager.Instance.now():Date.now();window.TaskResetManager.setLastDailyReset(e),window.TaskBattlePassServer&&window.TaskBattlePassServer.handleDailyReset(),this.refreshTaskList(),this.refreshDailyMilestones(),this.updateProgressBars(),"undefined"!=typeof kit&&kit.info("Daily reset triggered! Tasks and daily milestones cleared."),i.FirebaseTracking.setDataBiRes("Task_DebugResetDailyTimer")}else console.error("[TaskPopup] TaskResetManager not available")},onResetWeeklyTimerClicked:function(){if(window.TaskResetManager){window.TaskResetManager.debugForceWeeklyReset(),window.WeeklyMilestones&&window.WeeklyMilestones.resetProgress();var e="undefined"!=typeof TimeManager?TimeManager.Instance.now():Date.now();window.TaskResetManager.setLastWeeklyReset(e),window.TaskBattlePassServer&&window.TaskBattlePassServer.handleWeeklyReset(),this.refreshWeeklyMilestones(),this.updateProgressBars(),"undefined"!=typeof kit&&kit.info("Weekly reset triggered! Weekly milestones cleared."),i.FirebaseTracking.setDataBiRes("Task_DebugResetWeeklyTimer")}else console.error("[TaskPopup] TaskResetManager not available")},showDebugPopupClicked:function(){this.debugPopup.active=!this.debugPopup.active},showBattlePassPopupClicked:function(){this.battlePopup.active||(this.battlePopup.active=!0)},showTaskPopupClicked:function(){this.battlePopup.active&&(this.battlePopup.active=!1)},updateNotifyLabel:function(){if(this.notifyLabel&&cc.isValid(this.notifyLabel.node)&&window.TaskManager){var e=!0;window.TaskManager.getTasks().forEach(function(t,i){var a=window.TaskManager.getProgress(i);a&&a.claimed||(e=!1)}),e?(this.notifyLabel.node.active=!0,this.notifyLabel.string="All tasks today are completed!",console.log("[TaskPopup] \ud83c\udf89 All tasks completed! Showing notify label")):(this.notifyLabel.node.active=!1,console.log("[TaskPopup] Tasks remaining, hiding notify label"))}},onDestroy:function(){this.unschedule(this.updateTimers)}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],TaskResetManager:[function(e,t,i){"use strict";cc._RF.push(t,"0930bkVrhJCk4BCq7ArkBDe","TaskResetManager"),Object.defineProperty(i,"__esModule",{value:!0});var a=e("../TimeManager"),n=function(){function e(){this.lastDailyReset=0,this.lastWeeklyReset=0,this.GMT_OFFSET=252e5,this.DEV_MODE=!1}return e.prototype.getCurrentTime=function(){return this.DEV_MODE?Date.now():a.default.Instance.now()},e.prototype.checkDailyReset=function(){var e=this.getCurrentTime();return!!(e>=this.getScheduledDailyResetAfter(this.lastDailyReset)-1e3)&&(this.lastDailyReset=e,!0)},e.prototype.checkWeeklyReset=function(){var e=this.getCurrentTime();return!!(e>=this.getScheduledWeeklyResetAfter(this.lastWeeklyReset)-1e3)&&(this.lastWeeklyReset=e,!0)},e.prototype.getNextDailyResetTime=function(){var e=this.getCurrentTime()+this.GMT_OFFSET;return 864e5*Math.floor(e/864e5)+864e5-this.GMT_OFFSET},e.prototype.getNextWeeklyResetTime=function(){var e,t=this.getCurrentTime()+this.GMT_OFFSET,i=new Date(t).getUTCDay();return e=0===i?1:1===i?t>=864e5*Math.floor(t/864e5)?7:0:8-i,864e5*Math.floor(t/864e5)+864e5*e-this.GMT_OFFSET},e.prototype.getScheduledDailyResetAfter=function(e){var t=e+this.GMT_OFFSET;return 864e5*Math.floor(t/864e5)+864e5-this.GMT_OFFSET},e.prototype.getScheduledWeeklyResetAfter=function(e){var t,i=e+this.GMT_OFFSET,a=new Date(i).getUTCDay();return 0===a?t=1:0==(t=(8-a)%7)&&(t=7),864e5*Math.floor(i/864e5)+864e5*t-this.GMT_OFFSET},e.prototype.getTimeUntilDailyReset=function(){var e=this.getNextDailyResetTime(),t=this.getCurrentTime();return Math.max(0,e-t)},e.prototype.getTimeUntilWeeklyReset=function(){var e=this.getNextWeeklyResetTime(),t=this.getCurrentTime();return Math.max(0,e-t)},e.prototype.formatTimeRemaining=function(e){var t=Math.floor(e/36e5),i=Math.floor(e%36e5/6e4),a=Math.floor(e%6e4/1e3);return t.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")},e.prototype.formatTimeRemainingWithDays=function(e){var t=Math.floor(e/864e5),i=Math.floor(e%864e5/36e5),a=Math.floor(e%36e5/6e4),n=Math.floor(e%6e4/1e3);return t>0?t+"d "+i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0"):i.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")},e.prototype.setLastDailyReset=function(e){this.lastDailyReset=e},e.prototype.setLastWeeklyReset=function(e){this.lastWeeklyReset=e},e.prototype.getLastDailyReset=function(){return this.lastDailyReset},e.prototype.getLastWeeklyReset=function(){return this.lastWeeklyReset},e.prototype.getResetInfo=function(){var e=this.getCurrentTime(),t=this.getNextDailyResetTime(),i=this.getNextWeeklyResetTime();return{currentTime:e,nextDailyReset:t,nextWeeklyReset:i,timeUntilDaily:this.formatTimeRemaining(t-e),timeUntilWeekly:this.formatTimeRemainingWithDays(i-e)}},e.prototype.debugForceDailyReset=function(){var e=this.getCurrentTime(),t=e-9e7;console.log("[TaskResetManager] \ud83d\udc1b DEBUG: Forcing daily reset"),console.log("[TaskResetManager] \ud83d\udc1b Current time:",new Date(e).toISOString()),console.log("[TaskResetManager] \ud83d\udc1b Setting lastDailyReset to:",new Date(t).toISOString()),this.lastDailyReset=t,console.log("[TaskResetManager] \ud83d\udc1b Next checkDailyReset() will return true")},e.prototype.debugForceWeeklyReset=function(){var e=this.getCurrentTime(),t=e-6912e5;console.log("[TaskResetManager] \ud83d\udc1b DEBUG: Forcing weekly reset"),console.log("[TaskResetManager] \ud83d\udc1b Current time:",new Date(e).toISOString()),console.log("[TaskResetManager] \ud83d\udc1b Setting lastWeeklyReset to:",new Date(t).toISOString()),this.lastWeeklyReset=t,console.log("[TaskResetManager] \ud83d\udc1b Next checkWeeklyReset() will return true")},e}();i.default=n,cc._RF.pop()},{"../TimeManager":"TimeManager"}],TeamBar:[function(e,t){"use strict";cc._RF.push(t,"821f76X9M1McJv7ewp5RdBL","TeamBar"),cc.Class({extends:cc.Component,properties:{icon:cc.Node,barNode:cc.Node},init:function(e,t){this.obj=t,this.game=e,this.icon.active=!1,this.initUI()},initUI:function(){var e=this.obj.config.revive,t=e.remoteList,i=e.deathCt;for(var a in this.barNode.destroyAllChildren(),t){var n=cc.instantiate(this.icon);this.barNode.addChild(n),n.active=!0,n.getComponent("TeamHead").init(t[a],a<i)}},update:function(){var e=this.obj;(this.game.finished||e.removed)&&this.node.destroy()}}),cc._RF.pop()},{}],TeamHead:[function(e,t){"use strict";cc._RF.push(t,"e37908T5X1CMKrTH3wUktrp","TeamHead"),cc.Class({extends:cc.Component,properties:{bgSprite:cc.Sprite,humanNode:cc.Node,gunNode:cc.Node,closeNode:cc.Node},init:function(e,t){var i=e.remote;this.humanNode.getComponent("HumanModel").init(ENTITY[HUMAN],{face:i.face,grep:[HEAD,TRUNK,LEFT_HAND,RIGHT_HAND]}),this.gunNode.getComponent("GunModel").init(WEAPON_TABLE[i.guns.left_gun.i],{noShadow:1}),this.closeNode.active=e.death;var a=cc.Material.getBuiltinMaterial(t?"2d-gray-sprite":"2d-sprite");this.bgSprite.setMaterial(0,a),this.bgSprite.node.color=t?cc.color(100,100,100):cc.color(255,255,255)}}),cc._RF.pop()},{}],TeslaTower:[function(e,t){"use strict";cc._RF.push(t,"e1810KerStFE7270PBemrZL","TeslaTower"),e("../../scripts/define");var i=e("./MyTower"),a=(e("../projectiles/PowerBullet"),e("../projectiles/BallBulletSprite"),e("../projectiles/MissileSprite"),e("../../ai/units/AIMyTower"));BULLET_DEFINE.tesla_tower=[{name:"\u7535\u51fb",ctor:e("../../scripts/Electric"),shot:e("../../scripts/Electric").shot,radius:600,dmg:35,kb:100.1,life:.31,chainDegression:.8,chainRange:3100,dx:65,dy:115,hitCt:1,chain:5,dmgType:DMG_TYPE.fire}];var n=[{t:.5,ani:1},{t:.13,x:0,y:0,blt:1,sound:"sound/Electric",volume:.3},{t:2}];ENTITY.tesla_tower={id:"tesla_tower",hero:!0,category:"tesla_tower",name:"\u7535\u5854",avatar:{animeName:"dianta",anime:"weapon/dianta",s:.9,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,crit:0,bltDmg:80,heatUpOnShot:2,heatMin:0,heat:{attr:{},attackVolume:1,attackSequence:n},overHeat:{attr:{atkSpd:.5},attackSequence:n},blt:BULLET_DEFINE.tesla_tower,bltMax:0,bltReload:1.5,attackCenter:cc.v2(85,160),attackVolume:.1,attackSequence:n,attackAngle:[-40,80],pilot:{ctor:a,attackRange:1700,seekRange:1700,offsetX:0,offsetY:-20}},RES.tesla_tower=[{frm:"avatar/backpack/item/\u7535\u78c1\u7ebf\u5708"}],ENTITY.tesla_tower_2={id:"tesla_tower_2",hero:!0,category:"tesla_tower",name:"\u7535\u58542",avatar:{animeName:"dianta2",anime:"weapon/dianta",s:.9,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,crit:0,bltDmg:120,blt:BULLET_DEFINE.tesla_tower,bltMax:0,bltReload:1.5,attackCenter:cc.v2(85,160),attackVolume:.1,attackSequence:n,heatUpOnShot:2,heatMin:0,heat:{attr:{},attackVolume:1,attackSequence:n},overHeat:{attr:{atkSpd:.5},attackSequence:n},attackAngle:[-40,80],pilot:{ctor:a,attackRange:1700,seekRange:1700,offsetX:0,offsetY:-20}},ENTITY.tesla_tower_3={id:"tesla_tower_3",hero:!0,category:"tesla_tower",name:"\u7535\u58543",avatar:{animeName:"dianta3",anime:"weapon/dianta",s:.9,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,crit:0,bltDmg:180,blt:BULLET_DEFINE.tesla_tower,bltMax:0,bltReload:1.5,attackCenter:cc.v2(85,160),attackVolume:.1,attackSequence:n,heatUpOnShot:2,heatMin:0,heat:{attr:{},attackVolume:1,attackSequence:n},overHeat:{attr:{atkSpd:.5},attackSequence:n},attackAngle:[-40,80],pilot:{ctor:a,attackRange:1700,seekRange:1700,offsetX:0,offsetY:-20}},ENTITY.tesla_tower_4={id:"tesla_tower_4",hero:!0,category:"tesla_tower",name:"\u7535\u58544",avatar:{animeName:"dianta4",anime:"weapon/dianta",s:.9,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,crit:0,bltDmg:270,blt:BULLET_DEFINE.tesla_tower,bltMax:0,bltReload:1.5,attackCenter:cc.v2(85,160),attackVolume:.1,attackSequence:n,heatUpOnShot:2,heatMin:0,heat:{attr:{},attackVolume:1,attackSequence:n},overHeat:{attr:{atkSpd:.5},attackSequence:n},attackAngle:[-40,80],pilot:{ctor:a,attackRange:1700,seekRange:1700,offsetX:0,offsetY:-20}},cc._RF.pop()},{"../../ai/units/AIMyTower":"AIMyTower","../../scripts/Electric":"Electric","../../scripts/define":"define","../projectiles/BallBulletSprite":"BallBulletSprite","../projectiles/MissileSprite":"MissileSprite","../projectiles/PowerBullet":"PowerBullet","./MyTower":"MyTower"}],Theme:[function(e,t){"use strict";cc._RF.push(t,"dcbb5oGE3NMv4B/PLw7YOz8","Theme"),window.THEME_DEFINE={dust:{ui:"theme/ui/dust",bg:{prefab:"theme/bg"},list:{house:"theme/\u70c2\u697c"}},tunnel:{ui:"theme/ui/tunnel",bg:{prefab:"theme/bg2"},list:{house:"theme/\u70c2\u697c"}},garden:{ui:"theme/ui/garden",bg:{prefab:"theme/bg3"},list:{house:"theme/\u70c2\u697c"}},snow:{ui:"theme/ui/snow",bg:{prefab:"theme/bg5"},list:{house:"theme/\u70c2\u697c"}},snow2:{ui:"theme/ui/snow",bg:{prefab:"theme/bg5_2"},list:{house:"theme/\u70c2\u697c"}},forest:{ui:"theme/ui/forest",bg:{prefab:"theme/bg4"},list:{house:"theme/\u70c2\u697c"}},forest2:{ui:"theme/ui/forest2",bg:{prefab:"theme/bg4_2"},list:{house:"theme/\u70c2\u697c"}},dock:{ui:"theme/ui/dock",bg:{prefab:"theme/bg6"},list:{}},factory:{ui:"theme/ui/factory",bg:{prefab:"theme/bg7"},list:{}},factory2:{ui:"theme/ui/factory",bg:{prefab:"theme/bg7_2"},list:{}},test1:{ui:"theme/ui/dock",bg:{prefab:"theme/bg_checkpoint"},list:{}},test2:{ui:"theme/ui/dock",bg:{prefab:"theme/bg_checkpoint_2"},list:{}}};var i=e("../entities/environment/GroundAvatar");cc.Class({init:function(e){this.layer=e},initMap:function(e,t){var i=this;this.game=e,this.layer=e.layer;var a=(e.config.remotes||{}).themeDefine||THEME_DEFINE[t.config.theme||"dust"],n=e.effectMgr,o=a.bg;o.prefab&&n.instantiate(o.prefab,function(o,r){e.layer.gameNode.addChild(r),r.setPosition(0,150);var s=r.getComponent("Background");for(var c in s.init(e.layer),s.grounds)s.grounds[c].active=!1;i.bgNode=r;var l=r.getChildByName("entity");if(l){var d=t.scene;for(var h in d){var u=d[h],p=a.list[u.i];if(p){var f=n.createSprite(u.x,u.y,p);l.addChild(f)}}i.sceneNode=l,i.layer.midLayer.parent=l,i.layer.topLayer.parent=l,i.initGround(t.ground)}else cc.error("\u6ca1\u5b9a\u4e49\u573a\u666f\u8282\u70b9")})},initGround:function(e){var t=this.game.levelMgr.cameraX,a=t-400/GAME_VIEW_SCALE,n=t+400/GAME_VIEW_SCALE,o=this.bgNode.getComponent("Background").grounds,r=this.bgNode.getComponent("Background").material,s=this.game.effectMgr;for(var c in this.avatarList=[],e){var l=o[c<o.length?c:o.length-1],d=l.getComponent(cc.Sprite).spriteFrame,h=l.color,u=l.y-this.sceneNode.y;c>0&&o.length>1&&(u-=147*c);var p=new cc.Node;this.layer.addToCamera(p,1e3*-c);var f=e[c].list,m=p.addComponent(i);m.initGround({effectMgr:s,list:f,left:a,right:n,dx:0,dy:u,spriteFrame:d,color:h,material:r}),this.avatarList.push(m)}},updateGround:function(){var e=this.game.levelMgr.cameraX,t=e-400/GAME_VIEW_SCALE,i=e+400/GAME_VIEW_SCALE;for(var a in this.avatarList)this.avatarList[a].updateGround(t,i)},createCheckPoint:function(e){var t=this.game.effectMgr.createArmature("qizhi","qizhi",function(e,t){t.playAnimation("stand")});t.scale=ANIME_SCALE,t.setPosition(e,this.game.contactMgr.findGroundLine(e)-5),this.layer.addToCamera(t,-1),this.cp=t},refreshCheckPoint:function(){if(this.cp){var e=this.cp.armatureDisplay;e&&(e.playAnimation("shengqi"),e.on(dragonBones.EventObject.LOOP_COMPLETE,function t(){e.playAnimation("stand2"),e.off(dragonBones.EventObject.LOOP_COMPLETE,t)})),this.game.callEffect(EFFECT.winBomb,this.cp)}},updateReal:function(e){this.updateGround(e)}}),cc._RF.pop()},{"../entities/environment/GroundAvatar":"GroundAvatar"}],TimeManager:[function(e,t,i){"use strict";cc._RF.push(t,"ed7a4Nhp6hNZ6kBpZmPvcX0","TimeManager"),Object.defineProperty(i,"__esModule",{value:!0}),i.gameTime=void 0;var a=function(){function e(){this._dateTimeOffset=0,this._lastCheckTime=0,this._lastGameTime=0,this._isInitialized=!1,this.CHECK_INTERVAL=1e3,this.MAX_NORMAL_TIME_DIFF=5e3,this.MIN_BACKWARD_JUMP=1e3,this._onTimeManipulationDetected=null,this._checkInterval=null}return Object.defineProperty(e,"Instance",{get:function(){return e._instance||(e._instance=new e,e._instance.initialize()),e._instance},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){this._lastCheckTime=Date.now(),this._lastGameTime=this._lastCheckTime,this.startChecking(),cc.game.on(cc.game.EVENT_HIDE,this.onAppHide,this),cc.game.on(cc.game.EVENT_SHOW,this.onAppShow,this)},e.prototype.startChecking=function(){var e=this;this._checkInterval&&clearInterval(this._checkInterval),this._checkInterval=setInterval(function(){e.checkTimeConsistency()},this.CHECK_INTERVAL)},e.prototype.stopChecking=function(){this._checkInterval&&(clearInterval(this._checkInterval),this._checkInterval=null)},e.prototype.destroy=function(){this.stopChecking(),cc.game.off(cc.game.EVENT_HIDE,this.onAppHide,this),cc.game.off(cc.game.EVENT_SHOW,this.onAppShow,this),e._instance=null},e.prototype.initializeWithServerTime=function(e){var t=Date.now();this._dateTimeOffset=e-t,this._lastCheckTime=t,this._lastGameTime=e,this._isInitialized=!0,cc.log("TimeManager initialized: offset = "+this._dateTimeOffset+"ms")},e.prototype.now=function(){if(!this._isInitialized)return Date.now();var e=Date.now()-this._lastCheckTime;return this._lastGameTime+e},e.prototype.getOffset=function(){return this._dateTimeOffset},e.prototype.setTimeManipulationCallback=function(e){this._onTimeManipulationDetected=e},e.prototype.checkTimeConsistency=function(){var e=Date.now(),t=e-this._lastCheckTime,i=this._lastGameTime+t;if(t<0||t>this.MAX_NORMAL_TIME_DIFF){var a=t<0?t:t-this.CHECK_INTERVAL;this.handleTimeJump(a,e)}else this._lastCheckTime=e,this._lastGameTime=i},e.prototype.handleTimeJump=function(e,t){cc.warn("Time manipulation detected! Jump: "+e+"ms"),this._lastCheckTime=t,this._dateTimeOffset=this._lastGameTime-t,this._onTimeManipulationDetected&&this._onTimeManipulationDetected(e),cc.log("Time offset adjusted to: "+this._dateTimeOffset+"ms")},e.prototype.onAppHide=function(){var e=Date.now(),t=e-this._lastCheckTime;this._lastGameTime+=t,this._lastCheckTime=e,cc.log("App went to background, storing time state")},e.prototype.onAppShow=function(){cc.log("App returned from background, checking time consistency");var e=Date.now(),t=e-this._lastCheckTime;t<0?(cc.warn("Device time went backward while in background!"),this.handleTimeJump(t,e)):t<1e3?(cc.warn("Suspicious quick background/foreground transition"),this._lastCheckTime=e,this._dateTimeOffset=this._lastGameTime-e):(this._lastGameTime+=t,this._lastCheckTime=e,this._dateTimeOffset=this._lastGameTime-e)},e.prototype.resyncWithServer=function(e){var t=this._dateTimeOffset;this.initializeWithServerTime(e);var i=this._dateTimeOffset-t;Math.abs(i)>1e3&&cc.warn("Large offset change during resync: "+i+"ms")},e.prototype.getTimeStats=function(){return{offset:this._dateTimeOffset,deviceTime:Date.now(),gameTime:this.now(),initialized:this._isInitialized}},e._instance=null,e}();i.default=a,i.gameTime=function(){return a.Instance?a.Instance.now():(cc.warn("TimeManager not initialized, using device time"),Date.now())},cc._RF.pop()},{}],TopBar:[function(e,t){"use strict";cc._RF.push(t,"75450QgmM1G0bvBh4r6hSQo","TopBar");var i=e("../../../../Plugins/firebase/FirebaseTracking");cc.Class({extends:cc.Component,properties:{coinAudio:{type:cc.AudioClip,default:null},energyAudio:{type:cc.AudioClip,default:null},upAudio:{type:cc.AudioClip,default:null},buyAudio:{type:cc.AudioClip,default:null},talentLabel:cc.Label,diamondLabel:cc.Label,energyLabel:cc.Label,expLabel:cc.Label,goldLabel:cc.Label,energyRecoverLabel:cc.Label,sweepTicketLabel:cc.Label,gold:cc.Node,exp:cc.Node,diamond:cc.Node,talent:cc.Node,energy:cc.Node,sweepTicket:cc.Node},onLoad:function(){console.log("[Update Money] Top Bar1");var e=this;this.showTable={},this.visibleTable={},cc.game.on("add_money",this.onAddMoney,this),cc.game.on("use_money",this.onUseMoney,this),this.layout=this.getComponent(cc.Layout);var t=function(){if(void 0!==money.energyTimeout){var t=money.getEnergyFullTime()/1e3;e.energyRecoverLabel.string=LI("energy_time",{n:kit.second2date(t)})}else e.energyRecoverLabel.string=""};t(),this.schedule(t,1);var i=sdk.pt();if(i&&i.getMenuButtonBoundingClientRect){var a=i.getMenuButtonBoundingClientRect(),n=cc.view.getDevicePixelRatio(),o=cc.winSize.width-a.left*n/cc.view.getScaleX();this.node.getComponent(cc.Widget).right=o}},init:function(e){var t;if(console.log("[Update Money] Top Bar2"),console.log("Show Top Bar bt config",e),this.args=e,e){this.money=e.money;var i=e.visible;if(i)for(var a in i)this.visibleTable[a]=i[a]}var n=((t={})[GOLD]=1,t[DIAMOND]=10,t[EXP]=10,t[ENERGY]=5,t[SWEEP_TICKET]=0,t);for(var o in n)this.initMoney(o,this[o+"Label"],this[o],n[o]);if(console.log(this.visibleTable),e&&e.active)for(var r in e.active)this[r].getParent().active=!0},initMoney:function(e,t,i,a){console.log("[Update Money] Top Bar3");var n=i.getParent();this.showTable[e]||(this.showTable[e]={type:e,s:a,label:t,node:i,fly:0});var o=this.money;if(o&&(o[e]||0===o[e]))var r=o[e];else r=money.getNum(e);this.showTable[e].n0=r,this.showTable[e].n1=r,t.string=Math.round(r);var s=this.visibleTable[e];this.showTable[e].active=s,n.active=s},updateMoney:function(e){e.n1!=e.n0&&(Math.abs(e.n1-e.n0)<1?e.n0=e.n1:e.n0=e.n0+.1*(e.n1-e.n0),e.label.string=Math.round(e.n0))},update:function(){for(var e in this.showTable)this.updateMoney(this.showTable[e])},updateFly:function(e,t,i){t.fly+=i,0==t.fly?(t.n1=money.getNum(t.type),this.node.zIndex=9999,e.active=t.active,this.layout.updateLayout()):1==t.fly&&(this.node.zIndex=cc.macro.MAX_ZINDEX,e.active=!0,this.layout.updateLayout())},onUseMoney:function(e){var t=e.i,i=e.n;e.price&&(t=e.price.i,i=-e.price.n);var a=this.showTable[t];if(a&&(a.n1+=i,menuManager.playEffect(this.buyAudio,0),e.tid,!e.noFly)){var n=a.node,o=n.getParent();this.updateFly(o,a,1),o.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){this.updateFly(o,a,-1)},this)));for(var r=cc.Canvas.instance.node,s=e.pos||cc.v2(cc.winSize.width/2,cc.winSize.height/2),c=r.convertToNodeSpaceAR(s),l=r.convertToNodeSpaceAR(o.convertToWorldSpaceAR(cc.v2(0,0))),d=kit.clamp(Math.round(-(i||1)/a.s),1,10),h=0;h<d;h++){var u=cc.instantiate(n);r.addChild(u,cc.macro.MAX_ZINDEX),u.scale=1,u.x=l.x+kit.rnd(-50,50),u.y=l.y+kit.rnd(-50,50),u.runAction(cc.sequence(cc.bezierTo(.5,[cc.v2(l.x+kit.rnd(-200,200),l.y+kit.rnd(-200,0)),cc.v2(c.x+kit.rnd(-150,150),c.y+kit.rnd(-50,50)),c]).easing(cc.easeInOut(1)),cc.destroySelf()))}}},onAddMoney:function(e){var t=e.add;if(t)for(var i in this.showTable)this.addMoney(e,i,t[i],e.pos);else this.addMoney(e,e.i,e.n,e.pos)},addMoney:function(e,t,i,a){if(t&&i){var n=this.showTable[t];if(n)if(e.tid,e.noFly)n.n1+=i;else{var o=kit.clamp(Math.round((i||1)/n.s),1,10),r=n.node,s=r.getParent();this.updateFly(s,n,1),s.runAction(cc.sequence(cc.delayTime(3),cc.callFunc(function(){this.updateFly(s,n,-1)},this))),s.runAction(cc.sequence(cc.delayTime(.8),cc.callFunc(function(){n.n1+=i,menuManager.playEffect(this.upAudio,0)},this)));var c=cc.Canvas.instance.node,l=(a=a||cc.v2(cc.winSize.width/2,cc.winSize.height/2),c.convertToNodeSpaceAR(a)),d=c.convertToNodeSpaceAR(s.convertToWorldSpaceAR(cc.v2(0,0)));menuManager.playEffect(t==ENERGY?this.energyAudio:this.coinAudio,0);for(var h=0;h<o;h++){var u=cc.instantiate(r);c.addChild(u,cc.macro.MAX_ZINDEX),u.scale=1,u.x=l.x+kit.rnd(-20,20),u.y=l.y+kit.rnd(-20,20),u.runAction(cc.sequence(cc.jumpTo(.5+.05*h,l.x+kit.rnd(-150,150),l.y-20,40,2),cc.bezierTo(.3,[cc.v2(l.x+kit.rnd(-200,200),l.y+kit.rnd(-200,200)),cc.v2(d.x+kit.rnd(-200,200),d.y+kit.rnd(-200,0)),d]).easing(cc.easeIn(1)),cc.destroySelf()))}}}},streamerAddMoney:function(e,t){var a;if(H5VERSION){cc.log("streamerAddMoney",t);var n=9999;t==ENERGY&&(n=100),net.postSilent("updateData",{add:(a={},a[t]=n,a)},function(e,a){i.FirebaseTracking.setDataBiRes("streamerAddMoney"),money.update(a),cc.game.emit("add_money",{i:t,n:n})})}}}),cc._RF.pop()},{"../../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],TowerBar:[function(e,t){"use strict";cc._RF.push(t,"30773sCmwhPEq1xyrbSUHPh","TowerBar"),cc.Class({extends:cc.Component,properties:{hpBg:cc.Node,hpBar:cc.Node,epNode:cc.Node,epBar:cc.Node,epBgs:[cc.Node],hurtBar:cc.Node,warnBar:cc.Node,timeBar:cc.Node,heatNode:cc.Node,heatBar:cc.Node,changeNode:cc.Node,changeHead:cc.Node,lvlFrame:[cc.SpriteFrame],lvlSprite:cc.Sprite,aiNode:cc.Node,aiBar:cc.Node,aiFrame:[cc.SpriteFrame]},init:function(e,t,i,a){if(this.w=this.hpBar.width,this.game=e,this.obj=t,this.avatar=i,this.setLevel(t.config.lvl?t.config.lvl:1),t.heatMax>0){var n=t.define.attackAngle,o=n[0],r=n[1],s=this.fillRange=(r-o)/180*.5,c=.25-s/2,l=90+o;this.epBar.getComponent(cc.Sprite).fillRange=0,this.epBar.angle=l,this.epBgs[0].angle=l-c/.25*180,this.epBgs[0].getComponent(cc.Sprite).fillRange=s/2,this.epBgs[0].getComponent(cc.Sprite).fillStart=c,this.epBgs[1].angle=l,this.epBgs[1].getComponent(cc.Sprite).fillRange=s/2,this.epBgs[1].getComponent(cc.Sprite).fillStart=c,this.epBgs[0].color=cc.color(255,255,255),this.epBgs[1].color=cc.color(255,255,255)}else this.epNode.active=!1;if(this.hurtBar.opacity=0,this.warnBar.opacity=0,this.dx=(null==a?void 0:a.dx)||-10,this.dy=(null==a?void 0:a.dy)||15,this.node.setPosition(i.x,i.y+.5*this.w+15),this.heatNode.parent=null,this.game.layer&&this.game.layer.addToUI(this.heatNode),this.heatNode.opacity=0,this.changeNode.parent=null,this.game.layer&&this.game.layer.addToUI(this.changeNode),this.changeNode.opacity=0,this.changeNode.y=380,this.aiNode.parent=null,this.game.layer&&this.game.layer.addToUI(this.aiNode),e.config&&2==e.config.auto&&(this.aiBar.getComponent(cc.Sprite).spriteFrame=this.aiFrame[0]),t.hero){var d=t.hero.config.i,h=ENTITY[d].head,u=this.game.effectMgr.createSprite(0,0,h);this.changeHead.addChild(u),u.scale=.5}},onDestroy:function(){this.heatNode.destroy(),this.changeNode.destroy(),this.aiNode.destroy()},setLevel:function(e){void 0===e&&(e=1),this.lvlSprite.spriteFrame=this.lvlFrame[e-1]},enableAlwaysShow:function(){this.alwaysShow=!0},setVisible:function(e){this.node.active=e,this.aiNode.active=e,e&&this.lateUpdate(0)},refresh:function(){var e,t=this.obj;return this.hp=t.hp,null!=(e=this.game)&&e.config.gunnerMode?void(this.hpBg.opacity=0):(this.node.active=!1,void(this.aiNode.active=!1))},refreshEp:function(){var e=this.obj,t=e.heat/e.heatMax;e.isHeatOver()?this.epBar.color=cc.color(255,0,0):this.epBar.color=t<=.5?cc.color(510*t,255,0):cc.color(255,510*(1-t),0*(1-t));var i=this.fillRange*t;this.epBar.getComponent(cc.Sprite).fillRange=i,e.isHeatOver()?this.heatOverAction||(this.epBgs[0].color=cc.color(255,255,0),this.epBgs[1].color=cc.color(255,255,0),this.updateMsg(!0),this.heatOverAction=this.epBar.runAction(cc.sequence(cc.fadeOut(.5),cc.fadeIn(.5)).repeatForever()),this.heatNode.opacity=255,this.heatBar.opacity=255,this.heatBar.runAction(cc.sequence(cc.fadeTo(.5,50),cc.fadeTo(.5,255)).repeatForever())):this.heatOverAction&&(this.epBgs[0].color=cc.color(255,255,255),this.epBgs[1].color=cc.color(255,255,255),this.updateMsg(!1),this.epBar.stopAction(this.heatOverAction),this.heatOverAction=null,this.epBar.opacity=200,this.heatNode.opacity=0,this.heatBar.stopAllActions()),e.heatUpOnShot>10&&e.heatOn||e.isHeatOver()?(this.epBgs[0].opacity=150,this.epBgs[1].opacity=150):(this.epBgs[0].opacity=255,this.epBgs[1].opacity=255)},updateMsg:function(e){void 0===e&&(e=!0)},lateUpdate:function(){var e=this.obj;if(e.removed)this.node.destroy();else{var t=this.node;if(this.hp!=e.hp&&(this.hp<=0&&t.runAction(cc.fadeIn(.1)),this.refresh()),this.epNode.active=e.mainFlag,this.heatNode.active=e.mainFlag,this.epNode.angle=e.getDegree(),this.ep!=e.heat){if(e.hp<=0)return;this.ep=e.heat,this.refreshEp()}this.aiBar.active=e.mainFlag&&e.pilot.isAiEnabled();var i=this.avatar;if(i){var a=i.getPosition();t.setPosition(a.x+this.dx,a.y+this.dy)}}},startPress:function(){},endPress:function(){},onTouchBegan:function(e){var t,i;if(null!=(t=this.game)&&null!=(i=t.config)&&i.gunnerMode){var a=this.obj;if(a&&!a.isDead()){var n=this.game.layer.camera,o=a.avatar.node.convertToWorldSpaceAR(cc.v2(0,0)),r=(o=n.getWorldToScreenPoint(o)).x-e.x,s=o.y-e.y;if(Math.abs(r)<80&&Math.abs(s)<50)return this.startPress(),!0}}},onTouchMoved:function(){if(this.pressed)return!0},onTouchEnded:function(){if(this.pressed)return this.pressed=!1,this.endPress(),!0},onTouchCanceled:function(){if(this.pressed)return this.pressed=!1,this.endPress(),!0}}),cc._RF.pop()},{}],TrainMenu:[function(e,t){"use strict";cc._RF.push(t,"888d1kjrtpH8rVkJePxOUFT","TrainMenu");var i=e("../../Plugins/firebase/FirebaseTracking"),a=function(e){return kit.replaceString("{msg}\n<size=24><b><color=#f02140>(\u6311\u6218\u6b21\u6570 -1)</c></b></size>",{msg:e})};cc.Class({extends:e("../ui/core/PopMenu"),properties:{fadeOutPrefab:cc.Prefab,avatarNode:cc.Node,scrollView:cc.ScrollView,layoutNode:cc.Node,carNodes:[cc.Node],driverNode:cc.Node,startNode:cc.Node,debugNode:cc.Node,ctLabel:cc.Label,changeBtnNode:cc.Node,readyBtnNode:cc.Node,resetBtnNode:cc.Node,noTopBar:!0,iconFrame:cc.SpriteFrame,bgs:[cc.Node]},onLoad:function(){this.wheels=[],this.scrollView.node.on("scrolling",this.onScrolling,this),this.debugNode.active=DEBUG_MODE},start:function(){this.scrollToSelectOne()},scrollToSelectOne:function(e){void 0===e&&(e=0),this.selectOne&&(this.layoutNode.getComponent(cc.Layout).updateLayout(),this.scrollView.scrollToOffset(cc.v2(this.selectOne.x-this.scrollView.node.width/2,this.layoutNode.y),e))},onDebugClear:function(){user.setGuide("train",0),net.updateData({set:{trainSeed:0,trainRestartCt:2,trainDailyCt:2,trainCount:0,trainTowerIndex:0}},function(){pc.trainTowerIndex=0,pc.trainSeed=0,pc.trainCount=0,pc.trainRestartCt=2,pc.trainDailyCt=2,train.reset(),menuManager.refresh()})},onDebugDeath:function(){train.death(),menuManager.refresh()},onDebugNextLevel:function(){train.saveData&&(train.mapIndex++,train.save(train.saveData.vehicleConfig,train.mapIndex),menuManager.refresh())},initStatus:function(){this.carList=[],this.initWheel(this.carNodes[0]),this.carNodes[1].active=!1,this.initUI(),menuManager.popCover({noLoading:!0,prefab:menuManager.currentRun().fadeOutPrefab}).fadeOut(),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){this.startUI()},this)));var e=[50,200,250,300,400];for(var t in this.bgs)this.bgs[t].runAction(cc.moveBy(1,-e[t],0));for(var i in this.wheels)this.wheels[i].runAction(cc.rotateBy(1,-720,0))},refreshResetBtn:function(){this.ctLabel.string="\u6311\u6218\u6b21\u6570: "+pc.trainRestartCt+" / 2";var e=pc.trainRestartCt>0&&(this.deathFlag&&this.reviveFlag||pc.trainTowerIndex>this.trainData.length);this.resetBtnNode.getChildByName("rp").active=e,pc.trainTowerIndex>this.trainData.length?this.resetBtnNode.getChildByName("label").getComponent(cc.Label).string="\u4e0b\u4e00\u5173":this.resetBtnNode.getChildByName("label").getComponent(cc.Label).string="\u91cd\u65b0\u6311\u6218"},startUI:function(){var e=this;user.getGuide("train")?this.deathFlag&&this.reviveFlag?menuManager.pop("check",{title:"\u91cd\u7f6e\u786e\u8ba4",info:a("\u4f60\u5012\u4e0b\u4e86\uff0c\u65e0\u6cd5\u6218\u6597\n\u73b0\u5728\u91cd\u65b0\u6311\u6218\u5417\uff1f"),noWait:!0,checkCb:function(t){if(t)return e.reset()}}):this.jump():menuManager.chatOn(null,"\u6218\u6597\u6f14\u4e60\u65f6\u95f4\u5230\uff01\u8fd9\u65e0\u9650\u5217\u8f66\uff0c\n\u73b0\u5728\u5c31\u662f\u4f60\u4eec\u7684\u6218\u573a\uff01",2,{noBlack:0,head:"h99",dx:-120,dy:-200},function(){menuManager.chatOn(null,"\u8fd9\u91cc\u7684\u6218\u6597\u5168\u9760\u4f60\u4eec\u81ea\u5df1\uff0c\n\u6211\u53ea\u8d1f\u8d23\u5fc5\u6740\u548c\u9053\u5177\u2026\u2026",2,{noBlack:0,head:"h99",dx:-120,dy:-200},function(){menuManager.chatOn(null,"\u5feb\uff01\u6253\u8d77\u6765\u6253\u8d77\u6765\uff0c\u6211\u6765\u4e3b\u653b\uff01",2,{noBlack:0,head:"h99",dx:-120,dy:0},function(){user.setGuide("train",1),e.jump()})})})},initUI:function(){var e=this;for(var t in this.carList)for(var i in this.carList[t].active=!1,this.carList[t].floorList)this.carList[t].floorList[i].active=!1;this.trainData=train.getTrainData();var a=cc.find("safeArea/money_bar",this.node).getComponent("MoneyBar"),n=this.avatarNode.getChildByName("vehicle_model").getComponent("VehicleModel");if(pc.trainTowerIndex<=0){var o;train.reset(),pc.trainTowerIndex=0;var r=pc.getChooseVehicle(),s=pc.getVehicleData(r.id),c=pc.getTeam();n.init(s,{driver:0,team:c}),a.init({money:(o={},o[SILVER]=0,o)}),this.readyBtnNode.active=!0,this.changeBtnNode.active=!0,this.changeBtnNode.zIndex=10,this.readyBtnNode.onTouch=function(){c.length<1?kit.info("\u6ca1\u6709\u961f\u5458, \u4e0d\u80fd\u5f00\u6218"):net.updateData({set:{trainTowerIndex:1}},function(){pc.trainTowerIndex=1,train.load(),train.getTrainSaveData(),e.readyBtnNode.active=!1,e.changeBtnNode.active=!1,e.refreshUI(),e.jump()})},this.changeBtnNode.onTouch=function(){menuManager.run("main",{hot:"garage"})},this.mapIndex=0,this.selectOne=this.startNode}else{train.load();var l=train.getTrainSaveData();this.mapIndex=l.mapIndex||0,this.deathFlag=l.death,this.reviveFlag=l.revive;var d=l.vehicleConfig;d.stack=chapter.data.stack,d.driver=0;var h,u=pc.getVehicleData(d.vid);n.init(u,d);var p=train.getFloorData(this.mapIndex);p&&a&&a.init({money:(h={},h[SILVER]=l.data[SILVER]-p.data.money,h)}),cc.error("this.mapIndex",this.mapIndex),cc.error(" pc.trainTowerIndex",pc.trainTowerIndex),this.readyBtnNode.active=!1,this.changeBtnNode.active=!1}cc.error("this.reviveFlag",this.reviveFlag),this.refreshUI()},refreshUI:function(){this.refreshResetBtn();var e=this.trainData;cc.log("trainData",e);var t=-1,i=!1;for(var a in e){var n=e[a],o=this.carList[a];o||(this.carList[a]=o=cc.instantiate(this.carNodes[1]),this.layoutNode.addChild(o),o.floorList=[]),o.active=!0,this.initCarriage(o,n),n.floors[n.floors.length-1];var r=n.floors[0];this.mapIndex>=r.index&&pc.trainTowerIndex>a&&(t=+a,this.mapIndex==r.index&&(i=!0))}cc.error("towerIndex",t);var s=this.carList[t-1],c=this.avatarNode;s&&(this.reviving||this.deathFlag||!i?(c.parent=s,c.x=0):(c.parent=s,c.x=-205,c.runAction(cc.sequence(cc.delayTime(.5),cc.moveTo(1,0,c.y).easing(cc.easeInOut(2))))))},initCarriage:function(e,t){var n=this;this.initWheel(e);var o=pc.trainTowerIndex-1,r=o==t.towerIndex&&this.mapIndex>t.floors[t.floors.length-1].index,s=o>t.towerIndex,c=t.item,l=cc.find("layout/top/item_node",e),d=l.getChildByName("item").getComponent("Item");d.init(c),d.setGray(s),l.getChildByName("item_shine").active=r&&!s;var h=cc.find("layout/top/btn",e);h.active=r&&!s,h.onTouch=function(){r&&!s&&net.updateData({add:{trainTowerIndex:1},items:[c]},function(e,t){pc.trainTowerIndex=t.trainTowerIndex,i.FirebaseTracking.setDataBiRes("TrainTower"),money.update(t),menuManager.pop("loot",{items:[c],tid:"train_loot",tname:"\u5217\u8f66\u53cc\u500d",videoItems:[c],closeCb:function(){n.refreshUI(),n.jump(),pc.trainTowerIndex>n.trainData.length&&menuManager.pop("check",{title:"\u65b0\u7684\u6311\u6218",info:a("\u4f60\u901a\u5173\u4e86\n\u73b0\u5728\u524d\u5f80\u4e0b\u4e00\u8f86\u5217\u8f66\u5417\uff1f"),noWait:!0,checkCb:function(e){if(e)return n.reset()}})}})})};var u=e.getChildByName("btn_start");u.active=!1;var p=t.floors,f=e.getChildByName("layout");f.getChildByName("top").zIndex=999;var m=f.getChildByName("cell");m.active=!1;var g=!1,v=function(i){var a=p[i],r=a.data,s=e.floorList[i];s||(e.floorList[i]=s=cc.instantiate(m),f.addChild(s),s.zIndex=i,s.name=i),s.active=!0;var c=a.index==n.mapIndex&&o>=t.towerIndex;g=g||c;var l=a.enemy,d=s.getChildByName("display");if(l&&a.index>=n.mapIndex){if(d.active=!0,d.enemy!=l){var h;d.enemy=l,d.destroyAllChildren();var v=ENTITY[l],y=v.avatar,b=.9,k=1;if(y.anime)h=menuManager.createArmature(y.anime,y.animeName,function(e,t){t.playAnimation(!n.deathFlag&&c?"attack":y.standAnime||"stand")}),k=ANIME_SCALE;else{var T=(h=new cc.Node).addComponent(cc.Sprite);cc.resources.load(y.frm,cc.SpriteFrame,function(e,t){T.spriteFrame=t})}d.addChild(h);var _=v.radius||v.hitRadius,w=v.height||_,E=y.dy||0;_>45&&(b*=45/_),h.position=cc.v2(0,(w+E)*b);var C=(y.s||1)*b*k;h.scale=C,d.scaleX=-(y.flipX||1)}}else d.active=!1;var S=s.getChildByName("reward");S.zIndex=1,S.active=a.index>=n.mapIndex,S.getChildByName("label").getComponent(cc.Label).string=r.money;var I=s.getChildByName("arrow");I.active=c,c?(I.stopAllActions(),I.x=-70,I.runAction(cc.sequence(cc.moveBy(.5,10,0),cc.moveBy(.3,-10,0)).repeatForever()),n.jumpToTrain(s,{anime:"attack"},function(){cc.game.emit("add_drop",{i:SILVER,n:+r.money,tid:"train",pos:S.convertToWorldSpaceAR(cc.v2(0,0))}),S.active=!1}),n.selectOne=e,u.active=!n.deathFlag,u.onTouch=function(){n.continue()}):n.mapIndex-1==a.index&&n.setToTrain(s,{}),s.onTouch=function(){c?n.continue():a.index>=n.mapIndex?kit.info("\u5c1a\u672a\u5f00\u542f, \u9700\u8981\u51fb\u8d25\u524d\u9762\u7684\u654c\u4eba"):kit.info("\u5df2\u7ecf\u6253\u8fc7\u4e86")}};for(var y in p)v(y);var b=e.getChildByName("btn_revive");b.active=g&&this.deathFlag&&!this.reviveFlag,b.onTouch=function(){n.deathFlag&&!n.reviveFlag&&sdk.useFree("train_revive",function(e){e||(train.revive(),n.deathFlag=0,n.reviving=1,n.refreshUI(),n.jump())})},r&&!s?(this.jumpToTrain(cc.find("layout/top",e),{anime:"happy"}),this.selectOne=e):s&&this.mapIndex-1==t.floors[t.floors.length-1].index&&(this.setToTrain(cc.find("layout/top",e),{}),o>=this.trainData.length&&(this.selectOne=e))},continue:function(){var e=this;if(this.deathFlag)menuManager.pop("check",{title:"\u91cd\u7f6e\u786e\u8ba4",info:a("\u4f60\u5012\u4e0b\u4e86\uff0c\u65e0\u6cd5\u6218\u6597\n\u73b0\u5728\u91cd\u65b0\u6311\u6218\u5417\uff1f"),noWait:!0,checkCb:function(t){if(t)return e.reset()}});else{menuManager.popCover({noLoading:!0,prefab:menuManager.currentRun().fadeOutPrefab}),menuManager.preload("checkpoint"),this.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){train.continue()},this)));var t=[50,200,250,300,400];for(var i in this.bgs)this.bgs[i].runAction(cc.moveBy(1,-t[i],0));for(var n in this.wheels)this.wheels[n].runAction(cc.rotateBy(1,-720,0))}},setToTrain:function(e,t){var i,a=t.anime,n=t.dx;i=void 0===n?-25:n;var o,r=t.dy;if(o=void 0===r?-58:r,!this.deathFlag&&!this.reviving){var s=this.driverNode;s.parent=e,s.position=cc.v2(i,o),a&&s.getComponent(dragonBones.ArmatureDisplay).playAnimation(a)}},jumpToTrain:function(e,t,i){var a,n=t.anime;a=void 0===n?"attack":n;var o,r=t.dx;o=void 0===r?-25:r;var s,c=t.dy;s=void 0===c?-58:c;var l=this.driverNode;if(this.deathFlag)return l.parent=e,l.position=cc.v2(-35,-58),void l.getComponent(dragonBones.ArmatureDisplay).playAnimation("dead");this.jumpAction=cc.sequence(cc.delayTime(.5),cc.callFunc(function(){var t=l.parent.convertToWorldSpaceAR(l.getPosition());l.parent=e,l.position=e.convertToNodeSpaceAR(t),l.getComponent(dragonBones.ArmatureDisplay).playAnimation("run")},this),cc.jumpTo(.5,cc.v2(o,s),60,1),cc.callFunc(function(){l.getComponent(dragonBones.ArmatureDisplay).playAnimation(a),i&&i()},this))},jump:function(){if(this.jumpAction){var e=this.driverNode;e.stopAllActions(),e.runAction(this.jumpAction)}},onScrolling:function(){this.updateWheel()},initWheel:function(e){e.attachWheel||(e.attachWheel=!0,this.wheels.push(e.getChildByName("w1")),this.wheels.push(e.getChildByName("w2")))},updateWheel:function(){var e=2*-this.scrollView.getScrollOffset().x%360;for(var t in this.wheels)this.wheels[t].angle=e+10*t},resetDriver:function(){var e=this.avatarNode;e.parent=this.carNodes[0],e.x=0,this.setToTrain(this.startNode,{anime:"stand",dx:94,dy:-65}),this.jumpToTrain(this.startNode,{anime:"stand",dx:94,dy:-65})},resetTrain:function(){for(var e in this.wheels)this.wheels[e].runAction(cc.rotateBy(2,3720,0).easing(cc.easeSineInOut()));this.scrollView.node.stopAllActions(),this.scrollView.node.stopAllActions(),this.scrollView.node.runAction(cc.sequence(cc.moveTo(1,-1500,0).easing(cc.easeSineIn()),cc.callFunc(function(){train.reset(),this.deathFlag=!1,this.reviving=!1,this.initUI(),this.resetDriver(),this.scrollToSelectOne()},this),cc.place(1500,0),cc.moveTo(1,0,0).easing(cc.easeSineOut()),cc.callFunc(function(){this.startUI()},this)))},reset:function(){var e=this;if(pc.trainRestartCt<=0)return pc.trainDailyCt>0||DEV_MODE&&DEBUG_MODE?menuManager.pop("video",{title:"\u5237\u65b0\u6311\u6218\u6b21\u6570",icon:this.iconFrame,name:"\u6311\u6218\u6b21\u6570 +1",count:"\u4eca\u65e5\u5269\u4f59\u6b21\u6570: "+pc.trainDailyCt,checkCb:function(t){if(t)return sdk.useFree("train_ct",function(t){t||net.updateData({add:{trainRestartCt:1,trainDailyCt:-1}},function(t,i){cc.log(t,i),t||(pc.trainRestartCt=i.trainRestartCt,pc.trainDailyCt=i.trainDailyCt,e.refreshResetBtn(),menuManager.close(),kit.info("\u4eca\u65e5\u6311\u6218\u6b21\u6570 +1"))})}),!0}}):kit.info("\u4eca\u65e5\u6311\u6218\u6b21\u6570\u5df2\u8017\u5c3d, \u8bf7\u660e\u5929\u518d\u8bd5\u5427"),!0;var t=kit.rndInt(1,999999);net.updateData({add:{trainRestartCt:-1,trainCount:pc.trainTowerIndex>this.trainData.length?1:0},set:{trainTowerIndex:0,trainSeed:t}},function(i,a){pc.trainTowerIndex=0,pc.trainSeed=t,pc.trainRestartCt=a.trainRestartCt||0,pc.trainCount=a.trainCount||0,e.resetTrain()})},onReset:function(){var e,t=this,i=pc.trainTowerIndex>this.trainData.length;e=i?"\u4e0b\u4e00\u5173":"\u91cd\u7f6e\u786e\u8ba4";var n=a(i?"\u524d\u5f80\u4e0b\u4e00\u5173":"\u73b0\u5728\u91cd\u65b0\u6311\u6218\u5417\uff1f");menuManager.pop("check",{title:e,info:n,noWait:!0,checkCb:function(e){if(e)return t.reset()}})}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],TransitionCover:[function(e,t){"use strict";cc._RF.push(t,"7bf61b8OfJNR4DPXu0ytAkM","TransitionCover"),cc.Class({extends:e("./Transition"),properties:{},fadeIn:function(){this.node.stopAllActions(),this.node.opacity=0,this.node.runAction(cc.fadeTo(.2,190))},fadeOut:function(){this.node.stopAllActions(),this.node.runAction(cc.sequence(cc.fadeOut(.1),cc.destroySelf()))}}),cc._RF.pop()},{"./Transition":"Transition"}],TransitionGo:[function(e,t){"use strict";cc._RF.push(t,"250cfMoYfRI4qjG2hEDUD5J","TransitionGo"),cc.Class({extends:e("./Transition"),properties:{cover:cc.Node},onLoad:function(){this.enabled=!1},getHalfWidth:function(){return(this.node.width+this.cover.width*this.cover.scale)/2},fadeIn:function(){this.cover.stopAllActions(),this.cover.x=this.getHalfWidth(),this.cover.runAction(cc.moveTo(1,580,0))},fadeOut:function(){this.cover.stopAllActions(),this.cover.x=580,this.cover.runAction(cc.moveTo(1,-this.getHalfWidth(),0)),this.node.runAction(cc.sequence(cc.delayTime(1),cc.destroySelf()))},transitionIn:function(e){this.enterTransition(e,this.getHalfWidth())},transitionOut:function(e){this.enterTransition(e,0),this.getComponent(cc.BlockInputEvents).enabled=!1},enterTransition:function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=-2),this.cover.stopAllActions(),this.cover.x=t,this.camera=e.camera;var a=this.camera.node;this.enabled=!0,this.moveRatio=i,this.x0=-i*a.x+t,this.y0=1*a.y},lateUpdate:function(){var e=this.camera.node,t=this.moveRatio;this.cover.x=this.x0+t*e.x,this.cover.y=this.y0-1*e.y}}),cc._RF.pop()},{"./Transition":"Transition"}],Transition:[function(e,t){"use strict";cc._RF.push(t,"783f4SyMOtBbKn54A0Ux4w9","Transition"),cc.Class({extends:cc.Component,properties:{},fadeIn:function(){},fadeOut:function(){this.node.destroy()},transitionIn:function(){},transitionOut:function(e){this.enterTransition(e,0)}}),cc._RF.pop()},{}],TutorialPopup:[function(e,t){"use strict";cc._RF.push(t,"d460cYXUi5EkbMwTiaYu19T","TutorialPopup");var i=e("../../Plugins/firebase/FirebaseTracking").FirebaseTracking;cc.Class({extends:e("../ui/core/PopMenu"),properties:{},initStatus:function(){},onTouchClose:function(){this.noWait||(i.logNewTutorial({Step:2,userID:user.uuid,Status:1}),this.close())}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],UserInfoMenu:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"8c9cfpFadRIbL2U9WeEnfER","UserInfoMenu"),cc.Class({extends:e("./CheckMenu"),properties:{headIcon:cc.Sprite,headName:cc.Label,pvpBoard:cc.Node,advNum:cc.Label,editBtnNode:cc.Node},initStatus:function(){var e;this.refresh(),this.advNum.string=pc.getChapterIndex(),this.pvpList=[this.pvpBoard];for(var t=0,a=i(PVP_DEF);!(e=a()).done;){var n,o=e.value,r=o[0],s=(o[1],pvp.getModeWin(r)),c=pvp.getModeIndex(r),l=this.pvpList[t];l||(l=cc.instantiate(this.pvpBoard),this.pvpBoard.getParent().addChild(l)),l.getChildByName("n").getComponent(cc.Label).string=LI("pvp_mode_"+r),n=c?Math.round(s/c*100):0,l.getChildByName("v").getComponent(cc.Label).string=LI("pvp_win_rate",{n:n,m:c}),t++}},onEdit:function(){var e=this;menuManager.pop("rename",{closeCb:function(){e.refresh()}})},refresh:function(){this.headName.string=user.getUserName()||LI("guest_name"),user.loadUserHead(this.headIcon,user.getUserHeadUrl())}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],Utils:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"a763cMPJ6pFMrhBtVVxjcno","Utils");var o={getCurrentUTCTimestamp:function(){return(new Date).toISOString().split(".")[0]+"Z"},formatMsToMinSec:function(e){var t=Math.floor(e/1e3),i=Math.floor(t/3600),a=Math.floor(t%3600/60),n=t%60;return String(i).padStart(2,"0")+":"+String(a).padStart(2,"0")+":"+String(n).padStart(2,"0")},getWeightedRandomTicket:function(){var e=excel.readConfig("RateIdleRewardConfig");if(!e)return cc.warn("RateIdleRewardConfig not loaded, using default"),1;for(var t,a=Math.random(),n=0,o=Object.keys(e).sort(function(e,t){return Number(e)-Number(t)}),r=i(o);!(t=r()).done;){var s=t.value;if(a<(n+=e[s]))return Number(s)}return Number(o[o.length-1])},formatDisplayNameByUUID:function(e){var t=e.replace(/[^0-9]/g,"");return"Player"+(t.length>=10?t.slice(-10):t.length>=9?t.slice(-9):t.padStart(9,"0"))}};window.Utils=o,cc._RF.pop()},{}],VIPCardMenu:[function(e,t){"use strict";cc._RF.push(t,"9ed09kZUx5EJblsx1mpeyka","VIPCardMenu");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{buyVIPCard:cc.Node,buyVIPCardFree:cc.Node,buyMonthCard:cc.Node,buyMonthCardFree:cc.Node,VIPItemlist:[cc.Node],monthItemlist:[cc.Node],buyPriceLabel10:cc.Label,buyPriceLabel11:cc.Label},initStatus:function(){var e=this;this.updateCardState();var t=[{i:DIAMOND,n:200},{i:ENERGY,n:10}];for(var a in t)this.VIPItemlist[a].getComponent("Item").init(t[a],"");this.GetPayInfoMess("backpackmaster.lifetimecard",this.buyPriceLabel10),this.buyVIPCard.onTouch=function(){cc.log("buyVIPCard"+sdk.now()),sdk.buyDiamond("backpackmaster.lifetimecard",function(){var t=[];t.push({i:DIAMOND,n:3e3}),net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99,buyVIPState:1},items:t},function(a,n){cc.log(a,n),a||(cc.log("BuyDimond",t,n),user.buyVIPState=1,i.FirebaseTracking.setDataBiRes("IAP_VipCard"),money.update(n),boxLvl.setBuyCost(n.doc.buyCost),e.updateCardState(),menuManager.pop("box",{items:t,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})},this.buyVIPCardFree.onTouch=function(){if(cc.log("buyVIPCardFree"+sdk.now()),e.isClaimGold()){var t=[];t.push({i:DIAMOND,n:200}),t.push({i:ENERGY,n:10}),net.updateData({set:{claimVIPTime:sdk.now()},items:t},function(a,n){cc.log(a,n),a||(cc.log("BuyDimond",t,n),i.FirebaseTracking.setDataBiRes("VipCardFree"),money.update(n),boxLvl.setBuyCost(n.doc.buyCost),user.claimVIPTime=n.doc.claimVIPTime,e.updateCardState(),menuManager.pop("box",{items:t,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})}else kit.info(LI("tip_timesout"))};var n=[{i:DIAMOND,n:100},{i:SWEEP_TICKET,n:20},{i:HERO_REFRESH_TICKET,n:3}];for(var a in n)this.monthItemlist[a].getComponent("Item").init(n[a],"");this.GetPayInfoMess("backpackmaster.monthlycard",this.buyPriceLabel11),this.buyMonthCard.onTouch=function(){cc.log("buyMonthCard"+sdk.now()),sdk.buyDiamond("backpackmaster.monthlycard",function(){var t=[];t.push({i:DIAMOND,n:100}),t.push({i:SWEEP_TICKET,n:20}),net.updateData({set:{buyCost:boxLvl.getBuyCost()+4.99,buyMonthTime:sdk.now()+2592e6},items:t},function(a,n){cc.log(a,n),a||(cc.log("BuyDimond",t,n),user.buyMonthTime=n.doc.buyMonthTime,i.FirebaseTracking.setDataBiRes("IAP_VipCard_Monthly"),money.update(n),boxLvl.setBuyCost(n.doc.buyCost),e.updateCardState(),menuManager.pop("box",{items:t,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})})},this.buyMonthCardFree.onTouch=function(){if(cc.log("buyMonthCardFree"+sdk.now()),e.isClaimMonthGold()){var t=[];t.push({i:DIAMOND,n:100}),t.push({i:SWEEP_TICKET,n:20}),t.push({i:HERO_REFRESH_TICKET,n:3}),net.updateData({set:{claimMonthTime:sdk.now()},items:t},function(a,n){cc.log(a,n),a||(cc.log("BuyDimond",t,n),i.FirebaseTracking.setDataBiRes("VipCard_MonthlyFree"),money.update(n),boxLvl.setBuyCost(n.doc.buyCost),user.claimMonthTime=n.doc.claimMonthTime,e.updateCardState(),menuManager.pop("box",{items:t,videoStr:"",tid:"Newble Pack",tname:"Newble Pack",lootCb:function(){}}))})}else kit.info(LI("tip_timesout"))}},updateCardState:function(){this.buyVIPCard.active=0==user.buyVIPState,this.buyVIPCardFree.active=1==user.buyVIPState,1==user.buyVIPState&&(this.buyVIPCardFree.getChildByName("rp").active=this.isClaimGold(),this.setGray(this.buyVIPCardFree.getChildByName("btn"),!this.isClaimGold())),sdk.now()<user.buyMonthTime?(this.buyMonthCard.active=!1,this.buyMonthCardFree.active=!0,this.buyMonthCardFree.getChildByName("rp").active=this.isClaimMonthGold(),this.setGray(this.buyMonthCardFree.getChildByName("btn"),!this.isClaimMonthGold())):(this.buyMonthCard.active=!0,this.buyMonthCardFree.active=!1)},isClaimGold:function(){return 0==user.claimVIPTime||new Date(sdk.now()).toLocaleDateString()!=new Date(user.claimVIPTime).toLocaleDateString()},isClaimMonthGold:function(){return sdk.now()<user.buyMonthTime&&new Date(sdk.now()).toLocaleDateString()!=new Date(user.claimMonthTime).toLocaleDateString()},GetPayInfoMess:function(e,t){if(null!=MAX.instance._productIdInfo){var i=MAX.instance._productIdInfo.split("*");for(var a in i){var n=i[a].split("&");n[0]==e&&(t.string=n[1]+n[2])}}},onDestroy:function(){this._super()}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],VehicleAvatar:[function(e,t){"use strict";cc._RF.push(t,"ccd88/+miNFKbo/k/H4IvsT","VehicleAvatar"),cc.Class({extends:e("../../components/visual/ArmatureAvatar"),initAnime:function(){var e=this;this._super();var t=this.game,i=this.define,a=i.anime||"hero_torbjorn",n=i.animeName2,o=t.effectMgr.createArmature(a,n,function(){e.finishLoad=!0,e.blockData&&e.addBlock(e.blockData)});this.rttNode.addChild(o,-1),o.x=i.dx||0,o.y=i.dy||0,o.scale=(i.s||1)*ANIME_SCALE,this.displayNode2=o,this.display2=o.armatureDisplay,this.benchList=[]},initBlocks:function(){},callAnime:function(e,t,i){try{void 0===i&&(i=-1);var a=this.getArmature();if(a){var n=a.animation;if(!n.animationNames||-1===n.animationNames.indexOf(e))return console.warn('[VehicleAvatar] CRITICAL: Animation "'+e+'" does not exist in primary armature "'+a.name+'".'),void console.warn("[VehicleAvatar] Available animations:",n.animationNames);var o=this.display2.armature(),r=o.animation;if(!r.animationNames||-1===r.animationNames.indexOf(e))return console.warn('[VehicleAvatar] CRITICAL: Animation "'+e+'" does not exist in display2 armature "'+o.name+'".'),void console.warn("[VehicleAvatar] Available animations:",r.animationNames);if(this.forcedRefresh||this.aniName!=e){this.aniName=e;var s=n.fadeIn(e,this.fadeTime||0,i);this.state=s;var c=r.fadeIn(e,this.fadeTime||0,i);this.state2=c}else s=this.state,c=this.state2;s&&(s.timeScale=t,c.timeScale=t)}}catch(l){console.warn('[VehicleAvatar] Exception in callAnime: Animation "'+e+'", Error: '+l)}},loadShader:function(){var e;if(e=this.shaderName?this.shaderName:"normal",this.rtEabled);else{var t=this.game.effectMgr;this.display&&t.bindShader(this.display,e),this.display2&&(cc.error("loadShader2",e),t.bindShader(this.display2,e)),this.base&&t.bindShader(this.base.sprite,e)}},enableBoneVisible:function(e){var t=this.attachUtil;t||(this.attachUtil=t=this.display2.attachUtil),t.generateAttachedNodes("yuandian");var i=t.getAttachedNodes("yuandian"),a=i[0];if(!a)throw new Error("attach no bone:yuandian,"+i);a.active=e,e&&a.runAction(cc.blink(1,4))},attach:function(e,t,i,a,n){void 0===i&&(i=0),void 0===a&&(a=0),void 0===n&&(n=0);var o=this.attachUtil;o||(this.attachUtil=o=this.display2.attachUtil),o.generateAttachedNodes(e);var r=o.getAttachedNodes(e),s=r[0];if(!s)throw new Error("attach no bone:"+e+","+r);t.parent&&t.removeFromParent(),s.addChild(t),t.scale0||(t.scale0=t.scale),t.scale=t.scale0/ANIME_SCALE,t.attachBone=s,t.x=a,t.y=-i,t.angle=-90-n,t.attachName=e},attachAvatar:function(e,t,i,a){this.attach(e,t.node,i,a,this.obj._deg),t.attachTarget=this},setBenchVisible:function(e,t,i,a){var n=this.benchList[e];n&&(n.active=t,t&&(i||a)&&(n.removeFromParent(!1),this.node.addChild(n),n.setPosition(i,a+50),n.angle=0,n.runAction(cc.sequence(cc.jumpTo(.5,0,100,50,1),cc.callFunc(function(){this.attach(n.attachName,n)},this)))))},prepareToAddBlock:function(e){this.blockData=e,this.finishLoad&&this.addBlock(e)},addBlock:function(e){if(!this.blockAdded){this.blockAdded=!0;var t,i=0,a=[];for(var n in t="v3"==this.obj.define.id?"avatar/backpack/side2":"avatar/backpack/side",cc.log("addBlock",e),e)for(var o in e[n])if(e[n][o]){var r=this.game.effectMgr.createSprite(0,0,"avatar/backpack/block"),s=45*(o-2),c=45*(6-n);if(r.dx=s,r.dy=c,a.push(r),i=n,!e[n][o-1]){var l=this.game.effectMgr.createSprite(-45,0,t);r.addChild(l)}if(cc.log("blockDataj+1",e[n][o],e[n][o+1]),!e[n][+o+1]){var d=this.game.effectMgr.createSprite(60,0,"avatar/backpack/embrasures");r.addChild(d),l=this.game.effectMgr.createSprite(45,0,t),r.addChild(l)}e[n-1]&&e[n-1][o]||((l=this.game.effectMgr.createSprite(0,45,t)).angle=90,r.addChild(l)),e[+n+1]&&e[+n+1][o]||((l=this.game.effectMgr.createSprite(0,-45,t)).angle=90,r.addChild(l))}for(var n in a)a[n].dy-=45*(6-i)-18,this.attach("yuandian",a[n],a[n].dx,a[n].dy)}},addBench:function(e,t){if(e&&e.length){var i=this.game,a=this.define.bench;for(var n in cc.log("addBench benchDef",a),e){var o=e[n];if(o){var r=ENTITY[o.i].avatar,s=i.effectMgr.createArmature(r.anime,r.animeName,function(e,t){t.playAnimation("stand")});s.scale=.65,this.attach(a[n].name,s),s.cfg=o,this.benchList.push(s),t&&s.runAction(cc.blink(.5,4))}}}},addLeader:function(){var e=this.game.effectMgr.createArmature("operator/laosiji","laosiji",function(e,t){t.playAnimation("stand")});e.scale=.65,this.attach("chezhang",e),this.benchList.push(e)},addStage:function(e){void 0===e&&(e=0),cc.log("addStage",e);var t=this.define.stage;for(var i in t){var a=t[i].name;this.display2.armature().getBone(a).visible=i<e-1}},callVehicleDeath:function(){var e=this,t=function(t){var i=e.benchList[t],a=i.getParent().convertToWorldSpaceAR(i.getPosition());i.removeFromParent(!1),i.armatureDisplay.playAnimation("fly"),e.game.layer.addToCamera(i,ZORDER.EFFECT);var n=e.game.layer.midLayer.convertToNodeSpaceAR(a);i.scale=.65,i.setPosition(n),i.runAction(cc.rotateBy(1,kit.rnd(-720,720)));var o=n.x+kit.rnd(0,300),r=e.game.contactMgr.findGroundLine(o);i.runAction(cc.sequence(cc.jumpTo(1,o,r-15,kit.rnd(200,300),1),cc.callFunc(function(){i.armatureDisplay.playAnimation("dead"),i.angle=0},e)))};for(var i in this.benchList)t(i);this.enableBoneVisible(!1)},callVehicleRevive:function(){for(var e in this.benchList){var t=this.benchList[e];t.stopAllActions(),this.attach(t.attachName,t),t.armatureDisplay.playAnimation("stand"),t.x=0,t.y=0}this.enableBoneVisible(!0),this.machineSmokePersist&&this.machineSmokePersist.remove()}}),cc._RF.pop()},{"../../components/visual/ArmatureAvatar":"ArmatureAvatar"}],VehicleBar:[function(e,t){"use strict";cc._RF.push(t,"a4ab0vHe5ZMFrvgwp5n0tKl","VehicleBar"),cc.Class({extends:cc.Component,properties:{hpBar:cc.Node,hpLabel:cc.Label,hurtBar:cc.Node,warnBar:cc.Node},onLoad:function(){this.hpWidth=this.hpBar.width},init:function(e,t,i){this.game=e,this.avatar=i,this.obj=t,this.refresh(),this.hurtBar.opacity=0,this.warnBar.opacity=0,t.noNum&&(this.hpLabel.node.active=!1)},enableAlwaysShow:function(){this.alwaysShow=!0},setVisible:function(e){this.node.active=e},setHp:function(e,t){this.hpBar.width=e/t*this.hpWidth,this.hpLabel.string=Math.round(e)+"/"+Math.round(t)},refresh:function(){var e=this.obj;if(this.hp=e.hp,this.game.config.gunnerMode){var t=e.hp/e.hpMax,i=t*(this.hpWidth-1)+1;this.hpBar.width=i,this.hurtBar.width=i,this.hpLabel.string=Math.round(e.hp)+"/"+Math.round(e.hpMax),this.node.stopAllActions(),t<=0?this.node.runAction(cc.fadeIn(.1)):(this.node.opacity=255,t>.3?(this.alwaysShow||this.node.runAction(cc.sequence(cc.delayTime(2),cc.fadeOut(1))),this.hurtBar.stopAllActions(),this.hurtBar.runAction(cc.sequence(cc.fadeIn(.05),cc.delayTime(.1),cc.fadeOut(.05))),this.warnAction&&(this.warnBar.stopAllActions(),this.warnAction=null,this.warnBar.opacity=0,this.smokeEffect&&this.smokeEffect.remove())):this.warnAction||(this.warnBar.stopAllActions(),this.warnAction=this.warnBar.runAction(cc.sequence(cc.fadeIn(.1),cc.delayTime(.3),cc.fadeOut(.2)).repeatForever()),this.smokeEffect=this.game.callEffect&&this.game.callEffect(EFFECT.machineSmokePersist,this.avatar)))}else this.node.active=!1},lateUpdate:function(){var e=this.obj;if(e&&!e.removed){this.hp!=e.hp&&this.refresh();var t=this.avatar;if(t){var i=t.getPosition();this.node.setPosition(i.x,i.y-20)}}}}),cc._RF.pop()},{}],VehicleModel:[function(e,t){"use strict";cc._RF.push(t,"5cbd9zeVSxJRK3CT9SLScq6","VehicleModel"),cc.Class({extends:cc.Component,properties:{display:dragonBones.ArmatureDisplay,displayBack:dragonBones.ArmatureDisplay,grayMaterial:cc.Material},init:function(e,t){if(void 0===t&&(t={}),this.define=e,this.config=t,this.benchList=t.bench||[],t.team)for(var i in t.team)this.benchList.push({i:t.team[i]});this.pilotDx=-10;var a=t.pilotScale||.9;this.pilotScale=a/ANIME_SCALE,this.benchNodes=[],this.towerNodes=[],this.pilotNodes=[],this.towerList=t.towers,this.heroList=t.heroes,this.towerList||(this.towerList=[{i:e.defaultTower}],!this.heroList&&this.benchList&&(this.heroList=[this.benchList.shift()])),this.heroList=this.heroList||[],this.stageHeight=t.stack||Math.max(this.towerList.length,this.heroList.length),this.armatureLoaded=!1,this.animeName="stand",this.animeSpd=0,this.animeNum=1,this.loadAvatar()},loadAvatar:function(){var e=this,t=this.config,i=this.define.avatar,a=i.anime||"hero_torbjorn";this.displayBack.node.scale=ANIME_SCALE,this.display.node.scale=ANIME_SCALE,menuManager.loadArmature(this.display,a,function(){e.armatureLoaded=!0,e.animeName&&e.playAnime(e.display)},i.animeName),this.attachUtil&&this.attachUtil.destroyAllAttachedNodes(),menuManager.loadArmature(this.displayBack,a,function(){e.armatureBackLoaded=!0,e.animeName&&e.playAnime(e.displayBack),t.driver&&e.addLeader(),e.addStage(),e.benchList&&e.addBench(e.benchList),e.setGray(e.gray)},i.animeName2)},playAnime:function(e){var t=e.playAnimation(this.animeName,this.animeNum);t&&(t.timeScale=this.animeSpd)},play:function(e,t,i){void 0===t&&(t=-1),void 0===i&&(i=1),this.animeName=e,this.animeNum=t,this.animeSpd=i,this.armatureLoaded&&this.playAnime(this.display),this.armatureBackLoaded&&this.playAnime(this.displayBack)},start:function(){if(this.armatureBackLoaded){var e=this.stageHeight-1,t=this.define.avatar.stage;for(var i in t){var a=t[i].name;this.displayBack.armature().getBone(a).visible=i<e}}},addTower:function(e,t){if(e){cc.log("addTower",e);var i=e.i,a=ENTITY[i].avatar,n=this.createArmature(a.anime,a.animeName,function(){});this.towerNodes[t]=n;var o=this.define.towerSlots[t];o&&this.attach(o.name,n)}},addHero:function(e,t){if(e){cc.log("addHero",e);var i=e.i,a=ENTITY[i].avatar,n=this.createArmature(a.anime,a.animeName,function(e,t){t.armature().animation.gotoAndPlayByProgress("stand",kit.rnd(0,1),-1)});this.pilotNodes[t]=n;var o=this.define.heroSlots[t];this.attach(o.name,n),n.scale=this.pilotScale}},addStage:function(){var e=this.define.avatar.stage,t=this.stageHeight-1;for(var i in e){var a=e[i].name;this.displayBack.armature().getBone(a).visible=i<t}for(var n in this.towerList)this.addTower(this.towerList[n],n);for(var o in this.heroList)this.addHero(this.heroList[o],o)},setStageVisible:function(e,t){var i=this.define.avatar.stage;if(e>0){var a=i[e-1].name;this.displayBack.armature().getBone(a).visible=t}var n=this.towerNodes[e];n&&(n.active=t);var o=this.pilotNodes[e];o&&(o.active=t)},getTowerPosition:function(e){var t=this.define.towerSlots;return cc.v2(0,t[e].dy/.85)},createArmature:function(e,t,i){var a=new cc.Node,n=a.addComponent(dragonBones.ArmatureDisplay);return a.display=n,menuManager.loadArmature(n,e,function(e,t){i&&i(e,t)},t),a},attach:function(e,t,i){void 0===i&&(i=0);var a=this.attachUtil;a||(this.attachUtil=a=this.displayBack.attachUtil),a.generateAttachedNodes(e);var n=a.getAttachedNodes(e)[0];n&&(t.parent&&t.removeFromParent(),n.addChild(t),n.zIndex=i,t.attachBone=n,t.x=0,t.y=0,t.angle=-90)},setBench:function(e){this.armatureBackLoaded?this.addBench(e):this.benchList=e},addBench:function(e){for(var t in cc.log("addBench",e),this.benchNodes)this.benchNodes[t].destroy();if(this.benchNodes=[],e&&e.length){var i=this.define.avatar.bench;for(var a in e){var n=e[a].i,o=ENTITY[n].avatar,r=this.createArmature(o.anime,o.animeName,function(e,t){t.armature().animation.gotoAndPlayByProgress("stand",kit.rnd(0,1),-1)});this.attach(i[a].name,r,1),r.scale=this.pilotScale,r.x=this.pilotDx,this.benchNodes.push(r)}}},addLeader:function(){var e=this.createArmature("operator/laosiji","laosiji",function(e,t){t.armature().animation.gotoAndPlayByProgress("stand",kit.rnd(0,1),-1)});this.attach("chezhang",e,1),e.scale=this.pilotScale,e.x=this.pilotDx},setGray:function(e){var t;if(this.gray=e,this.armatureLoaded)for(var i in t=e?this.grayMaterial:cc.Material.getBuiltinMaterial("2d-sprite"),this.display.setMaterial(0,t),this.displayBack.setMaterial(0,t),this.towerNodes){var a=this.towerNodes[i];a&&a.display.setMaterial(0,t)}}}),cc._RF.pop()},{}],VehicleUnlock:[function(e,t){"use strict";cc._RF.push(t,"5f6e0WBem1OI67WEWQvulSZ","VehicleUnlock");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{nameLabel:cc.Label,partLabel:cc.Label,partSprite:cc.Sprite,careerLabel:cc.Label,starsNode:cc.Node,lockBar:cc.Node,unlockBar:cc.Node,newBar:cc.Node,propertyBarNode:cc.Node,upgradeBtnNode:cc.Node,avatarNode:cc.Node,upgradeAnime:cc.Animation,adBtnCtLabel:cc.Label,upgradeLabel:cc.Label},onLoad:function(){this._super(),this.lockBar.active=!1,this.newBar.active=!1,this.unlockBar.active=!1},initStatus:function(e){var t,i=this,a=e.vid,n=pc.getVehicleData(a),o=pc.getVehicle(a);this.vid=a,this.avatarNode.getChildByName("vehicle_model").getComponent("VehicleModel").init(n,{}),this.nameLabel.string=n.name,t=o?o.star:0,cc.log(o,n,t),this.propertyBarNode.destroyAllChildren();for(var r=pc.getHeroUpgradePrice(t),s=0;s<9;s++){this.starsNode.getChildByName(""+(s+1)).active=s<t;var c=void 0;c=s==t&&money.had(l,r)?cc.instantiate(this.newBar):s<t?cc.instantiate(this.unlockBar):cc.instantiate(this.lockBar),this.propertyBarNode.addChild(c),c.active=!0,c.getChildByName("num").getComponent(cc.Label).string="x"+(s+1),c.getChildByName("msg").getComponent(cc.Label).string=n.starInfo[s]}var l=[SHARD]+"."+a,d=money.getNum(l);this.upgradeLabel.string=t&&LI("upgrade")||LI("unlock"),t<9?(this.partSprite.fillRange=d/r,this.partLabel.string=d+"/"+r,this.setGray(this.upgradeBtnNode,!money.had(l,r))):(this.partSprite.fillRange=0,this.partLabel.string=d+"/ - - -",this.setGray(this.upgradeBtnNode,!0)),this.upgradeBtnNode.getChildByName("rp").active=t<9&&d>=r,this.upgradeBtnNode.onTouch=function(){if(t>=9)kit.info(LI("tip_max"));else if(!money.check(l,r)){var n={i:l,n:r};(o=o||{id:a,star:0}).star+=1;var s=d-r;net.updateData({vehicles:[o],price:n},function(){window.TaskManager&&window.TaskManager.completeTask("task_4"),money.setNum([SHARD]+"."+a,s),pc.setVehicle(o),t<1?(i.close(),menuManager.pop("show",{items:[{i:VEHICLE,id:a}],tid:"vehicle_unlock",checkCb:function(){e.refreshCb(),YMTJ("lv","get_car2_"+pc.vehicleList.length)}})):(i.initStatus(e),i.upgradeAnime.play(),e.refreshCb(),YMTJ("lv","car_advanced_"+a+"_"+o.star))})}},this.updateAdBtn()},updateAdBtn:function(){var e=garage.adShardCt;this.adBtnCtLabel.string=LI("times_available_3",{n:e})},adBtnClick:function(){var e=this;garage.adShardCt<=0?kit.info(LI("tip_timesout")):sdk.useFree("free_shard",function(t){t||(cc.log("adBtnClick",e.vid),net.updateData({price:{i:"garage_adShardCt",n:1},items:[{i:SHARD,id:e.vid,n:1}]},function(t,a){i.FirebaseTracking.setDataBiRes("Ads_VehicleUnlock"),money.update(a),garage.adShardCt=a.doc.garage_adShardCt||0;var n,o=pc.getVehicle(e.vid);n=o?o.star:0;var r=pc.getHeroUpgradePrice(n),s=[SHARD]+"."+e.vid,c=money.getNum(s);cc.log("adBtnClick updateData cb",a,s,c),n<9?(e.partSprite.fillRange=c/r,e.partLabel.string=c+"/"+r,e.setGray(e.upgradeBtnNode,!money.had(s,r))):(e.partSprite.fillRange=0,e.partLabel.string=c+"/ - - -",e.setGray(e.upgradeBtnNode,!0)),e.upgradeBtnNode.getChildByName("rp").active=n<9&&c>=r,e.updateAdBtn()}),YMTJ("video","car_fragment"))})}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],Vehicle:[function(e,t){"use strict";cc._RF.push(t,"af96atGR8VGupbU3lDEcl9Z","Vehicle"),e("../../components/attributes/Attribute"),e("../projectiles/Bullet"),e("../../components/combat/buffs/Buff"),cc.Class({extends:e("../../core/base/Entity"),updateGround:function(){if(!this.wheels){var e=this.define.wheels||[-80,80],t=e[1]-e[0];this.wheels=[this.createWheel(e[0],c_abs(e[1]/t)),this.createWheel(e[1],c_abs(e[0]/t))]}for(var i in this.wheels){var a=this.wheels[i];this.isDead()?a.ground=this.game.contactMgr.findGround(a.x,a.y,this.groundIndex):a.ground=this.game.contactMgr.findPlatform(a.x,a.y,this.groundIndex)}},createWheel:function(e,t){var i=this;return{dx:e,s:t,get x(){return i.x+e*c_degree2cos(i.deg)*i.flipX},y:i.y}},checkWheelLine:function(e){var t=0,i=this.wheels;for(var a in c_abs(i[0].y-i[1].y)>c_abs(i[0].dx-i[1].dy)&&this.updateGround(),i){var n=i[a],o=n.ground;(e<0&&n.x+e<o.getGroundLeft()||e>0&&n.x+e>o.getGroundRight())&&(o=n.ground=this.game.contactMgr.findPlatform(n.x,n.y,this.groundIndex));var r=o.getGroundLine(n.x);n.y=r+this.height,t+=r*n.s}return t},updatePhysics:function(e){var t=this._physic_vx*e,i=this._physic_vy*e,a=this.height,n=this.attachedSlot;if(this.attachedSlot)a+=n.getGroundLine(this)+this.height;else{a+=this.checkWheelLine(t,i);var o=this.wheels,r=c_vector2Degree((o[1].x-o[0].x)*this.flipX,o[1].y-o[0].y);this._deg=c_clamp((r+720+180)%360-180,-85,85)*this.flipX}if(i<=0&&this._y+i<=a)this.landed=!0,i=a-this._y,this._physic_vy*=this._physic_bounce,this._physic_vx*=this._physic_damp_vx;else if(this.landed=!1,this.isFly()){var s=this._physic_float_h;if(s){this._physic_float_t+=e;var c=this._physic_float_s,l=c_sin(this._physic_float_t*c)*s;i+=l-this._physic_float_y,this._physic_float_y=l}}else this._physic_vy+=this._physic_g*e;this._dx+=t,this._dy+=i}}),cc._RF.pop()},{"../../components/attributes/Attribute":"Attribute","../../components/combat/buffs/Buff":"Buff","../../core/base/Entity":"Entity","../projectiles/Bullet":"Bullet"}],VideoGuideMenu:[function(e,t){"use strict";cc._RF.push(t,"b13e6pxVuZLQIspmimFuccO","VideoGuideMenu"),cc.Class({extends:e("./CheckMenu"),properties:{headNode:cc.Node,nameLabel:cc.Label,itemBoard:cc.Node,gearBoard:cc.Node,upgradeBoard:cc.Node},initStatus:function(e){e.title&&(this.titleLabel.string=e.title);var t=e.head||"h0",i="???",a=this.headNode.children;for(var n in a){var o=a[n];o.active=o.name==t}if("h0"==t?i="\u52b3\u65af\u57fa":"s"==t?i="\u795e\u79d8\u5546\u4eba":ENTITY[t]&&(i=ENTITY[t].name),this.nameLabel.string=i,this.itemBoard.active=!1,this.gearBoard.active=!1,this.upgradeBoard.active=!1,cc.warn(e),e.items)this.itemBoard.active=!0,this.itemBoard.getChildByName("item").getComponent("Item").init(e.items[0]);else if(e.gear){this.gearBoard.active=!0;var r=function(e,t,i){void 0===i&&(i=1);var a=ItemDefine[t];e.addComponent("checkpointAvatar").init(a,i)},s=e.gear;r(this.gearBoard.getChildByName("1"),s,1),r(this.gearBoard.getChildByName("2"),s,e.lvl||3)}else if(e.upgrade){this.upgradeBoard.active=!0;var c=e.vehicle,l=["atk","hp","skill"];for(var d in l){var h=l[d],u=c&&c[h]||0,p=this.upgradeBoard.getChildByName(h);p.getChildByName("lv0").getComponent(cc.Label).string=LI("lv")+" "+(1+u),p.getChildByName("lv1").getComponent(cc.Label).string=LI("lv")+" "+(1+e.upgrade)}}},waitOnClose:function(){}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],VideoIcon:[function(e,t){"use strict";cc._RF.push(t,"09a0fiykLxId5Ez4AONgn6U","VideoIcon"),cc.Class({extends:cc.Component,properties:{videoSpriteFrame:cc.SpriteFrame,adTicketSpriteFrame:cc.SpriteFrame,specialType:""},onLoad:function(){cc.game.on("useAdTicket",this.updateIcon,this)},start:function(){this.updateIcon()},updateIcon:function(){"adTicket"==this.specialType?this.node.getComponent(cc.Sprite).spriteFrame=!this.noTicket&&money.had(SWEEP_TICKET,1)&&this.adTicketSpriteFrame||this.videoSpriteFrame:"free"==this.specialType?this.node.active=!1:this.node.getComponent(cc.Sprite).spriteFrame=this.videoSpriteFrame},setSpecialType:function(e){this.specialType=e}}),cc._RF.pop()},{}],VideoMenu:[function(e,t){"use strict";cc._RF.push(t,"ef6605dpjtH8bZEIv1E2ELe","VideoMenu"),cc.Class({extends:e("./ItemMenu"),properties:{countLabel:cc.Label,videoIcon:e("./VideoIcon")},initStatus:function(e){if(e.title&&(this.titleLabel.string=e.title),e.count?this.countLabel.string=e.count:this.countLabel.string="",e.icon){var t=new cc.Node;this.itemNode.addChild(t),t.addComponent(cc.Sprite).spriteFrame=e.icon,this.itemNode.getChildByName("name").getComponent(cc.Label).string=e.name||""}else this.initItems();e.type&&this.videoIcon.setSpecialType(e.type)},waitOnClose:function(){}}),cc._RF.pop()},{"./ItemMenu":"ItemMenu","./VideoIcon":"VideoIcon"}],VirtualAvatar:[function(e,t){"use strict";cc._RF.push(t,"f14d6j58SZP1Y4QoIeij/cC","VirtualAvatar"),t.exports={refresh:function(){},updateReal:function(){},setAttackAnime:function(){},setWalkAnime:function(){},setStandAnime:function(){},setReloadAnime:function(){},setForcedAnime:function(){},setBeadsAction:function(){},setForcedUpperAnime:function(){},updateRender:function(){},callAttackAnime:function(){},callMoveAnime:function(){},setSlotByIndex:function(){},setLocalZOrder:function(){},setFlipX:function(){},setVisible:function(){},pushShader:function(){},popShader:function(){},remove:function(){},initTeam:function(){}},cc._RF.pop()},{}],VirtualLayer:[function(e,t){"use strict";cc._RF.push(t,"b91beotKL9IfZJxNAYjB4YB","VirtualLayer");var i=e("../components/visual/VirtualAvatar");t.exports={initMap:function(){},addBulletSprite:function(){return i},addAvatar:function(){return i},addHeroUI:function(){return i},updateLogic:function(){},start:function(){}},cc._RF.pop()},{"../components/visual/VirtualAvatar":"VirtualAvatar"}],WeaponTeamInfo:[function(e,t){"use strict";cc._RF.push(t,"3f4ffQZMZNLPrOI87wlZMC0","WeaponTeamInfo"),cc.Class({extends:cc.Component,properties:{changeOperatorMenu:cc.Node,operatorAvatar:cc.Node,operatorName:cc.Node,operatorOptionList:[cc.Node],setMainOperatorBtn:cc.Node,equipmentNodeList:[cc.Node],weaponAvatarNode:cc.Node,weaponNameNode:cc.Node,weaponDesNode:cc.Node,weaponClassNode:cc.Node,attrNodeList:[cc.Node]},init:function(e,t){this.game=t,this.weaponTeam=e,this.changeOperatorMenu.active=!1,this.initOperator(),this.checkMainOperator(),this.initEquipment(),this.initWeapon()},initWeapon:function(){var e=this.weaponTeam,t=this.weaponTeam.weapon,i=ItemDefine[t],a=this.weaponAvatarNode.getComponent(dragonBones.ArmatureDisplay);this.game.effectMgr.loadArmature(a,i.avatar.anime,null,i.avatar.animeName),i.name&&(this.weaponNameNode.getComponent(cc.Label).string=i.name,this.weaponNameNode.color=RarityTextColor[e.weaponLvl]),i.des&&(this.weaponDesNode.getComponent(cc.Label).string=i.des),i.class&&(this.weaponClassNode.getComponent(cc.Label).string=i.class),i.attack&&(this.attrNodeList[0].getComponent(cc.Label).string=i.attack),i.atkSpd&&(this.attrNodeList[1].getComponent(cc.Label).string=i.atkSpd),i.critChance&&(this.attrNodeList[2].getComponent(cc.Label).string=i.critChance),i.armorPenetrate&&(this.attrNodeList[3].getComponent(cc.Label).string=i.armorPenetrate),i.hp&&(this.attrNodeList[4].getComponent(cc.Label).string=i.hp),i.armor&&(this.attrNodeList[5].getComponent(cc.Label).string=i.armor);var n=1*Math.pow(4/3,e.weaponLvl-1),o=ItemDefine[this.weaponTeam.weapon].gameId,r=ENTITY[o].bltDmg*n;this.attrNodeList[0].getComponent(cc.Label).string=Math.floor(r);var s=ENTITY[o].hp*n;this.attrNodeList[2].getComponent(cc.Label).string=Math.floor(s);var c=ENTITY[o].attackSequence,l=0,d=0;for(var h in c)c[h].blt&&l++,d+=c[h].t;var u=Math.floor(l/d*100)/100;this.attrNodeList[1].getComponent(cc.Label).string=u},initOperator:function(){var e=this.weaponTeam.operator,t=ENTITY[e],i=this.operatorAvatar.getComponent(dragonBones.ArmatureDisplay);this.game.effectMgr.loadArmature(i,t.avatar.anime,null,t.avatar.animeName),this.operatorName.getComponent(cc.Label).string=t.name},initEquipment:function(){var e=this.weaponTeam.equipment;for(var t in cc.log("initEquipment equipmentIdList",e),this.equipmentNodeList){var i=ItemDefine[e[t]],a=this.equipmentNodeList[t].getComponent(cc.Sprite),n=i&&i.avatar.sprite||"checkpoint/equipment_empty";this.game.effectMgr.loadSprite(a,n)}},close:function(){this.game.closeWeaponTeamInfo()},setMainOperator:function(){chapter.data.mainOperator=this.game.mainOperator=this.weaponTeam.operator,this.checkMainOperator()},checkMainOperator:function(){this.setMainOperatorBtn.active=this.game.mainOperator!=this.weaponTeam.operator},setOperator:function(e,t){var i=[],a=this.weaponTeam.operator;for(var n in this.game.operatorList)this.game.operatorList[n]!=a&&i.push(this.game.operatorList[n]);var o=this.game.checkOperatorWeaponTeam(i[t]);o&&(o.operator=this.weaponTeam.operator,o.updateOperator()),this.weaponTeam.operator=i[t],this.weaponTeam.updateOperator(),this.initOperator(),this.changeOperatorMenu.active=!1,this.game.mainOperator==a&&(this.game.mainOperator=i[t]),this.game.updateBenchOperator()},removeWeaponTeam:function(){var e=0;for(var t in this.game.tankBlocks)this.game.tankBlocks[t].content&&(e+=1);e<=1?cc.log("\u53ea\u6709\u4e00\u4e2a\u6b66\u5668\u7981\u6b62\u79fb\u9664"):(this.weaponTeam.remove(),this.game.updateBenchOperator(),this.game.updateVehicleFixShow(),this.close())},popEquipmentInfo:function(e,t){var i=this;cc.resources.load("checkpoint/itemInfoBox",cc.Prefab,function(e,a){var n=cc.instantiate(a),o=n.getComponent("itemInfoBox"),r=ItemDefine[i.weaponTeam.equipment[t]];r&&(o.init(i.game,r,i.weaponTeam.lvl,function(){i.weaponTeam.removeEquipment(t),i.game.updateWeaponTeamInfo(i.weaponTeam)}),n.x=0,n.y=0,i.game.node.addChild(n,1e3))})},popOperatorInfo:function(){menuManager.pop("operator_info",{game:this.game})}}),cc._RF.pop()},{}],WebLiteMenu:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"32dd9SeX99E/JOwB8WiMaLg","WebLiteMenu"),cc.Class({extends:e("./CheckMenu"),properties:{layoutNode:cc.Node,infoLabel:cc.Label,loadingNode:cc.Node},initStatus:function(e){var t=this;this._super(e),this.infoText.node.active=!1,this.infoLabel.string="",this.layoutNode.height=this.infoText.node.height,this.loadingNode.active=!0,this.enabled=!1;var i=this.args.url,a=new XMLHttpRequest;a.open("GET",i,!0),a.send(),a.onloadend=function(){if(console.log("onloadend",a.readyState,a.status),t.loadingNode.active=!1,4===a.readyState&&a.status>=200&&a.status<=206){var e=a.responseText;i.indexOf(".html")>0&&(e=e.replace(/<head[^>]*>[\s\S]+<\/head>/gim,"").replace(/<script[^>]*>[\s\S]*?<\/script>/gim,"").replace(/\n/g,"").replace(/<p[^>]*>(.*?)<\/p>/gi,"$1\n").replace(/<br\s*\/?>/gi,"\n").replace(/<[^>]*>/g,"").replace(/&nbsp;/gi," ")),t.loadText(e)}else kit.info(LI("net_err"))},a.ontimeout=function(){console.error("The request for "+i+" timed out."),kit.info(LI("net_err"))}},loadText:function(e){if(e){var t=this.infoLabel.node;this.labelHeight=t.height;var i=this.getList(e,t.width);for(var a in this.layoutNode.height=(1+i.length)*this.labelHeight,this.labelIndex=30,i){if(a>=this.labelIndex)break;var n=cc.instantiate(t);this.layoutNode.addChild(n),n.getComponent(cc.Label).string=i[a]}this.labelList=i,t.active=!1,this.enabled=!0}},update:function(){if(this.layoutNode.y!==this.LayoutY){var e=(this.layoutNode.y+500)/this.labelHeight;if(this.labelIndex<this.labelList.length&&e>this.labelIndex){var t=this.labelIndex,i=cc.instantiate(this.infoLabel.node);this.layoutNode.addChild(i),i.active=!0,i.getComponent(cc.Label).string=this.labelList[t],this.labelIndex++}else this.LayoutY=this.layoutNode.y}},getList:function(e,t){var a,n;n=null==(a=this.infoLabel._assemblerData)?void 0:a.context;var o=[];if(e&&t&&n){for(var r,s="",c=i(e);!(r=c()).done;){var l=r.value;"\r"!==l&&("\n"===l?(o.push(s),s=""):cc.textUtils.safeMeasureText(n,s+l)>t?(o.push(s),s=l):s+=l)}o.push(s)}return o}}),cc._RF.pop()},{"./CheckMenu":"CheckMenu"}],WeeklyRewardLeaderBoard:[function(e,t){"use strict";var i;cc._RF.push(t,"7698bgTTn1NCJ6tdjH7DSDR","WeeklyRewardLeaderBoard"),e("../../utils/network/ApiClient");var a=e("../../utils/network/ApiClientPromise"),n=e("../../utils/network/ApiEndpoints");e("../../utils/network/net"),cc.Class(((i={extends:e("../../scripts/ItemMenu"),properties:{rewardDataJson:cc.JsonAsset,weekLabel:cc.Label,rankLabel:cc.Label,pointsLabel:cc.Label,statusLabel:cc.Label,iconRankMainPLayer:cc.Sprite,rewardContainerRoot:cc.Node,rewardItems:cc.Node,ListRewardItemRoot:cc.Node,rewardItem:cc.Prefab,listIconTopPlayer:[cc.SpriteFrame],listNodeTopPlayer:[cc.Node],claimButton:cc.Button,loadingNode:cc.Node,errorNode:cc.Node,errorLabel:cc.Label},onLoad:function(){this._super(),this.dataRewardWeek=null,this.currentRewardWeekData=null,this.currentWeekData=null,this.rewardTiers=null,this.rewardHistory=[],this.isLoading=!1,this.loadingOverlay=null,this.currentCategory="main_story",this.playerId=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid"),this.setupButtons()},onEnable:function(){if(window.menuManager&&window.menuManager.currentPopupData){var e=window.menuManager.currentPopupData;e&&e.category&&(this.currentCategory=e.category,cc.log("[WeeklyReward] Category set from popup data:",this.currentCategory)),window.menuManager.currentPopupData=null}this.initStatus()},onDisable:function(){this.loadingOverlay&&(this.loadingOverlay.destroy(),this.loadingOverlay=null)},initStatus:function(){this.loadCurrentRewardWeekData(),this.loadCurrentWeekData(),this.loadRewardTiers(),this.loadWeeklyTimer(),this.loadTopPlayers()},setupButtons:function(){this.claimButton&&(this.claimButton.node.off("click"),this.claimButton.node.off(cc.Node.EventType.TOUCH_END),this.claimButton.node.on(cc.Node.EventType.TOUCH_END,function(e){if(e.stopPropagation(),this.claimButton.interactable)this.onClaimReward(e);else{cc.log("[WeeklyReward] Button clicked but not interactable");var t="Not available at this time";if(this.currentWeekData){var i=this.currentWeekData.player_rank&&this.currentWeekData.player_rank>0,a=!0===this.currentWeekData.has_unclaimed;t=i?i&&!a?"Reward already claimed for this period":"No rewards available":"You need to be ranked to claim rewards"}else t="Loading reward data...";window.kit&&window.kit.info&&kit.info(t)}},this),cc.log("[WeeklyReward] Claim button setup complete"))},loadCurrentRewardWeekData:function(){this.dataRewardWeek=this.rewardDataJson.json;var e=this.currentCategory||"main_story";this.dataRewardWeek&&this.dataRewardWeek.week_default&&(this.currentRewardWeekData=this.dataRewardWeek.week_default[e],this.currentCampaignType=e,this.currentWeekType="week_default"),cc.log("[WeeklyRewardLeaderBoard] loadCurrentRewardWeekData",{category:e,weekType:"week_default",rewards:this.currentRewardWeekData})},loadTopPlayers:function(){if(this.currentWeekData&&this.currentWeekData.topPlayers)cc.log("[WeeklyReward] loadTopPlayers:",this.currentWeekData.topPlayers),this.displayTopPlayers(this.currentWeekData.topPlayers);else{var e=this,t={limit:3,category:this.currentCategory};a.get(n.weeklyRewards.getTopPlayers,t,{timeout:1e4,retries:2}).then(function(t){cc.log("[WeeklyReward] Top players from API for category",e.currentCategory,":",t,t.topPlayers),t&&t.topPlayers&&e.displayTopPlayers(t.topPlayers)}).catch(function(e){cc.warn("[WeeklyReward] Error fetching top players:",e)})}},displayTopPlayers:function(e){if(e&&0!==e.length){for(var t=0;t<Math.min(3,e.length);t++){var i=e[t],a=this.listNodeTopPlayer[t];a.getChildByName("txt_player").getComponent(cc.Label).string=i.displayName,a.getChildByName("infor_top").getChildByName("score").getComponent(cc.Label).string=i.score,this.playerId&&i.player_id===this.playerId&&cc.log("[WeeklyReward] Current player is in top 3 at rank",i.rank)}cc.log("[WeeklyReward] Displayed top",e.length,"players")}else cc.log("[WeeklyReward] No top players to display")},loadCurrentWeekData:function(){var e=this;if(!this.isLoading){if(!window.net||!window.net.token)return cc.warn("[WeeklyReward] net.token not available yet"),void this.scheduleOnce(function(){e.loadCurrentWeekData()},.5);if(!this.playerId&&(this.playerId=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid"),!this.playerId))return cc.warn("[WeeklyReward] Player ID not available yet"),void this.scheduleOnce(function(){e.loadCurrentWeekData()},.5);this.showLoading(!0),this.isLoading=!0;var t={player_id:this.playerId,category:this.currentCategory};a.get(n.weeklyRewards.checkUnclaimed,t,{timeout:1e4,retries:2}).then(function(t){var i;e.isLoading=!1,e.showLoading(!1),cc.log("[WeeklyReward] Unclaimed check data:",t),e.currentWeekData={has_unclaimed:!0===t.has_unclaimed,week_start:null==(i=t.current_week)?void 0:i.week_start,topPlayers:t.topPlayers||[],category:t.category||e.currentCategory||"main_story",player_rank:t.player_rank||null,player_score:t.player_score||null},t.topPlayers&&t.topPlayers.length>0&&(cc.log("[WeeklyReward] Displaying top players from check response"),e.displayTopPlayers(t.topPlayers)),e.updateClaimButton(),e.updateUI()}).catch(function(t){e.isLoading=!1,e.showLoading(!1),e.showError("Failed to load weekly rewards: "+t)})}},loadRewardTiers:function(){var e=this;a.get(n.weeklyRewards.getConfig,{},{timeout:1e4,retries:2}).then(function(t){cc.log("[WeeklyReward] Config data:",e.currentCategory,t),e.rewardConfig=t,t&&t.activeLeaderboards&&t.activeLeaderboards.length>0&&(e.currentCampaignType=t.activeLeaderboards[0],e.dataRewardWeek&&e.dataRewardWeek[e.currentWeekType||"week_default"]&&(e.currentRewardWeekData=e.dataRewardWeek[e.currentWeekType||"week_default"][e.currentCampaignType],cc.log("[WeeklyReward] Updated campaign to:",e.currentCampaignType))),e.loadLocalRewardTiers()}).catch(function(e){cc.warn("[WeeklyReward] Failed to load reward tiers:",e)})},loadWeeklyTimer:function(){var e=this;a.get(n.weeklyRewards.getTimer,{},{timeout:1e4,retries:2}).then(function(t){if(cc.log("[WeeklyReward] Timer response:",t),!t||!t.timer)return cc.warn("[WeeklyReward] No timer data in response"),void(e.weekLabel&&(e.weekLabel.node.active=!1));if(e.weeklyTimer=t.timer,!0===e.weeklyTimer.disabled)return cc.log("[WeeklyReward] Weekly reset is DISABLED (config: weeklyReset.enabled = false)"),e.weekLabel&&(e.weekLabel.node.active=!1),void(e.weeklyResetDisabled=!0);if(e.weeklyResetDisabled=!1,e.weeklyTimer.totalMilliseconds<=3e4&&(cc.log("[WeeklyReward] Timer expired, refreshing all data"),setTimeout(function(){e.loadCurrentRewardWeekData(),e.loadCurrentWeekData(),e.loadTopPlayers(),e.updateUI(),e.updateClaimButton()},2e3)),e.weekLabel&&e.weeklyTimer){var i=e.weeklyTimer.formatted||e.weeklyTimer.days+"d "+e.weeklyTimer.hours+"h";cc.log("[WeeklyReward] Timer enabled, showing:",i),e.weekLabel.string=i,e.weekLabel.node.active=!0}e.timerUpdateInterval||e.startTimerUpdates()}).catch(function(t){cc.warn("[WeeklyReward] Failed to load timer:",t),e.weekLabel&&(e.weekLabel.node.active=!1,e.weekLabel.node.parent&&(e.weekLabel.node.parent.active=!1))})},loadRewardHistory:function(){window.net&&window.net.token?(this.playerId||(this.playerId=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid")),this.playerId?(this.playerId,cc.warn("[WeeklyReward] History endpoint not yet implemented"),this.rewardHistory=[]):cc.warn("[WeeklyReward] Player ID not available for history")):cc.warn("[WeeklyReward] net not available for history")},updateUI:function(){if(this.currentWeekData){if(this.weekLabel&&this.weeklyTimer){var e=this.weeklyTimer.formatted||this.weeklyTimer.days+"d "+this.weeklyTimer.hours+"h";this.weekLabel.string=e}if(cc.log("[WeeklyReward] this.currentWeekData ",this.currentCategory,this.currentWeekData),this.rankLabel){var t=this.currentWeekData.player_rank||null;t&&t>0?(this.rankLabel.string=t,this.iconRankMainPLayer&&this.listIconTopPlayer&&(t<=3?(this.iconRankMainPLayer.node.active=!0,this.iconRankMainPLayer.spriteFrame=this.listIconTopPlayer[t-1],this.rankLabel.node.active=!1):(this.iconRankMainPLayer.node.active=!1,this.rankLabel.node.active=!0))):(this.rankLabel.string="100+",this.iconRankMainPLayer&&(this.iconRankMainPLayer.node.active=!1),this.rankLabel.node.active=!0,cc.log("[WeeklyReward] Player not ranked in campaign:",this.currentWeekData.campaign))}if(this.pointsLabel)if(this.currentWeekData.player_score){var i=this.currentWeekData.player_score.formatted||this.currentWeekData.player_score.total_score||0;this.pointsLabel.string=i}else this.currentWeekData.player_rank?this.pointsLabel.string=this.currentWeekData.player_rank:this.pointsLabel.string="....";this.updateRewardStatus(),this.displayCurrentRewards(),this.updateClaimButton()}},updateRewardStatus:function(){if(this.statusLabel){var e=!0===this.currentWeekData.has_unclaimed,t=e?"Reward Available!":"No Rewards",i=e?cc.Color.GREEN:cc.Color.WHITE;this.statusLabel.string=t,this.statusLabel.node.color=i}},displayCurrentRewards:function(){if(this.rewardContainerRoot&&(this.rewardContainerRoot.removeAllChildren(),this.currentRewardWeekData)){var e=[],t=[];for(var i in this.currentRewardWeekData)i.startsWith("rank_")&&t.push(i);t.sort(function(e,t){var i=function(e){var t=e.match(/rank_(\d+)/);return t?parseInt(t[1]):999999};return i(e)-i(t)}),t.forEach(function(t){var i=this.currentRewardWeekData[t];if(i&&i.items){var a=t.replace("rank_","").replace(/_/g,"-");"10001-plus"===a?a="10001+":a.endsWith("-plus")&&(a=a.replace("-plus","+")),e.push({rank:a,data:i})}}.bind(this)),cc.log("[WeeklyReward] Processing reward tiers for",this.currentCampaignType),e.forEach(function(e,t){if(e.data&&e.data.items&&e.data.items.length>0){var i=cc.instantiate(this.rewardItems);i.active=!0,i.parent=this.rewardContainerRoot;var a=i.getChildByName("rankIcon").getComponent(cc.Sprite),n=t<3?t:3+(t-3)%(this.listIconTopPlayer.length-3);n<this.listIconTopPlayer.length&&(a.spriteFrame=this.listIconTopPlayer[n]);var o=i.getChildByName("rankLb");if(o)if(t<3)o.active=!1,a.node.active=!0;else{o.active=!0,a.node.active=!1;var r=o.getComponent(cc.Label);r&&(r.string=e.rank)}var s=i.getChildByName("ItemsRewardRoot");s&&this.rewardItem&&e.data.items.forEach(function(e){var t=cc.instantiate(this.rewardItem);t.setScale(cc.v2(.8,.8)),s.addChild(t);var i=t.getComponent("Item");i&&i.init&&(cc.log("creator ",e),i.init(e))}.bind(this))}}.bind(this))}},setupRewardItem:function(e,t){var i=e.getComponentInChildren(cc.Label),a=e.getComponentInChildren(cc.Sprite);i&&(i.string=t.amount+" "+t.type),a&&t.icon&&cc.resources.load(t.icon,cc.SpriteFrame,function(e,t){e||(a.spriteFrame=t)})},loadLocalRewardTiers:function(){var e=this;cc.resources.load("config/weeklyRewards",cc.JsonAsset,function(t,i){if(t)cc.error("[WeeklyReward] Failed to load reward tiers:",t);else{var a=i.json;e.rewardTiers=a.week_default}})},updateClaimButton:function(){if(this.claimButton)if(this.currentWeekData){var e=!0===this.currentWeekData.has_unclaimed,t=this.currentWeekData.player_rank&&this.currentWeekData.player_rank>0,i=e;if(cc.log("updateClaimButton - Rank:",this.currentWeekData.player_rank,"Has unclaimed:",e,"Can claim:",i),this.claimButton.interactable=i,this.claimButton.node){var a=this.claimButton.node.getChildByName("statusClaimLabel");if(a){var n=a.getComponent(cc.Label);n&&(n.string=i?"Tap to claim":t&&!e?"Claimed":t?"No Rewards":"Not available")}}}else this.claimButton.interactable=!1},onClaimReward:function(e){var t;cc.log("[WeeklyReward] Claim button clicked, currentWeekData:",this.currentWeekData);var i=this;if(e&&e.stopPropagation&&e.stopPropagation(),e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.isLoading)cc.log("[WeeklyReward] Already loading, returning");else{var o=this.currentWeekData&&!0===this.currentWeekData.has_unclaimed;if(cc.log("[WeeklyReward] Can claim?",o,"has_unclaimed:",null==(t=this.currentWeekData)?void 0:t.has_unclaimed),!o)return window.kit&&window.kit.info&&kit.info("You are not in the rank list. Play to get ranked!"),!1;if(this.showLoading(!0),this.isLoading=!0,!window.net||!window.net.token)return cc.log("[WeeklyReward] Authentication not available"),void(this.isLoading=!1);if(this.playerId||(this.playerId=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid")),!this.playerId)return cc.log("[WeeklyReward] Player ID not available"),void(this.isLoading=!1);var r={week:"current",player_id:this.playerId,category:this.currentCategory,token:window.net?window.net.token:null};a.post(n.weeklyRewards.claimReward,r,{timeout:15e3,retries:1}).then(function(e){i.isLoading=!1,i.showLoading(!1),cc.log("[WeeklyReward] Claim successful:",e);var t=null,a=e.category||i.currentCategory||"main_story";e.authenticated_rank?t=e.authenticated_rank:e.rank_tier&&(t=e.rank_tier),cc.log("[WeeklyReward] Authenticated rank:",t,"Category:",a),i.loadRewardsForRank(t,a,function(e){i.currentWeekData&&(i.currentWeekData.reward_status="claimed",i.currentWeekData.has_unclaimed=!1),cc.log("Reward claimed successfully! Rank: "+t),i.updateClaimButton(),i.updateUI(),i.addRewardsToInventory(e)})}).catch(function(e){i.isLoading=!1,i.showLoading(!1),cc.log("[WeeklyReward] Failed to claim reward:",e),e&&e.toString().includes("already claimed")?(i.currentWeekData&&(i.currentWeekData.has_unclaimed=!1,i.currentWeekData.reward_status="claimed"),i.updateClaimButton(),window.kit&&window.kit.info&&kit.info("Reward already claimed for this period")):window.kit&&window.kit.info&&kit.info("Failed to claim reward")})}},getRewardsForRankFromData:function(e,t){if(!t)return null;if("number"==typeof e){var i=0;for(var a in t)if(a.startsWith("rank_")){var n=a.match(/rank_(\d+)(?:_(\d+))?(?:_plus)?/);if(n){var o=parseInt(n[1]),r=n[2]?parseInt(n[2]):a.includes("plus")?Number.MAX_SAFE_INTEGER:o;if(e>=o&&e<=r)return t[a];r>i&&(i=r)}}return t.rank_10001_plus&&e>1e4?t.rank_10001_plus:t.participation||null}return"string"==typeof e&&t.participation||null},loadRewardsForRank:function(e,t,i){var a=this;if("function"==typeof t&&(i=t,t=this.currentCampaignType||"main_story"),this.currentRewardWeekData){var n=this.getRewardsForRankFromData(e,this.currentRewardWeekData);i&&i(n?n.items:[])}else cc.resources.load("config/weeklyRewards",cc.JsonAsset,function(n,o){if(n)return cc.error("[WeeklyReward] Failed to load reward config:",n),void(i&&i([]));var r=o.json[a.currentWeekType||"week_default"],s=r[t]||r.main_story,c=a.getRewardsForRankFromData(e,s);i&&i(c?c.items:[])})},addRewardsToInventory:function(e){if(e&&0!==e.length){cc.log("[WeeklyReward] rewards",e);var t=!1;setTimeout(function i(){if(!t)if(window.menuManager&&!window.menuManager.loading){t=!0;var a=[],n={};e.forEach(function(e,t){n["item"+(t+1)]=e}),cc.log(n);var o=equipment.get("items");for(var r in n)if(n.hasOwnProperty(r)){var s=n[r];if(cc.log("check itemReward",s),"equipment"===s.i&&s.rarity){var c=0;for(var l in o)c=Math.max(c,EquipmentDefine[l].rarity);s.rarity>c&&c>0&&(cc.log("Adjusting reward rarity - Original:",s.rarity,"Highest owned:",c),s.rarity=Math.max(1,s.rarity-1),cc.log("New reward rarity:",s.rarity))}}cc.log("showRewardsPopup convertReward ",n),window.equipment.getItemFromReward(a,n),cc.log("showRewardsPopup , listReward",a),window.net&&window.net.updateData&&window.net.updateData({items:a},function(e,t){e?cc.log("[WeeklyReward] Error updating data:",e):(menuManager.pop("show",{tid:"sign",items:a,checkCb:function(){cc.log("[WeeklyReward] Rewards popup closed")}}),window.money.update(t),cc.log("[WeeklyReward] Data updated successfully",t))})}else setTimeout(i,100)},500)}},startTimerUpdates:function(){var e=this;this.timerUpdateInterval&&clearInterval(this.timerUpdateInterval);var t=3e4;this.weeklyTimer&&this.weeklyTimer.totalMilliseconds&&this.weeklyTimer.totalMilliseconds<12e4&&(t=5e3,cc.log("[WeeklyReward] Timer near expiry, updating every 5 seconds")),this.timerUpdateInterval=setInterval(function(){e.loadWeeklyTimer()},t)},stopTimerUpdates:function(){this.timerUpdateInterval&&(clearInterval(this.timerUpdateInterval),this.timerUpdateInterval=null)},onDestroy:function(){this.stopTimerUpdates(),this.loadingOverlay&&(this.loadingOverlay.destroy(),this.loadingOverlay=null)},showLoading:function(e){if(cc.log("[WeeklyReward] showLoading:",e,"loadingPrefab exists:",!!menuManager.loadingPrefab),e){if(window.menuManager&&menuManager.loadingPrefab){this.loadingOverlay&&(this.loadingOverlay.destroy(),this.loadingOverlay=null);var t=cc.Canvas.instance.node;this.loadingOverlay=cc.instantiate(menuManager.loadingPrefab),t.addChild(this.loadingOverlay,2e3),cc.log("[WeeklyReward] Loading overlay created and added to canvas")}else cc.log("[WeeklyReward] menuManager.loadingPrefab not available, using fallback");this.loadingNode&&(this.loadingNode.active=!0)}else this.loadingOverlay&&(this.loadingOverlay.destroy(),this.loadingOverlay=null,cc.log("[WeeklyReward] Loading overlay destroyed")),this.loadingNode&&(this.loadingNode.active=!1);this.errorNode&&e&&(this.errorNode.active=!1)},showError:function(e){cc.error("[WeeklyReward] Error:",e),this.errorNode&&(this.errorNode.active=!0,this.errorLabel&&(this.errorLabel.string=e))},showSuccess:function(e){cc.log("[WeeklyReward] Success:",e)},formatNumber:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()},getWeekIdentifier:function(e){var t=(e=e||new Date).getFullYear(),i=this.getWeekNumber(e);return t+"-W"+(i<10?"0"+i:i)},getWeekNumber:function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),i=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-i);var a=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-a)/864e5+1)/7)}}).onDestroy=function(){this.claimButton&&this.claimButton.node&&(this.claimButton.node.off(cc.Node.EventType.TOUCH_END),this.claimButton.node.off("click"))},i.statics={checkUnclaimedRewards:function(e){if(!window.net||!window.net.token)return cc.warn("[WeeklyReward] net not available for unclaimed check"),void(e&&e(!1));var t=window.user&&window.user.uuid||cc.sys.localStorage.getItem("player_id")||cc.sys.localStorage.getItem("uuid")||cc.sys.localStorage.getItem("uid");if(!t)return cc.warn("[WeeklyReward] Player ID not available for unclaimed check"),void(e&&e(!1));var i={player_id:t};a.get(n.weeklyRewards.checkUnclaimed,i,{timeout:1e4,retries:2}).then(function(t){cc.log("[WeeklyReward] Unclaimed check data:",t);var i=t&&!0===t.has_unclaimed;cc.log("[WeeklyReward] Has unclaimed rewards:",i),e&&e(i)}).catch(function(t){console.error("[WeeklyReward] Error checking unclaimed rewards:",t),e&&e(!1)})},getCurrentWeek:function(){var e=new Date,t=e.getFullYear(),i=Math.ceil(((e-new Date(e.getFullYear(),0,1))/864e5+1)/7);return t+"-W"+(i<10?"0"+i:i)}},i)),cc._RF.pop()},{"../../scripts/ItemMenu":"ItemMenu","../../utils/network/ApiClient":"ApiClient","../../utils/network/ApiClientPromise":"ApiClientPromise","../../utils/network/ApiEndpoints":"ApiEndpoints","../../utils/network/net":"net"}],adventure:[function(e,t){"use strict";cc._RF.push(t,"8c9fblxgI1E+Y/P7gKNCQMO","adventure");var i=e("../../Plugins/ADManager"),a=e("../../Plugins/firebase/FirebaseTracking"),n=e("../../Plugins/SDKManager");e("./ChapterDefine");var o=e("../utils/ConsecutiveHPManager"),r=function(e){for(var t in ItemDefine)if(ItemDefine[t].gameId==e)return t},s={saveData:{},statusList:[],chapterToStage:function(e,t){for(var i=t,a=0;a<e;a++)i+=window.CHAPTER_DEFINE_ARRAY[a].stage.length;return i},stageToChapter:function(e){for(var t in window.CHAPTER_DEFINE_ARRAY){var i=window.CHAPTER_DEFINE_ARRAY[t];if(e<i.stage.length)return+t;e-=i.stage.length}return window.CHAPTER_DEFINE_ARRAY.length},getDifficultyTarget:function(e){return 1==e?7:7+6*(e-1)},chapterToDifficulty:function(e){return e<=0?1:2*Math.floor((e-1)/6)+1},stageToName:function(e){for(var t in window.CHAPTER_DEFINE_ARRAY){var i=window.CHAPTER_DEFINE_ARRAY[t];if(e<i.stage.length)return+t+1+"-"+(+e+1);e-=i.stage.length}},start:function(e){if(console.log("[adventure]","[start]",e,window.CHAPTER_DEFINE_ARRAY[e]),window.CHAPTER_DEFINE_ARRAY[e]){o.resetHistory(),o.initialize(),this.set(kit.rnd(0,9999999),e,0),window.CHAPTER_DEFINE_ARRAY[e];var t=pc.getChooseVehicle(),i=t.id,a=pc.getVehicleData(i),n=a.defaultTower,c=r(n);if(chapter.reset(),chapter.data.baseExp=10*(e+1),console.log("Set baseExp",chapter.data.baseExp,"chapterIndex",t),console.log("Set baseExp in start",chapter.data.baseExp,"chapterIndex",e),0==e)chapter.data.tank=[{weapon:"machine_gun",weaponLvl:1}],chapter.data.bench=[],chapter.data.bag=[];else if(1==e)chapter.data.tank=[{weapon:c,weaponLvl:1,operator:"h2"}],chapter.data.bench=["h4"],chapter.data.bag=[];else{var l=pc.getTeam(),d=[];for(var h in l)d.push(l[h]);chapter.data.tank=[{weapon:c,weaponLvl:1,operator:d.shift()}],chapter.data.bench=d,cc.log("team",l,d)}var u=chapter.data,p=u.tank,f=(u.bench,[]),m=!1;for(var g in p){var v=p[g];if(v){v.operator;var y=v.weapon;if(y){var b=ItemDefine[y].gameId,k=null;b&&(k={i:b,hp:1,weaponLvl:v.weaponLvl||1,weapon:y},m||(m=!0,k.m=1)),f[g]=k}}}for(var T=[],_=t.star||0,w=0;w<_;w++){var E=a.starAttrs[w];TalentDefine[E.id]&&T.push(E)}var C=pc.getHeroList();for(var S in C)if(C[S].stat){var I=pc.getHeroStatNum(C[S].id);for(var A in C[S].stat){var B=C[S].stat[A];E={id:B,num:I[B]},TalentDefine[E.id]&&T.push(E),cc.log("adventure hero talents found",C[S].id,E)}}chapter.data.buyPrice=1,chapter.data.repairPrice=1,menuManager.run("backpack",{adventure:1,backpack:chapter.data.backpack,vehicleConfig:{hp:1,vid:i,star:t.star,talents:T,attr:pc.getVehicleAttr(i),towers:f,heroes:C,bench:[]},mapIndex:this.mapIndex,mapLength:this.mapList.length,chapterIndex:this.chapterIndex,nextCb:function(e){s.run(e)}})}else cc.msgbox("\u672a\u5b9a\u4e49\u7684\u7ae0\u8282")},set:function(e,t,i){console.log("[adventure]","[set]",e,t,i),this.chapterIndex=t,this.seed=e;var a=window.CHAPTER_DEFINE_ARRAY[t],n=kit.core(e),o=this.mapList=[],r=a.stage,c=kit.clone(a.mapPool);for(var l in r){var d=r[l];if(d.map)o.push({map:d.map,lvl:d.lvl});else if(d.pool&&c[d.pool]){var h=c[d.pool],u=n.rndInt(0,h.length-1);o.push({map:h[u].map,lvl:d.lvl}),h.splice(u,1)}}this.mapIndex=i,cc.log("adventure load",this.mapList,this.mapIndex),s.startTime=Date.now()},run:function(e){var t=this,r=this.mapList[this.mapIndex],c=this.chapterIndex,l=window.CHAPTER_DEFINE_ARRAY[this.chapterIndex];if(console.log(222222,r,this.mapIndex,this.mapList),r){for(var d in e.tower)e.tower[d].hp=null,e.tower[d].atk=1;var h,u=e.vid,p=e.star,f=e.attr,m=e.hp,g=e.towers,v=e.heroes,y=e.bench,b=e.cd,k=s.chapterToStage(this.chapterIndex,this.mapIndex);k<=15&&sdk.setAdjuststageStartEvent(k-1),console.log(0xbd7a625405555),chapter.save(e,this.seed,this.chapterIndex,this.mapIndex,!1);var T=l.stage[this.mapIndex],_=function(){return ItemDrop.getItemFromExcelData(c,excelData)},w=chapter.data.events,E=kit.clone(chapter.data.talent);if(e.talents&&(E=E.concat(e.talents),h=e.talents),console.log(0xbd7a625405555),cc.log(" ======== adventure vehicleConfig.talents",e.talents),chapter.data.backpack)for(var d in console.log(0xbd7a625405555),chapter.data.backpack.blockItemData){var C=chapter.data.backpack.blockItemData[d],S=BackpackItemDefine[C.id];if(cc.log("adventure run talents from backpack",C.id,S.talent),C.pos){var I=equipment.getStats(S.type);if(I)for(var A in cc.log("Find Corresponding Equipment Data",C.type,I),I)if(I[A]&&TalentDefine[A]){var B={id:A,num:I[A]*Math.pow(1.5,S.rarity),backpack:C};E.push(B),cc.log("Equip Corresponding Talent",B,I[A],A,Math.pow(1.5,S.rarity))}S.talent&&("object"==typeof S.talent?((B=kit.clone(S.talent)).backpack=C,E.push(B)):E.push({id:S.talent,backpack:C}))}}cc.log("======= adventure run talents",E),cc.log("======== adventure mapDef",r.map),a.FirebaseTracking.level_id=t.mapIndex+1+"_"+t.mapList.length,console.log(3333333333333333e5),map.load("map/"+r.map,function(e,d){if(e)kit.info("Map Not Found"+r.map);else{console.log(0x9de5fc9b59c720,T);var k=T.lvl,C=T.lvl2,S=o.getModifiedLevels(k,C);S.multiplied&&console.log("[Adventure] Consecutive HP multiplier applied!");var I={lvl:S.lvl,lvl2:S.lvl2,entity:{1:{id:u,cd:b,star:p,attr:f,events:w,hp:m,towers:g,heroes:v,bench:y}},talent:E},A={me:1,boxDropFunc:_,chapterName:l.name,chapterIndexName:l.indexName,chapterIndex:c,mapName:t.mapIndex+1+"/"+t.mapList.length,mapIndex:t.mapIndex,remotes:I,auto:c>0?1:0,mapData:d,exp:T.exp,reviveFunc:function(e,i){if(DEV_MODE&&DEBUG_MODE);else if(chapter.data.reviveCt>0)return void i(!1);menuManager.pop("revive",{noWait:!0,noBlock:!0,game:e,closeCb:function(a){a?(i(a),chapter.data.reviveCt++,chapter.add("videoCt")):(t.chapterFail(e,0),e.finished=!0,s.chapterDeathFailed=!0)}})},startFunc:function(){if(record.start(),window.StatsTracker&&(StatsTracker.initSession(),window.EquipmentEncoder&&g)){var t=chapter.data&&chapter.data.tank,i=(chapter.data&&chapter.data.backpack,[]),a={};if(window.equipment)try{var n=equipment.get("items");if(n)for(var o in n){var r=n[o],s=o,c=r.lvl||r.level||1;a[s]=c}}catch(e){}var l={};if(t&&Array.isArray(t))for(var d=0;d<t.length;d++)if(t[d]&&t[d].weapon){var h=t[d].weapon,u=t[d].weaponLvl||t[d].level||1;l[h]=u}if(g&&Array.isArray(g))for(var p=0;p<g.length;p++){var f=g[p];if(f&&f.backpack&&f.backpack.id){var m=f.backpack.id,v=m,y=m.match(/^(.+?)(\d+)$/);y&&(v=y[1]);var b=1;if(a[v])b=a[v];else if(!l[v]||"machine_gun"===v&&1===l[v]){if(f.weaponLvl)b=f.weaponLvl;else if("machine_gun"===v)if(window.user)try{var k=user.getData();if(k&&k.equipment&&k.equipment.items)for(var T in k.equipment.items){var _=k.equipment.items[T];if(_&&"machine_gun"===_.id){b=_.level||5;break}}}catch(e){b=5}else b=5}else b=l[v];i.push({weapon:m,weaponLvl:b})}}if(i.length>0)var w=EquipmentEncoder.encodeCurrentEquipment({tank:i});else w=g?EquipmentEncoder.encodeCurrentEquipment({towers:g}):"";StatsTracker.setEquipmentConfiguration(g,w)}},finishFunc:function(e,r){if(r){var l=e.levelMgr.heroes[1],d=l.hp/l.hpMax;o.recordStageCompletion(t.chapterIndex,t.mapIndex,d),t.mapIndex++;var p=!t.mapList[t.mapIndex],m={vid:u,stack:chapter.data.stack,attr:f,driver:1,hp:d,towers:[],heroes:v,bench:y,talents:h,cd:[l.getSkillCDPercent(0)]};for(var b in l.towers){var k=l.towers[b];m.towers[b]={i:g[b].i,hp:k.hp/k.hpMax,m:k==l.mainTower?1:0}}if(p)t.chapterWin(e,m);else{var T=pc.talentGlobal.hp4fix;if(T)for(var _ in l.onHeal(e.levelMgr,T*l.hpMax),l.towers){var w=l.towers[_];w.onHeal(e.levelMgr,T*w.hpMax)}var E=pc.talentGlobal;if(E.add_money){var C=+E.add_money;chapter.add(GOLD,C),cc.game.emit("add_drop",{i:GOLD,n:C,tid:"talent"})}if(console.log("Gara",E.add_exp),E.add_exp){var S=+E.add_money;chapter.add(EXP,S),console.log("Gara",EXP,S),cc.game.emit("add_drop",{i:EXP,n:S,tid:"talent"})}t.mapIndex;var A=function(){var i=window.CHAPTER_DEFINE_ARRAY[c],a=i.stage[t.mapIndex];chapter.data.gold+=a.gold||0,e.pickedTalent&&(chapter.data.talent=e.pickedTalent),cc.log("adventure nextCb gold gain/current",a.gold||0,chapter.data.gold);var n=I.talent;Talent.effect("endgame",n),menuManager.run("backpack",{adventure:1,backpack:chapter.data.backpack,vehicleConfig:m,chapterName:i.name,mapIndex:t.mapIndex,mapLength:t.mapList.length,chapterIndex:c,nextCb:function(e){t.run(e)}},null,!0)},B=3,M=!1;e.addUpdate({updateLogic:function(i){if((B-=i)<2&&!M&&(chapter.save(m,t.seed,t.chapterIndex,t.mapIndex,!0),cc.log("hideCb"),menuManager.popCover({noLoading:!0,prefab:menuManager.currentRun().fadeOutPrefab}).transitionIn(e.layer),e.levelMgr.callFade(),menuManager.preload("backpack"),M=!0),B<0)return A(),!0}}),0!=c||user.getGuide("chapter")?1==c&&1==user.getGuide("chapter")&&(1==t.mapIndex?TJ.onGuideEvent({guide_id:46,guide_name:"\u7b2c\u4e8c\u7ae0-\u5173\u53611\u80dc\u5229"}):2==t.mapIndex?TJ.onGuideEvent({guide_id:57,guide_name:"\u7b2c\u4e8c\u7ae0-\u5173\u53612\u80dc\u5229"}):3==t.mapIndex?TJ.onGuideEvent({guide_id:67,guide_name:"\u7b2c\u4e8c\u7ae0-\u5173\u53613\u80dc\u5229"}):4==t.mapIndex&&TJ.onGuideEvent({guide_id:78,guide_name:"\u7b2c\u4e8c\u7ae0-\u5173\u53614\u80dc\u5229"})):1==t.mapIndex?TJ.onGuideEvent({guide_id:9,guide_name:"\u7b2c\u4e00\u7ae0-\u5173\u53611\u80dc\u5229"}):2==t.mapIndex&&TJ.onGuideEvent({guide_id:22,guide_name:"\u7b2c\u4e00\u7ae0-\u5173\u53612\u80dc\u5229"});var D=s.chapterToStage(c,t.mapIndex);D>pc.stageIndex&&(cc.log("[adventure] , stageIndex=============="+D),D>=1&&D<=5&&sdk.setAdjuststageEndEvent(D-1),2==D&&(sdk.setAdjustEvent("g9z25k",""),sdk.setFibaseEvent("tutorial",'{"step4_tutorial10":""}')),3==D&&sdk.setFibaseEvent("tutorial",'{"step5":""}'),4==D&&sdk.setFibaseEvent("tutorial",'{"step6":""}'),5==D&&(sdk.setFibaseEvent("tutorial",'{"step7":""}'),a.FirebaseTracking.logTutorial(1)),net.updateData({set:{stageIndex:D}},function(){pc.setStageIndex(D)}),(D<=150||200==D||250==D||300==D||350==D||400==D||450==D||500==D||550==D||595==D)&&YMTJ("lv","finish_lv_"+D)),record.cancel();var x=n.SDKManager.Instance.endLevelTimer(),R=a.FirebaseTracking.levelID,N=n.SDKManager.Instance.generateUniqueID(R),F=n.SDKManager.Instance.getAttempts(R),L=i.ADManager.Instance.IsReviveAds?1:0,P="",O=0,U=0,q=0,G=0,H=0,j=0,Y=0,W=0,V=0,X=0,z=0;if(window.StatsTracker){var K=StatsTracker.getSessionStats();K&&(P=K.equipmentEncoded||"",K.damageByWeapon&&(O=Math.floor(K.damageByWeapon.sniper||0),U=Math.floor(K.damageByWeapon.machinegun||0),q=Math.floor(K.damageByWeapon.firethrower||0),G=Math.floor(K.damageByWeapon.mortar||0),H=Math.floor(K.damageByWeapon.bouncingball||0),j=Math.floor(K.damageByWeapon.cannon||0),Y=Math.floor(K.damageByWeapon.laser||0),W=Math.floor(K.damageByWeapon.tesla||0),V=Math.floor(K.damageByWeapon.flyshield||0)),K.recovery&&(X=Math.floor(K.recovery.hp||0),z=Math.floor(K.recovery.armor||0)))}a.FirebaseTracking.logGameOver(N,x,L,1,0,F,P,O,U,q,G,H,j,Y,W,V,X,z)}}else t.chapterFail(e),s.chapterDeathFailed=!0},pauseFunc:function(e){e.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(t){if(e.popTimeScale(0),t){var o=n.SDKManager.Instance.endLevelTimer(),r=a.FirebaseTracking.levelID,s=n.SDKManager.Instance.generateUniqueID(r),c=n.SDKManager.Instance.getAttempts(r),l=i.ADManager.Instance.IsReviveAds?1:0,d="",h=0,u=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0,k=0,T=0;if(window.StatsTracker){var _=StatsTracker.getSessionStats();_&&(d=_.equipmentEncoded||"",_.damageByWeapon&&(h=Math.floor(_.damageByWeapon.sniper||0),u=Math.floor(_.damageByWeapon.machinegun||0),p=Math.floor(_.damageByWeapon.firethrower||0),f=Math.floor(_.damageByWeapon.mortar||0),m=Math.floor(_.damageByWeapon.bouncingball||0),g=Math.floor(_.damageByWeapon.cannon||0),v=Math.floor(_.damageByWeapon.laser||0),y=Math.floor(_.damageByWeapon.tesla||0),b=Math.floor(_.damageByWeapon.flyshield||0)),_.recovery&&(k=Math.floor(_.recovery.hp||0),T=Math.floor(_.recovery.armor||0)))}a.FirebaseTracking.logGameOver(s,o,l,0,1,c,d,h,u,p,f,m,g,v,y,b,k,T),chapter.remove(),menuManager.back(-1)}}})}};loadGame(A)}})}},chapterWin:function(t,i,n){if(console.log("[adventure]","[chapterWin]",this.chapterIndex,t),window.StatsTracker){var o=StatsTracker.getSessionStats();console.log("[StatsTracker] Game Over - Chapter Won",o),window.StatsStorage&&StatsStorage.saveStats(o)}var r=this;void 0===n&&(n=4.5);var c=this.chapterIndex,l=window.CHAPTER_DEFINE_ARRAY[c];console.log("chapter reward items",window.CHAPTER_DEFINE_ARRAY[c],c),record.stop(!1,"I\u2019m at the "+(+c+1)+"Chapter Highlights");var d,h,u=s.chapterToStage(c,this.mapIndex);cc.log("chapterWin",c,u);var p,f=[],m=l.item,g=r.getChapterExp(chapter.data.baseExp,l.stage.length);console.log("chapterWin","expProgressionTrack ","chapter.data.baseExp",chapter.data.baseExp,g),pc.stageIndex<u&&(window.CHAPTER_DEFINE_ARRAY[c+1]&&(pc.setChapterIndex(c+1),s.prepareChapterIndex=c+1),l.item0&&(m=m.concat(l.item0),cc.log("\u9996\u6b21\u901a\u5173\u5956\u52b1",m)),d={},h=equipment.checkUnlockSlotCt(),(u<=150||200==u||250==u||300==u||350==u||400==u||450==u||500==u||550==u||595==u)&&YMTJ("lv","finish_lv_"+u)),equipment.getItemFromReward(f,m),this.chapterIndex+1==1&&a.FirebaseTracking.logNewTutorial({Step:5,userID:user.uuid,Status:1}),this.chapterIndex+1==2&&a.FirebaseTracking.logNewTutorial({Step:11,userID:user.uuid,Status:1}),cc.log("chapter reward items",f,equipment.get("items")),equipment.save();var v=0;if(0!=c||user.getGuide("chapter")?1==c&&1==user.getGuide("chapter")&&(user.setGuide("chapter",2),v=1,TJ.onGuideEvent({guide_id:82,guide_name:"\u7b2c\u4e8c\u7ae0-\u80dc\u5229"})):(user.setGuide("chapter",1),v=1,TJ.onGuideEvent({guide_id:36,guide_name:"\u7b2c\u4e00\u7ae0-\u80dc\u5229"})),t&&t.layer.hidePauseBtn(!1),u>pc.stageIndex){(p={}).stageIndex=u;var y=s.stageToChapter(u),b=u-s.chapterToStage(y,0)+1;cc.log("[Leaderboard] Updating progress - Chapter:",y+1,"Stage:",b),e("../ui/leaderBoard/LeaderBoardPopup").updateProgress("mainStory",{chapter:y+1,stage:b},function(e,t){e?cc.log("[Leaderboard] Successfully updated! New rank:",t&&t.rank):cc.warn("[Leaderboard] Failed to update:",t)})}h&&(p||(p={}),p["equipment.slotCt"]=equipment.get("slotCt"));var k=pc.getHeroList();for(var T in k.length>0&&(p||(p={})),k)p[HERO+"."+k[T].id+".refreshCt"]=1,k[T].refreshCt=1;i.stack>1&&f.push({i:DIAMOND,n:[0,5,15,30][i.stack-1]}),g>0&&f.push({i:EXP_PROGRESSION_TRACK,n:g}),t&&(t.chapterFinish=!0);var _={};console.log("adventure chapterWin data",d),d&&Object.keys(d).length>0?(console.log("adventure chapterWin data",f,d,p),_={items:f,add:d,set:p}):(console.log("adventure chapterWin data",f,p),_={items:f,set:p}),console.log("adventure chapterWin data",_.add),net.updateData(_,function(e,o){cc.log("adventure chapterWin data",o),pc.setStageIndex(u),a.FirebaseTracking.setDataBiRes("PassChapter"),money.update(o),cc.game.emit("check_claim_reward"),window.TaskManager&&window.TaskManager.completeTask("task_1"),chapter.remove(),menuManager.loading=!1,menuManager.pop("chapter_complete",{win:1,delay:n,noBlock:1,game:t,vehicleConfig:i,level:r.mapIndex,guide:v,chapter:c,items:f,hideCb:function(){t&&(t.layer.hideJoystickBtn(!1),t.layer.hideOtherBtn(!1)),menuManager.preload("main")}})})},chapterFail:function(e,t){if(console.log("[adventure]","[chapterFail]",e),o.resetHistory(),console.log("[Adventure] Chapter failed - resetting consecutive HP tracking"),void 0===t&&(t=4),window.StatsTracker){var i=StatsTracker.getSessionStats();console.log("[StatsTracker] Game Over - Chapter Failed",i),window.StatsStorage&&StatsStorage.saveStats(i)}var n=this.chapterIndex;record.stop(!1,"I\u2019m at the "+(+n+1)+"Chapter Highlights");var r=this.mapIndex,s=[],c=window.CHAPTER_DEFINE_ARRAY[n];equipment.getItemFromReward(s,c.item,r/this.mapList.length),console.log("a / this.mapList.length",r/this.mapList.length,"this.mapIndex",this.mapIndex,this.mapList),console.log(chapter.data);var l=this.getChapterExp(chapter.data.baseExp,this.mapIndex+1);console.log("chapterFail","expProgressionTrack ","Base",chapter.data.baseExp,l),l>0&&s.push({i:EXP_PROGRESSION_TRACK,n:l}),e&&e.layer.hidePauseBtn(!1),net.updateData({items:s},function(i,o){a.FirebaseTracking.setDataBiRes("ChapterFail"),console.log("chapterFail",o),money.update(o),cc.game.emit("check_claim_reward"),chapter.remove(),menuManager.pop("chapter_complete",{win:0,delay:t,noBlock:1,game:e,level:r,chapter:n,items:s,hideCb:function(){e&&(e.layer.hideJoystickBtn(!1),e.layer.hideOtherBtn(!1)),menuManager.preload("main")}})})},getChapterExp:function(e,t){return e*t+5*t*(t+1)/2},updateMinigameProgress:function(t,i){cc.log("[Minigame Leaderboard] Updating progress for:",t,i);var a={};switch(t){case"bullet-fly":case"ballMode":a={highest_stage:i.highest_stage||i.stage||i.mapIndex||0,maintain_time:i.maintain_time||i.time||i.maintainTime||0,total_score:i.total_score||i.score||i.totalScore||0},t="bullet-fly";break;case"shoot-target":case"gunnerMode":a={highest_stage:i.highest_stage||i.stage||i.mapIndex||0,maintain_time:i.maintain_time||i.time||i.maintainTime||0,total_score:i.total_score||i.score||i.totalScore||0,accuracy:i.accuracy||0},t="shoot-target";break;case"make-choice":a={highest_stage:i.highest_stage||i.stage||i.level||0,maintain_time:i.maintain_time||i.time||i.maintainTime||0,total_score:i.total_score||i.score||i.totalScore||0,correct_choices:i.correct_choices||i.correctChoices||0};break;default:return void cc.warn("[Minigame Leaderboard] Unknown game type:",t)}e("../ui/leaderBoard/LeaderBoardPopup").updateProgress(t,a,function(e,i){e?(cc.log("[Minigame Leaderboard] Successfully updated! New rank:",i&&i.rank),i&&i.rank&&cc.log("Your new rank in",t,":",i.rank,"/",i.total_players)):cc.warn("[Minigame Leaderboard] Failed to update:",i)})},init:function(){}};window.adventure=s,cc._RF.pop()},{"../../Plugins/ADManager":"ADManager","../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/leaderBoard/LeaderBoardPopup":"LeaderBoardPopup","../utils/ConsecutiveHPManager":"ConsecutiveHPManager","./ChapterDefine":"ChapterDefine"}],antiAddiction:[function(e,t){"use strict";cc._RF.push(t,"1a4b89QwX5GtagmlfvFxpsx","antiAddiction"),window.antiAddiction={currencyLimit:function(e){if(!sdk.isAntiAddictionOpened())return!1;if(void 0===account.birth)return!0;var t=(Date.now()-account.birth)/365/24/60/60/1e3;if(t>18)return!1;if(t<=8)return menuManager.pop("notice",{title:"\u672a\u6ee18\u5468\u5c81\u5145\u503c\u9650\u5236",noWait:1,zIndex:9999,info:"\u6839\u636e\u56fd\u5bb6\u76f8\u5173\u653f\u7b56\u89c4\u5b9a\uff0c\u60a8\u672a\u6ee18\u5c81\uff0c\u4e0d\u80fd\u8fdb\u884c\u5145\u503c\u8d2d\u4e70\u3002"}),!0;if(t<=16){if(e>50||pay.currencyMonthly+e>200)return menuManager.pop("notice",{title:"8\uff5e16\u5468\u5c81\u5145\u503c\u9650\u5236",noWait:1,zIndex:9999,info:"\u6839\u636e\u56fd\u5bb6\u76f8\u5173\u653f\u7b56\u89c4\u5b9a\uff0c\u60a8\u5355\u6b21\u5145\u503c\u7684\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc750\u5143\uff0c\u4e14\u6bcf\u6708\u5145\u503c\u7d2f\u8ba1\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7200\u5143\u3002"}),!0}else if(e>100||pay.currencyMonthly+e>400)return menuManager.pop("notice",{title:"16\uff5e18\u5468\u5c81\u5145\u503c\u9650\u5236",noWait:1,zIndex:9999,info:"\u6839\u636e\u56fd\u5bb6\u76f8\u5173\u653f\u7b56\u89c4\u5b9a\uff0c\u60a8\u5355\u6b21\u5145\u503c\u7684\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7100\u5143\uff0c\u4e14\u6bcf\u6708\u5145\u503c\u7d2f\u8ba1\u91d1\u989d\u4e0d\u80fd\u8d85\u8fc7400\u5143\u3002"}),!0;return!1},notice:function(){return menuManager.pop("notice",{title:"\u9632\u6c89\u8ff7\u63d0\u793a",noWait:1,zIndex:9999,info:"\u60a8\u7684\u8ba4\u8bc1\u4fe1\u606f\u4e3a\u672a\u6210\u5e74\u4eba\n<size=18>\u4f9d\u636e\u6cd5\u5f8b\u8981\u6c42:                           \n\u4ec5\u5728\u6cd5\u5b9a\u8282\u5047\u65e520\u65f6\u81f321\u65f6\u7684\u65f6\u6bb5\uff0c\n\u672a\u6210\u5e74\u4eba(\u5373\u672a\u6ee118\u5468\u5c81)\u53ef\u8fdb\u884c\u6e38\u620f\u3002</s>",closeCb:function(){account.logout()}}),!0},isNotAdult:function(){return void 0===account.birth||(Date.now()-account.birth)/365/24/60/60/1e3<18},ban:function(){if(!sdk.isAntiAddictionOpened())return!1;if(this.isNotAdult()){var e=new Date;if(cc.warn("anti_addiction day&hours",e.getDay(),e.getHours()),e.getDay()<5||e.getHours()<20||e.getHours()>=21)return antiAddiction.notice(),!0}},check:function(e,t){if(18!==t.length)return 1;for(var i=0;i<17;i++){var a=t.charCodeAt(i);if(a<48&&a>57)return 2}var n=+t.substr(6,4);if(cc.warn(n),n<1900||n>2030)return 3;var o=["1","0","X","9","8","7","6","5","4","3","2"];if(!o.includes(t[17]))return 4;for(var r=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],s=0,c=0;c<17;c++)s+=+t[c]*r[c];var l=o[s%11];return cc.warn(l,t[17]),l!==t[17]?5:void 0},input:function(e){var t,i,a=this;return!!sdk.isAntiAddictionOpened()&&(void 0===account.birth?(TJ.onGuide(100,"\u5b9e\u540d-\u5f39\u7a97"),menuManager.pop("anti_addiction",{noWait:!0,initCb:function(e,a){t=a.node.find("board/inputs/editbox_idNum",cc.EditBox),i=a.node.find("board/inputs/editbox_name",cc.EditBox)},checkCb:function(n){if(n){var o=t.string.toUpperCase(),r=i.string;if(a.check(r,o))return kit.info("\u5b9e\u540d\u9a8c\u8bc1\u5931\u8d25(0)"),!0;httpCli.post("checkAntiAddiction",{name:r,idNum:o},function(t){t.err?(TJ.onGuide(200,"\u5b9e\u540d-\u51fa\u9519"),kit.info("\u5b9e\u540d\u9a8c\u8bc1\u5f02\u5e38("+t.err+")",function(){e&&e()})):t.fail?kit.info("\u5b9e\u540d\u9a8c\u8bc1\u5931\u8d25("+t.fail+")"):(TJ.onGuide(200,"\u5b9e\u540d-\u6210\u529f"),e&&e())})}return!0}}),!0):void 0)}},cc._RF.pop()},{}],ballMode:[function(e,t){"use strict";cc._RF.push(t,"7352cWNSWJGIYCNo8bfSiym","ballMode");var i=e("../../Plugins/ADManager"),a=e("../../Plugins/firebase/FirebaseTracking"),n=e("../../Plugins/SDKManager"),o=[{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg_ball"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{menu:"ball/game_1",map:"adv/750",lvl:1,lvl2:1},{menu:"ball/game_2",map:"adv/751",lvl:1,lvl2:1},{menu:"ball/game_3",map:"adv/752",lvl:1,lvl2:1},{menu:"ball/game_4",map:"adv/753",lvl:1,lvl2:1},{menu:"ball/game_5",map:"adv/754",lvl:1,lvl2:1,backpack:{blockData:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],blockItemData:[{id:"machine_gun",pos:[1,4]},{id:"cannon",pos:[1,6]}]}},{menu:"ball/game_2",map:"adv/751",lvl:3,lvl2:1},{menu:"ball/game_3",map:"adv/752",lvl:5,lvl2:1},{menu:"ball/game_1",map:"adv/750",lvl:5,lvl2:1},{menu:"ball/game_4",map:"adv/753",lvl:5,lvl2:1},{menu:"ball/game_5",map:"adv/754",lvl:5,lvl2:1,backpack:{blockData:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],blockItemData:[{id:"machine_gun",pos:[1,4]},{id:"cannon",pos:[1,6]}]}}]},{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg_ball"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{menu:"ball/game_5",map:"adv/754",lvl:4,lvl2:1,backpack:{blockData:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],blockItemData:[{id:"machine_gun",pos:[1,4]},{id:"cannon",pos:[1,6]}]}}]}],r={start:function(e){var t,i=(t=void 0===e?{}:e).chapterIndex,a=t.mapIndex,n=t.mgr,r=t.jumpToAdventure;if(o[i=i||0]){this.set(kit.rnd(0,9999999),i,a||0),ENTITY.v1,chapter.reset(),chapter.data.tank=[{weapon:"machine_gun",weaponLvl:1}],chapter.data.bench=[],chapter.data.bag=[],chapter.data.backpack={blockData:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],blockItemData:[{id:"machine_gun",pos:[1,4]},{id:"machine_gun",pos:[1,5]},{id:"machine_gun",pos:[1,6]}]};var s=this.transformBlockItemDataToTowersData(chapter.data.backpack);this.run({vid:"v1",star:1,attr:{},towers:s,heroes:[],bench:[]},n,r)}else cc.msgbox("\u672a\u5b9a\u4e49\u7684\u7ae0\u8282")},transformBlockItemDataToTowersData:function(e){var t=0,i=[];for(var a in e.blockData)for(var n in e.blockData[a])if(e.blockData[a][n]){t=a;break}for(var a in e.blockItemData){var o=e.blockItemData[a];if(o.pos){var r=BackpackItemDefine[o.id],s={stage:t,x:o.pos[0],i:r.unitID,y:o.pos[1],backpack:o};i.push(s)}}return cc.log("transformBlockItemDataToTowersData",i),i},set:function(e,t,i){this.chapterIndex=t,this.seed=e;var a=o[t],n=kit.core(e),r=this.mapList=[],s=a.stage,c=kit.clone(a.mapPool);for(var l in s){var d=s[l];if(d.map)r.push({map:d.map,lvl:d.lvl});else if(d.pool&&c[d.pool]){var h=c[d.pool],u=n.rndInt(0,h.length-1);r.push({map:h[u].map,lvl:d.lvl}),h.splice(u,1)}}this.mapIndex=i,cc.log("adventure load",this.mapList,this.mapIndex),adventure.startTime=Date.now()},run:function(t,s,c){var l=this,d=this.mapList[this.mapIndex],h=this.chapterIndex,u=o[this.chapterIndex];if(d){for(var p in t.tower)t.tower[p].hp=null,t.tower[p].atk=1;var f=t.vid,m=t.star,g=t.attr,v=t.hp,y=t.towers,b=t.heroes,k=t.bench,T=t.cd;cc.log("adventure run vehicleConfig",JSON.stringify(t));var _=u.stage[this.mapIndex];_.backpack&&(chapter.data.backpack=_.backpack,y=this.transformBlockItemDataToTowersData(_.backpack));var w="mini_"+(this.mapIndex+1);if(w=w.replace(" ",""),console.log("========= ball mode set level id : "+w),a.FirebaseTracking.levelID=w,!window.StatsTracker)try{e("../managers/StatsTracker"),console.log("[BallMode] Loaded StatsTracker")}catch(t){console.warn("[BallMode] Failed to load StatsTracker:",t)}window.StatsTracker&&(window.StatsTracker.initSession(),console.log("[BallMode] Initialized fresh StatsTracker session for stage",l.mapIndex)),l.stageStartTime=Date.now(),adventure.startTime||(adventure.startTime=Date.now()),map.load("map/"+d.map,function(o,p){if(o)kit.info("\u5730\u56fe\u4e0d\u5b58\u5728"+d.map);else{var w={lvl:_.lvl||1,lvl2:_.lvl2||1,entity:{1:{id:f,cd:T,star:m,attr:g,hp:v,towers:y,heroes:b,bench:k}},themeDefine:u.themeDefine};if(console.log("[BallMode] Checking equipment setup - StatsTracker:",!!window.StatsTracker,"towers:",y?y.length:0),window.StatsTracker&&y&&y.length>0)try{if(window.EquipmentEncoder||(console.log("[BallMode] Loading EquipmentEncoder..."),e("../utils/EquipmentEncoder")),console.log("[BallMode] EquipmentEncoder available:",!!window.EquipmentEncoder),console.log("[BallMode] EquipmentEncoder methods:",window.EquipmentEncoder?Object.keys(window.EquipmentEncoder):"N/A"),window.EquipmentEncoder){var E=[];console.log("[BallMode] Towers data (p):",y);for(var C=0;C<y.length;C++){var S=y[C];if(S&&S.backpack&&S.backpack.id){var I=S.backpack.id;console.log("[BallMode] Using level 1 for mini-game weapon:",I),E.push({weapon:I,weaponLvl:1}),console.log("[BallMode] Added equipment:",I,"level:",1)}}if(E.length>0){var A="";window.EquipmentEncoder.encodeCurrentEquipment?A=window.EquipmentEncoder.encodeCurrentEquipment({tank:E}):window.EquipmentEncoder.encode&&(A=window.EquipmentEncoder.encode(E)),console.log("[BallMode] Equipment encoded for StatsTracker:",A,"from array:",E),window.StatsTracker.setEquipmentConfiguration(y,A),console.log("[BallMode] Equipment configuration set in StatsTracker with towers data")}else console.log("[BallMode] No equipment found in towers data")}}catch(t){console.warn("[BallMode] Error setting equipment configuration:",t)}var B=_.menu||"ball/game_1",M={effectMgr:s,menu:B,me:1,chapterName:u.name,chapterIndexName:u.indexName,chapterIndex:h,mapName:l.mapIndex+1+"/"+l.mapList.length,mapIndex:l.mapIndex,remotes:w,auto:h>0?1:0,mapData:p,exp:0,startFunc:function(){},finishFunc:function(e,o){var s=function(){o||(e.effectMgr.cacheMode=!1);var i=[{i:GOLD,n:50*(l.mapIndex+1)}];menuManager.pop("chapter_complete",{win:o,delay:o?2:0,noBlock:1,game:e,vehicleConfig:t,jumpToAdventure:c,level:l.mapIndex,chapter:h,items:i,hideCb:function(){console.log("hide cb"),net.updateData({items:i},function(e,t){console.log("[updatedData]",t),money.update(t)}),e&&(e.layer.hideJoystickBtn(!1),e.layer.hideOtherBtn(!1)),menuManager.preload("main")},nextCb:function(){console.log("next cb",i),c?adventure.start(0):user.onlyPhysics?r.start({mapIndex:user.onlyPhysicsLevel||0}):menuManager.back(-1)}})};if(o){console.log("next stage");var d=n.SDKManager.Instance.endLevelTimer(),u=a.FirebaseTracking.levelID,p=n.SDKManager.Instance.generateUniqueID(u),f=n.SDKManager.Instance.getAttempts(u),m=i.ADManager.Instance.IsReviveAds?1:0,g="",v=0,y=0,b=0,k=0,T=0,_=0,w=0,E=0,C=0,S=0,I=0;if(window.StatsTracker){var A=window.StatsTracker.getSessionStats();A&&(g=A.equipmentEncoded||"",v=A.damageByWeapon.sniper||0,y=A.damageByWeapon.machinegun||0,b=A.damageByWeapon.firethrower||0,k=A.damageByWeapon.mortar||0,T=A.damageByWeapon.bouncingball||0,_=A.damageByWeapon.cannon||0,w=A.damageByWeapon.laser||0,E=A.damageByWeapon.tesla||0,C=A.damageByWeapon.flyshield||0,S=A.hpRecovered||0,I=A.armorRecovered||0,console.log("[BallMode] Stats retrieved - equipment:",g,"damages:",A.damageByWeapon,"recovery:",{hp:S,armor:I}))}else console.warn("[BallMode] StatsTracker not available for statistics");if(a.FirebaseTracking.logGameOver(p,d,m,1,0,f,g,v,y,b,k,T,_,w,E,C,S,I),l.mapIndex++,window.adventure&&window.adventure.updateMinigameProgress){l.stageStartTime||(l.stageStartTime=Date.now());var B=Math.floor((Date.now()-l.stageStartTime)/1e3),M=Math.floor((Date.now()-(adventure.startTime||Date.now()))/1e3);window.adventure.updateMinigameProgress("bullet-fly",{highest_stage:l.mapIndex,maintain_time:B,total_score:M}),l.stageStartTime=Date.now()}var D=l.mapList[l.mapIndex],x=2.5;e.levelMgr.callFade();var R=!0;e.addUpdate({updateLogic:function(i){if((x-=i)<0&&R)if(R=!1,D){var a=e.effectMgr;r.run(t,a)}else s()}})}else if(console.log("end stage",l),window.adventure&&window.adventure.updateMinigameProgress&&(l.stageStartTime||(l.stageStartTime=Date.now()),B=Math.floor((Date.now()-l.stageStartTime)/1e3),M=Math.floor((Date.now()-(adventure.startTime||Date.now()))/1e3),window.adventure.updateMinigameProgress("bullet-fly",{highest_stage:l.mapIndex,maintain_time:B,total_score:M}),console.log("Leaderboard updated on loss - Stage:",l.mapIndex,"Time:",M)),l.mapIndex){var N=[{i:GOLD,n:50*(l.mapIndex+1)}];menuManager.pop("revive",{noWait:!0,noBlock:!0,game:e,eventName:"mini_get_revived",items:N,closeCb:function(i){if(console.log("closecb"),net.updateData({items:N},function(e,t){console.log("[updatedData]",t),money.update(t)}),i){var a=e.effectMgr;r.run(t,a)}else s()}})}else s()},pauseFunc:function(e){e.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(t){e.popTimeScale(0),t&&(user.onlyPhysics?r.start({mapIndex:user.onlyPhysicsLevel||0}):(e.effectMgr.cacheMode=!1,menuManager.back(-1)))}})}};s?(s.cacheMode=!0,menuManager.run(B,M)):loadGame(M)}})}}};window.ballMode=r,cc._RF.pop()},{"../../Plugins/ADManager":"ADManager","../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../managers/StatsTracker":"StatsTracker","../utils/EquipmentEncoder":"EquipmentEncoder"}],base64:[function(e,t){"use strict";cc._RF.push(t,"50105Hyg+dBtbNlFMISlixo","base64");var i={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){for(var t,i,a,n,o,r,s,c="",l=0;l<e.length;)n=(t=e[l++])>>2,o=(3&t)<<4|(i=l<e.length?e[l++]:0)>>4,r=(15&i)<<2|(a=l<e.length?e[l++]:0)>>6,s=63&a,l-1>=e.length&&(r=64),l>=e.length&&(s=64),c+=this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return c},decode:function(e){var t,i,a,n,o,r,s=[],c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(n=this._keyStr.indexOf(e.charAt(c++)))>>4,i=(15&n)<<4|(o=this._keyStr.indexOf(e.charAt(c++)))>>2,a=(3&o)<<6|(r=this._keyStr.indexOf(e.charAt(c++))),s.push(t),64!=o&&s.push(i),64!=r&&s.push(a);return new Uint8Array(s)}};t.exports=i,cc._RF.pop()},{}],battleBottomUI:[function(e,t){"use strict";cc._RF.push(t,"7880cfyk6FMr63rwQrQMqJf","battleBottomUI");var i=e("../utils/StatsCalculator");cc.Class({extends:cc.Component,properties:{hpBar:cc.Node,hpLabel:cc.Label,epBar:cc.Node,epLabel:cc.Label,expBar:cc.Node,lvlLabel:cc.Label,goldLabel:cc.Label,talentLayoutNode:cc.Node,talentIconInstance:cc.Node,raritySpriteFrame:[cc.SpriteFrame],adTicketLabel:cc.Label,lblTotalATK:cc.RichText,lblHPRegen:cc.RichText,lblArmorRegen:cc.RichText},init:function(e,t){this.game=e,this.bagData=chapter.data.bag,this.isCheckPoint=t&&t.isCheckPoint,this.initTalentInfo()},initTalentInfo:function(){var e,t;null!=(e=chapter)&&null!=(t=e.data)&&t.talent&&(this.game.pickedTalent=chapter.data.talent);var i=this.game.pickedTalent;if(i)for(var a in i)this.addTalentIcon(i[a])},addTalentIcon:function(e,t){void 0===t&&(t=!0);var i=cc.instantiate(this.talentIconInstance);i.active=!0,this.talentLayoutNode.addChild(i);var a=TalentDefine[e.id];this.initTalentIcon(i,a),t&&i.runAction(cc.sequence(cc.scaleBy(.1,1.5),cc.scaleBy(.1,1/1.5)))},initTalentIcon:function(e,t){e.define=t;var i=Talent.getInfo(t.id);e.getComponent(cc.Sprite).spriteFrame=this.raritySpriteFrame[i.rarity-1];var a=e.getChildByName("icon").getComponent(cc.Sprite);this.game.effectMgr.loadSprite(a,i.iconImgPath)},setEnabled:function(e){this.node.getChildByName("money_bar").active=e},addWeaponTeam:function(e,t){var i=cc.instantiate(this.weaponTeamFramePrefab);cc.log("addWeaponTeam",e,t),i.getComponent("battleBottomWeaponUI").init(t,this.game),i.active=!0,i.x=0,i.y=0,this.weaponTeamNodes[e].addChild(i)},onLoad:function(){this.hpWidth=this.hpBar.width,this.expWidth=this.expBar.width,this.epWidth=this.epBar.width,this.epBar.width=0,this.currentATK=0,this.currentHPRegen=0,this.currentArmorRegen=0},setVehicle:function(e,t){this.vehicle=e,cc.log("[battleBottomUI] setVehicle called with:",e),t&&cc.log("[battleBottomUI] setVehicle called from:",t),e&&e.hpMax?(cc.log("[battleBottomUI] Vehicle max HP:",e.hpMax),cc.log("[battleBottomUI] Vehicle current HP:",e.hp),window.StatsCalculator&&window.StatsCalculator.setLastMaxHP(e.hpMax),this.updateBattleStats()):cc.log("[battleBottomUI] WARNING: Vehicle data incomplete, skipping stats calculation")},updateBattleStats:function(){if(this.vehicle&&this.vehicle.hpMax){var e=this.vehicle.hpMax;cc.log("[battleBottomUI] updateBattleStats - Using vehicle hpMax:",e);var t=null;window.StatsCalculator&&(t=window.StatsCalculator.getSyncedStats());var a=null,n=t&&t.maxHPUsed&&Math.abs(t.maxHPUsed-e)<1;if(t&&t.lastUpdated&&Date.now()-t.lastUpdated<1e4&&n)cc.log("[battleBottomUI] Using synced stats from StatsCalculator (max HP matches):",t),a={totalATK:t.totalATK,hpRegenPerSec:t.hpRegenPerSec,armorRegenPerSec:t.armorRegenPerSec};else{t&&!n?cc.log("[battleBottomUI] Max HP mismatch - synced:",t.maxHPUsed,"current:",e,"- recalculating stats"):cc.log("[battleBottomUI] No recent synced stats, calculating fresh stats");var o=[];this.game&&this.game.blockItemData?(o=this.game.blockItemData,cc.log("[battleBottomUI] Using blockItemData from game:",o.length+" items")):window.lastBlockItemData?(o=window.lastBlockItemData,cc.log("[battleBottomUI] Using blockItemData from window:",o.length+" items")):chapter.data&&chapter.data.backpack&&chapter.data.backpack.blockItemData?(o=chapter.data.backpack.blockItemData,cc.log("[battleBottomUI] Using blockItemData from chapter.data.backpack:",o.length+" items")):cc.log("[battleBottomUI] WARNING: No blockItemData found - stats will be 0");var r=e;if(window.lastVehicleData&&window.lastVehicleData.lastUpdated){var s=Date.now()-window.lastVehicleData.lastUpdated;s<3e4?(r=window.lastVehicleData.hpMax,cc.log("[battleBottomUI] Using authoritative max HP from BackpackMenu:",r,"(age:",s+"ms)")):cc.log("[battleBottomUI] Authoritative vehicle data too old, using current:",e)}var c={hpMax:r};if(!window.StatsCalculator)return void cc.log("[battleBottomUI] WARNING: StatsCalculator not available");window.StatsCalculator.setLastMaxHP(r),cc.log("[battleBottomUI] Set StatsCalculator max HP to authoritative value:",r),a=i.calculateAndSyncStats(o,c)}a?(cc.log("[battleBottomUI] Stats to display:",a),cc.log("[battleBottomUI] Label references - ATK:",!!this.lblTotalATK,"HPRegen:",!!this.lblHPRegen,"ArmorRegen:",!!this.lblArmorRegen),this.lblTotalATK&&(cc.log("[battleBottomUI] Updating ATK label from",this.currentATK||0,"to",a.totalATK),this.animateStatValue(this.lblTotalATK,this.currentATK||0,a.totalATK,"",1),this.currentATK=a.totalATK),this.lblHPRegen&&(cc.log("[battleBottomUI] Updating HP Regen label from",this.currentHPRegen||0,"to",a.hpRegenPerSec),this.animateStatValue(this.lblHPRegen,this.currentHPRegen||0,a.hpRegenPerSec,"/s",1),this.currentHPRegen=a.hpRegenPerSec),this.lblArmorRegen&&(cc.log("[battleBottomUI] Updating Armor Regen label from",this.currentArmorRegen||0,"to",a.armorRegenPerSec),this.animateStatValue(this.lblArmorRegen,this.currentArmorRegen||0,a.armorRegenPerSec,"/s",1),this.currentArmorRegen=a.armorRegenPerSec),this.calculatedStats=a):cc.log("[battleBottomUI] WARNING: No stats available")}else cc.log("[battleBottomUI] updateBattleStats - Skipping, no vehicle data yet")},onEquipmentStatsUpdated:function(e){this.lblTotalATK&&(this.animateStatValue(this.lblTotalATK,this.currentATK||0,e.totalATK,"",1),this.currentATK=e.totalATK),this.lblHPRegen&&(this.animateStatValue(this.lblHPRegen,this.currentHPRegen||0,e.hpRegenPerSec,"/s",1),this.currentHPRegen=e.hpRegenPerSec),this.lblArmorRegen&&(this.animateStatValue(this.lblArmorRegen,this.currentArmorRegen||0,e.armorRegenPerSec,"/s",1),this.currentArmorRegen=e.armorRegenPerSec),this.calculatedStats=e},animateStatValue:function(e,t,i,a,n){if(e&&e.node){a=a||"";var o=(n=n||0)>0?Math.pow(.1,n):0;if(Math.abs(i-t)>o){cc.Tween.stopAllByTarget(e.node),e.node.stopAllActions(),e._currentTween&&(e._currentTween.stop(),e._currentTween=null);var r,s=i-t;r=s>0?n>0?"+"+s.toFixed(n):"+"+Math.floor(s):n>0?s.toFixed(n):Math.floor(s).toString();var c=e.node.color.clone();if(""!=r){var l=s>0?"#82FF3A":"#FF2626",d="<outline color=black width=2>"+t.toFixed(n)+a+" <color="+l+">"+r+"</color> </outline>";e.string=d,e._updateRichText&&e._updateRichText()}e.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){e.node.color=c;var o={value:t};e._currentTween=cc.tween(o).to(.3,{value:i},{progress:function(t,i,o,r){var s,c=t+(i-t)*r;s=n>0?"<outline color=black width=2>"+c.toFixed(n)+a+"</outline>":"<outline color=black width=2>"+Math.floor(c)+a+"</outline>",e instanceof cc.RichText?e.string=s:void 0!==e.string&&(e.string=s),e._updateRichText&&e._updateRichText()},easing:"quadOut"}).call(function(){e._currentTween=null}).start()},this)))}}},lateUpdate:function(){var e=this.vehicle;e&&!e.removed&&(this.hp!=e.hp&&this.refreshHpBar(),this.exp==chapter.get("exp")&&this.lvl==chapter.get("lvl")||this.refreshExpBar(),this.ep!=e.shieldCurrent&&this.refreshEpBar(),this.goldLabel.string=chapter.get("gold"),this.adTicketLabel&&(this.adTicketLabel.string=money.getNum(SWEEP_TICKET)))},refreshWeaponTeamHpBar:function(){for(var e in this.weaponTeamNodes){var t=this.weaponTeamNodes[e];cc.log(e,t.weaponTeam),t.weaponTeam&&t.weaponTeam.getComponent("battleBottomWeaponUI").refreshHpBar()}},getCalculatedHpMax:function(){var t=1*(this.game.args.vehicleConfig.attr.hp||ENTITY[VEHICLE_BASE].hp),i=chapter.data.events;cc.log("getCalculatedHpMax events",i);var a=[];for(var n in i){var o=i[n],r=EVENTS[o.eventId];o.objectId&&"che"!=o.objectId||r.attr&&(a=a.concat(r.attr))}var s=new(e("../components/attributes/Attribute"));s.init("hpMax",t,1e10,0,function(){});var c=pc.talentGlobal.hp4vehicle;c&&s.addScale("hpMax",+c);var l=(s=this.getAttr(s,a)).get("hpMax");return cc.log("getCalculatedHpMax",l),l},getAttr:function(e,t){if(t){var i=e;for(var a in t){var n=t[a],o=n[0];"hpMax"==n[1]&&(o==ADD?i.add(n[1],n[2]):o==ADD_SCALE?i.addScale(n[1],n[2]):o==ADD_COVER?i.addCover(n[1],n[2]):o==MUT_SCALE&&i.mutScale(n[1],n[2]))}return e}},refreshHp:function(){this.refreshHpBar()},refreshExpBar:function(){this.vehicle,this.exp=chapter.get("exp"),this.lvl=chapter.get("lvl");var e=LVL_EXP_DEFINE[this.lvl].exp,t=this.exp/e;t>1&&(t=1);var i=t*(this.expWidth-1)+1;this.expBar.width=i,this.lvlLabel.string=this.lvl},refreshEpBar:function(){var e,t=this.vehicle;this.ep=t.shieldCurrent;var i=t.shieldMax,a=t.shieldCurrent;if(i){var n=a/i;n>1&&(n=1),e=n*(this.epWidth-1)+1}else e=0;this.epBar.width=e,e?(this.epLabel.node.parent.active=!0,this.epLabel.string=Math.ceil(a)):this.epLabel.node.parent.active=!1},refreshHpBar:function(){var e,t=this.vehicle;this.hp=t.hp;var i=this.isCheckPoint&&this.getCalculatedHpMax()||t.hpMax,a=this.isCheckPoint&&i*t.hp||t.hp,n=a/i,o=n*(this.hpWidth-1)+1;this.hpBar.width=o,this.hpLabel.string=Math.ceil(a),n<.3?(e=cc.color(255,0,0),this.lowHpAction||(this.lowHpAction=this.hpBar.runAction(cc.sequence(cc.fadeTo(.3,150),cc.fadeTo(.3,255)).repeatForever()))):(e=cc.color(48,212,40),this.lowHpAction&&(this.hpBar.stopAction(this.lowHpAction),this.lowHpAction=null,this.hpBar.opacity=255)),this.hpBar.color=cc.color(255,255,255),this.hpBar.runAction(cc.tintTo(.1,e))},updateItems:function(){this.bagData=chapter.data.bag,cc.warn("updateItems",this.bagData);var e=0,t=0,i=0;for(var a in this.bagData){var n=this.bagData[a],o=ItemDefine[n.id];"weapon"==o.type?e++:"equipment"==o.type?t++:"material"==o.type&&i++}this.itemBags[0].itemCt=e,this.itemBags[1].itemCt=t,this.itemBags[2].itemCt=i,this.itemBags[0].getChildByName("open").getChildByName("numLabel").getComponent(cc.Label).string=e+"/12",this.itemBags[1].getChildByName("open").getChildByName("numLabel").getComponent(cc.Label).string=t+"/12",this.itemBags[2].getChildByName("open").getChildByName("numLabel").getComponent(cc.Label).string=i+"/20"},getItemTypeCt:function(e){return"weapon"==e?this.itemBags[0].itemCt:"equipment"==e?this.itemBags[1].itemCt:void("material"==e&&this.itemBags[2].itemCt)},initItemButton:function(){},updateItemButton:function(){},onItemButton:function(){},start:function(){},initBlocks:function(){},getItemCtor:function(t){return cc.log(t),ItemDefine[t].ctor||e("./checkPointItem")},getBagItem:function(){},getBagItemById:function(){},addBagItem:function(){},showBagOnly:function(){},enableBag:function(){},popTalentInfo:function(e){var t=e.target.define;kit.info(t.des,null,2,-200)},onDestroy:function(){}}),cc._RF.pop()},{"../components/attributes/Attribute":"Attribute","../utils/StatsCalculator":"StatsCalculator","./checkPointItem":"checkPointItem"}],battleBottomWeaponUI:[function(e,t){"use strict";cc._RF.push(t,"e99c4/rk2hI2Jlb71ql8xOh","battleBottomWeaponUI"),cc.Class({extends:cc.Component,properties:{operatorSprite:cc.Sprite,hpBar:cc.Node,weaponIconSprite:cc.Sprite,weaponBaseSprite:cc.Sprite,equipmentSprites:[cc.Sprite],hpLabel:cc.Label,mainGunnerFrame:cc.Node,weaponTeamNode:cc.Node},onLoad:function(){this.hpWidth=this.hpBar.width},initByWeaponTeam:function(e,t){if(this.game=t,this.tower=e,this.isWeaponTeam=!0,console.log("battleBottomWeaponUI hp",this.hp),this.weaponId=e&&e.weapon,console.log("battleBottomWeaponUI weaponId",this.weaponId),e&&e.equipment)for(var i in this.equipment=e.equipment,console.log("battleBottomWeaponUI equipment",this.equipment),this.equipmentSprites)if(this.equipment[i]){this.equipmentSprites[i].node.active=!0;var a=ItemDefine[this.equipment[i]].lvl||1;this.game.effectMgr.loadSprite(this.equipmentSprites[i],"checkpoint/item/i"+a)}else this.equipmentSprites[i].node.active=!1;else for(var i in this.equipmentSprites)this.equipmentSprites[i].node.active=!1;if(e){var n=ENTITY[e.operator].head;this.game.effectMgr.loadSprite(this.operatorSprite,n);var o=ItemDefine[this.weaponId].avatar.icon;this.game.effectMgr.loadSprite(this.weaponIconSprite,o);var r=e.weaponLvl||1;console.log("battleBottomWeaponUI weaponRarity",r),this.game.effectMgr.loadSprite(this.weaponBaseSprite,"checkpoint/item/g"+r),this.weaponIconSprite.node.active=!0,this.weaponBaseSprite.node.active=!0}else this.weaponIconSprite.node.active=!1,this.weaponBaseSprite.node.active=!1},init:function(e,t){if(this.game=t,this.tower=e,this.heroCfg=e.hero.config,console.log("battleBottomWeaponUI towerCfg,",e),console.log("battleBottomWeaponUI heroCfg",this.heroCfg),console.log("battleBottomWeaponUI hp",this.hp),this.weaponId=e.define.id,console.log("battleBottomWeaponUI weaponId",this.weaponId),e.config.equipment)for(var i in this.equipment=e.config.equipment,console.log("battleBottomWeaponUI equipment",this.equipment),this.equipmentSprites)if(this.equipment[i]){this.equipmentSprites[i].node.active=!0;var a=ItemDefine[this.equipment[i]],n=a&&a.lvl||1;this.game.effectMgr.loadSprite(this.equipmentSprites[i],"checkpoint/item/i"+n)}else this.equipmentSprites[i].node.active=!1;var o=ENTITY[this.heroCfg.i].head;this.game.effectMgr.loadSprite(this.operatorSprite,o);var r=GetWeaponDefineByGameId(this.weaponId).avatar.icon;this.game.effectMgr.loadSprite(this.weaponIconSprite,r);var s=e.config&&e.config.lvl||1;console.log("battleBottomWeaponUI weaponRarity",s),this.game.effectMgr.loadSprite(this.weaponBaseSprite,"checkpoint/item/g"+s)},lateUpdate:function(){var e=this.tower;e&&!e.removed&&(e.mainFlag?this.mainGunnerFrame.active=!0:this.mainGunnerFrame.active=!1,this.hp!=e.hp&&this.refreshHpBar())},refreshHpBar:function(){var e,t=this.tower;this.hp=t.hp;var i=this.isWeaponTeam&&t.getCalculatedHpMax()||t.hpMax,a=this.isWeaponTeam&&i*t.hp||t.hp,n=a/i,o=n*(this.hpWidth-1)+1;this.hpBar.width=o,this.hpLabel.string=Math.ceil(a)+"/"+Math.ceil(i),0==this.hp&&this.node.getChildByName("\u635f\u6bc1")&&(this.node.getChildByName("\u635f\u6bc1").active=!0),n<.3?(e=cc.color(255,0,0),this.lowHpAction||(this.lowHpAction=this.hpBar.runAction(cc.sequence(cc.fadeTo(.3,150),cc.fadeTo(.3,255)).repeatForever()))):(e=cc.color(48,212,40),this.lowHpAction&&(this.hpBar.stopAction(this.lowHpAction),this.lowHpAction=null,this.hpBar.opacity=255)),this.hpBar.color=cc.color(255,255,255),this.hpBar.runAction(cc.tintTo(.1,e))},start:function(){}}),cc._RF.pop()},{}],block:[function(e,t){"use strict";cc._RF.push(t,"b82e37E14NLCqZXa8a8QbEJ","block"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=(e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),e("../components/visual/Avatar"));ENTITY.box={id:"box",name:"\u7bb1\u5b50",avatar:{ctor:a,frm:"avatar/box_close",s:.9,moveSpd:50,z:ZORDER.HERO+1},box:1,noDrop:1,deathEffect:EFFECT.openBox,height:30,radius:30,hitRadius:30,moveSpd:0,weight:50,hp:100,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead"},RES.box=["avatar/box_close","avatar/box_open"],ENTITY.block={id:"block",name:"\u6321\u677f",avatar:{ctor:a,frm:"avatar/block/\u9489\u677f",s:1,moveSpd:50,z:ZORDER.HERO+1,flipX:-1},deathEffect:EFFECT.blockDeath,radius:30,moveSpd:0,weight:50,hp:200,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},ENTITY.block3={id:"block3",name:"\u96ea\u7cd5\u7b52",editor:1,avatar:{ctor:a,frm:"theme/\u7801\u5934/\u96ea\u7cd5\u7b52",s:1,moveSpd:50,z:ZORDER.HERO+1,flipX:-1},deathEffect:EFFECT.blockDeath,radius:30,moveSpd:0,weight:50,hp:200,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},ENTITY.block2={id:"block2",name:"\u6321\u677f",avatar:{ctor:a,frm:"avatar/block/\u9489\u677f",s:1.5,moveSpd:50,z:ZORDER.HERO+1,flipX:-1},deathEffect:EFFECT.blockDeath,radius:45,moveSpd:0,weight:50,hp:400,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},ENTITY.fallShard={id:"fallShard",name:"\u88c2\u7247",avatar:{ctor:a,frm:"avatar/fallshard/2",s:1,moveSpd:50,z:-1,flipX:-1},deathEffect:EFFECT.ironStructureDeath,editor:1,radius:55,hitRadius:88,moveSpd:0,weight:50,hp:350,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},ENTITY.sandbag={id:"block",name:"\u6c99\u5305",avatar:{ctor:a,frm:"avatar/block/\u6c99\u5305",s:1,moveSpd:50,z:ZORDER.HERO+1},deathEffect:EFFECT.sandbagDeath,radius:30,moveSpd:0,weight:50,hp:150,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.radio={id:"radio",name:"\u5f55\u97f3\u673a",editor:1,avatar:{ctor:i,anime:"mob/liushengji",s:1,animeName:"liushengji",armatureName:"\u5e7f\u64ad\u76d2\u5b50",moveSpd:50,z:ZORDER.HERO+1,dy:-20,flipX:1,fixFlipX:1},deathEffect:EFFECT.radioDeath,radius:30,moveSpd:10,weight:50,hp:50,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},ENTITY.firepit={id:"firepit",name:"\u706b\u5806",editor:1,avatar:{ctor:a,animation:"avatar/block/firepit",s:1,speed:2,moveSpd:50,z:ZORDER.HERO+1,ay:.2},deathEffect:EFFECT.firepitDeath,radius:30,moveSpd:0,weight:50,hp:150,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.blockBig={id:"blockBig",name:"\u6321\u677f",avatar:{ctor:a,frm:"avatar/block/\u9489\u677f",s:1,moveSpd:50,z:ZORDER.HERO+1},deathEffect:EFFECT.blockDeathBig,radius:30,moveSpd:0,weight:50,hp:400,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},RES.block=["avatar/block/\u9489\u677f"],ENTITY.mine={id:"mine",name:"\u5730\u96f7",safeSlotOut:1,avatar:{ctor:a,frm:"avatar/block/\u6c34\u96f7",s:.9,moveSpd:50,shadowR:100,z:ZORDER.HERO+1},deathEffect:EFFECT.deathHide,bomb:{r1:200,r0:50,dmg1:30,dmg0:30,kb:100,effect:EFFECT.explosion},height:30,radius:30,hitRadius:30,moveSpd:0,weight:50,hp:140,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building},RES.block=["avatar/block/\u6c34\u96f7"],ENTITY.fort1={id:"fort1",name:"\u7889\u5821-1",avatar:{ctor:a,frm:"avatar/\u4e0d\u5e26\u4ed3\u53e3",s:.9,z:ZORDER.HERO+1,fixFlipX:1,flipX:-1},deathEffect:EFFECT.blockDeathBig,slot:1,sub:1,safeSlotOut:1,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:1500,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",slots:[{x:0,y:60,w:160,h:50,slot:1,sub:1}]},ENTITY.fort2={id:"fort2",name:"\u7889\u5821-2",avatar:{ctor:a,frm:"avatar/\u5e26\u4ed3\u53e3-\u4e0a",s:.9,z:ZORDER.HERO+1,fixFlipX:1,flipX:-1,effect:EFFECT.createBack},deathEffect:EFFECT.blockDeathBig,slot:1,sub:1,safeSlotOut:1,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:1500,armor:200,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",slots:[{x:0,y:60,w:160,h:50,slot:1,sub:1},{x:-40,y:-60,w:70,h:20,cover:1}]},ENTITY.prisoner_haoren={id:"prisoner_haoren",name:"\u56da\u72af-\u597d\u4eba",avatar:{ctor:e("../components/visual/PrisonerAvatar"),animeName:"haoren",anime:"operator/haoren",s:.6,fixedScale:1,moveSpd:150,dy:-50},box:0,noDrop:1,noBullet:1,machine:1,deathEffect:EFFECT.PrisonerSpecialDeath,deathCb:function(){var e=this.game.layer,t=this.game.levelMgr.heroes[1],i=t.attribute;this.game.callFuncDelay(function(){i.add("moveSpd",-50)},1);var a=this;this.game.callFuncDelay(function(){menuManager.pop("new_operator_get",{game:a.game,operator:"h2"})},1.9),this.game.callFuncDelay(function(){chapter.data.tank[0].operator="h2";var e=t.addHero({s:0,i:"h2"},0);e&&e.avatar.displayNode.runAction(cc.blink(.5,4)),t.towers[0].hero=e,a.game.layer.bottomUI.addWeaponTeam(0,t.towers[0]);var i=t.attribute;i.add("moveSpd",50),i.addScale("atkScale",.2),a.game.layer.bottomUI.node.active=!0,TJ.onGuideEvent({guide_id:4,guide_name:"\u83b7\u5f97\u89d2\u82721"})},2),menuManager.chatOn(e,"\u6765\u4e0d\u53ca\u89e3\u91ca\u4e86\uff0c\u5feb\u4e0a\u8f66\uff01",1.5,{head:"h99",dy:230,dx:-160,z:999})},height:50,radius:55,hitRadius:1,moveSpd:0,weight:50,hp:100,hurtScale:.01,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead"},ENTITY.prisoner_xiaoxiong={id:"prisoner_xiaoxiong",name:"\u56da\u72af-\u5c0f\u718a",avatar:{ctor:e("../components/visual/PrisonerAvatar"),animeName:"xiaoxiong",anime:"operator/xiaoxiong",s:.6,fixedScale:1,moveSpd:150,dy:-50},box:0,noDrop:1,deathEffect:EFFECT.PrisonerSpecialDeath,machine:1,deathCb:function(){var e=this.game.levelMgr.heroes[1],t=this.game.layer;e.attribute.add("moveSpd",-50);var i=this;this.game.callFuncDelay(function(){menuManager.pop("new_operator_get",{game:i.game,operator:"h4"})},2.4),this.game.callFuncDelay(function(){[].push({s:0,i:"h4"}),chapter.data.bench.push("h4");var t=e.addHero({s:0,i:"h4"},1);t&&t.avatar.displayNode.runAction(cc.blink(.5,4)),e.attribute.add("moveSpd",50),TJ.onGuideEvent({guide_id:21,guide_name:"\u83b7\u5f97\u89d2\u82722"})},2),menuManager.chatOn(t,"\u8fd8\u662f\u6765\u4e0d\u53ca\u89e3\u91ca\uff0c\u5feb\u4e0a\u8f66\u5148\uff01",.5,{head:"h99",dy:230,dx:-160,z:999})},height:50,radius:55,hitRadius:1,moveSpd:0,weight:50,hp:100,hurtScale:.01,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead"},ENTITY.prisoner_qishou={id:"prisoner_qishou",name:"\u56da\u72af-\u65d7\u624b",avatar:{ctor:e("../components/visual/PrisonerAvatar"),animeName:"qishou",anime:"operator/qishou",s:.6,fixedScale:1,moveSpd:150,dy:-50},box:0,noDrop:1,deathEffect:EFFECT.PrisonerDeath,machine:1,safeSlotOut:1,deathCb:function(){var e=this.game.levelMgr.heroes[1],t=this.game.layer;e.attribute.add("moveSpd",-50);var i=this;this.game.callFuncDelay(function(){menuManager.pop("new_operator_get",{game:i.game,operator:"h3"})},1.9),this.game.callFuncDelay(function(){var t=[null];t.push({s:0,i:"h3"}),e.avatar.addBench(t,1),chapter.data.bench.push("h3"),e.attribute.add("moveSpd",50),TJ.onGuideEvent({guide_id:56,guide_name:"\u83b7\u5f97\u89d2\u82723"})},2),menuManager.chatOn(t,"\u8fd8\u8981\u89e3\u91ca\u5417\uff1f\u5feb\u4e0a\u8f66\uff01",1.5,{head:"h99",dy:230,dx:-160,z:999})},height:50,radius:55,hitRadius:1,moveSpd:0,weight:50,hp:100,hurtScale:.01,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead"},ENTITY.prisoner_degun={id:"prisoner_degun",name:"\u56da\u72af-\u5fb7\u68cd",avatar:{ctor:e("../components/visual/PrisonerAvatar"),animeName:"degun",anime:"operator/degun",s:.6,fixedScale:1,moveSpd:150,dy:-50},box:0,noDrop:1,deathEffect:EFFECT.PrisonerDeath,machine:1,deathCb:function(){var e=this.game.levelMgr.heroes[1],t=this.game.layer;e.attribute.add("moveSpd",-50);var i=this;this.game.callFuncDelay(function(){menuManager.pop("new_operator_get",{game:i.game,operator:"h1"})},1.9),this.game.callFuncDelay(function(){var t=[];t.push({s:0,i:"h1"}),e.avatar.addBench(t,1),chapter.data.bench.push("h1"),e.attribute.add("moveSpd",50)},2),menuManager.chatOn(t,"\u6765\u4e0d\u53ca\u89e3\u91ca\u4e86\uff0c\u5feb\u4e0a\u8f66\uff01",1.5,{head:"h99",dy:230,dx:-160,z:999})},height:50,radius:55,hitRadius:1,moveSpd:0,weight:50,hp:100,hurtScale:.01,armor:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead"},ENTITY.flyBox={id:"flyBox",name:"\u98de\u7bb1",avatar:{animeName:"feizhua",anime:"mob/feizhua",s:.8,moveSpd:50},fixedFlipX:1,fly:1,deathEffect:EFFECT.blockDeath,radius:55,hitRadius:55,moveSpd:100,weight:50,height:0,hp:2e3,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.structure,editor:1,crit:0,bltDmg:123,blt:BULLET_DEFINE[E_SOLDIOR],bltMax:6,bltReload:.9,pilot:{ctor:e("../ai/units/AIFlySoldierWander"),moveBy:{x:-600,y:0},attackRange:500}},ENTITY.flyBoxUpgrade={id:"flyBoxUpgrade",name:"\u98de\u7bb1\u9001\u5956\u52b1",boxFlag:1,avatar:{animeName:"feizhua",anime:"mob/feizhua",s:.8,moveSpd:50},fixedFlipX:1,fly:1,deathEffect:EFFECT.blockDeath,radius:80,hitRadius:85,moveSpd:1,weight:50,height:0,hp:500,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.structure,editor:1,crit:0,bltDmg:123,blt:BULLET_DEFINE[E_SOLDIOR],bltMax:6,bltReload:.9,pilot:{ctor:e("../ai/core/AICommon")},createCb:function(){var e,t,i=this.config.drop;if(i)"string"==typeof i&&(e=i);else{var a=Object.keys(BackpackItemDefine);e=a[kit.rndInt(0,a.length-1)]}e&&n[e]&&(t="avatar/backpack/boxIcon/"+n[e]),this.game.callEffect(EFFECT.bonusIcon,this.avatar,{icon:t})},deathCb:function(e){if(cc.log("try deathCb",e),e.bulletFlag){var t;cc.log("try deathCb 3",e),this.game.callEffect(EFFECT.explosionDeath,this.avatar);var i=this.game.levelMgr.heroes[1],a=this.config.drop;if(a)"string"==typeof a&&(t=a);else{var o=Object.keys(BackpackItemDefine);t=o[kit.rndInt(0,o.length-1)]}if(t){var r,s=i.checkBackpackTowerUpgrade(t);if(s)r=s;else{if(!(r=i.addBackpackTower(t)))return;r.setFlag(NO_ATTACK,!0),r.avatar.node.active=!1}var c="avatar/backpack/boxIcon/"+n[t],l=this.game.effectMgr.createSprite(this.x,this.y,c);this.game.layer.addToCamera(l,ZORDER.EFFECT);var d=this;l.runAction(cc.sequence(cc.scaleTo(.2,2),cc.delayTime(.5),cc.moveTo(.2,cc.v2(r.x+50,r.y)),cc.callFunc(function(){s?r=i.addBackpackTower(t):(r.setFlag(NO_ATTACK,!1),r.avatar.node.active=!0);var e=d.game.effectMgr.createAnimation("effect/backpack/sj",{speed:1,repeat:1});e.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,e.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,e.scale=2,r.avatar.node.addChild(e),d.game.effectMgr.playEffect("sound/checkpoint/get_item")}),cc.destroySelf()))}cc.log("flyBoxUpgrade deathcb drop",t)}else cc.log("try deathCb fail",e)}};var n={machine_gun:"jiqiang",machine_gun2:"jiqiang2",machine_gun3:"jiqiang3",machine_gun4:"jiqiang4",mortar:"daodan",mortar2:"daodan2",mortar3:"daodan3",mortar4:"daodan4",cannon:"dapao",cannon2:"dapao2",cannon3:"dapao3",cannon4:"dapao4",tesla:"dianta",tesla2:"dianta2",tesla3:"dianta3",tesla4:"dianta4",fire_thrower:"huoyanpensheqi",fire_thrower2:"huoyanpensheqi2",fire_thrower3:"huoyanpensheqi3",fire_thrower4:"huoyanpensheqi4",laser:"jiguangpao",laser2:"jiguangpao2",laser3:"jiguangpao3",laser4:"jiguangpao4",heal:"\u590d\u5408\u5316\u5b66\u5242",heal2:"\u590d\u5408\u5316\u5b66\u52422",heal3:"\u590d\u5408\u5316\u5b66\u52423",heal4:"\u590d\u5408\u5316\u5b66\u52424",armor:"BOX",armor2:"BOX2",armor3:"BOX3",armor4:"BOX4"};cc._RF.pop()},{"../ai/core/AICommon":"AICommon","../ai/units/AIFlySoldierWander":"AIFlySoldierWander","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../components/visual/PrisonerAvatar":"PrisonerAvatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","./define":"define"}],bonusEffect:[function(e,t){"use strict";cc._RF.push(t,"14652ieRnBNCIkCyg4QlQme","bonusEffect"),RES.infiniteHeat=[{atlas:"effect/buff/wuxianhuoli"}],EFFECT.infiniteHeat=function(e){var t=this,i=e.obj.avatar;if(i){var a=i.hpBar;if(a){var n=function(e,i){var n=t.createAnimation(e,i);return a.epBar.addChild(n,1),n.scale=1,n.x=24,n.y=0,n},o=n("effect/buff/wuxianhuoli",{speed:2,repeat:-1});return o.opacity=0,n("effect/buff/wuxianhuoliqidong",{alive:1,speed:2,repeat:1}).runAction(cc.sequence(cc.delayTime(.5),cc.callFunc(function(){o.opacity=255}),cc.recycle())),o.remove=function(){o.recycleFunc(),n("effect/buff/wxhlxiaoshi",{speed:2,repeat:1})},o}}},RES.invincible=[{atlas:"effect/buff/fanghuzhao"}],EFFECT.invincible=function(e){var t=this;cc.warn("invincible");var i=function(i,a){var n=e.obj.radius,o=t.createAnimation(i,a);e.addChild(o,ZORDER.EFFECT),o.x=n,o.y=50,o.scale=kit.clamp(n/100,0,1)*ANIME_SCALE;var r=o.sprite;return r.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,r.dstBlendFactor=cc.macro.BlendFactor.ONE,o},a=i("effect/buff/fanghuzhao",{speed:2,repeat:-1});return a.opacity=0,i("effect/buff/fanghuzhaoqidong",{alive:1,speed:2,repeat:1}).runActionVS(cc.sequence(cc.delayTime(.8),cc.callFunc(function(){a.opacity=255}),cc.recycle())),a.remove=function(){a.recycleFunc(),i("effect/buff/fanghuzhaoxiaoshi",{speed:2,repeat:1})},a},EFFECT.invincibleBuff=function(e){var t=e.obj.avatar;if(t)return EFFECT.invincible.call(this,t)},RES.missileStreak=["effect/pharah/light","effect/pharah/tail"],EFFECT.missileStreak=function(e){var t=this.createSprite(-60,0,"effect/buff/light");e.addChild(t,1),t.setScale(2),t.opacity=255,t.runActionVS(cc.sequence(cc.scaleTo(.2,.8),cc.scaleTo(.1,1)).repeatForever());var i=this.createMotionStreak("effect/buff/tail",.3,10,20);this.layer.addToCamera(i,ZORDER.BULLET-1),i.setPosition(e.x,e.y),i.opacity=150;var a=i.motionStreak;return a.removeFlag=!1,a.updateReal=function(t){if(a.removeFlag){var i=this.stroke;this.stroke=i>80*t?i-80*t:0}else this.node.setPosition(e.node.x,e.node.y);this.deltaTime+=t},a.scheduleVS(a.updateReal,0),i.remove=function(){a.removeFlag=!0,this.runActionVS(cc.sequence(cc.fadeOut(.501),cc.recycle()))},i},cc._RF.pop()},{}],bonus:[function(e,t){"use strict";cc._RF.push(t,"4f43ePKDG1JQ56mPgWR6Jw4","bonus"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=e("../entities/projectiles/BallBulletSprite"),n=e("../entities/projectiles/Bomb");e("../components/visual/Avatar"),e("../ai/behaviors/combat/AISoldier"),e("./Exploder");var o=e("../components/combat/buffs/Buff"),r=e("../entities/characters/HumanAvatar");window.ShotSeq2={ctor:e("../components/combat/buffs/ShotSeqBuff"),symbol:o.getSymbol(),t:10,dt:.1,deg:-15,blt:[{name:"\u70ae\u5f39",ctor:n,noContact:1,avatar:{ctor:a,frm:"avatar/1",sx:.35,sy:.35,noBlend:!0,streakEffect:EFFECT.bulletStreak},bomb:{r1:90,r0:50,dmg1:555,dmg0:555,kb:300,effect:EFFECT.bombs,weaponType:WEAPON_TYPE[CANNON_GUN]},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:1200,spdFluc:0,gravity:-2e3,distance:3450,disExtra:100}]},e("../components/combat/buffs/InfiniteHeatBuff"),o.getSymbol(),EFFECT.infiniteHeat,ADD_SCALE;var s={ctor:e("../components/combat/buffs/InvincibleBuff"),symbol:o.getSymbol(),effect:EFFECT.invincibleBuff,t:10,item:1},c={ctor:e("../components/combat/buffs/ShotSeqBuff"),symbol:o.getSymbol(),t:9,item:1,noRnd:1,dx:140,waveN:5,waveDT:1,dt:.2,deg:-30,dx0:-950,n:20,blt:[{name:"\u70ae\u5f39",ctor:n,noContact:1,avatar:{ctor:a,frm:"avatar/1",sx:.35,sy:.35,noBlend:!0,streakEffect:EFFECT.bulletStreak},bomb:{r1:70,r0:50,dmg1:200,dmg0:200,kb:300,effect:EFFECT.bombs,weaponType:WEAPON_TYPE[CANNON_GUN]},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:1200,spdFluc:0,gravity:-2e3,distance:3450,disExtra:100}]};window.COMBAT_ITEMS={bomb:{icon:"buff/\u8f70\u70b8",func:function(){var e=this,t=this.game.levelMgr.heroes[1],i=t.addBuff(this,c,{atkScale:t.config.attr&&t.config.attr.tower.atk}),a=t.getGlobal("itemTime");i&&a&&(i.castTimer*=1+a),this.game.effectMgr.instantiate("prefab/effect/buffBannerEffect",function(t,i){i.getComponent("buffBannerEffect").init(e.game,"effect/buff/banner/\u8f68\u9053\u8f70\u70b8"),e.game.layer.addToUI(i)})}},invincible:{icon:"buff/\u62a4\u76fe",func:function(){var e=this;cc.log("COMBAT_ITEMS invincible");var t=this.game.levelMgr.heroes[1],i=t.getGlobal("itemTime"),a=t.addBuff(this,s);for(var n in a&&i&&(a.castTimer*=1+i),t.towers){var o=t.towers[n];if(o){var r=o.addBuff(this,s);r&&i&&(r.castTimer*=1+i)}}this.game.effectMgr.instantiate("prefab/effect/buffBannerEffect",function(t,i){i.getComponent("buffBannerEffect").init(e.game,"effect/buff/banner/\u65e0\u9650\u706b\u529b"),e.game.layer.addToUI(i)})}},atkSpeed:{icon:"buff/\u5c04\u901f",func:function(){var e=this,t=this.game.levelMgr.heroes[1];this.game.levelMgr.createObject(ENTITY.laobing,{x:t.x,y:t.y+200,team:0,ai:1,attr:t.config.attr&&t.config.attr.tower}),this.game.effectMgr.instantiate("prefab/effect/buffBannerEffect",function(t,i){i.getComponent("buffBannerEffect").init(e.game,"effect/buff/banner/\u7cbe\u5175\u652f\u63f4"),e.game.layer.addToUI(i)})}}},window.COMBAT_ITEM_LIST=[],function(){for(var e in COMBAT_ITEMS)COMBAT_ITEMS[e].id=e,COMBAT_ITEM_LIST.push(COMBAT_ITEMS[e])}(),RES.bonus=[{anime:"mob/qiqiu"},"effect/buff/\u968f\u673a"],ENTITY.bonus={id:"bonus",name:"\u589e\u76ca\u9053\u5177",avatar:{ctor:i,animeName:"qiqiu",standAnime:"walk",anime:"mob/qiqiu",s:1,moveSpd:50},fly:1,noDrop:1,deathEffect:EFFECT.keepFlyDeath,radius:20,hitRadius:35,moveSpd:50,weight:50,hp:10,armor:0,machine:1,buffList:[{icon:"effect/buff/\u968f\u673a",attach:"root",item:"invincible"},{icon:"effect/buff/\u968f\u673a",attach:"root",item:"atkSpeed"},{icon:"effect/buff/\u968f\u673a",attach:"root",item:"bomb",func:function(){this.game.layer.joystick.itemBoard.active=!0;var e=this.game.config.mapIndex;if(1==this.game.config.chapterIndex&&3==e&&!this.game.bonusGuided){this.game.bonusGuided=!0;var t=this.game.layer.joystick.itemBtnList[2],i=this;this.game.callFuncDelay(function(){i.game.pushTimeScale(0),TJ.onGuideEvent({guide_id:76,guide_name:"\u9053\u5177"}),menuManager.focusOn(t,"\u5618~\u8f66\u957f\uff0c\u5077\u5077\u544a\u8bc9\u4f60\n\u8fd9\u73a9\u610f\u53ef\u547c\u53eb\u540e\u65b9\u70ae\u706b\u652f\u63f4!",null,function(){i.game.popTimeScale(0),TJ.onGuideEvent({guide_id:77,guide_name:"\u9053\u5177-\u70b9\u51fb"})},null,{head:"h99",dx:-150})},1)}}}],createCb:function(){var e=this.game.config.mapIndex,t=this.game.config.chapterIndex,i=this.define.buffList,a=kit.rndOne(i);1!=t||3!=e||this.game.bonusGuided||(a=i[2]),cc.log("createCb",i,a),this.game.callEffect(EFFECT.bonusIcon,this.avatar,a),this.buffFunc=a.func,this.dropItem=a.item},deathCb:function(){if(this.dropItem){var e=this.dropItem;chapter.data.combatItem[e]++;var t=this.avatar.node.convertToWorldSpaceAR(cc.v2(0,0));t=this.game.layer.camera.getWorldToScreenPoint(t),cc.game.emit("add_item",{pos:t,id:e})}this.buffFunc&&this.buffFunc.call(this),this.buffIcon&&this.buffIcon.runAction(cc.sequence(cc.delayTime(.3),cc.fadeOut(.3)))},pilot:{ctor:e("../components/combat/buffs/AIBuff"),attackRange:600,flyMode:"wave"}},ENTITY.laobing={id:"laobing",name:"\u8001\u5175",avatar:{ctor:r,animeName:"laobing",anime:"mob/laobing",s:.8,moveSpd:70},radius:30,hitRadius:30,moveSpd:70,weight:50,noContact:1,hp:1140,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:200,blt:[{name:"\u654c\u4eba\u673a\u67aa",avatar:{sx:.3,sy:.3,sx1:1,sy1:1,st:.2,frm:"bullet/laobing",noBlend:1,hitEffect:EFFECT.yellowHit},length:30,kb:.02,n:1,wd:0,d:0,spd:1250,spdFluc:.2,distance:600},{name:"\u624b\u69b4\u5f39",ctor:n,noContact:1,avatar:{ctor:a,frm:"bullet/grenade2",sx:.5,sy:.5,noBlend:!0,streakEffect:EFFECT.spinBlt},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,length:20,radius:20,hitRadius:60,n:3,wd:0,d:44,spd:460,spdFluc:0,gravity:-400,distance:13450,disExtra:100}],bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,life:15,attackSequence:[{t:.2,x:40,blt:1},{t:.2,x:40,blt:1},{t:.9,x:40,blt:1},{t:.9,x:40,blt:2,deg:45,ani:0},{t:.2,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:e("../ai/units/AILaobing"),attackRange:2e3,vx:0,vy:-1500,inAnime:"in"}},ENTITY.xuela={id:"xuela",name:"\u96ea\u62c9",avatar:{ctor:r,animeName:"xuela",anime:"operator/xuela",s:.65,fixedScale:1,walkAnime:"run",deathAnime:"dead2",moveSpd:60,dy:-30},radius:27,hitRadius:27,moveSpd:50,noContact:1,hp:9999,armor:1e3,crit:0,bltDmg:200,blt:[{name:"\u96ea\u62c9\u72d9\u51fb",avatar:{sx:.3,sy:.3,sx1:1,sy1:1,st:.2,frm:"bullet/laobing",noBlend:1,hitEffect:EFFECT.yellowHit},length:30,kb:.02,n:1,wd:0,d:0,spd:1250,spdFluc:.2,distance:1200}],bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:.5},{t:.7,x:40,blt:1}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:e("../ai/units/AILaobing"),attackRange:2e3,vx:100,vy:200,followX:-50}},cc._RF.pop()},{"../ai/behaviors/combat/AISoldier":"AISoldier","../ai/units/AILaobing":"AILaobing","../components/combat/buffs/AIBuff":"AIBuff","../components/combat/buffs/Buff":"Buff","../components/combat/buffs/InfiniteHeatBuff":"InfiniteHeatBuff","../components/combat/buffs/InvincibleBuff":"InvincibleBuff","../components/combat/buffs/ShotSeqBuff":"ShotSeqBuff","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/characters/HumanAvatar":"HumanAvatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","./Exploder":"Exploder","./define":"define"}],boss:[function(e,t){"use strict";cc._RF.push(t,"a660a+kDEtO+odGbSbNDCH5","boss"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=e("../entities/projectiles/BallBulletSprite"),n=e("../entities/projectiles/Bomb"),o=(e("../components/visual/Avatar"),e("../entities/vehicles/Vehicle"));BULLET_DEFINE.boss=[{name:"\u70ae\u5f39",ctor:n,avatar:{ctor:a,frm:"bullet/boss/blt",sx:1,sy:1,noBlend:!0,streakEffect:EFFECT.bossBulletStreak},bomb:{r1:100,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,hp:10,length:20,radius:20,n:1,wd:0,d:0,spd:200,spdFluc:0,gravity:-50,distance:3450,disExtra:100}],ENTITY.boss_0f={id:"boss_0f",ctor:o,wheels:[-110,110],name:"\u6697\xb7\u94a2\u94c1\u5e1d\xb7\u94a2\u5c71",avatar:{ctor:i,anime:"mob/gangshan",animeName:"dizuo",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-1},boss:1,fixedFlipX:1,slots:[{x:0,y:80,w:160,h:50,slot:1,sub:1},{x:-60,y:70,w:220,h:20}],deathEffect:EFFECT.bossDeath,height:80,radius:100,hitRadius:100,moveSpd:100,weight:50,hp:30450,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/behaviors/movement/AIChaseCar"),targetDx:750,ax:6}},RES.boss_0f=[{anime:"mob/gangshan"}],ENTITY.boss_1f={id:"boss_1f",name:"\u94a2\u5c711\u697c",avatar:{ctor:i,anime:"mob/gangshan",animeName:"1F",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-2},slot:1,sub:1,fixedFlipX:1,slots:[{x:0,y:22,w:160,h:50,slot:1,sub:1}],deathEffect:EFFECT.machineDeath,height:70,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:6045,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.boss_2f={id:"boss_2f",name:"\u94a2\u5c712\u697c",avatar:{ctor:i,anime:"mob/gangshan",animeName:"2F",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-3},slot:1,sub:1,fixedFlipX:1,slots:[{x:0,y:35,w:160,h:50,slot:1,sub:1},{x:-80,y:-60,w:120,h:20}],deathEffect:EFFECT.machineDeath,height:70,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:4045,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.boss_3f={id:"boss_3f",name:"\u94a2\u5c713\u697c",avatar:{ctor:i,anime:"mob/gangshan",animeName:"3F",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-4},slot:1,sub:1,fixedFlipX:1,slots:[{x:0,y:25,w:160,h:50,slot:1,sub:1},{x:-93,y:-67,w:120,h:20}],deathEffect:EFFECT.machineDeath,height:70,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:2045,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.boss_4f={id:"boss_4f",name:"\u94a2\u5c714\u697c",avatar:{ctor:i,anime:"mob/gangshan",animeName:"4F",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-5},slot:1,sub:1,fixedFlipX:1,deathEffect:EFFECT.machineDeath,height:70,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:1045,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",crit:0,bltDmg:5,blt:BULLET_DEFINE.boss,bltMax:1,bltReload:1.5,attackCenter:cc.v2(138,0),attackSequence:[{t:.25,deg:0,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,deg:20,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,deg:40,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:5,ani:0}],pilot:{ctor:e("../ai/behaviors/combat/AIAlwaysAttack"),targetDx:600,ax:6}},BULLET_DEFINE.submarine=[{name:"\u8718\u86db\u96f7",ctor:n,avatar:{ctor:a,frm:"bullet/water_mine",sx:.5,sy:.5,noBlend:!0,a:cc.v2(.5,.5),streakEffect:EFFECT.grenadeBulletStreak},bomb:{r1:60,r0:50,dmg1:10,dmg0:10,kb:300,effect:EFFECT.bombs},hp:100,kb:.3,jump:6,length:20,radius:20,n:1,wd:0,d:15,spd:1700,spdFluc:.2,gravity:-1500,distance:31450,disExtra:100},{name:"\u8718\u86db\u96f7\u6162",ctor:n,avatar:{ctor:a,frm:"bullet/water_mine",sx:.5,sy:.5,noBlend:!0,a:cc.v2(.5,.5),streakEffect:EFFECT.grenadeBulletStreak},bomb:{r1:60,r0:50,dmg1:10,dmg0:10,kb:300,effect:EFFECT.bombs},hp:70,kb:.3,jump:6,length:20,radius:20,n:1,wd:0,d:20,spd:500,spdFluc:.2,gravity:-200,distance:31450,disExtra:100}],ENTITY.submarine={id:"submarine",name:"\u6f5c\u8247",avatar:{ctor:i,anime:"mob/qiantin",animeName:"qiantin",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-1,flipX:-1,dy:-150,dx:0},boss:1,fixedFlipX:1,out:2e3,machine:1,editor:1,deathEffect:EFFECT.bossDeath,height:80,radius:155,hitRadius:155,moveSpd:100,weight:50,hp:10450,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/behaviors/boss/AISubmarineBoss"),targetDx:800,ax:12},blt:BULLET_DEFINE.submarine,attackSequence:[{t:4},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:88},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:88},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:88},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:88},{t:.25,x:0,oy:30,blt:2,sound:"sound/cannon_fire",deg:75},{t:.25,x:0,oy:30,blt:2,sound:"sound/cannon_fire",deg:70}]},ENTITY.bigship={id:"bigship",name:"\u5927\u8239BOSS",avatar:{ctor:i,anime:"mob/zhanjian",animeName:"zhanjian",moveSpd:100,standAnime:"walk",z:-1,flipX:1},boss:1,fixedFlipX:1,slots:[{x:0,y:0,w:222,h:30,slot:1,sub:1},{x:-200,y:50,w:222,h:30,slot:1,sub:1},{x:-100,y:70,w:222,h:30,slot:1,sub:1},{x:-170,y:130,w:222,h:30,slot:1,sub:1},{x:-60,y:70,w:220,h:20}],machine:1,editor:1,deathEffect:EFFECT.bossDeath,height:80,radius:200,hitRadius:200,moveSpd:500,weight:50,hp:3e4,out:2e3,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/behaviors/boss/AIBigShipBoss"),targetDx:850,ax:12},blt:BULLET_DEFINE.submarine,attackSequence:[{t:5},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:90},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:90},{t:.25,x:0,oy:30,blt:1,sound:"sound/cannon_fire",deg:90}]},ENTITY.bigship_paotai={id:"bigship_paotai",name:"bigship_paotai",avatar:{ctor:i,anime:"mob/zhanjian",animeName:"paotai",moveSpd:100,standAnime:"walk",z:ZORDER.HERO,flipX:1},editor:1,slot:1,sub:1,fixedFlipX:1,deathEffect:EFFECT.machineDeath,height:35,radius:70,hitRadius:70,moveSpd:0,weight:50,hp:7500,out:2e3,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",crit:0,bltDmg:5,blt:BULLET_DEFINE.boss,bltMax:1,bltReload:1.5,attackCenter:cc.v2(138,0),attackSequence:[{t:.25,deg:0,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:5,ani:0}],pilot:{ctor:e("../ai/behaviors/combat/AIAlwaysAttack"),targetDx:600,ax:6}},ENTITY.bigship_tower={id:"bigship_tower",name:"bigship_tower",avatar:{ctor:i,anime:"mob/zhanjian",animeName:"jianqiao",moveSpd:100,standAnime:"walk",z:ZORDER.HERO-5,flipX:1},editor:1,slot:1,sub:1,fixedFlipX:1,slots:[{x:0,y:0,w:160,h:20,slot:1,sub:1}],out:2e3,noBullet:1,deathEffect:EFFECT.machineDeath,height:70,radius:170,hitRadius:170,moveSpd:0,weight:50,hp:16e3,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.turtle_boss={id:"turtle_boss",name:"\u4e4c\u9f9fboss",avatar:{ctor:e("../entities/characters/HumanAvatar"),animeName:"guigui",anime:"mob/guigui",s:1.5,moveSpd:50},editor:1,radius:145,hitRadius:160,moveSpd:10,weight:50,hp:45e3,boss:1,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,armor:1e3,crit:0,bltDmg:5,blt:[{name:"\u86d9\u4eba",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:12,wd:10,d:120,spd:250,spdFluc:.2,distance:600},{name:"\u751f\u5316\u5f39",ctor:n,avatar:{ctor:a,sx:2,sy:2,noBlend:!0,streakEffect:EFFECT.slimeStreak,anime:{repeat:-1,speed:3,atlas:"bullet/slime/shuiqiu"}},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.slimeBomb,exploFunc:function(e){e==BULLET_FADE_TYPE.GROUND&&this.game.levelMgr.createObject(ENTITY.slime,{x:this.x,y:this.y,team:this.obj.team,ai:1,atk0:this.obj.config.atk0,hp0:this.obj.config.hp0})}},kb:.3,hp:110,length:20,radius:20,hitRadius:60,n:1,wd:0,d:15,spd:560,spdFluc:0,gravity:-300,distance:13450,disExtra:100}],bltMax:6,bltReload:.9,deathEffect:EFFECT.bossDeath,z:ZORDER.HERO+1,attackSequence:[{t:1,ani:1},{t:1,x:150,blt:1},{t:1,ani:0}],attackSequence2:[{t:2,ani:0},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100},{t:.2,x:33,y:0,blt:2,ani:1,deg:-100}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:e("../ai/behaviors/boss/AITurtleBoss"),attackRange:900,moveAttack:1}},RES.turtle_boss=[{anime:"mob/guigui"}],BULLET_DEFINE.boss_cyborg=[{name:"\u751f\u5316\u5f39",ctor:n,avatar:{ctor:a,sx:2,sy:2,noBlend:!0,streakEffect:EFFECT.slimeStreak,anime:{repeat:-1,speed:3,atlas:"bullet/slime/shuiqiu"}},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.slimeBomb,exploFunc:function(e){e==BULLET_FADE_TYPE.GROUND&&this.game.levelMgr.createObject(ENTITY.slime,{x:this.x,y:this.y,team:this.obj.team,ai:1,atk0:this.obj.config.atk0,hp0:this.obj.config.hp0})}},kb:.3,hp:110,length:20,radius:20,hitRadius:60,n:1,wd:0,d:15,spd:560,spdFluc:0,gravity:-300,distance:13450,disExtra:100},{name:"\u70ae\u5f39",ctor:n,avatar:{ctor:a,frm:"avatar/1",sx:.4,sy:.4,a:cc.v2(.5,.6),noBlend:!0,streakEffect:EFFECT.tankBulletStreak},bomb:{r1:50,r0:50,dmg1:40,dmg0:40,kb:300,effect:EFFECT.bombs},kb:.3,hp:100,length:20,radius:44,n:5,wd:1,d:33,spd:180,spdFluc:0,gravity:-1,distance:3450,disExtra:100}],ENTITY.boss_cyborg={id:"boss_cyborg",ctor:o,wheels:[-45,45],name:"\u78be\u538b\u8005",avatar:{ctor:e("../entities/characters/HumanAvatar"),gunBone:"gun",gunDeg:0,animeName:"nianyazhe",anime:"mob/nianyazhe",s:1.2,moveSpd:150},attackAngle:[0,100],machine:1,fixedFlipX:1,radius:150,moveSpd:60,hp:7e4,editor:1,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.boss_cyborg,bltMax:1,bltReload:1.5,deathEffect:EFFECT.bossDeath,boss:1,attackCenter:cc.v2(-20,60),attackSequence:[{t:.01,ani:1},{t:.25,x:222,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,deg:-11},{t:.25,x:222,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,deg:-11},{t:.25,x:222,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,deg:-11},{t:2,ani:0}],attackSequence2:[{t:2,ani:1},{t:.5,x:155,y:66,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,deg:0},{t:2,ani:0}],pilot:{ctor:e("../ai/behaviors/boss/AIBossCyborg"),attackRange:760,bonusAttackDeg:75,safeRange:[650,760],moveAttackMinRange:650,moveAttack:1,hitRunTime:200}},RES.boss_cyborg=[{anime:"mob/nianyazhe"}],cc._RF.pop()},{"../ai/behaviors/boss/AIBigShipBoss":"AIBigShipBoss","../ai/behaviors/boss/AIBossCyborg":"AIBossCyborg","../ai/behaviors/boss/AISubmarineBoss":"AISubmarineBoss","../ai/behaviors/boss/AITurtleBoss":"AITurtleBoss","../ai/behaviors/combat/AIAlwaysAttack":"AIAlwaysAttack","../ai/behaviors/movement/AIChaseCar":"AIChaseCar","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/characters/HumanAvatar":"HumanAvatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/vehicles/Vehicle":"Vehicle","./define":"define"}],bottomUI:[function(e,t){"use strict";cc._RF.push(t,"6de8eKh2C5Av6UhxacI3jqT","bottomUI");var i=e("./itemBlock");cc.Class({extends:cc.Component,properties:{equipmentNode:cc.Node,weaponTeamFrame:cc.Node,weaponTeamFrame2:cc.Node,forgeFrame:cc.Node,forgeDisplay:dragonBones.ArmatureDisplay,merchantFrame:cc.Node,historyItemPrefab:cc.Node,bagFrame:cc.Node},init:function(e,t){return this.game=e,this.bagData=chapter.data.bag,cc.warn("bottomUI bagData",chapter.data.bag),this.weaponBlocks=[],this.equipmentBlocks=[],this.materialBlocks=[],this.initBlocks(t,this.materialBlocks,"material"),this.initBlocks(t,this.equipmentBlocks,"equipment"),this.initBlocks(t,this.weaponBlocks,"weapon"),cc.log("bottomUI init equipmentBlocks",this.equipmentBlocks),this.showBlocks("weapon"),this.bagBlocks},initForgeBlocks:function(){var e=this.game,t=[this.forgeFrame.getChildByName("forgeItem1").getComponent("itemBlock"),this.forgeFrame.getChildByName("forgeItem2").getComponent("itemBlock")];for(var i in t){var a=t[i];a.init(e,{blockType:"forge"});var n=e.checkSuitableBlocks;a.setContentGetCb(n.bind(e)),a.setContentClearCb(n.bind(e))}this.forgeBlocks=t,this.game.forgeBlocks=t,this.game.startForgeButton=this.forgeFrame.getChildByName("\u5408\u6210\u6309\u94ae"),this.game.previewForgeNode=this.forgeFrame.getChildByName("forgeTarget")},initVehicleEquipment:function(){},initItemButton:function(){},updateItemButton:function(){},onItemButton:function(){},start:function(){this.scheduleOnce(function(){for(var e in this.bagBlocks);},.01)},showBlocks:function(e){"weapon"==e?(this.node.getChildByName("weaponNode").active=!0,this.node.getChildByName("equipmentNode").active=!1,this.node.getChildByName("materialNode").active=!1,this.bagBlocks=this.weaponBlocks,this.game.bagBlocks=this.weaponBlocks,this.bagFrame.getChildByName("layout").active=!0,this.bagFrame.getChildByName("layout2").active=!1,this.bagFrame.getChildByName("layout3").active=!1):"equipment"==e?(this.node.getChildByName("weaponNode").active=!1,this.node.getChildByName("equipmentNode").active=!0,this.node.getChildByName("materialNode").active=!1,this.bagBlocks=this.equipmentBlocks,this.game.bagBlocks=this.equipmentBlocks,this.bagFrame.getChildByName("layout").active=!1,this.bagFrame.getChildByName("layout2").active=!0,this.bagFrame.getChildByName("layout3").active=!1):(this.node.getChildByName("weaponNode").active=!1,this.node.getChildByName("equipmentNode").active=!1,this.node.getChildByName("materialNode").active=!0,this.bagBlocks=this.materialBlocks,this.game.bagBlocks=this.materialBlocks,this.bagFrame.getChildByName("layout").active=!1,this.bagFrame.getChildByName("layout2").active=!1,this.bagFrame.getChildByName("layout3").active=!0)},showWeaponBlocks:function(){this.showBlocks("weapon")},showEquipmentBlocks:function(){this.showBlocks("equipment")},showMaterialBlocks:function(){this.showBlocks("material")},initBlocks:function(e,t,a){var n;this.bagBlocks=t||[];var o=[];for(var r in this.bagData){var s=this.bagData[r];(h=ItemDefine[s.id]).type==a&&o.push(s)}console.log("bagData",t,o,a);var c=15;for("weapon"==a&&(n=this.bagFrame.getChildByName("layout")),"equipment"==a&&(n=this.bagFrame.getChildByName("layout2")),"material"==a&&(n=this.bagFrame.getChildByName("layout3"),c=20),r=0;r<c;r++)if(u=n.children[r]){var l=u.addComponent(i);e={blockType:"bag",x:0,y:0,tag:11,noTouch:e.noTouch},l.init(this.game,e),l.blockType2=a,this.bagBlocks.push(l);var d=r;if(o[d]){var h;if(console.log(o[d]),s=o[d],(h=ItemDefine[s.id]).type!=a)continue;var u=new cc.Node,p=this.getItemCtor(s.id);u.addComponent(p).init(this.game,h,{block:l,lvl:s.lvl,hp:s.hp});var f=e.checkCB;f&&(this.bagBlocks[d].setContentGetCb(f),this.bagBlocks[d].setContentClearCb(f))}}return this.bagBlocks},getItemCtor:function(t){return console.log(t),ItemDefine[t].ctor||e("./checkPointItem")},getBagItem:function(e){return this.bagBlocks[e]},getBagItemById:function(e){var t=this[ItemDefine[e].type+"Blocks"];for(var i in t){var a=t[i];if(a.content&&a.content.define.id==e)return cc.log("getBagItemById index",i,e),a}},setBagInteractable:function(e,t){var i=t&&this[t+"Blocks"]||this.bagBlocks;for(var a in i)i[a].setInteractable(e)},getWeaponForgeItemById:function(e){for(var t in this.weaponTeamForgeBlocks){var i=this.weaponTeamForgeBlocks[t];if(i.content&&i.content.define.id==e)return cc.log("getBagItemById index",t,e),i}},addBagItem:function(e,t,i,a,n,o){if(a=a,ItemDefine[e]){var r=this[ItemDefine[e].type+"Blocks"];if(!a)for(var s in r)if(!r[s].content){a=r[s];break}if(a){var c=new cc.Node,l=this.getItemCtor(e),d=c.addComponent(l);if(d.init(this.game,ItemDefine[e],{block:a,lvl:t,hp:o}),cc.log("addBagItem",e,t),i){var h=c.parent.convertToNodeSpaceAR(i);c.x=h.x,c.y=h.y,c.scale=0;var u=a.node.convertToWorldSpaceAR(cc.v2(0,0)),p=d.getCenterPos(u.x,u.y);cc.log(i,c.parent,c.x,c.y),c.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,1.2),cc.moveBy(.1,cc.v2(0,0))),cc.scaleTo(.1,1),cc.delayTime(.3),cc.moveTo(.25,cc.v2(p.x,p.y)).easing(cc.easeInOut(2))))}this.game.effectMgr.playEffect("sound/checkpoint/get_item"),cc.game.emit("onItemGet",{itemId:e,lvl:t})}else cc.log("\u80cc\u5305\u5df2\u6ee1")}else cc.log("\u627e\u4e0d\u5230\u5408\u6210\u7684\u76ee\u6807\u7269\u54c1:"+e)},showBagOnly:function(){},initWeaponTeamFrame:function(e,t){var i=t&&this.weaponTeamFrame2||this.weaponTeamFrame,a=cc.instantiate(i);return a.y+=150*e,a.active=!0,this.node.getChildByName("\u6574\u5907").addChild(a),a},enableEquipmentMode:function(e,t){e?(2==t?this.showEquipmentBlocks():this.showWeaponBlocks(),this.node.active||this.initWeaponTeamForgeBlocks()):this.removeWeaponTeamForgeBlocks(),this.equipmentNode.active=e,this.node.active=e},enableForgeMode:function(e){if(this.node.getChildByName("\u8fd4\u56de").active=!1,this.game.forgeModeCancelBtn.active=!1,e)this.node.getChildByName("\u5408\u6210").active=!0,this.showMaterialBlocks();else{this.node.getChildByName("\u5408\u6210").active=!1,this.game.previewForgeNode.active=!1;var t=this.game.forgeBlocks;for(var i in t)t[i].content&&(t[i].content.weaponTeam?t[i].content.remove():this.game.moveToBag(t[i].content))}this.forgeFrame.getChildByName("\u5408\u6210\u6309\u94ae").active=!1,this.node.active=e},enableMerchantMode:function(e){this.node.getChildByName("\u8fd4\u56de").active=e,e&&!this.merchantFrame.inited&&(this.merchantFrame.inited=!0,this.merchantFrame.getComponent("Merchant").init(this.game)),this.game.tabNode.active=!e,this.merchantFrame.active=e,this.node.active=e,this.enableBagBlocksItemCost(this.weaponBlocks,e),this.enableBagBlocksItemCost(this.equipmentBlocks,e),this.enableBagBlocksItemCost(this.materialBlocks,e)},enableBagBlocksItemCost:function(e,t){for(var i in e)e[i].content&&e[i].content.enableCost(t)},getOperatorIdByIndex:function(e){var t,i;if(cc.log("bottomUI getOperatorIdByIndex index",e),this.game.tankBlocks[e]&&this.game.tankBlocks[e].content?t=this.game.tankBlocks[e].content.operator:(e=+e+1,t=this.game.tank["man"+e]&&this.game.tank["man"+e].active&&this.game.tank["man"+e].operator),!t){var a=e-chapter.data.stack;t=this.game.tank["cman"+a]&&this.game.tank["cman"+a].active&&this.game.tank["cman"+a].operator,i=!0}return cc.log("bottomUI getOperatorIdByIndex id",t),{id:t,operatorOnly:i}},initWeaponTeamForgeBlocks:function(){var e=this,t=this.node||this.weaponTeamForgeBlockNode;this.game.weaponTeamForgeBlocks=[],this.weaponTeamForgeFrame=[],this.operatorItemBlock=[];for(var a=this.game,n=function(){if(r=e.getOperatorIdByIndex(o),s=r&&r.id,c=r&&r.operatorOnly,!s)return"continue";var n=e.initWeaponTeamFrame(o,c);if(e.weaponTeamForgeFrame.push(n),cc.log("initWeaponTeamForgeBlocks operatorId",s),l=n.getChildByName("operator").getComponent("itemBlock"),n.operatorBlock=l,l.index=o,e.game.addCheckBlock(l),e.operatorItemBlock.push(l),l.init(e.game,{blockType:"operator"}),(new cc.Node).addComponent("checkpointOperator").init(e.game,{type:"operator"},{operatorId:s,block:l}),d=e,h=function(){if(this.content){var e=d.game.effectMgr.createAnimation("checkpoint/equipment/bianzushuaxin",{repeat:1,speed:3});n.addChild(e),e.scale=ANIME_SCALE}},l.setContentGetCb(h.bind(l)),m=new cc.Node,t=n.getChildByName("weapon"))for(t.addChild(m),(g=m.addComponent(i)).index=o,g.weaponTeamForgeType="weapon",v={blockType:"weaponTeamForge",x:0,y:0},g.init(a,v),n.weaponBlock=g,g.frame=n,e.game.weaponTeamForgeBlocks.push(g),d=e,h=function(){if(this.content){var e=d.game.effectMgr.createAnimation("checkpoint/equipment/bianzushuaxin",{repeat:1,speed:3});n.addChild(e),e.scale=ANIME_SCALE}},(u=a.tankBlocks[o]&&a.tankBlocks[o].content)&&(a.addItem(g,{id:u.weapon,weaponTeam:u,lvl:u.weaponLvl,hp:u.hp}),u.hp<=0&&((p=e.game.effectMgr.createSprite(0,0,"checkpoint/equipment/need_fix")).scale=.85,g.node.addChild(p),u.block.needFix=p,g.interactable=!1)),g.setContentGetCb(h.bind(g)),g.x+=230,f=0;f<3;f++)m=new cc.Node,(t=n.getChildByName("e"+f)).addChild(m),(g=m.addComponent(i)).index=o,g.weaponTeamForgeType="equipment",g.frame=n,v={blockType:"weaponTeamForge",x:0,y:0},g.init(a,v),n["equipmentBlock"+f]=g,e.game.weaponTeamForgeBlocks.push(g),(y=u&&u.equipment[f]||chapter.data.bank[o]&&chapter.data.bank[o][f])&&a.addItem(g,{id:y,weaponTeam:u}),g.x+=230+150*(f+1),g.setContentGetCb(h.bind(g))},o=0;o<4;o++){var r,s,c,l,d,h,u,p,f,m,g,v,y;n()}this.game.updateBagUIOperator()},removeWeaponTeamForgeBlocks:function(){var e=this.game;if(this.operatorItemBlock)for(var t in this.operatorItemBlock)this.game.removeCheckBlock(this.operatorItemBlock[t]);if(e.weaponTeamForgeBlocks){for(var t in e.weaponTeamForgeBlocks)e.weaponTeamForgeBlocks[t].content&&e.weaponTeamForgeBlocks[t].content.remove(),e.weaponTeamForgeBlocks[t].node.destroy();for(var t in e.weaponTeamForgeBlocks=null,this.weaponTeamForgeFrame)this.weaponTeamForgeFrame[t].destroy();this.weaponTeamForgeFrame=null}},playForgeAnimation:function(e,t){var i=this,a=this.forgeDisplay.node.children[0].getComponent(dragonBones.ArmatureDisplay);cc.log(a,a.armature());var n=a.playAnimation("walk");for(var o in n.timeScale=4,a.scheduleOnce(function(){i.forgeDisplay.playAnimation("mix",1).timeScale=1.7,a.armature().animation.stop("")},.5),a.scheduleOnce(function(){i.isPlayingForgeAnimation=!1,t&&t(),i.forgeDisplay.scheduleOnce(function(){var e=i.forgeDisplay.playAnimation("open",1);a.playAnimation("stand"),e.timeScale=1.5},.5),i.forgeDisplay.scheduleOnce(function(){this.playAnimation("stand")},1),i.game.setUITouchable(!0)},1),this.forgeBlocks){var r=this.forgeBlocks[o].content;if(r){var s=r.node.convertToWorldSpaceAR(cc.v2(0,0)),c=this.game.uiNode.convertToNodeSpaceAR(s);r.node.x=c.x,r.node.y=c.y,r.node.parent=this.game.uiNode;var l=260-155*o;r.node.runAction(cc.sequence(cc.moveBy(l/800,cc.v2(l,0)),cc.fadeOut(.1)))}this.forgeBlocks[o].node.opacity=0,this.forgeBlocks[o].node.runAction(cc.sequence(cc.delayTime(1),cc.fadeIn(.01)))}},upgradeItem:function(e,t){var i=[];if(i.push(e.content),i.push(t),cc.log("try to forge 2 items lvl",i[0].lvl,i[1].lvl),i[0].define.id==i[1].define.id&&"weapon"==i[0].define.type&&"weapon"==i[1].define.type&&i[0].lvl==i[1].lvl){if(5==i[0].lvl)return;(function(){if(i[0].remove(),i[1].remove(),i[0].weaponTeam||i[1].weaponTeam){var t;t=i[0].weaponTeam?i[0].weaponTeam:i[1].weaponTeam;var a=Math.min(i[0].hp,i[1].hp);t.setHp(a),t.weaponLvl++,t.hpBar&&t.hpBar.setLevel(t.weaponLvl),t.updateHpMax(!0),t.resetAvatarState(),cc.log("weaponTeam upgrade",t.weaponLvl);var n=e,o=e.node;this.game.addItem(n,{hp:a,id:t.weapon,weaponTeam:t,lvl:t.weaponLvl},o.convertToWorldSpaceAR(cc.v2(0,0)),function(){cc.game.emit("forgeItemFinish")})}else o=e.node,a=Math.min(i[0].hp,i[1].hp),this.game.addBagItem(i[0].define.id,i[0].lvl+1,o.convertToWorldSpaceAR(cc.v2(0,0)),e,a);task.addDailyTaskCt("weaponUpgrade"),i[0].define.id}).bind(this)();var a=this.game.effectMgr.createAnimation("checkpoint/equipment/hecheng",{speed:1,repeat:1});return e.node.addChild(a),a.scale=ANIME_SCALE,!0}if(i[0].define.id==i[1].define.id&&"equipment"==i[0].define.type&&"equipment"==i[1].define.type&&i[0].lvl==i[1].lvl){var n=i[0].define.id.substr(-1,1),o=+(n=i[0].define.id.length>2&&n||"1")+1,r=i[0].define.id.substr(0,2)+o;return ItemDefine[r]?(function(){i[0].remove(),i[1].remove();var t=i[0].define.id;if(i[0].weaponTeam||i[1].weaponTeam){var a=e,n=i[0].weaponTeam||i[1].weaponTeam,o=e.node;for(var s in this.game.addItem(a,{id:r,weaponTeam:n},o.convertToWorldSpaceAR(cc.v2(0,0)),function(){cc.game.emit("forgeItemFinish")}),n.equipment)if(n.equipment[s]==t){n.equipment[s]=r,n.updateEquipmentIcon(!0);break}}else{if(o=e.node,"weaponTeamForge"==e.blockType)for(var s in chapter.data.bank[e.index]){var c=chapter.data.bank[e.index];if(c[s]==t){c[s]=r;break}}this.game.addBagItem(r,null,o.convertToWorldSpaceAR(cc.v2(0,0)),e)}task.addDailyTaskCt("partForge")}.bind(this)(),a=this.game.effectMgr.createAnimation("checkpoint/equipment/hecheng",{speed:1,repeat:1}),e.node.addChild(a),a.scale=ANIME_SCALE,!0):void cc.log("\u627e\u4e0d\u5230\u8be5\u914d\u4ef6id\u7684\u5b9a\u4e49\uff0c\u5408\u6210\u53d6\u6d88",r)}},forgeItem:function(){var e=this.forgeItemList;if(!e)for(var t in e=[],this.game.forgeBlocks){var i=this.game.forgeBlocks[t].content;i&&e.push(i)}if(!(e.length<2)){var a=[e[0].define.id,e[1].define.id],n=this.game,o=this,r=n.findForgeFormula(a);if(r){var s=function(){var t=r[r.length-1],i=n.forgeDisplay.node;if(e[0].weaponTeam||e[1].weaponTeam){var a,s;a=e[0].weaponTeam?(s=e[0]).weaponTeam:(s=e[1]).weaponTeam;var c=n.getEmptyWeaponTeamForgeBlock();for(var l in n.addItem(c,{id:t,weaponTeam:e[0].weaponTeam||e[1].weaponTeam},i.convertToWorldSpaceAR(cc.v2(200,230))),a.equipment)if(a.equipment[l]==s.define.id){a.equipment[l]=t,a.updateEquipmentIcon(!0);break}}else n.addBagItem(t,null,i.convertToWorldSpaceAR(cc.v2(200,230))),(d=ItemDefine[t])&&("weapon"==d.type?task.addDailyTaskCt("weaponUpgrade"):"equipment"==d.type&&task.addDailyTaskCt("partForge"));cc.log("\u5408\u6210\u6210\u529f\uff0c\u83b7\u5f97\uff1a"+t),chapter.addFormula(e[0].define.id,e[1].define.id,1),e[0].remove(),e[1].remove(),n.forgeSuccessMsg(t),o.pushHistoryItem(t),o.forgeItemList=null,n.previewForgeNode.active=!1;var d=ItemDefine[t];chapter.data.reddot[d.type]++,n.updateReddot()};return this.game.startForgeButton.active=!1,void this.playForgeAnimation(e,s.bind(this))}return s=function(){var t;if(n.forgeDisplay.node,chapter.addFormula(e[0].define.id,e[1].define.id,-1),cc.log("\u5408\u6210\u5931\u8d25\uff0c\u6ca1\u6709\u5bf9\u5e94\u914d\u65b9"),e[0].weaponTeam||e[1].weaponTeam){var i=(e[0].weaponTeam&&e[0]||e[1]).define.id,a=e[0].weaponTeam||e[1].weaponTeam;a.removeEquipmentById(i),t=e[1].weaponTeam?1:0}e[0].remove(),e[1].remove(),menuManager.pop("forge_fail",{game:n,items:[e[0].define.id,e[1].define.id],fromWeaponTeam:{index:t,weaponTeam:a}}),n.previewForgeNode.active=!1},this.game.startForgeButton.active=!1,this.playForgeAnimation(e,s.bind(this)),void cc.log("\u65e0\u6cd5\u627e\u5230\u5408\u9002\u914d\u65b9")}},quickUpgradeItems:function(){if(this.game.setUITouchable(!1),this.bagBlocks==this.weaponBlocks){for(var e in this.game.weaponTeamForgeBlocks)if((i=this.game.weaponTeamForgeBlocks[e]).content&&"weapon"==i.content.define.type){if(this.game.tankBlocks[i.index].content&&1!=this.game.tankBlocks[i.index].content.hp)continue;for(var t in this.weaponBlocks)if((a=this.weaponBlocks[t]).content&&a.content!=i.content&&a.content.define.id==i.content.define.id&&a.content.lvl==i.content.lvl&&this.upgradeItem(i,a.content))return void this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.quickUpgradeItems()},this)))}for(var e in this.weaponBlocks)if((i=this.weaponBlocks[e]).content&&"weapon"==i.content.define.type)for(var t in this.weaponBlocks)if((a=this.weaponBlocks[t]).content&&a.content!=i.content&&a.content.define.id==i.content.define.id&&a.content.lvl==i.content.lvl&&this.upgradeItem(i,a.content))return void this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.quickUpgradeItems()},this)))}else if(this.bagBlocks==this.equipmentBlocks){for(var e in this.game.weaponTeamForgeBlocks)if((i=this.game.weaponTeamForgeBlocks[e]).content&&"equipment"==i.content.define.type)for(var t in this.equipmentBlocks)if((a=this.equipmentBlocks[t]).content&&a.content!=i.content&&a.content.define.id==i.content.define.id&&this.upgradeItem(i,a.content))return void this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.quickUpgradeItems()},this)));for(var e in this.equipmentBlocks){var i;if((i=this.equipmentBlocks[e]).content&&"equipment"==i.content.define.type)for(var t in this.equipmentBlocks){var a;if((a=this.equipmentBlocks[t]).content&&a.content!=i.content&&a.content.define.id==i.content.define.id&&this.upgradeItem(i,a.content))return void this.node.runAction(cc.sequence(cc.delayTime(.2),cc.callFunc(function(){this.quickUpgradeItems()},this)))}}}this.game.setUITouchable(!0)},pushHistoryItem:function(e){var t=ItemDefine[e],i=this.forgeFrame.getChildByName("history").getChildByName("layout"),a=cc.instantiate(this.historyItemPrefab);a.active=!0,a.addComponent("checkpointAvatar").init(t,t.lvl,this.game),i.addChild(a),i.children.length>4&&i.children[0].destroy(),a.define=t},checkHistoryItemInfo:function(e){var t=this,i=e.target.define;i&&cc.resources.load("checkpoint/itemInfoBox",cc.Prefab,function(e,a){var n=cc.instantiate(a),o=n.getComponent("itemInfoBox"),r=i;o.init(t.game,r,r.lvl||1),n.x=0,n.y=0,t.game.node.addChild(n,1e3)})},forgeHistoryItem:function(e){var t,i,a,n=e.target.define;for(var o in window.EquipmentForgeFormulaDefine){var r=window.EquipmentForgeFormulaDefine[o];if(r[2]==n.id){t=r;break}}var s=t[0],c=t[1];for(var o in this.materialBlocks){var l=this.materialBlocks[o];if(l.content&&(l.content.define.id==s&&(i=l.content),l.content.define.id==c&&(a=l.content)),i&&a)return this.forgeItemList=[i,a],void this.forgeItem()}kit.info("\u7f3a\u5c11\u7d20\u6750")},getMoney:function(e){e.target.opacity<255||(chapter.add(GOLD,50,"bottom"),cc.game.emit("add_drop",{tid:"bottom",i:GOLD,n:50}),e.target.opacity=100)}}),cc._RF.pop()},{"./checkPointItem":"checkPointItem","./itemBlock":"itemBlock"}],buffBannerEffect:[function(e,t){"use strict";cc._RF.push(t,"d2791h5RilNE4rnxBSkLCpB","buffBannerEffect"),cc.Class({extends:cc.Component,properties:{content:cc.Sprite},init:function(e,t){var i=this.content;e.effectMgr.loadSprite(i,t)}}),cc._RF.pop()},{}],cannon:[function(e,t){"use strict";cc._RF.push(t,"21e88jScGZEvqgKl7nJGr6W","cannon"),e("./define");var i=e("../entities/environment/MyTower"),a=e("../entities/projectiles/Bomb"),n=(e("../entities/projectiles/MissileSprite"),e("../entities/projectiles/BallBulletSprite")),o=e("../ai/units/AIMyTower");BULLET_DEFINE[CANNON_GUN]=[{name:"\u70ae\u5f39",ctor:a,noContact:1,avatar:{ctor:n,frm:"avatar/1",sx:.6,sy:.6,noBlend:!0,streakEffect:EFFECT.bulletStreak},bomb:{r1:120,r0:120,dmg1:150,dmg0:150,kb:300,effect:EFFECT.bombs,weaponType:WEAPON_TYPE.building},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:2200,spdFluc:0,gravity:-500,distance:3450,disExtra:100},{name:"\u70ae\u5f39",ctor:a,noContact:1,avatar:{ctor:n,frm:"avatar/1",sx:.35,sy:.35,noBlend:!0,streakEffect:EFFECT.bulletStreak},bomb:{r1:90,r0:50,dmg1:150,dmg0:150,kb:300,effect:EFFECT.bombs,weaponType:WEAPON_TYPE.building},kb:.3,length:20,radius:20,n:1,wd:0,d:3,spd:2200,spdFluc:0,gravity:-500,distance:3450,disExtra:100}],ENTITY[CANNON_GUN]={id:CANNON_GUN,hero:!0,category:"cannon",name:"\u5927\u70ae",avatar:{gunBone:"gun",animeName:"dapao",anime:"weapon/dapao",s:1.1,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:80,bombDmg:80,blt:BULLET_DEFINE[CANNON_GUN],bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackSequence:[{t:1.6,x:50*1.1*1.1/7,y:11/7,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3}],attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},RES[CANNON_GUN]=[{anime:"weapon/dapao"},"avatar/1","sound/cannon_fire"],ENTITY[CANNON_GUN+"_2"]={id:CANNON_GUN+"_2",hero:!0,category:"cannon",name:"\u5927\u70ae2",avatar:{gunBone:"gun",animeName:"dapao2",anime:"weapon/dapao",s:1.1,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:120,bombDmg:120,blt:BULLET_DEFINE[CANNON_GUN],bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackSequence:[{t:1.6,x:50*1.1*1.1/7,y:11/7,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3}],attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},ENTITY[CANNON_GUN+"_3"]={id:CANNON_GUN+"_3",hero:!0,category:"cannon",name:"\u5927\u70ae3",avatar:{gunBone:"gun",animeName:"dapao3",anime:"weapon/dapao",s:1.1,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:180,bombDmg:180,blt:BULLET_DEFINE[CANNON_GUN],bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackSequence:[{t:1.6,x:50*1.1*1.1/7,y:11/7,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3}],attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},ENTITY[CANNON_GUN+"_4"]={id:CANNON_GUN+"_4",hero:!0,category:"cannon",name:"\u5927\u70ae4",avatar:{gunBone:"gun",animeName:"dapao4",anime:"weapon/dapao",s:1.1,moveSpd:150,reloadAnime:"reload"},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,bltDmg:270,bombDmg:270,blt:BULLET_DEFINE[CANNON_GUN],bltMax:1,bltReload:1.5,heatDown:-10,heatUpOnShot:7.5,heatMin:85,attackCenter:cc.v2(20,40),attackSequence:[{t:2,x:50*1.1*1.1/7,y:11/7,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight,volume:.3}],attackAngle:[-40,80],heat:{attr:{},attackSequence:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.8,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}],attackSequence4:[{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.3,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:1.5,x:50,y:10,blt:2,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.1,ani:0}]},overHeat:{attr:{atkSpd:.6}},pilot:{ctor:o,attackRange:550,seekRange:700,spd:2200,gravity:-500}},cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/MissileSprite":"MissileSprite","./define":"define"}],chapter:[function(e,t){"use strict";cc._RF.push(t,"3ab41bLo75Ncrs7Uycjh5eG","chapter");var i=e("../../Plugins/firebase/FirebaseTracking"),a=e("../utils/ConsecutiveHPManager"),n={events:[],tank:[{weapon:"machine_gun",weaponLvl:1,operator:"h2"}],bench:["h3","h4","h1"],bank:[[],[],[],[]],bag:[],mainOperator:"h2",stack:1,gold:0,exp:0,silver:0,expScale:1,lvl:1,combatItem:{invincible:0,atkSpeed:0,bomb:0},merchantShowChance:0,reddot:{weapon:0,equipment:0,material:0},reviveCt:0,buyPrice:1,repairPrice:1,trainItemBuy:{},talent:[],drawBlockBonus:0,drawBlockBonusAD:0,getBlockAdCt:3,videoCt:0,changeTalentOptionsCt:10,selectAllTalents:3,baseExp:0};window.chapter={init:function(){console.log("[chapter]","[init]",n),chapter.data=JSON.parse(JSON.stringify(n))},load:function(){chapter.formula=privacy.decodeToJson("formula_data")||{},chapter.saveData=chapter.loadSaveData("chapter_data")},loadSaveData:function(e){console.log("========= loadSaveData");var t=privacy.decodeToJson(e);if(t&&2===t.version)return t},addFormula:function(e,t,i){chapter.setFormula(e+"-"+t,i),chapter.setFormula(t+"-"+e,i)},setFormula:function(e,t){chapter.formula[e]!=t&&(chapter.formula[e]=t,privacy.encodeFromJson("formula_data",chapter.formula))},remove:function(){chapter.saveData=null,privacy.remove("chapter_data")},save:function(e,t,i,a,n){var o={version:2,vehicleConfig:e,seed:t,chapterIndex:i,mapIndex:a,isCheckPoint:n,data:chapter.data};cc.log("[chapter]","chapter_data save",JSON.stringify(o)),privacy.encodeFromJson("chapter_data",o)},canRecall:function(e){var t=chapter.saveData;if(t)return void 0===e||t.chapterIndex==e},continue:function(){console.log("[chapter]","continue 0000000"),i.FirebaseTracking.isContinue=!0;var t=chapter.saveData;if(chapter.data=t.data,console.log("[chapter]","saveData",t),adventure.set(t.seed,t.chapterIndex,t.mapIndex),t.isCheckPoint)console.log("[chapter]","continue 11111111"),menuManager.run("backpack",{adventure:1,backpack:chapter.data.backpack,vehicleConfig:t.vehicleConfig,mapIndex:t.mapIndex,mapLength:adventure.mapList.length,chapterIndex:t.chapterIndex,nextCb:function(e){adventure.run(e)}});else{console.log("[chapter]","continue 22222222",t.vehicleConfig);var n=e("../utils/DrawRulesManager");console.log("[chapter] Initializing DrawRulesManager with vehicleConfig:",t.vehicleConfig),n.initializeRules({chapterIndex:t.chapterIndex,mapIndex:t.mapIndex,vehicleConfig:t.vehicleConfig}),a.initialize(),console.log("[chapter] Initialized ConsecutiveHPManager for continued game"),adventure.run(t.vehicleConfig)}},recall:function(){if(chapter.saveData)return menuManager.pop("check",{noWait:!0,title:LI("chapter_continue_title"),info:LI("chapter_continue_msg"),checkCb:function(e){e?chapter.continue():chapter.remove()}}),!0},get:function(e){return chapter.data[e]||0},set:function(e,t){chapter.data[e]=t},add:function(e,t){void 0===t&&(t=1),chapter.data[e]+=t,"videoCt"==e&&cc.log("videoCt",chapter.data[e]),e==GOLD&&t<0&&task.addDailyTaskCt("goldCost",-t)},reset:function(){chapter.data=JSON.parse(JSON.stringify(n)),console.log("[chapter]",chapter.data,n)},addExp:function(e){var t,i;i=null==(t=LVL_EXP_DEFINE[this.data.lvl])?void 0:t.exp,cc.log("chapter addExp",e,this.data.exp,i,this.data.lvl),i&&(this.data.exp+=e*(this.data.expScale||1))},checkLvlUp:function(){var e,t;if(t=null==(e=LVL_EXP_DEFINE[this.data.lvl])?void 0:e.exp,this.data.exp>=t)return this.data.exp-=t,this.data.lvl++,this.data.lvl}},window.LVL_EXP_DEFINE={1:{exp:100},2:{exp:100},3:{exp:117},4:{exp:167},5:{exp:167},6:{exp:177},7:{exp:177},8:{exp:177},9:{exp:177},10:{exp:187},11:{exp:187},12:{exp:187},13:{exp:187},14:{exp:197},15:{exp:197},16:{exp:197},17:{exp:197},18:{exp:207},19:{exp:207},20:{exp:207},21:{exp:207},22:{exp:217},23:{exp:217},24:{exp:217},25:{exp:217},26:{exp:227},27:{exp:227},28:{exp:227},29:{exp:227},30:{exp:237}},cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../utils/ConsecutiveHPManager":"ConsecutiveHPManager","../utils/DrawRulesManager":"DrawRulesManager"}],checkPointItem:[function(e,t){"use strict";cc._RF.push(t,"d5b98xhb0BL7IhWl5xgEZjN","checkPointItem"),window.RarityTextColor={0:cc.color(244,244,244),1:cc.color(244,244,244),2:cc.color(54,200,49),3:cc.color(79,138,248),4:cc.color(176,122,237),5:cc.color(233,214,78)},cc.Class({extends:cc.Component,properties:{},init:function(e,t,i){this.game=e,this.define=t,this.config=i,this.scale=1,this.width=100,this.height=100,this.lvl=i.lvl||t.lvl||1,this.initAvatar(),this.setBlock(i.block),e.merchantMode&&this.enableCost(!0)},initBase:function(){this.base&&this.base.destroy(),this.title&&this.title.destroy();var e=this.lvl,t="weapon"==this.define.type&&"w"+e||"equipment"==this.define.type&&"e"+e||"g"+e;console.log("initBase",t);var i=this.game.effectMgr.createSprite(0,0,"checkpoint/item/"+t);this.node.addChild(i,-1),this.base=i;var a=this.game.effectMgr.createSimpleLabel(0,-58,this.define.name,17);a.label.enableBold=!0,this.node.addChild(a),cc.log("checkpointItem id lvl",this.define.id,e),a.color=RarityTextColor[e];var n=a.addComponent(cc.LabelOutline);n.width=3,n.color=cc.color(0,0,0),this.title=a},enableCost:function(e){if(!this.costLabel){var t;if("weapon"==this.define.type)t=(1==(i=this.lvl)?50:2==i&&100)||3==i&&200||4==i&&400||5==i&&800,t/=3;else if("equipment"==this.define.type)t=(1==(i=this.lvl)?20:2==i&&40)||3==i&&80||4==i&&160||5==i&&320,t/=3;else if("material"==this.define.type){var i;t=(1==(i=this.lvl)?15:2==i&&20)||3==i&&40||80,t/=3}var a=this.game.effectMgr.createSimpleLabel(10,-15,Math.floor(t),20);a.label.enableBold=!0,this.node.addChild(a);var n=a.addComponent(cc.LabelOutline);n.width=3,n.color=cc.color(0,0,0),this.costLabel=a;var o=this.game.effectMgr.createSprite(-20,15,"avatar/block/gold");o.scale=.5,o.anchorX=1,a.addChild(o)}this.costLabel.active=e},initAvatar:function(){this.avatar&&this.avatar.destroy();var e=ItemTypeDefine[this.define.type],t=this.define.avatar,i=.8*(this.define.avatar.scale||e&&e.scale||1);if(t.sprite)a=this.game.effectMgr.createSprite(0,0,t.sprite),this.node.addChild(a),this.avatar=a;else if(t.anime){var a=menuManager.createArmature(t.anime,t.animeName,function(){});this.node.addChild(a),this.avatar=a,i*=ANIME_SCALE}if(this.avatar.scale=i,cc.log("initAvatar define type",this.define.type,this.define.avatar.anchorY),e&&null!=e.anchorY){var n=e.anchorY;this.avatar.y+=(-.5+n)*this.height}else null!=this.define.avatar.anchorY&&(n=this.define.avatar.anchorY,this.avatar.y+=(-.5+n)*this.height);this.initBase()},setOpacity:function(e){this.avatar.opacity=e,this.base&&(this.base.opacity=e),this.title&&(this.title.opacity=e)},setBlock:function(e,t){var i=this.block;!t&&i&&(i.content=null),e.content=this,this.block=e,this.node.parent=e.node,this.block.onContentGet(),!t&&i&&i.onContentClear(),e.resetContentPos()},onInteract:function(e){if(ItemBlockDefine[e.blockType]&&ItemBlockDefine[e.blockType].adapt){var t=!1,i=ItemBlockDefine[e.blockType].adapt;for(var a in i)if(i[a]==this.define.type){t=!0;break}if(!t)return"cancel"}return e&&e.content?"swap":"move"},getCenterPos:function(e,t){return this.node.parent.convertToNodeSpaceAR(cc.v2(e,t))},getPosInBlock:function(e,t){var i=this.block.blockType,a=ItemTypeDefine[this.define.type],n=this.node.parent.convertToNodeSpaceAR(cc.v2(e,t)),o=a&&(a[i]&&a[i].dx||a.dx)||0;return n.x+=o,n},remove:function(){this.block.clearContent(),this.node.destroy()},onSwapt:function(){return!0},onSwapt2:function(){return!0},onForged:function(){}}),cc._RF.pop()},{}],checkPointMenu:[function(e,t){"use strict";cc._RF.push(t,"908e5CE+EpN8o906UuZ4ooV","checkPointMenu");var i=e("../../Plugins/firebase/FirebaseTracking"),a=e("./itemBlock"),n=e("./weaponTeam"),o=e("./checkPointItem");e("./checkpointWeapon"),e("./checkpointEquipment"),cc.Class({extends:e("../ui/core/Menu"),properties:{transFrame:cc.SpriteFrame,forgeUI:cc.Node,forgeBlocksUI:cc.Node,forgeBlocksUIBlack:cc.Node,forgeModeCancelBtn:cc.Node,weaponTeamForgeBlockNode:cc.Node,startForgeButton:cc.Node,previewForgeNode:cc.Node,startGameButton:cc.Node,switchForgeButton:cc.Node,forgeBlocks:[a],weaponPrefab:cc.Prefab,tank:cc.Node,weaponTeamInfo:cc.Node,gameCamera:cc.Node,bg:e("./Background"),bg2:cc.Node,startGameNode:cc.Node,uiNode:cc.Node,forgeDisplay:dragonBones.ArmatureDisplay,bagUI:cc.Node,towerBarPrefab:cc.Prefab,vehicleBarPrefab:cc.Prefab,vehicleFixNodes:[cc.Node],nodesToHideOnForge:[cc.Node],merchantNode:cc.Node,dajiazi:dragonBones.ArmatureDisplay,tankRepairBtn:cc.Node,merchantBtnNode:cc.Node,repairMenuNode:cc.Node,repairUIBlack:cc.Node,repairAll:cc.Node,battleBottomUI:cc.Node,tabNode:cc.Node,tabList:[cc.Node],noTopBar:!0,progressLabel:cc.Label,trainMerchantFrame:cc.Node,joystick:cc.Node},onLoad:function(){},isAdOpened:function(){return pc.stageIndex>4&&!this.args.train&&"tt"!=CH},initChapterProgress:function(){this.progressLabel.string=this.args.mapIndex+"/"+this.args.mapLength},initStatus:function(t){var i,a;this.args=t;var n=cc.find("ui/battle_bottom/money_bar",this.node).getComponent("MoneyBar");for(var o in n&&(t.train?n.init({visible:(i={},i[SILVER]=1,i)}):n.init({visible:(a={},a[GOLD]=1,a[EXP]=1,a)})),this.initBg(),this.initChapterProgress(),this.checkGuideDataSafe(t),console.log("checkpointMenu init",t,JSON.stringify(chapter.data)),this.args.vehicleConfig.towers)if(this.args.vehicleConfig.towers[o].m){chapter.data.mainOperator=chapter.data.tank[o].operator;break}var r=e("../managers/EffectManager");for(var o in this.effectMgr=new r,this.battleBottomUI.getComponent("battleBottomUI").init(this,{isCheckPoint:!0}),this.checkOperatorAlive(),this.operatorList=[],this.idleOperator=chapter.data.bench,this.mainOperator=chapter.data.mainOperator,this.tankData=chapter.data.tank,this.tankData)this.tankData[o]&&this.operatorList.push(this.tankData[o].operator);for(var o in this.idleOperator)this.operatorList.push(this.idleOperator[o]);this.bagData=chapter.data.bag,this.initMode(t),this.initTank(),this.floatAdNode.parent.active=this.isAdOpened(),pc.stageIndex>3&&sdk.showInsert("cp")},initMode:function(e){if(this.mode=e.train&&"train","train"==this.mode){o=this,cc.resources.load("theme/bg_checkpoint",cc.Prefab,function(e,t){var i=cc.instantiate(t);i.getComponent("Background").init(o),o.bg2.addChild(i),i.y=60}),this.nodesToHideOnForge[0].active=!1,this.startGameButton.active=!1,this.forgeDisplay.node.active=!1,this.setTrainModeVehicleFix();var t=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("label").getChildByName("\u4fee\u7406"),i=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("label").getChildByName("\u6b66\u5668"),a=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("label").getChildByName("\u914d\u4ef6"),n=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("label").getChildByName("\u5408\u6210");a.x=i.x,i.x=t.x,t.active=!1,n.active=!1}else{var o=this;cc.resources.load("theme/bg_checkpoint_2",cc.Prefab,function(e,t){var i=cc.instantiate(t);i.getComponent("Background").init(o),o.bg2.addChild(i),i.y=60})}},afterLoad:function(){this.initBagBlocks(),this.initTankBlocks(),this.initForgeBlocks(),this.initForgeList(),this.toCheckBlocks=[],this.maxStack=4,this.checkGuide(),this.updateReddot(),this.checkMerchantShow(),this.enableStartGameButton(!1),this.tankLoaded=!0},initBg:function(){this.camera=this.gameCamera.getComponent(cc.Camera),this.bg.init(this),this.camera.node.x=.85*(this.tank.x-1e3)+200,this.node.getChildByName("transition_go").getComponent("Transition").transitionOut(this)},initBattleBottomUI:function(){var e=[];for(var t in this.tankBlocks)this.tankBlocks[t].content?e.push(this.tankBlocks[t].content):e.push(null);this.battleBottomUI.getComponent("battleBottomUI").setVehicle(this.tankHpBarObj,!0),this.battleBottomUI.getComponent("battleBottomUI").refreshHp()},getOperatorIdByIndex:function(e){var t;if(cc.log("bottomUI getOperatorIdByIndex index",e),this.tankBlocks[e]&&this.tankBlocks[e].content?t=this.tankBlocks[e].content.operator:(e=+e+1,t=this.tank["man"+e]&&this.tank["man"+e].active&&this.tank["man"+e].operator),!t){var i=e-chapter.data.stack;t=this.tank["cman"+i]&&this.tank["cman"+i].active&&this.tank["cman"+i].operator}return cc.log("bottomUI getOperatorIdByIndex id",t),t},checkGuideDataSafe:function(e){if(!e.train){var t=this.getChapterIndex(),i=this.getLevelIndex();if(0==t&&1==i||1==t&&2==i){var a=chapter.get(GOLD);a<100&&(chapter.add(GOLD,100-a,"guide"),cc.game.emit("add_drop",{i:GOLD,n:100-a}))}if(0==t&&2==i){for(var n in chapter.data.bench)if("h4"==chapter.data.bench[n])return;chapter.data.bench.push("h4")}if(1==t&&2==i){for(var n in chapter.data.bench)if("h3"==chapter.data.bench[n])return;chapter.data.bench.push("h3"),chapter.data.bag.push({id:"cannon",lvl:1})}if(1==t&&3==i){var o=0,r=0;for(var n in chapter.data.bag)chapter.data.bag[n]&&"a"==chapter.data.bag[n].id&&(o=1),chapter.data.bag[n]&&"d"==chapter.data.bag[n].id&&(r=1);o||chapter.data.bag.push({id:"b",lvl:1}),r||chapter.data.bag.push({id:"d",lvl:1})}}},checkGuide:function(){if("train"!=this.mode){var e=this.getChapterIndex(),t=this.getLevelIndex();if(2==this.testGuide?(e=0,t=2):3==this.testGuide?(e=0,t=3):4==this.testGuide?(e=0,t=4):6==this.testGuide?(e=1,t=3):7==this.testGuide?(e=1,t=4):8==this.testGuide&&(e=1,t=2),e<1&&t<3?chapter.data.merchantShowChance=0:1==e&&(chapter.data.merchantShowChance=4==t?1:0),0==e&&(1==t&&(this.maxStack=1,this.noCheckStack=!0,cc.game.on("showCheckpointUI",this.guideRepair,this),this.tabList[2].active=!1,this.tabList[3].active=!1,this.tabList[4].active=!1,this.battleBottomUI.getComponent("battleBottomUI").enableBag(0,!1),this.battleBottomUI.getComponent("battleBottomUI").enableBag(1,!1),this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!1)),2==t&&(this.maxStack=2,this.tabList[3].active=!1,this.tabList[4].active=!1,cc.game.on("showCheckpointUI",this.guideEquipmentTab,this),this.noItemInfoPop=!0,this.battleBottomUI.getComponent("battleBottomUI").enableBag(1,!1),this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!1)),3==t&&(this.battleBottomUI.getComponent("battleBottomUI").enableBag(1,!1),this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!1))),1==e){if(1==t&&(cc.game.on("showCheckpointUI",this.guideEquipmentTab2,this),this.noItemInfoPop=!0,this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!1),this.tabList[4].active=!1),2==t&&(this.noOperatorPop=!0,this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!1),this.tabList[4].active=!1,chapter.add(GOLD,100,"guide2"),cc.game.emit("add_drop",{pos:this.node.convertToWorldSpaceAR(cc.v2(0,0)),tid:"guide2",i:GOLD,n:100}),cc.game.on("showCheckpointUI",this.guideAddStack2,this)),3==t){this.node.convertToWorldSpaceAR(cc.v2(0,0));var i=this;cc.game.on("showCheckpointUI",this.guideForgeMaterial,this),cc.game.on("onItemGet",function(){var e="\u673a\u67aa\u5175"+ENTITY.h2.name+"\uff0c\u53bb\u628a\u67b6\u5b50\u642d\u597d\uff01";menuManager.chatOn(null,"\u54fc\uff01\u4fbf\u5b9c\u4f60\u4e86\uff0c\u5e93\u739b\uff01",2,null,function(){menuManager.focusOn(i.tabList[0],e,function(){},null,null,{head:"h99",dx:-100})})},this)}4==t&&cc.game.on("showCheckpointUI",this.guideMerchant,this)}}},updateReddot:function(){for(var e in chapter.data.reddot){var t,i=chapter.data.reddot[e];"weapon"==e?t=this.tabList[2]:"equipment"==e?t=this.tabList[3]:"material"==e&&(t=this.tabList[4]),t&&(t.getChildByName("reddot").active=!!i,t.getChildByName("reddot").getChildByName("label").getComponent(cc.Label).string=i)}},clearReddot:function(e){chapter.data.reddot[e]=0,this.updateReddot()},guideChooseBonusMoney:function(e){var t=e.menu;t.noBonus=!0,t.fixMoney=200,menuManager.focusOn(t.boards[0],"\u641e\u94b1\u4fee\u7406",function(){})},guideChooseBonusMoney2:function(e){var t=e.menu;t.fixMoney=200,menuManager.focusOn(t.boards[0],"\u4e09\u9009\u4e00\u9009\u94b12",function(){})},guideChooseBonusItem:function(e){var t=e.menu;t.noBonus=!0,t.fixItem=[{id:"flame_thrower",lvl:1}];var i=this.bagUI.getComponent("bottomUI"),a=0;for(var n in i.bagBlocks)i.bagBlocks[n].content&&a++;a<1&&t.fixItem.push({id:"flame_thrower",lvl:1}),menuManager.focusOn(t.boards[1],"\u641c\u6b66\u5668\u88c5\u5907",function(){})},guideChooseBonusItem2:function(e){var t=this.bagUI.getComponent("bottomUI"),i=e.menu;i.fixItem2=[{id:"c",lvl:1}];var a=0;for(var n in t.bagBlocks)t.bagBlocks[n].content&&a++;a<1&&(i.fixItem=[{id:"a",lvl:1}]),menuManager.focusOn(i.boards[1],"\u4e09\u9009\u4e00\u914d\u4ef62",function(){})},guideEquipmentTab:function(){var e=this,t=this;TJ.onGuideEvent({guide_id:26,guide_name:"\u6b66\u56681"}),menuManager.focusOn(this.tabList[2],"\u9a6c\u4e0a\u7ed9\u4f60\u914d\u5907\u6b66\u5668\uff01",function(){e.bagUI.getComponent("bottomUI").weaponTeamForgeFrame[0].weaponBlock.setInteractable(!1),t.setBagInteractable(!1),setTimeout(function(){t.guideEquipWeapon()},100),TJ.onGuideEvent({guide_id:27,guide_name:"\u6b66\u56681-\u5207\u6362"})},null,null,{head:"h99"})},guideEquipmentTab2:function(){var e=this,t=this;TJ.onGuideEvent({guide_id:50,guide_name:"\u914d\u4ef6"}),menuManager.focusOn(this.tabList[3],"\u54c7\uff01\u539f\u6765\u662f\u4e2a\u914d\u4ef6\uff01\u6211\u4eec\u53ef\u4ee5\u88c5\u8d77\u6765~",function(){var i=e.bagUI.getComponent("bottomUI");i.weaponTeamForgeFrame[0].equipmentBlock1.setInteractable(!1),i.weaponTeamForgeFrame[0].equipmentBlock2.setInteractable(!1),t.setBagInteractable(!1),setTimeout(function(){t.guideEquipEquipment()},100)},null,null,{head:"h99",dx:-150})},guideEquipmentTab3:function(){var e=this,t=this;TJ.onGuideEvent({guide_id:62,guide_name:"\u6b66\u56682"}),menuManager.focusOn(this.tabList[2],"\u5927\u5bb6\u628a\u6b66\u5668\u90fd\u88c5\u8d77\u6765\uff01",function(){e.bagUI.getComponent("bottomUI").weaponTeamForgeFrame[0].weaponBlock.setInteractable(!1),t.setBagInteractable(!1),setTimeout(function(){t.guideEquipWeapon("cannon",t.guideSwapOperator)},100),TJ.onGuideEvent({guide_id:63,guide_name:"\u6b66\u56682-\u5207\u6362"})},null,null,{cfg:"h0"})},guideSwapOperator:function(){var e=this,t=this.bagUI.getComponent("bottomUI"),i=t.weaponTeamForgeFrame[1].operatorBlock;if(console.log("guideEquipWeapon",i),i.setInteractable(!0),this.guideWeaponCt=this.guideWeaponCt||0,!(this.guideWeaponCt>0)&&(this.guideWeaponCt++,i)){var a,n={dragToNode:t.weaponTeamForgeFrame[2].operatorBlock.node,dx:-150,dy:450,head:"h99"};if(!this.guidedArrow){this.guidedArrow=!0,a=new cc.Node;var o=cc.Canvas.instance.node;o.addChild(a,11111);var r=i.node.convertToWorldSpaceAR(cc.v2(0,0)),s=o.convertToNodeSpaceAR(r);a.x=s.x,a.y=s.y,i.showGuideLine(a)}TJ.onGuideEvent({guide_id:65,guide_name:"\u70ae\u624b"}),menuManager.focusOn(i.node,"\u563b\u563b\uff0c\u6211\u5f88\u64c5\u957f\u5f00\u70ae\u54df\uff01\u80fd\u8ba9\u6211\u6765\u5417\uff1f\n\u628a\u6211\u548c\u5e93\u739b\u6362\u4e2a\u4f4d\u7f6e\u5427\uff01",null,function(){console.log("guideEquipWeapon 11111"),e.guideWeaponCt--,i.unShowGuideLine(),a&&(a.destroy(),e.guidedArrow=!1),cc.game.on("onItemInteract",e.checkGuideSwapOperatorFinish,e)},cc.Node.EventType.TOUCH_START,n)}},checkGuideSwapOperatorFinish:function(){var e=this,t=0;if("h3"==this.tankBlocks[1].content.operator&&(t=1),t){TJ.onGuideEvent({guide_id:66,guide_name:"\u70ae\u624b-\u5207\u6362"}),this.noOperatorPop=!1,cc.game.off("onItemInteract",this.checkGuideSwapOperatorFinish,this);var i=function(){menuManager.focusOn(e.tabList[0],"\u5927\u5bb6\u60f3\u6362\u4f4d\u7f6e\u968f\u65f6\u548c\u8f66\u957f\u8bb2\uff01\n\u6362\u54ea\u90fd\u53ef\u4ee5\uff01\u73b0\u5728\u81ea\u7531\u6d3b\u52a8\uff01",null,null,null,{head:"h99",dx:-150,dy:450})};menuManager.pop("video_guide",{title:"\u6b66\u5668\u8dc3\u5347!",head:"h3",gear:"cannon",lvl:4,checkCb:function(t){if(t)return sdk.useFree("guide_cannon",function(t){if(!t){menuManager.close();var a=e.tankBlocks[1].content;a.weaponLvl=4;var n=e.weaponTeamForgeBlocks[4];n.content.remove(),a.hpBar.setLevel(a.weaponLvl),a.updateHpMax(!0),a.resetAvatarState();var o=n.node;e.addItem(n,{hp:1,id:a.weapon,weaponTeam:a,lvl:a.weaponLvl},o.convertToWorldSpaceAR(cc.v2(0,0)),function(){cc.game.emit("forgeItemFinish")}),e.updateBattleBottomUI(),i()}}),!0;i()}})}else this.guideSwapOperator()},guideEquipWeapon:function(e,t){var i=this,a=i.getBagItemById(e||"flame_thrower");if(this.equipWeaponCB=t,this.equipWeaponId=e,console.log("guideEquipWeapon",a),a.setInteractable(!0),this.guideWeaponCt=this.guideWeaponCt||0,!(this.guideWeaponCt>0)&&(this.guideWeaponCt++,a)){var n,o={dragToNode:this.bagUI.getComponent("bottomUI").weaponTeamForgeFrame[1].weaponBlock.node||this.tankBlocks[1].node,dx:-120,dy:350,head:"h99"};if(!this.guidedArrow){this.guidedArrow=!0,n=new cc.Node;var r=cc.Canvas.instance.node;r.addChild(n,11111);var s=a.node.convertToWorldSpaceAR(cc.v2(0,0)),c=r.convertToNodeSpaceAR(s);n.x=c.x,n.y=c.y,a.showGuideLine(n)}menuManager.focusOn(a.node,e?"":"\u54c7\uff01\u662f\u6211\u6700\u7231\u7684\u55b7\u706b\u5668\uff01\n\u62d6\u5230\u6211\u8fd9\u6765\u5c31\u597d\u5566\uff01",null,function(){console.log("guideEquipWeapon 11111"),i.guideWeaponCt--,a.unShowGuideLine(),n&&(n.destroy(),i.guidedArrow=!1),cc.game.on("onItemInteract",i.checkGuideEquipWeaponFinish,i),e?TJ.onGuideEvent({guide_id:64,guide_name:"\u6b66\u56682-\u70b9\u51fb"}):TJ.onGuideEvent({guide_id:28,guide_name:"\u6b66\u56681-\u70b9\u51fb"})},cc.Node.EventType.TOUCH_START,o)}},guideEquipEquipment:function(){var e=this,t=e.getBagItemById("ac")||e.getBagItemById("ac3"),i=e.bagUI.getComponent("bottomUI");if(t){var a;if(t.setInteractable(!0),i.showBlocks("equipment"),!this.guidedArrow){this.guidedArrow=!0,a=new cc.Node;var n=cc.Canvas.instance.node;n.addChild(a,11111);var o=t.node.convertToWorldSpaceAR(cc.v2(0,0)),r=n.convertToNodeSpaceAR(o);a.x=r.x,a.y=r.y,t.showGuideLine(a)}var s={dragToNode:i.weaponTeamForgeFrame[0].equipmentBlock0.node||this.tankBlocks[1].node,dx:-120,dy:250};TJ.onGuideEvent({guide_id:51,guide_name:"\u914d\u4ef6-\u5207\u6362"}),menuManager.focusOn(t.node,"\u5feb\uff0c\u62d6\u6765\u7ed9\u6211\u88c5\u4e0a\uff01",null,function(){t.unShowGuideLine(),a&&(a.destroy(),e.guidedArrow=!1),cc.game.on("onItemInteract",e.checkGuideEquipEquipmentFinish,e)},cc.Node.EventType.TOUCH_START,s)}},checkGuideEquipEquipmentFinish:function(){var e=0;for(var t in this.tankBlocks)this.tankBlocks[t].content&&this.tankBlocks[t].content.equipment.length>0&&e++;e<1?this.guideEquipEquipment():(cc.game.off("onItemInteract",this.checkGuideEquipEquipmentFinish,this),this.guideForgeEquipment())},checkGuideEquipWeaponFinish:function(){var e=0;for(var t in this.tankBlocks)this.tankBlocks[t].content&&e++;e<2?this.guideEquipWeapon(this.equipWeaponId,this.equipWeaponCB):(cc.game.off("onItemInteract",this.checkGuideEquipWeaponFinish,this),this.equipWeaponCB?(this.equipWeaponCB(),this.equipWeaponCB=null):this.guideForgeWeapon(),this.equipWeaponId=null)},checkGuideUpgradeWeaponFinish:function(){var e=this,t=!1;for(var i in this.tankBlocks)if(this.tankBlocks[i].content&&this.tankBlocks[i].content.weaponLvl>1){t=!0;break}t?(cc.game.off("onItemInteract",e.checkGuideUpgradeWeaponFinish,e),e.bagUI.getComponent("bottomUI").weaponTeamForgeFrame[0].weaponBlock.setInteractable(!0),TJ.onGuideEvent({guide_id:30,guide_name:"\u6362\u5c42"}),menuManager.focusOn(this.tabList[0],"",function(){e.setBagInteractable(!0),e.guideSwitchPosition()})):this.guideForgeWeapon()},checkGuideUpgradeEquipmentFinish:function(){var e=this,t=!1;for(var i in this.tankBlocks)if(this.tankBlocks[i].content)for(var a in this.tankBlocks[i].content.equipment){var n=this.tankBlocks[i].content.equipment[a];if("ac2"==n||"ac4"==n){t=!0;break}}if(t){cc.game.off("onItemInteract",e.checkGuideUpgradeEquipmentFinish,e);var o=e.bagUI.getComponent("bottomUI");o.weaponTeamForgeFrame[0].equipmentBlock1.setInteractable(!0),o.weaponTeamForgeFrame[0].equipmentBlock2.setInteractable(!0),menuManager.focusOn(this.tabList[0],"",function(){e.setBagInteractable(!0),TJ.onGuideEvent({guide_id:54,guide_name:"\u914d\u4ef6-\u79bb\u5f00"}),menuManager.focusOn(e.startGameButton,"\u54c8\u54c8\u54c8\uff0c\u6211\u5df2\u7ecf\u5929\u4e0b\u65e0\u654c\u4e86\uff01\n\u524d\u8fdb\uff01\u9ad8\u5854\u6218\u8f66\uff01",function(){TJ.onGuideEvent({guide_id:55,guide_name:"\u4e0b\u4e00\u51733-\u70b9\u51fb"})},null,null,{dx:-150})})}else this.guideForgeEquipment()},setBagInteractable:function(e){this.bagUI.getComponent("bottomUI").setBagInteractable(e)},guideChooseEvent:function(e){var t=this,i=e.menu;menuManager.focusOn(i.bonusButton,"\u4e8b\u4ef6\u9009\u53cc\u500d",function(){t.guideForgeEquipment()})},guideChooseEvent2:function(e){var t=e.menu;menuManager.focusOn(t.bonusButton,"\u4e8b\u4ef6\u9009\u53cc\u500d",function(){})},guideRepair:function(){var e=this;this.args.vehicleConfig.hp-=.01,TJ.onGuideEvent({guide_id:13,guide_name:"\u4fee\u7406"}),menuManager.focusOn(this.tabList[1],"\u8f66\u95f4\uff1f\u597d\uff0c\u9a6c\u4e0a\u5f00\u59cb\u4fee\u7406\uff01",function(){TJ.onGuideEvent({guide_id:14,guide_name:"\u4fee\u7406-\u8df3\u8f6c"}),menuManager.focusOn(e.repairAll,"",function(){TJ.onGuideEvent({guide_id:15,guide_name:"\u4fee\u7406-\u70b9\u51fb"}),menuManager.focusOn(e.tabList[0],"",function(){TJ.onGuideEvent({guide_id:16,guide_name:"\u4fee\u7406-\u79bb\u5f00"}),e.enableStartGameButton(!1),e.setUITouchable(!1),menuManager.chatOn(null,"\u54a6\uff0c\u8fd9\u91cc\u6709\u4ec0\u4e48\u4e1c\u897f\uff1f",2,{dx:-130},function(){for(var t in e.setUITouchable(!0),e.maxStack=2,e.updateVehicleFixShow(),e.vehicleFixNodes)e.vehicleFixNodes[t].getComponent("checkpointVehicleFix").initStack();e.guideAddStack()})})})},null,null,{head:"h99"})},guideAddStack:function(){var e=this,t=this.vehicleFixNodes[1].getComponent("checkpointVehicleFix").addStackNode;TJ.onGuideEvent({guide_id:17,guide_name:"\u4e70\u5c421"}),menuManager.focusOn(t,"\u4e70\u4e00\u4e2a\u8bd5\u8bd5\u770b!",function(){TJ.onGuideEvent({guide_id:18,guide_name:"\u4e70\u5c421-\u70b9\u51fb"}),e.enableStartGameButton(!0),menuManager.chatOn(null,"\u4e0d\u8981\u4e71\u82b1\u94b1\u554a\uff01\u6211\u4eec\u6ca1\u6709\u66f4\u591a\u961f\u53cb\uff01",2,{noBlack:0,head:"h99",dx:-150},function(){menuManager.chatOn(null,"\u94b1\u4f1a\u6709\u7684\uff0c\u961f\u53cb\u4e5f\u4f1a\u6709\u7684\uff01\n\u524d\u8fdb\uff01\u9ad8\u5854\u6218\u8f66\uff01",2,{noBlack:0},function(){TJ.onGuideEvent({guide_id:19,guide_name:"\u4e0b\u4e00\u51731"}),menuManager.focusOn(e.startGameButton,"",function(){TJ.onGuideEvent({guide_id:20,guide_name:"\u4e0b\u4e00\u51731-\u70b9\u51fb"})})})})})},guideAddStack2:function(){var e=this,t=this.vehicleFixNodes[1].getComponent("checkpointVehicleFix").addStackNode;t.active&&(TJ.onGuideEvent({guide_id:60,guide_name:"\u4e70\u5c422"}),menuManager.focusOn(t,"\u8fd9\u4e48\u591a\u4eba\uff0c\u5feb\u628a\u67b6\u5b50\u642d\u4e0a\uff01",function(){TJ.onGuideEvent({guide_id:61,guide_name:"\u4e70\u5c422-\u70b9\u51fb"}),e.guideEquipmentTab3()}))},guideForgeWeapon:function(){var e=this.bagUI.getComponent("bottomUI"),t=e.getBagItemById("flame_thrower"),i=(t.node,this);t.setInteractable(!0);var a={dragToNode:e.weaponTeamForgeFrame[1].weaponBlock.node||this.tankBlocks[0].node,dx:-120,dy:350,head:"h99"};menuManager.focusOn(t.node,"\u4e24\u4e2a\u540c\u6837\u7684\u6b66\u5668\u62d6\u5230\u4e00\u8d77\u8fd8\u53ef\u4ee5\u5347\u9636\u54e6\uff01",null,function(){cc.game.on("onItemInteract",i.checkGuideUpgradeWeaponFinish,i),TJ.onGuideEvent({guide_id:29,guide_name:"\u6b66\u56681-\u5347\u7ea7"})},cc.Node.EventType.TOUCH_START,a)},guideForgeEquipment:function(){var e,t=this.bagUI.getComponent("bottomUI"),i=t.getBagItemById("ac")||t.getBagItemById("ac3"),a=(i.node,this);if(!this.guidedArrow){this.guidedArrow=!0,e=new cc.Node;var n=cc.Canvas.instance.node;n.addChild(e,11111);var o=i.node.convertToWorldSpaceAR(cc.v2(0,0)),r=n.convertToNodeSpaceAR(o);e.x=r.x,e.y=r.y,i.showGuideLine(e)}i.setInteractable(!0);var s={dragToNode:t.weaponTeamForgeFrame[0].equipmentBlock0.node||this.tankBlocks[0].node,dx:50,dy:250};TJ.onGuideEvent({guide_id:52,guide_name:"\u914d\u4ef6-\u70b9\u51fb"}),menuManager.focusOn(i.node,"\u5347\u9636\u4e5f\u7ed9\u5b89\u6392\u4e0a!",null,function(){TJ.onGuideEvent({guide_id:53,guide_name:"\u914d\u4ef6-\u5347\u7ea7"}),i.unShowGuideLine(),e&&(e.destroy(),a.guidedArrow=!1),cc.game.on("onItemInteract",a.checkGuideUpgradeEquipmentFinish,a)},cc.Node.EventType.TOUCH_START,s)},guidePutWeaponToForge:function(){var e=this,t=e.getBagItemById("flame_thrower");if(!t)for(var i in e.weaponTeamForgeBlocks)e.weaponTeamForgeBlocks[i].content&&"flame_thrower"==e.weaponTeamForgeBlocks[i].content.define.id&&(t=e.weaponTeamForgeBlocks[i]);t&&menuManager.focusOn(t.node,"\u653e\u4e0a\u53bb",null,function(){cc.game.on("onItemInteract",e.checkGuideForgeWeaponFinish,e)},cc.Node.EventType.TOUCH_START)},guideForgeMaterial:function(){var e=this;TJ.onGuideEvent({guide_id:70,guide_name:"\u7d20\u6750"}),menuManager.focusOn(this.tabList[4],"\u8def\u4e0a\u62e3\u7684\u7d20\u6750\u53ef\u4e0d\u8981\u6d6a\u8d39\u54df\uff01",null,function(){e.guidePutMaterialToForge()},null,{head:"h99"})},guideMerchant:function(){var e=this;TJ.onGuideEvent({guide_id:79,guide_name:"\u5546\u4eba"}),menuManager.focusOn(this.nodesToHideOnForge[0],"\u5feb\uff0c\u51c6\u5907\u597d\u94b1\uff0c\u6211\u8981\u4e70\u4e1c\u897f\uff01",null,function(){TJ.onGuideEvent({guide_id:80,guide_name:"\u5546\u4eba-\u5207\u6362"}),e.bagUI.getChildByName("\u5546\u5e97").getComponent("Merchant").setBonusMoneyAdFree(),menuManager.focusOn(e.bagUI.getChildByName("\u5546\u5e97").getChildByName("\u5e7f\u544a\u6309\u94ae"),"\u770b\u5440\uff01\u8fd9\u91cc\u6709\u7ed9\u6211\u7684\u8d2d\u7269\u7ea2\u5305\uff01",function(){TJ.onGuideEvent({guide_id:81,guide_name:"\u5546\u4eba-\u70b9\u51fb"});var e=function(){menuManager.chatOn(null,"\u94b1\u4e0d\u591f\u6211\u4eec\u8fd8\u53ef\u4ee5\u5356\u4e1c\u897f\uff01",3,{head:"h99"})},t=[{i:DIAMOND,n:100}];menuManager.pop("video_guide",{title:"\u5546\u4eba\u7684\u8d60\u793c",head:"99",items:t,checkCb:function(a){if(a)return sdk.useFree("guide_shop",function(a){a||net.updateData({items:t},function(a,n){i.FirebaseTracking.setDataBiRes("RewardAds_CheckPoint"),money.update(n),menuManager.close(),menuManager.pop("show",{items:t,checkCb:function(){e()}})})}),!0;e()}})},null,null,{dx:-50,dy:50})})},guidePutMaterialToForge:function(){var e,t=this,i=this;this.guidePutMaterialToForgeStep=this.guidePutMaterialToForgeStep||0;var a=!this.guidePutMaterialToForgeStep&&i.getBagItemById("b")||i.getBagItemById("d"),n=this.guidedArrow,o=!this.guidePutMaterialToForgeStep&&this.forgeBlocks[0]||this.forgeBlocks[1];if(!n){this.guidedArrow=!0,e=new cc.Node;var r=cc.Canvas.instance.node;r.addChild(e,11111);var s=a.node.convertToWorldSpaceAR(cc.v2(0,0)),c=r.convertToNodeSpaceAR(s);e.x=c.x,e.y=c.y,a.showGuideLine(e,o)}a&&(this.guidePutMaterialToForgeStep||TJ.onGuideEvent({guide_id:71,guide_name:"\u7d20\u6750-\u5207\u6362"}),menuManager.focusOn(a.node,"\u62d6\u8fdb\u6765\u770b\u770b\uff0c\u80fd\u5408\u6210\u4ec0\u4e48\uff1f",null,function(){t.guidePutMaterialToForgeStep?TJ.onGuideEvent({guide_id:73,guide_name:"\u7d20\u6750-\u70b9\u51fb2"}):TJ.onGuideEvent({guide_id:72,guide_name:"\u7d20\u6750-\u70b9\u51fb1"}),a.unShowGuideLine(),e&&(e.destroy(),i.guidedArrow=!1),cc.game.on("onItemInteract",i.checkGuideForgeEquipmentFinish,i)},cc.Node.EventType.TOUCH_START,{head:"h99",dragToNode:o.node}))},checkGuideForgeWeaponFinish:function(e){return this.checkGuideForgeFinish(e,this.guidePutWeaponToForge.bind(this))},checkGuideForgeEquipmentFinish:function(e){return this.checkGuideForgeFinish(e,this.guidePutMaterialToForge.bind(this))},checkGuideForgeFinish:function(e,t){var i=0;for(var a in this.forgeBlocks)this.forgeBlocks[a].content&&i++;this.guidePutMaterialToForgeStep=i,i<2?t&&t():(cc.game.off("onItemInteract",this.checkGuideForgeFinish,this),cc.game.off("onItemInteract",this.checkGuideForgeWeaponFinish,this),cc.game.off("onItemInteract",this.checkGuideForgeEquipmentFinish,this),TJ.onGuideEvent({guide_id:74,guide_name:"\u5408\u6210"}),menuManager.focusOn(this.startForgeButton,"\u673a\u67aa\uff01\u6211\u8981\u4e00\u6746\u9876\u597d\u7684\u673a\u67aa\uff01",null,function(){TJ.onGuideEvent({guide_id:75,guide_name:"\u5408\u6210-\u70b9\u51fb"})}))},guideSwitchPosition:function(){var e=this,t=e.tankBlocks[0],i={dragToNode:e.tankBlocks[1].node,dy:-250,dx:-150};TJ.onGuideEvent({guide_id:31,guide_name:"\u6362\u5c42-\u5207\u6362"}),menuManager.focusOn(t.node,"\u6211\u8981\u53bb\u4e0a\u5c42\uff01\u6211\u8981\u53bb\u4e0a\u5c42\uff01\n\u5feb\u628a\u6211\u62d6\u4e0a\u53bb\uff01",null,function(){cc.game.on("onItemInteract",e.checkGuideSwitchPositionFinish,e),TJ.onGuideEvent({guide_id:32,guide_name:"\u6362\u5c42-\u70b9\u51fb"})},cc.Node.EventType.TOUCH_START,i)},checkGuideSwitchPositionFinish:function(){"flame_thrower"!=this.tankBlocks[0].content.weapon?this.guideSwitchPosition():menuManager.focusOn(this.startGameButton,"\u89c6\u91ce\u771f\u597d\uff01\u524d\u8fdb\uff0c\u9ad8\u5854\u6218\u8f66\uff01",function(){TJ.onGuideEvent({guide_id:33,guide_name:"\u4e0b\u4e00\u51732-\u70b9\u51fb"})},null,null,{dx:-150})},checkOperatorAlive:function(){if(this.args.vehicleConfig)for(var e=this.args.vehicleConfig.towers,t=chapter.data.tank,i=0;i<=t.length-1;i++){var a=t[i];a&&(e[i]&&!e[i].hp?(chapter.data.mainOperator==a.operator&&(chapter.data.mainOperator=null),a.hp=0):(chapter.data.mainOperator||(chapter.data.mainOperator=a.operator),a.hp=e[i].hp))}},initTank:function(){var e=this,t=this.args.vehicleConfig.vid,i=this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay),a=this.tank.getChildByName("lower").getComponent(dragonBones.ArmatureDisplay),n=ENTITY[t].avatar;this.tank.x-=1e3,this.tankState=0,this.tankSpd=0,this.setUIEnable(!1);var o=cc.instantiate(this.vehicleBarPrefab);this.tank.addChild(o);var r=o.getComponent("VehicleBar"),s=this.args.vehicleConfig,c=s.hp,l=ENTITY[s.vid]&&ENTITY[s.vid].name;this.tankHpBarObj={hp:c,hpMax:1,config:{},heatMax:1,noNum:1,define:{attackAngle:[30,90],name:l}},r.init(this,this.tankHpBarObj,{x:0,y:0,getPosition:function(){return cc.v2(0,0)}}),r.enableAlwaysShow(),r.refresh(),this.tankHpBar=r,this.tankStack=chapter.data.stack,this.effectMgr.loadArmature(i,n.anime,function(t,i){e.tankWalkState=i.playAnimation("walk",-1);for(var a=1;a<=4;a++)a>=e.tankStack&&(i.armature().getBone("jiazi"+a).visible=!1);e.afterLoad()},n.animeName2),this.effectMgr.loadArmature(a,n.anime,function(t,i){e.tankWalkState2=i.playAnimation("walk",-1)},n.animeName),"v3"==t&&(this.vehicleFixNodes[0].parent.x+=40,this.vehicleFixNodes[0].parent.y+=40),"v2"==t&&(this.vehicleFixNodes[0].parent.x+=40)},initTankAnimation:function(){},update:function(e){if(this.tankLoaded)if(this.tankState<=1){var t=2*Math.abs(this.tank.x+240);t=kit.clamp(t,30,1e3),this.tankWalkState&&(this.tankWalkState.timeScale=kit.clamp(t/560,.2,10)),this.tankWalkState2&&(this.tankWalkState2.timeScale=kit.clamp(t/560,.2,10)),this.tankSpd=t,this.tank.x=kit.numApproach(this.tank.x,-240,Math.abs(this.tankSpd*e)),-240==this.tank.x&&0==this.tankState&&(this.tankState=1,this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).playAnimation("stand"),this.tank.getChildByName("lower").getComponent(dragonBones.ArmatureDisplay).playAnimation("stand"),delete this.tankWalkState,delete this.tankWalkState2,this.battleBottomUI.active=!0,this.updateTankBlocks(),this.updateFixNode(),this.setUIEnable(!0),cc.game.emit("showCheckpointUI")),this.camera.node.x=.85*this.tank.x+200}else this.tankSpd=kit.numApproach(this.tankSpd,600,600*e),this.tank.x+=this.tankSpd*e,this.tankWalkState&&(this.tankWalkState.timeScale=kit.clamp(this.tankSpd/560,.2,10)),this.tankWalkState2&&(this.tankWalkState2.timeScale=kit.clamp(this.tankSpd/560,.2,10))},updateFixNode:function(){this.initVehicleFixShow(),this.updateRepairTankBtnVisual()},initVehicleFixShow:function(){if(!this.vehicleFixInited){for(var e in this.vehicleFixNodes)this.vehicleFixNodes[e].getComponent("checkpointVehicleFix").init(this,+e+1);this.vehicleFixInited=!0,this.vehicleFixNodes[0].parent.zIndex=222}},updateVehicleFixShow:function(){if(this.vehicleFixInited)for(var e in this.vehicleFixNodes)this.vehicleFixNodes[e].getComponent("checkpointVehicleFix").updateVisual()},setVehicleFixVisible:function(e){for(var t in this.vehicleFixNodes)this.vehicleFixNodes[t].active=e},setTrainModeVehicleFix:function(){for(var e in this.vehicleFixNodes)this.vehicleFixNodes[e].getComponent("checkpointVehicleFix").setTrainMode()},hideVehicleFix:function(){for(var e in this.vehicleFixNodes)this.vehicleFixNodes[e].getComponent("checkpointVehicleFix").setHide()},setUITouchable:function(e){if(e)this.blockInputNode.active=!1;else{if(!this.blockInputNode){var t=new cc.Node;t.addComponent(cc.BlockInputEvents),t.width=9999,t.height=9999,this.node.addChild(t,9999),this.blockInputNode=t}this.blockInputNode.active=!0}},setUIEnable:function(e){for(var t in this.uiEnable=e,this.setUITouchable(e),this.setTankHpBarVisible(e),this.nodesToHideOnForge)this.nodesToHideOnForge[t].active=!this.nodesToHideOnForge[t].lock&&e;this.tabNode.active=e,this.enableStartGameButton(e),this.switchTrainMerchantMode(e)},setTankHpBarVisible:function(e){for(var t in this.tankBlocks)this.tankBlocks[t].content&&this.tankBlocks[t].content.setHpBarVisible(e)},addItem:function(e,t,i,a){var n=t.id,o=new cc.Node,r=this.getItemCtor(n),s=o.addComponent(r);if(s.init(this,ItemDefine[n],{block:e,lvl:t.lvl,weaponTeam:t.weaponTeam,hp:t.hp}),i){var c=o.parent.convertToNodeSpaceAR(i);o.x=c.x,o.y=c.y,o.scale=0;var l=e.node.convertToWorldSpaceAR(cc.v2(0,0)),d=s.getCenterPos(l.x,l.y);o.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,1.2),cc.moveBy(.1,cc.v2(0,0))),cc.scaleTo(.1,1),cc.delayTime(.1),cc.moveTo(.25,cc.v2(d.x,d.y)).easing(cc.easeInOut(2)),cc.delayTime(.3),cc.callFunc(function(){a&&a()},this))),this.effectMgr.playEffect("sound/checkpoint/get_item")}return s},checkSuitableBlocks:function(){var e,t=[];for(var i in this.forgeBlocks)this.forgeBlocks[i].content&&(t.push(this.forgeBlocks[i]),this.forgeBlocks[i].content.weaponTeam&&(e=this.forgeBlocks[i].content.weaponTeam));this.startForgeButton.active=t.length>=2,this.startForgeButton.active&&(this.startForgeButton.scale=0,this.startForgeButton.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1))),this.updatepreviewForgeNode()),this.previewForgeNode.active=t.length>=2,this.preventPutWeaponTeamForge=t.length>0&&e,this.updateBlocksInteractable(this.bagBlocks,1==t.length&&t[0],t.length>=2,1==t.length),this.updateBlocksInteractable(this.weaponTeamForgeBlocks,1==t.length&&t[0],t.length>=2||t[0]&&t[0].content.weaponTeam,1==t.length),this.updateBlocksInteractable(this.forgeBlocks,!1,!1,!1)},updatepreviewForgeNode:function(){var e=this.previewForgeNode,t=this.getForgeOutcome();if(t)if(e.itemNode&&e.itemNode.destroy(),-1==t)e.active=!0,(i=new cc.Node).addComponent(cc.Sprite),e.addChild(i),e.itemNode=i,this.effectMgr.loadSprite(i.getComponent(cc.Sprite),"checkpoint/forge/\u9519\u8bef\u5408\u6210");else{e.active=!0;var i=new cc.Node;e.addChild(i);var a=i.addComponent("checkpointAvatar"),n=ItemDefine[t.id];a.init(n,t.lvl,this),e.itemNode=i,e.define=n}else e.itemNode&&e.itemNode.destroy(),(i=new cc.Node).addComponent(cc.Sprite),e.addChild(i),e.itemNode=i,this.effectMgr.loadSprite(i.getComponent(cc.Sprite),"checkpoint/forge/\u672a\u77e5\u5408\u6210"),e.active=!0},popHandbook:function(){menuManager.pop("handbook",{game:this})},checkMerchantShow:function(){var e;0!=this.getChapterIndex()&&this.args.mapIndex==this.args.mapLength-1?e=1:(e=Math.random()<chapter.data.merchantShowChance)?chapter.data.merchantShowChance=0:chapter.data.merchantShowChance+=.35,"train"==this.mode&&(e=!1),this.merchantBtnNode.active=e,this.nodesToHideOnForge[0].active=e,this.nodesToHideOnForge[0].lock=!e},popMerchant:function(){},initForgeBlocks:function(){this.bagUI.getComponent("bottomUI").initForgeBlocks()},updateBlocksInteractable:function(e,t,i,a){if(e)for(var n in e){var o;if(e[n].content)if(i)o=!1;else if(t){var r=e[n].content;o="weapon"==t.content.define.type?!(!r||t.content.define.id!=r.define.id||t.content.lvl!=r.lvl):"equipment"==t.content.define.type?!(!r||"equipment"!=r.define.type||r.define.lvl!=t.content.define.lvl||r.define.id!=t.content.define.id):"material"!=t.content.define.type||!(!r||"material"!=r.define.type||t.content.lvl!=r.lvl||t.content.define.id==r.define.id)}else o=!0;else o=!0;e[n].setInteractable(o,a)}},updateBagBlockInteractable:function(e,t,i){if(this.bagBlocks)for(var a in this.bagBlocks){var n;if(i)n=!1;else if(t){var o=this.bagBlocks[a].content;n="weapon"==t.content.define.type?!(!o||t.content.define.id!=o.define.id||t.content.lvl!=o.lvl):"equipment"!=t.content.define.type||!(!o||"equipment"!=o.define.type)}else n=!0;this.bagBlocks[a].setInteractable(n)}},updateWeaponTeamForgeBlockInteractable:function(e){if(this.weaponTeamForgeBlocks)for(var t in this.weaponTeamForgeBlocks)this.weaponTeamForgeBlocks[t].setInteractable(e)},initForgeList:function(){var e=window.EquipmentForgeFormulaDefine;this.forgeList=e},findForgeFormula:function(e){for(var t in cc.log("findForgeFormula myList",e),this.forgeList){var i=this.forgeList[t],a=!0;cc.log("checkFormula",i);for(var n=kit.clone(e),o=0;o<i.length-1;o++){cc.log("checkFormula single item",i[o],n,n.indexOf(i[o]));var r=n.indexOf(i[o]);if(-1==r){a=!1;break}n.splice(r,1)}if(a)return cc.log("findForgeFormula",i),i}},switchRepairMode:function(e){for(var t in e&&!this.repairMode&&this.cancelSpecialMode(),this.repairMode=e,e&&this.tabBlockAnimation("\u4fee\u7406"),this.updateVehicleFixShow(),this.updateRepairTankBtnVisual(),this.nodesToHideOnForge)this.nodesToHideOnForge[t].active=!this.nodesToHideOnForge[t].lock&&!this.repairMode;this.repairUIBlack.active=this.repairMode,this.enableStartGameButton(!this.repairMode),this.bagUI.getComponent("bottomUI").showBagOnly(this.repairMode,!0),this.updateRepairAllWeaponTeamButtonVisual(),this.repairMenuNode.active=this.repairMode,this.repairMode||(this.repairAll.active=!1),e&&this.checkEmpowerTank()},initWeaponTeamForgeBlocks:function(){var e=this.weaponTeamForgeBlockNode;for(var t in this.weaponTeamForgeBlocks=[],this.tankBlocks)if(this.tankBlocks[t].content){var i=this.tankBlocks[t].content,n=new cc.Node;e.addChild(n);var o=this.effectMgr.createSprite(-115,-110,"checkpoint/forge/line");o.anchorX=0,o.anchorY=0,n.addChild(o);var r=n.addComponent(a),s={blockType:"weaponTeamForge",x:this.tankBlocks[t].node.x+this.tank.x,y:this.tankBlocks[t].node.y+this.tank.y+50+120};for(var c in r.init(this,s),n.opacity=0,n.runAction(cc.sequence(cc.delayTime(.05*t+.05*this.forgeBlocks.length),cc.spawn(cc.fadeIn(.3),cc.moveBy(.3,cc.v2(160,0))).easing(cc.easeInOut(2)))),this.weaponTeamForgeBlocks.push(r),this.addItem(r,{id:i.weapon,weaponTeam:i,lvl:i.weaponLvl}),r.x+=230,console.log(i.equipment),i.equipment)n=new cc.Node,e.addChild(n),r=n.addComponent(a),s={blockType:"weaponTeamForge",x:this.tankBlocks[t].node.x+this.tank.x+130+100*c,y:this.tankBlocks[t].node.y+this.tank.y+50+120},r.init(this,s),n.opacity=0,n.runAction(cc.sequence(cc.delayTime(.05*c+.05*this.forgeBlocks.length),cc.spawn(cc.fadeIn(.3),cc.moveBy(.3,cc.v2(160,0))).easing(cc.easeInOut(2)))),this.weaponTeamForgeBlocks.push(r),this.addItem(r,{id:i.equipment[c],weaponTeam:i}),r.x+=230+150*(c+1)}for(var t in this.forgeBlocks)this.forgeBlocks[t].node.scale=0,this.forgeBlocks[t].node.runAction(cc.sequence(cc.delayTime(.05*t),cc.scaleTo(.1,1.4),cc.scaleTo(.1,1)))},removeWeaponTeamForgeBlocks:function(){if(this.weaponTeamForgeBlocks){for(var e in this.weaponTeamForgeBlocks)this.weaponTeamForgeBlocks[e].content&&this.weaponTeamForgeBlocks[e].content.remove(),this.weaponTeamForgeBlocks[e].node.destroy();this.weaponTeamForgeBlocks=null}},moveToBag:function(e){for(var t in this.bagBlocks)if(!this.bagBlocks[t].content)return e.setBlock(this.bagBlocks[t]),!0},getEmptyWeaponTeamForgeBlock:function(){for(var e in this.weaponTeamForgeBlocks){var t=this.weaponTeamForgeBlocks[e];if(!t.content)return t}},getEmptyBagBlock:function(){for(var e in this.bagBlocks){var t=this.bagBlocks[e];if(!t.content)return t}},getEmptyForgeBlock:function(){for(var e in this.forgeBlocks){var t=this.forgeBlocks[e];if(!t.content)return t}},playForgeAnimation:function(e,t){this.isPlayingForgeAnimation=!0,this.setUITouchable(!1),this.switchForgeButton.active=!1,this.startForgeButton.active=!1;var i=this;for(var a in e)var n=e[a];var o=this.forgeDisplay.node.children[0].getComponent(dragonBones.ArmatureDisplay),r=o.playAnimation("walk");for(var a in r.timeScale=4,o.scheduleOnce(function(){i.forgeDisplay.playAnimation("mix",1).timeScale=1.7,o.armature().animation.stop("")},.5),o.scheduleOnce(function(){i.isPlayingForgeAnimation=!1,t&&t(),i.forgeDisplay.scheduleOnce(function(){i.forgeDisplay.playAnimation("open",1).timeScale=1.5},.5),i.forgeDisplay.scheduleOnce(function(){this.playAnimation("stand")},1),i.setUITouchable(!0)},1),this.forgeBlocks){if(n=this.forgeBlocks[a].content){var s=n.node.convertToWorldSpaceAR(cc.v2(0,0)),c=this.uiNode.convertToNodeSpaceAR(s);n.node.x=c.x,n.node.y=c.y,n.node.parent=this.uiNode;var l=260-155*a;n.node.runAction(cc.sequence(cc.moveBy(l/800,cc.v2(l,0)),cc.fadeOut(.1)))}this.forgeBlocks[a].node.opacity=0,this.forgeBlocks[a].node.runAction(cc.sequence(cc.delayTime(1),cc.fadeIn(.01)))}},getForgeOutcome:function(){var e=[];for(var t in this.forgeBlocks){var i=this.forgeBlocks[t].content;i&&e.push(i)}if(!(e.length<2)){if(e[0].define.id==e[1].define.id&&"weapon"==e[0].define.type&&"weapon"==e[1].define.type&&e[0].lvl==e[1].lvl)return cc.log("getForgeOutcome",e[0].define.id,e[0].lvl+1),{id:e[0].define.id,lvl:e[0].lvl+1};var a=[e[0].define.id,e[1].define.id],n=this.findForgeFormula(a),o=e[0].define.id+"-"+e[1].define.id,r=chapter.formula[o];if(n){var s=n[n.length-1];return cc.log("getForgeOutcome",s),cc.log("getForgeOutcome check formulaRecord",o,r),r?{id:s}:void cc.log("getForgeOutcome not unlock yet",s)}if(-1==r)return cc.log("getForgeOutcome failed before already"),-1;cc.log("getForgeOutcome \u65e0\u6cd5\u627e\u5230\u5408\u9002\u914d\u65b9",e[0].define.id,e[1].define.id)}},forgeItem:function(){if(!this.isPlayingForgeAnimation){var e=[];for(var t in this.forgeBlocks){var i=this.forgeBlocks[t].content;i&&e.push(i)}if(!(e.length<2))if(cc.log("try to forge 2 items lvl",e[0].lvl,e[1].lvl),e[0].define.id!=e[1].define.id||"weapon"!=e[0].define.type||"weapon"!=e[1].define.type||e[0].lvl!=e[1].lvl){var a=[e[0].define.id,e[1].define.id],n=this.findForgeFormula(a);if(!n)return o=function(){var t;if(this.forgeDisplay.node,chapter.addFormula(e[0].define.id,e[1].define.id,-1),cc.log("\u5408\u6210\u5931\u8d25\uff0c\u6ca1\u6709\u5bf9\u5e94\u914d\u65b9"),e[0].weaponTeam||e[1].weaponTeam){var i=(e[0].weaponTeam&&e[0]||e[1]).define.id,a=e[0].weaponTeam||e[1].weaponTeam;a.removeEquipmentById(i),t=e[1].weaponTeam?1:0}e[0].remove(),e[1].remove(),menuManager.pop("forge_fail",{game:this,items:[e[0].define.id,e[1].define.id],fromWeaponTeam:{index:t,weaponTeam:a}})},this.playForgeAnimation(e,o.bind(this)),void cc.log("\u65e0\u6cd5\u627e\u5230\u5408\u9002\u914d\u65b9");var o=function(){var t=n[n.length-1],i=this.forgeDisplay.node;if(e[0].weaponTeam||e[1].weaponTeam){var a,o;a=e[0].weaponTeam?(o=e[0]).weaponTeam:(o=e[1]).weaponTeam;var r=this.getEmptyWeaponTeamForgeBlock();for(var s in this.addItem(r,{id:t,weaponTeam:e[0].weaponTeam||e[1].weaponTeam},i.convertToWorldSpaceAR(cc.v2(200,230))),a.equipment)if(a.equipment[s]==o.define.id){a.equipment[s]=t,a.updateEquipmentIcon(!0);break}}else this.addBagItem(t,null,i.convertToWorldSpaceAR(cc.v2(200,230)));cc.log("\u5408\u6210\u6210\u529f\uff0c\u83b7\u5f97\uff1a"+t),chapter.addFormula(e[0].define.id,e[1].define.id,1),e[0].remove(),e[1].remove()};this.playForgeAnimation(e,o.bind(this))}else o=function(){if(e[0].remove(),e[1].remove(),e[0].weaponTeam||e[1].weaponTeam){var t;(t=e[0].weaponTeam?e[0].weaponTeam:e[1].weaponTeam).weaponLvl++,t.hpBar.setLevel(t.weaponLvl),t.updateHpMax(!0),t.resetAvatarState(),cc.log("weaponTeam upgrade",t.weaponLvl);var i=this.getEmptyWeaponTeamForgeBlock(),a=this.forgeDisplay.node;this.addItem(i,{id:t.weapon,weaponTeam:t,lvl:t.weaponLvl},a.convertToWorldSpaceAR(cc.v2(200,230)),function(){cc.game.emit("forgeItemFinish")})}else a=this.forgeDisplay.node,this.addBagItem(e[0].define.id,e[0].lvl+1,a.convertToWorldSpaceAR(cc.v2(200,230)))},this.playForgeAnimation(e,o.bind(this))}},getItemCtor:function(e){return cc.log("getItemCtor",e),ItemDefine[e].ctor||o},initBagBlocks:function(){var e=this.bagUI.getComponent("bottomUI");this.bagBlocks=e.init(this,{checkCB:this.checkSuitableBlocks.bind(this)})},initTankBlocks:function(){this.tankBlocks=[];for(var e=0;e<=this.tankStack-1;e++){var t=new cc.Node;this.tank.getChildByName("back").addChild(t),t.scale=1/ANIME_SCALE;var i=t.addComponent(a),n=this.getTankBlockPos(+e+1),o={blockType:"tank",x:n.x-40/ANIME_SCALE,y:n.y+50/ANIME_SCALE};i.init(this,o),this.tankBlocks.push(i),this.tankData[e]&&this.addWeaponTeam(i,this.tankData[e],!0)}this.updateBenchOperator(),this.initLeader(),this.initRepairTank()},updateTankBlocks:function(){for(var e in this.tankBlocks){var t=this.getTankBlockPos(+e+1);this.tankBlocks[e].updatePosition(t.x-40/ANIME_SCALE,t.y+50/ANIME_SCALE)}},initLeader:function(){var e=this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).attachUtil;e.generateAttachedNodes("chezhang");var t=e.getAttachedNodes("chezhang")[0];t.cman=menuManager.createArmature("operator/laosiji","laosiji",function(e,t){t.playAnimation("stand")}),t.cman.scale=.65/ANIME_SCALE,t.addChild(t.cman),t.cman.x=0,t.cman.y=0,t.cman.angle=-90},updateBenchOperator:function(){var e=this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).attachUtil;e.generateAttachedNodes("cman1"),e.generateAttachedNodes("cman2"),e.generateAttachedNodes("cman3"),e.generateAttachedNodes("cman4"),e.generateAttachedNodes("man1"),e.generateAttachedNodes("man2"),e.generateAttachedNodes("man3"),e.generateAttachedNodes("man4"),this.tank.getChildByName("lower").zIndex=111;var t=kit.clone(this.operatorList);console.log("updateBenchOperator operatorList",t);for(var i=0;i<this.tankBlocks.length;i++)if(this.tankBlocks[i].content){var a=this.tankBlocks[i].content.operator;cc.log("used operator",a),(r=t.indexOf(a))>=0&&(cc.log("used operator splice",r),t.splice(r,1))}for(this.idleOperator=t,console.log("updateBenchOperator",this.idleOperator),i=1;i<=4;i++)this.tank["cman"+i]&&(this.tank["cman"+i].active=!1),this.tank["man"+i]&&(this.tank["man"+i].active=!1);var n=this.idleOperator.length,o=1;for(i=1;i<=this.idleOperator.length;i++)if(this.idleOperator[i-1]){for(var r="cman",s=null,c=o;c<=this.tankBlocks.length;c++)if(!this.tankBlocks[c-1].content){s=(r="man")+c,o=c+1,n--;break}s||(s=r+n,n--);var l=e.getAttachedNodes(s)[0];if(l&&this.idleOperator[i-1]){var d=this.idleOperator[i-1],h=ENTITY[d].avatar;this.tank[s]?(this.tank[s].active=!0,this.effectMgr.loadArmature(this.tank[s].armatureDisplay,h.anime,function(e,t){t.playAnimation("stand")},h.animeName),this.tank[s].operator=this.idleOperator[i-1]):(this.tank[s]=menuManager.createArmature(h.anime,h.animeName,function(e,t){t.playAnimation("stand")}),this.tank[s].scale=.65/ANIME_SCALE,l.addChild(this.tank[s]),this.tank[s].x="man"==r?-3:0,this.tank[s].y=0,this.tank[s].angle=-90,this.tank[s].operator=this.idleOperator[i-1]),cc.log("boneIndex",s)}}},addWeaponTeam:function(e,t,i){var a=0;for(var n in this.tankBlocks)if(!this.tankBlocks[n].content&&(a++,e==this.tankBlocks[n]))break;var o,r=a&&this.idleOperator.splice(a-1,1)[0],s=t.operator||r,c=new cc.Node,l=this.getItemCtor("weaponTeam"),d=c.addComponent(l);if(o=null!=t.hp?t.hp:null,d.init(this,ItemDefine.weaponTeam,{hp:o,block:e,weapon:t.weapon,operator:s,weaponLvl:t.weaponLvl,equipment:t.equipment}),!i){this.effectMgr.playEffect("sound/checkpoint/set_weapon");var h=this.effectMgr.createAnimation("checkpoint/addWeapon/jiaziguang",{repeat:1,speed:1.4});h.scale=.9*ANIME_SCALE,h.x-=10,h.anchorY=.25,c.addChild(h)}return this.onWeaponTeamChange(),this.updateBattleBottomUI(),d},getBagItem:function(e){return this.bagUI.getComponent("bottomUI").getBagItem(e)},getBagItemById:function(e){return this.bagUI.getComponent("bottomUI").getBagItemById(e)},addBagItem:function(e,t,i,a,n){var o=this.bagUI.getComponent("bottomUI").addBagItem(e,t,i,a,"",n);return"weapon"==ItemDefine[e].type&&this.battleBottomUI.getComponent("battleBottomUI").enableBag(0,!0),"equipment"==ItemDefine[e].type&&this.battleBottomUI.getComponent("battleBottomUI").enableBag(1,!0),"material"==ItemDefine[e].type&&this.battleBottomUI.getComponent("battleBottomUI").enableBag(2,!0),o},getTankBlockPos:function(e){var t=this.tank.scale,i=this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).armature().getBone("gun"+e),a=i.global.x*t,n=i.global.y*t,o=this.tank.convertToWorldSpaceAR(cc.v2(a,n));return cc.log("getTankBlockPos",o.x,o.y),{x:.85*a,y:.85*n}},checkBlocks:function(e,t,i){if(i){for(var a in this.tankBlocks)if(i.checkCollision(e,t,this.tankBlocks[a]))return!0;if(i.content&&i.content.constructor!=n)for(var a in console.log("checkBlocks bagBlocks",this.bagBlocks),this.bagBlocks)if(cc.log("checkCollision",1),i.checkCollision(e,t,this.bagBlocks[a]))return cc.log("checkCollision",2),!0;if("weaponTeamForge"!=i.blockType||!this.preventPutWeaponTeamForge)for(var a in this.forgeBlocks)if(i.checkCollision(e,t,this.forgeBlocks[a]))return!0;if(this.weaponTeamForgeBlocks)for(var a in this.weaponTeamForgeBlocks)if(i.checkCollision(e,t,this.weaponTeamForgeBlocks[a]))return!0;if(this.toCheckBlocks)for(var a in this.toCheckBlocks)if(i.checkCollision(e,t,this.toCheckBlocks[a]))return!0}else cc.log("checkBlocks no block")},addCheckBlock:function(e){this.toCheckBlocks.push(e)},removeCheckBlock:function(e){for(var t in this.toCheckBlocks)if(this.toCheckBlocks[t]==e)return void this.toCheckBlocks.splice(t,1)},enableWeaponTeamInfo:function(t){var i;if(this.weaponTeamInfo.active||(i=!0),this.weaponTeamInfo.active=!0,i&&(this.weaponTeamInfo.x+=600,this.weaponTeamInfo.runAction(cc.moveBy(.2,cc.v2(-600,0)).easing(cc.easeInOut(2)))),this.showingWeaponTeam!=t){for(var a in this.showingWeaponTeam=t,this.weaponTeamInfo.getComponent(e("./WeaponTeamInfo")).init(t,this),this.forgeUI.active=!1,this.startGameNode.active=!1,this.nodesToHideOnForge)this.nodesToHideOnForge[a].active=!1;this.updateSelectFrame()}this.setVehicleFixVisible(!1)},updateSelectFrame:function(){if(this.showingWeaponTeam){var e=this.showingWeaponTeam;this.selectFrame&&this.selectFrame.weaponTeam!=e&&(this.selectFrame.destroy(),this.selectFrame=null),this.selectFrame=e.block.createGuideFrame(e.block),this.selectFrame.weaponTeam=e}else this.selectFrame&&(this.selectFrame.destroy(),this.selectFrame=null)},updateWeaponTeamInfo:function(t){!this.showingWeaponTeam||t&&this.showingWeaponTeam!=t||this.weaponTeamInfo.getComponent(e("./WeaponTeamInfo")).init(this.showingWeaponTeam,this)},closeWeaponTeamInfo:function(){for(var e in this.weaponTeamInfo.active=!1,this.showingWeaponTeam=null,this.forgeUI.active=!0,this.startGameNode.active=!0,this.updateSelectFrame(),this.setVehicleFixVisible(!0),this.nodesToHideOnForge)this.nodesToHideOnForge[e].active=!this.nodesToHideOnForge[e].lock&&!0},startGame:function(){this.startGameButtonEnable&&(this.tankWalkState=this.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).playAnimation("walk",-1),this.tankWalkState2=this.tank.getChildByName("lower").getComponent(dragonBones.ArmatureDisplay).playAnimation("walk",-1),this.tankState=2,this.scheduleOnce(this.startGame2,2),this.setUIEnable(!1),this.effectMgr.playEffect("sound/checkpoint/pop_window"),this.hideVehicleFix())},startGame2:function(){var e=[];for(var t in this.tankBlocks)this.tankBlocks[t].content?e.push(this.tankBlocks[t].content):e.push(null);var i=[],a=[],n=this.args.vehicleConfig,o=[],r=kit.clone(this.operatorList),s=[];for(var t in e){var c=e[t];if(c){var l=c.operator,d=c.weapon,h=ItemDefine[d],u=c.weaponLvl,p=1*Math.pow(4/3,u-1);i.push({s:0,i:l,star:pc.getHero(l)&&pc.getHero(l).star||1}),a.push({atk0:p,hp0:1,lvl:u,equipment:c.equipment,s:0,hp:c.hp,i:h.gameId,m:this.mainOperator==l}),o.push({weapon:d,weaponLvl:c.weaponLvl,operator:l,equipment:c.equipment});var f=r.indexOf(l);f>=0&&r.splice(f,1)}else i.push(null),a.push(null),o.push(null)}for(var t in chapter.data.tank=o,chapter.data.bench=r,this.updateBagData(),r){var m=r[t];s.push({s:0,i:m,star:pc.getHero(m)&&pc.getHero(m).star||1})}cc.log("startGame bench",s),cc.log("startGame towers",a),cc.log("startGame heroes",i),this.args.nextCb&&this.args.nextCb({vid:n.vid,star:n.star,attr:n.attr,towers:a,heroes:i,bench:s,hp:n.hp,cd:n.cd})},updateBagData:function(){var e=[],t=this.bagUI.getComponent("bottomUI").weaponBlocks;for(var i in t)t[i].content&&e.push({id:t[i].content.define.id,lvl:t[i].content.lvl,hp:t[i].content.hp});for(var i in t=this.bagUI.getComponent("bottomUI").equipmentBlocks)t[i].content&&e.push({id:t[i].content.define.id,lvl:t[i].content.lvl});for(var i in t=this.bagUI.getComponent("bottomUI").materialBlocks)t[i].content&&e.push({id:t[i].content.define.id,lvl:t[i].content.lvl});chapter.data.bag=e,cc.log("updateBagData",e)},checkOperatorWeaponTeam:function(e){for(var t in this.tankBlocks){var i=this.tankBlocks[t].content;if(i&&i.operator==e)return i}},onWeaponTeamChange:function(){this.updateBenchOperator(),this.updateVehicleFixShow()},initRepairTank:function(){cc.game.on("add_drop",this.updateRepairTankBtnVisual,this),cc.game.on("use_drop",this.updateRepairTankBtnVisual,this)},updateRepairTankBtnVisual:function(){var e=this.args.vehicleConfig,t=this.getTankRepairPrice(e.hp),i=chapter.get(GOLD);this.tankRepairBtn.getChildByName("price").color=i>=t&&cc.color(255,255,255)||cc.color(255,0,0),this.tankRepairBtn.getChildByName("price").getComponent(cc.Label).string=t,this.tankRepairBtn.active=this.repairMode&&e.hp<1,this.tankRepairBtn.zIndex=222},checkEmpowerTank:function(){if(this.repairMenuNode.getChildByName("\u7ef4\u4fee\u586b\u5145\u5e95").active=!0,!(this.getChapterIndex()<1||1==this.getChapterIndex()&&this.getLevelIndex()<2)&&2!=this.empowerStage)if(1!=this.empowerStage){if(this.repairMenuNode.getChildByName("\u7ef4\u4fee\u586b\u5145\u5e95").active=!1,chapter.data.empowerCt=chapter.data.empowerCt||0,!(chapter.data.empowerCt>=4)){var e=chapter.data.empowerCt+1,t=(1==e?50:2==e&&100)||3==e&&200||400;this.repairMenuNode.getChildByName("1").active=!0,this.repairMenuNode.getChildByName("1").getChildByName("price").getComponent(cc.Label).string=t,this.repairMenuNode.getChildByName("1").getChildByName("price").color=chapter.get(GOLD)>=t&&cc.color(255,255,255)||cc.color(255,0,0)}}else this.enableAdvancedEmpowerTank()},empowerTank:function(){chapter.data.empowerCt=chapter.data.empowerCt||0;var e=chapter.data.empowerCt+1,t=(1==e?50:2==e&&100)||3==e&&200||400;if(chapter.get(GOLD)<t)kit.info("\u91d1\u94b1\u4e0d\u8db3");else{chapter.data.empowerCt++,chapter.add(GOLD,-t,"cp_fix"),this.empowerStage=1,cc.game.emit("use_drop",{tid:"cp_fix",i:GOLD,n:-t}),chapter.data.events.push({eventId:"fix",objectId:"che"}),this.repairMenuNode.getChildByName("1").active=!1,Math.random()<.5?this.enableAdvancedEmpowerTank():this.empowerStage=2;var i=this.tankHpBar.node.convertToWorldSpaceAR(cc.v2(0,0));this.createEmpowerText(20,i)}},empowerTank2:function(){chapter.data.events.push({eventId:"fix3",objectId:"che"});var e=this.tankHpBar.node.convertToWorldSpaceAR(cc.v2(0,0));this.createEmpowerText(30,e)},createEmpowerText:function(e,t){var i=this.node.convertToNodeSpaceAR(t),a=this.effectMgr.createSimpleLabel(i.x,i.y,"\u751f\u547d\u4e0a\u9650\u63d0\u9ad8"+e+"%",30);return a.color=cc.color(0,255,0),a.runAction(cc.sequence(cc.moveBy(.5,cc.v2(0,50)),cc.fadeOut(.5),cc.destroySelf())),this.node.addChild(a),a},enableAdvancedEmpowerTank:function(){this.repairMenuNode.getChildByName("2").active=!0},advancedEmpowerTank:function(){sdk.useFree("empowerTank",function(e){if(!e){for(var t in chapter.data.events.push({eventId:"fix2"}),this.repairMenuNode.getChildByName("2").active=!1,this.empowerStage=2,this.tankBlocks){var i=this.tankBlocks[t].content;if(i){var a=i.node.convertToWorldSpaceAR(cc.v2(0,0));this.createEmpowerText(10,a)}}a=this.tankHpBar.node.convertToWorldSpaceAR(cc.v2(0,0)),this.createEmpowerText(10,a),this.repairMenuNode.getChildByName("\u7ef4\u4fee\u586b\u5145\u5e95").active=!0}}.bind(this))},getTankRepairPrice:function(e){return Math.ceil(200*(1-e))},repairAllWeaponTeam:function(){var e=chapter.get(GOLD),t=this.getRepairAllPrice();if(t>e)kit.info("\u91d1\u94b1\u4e0d\u8db3");else{if(e>=t)for(var i in this.vehicleFixNodes)this.vehicleFixNodes[i].getComponent("checkpointVehicleFix").getRepairPrice()>0&&this.vehicleFixNodes[i].getComponent("checkpointVehicleFix").repair();this.repairTank(),this.updateRepairAllWeaponTeamButtonVisual()}},repairAllWeaponTeam2:function(e){for(var t in this.vehicleFixNodes)this.vehicleFixNodes[t].getComponent("checkpointVehicleFix").repair(null,!0,e);this.updateRepairAllWeaponTeamButtonVisual()},getRepairAllPrice:function(){var e=this.args.vehicleConfig,t=0;for(var i in this.vehicleFixNodes)t+=this.vehicleFixNodes[i].getComponent("checkpointVehicleFix").getRepairPrice();return t+this.getTankRepairPrice(e.hp)},getRepairAllWeaponTeamPrice:function(){this.args.vehicleConfig;var e=0;for(var t in this.vehicleFixNodes)e+=this.vehicleFixNodes[t].getComponent("checkpointVehicleFix").getRepairPrice();return e},repairWeaponTeamWithAD:function(e,t){this.vehicleFixNodes[e].getComponent("checkpointVehicleFix").repairWithAD2(t)},updateRepairAllWeaponTeamButtonVisual:function(){var e=chapter.get(GOLD),t=this.getRepairAllPrice();this.repairAll.getChildByName("price").color=e>=t&&cc.color(255,255,255)||cc.color(255,0,0),this.repairAll.getChildByName("price").getComponent(cc.Label).string=t,this.repairAll.active=t>0},repairTank:function(){var e=this.args.vehicleConfig,t=this.getTankRepairPrice(e.hp);chapter.get(GOLD)<t?kit.info("\u91d1\u94b1\u4e0d\u8db3"):(chapter.add(GOLD,-t,"cp_repair"),cc.game.emit("use_drop",{tid:"cp_repair",i:GOLD,n:-t}),this.repairTank2(1))},repairTank2:function(e){var t;void 0===e&&(e=1);var i=this.args.vehicleConfig;t=i.hp+e>1?1-i.hp:e,t*=this.battleBottomUI.getComponent("battleBottomUI").getCalculatedHpMax();var a=this.effectMgr.createLabel(0,0,"effect/num/number_heal",Math.ceil(t),28),n=this.tankHpBar.node.convertToWorldSpaceAR(cc.v2(0,0));this.node.convertToWorldSpaceAR(n),this.tankHpBar.node.addChild(a),n=a.convertToWorldSpaceAR(cc.v2(0,0)),a.scale=1,a.opacity=255,a.runAction(cc.sequence(cc.delayTime(1),cc.fadeOut(.5),cc.destroySelf()));var o=e;i.hp+=o,i.hp>1&&(i.hp=1),this.tankHpBarObj.hp=i.hp,this.tankHpBar.refresh(),this.updateRepairTankBtnVisual(),this.updateRepairAllWeaponTeamButtonVisual()},getChapterIndex:function(){return this.args.chapterIndex},getLevelIndex:function(){return this.args.mapIndex},getLevelLength:function(){return this.args.mapLength},onPause:function(){var e=this.args.pauseCb;e?e():menuManager.pop("pause",{closeCb:function(e){e&&adventure.chapterFail(null,0)}})},switchEquipmentMode:function(e,t){for(var i in e&&!this.equipmentMode&&this.cancelSpecialMode(),this.equipmentMode=e,this.clearReddot(1==t?"weapon":"equipment"),this.updateReddot(),this.equipmentMode?(this.battleBottomUI.active=!1,this.bagUI.getComponent("bottomUI").enableEquipmentMode(!0,t),this.tabBlockAnimation(1==t?"\u6b66\u5668":"\u914d\u4ef6")):(this.battleBottomUI.active=!0,this.bagUI.getComponent("bottomUI").enableEquipmentMode(!1)),this.nodesToHideOnForge)this.nodesToHideOnForge[i].active=!this.nodesToHideOnForge[i].lock&&!this.equipmentMode;this.enableStartGameButton(!this.equipmentMode)},switchForgeMode:function(e){for(var t in e&&!this.forgeMode&&this.cancelSpecialMode(),this.clearReddot("material"),this.updateReddot(),this.forgeMode=e,this.forgeMode?(this.bagUI.getComponent("bottomUI").enableForgeMode(!0),this.tabBlockAnimation("\u5408\u6210")):this.bagUI.getComponent("bottomUI").enableForgeMode(!1),this.enableStartGameButton(!this.forgeMode),this.nodesToHideOnForge)this.nodesToHideOnForge[t].active=!this.nodesToHideOnForge[t].lock&&!this.forgeMode},switchTrainMerchantMode:function(e){"train"==this.mode&&(e&&!this.trainMerchantMode&&this.cancelSpecialMode(),this.trainMerchantMode=e,e&&!this.trainMerchantFrame.inited&&(this.trainMerchantFrame.inited=!0,this.trainMerchantFrame.getComponent("Merchant").init(this,!0)),this.trainMerchantFrame.active=e)},switchMerchantMode:function(e){for(var t in e&&!this.merchantMode&&this.cancelSpecialMode(),this.merchantMode=e,this.merchantMode?this.bagUI.getComponent("bottomUI").enableMerchantMode(!0):this.bagUI.getComponent("bottomUI").enableMerchantMode(!1),this.enableStartGameButton(!this.merchantMode),this.nodesToHideOnForge)this.nodesToHideOnForge[t].active=!this.nodesToHideOnForge[t].lock&&!this.merchantMode},cancelSpecialMode:function(e,t){this.forgeMode?this.switchForgeMode():this.repairMode?this.switchRepairMode():this.equipmentMode?this.switchEquipmentMode():this.merchantMode?this.switchMerchantMode():this.trainMerchantMode&&this.switchTrainMerchantMode(),this.updateBattleBottomUI(),t&&(this.tabBlockAnimation("\u51fa\u6218"),this.switchTrainMerchantMode(!0))},updateBattleBottomUI:function(){this.updateBagData(),this.initBattleBottomUI(),this.battleBottomUI.getComponent("battleBottomUI").updateItems(),this.battleBottomUI.getComponent("battleBottomUI").refreshWeaponTeamHpBar()},tabBlockAnimation:function(e){var t=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("\u6807\u7b7e\u6ed1\u5757");t.stopAllActions();var i=this.tabNode.getChildByName("tag\u5e95\u7248").getChildByName("label").getChildByName(e);t.runAction(cc.moveTo(.3,cc.v2(i.x,t.y)).easing(cc.easeOut(5)))},updateBagUIOperator:function(){var e=this.bagUI.getComponent("bottomUI");for(var t in e.weaponTeamForgeFrame){var i=e.weaponTeamForgeFrame[t].getChildByName("mainOperator"),a=this.tankBlocks[t]&&this.tankBlocks[t].content;i&&(a&&a.operator==this.mainOperator?i.active=!0:i.active=!1)}},forgeSuccessMsg:function(e,t){var i=this.effectMgr.createSprite(0,200,"checkpoint/forge/\u5408\u6210\u6210\u529f");this.node.addChild(i);var a=new cc.Node,n=a.addComponent("checkpointAvatar"),o=ItemDefine[e];t=t||ItemDefine[e].lvl,n.init(o,t,this),i.addChild(a),i.scale=0,i.runAction(cc.sequence(cc.scaleTo(.1,1),cc.delayTime(1),cc.fadeOut(.3),cc.destroySelf()))},enableStartGameButton:function(e){var t=this.startGameButton.getChildByName("\u524d\u8fdb"),i=this.startGameButton.getChildByName("\u7bad\u5934");e?(t.opacity=255,t.runAction(cc.sequence(cc.blink(.3,4),cc.delayTime(5)).repeatForever()),i.runAction(cc.sequence(cc.moveBy(.5,cc.v2(30,-20)),cc.moveBy(.5,-30,20)).repeatForever())):(i.y=55.79,i.x=0,i.stopAllActions(),t.opacity=0,t.stopAllActions()),this.startGameButtonEnable=e,e?this.onLoadAd():this.onDestroyAd()},showJoystick:function(e){this.joystick.active=!0,this.scheduleOnce(function(){this.joystick.active=!1},e||3)}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../managers/EffectManager":"EffectManager","../ui/core/Menu":"Menu","./Background":"Background","./WeaponTeamInfo":"WeaponTeamInfo","./checkPointItem":"checkPointItem","./checkpointEquipment":"checkpointEquipment","./checkpointWeapon":"checkpointWeapon","./itemBlock":"itemBlock","./weaponTeam":"weaponTeam"}],checkpointAvatar:[function(e,t){"use strict";cc._RF.push(t,"a611avz4IdAEZYbf9RErMau","checkpointAvatar"),cc.Class({extends:cc.Component,init:function(e,t,i,a){this.game=i,this.define=e,this.lvl=t||e.lvl||1,this.height=100,this.width=100,this.initBase(a),this.initAvatar()},createSprite:function(e,t,i){var a=new cc.Node;a.x=e,a.y=t;var n=a.addComponent(cc.Sprite);return cc.resources.load(i,cc.SpriteFrame,function(e,t){n.spriteFrame=t}),a},createSimpleLabel:function(e,t,i,a){var n=new cc.Node;n.x=e,n.y=t;var o=n.addComponent(cc.Label);return o.string=i,a&&(o.fontSize=a),n.label=o,n},initBase:function(e){this.base&&this.base.destroy(),this.title&&this.title.destroy();var t=this.lvl,i="weapon"==this.define.type&&"w"+t||"equipment"==this.define.type&&"e"+t||("material"==this.define.type||"misc"==this.define.type)&&"g"+t||"other"==this.define.type&&"o"+t,a=this.createSprite(0,0,i&&"checkpoint/item/"+i);this.node.addChild(a,-1),this.base=a;var n=this.createSimpleLabel(0,-58,this.define.name,17);n.label.enableBold=!0,this.node.addChild(n),n.color=RarityTextColor[t];var o=n.addComponent(cc.LabelOutline);o.width=3,o.color=cc.color(0,0,0),this.title=n,e&&(this.title.active=!1)},initAvatar:function(){this.avatar&&this.avatar.destroy();var e=this.define.avatar,t=ItemTypeDefine[this.define.type],i=.8*(this.define.avatar.scale||t&&t.scale||1);if(e.sprite)a=this.createSprite(0,0,e.sprite),this.node.addChild(a),this.avatar=a;else if(e.anime){var a=menuManager.createArmature(e.anime,e.animeName,function(){});this.node.addChild(a),this.avatar=a,i*=ANIME_SCALE}if(this.avatar.scale=i,cc.log("initAvatar define type",this.define.type,this.define.avatar.anchorY),t&&null!=t.anchorY){var n=t.anchorY;this.avatar.y+=(-.5+n)*this.height}else null!=this.define.avatar.anchorY&&(n=this.define.avatar.anchorY,this.avatar.y+=(-.5+n)*this.height)}}),cc._RF.pop()},{}],checkpointEquipment:[function(e,t){"use strict";cc._RF.push(t,"88d14+Y4gRBk6GYTC6c/yOj","checkpointEquipment"),cc.Class({extends:e("./checkPointItem"),init:function(e,t,i){this._super(e,t,i),this.weaponTeam=i.weaponTeam},remove:function(){this._super(),this.weaponTeam&&(this.weaponTeam.avatarState=null,this.weaponTeam.updateAvatar())},initAvatar:function(){this._super()},addToWeaponTeam:function(e){e&&e.content&&e.content.addEquipment(this.define.id),this.game.effectMgr.playEffect("sound/checkpoint/set_equipment"),this.game.updateWeaponTeamInfo(e.content),this.weaponTeam=e.content},removeFromWeaponTeam:function(e){e&&e.content&&e.content.removeEquipmentById(this.define.id),e&&this.game.updateWeaponTeamInfo(e.content),this.weaponTeam=null},addToBank:function(e){this.weaponTeam=null,chapter.data.bank[e].push(this.define.id)},removeFromBank:function(e){var t=chapter.data.bank[this.block.index].indexOf(this.define.id);chapter.data.bank[e].splice(t,1)},onInteract:function(e){var t=e&&e.content;if("weaponTeamForge"==this.block.blockType&&"equipment"==this.block.weaponTeamForgeType){var i=this.game.tankBlocks[this.block.index].content;this.weaponTeam=i}if(!t)return"bag"==e.blockType&&"equipment"!=e.blockType2||"weaponTeamForge"==e.blockType&&"equipment"!=e.weaponTeamForgeType?"cancel":("weaponTeamForge"==this.block.blockType&&"equipment"==this.block.weaponTeamForgeType&&(this.weaponTeam?this.removeFromWeaponTeam(this.weaponTeam.block):this.removeFromBank(this.block.index)),"weaponTeamForge"==e.blockType&&"equipment"==e.weaponTeamForgeType&&((a=this.game.tankBlocks[e.index])&&a.content?this.addToWeaponTeam(a):this.addToBank(e.index)),"move");if("equipment"==t.define.type){if(t==this)return"cancel";if("weaponTeamForge"==this.block.blockType&&"equipment"==this.block.weaponTeamForgeType&&(this.weaponTeam?this.removeFromWeaponTeam(this.weaponTeam.block):this.removeFromBank(this.block.index)),t.define.id!=this.define.id){var a;if(("weaponTeamForge"==e.blockType&&"equipment"==e.weaponTeamForgeType||"weaponTeamForge"==this.block.blockType&&"equipment"==this.block.weaponTeamForgeType)&&("weaponTeamForge"==t.block.blockType&&"equipment"==t.block.weaponTeamForgeType&&(t.weaponTeam?t.removeFromWeaponTeam(t.weaponTeam.block):t.removeFromBank(t.block.index)),"weaponTeamForge"==e.blockType&&"equipment"==e.weaponTeamForgeType&&((a=this.game.tankBlocks[e.index]).content?this.addToWeaponTeam(a):this.addToBank(e.index)),"weaponTeamForge"==this.block.blockType&&"equipment"==this.block.weaponTeamForgeType)){var n=this.game.tankBlocks[this.block.index];n.content?t.addToWeaponTeam(n):t.addToBank(this.block.index)}return cc.log("swap"),"swap"}return this.game.bagUI.getComponent("bottomUI").upgradeItem(e,this)?void 0:"cancel"}return console.log("content"),"cancel"},onSwapt:function(){return!0}}),cc._RF.pop()},{"./checkPointItem":"checkPointItem"}],checkpointOperator:[function(e,t){"use strict";cc._RF.push(t,"232dbmaredP4K/4/NHAXdJZ","checkpointOperator"),cc.Class({extends:e("./checkPointItem"),properties:{},init:function(e,t,i){this.operatorId=i.operatorId,this._super(e,t,i)},remove:function(){this._super()},initAvatar:function(){var e=ENTITY[this.config.operatorId].avatar,t=this.game.effectMgr.createArmature(e.anime,e.animeName,function(){},e.animeName);t.y-=50,this.node.addChild(t),this.avatarName=e.animeName},onInteract:function(e){e&&e.content;var t=this.config.operatorId;if(console.log("operator",1),e==this.block&&!this.game.noOperatorPop)return menuManager.pop("hero_info",{hid:t,refreshCb:function(){}}),"cancel";if(console.log("operator",2,e.blockType),"operator"!=e.blockType)return"cancel";if(this.game.tankBlocks[e.index]&&this.game.tankBlocks[e.index].content,this.game.tankBlocks[this.block.index]&&this.game.tankBlocks[this.block.index].content,this.game.tankBlocks[e.index]&&this.game.tankBlocks[e.index].content)this.setOperator(this.game.tankBlocks[e.index].content,this.operatorId);else if(this.game.tankBlocks[this.block.index]&&this.game.tankBlocks[this.block.index].content)this.setOperator(this.game.tankBlocks[this.block.index].content,this.game.getOperatorIdByIndex(e.index));else{var i=this.operatorId,a=this.game.getOperatorIdByIndex(e.index),n=this.game.operatorList,o=n.indexOf(i),r=n.indexOf(a);n[o]=n.splice(r,1,n[o])[0],this.game.updateBenchOperator()}return console.log("swap operator",3),"swap"},setOperator:function(e,t){var i=[],a=e&&e.operator;for(var n in this.game.operatorList)this.game.operatorList[n]!=a&&i.push(this.game.operatorList[n]);var o=this.game.checkOperatorWeaponTeam(t);o&&(o.operator=e.operator,o.updateOperator()),e.operator=t,e.updateOperator(),this.game.mainOperator==a&&(this.game.mainOperator=t),this.game.updateBenchOperator(),this.game.updateBagUIOperator()}}),cc._RF.pop()},{"./checkPointItem":"checkPointItem"}],checkpointVehicleFix:[function(e,t){"use strict";cc._RF.push(t,"2e61ffPjudA6b4NVvy9IpOA","checkpointVehicleFix"),cc.Class({extends:cc.Component,properties:{addStackNode:cc.Node,repairNode:cc.Node,repairNode2:cc.Node,armatureNode:cc.Node,addWeaponTeamNode:cc.Node,goldFrame:cc.Node,silverFrame:cc.Node},init:function(e,t){this.index=t,this.game=e,this.setVisible(!0),this.updateVisual(),cc.game.on("add_drop",this.updateVisual,this),cc.game.on("use_drop",this.updateVisual,this),e.noCheckStack||this.initStack()},setVisible:function(e){this.node.active=!this.hide&&e},setHide:function(){this.hide=!0,this.setVisible(!1)},setTrainMode:function(){this.trainMode=!0},initStack:function(){if(this.index==chapter.data.stack+1){var e=this.game.dajiazi.node,t=this.game.getTankBlockPos(this.index-1),i=this.game.tank.convertToWorldSpaceAR(cc.v2(t.x*ANIME_SCALE,t.y*ANIME_SCALE)),a=this.game.dajiazi.node.parent.convertToNodeSpaceAR(i);e.x=a.x-39,e.y=a.y-5,this.game.dajiazi.playAnimation("in",1)}},getStackPrice:function(){var e=100*chapter.data.stack;return this.trainMode&&(e=5*chapter.data.stack),e},getRepairPrice:function(e){if(!e){var t=this.game.tankBlocks[this.index-1]&&this.game.tankBlocks[this.index-1].content;if(!t||0==t.hp)return 0;var i=t&&ItemDefine[t.weapon].gameId,a=i&&(t.getHpMax()||ENTITY[i].hp);e=t.hp/a}return Math.ceil(100*(1-e))},updateVisual:function(){if(!this.hide){var e=this.game.tankBlocks[this.index-1]&&this.game.tankBlocks[this.index-1].content;cc.log("updateVisual",this.index-1,e),cc.log("updateVisual",!this.game.repairMode,!this.game.stackAdded,this.index==chapter.data.stack+1,chapter.data.stack<this.game.maxStack),this.addStackNode.active=!this.game.repairMode&&!this.game.stackAdded&&this.index==chapter.data.stack+1&&chapter.data.stack<this.game.maxStack,console.log("updateVisual addStackNode active",this.index,this.addStackNode.active);var t=this.getStackPrice(),i=chapter.get(GOLD);if(this.trainMode&&(i=chapter.get(SILVER),this.silverFrame.active=!0,this.goldFrame.active=!1,this.repairNode.active=!1,this.repairNode2.active=!1),this.addStackNode.getChildByName("price").color=i>=t&&cc.color(255,255,255)||cc.color(255,0,0),this.addStackNode.getChildByName("price").getComponent(cc.Label).string=t,this.addWeaponTeamNode.active=this.index<chapter.data.stack+1&&this.game.tankBlocks[this.index-1]&&!this.game.tankBlocks[this.index-1].content,console.log("updateVisual addWeaponTeamNode active",this.index,this.index<chapter.data.stack+1,this.game.tankBlocks[this.index-1]&&!this.game.tankBlocks[this.index-1].content),!this.trainMode){var a=e&&ItemDefine[e.weapon].gameId,n=a&&(e.getHpMax()||ENTITY[a].hp);console.log("updateVisual gameId and hp",a,n),n&&e&&e.hp<n&&this.game.repairMode?0==e.hp?(this.repairNode.active=!1,this.repairNode2.active=!0):(this.repairNode.active=!0,this.repairNode2.active=!1,t=this.getRepairPrice(e.hp/n),this.repairNode.getChildByName("price").getComponent(cc.Label).string=t,this.repairNode.getChildByName("price").color=i>=t&&cc.color(255,255,255)||cc.color(255,0,0)):(this.repairNode.active=!1,this.repairNode2.active=!1)}}},repair:function(e,t,i){void 0===i&&(i=1);var a=this.game.tankBlocks[this.index-1]&&this.game.tankBlocks[this.index-1].content;if(a){var n=a&&ItemDefine[a.weapon].gameId,o=n&&(this.game.tankBlocks[this.index-1].content.getHpMax()||ENTITY[n].hp),r=this.getRepairPrice(a.hp/o);if(chapter.get(GOLD)<r&&!t)kit.info("\u91d1\u94b1\u4e0d\u8db3");else{if(t||(chapter.add(GOLD,-r,"cp_repair2"),cc.game.emit("use_drop",{tid:"cp_repair2",i:GOLD,n:-r})),this.game.tankBlocks[this.index-1]&&this.game.tankBlocks[this.index-1].content){var s;s=a.hp+i>1?1-a.hp:i,s*=a.getCalculatedHpMax();var c=this.game.effectMgr.createLabel(0,0,"effect/num/number_heal",Math.ceil(s),28);a.node.addChild(c),c.scale=0,c.opacity=255,c.label.spacingX=-5,c.runAction(cc.sequence(cc.scaleTo(.01,1,1),cc.moveBy(.5,kit.rnd(-20,20),kit.rnd(50,80)).easing(cc.easeElasticOut()),cc.fadeOut(.2),cc.recycle())),o=Math.min(a.hp+i,1),this.game.tankBlocks[this.index-1].content.setHp(o)}this.updateVisual(),this.game.updateRepairAllWeaponTeamButtonVisual(),a.block.needFix&&(a.block.needFix.destroy(),a.block.needFix=null)}}},repairWithAD:function(){sdk.useFree("repair1",function(e){e||this.repair(null,1)}.bind(this))},repairWithAD2:function(e){sdk.useFree("repair2",function(t){t||(this.repair(null,1),e&&e())}.bind(this))},tipsForDeploy:function(){},onWeaponTeamMove:function(){this.game.updateVehicleFixShow(),this.game.updateBenchOperator()},onAnimeEventComplete:function(){this.game.updateVehicleFixShow(),this.game.setUITouchable(!0)},addStack:function(){var e=this.getStackPrice(),t=this.trainMode&&SILVER||GOLD;if(chapter.get(t)<e)kit.info("\u91d1\u94b1\u4e0d\u8db3");else{chapter.add(t,-e,"cp_stack"),cc.game.emit("use_drop",{tid:"cp_stack",i:t,n:-e}),chapter.data.stack++,this.game.tankStack=chapter.data.stack,this.updateVisual(),this.game.setUITouchable(!1);var i=this,a=this.game.dajiazi;if(a){var n=a.node;a.playAnimation("action",1),a.addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){"drop"==e.name&&i.addStack2()},this),a.addEventListener(dragonBones.EventObject.COMPLETE,i.onAnimeEventComplete,i)}var o=this.game.getTankBlockPos(this.index-1),r=this.game.tank.convertToWorldSpaceAR(cc.v2(o.x*ANIME_SCALE,o.y*ANIME_SCALE)),s=this.game.dajiazi.node.parent.convertToNodeSpaceAR(r);n.x=s.x-39,n.y=s.y-5,this.game.battleBottomUI.getComponent("battleBottomUI").updateStack(),this.game.initBattleBottomUI()}},addStack2:function(){for(var e=this.game,t=1;t<=4;t++){var i=e.tank.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).armature().getBone("jiazi"+t);i.visible=t<e.tankStack,i.invalidUpdate()}t=e.tankStack;var a=new cc.Node;e.tank.getChildByName("back").addChild(a),a.scale=1/ANIME_SCALE;var n=a.addComponent("itemBlock"),o=e.getTankBlockPos(+t),r={blockType:"tank",x:o.x-40/ANIME_SCALE,y:o.y+50/ANIME_SCALE};n.init(e,r),e.tankBlocks.push(n),e.updateBenchOperator(),this.game.stackAdded=!0}}),cc._RF.pop()},{}],checkpointWeapon:[function(e,t){"use strict";cc._RF.push(t,"b73d9UGLBBDi5TManZNsfWO","checkpointWeapon"),cc.Class({extends:e("./checkPointItem"),init:function(e,t,i){this._super(e,t,i),this.weaponTeam=i.weaponTeam,this.hp=i.hp||1,this.updateHpLabel()},updateHpLabel:function(){if(this.hp>=1)this.hpLabel&&(this.hpLabel.active=!1);else{var e=Math.ceil(100*this.hp),t=this.hp>.66&&cc.color(0,255,0)||this.hp>.33&&cc.color(255,255,0)||cc.color(255,0,0);if(this.hpLabel)(i=this.hpLabel).active=!0,i.label.string=e+"%";else{var i;(i=this.game.effectMgr.createSimpleLabel(80/ANIME_SCALE,0,e+"%",36)).label.enableBold=!0,i.color=t;var a=i.addComponent(cc.LabelOutline);a.width=3,a.color=cc.color(0,0,0),i.scale=1/ANIME_SCALE,this.avatar.addChild(i)}}},setHp:function(e){this.hp=e,this.updateHpLabel()},remove:function(){this._super(),this.weaponTeam&&(this.weaponTeam.avatarState=null,this.weaponTeam.updateAvatar())},onSwapt:function(e){return!this.weaponTeam||"forge"==this.block.blockType&&"forge"==e.block.blockType},addWeaponTeam:function(e){var t=this.game.tankBlocks[e.index],i=chapter.data.bank[e.index],a=this.game.addWeaponTeam(t,{weapon:this.define.id,weaponLvl:this.lvl,equipment:i,hp:this.hp});this.weaponTeam=a},removeWeaponTeam:function(e){var t=this.game.tankBlocks[e.index];chapter.data.bank[e.index]=t.content.equipment,this.weaponTeam=null,t.content.remove(),this.game.updateBenchOperator(),this.game.updateVehicleFixShow()},setWeaponTeam:function(e){this.game.tankBlocks[e.index],e.content.setWeapon(this.define.id,this.lvl,this.hp)},onInteract:function(e){var t,i=e&&e.content;return i?"weapon"==i.define.type?i==this?"cancel":i.define.id!=this.define.id||i.lvl!=this.lvl?(("weaponTeamForge"==e.blockType&&"weapon"==e.weaponTeamForgeType||"weaponTeamForge"==this.block.blockType&&"weapon"==this.block.weaponTeamForgeType)&&(i.weaponTeam=!1,this.weaponTeam=!1,"weaponTeamForge"==e.blockType&&"weapon"==e.weaponTeamForgeType&&(t=this.game.tankBlocks[e.index]).content&&this.setWeaponTeam(t),"weaponTeamForge"==this.block.blockType&&"weapon"==this.block.weaponTeamForgeType&&(t=this.game.tankBlocks[this.block.index]).content&&i.setWeaponTeam(t)),cc.log("swap"),"swap"):5==i.lvl?"cancel":("weaponTeamForge"==this.block.blockType&&"weapon"==this.block.weaponTeamForgeType&&this.removeWeaponTeam(this.block),void this.game.bagUI.getComponent("bottomUI").upgradeItem(e,this)):"cancel":"bag"==e.blockType&&"weapon"!=e.blockType2||"weaponTeamForge"==e.blockType&&"weapon"!=e.weaponTeamForgeType?"cancel":("weaponTeamForge"==this.block.blockType&&"weapon"==this.block.weaponTeamForgeType&&this.removeWeaponTeam(this.block),"weaponTeamForge"==e.blockType&&"weapon"==e.weaponTeamForgeType&&this.addWeaponTeam(e),"move")}}),cc._RF.pop()},{"./checkPointItem":"checkPointItem"}],chooseBonus:[function(e,t){"use strict";cc._RF.push(t,"5a8e3efpI1HfYD6v5Di6Jj2","chooseBonus");var i=e("../../Plugins/firebase/FirebaseTracking");cc.Class({extends:e("../ui/core/PopMenu"),properties:{switchNodes:[cc.Node],switchBg:cc.Node,eventBoards:[cc.Node],eventNode:cc.Node,titleFrames:[cc.SpriteFrame],titleSprite:cc.Sprite,btnBoard:cc.Node,lootBtnNode:cc.Node,videoBtnNode:cc.Node},onLoad:function(){},onDestroy:function(){this.onDestroyAd(),cc.game.emit("onChooseBonusClose",{menu:this})},start:function(){cc.game.emit("onChooseBonusPop",{menu:this})},initStatus:function(e){this.args=e;var t=this.game=e.game;for(var i in this.chapterIndex=e.chapterIndex,this.eventNode.active=!1,this.node.opacity=0,this.fading=!0,this.node.runAction(cc.sequence(cc.delayTime(2.5),cc.fadeIn(.5),cc.callFunc(function(){for(var e in t&&(t.layer.hidePauseBtn(!1),t.layer.hideOtherBtn(!1),t.layer.joystick.setEnabled(!1)),this.switchNodes)this.switchNodes[e].runAction(cc.sequence(cc.delayTime(.2*e),cc.spawn(cc.moveBy(.5,300,0),cc.fadeIn(.5)).easing(cc.easeElasticOut(1))))},this),cc.delayTime(.7),cc.callFunc(function(){this.fading=!1,this.checkGuide(),cc.game.emit("onChooseBonusPop",{menu:this}),this.onLoadAd()},this))),this.switchNodes){var a=this.switchNodes[i];a.x-=300,a.opacity=0}this.onLoot()},checkGuide:function(){var e=this.chapterIndex,t=this.getLevelIndex();0==e&&(1==t&&cc.game.on("onChooseBonusPop",this.guideChooseBonusMoney,this),2==t&&(this.maxStack=2,cc.game.on("onChooseBonusPop",this.guideChooseBonusItem,this))),1==e&&(1==t&&cc.game.on("onChooseBonusPop",this.guideChooseBonusItem2,this),2==t&&(cc.game.on("onChooseBonusPop",this.guideChooseBonusMoney2,this),cc.game.on("onChooseEventPop",this.guideChooseEvent2,this)),3==t&&cc.game.on("onChooseBonusPop",this.guideChooseBonusEvent,this))},guideChooseBonusMoney:function(e){var t=e.menu;this.fixMoney=168,TJ.onGuideEvent({guide_id:10,guide_name:"\u4e09\u9009\u4e001"}),menuManager.focusOn(t.switchNodes[0],"\u8f66\u957f\uff01\u8fd9\u91cc\u53ef\u4ee5\u641e\u94b1\uff01\u5feb\u628a\u8fd9\u7834\u8f66\u4fee\u4e00\u4fee\uff01",function(){TJ.onGuideEvent({guide_id:11,guide_name:"\u4e09\u9009\u4e001-\u9009\u62e9"})},null,null,{dx:-150}),this.bonusClick=function(){TJ.onGuideEvent({guide_id:12,guide_name:"\u4e09\u9009\u4e001-\u70b9\u51fb"})},this.videoClick=function(e){var t=[{i:DIAMOND,n:168}];menuManager.pop("video_guide",{title:"\u6307\u6325\u5b98\u7684\u8d60\u793c",items:t,checkCb:function(a){if(a)return sdk.useFree("guide_bonus_1",function(a){a||net.updateData({items:t},function(a,n){i.FirebaseTracking.setDataBiRes("RewardAds_ChooseBonus"),money.update(n),menuManager.close(),menuManager.pop("show",{items:t,checkCb:function(){e()}})})}),!0;e()}})}},guideChooseBonusItem:function(e){var t=this,i=e.menu;this.fixItem=[{id:"flame_thrower",lvl:1}],this.game.layer.bottomUI.getItemTypeCt("weapon")<1&&this.fixItem.push({id:"flame_thrower",lvl:1}),TJ.onGuideEvent({guide_id:23,guide_name:"\u4e09\u9009\u4e002"}),menuManager.focusOn(i.switchNodes[1],"\u989d\uff0c\u6211\u4e5f\u53ef\u4ee5\u6218\u6597\uff0c\n\u6211\u4eec\u770b\u770b\u53ef\u4ee5\u641e\u5230\u4ec0\u4e48\u6b66\u5668\u5427\uff1f",function(){TJ.onGuideEvent({guide_id:24,guide_name:"\u4e09\u9009\u4e002-\u9009\u62e9"})},null,null,{head:"h99",dx:-150}),this.bonusClick=function(){TJ.onGuideEvent({guide_id:25,guide_name:"\u4e09\u9009\u4e002-\u70b9\u51fb"})},this.videoClick=function(e){var i="flame_thrower";menuManager.pop("video_guide",{title:"\u6b66\u5668\u8dc3\u5347!",head:"h99",gear:i,checkCb:function(a){if(a)return sdk.useFree("guide_bonus_2",function(a){a||(menuManager.close(),chapter.data.bag=[{id:i,lvl:3},{id:i,lvl:3}],t.game.layer.bottomUI.addBagItem(i,3,cc.v2(cc.winSize.width/2-100,cc.winSize.height/2)),t.game.layer.bottomUI.addBagItem(i,3,cc.v2(cc.winSize.width/2+100,cc.winSize.height/2)),e())}),!0;e()}})}},guideChooseBonusEvent:function(e){var t=e.menu;TJ.onGuideEvent({guide_id:68,guide_name:"\u4e09\u9009\u4e005"}),menuManager.focusOn(t.switchNodes[2],"\u563b\u563b\uff0c\u8f66\u957f\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5347\u7ea7\u54b1\u4eec\u6218\u8f66\u7684\u5fc5\u6740\uff01",function(){TJ.onGuideEvent({guide_id:69,guide_name:"\u4e09\u9009\u4e005-\u9009\u62e9"})},null,null,{head:"h99",dx:-150})},guideChooseBonusItem2:function(e){var t=this,i=this.game.layer.bottomUI,a=e.menu;this.fixItem=[{id:"ac",lvl:1}],i.itemBags[1].itemCt<1&&(this.fixItem=[{id:"ac",lvl:1},{id:"ac",lvl:1}]),TJ.onGuideEvent({guide_id:47,guide_name:"\u4e09\u9009\u4e003"}),menuManager.focusOn(a.switchNodes[1],"\u8fd9\u6b21\u6211\u4eec\u518d\u641c\u641c\u770b\u6709\u4ec0\u4e48\u597d\u4e1c\u897f\uff1f",function(){TJ.onGuideEvent({guide_id:48,guide_name:"\u4e09\u9009\u4e003-\u9009\u62e9"})},null,null,{head:"h99",dx:-150}),this.bonusClick=function(){TJ.onGuideEvent({guide_id:49,guide_name:"\u4e09\u9009\u4e003-\u70b9\u51fb"})},this.videoClick=function(e){var i="ac";menuManager.pop("video_guide",{title:"\u914d\u4ef6\u8dc3\u5347!",gear:i,checkCb:function(a){if(a)return i="ac3",sdk.useFree("guide_bonus_3",function(a){a||(menuManager.close(),chapter.data.bag=[{id:i},{id:i}],t.game.layer.bottomUI.addBagItem(i,3,cc.v2(cc.winSize.width/2-100,cc.winSize.height/2)),t.game.layer.bottomUI.addBagItem(i,3,cc.v2(cc.winSize.width/2+100,cc.winSize.height/2)),e())}),!0;e()}})}},guideChooseBonusMoney2:function(e){var t=e.menu;TJ.onGuideEvent({guide_id:58,guide_name:"\u4e09\u9009\u4e004"}),menuManager.focusOn(t.switchNodes[0],"\u641e\u94b1\u641e\u94b1\uff0c\u6211\u4eec\u53ef\u662f\u9ad8\u5854\u6218\u8f66\uff01\u4eba\u591a\u5854\u9ad8\uff01",function(){TJ.onGuideEvent({guide_id:59,guide_name:"\u4e09\u9009\u4e004-\u9009\u62e9"})},null,null,{dx:-150})},guideChooseEvent2:function(e){var t=e.menu;menuManager.focusOn(t.bonusButton,"\u53cc\u500d\uff01\u53cc\u500d\uff01",function(){},null,null,{dx:-150})},getLevelIndex:function(){return this.args.mapIndex},selectMoney:function(e){this.goPop(e.target,"money")},selectItem:function(e){this.goPop(e.target,"item")},selectSkill:function(e){this.goPop(e.target,"skill")},goPop:function(e,t){if(!this.fading&&!this.selected){for(var i in this.selected=!0,this.type=t,cc.log("goPop",t),this.switchNodes){var a=this.switchNodes[i];a.stopAllActions(),e===a?a.runAction(cc.sequence(cc.moveTo(.3,0,-100).easing(cc.easeInOut(1)),cc.spawn(cc.scaleBy(.3,3),cc.fadeOut(.3)))):a.runAction(cc.spawn(cc.scaleTo(.2,.5),cc.fadeOut(.2)))}this.switchBg.runAction(cc.sequence(cc.delayTime(.2),cc.fadeOut(.2))),this.eventNode.active=!0,this.eventNode.opacity=0,this.bonusClick&&this.setGray(this.videoBtnNode,!0),this.eventNode.runAction(cc.sequence(cc.delayTime(.4),cc.fadeIn(.2),cc.callFunc(function(){this.bonusClick&&menuManager.focusOn(this.lootBtnNode,"",this.bonusClick)},this))),this.step=0,this.moneyNum=0,this.itemList=[],this.iconList=[],this.moneyList=[],this.skillList=[],this.initBonus(this.eventBoards[0])}},addItemIcon:function(e,t,i){var a=new cc.Node;e.addChild(a);var n=a.addComponent("checkpointAvatar"),o=ItemDefine[t];i=i||ItemDefine[t].lvl,n.init(o,i,this.game),"weapon"==o.type?(a.zIndex=-2e3-i,a.width=120):"equipment"==o.type?(a.zIndex=-1e3-i,a.width=100):(a.zIndex=-i,a.width=80),a.height=100,this.iconList.push(a)},initBonus:function(e){if(cc.log("initBonus",this.type),"money"==this.type){this.titleSprite.spriteFrame=this.titleFrames[0];var t=[{c:1,node:"1",range:[50,99],str:["\u4e00\u756a\u641c\u5bfb\uff0c\u53ea\u6709\u8fd9\u4e48\u53ef\u601c\u7684\u4e00\u4e01\u70b9\u513f\u2026\u2026","\u771f\u662f\u5565\u4e5f\u522e\u4e0d\u51fa\u6765\u4e86\u2026\u2026"]},{c:1,node:"2",range:[100,149],str:["\u4e0d\u77e5\u7528\u4e86\u4ec0\u4e48\u624b\u6bb5\uff0c\u6536\u83b7\u7adf\u7136\u76f8\u5f53\u53ef\u89c2\uff1f","\u4e00\u756a\u52b3\u4f5c\u2026\u2026\u5f04\u4e86\u8fd9\u4e48\u591a\uff1f"]},{c:1,node:"3",range:[150,200],str:["\u53d1\u73b0\u654c\u4eba\u9690\u85cf\u7684\u5927\u7b14\u94b1\u8d22\uff01","\u529f\u592b\u4e0d\u8d1f\u6709\u5fc3\u4eba\uff0c\u662f\u4e00\u5927\u7b14\uff01"]}],i=kit.rndOneC(t),a=kit.rndInt(i.range[0],i.range[1]);this.fixMoney&&(i=t[2],a=this.fixMoney);var n=pc.talentGlobal;n.money4bonus&&(a+=n.money4bonus),this.moneyNum+=a;var o=cc.instantiate(cc.find("money/"+i.node,this.eventNode));e.addChild(o);var r=i.str[this.step];o.getChildByName("label").getComponent(cc.Label).string=a,o.getChildByName("msg").getComponent(cc.Label).string=kit.replaceString(r,{n:a}),this.moneyList.push({num:a,ui:o})}else if("item"==this.type){this.titleSprite.spriteFrame=this.titleFrames[1];var s=excel.read("chapter_task")[0],c=this.args.fixItem||ItemDrop.getDropsFromExcelData(this.chapterIndex,s);this.fixItem&&(c=this.fixItem);var l=pc.talentGlobal;if(l.item4bonus&&Math.random()<l.item4bonus){var d=ItemDrop.getItemFromExcelData(this.chapterIndex,s);d&&c.push(d)}var h=cc.instantiate(cc.find("item/1",this.eventNode));for(var u in e.addChild(h),c){var p=c[u];this.itemList.push(p),this.addItemIcon(h,p.id,p.lvl)}}else if("skill"==this.type){this.titleSprite.spriteFrame=this.titleFrames[2];var f=[{c:1,node:"1",evenId:"skill_power1",str:"\u4f60\u6539\u9020\u4e86\u8f7d\u5177\u6838\u5fc3, \u5fc5\u6740\u6280\u5a01\u529b\u63d0\u5347 20%"},{c:1,node:"2",evenId:"skill_power2",str:"\u4f60\u6539\u9020\u4e86\u8f7d\u5177\u6838\u5fc3, \u5fc5\u6740\u6280\u5a01\u529b\u63d0\u5347 30%"},{c:1,node:"3",evenId:"skill_power3",str:"\u4f60\u6539\u9020\u4e86\u8f7d\u5177\u6838\u5fc3, \u5fc5\u6740\u6280\u5a01\u529b\u63d0\u5347 40%"},{c:1,node:"2",evenId:"skill_cd",str:"\u4f60\u6539\u9020\u4e86\u8f7d\u5177\u6838\u5fc3, \u5fc5\u6740\u6280\u51b7\u5374\u65f6\u95f4\u52a0\u5feb 25%"},{c:1,node:"2",evenId:"skill_combo",str:"\u4f60\u6539\u9020\u4e86\u8f7d\u5177\u6838\u5fc3, \u5fc5\u6740\u6280\u8fde\u53d1\u6982\u7387\u63d0\u5347 25%"}],m=pc.talentGlobal;m.skill4bonus&&(f[2].c+=5*m.skill4bonus);var g=[];for(var v in f){var y=f[v],b=y.evenId,k=EVENTS[b];if(k.max){var T=0;for(var _ in chapter.data.events)chapter.data.events[_].eventId==b&&T++;T<k.max&&g.push(y)}else g.push(y)}var w=kit.rndOneC(g);this.skillList.push(w);var E=cc.instantiate(cc.find("skill/"+w.node,this.eventNode));e.addChild(E),E.getChildByName("msg").getComponent(cc.Label).string=w.str}this.step++},onLoot:function(){var e=this;if(this.eventNode.active=!1,"money"==this.type){var t=this.moneyNum;for(var i in chapter.add(GOLD,t,"choose3"),this.moneyList)cc.game.emit("add_drop",{pos:this.moneyList[i].ui.convertToWorldSpaceAR(cc.v2(0,0)),tid:"choose3",i:GOLD,n:this.moneyList[i].num})}else if("item"==this.type)for(var a=0;a<this.itemList.length;a++){var n=this.itemList[a],o=n.id,r=n.lvl;if(this.game){var s=this.iconList[a].convertToWorldSpaceAR(cc.v2(0,0));this.game.layer.bottomUI.addBagItem(o,r,s)}chapter.data.bag.push({id:o,lvl:r});var c=ItemDefine[o]&&ItemDefine[o].type;c&&chapter.data.reddot[c]++}else if("skill"==this.type)for(var l in this.skillList){var d=this.skillList[l].evenId;chapter.data.events.push({eventId:d})}var h=function(){cc.warn("doneCb"),e.node.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(){var e=this.args.hideCb;e&&e()},e),cc.delayTime(2),cc.callFunc(function(){this.close();var e=this.args.nextCb;e&&e()},e)))};this.videoClick?this.videoClick(h):h()},onAdd:function(e){var t=this;sdk.useFree("choose_bonus_"+this.type,function(i){i||(e.target.active=!1,t.initBonus(t.eventBoards[1]))})}}),cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../ui/core/PopMenu":"PopMenu"}],define:[function(e,t){"use strict";cc._RF.push(t,"a6c084Mx5VGvp7Yg1tdP5KK","define"),e("./ids"),window.CORE_VERSION=29,window.NET_FRAME_RATE=100,window.GAME_TIME_SCALE=1,window.LOCAL_FRAME=30,window.STEP_RATE=3,window.STEP_TIME=1/30,window.BOX2D_TIME=.04,window.SHADOW_OPEN=1,window.BODY_DEFINE={},window.ENTITY={},window.WEAPON_DEFINE={},window.WEAPON_TABLE={},window.ZORDER={BACKGROUND:-100,NORMAL:5,EFFECT0:10,MOB:100,HERO:200,FLY:300,BULLET:300,EFFECT:400,TOP:500,UI:600},window.AURA_SCALE=2.4,window.ULT_SCALE=1.3,cc._RF.pop()},{"./ids":"ids"}],dmgType:[function(e,t){"use strict";var i,a,n,o,r,s,c,l;for(var d in cc._RF.push(t,"046743a3hZPwI7n8FIgBZpy","dmgType"),window.MOB_TYPE={ground:5,air:6},window.ARMOR_TYPE={human:1,machine:2,building:3,bullet:4},window.WEAPON_TYPE=((i={human:1,machine:2,building:3,ground:4,air:5})[FIRE_GUN]=6,i[CANNON_GUN]=7,i),window.DMG_TYPE={blt:1,explode:2,fire:3,crash:9,platform:10},window.DMG_SCALE={},DMG_SCALE[WEAPON_TYPE.human]=((a={})[ARMOR_TYPE.human]=1,a),DMG_SCALE[WEAPON_TYPE.machine]=((n={})[ARMOR_TYPE.machine]=1,n),DMG_SCALE[WEAPON_TYPE.building]=((o={})[ARMOR_TYPE.building]=1,o),DMG_SCALE[WEAPON_TYPE.ground]=((r={})[MOB_TYPE.ground]=1,r),DMG_SCALE[WEAPON_TYPE.air]=((s={})[MOB_TYPE.air]=1,s),DMG_SCALE[WEAPON_TYPE[FIRE_GUN]]=((c={})[MOB_TYPE.human]=1,c[MOB_TYPE.bullet]=1,c),DMG_SCALE[WEAPON_TYPE[CANNON_GUN]]=((l={})[MOB_TYPE.machine]=1,l[MOB_TYPE.building]=1,l),WEAPON_TYPE){for(var h in ARMOR_TYPE)DMG_SCALE[WEAPON_TYPE[d]][ARMOR_TYPE[h]]||(DMG_SCALE[WEAPON_TYPE[d]][ARMOR_TYPE[h]]=1);for(var u in MOB_TYPE)DMG_SCALE[WEAPON_TYPE[d]][MOB_TYPE[u]]||(DMG_SCALE[WEAPON_TYPE[d]][MOB_TYPE[u]]=1)}cc._RF.pop()},{}],dropEffect:[function(e,t){"use strict";cc._RF.push(t,"f1044jOfQxEJKME/B72AvAJ","dropEffect"),EFFECT.pickDrop=function(e){e.shadow&&(e.shadow.stopAllActionsVS(),e.shadow.runActionVS(cc.fadeOut(.01))),e.aura&&(e.aura.stopAllActionsVS(),e.aura.runActionVS(cc.fadeOut(.01))),e.stopDisplayActions(),e.runDisplayAction(cc.sequence(cc.scaleTo(.1,.7),cc.fadeOut(.05)))},EFFECT.removeDrop=function(e){e.shadow&&e.shadow.runActionVS(cc.fadeOut(.1)),e.aura&&e.aura.runActionVS(cc.fadeOut(.1)),e.node.stopAllActionsVS(),e.node.runActionVS(cc.spawn(cc.scaleTo(.3,.2),cc.fadeOut(.3)))},EFFECT.blinkDrop=function(e){e.node.runActionVS(cc.sequence(cc.fadeTo(.1,255),cc.delayTime(.1),cc.fadeTo(.1,100)).repeatForever())},EFFECT.floatDrop=function(e){var t=this.createSprite(0,0,"avatar/drop/aura");e.addChild(t,-30),t.setScale(4*e.auraScale/e.getScale()),t.color=e.define.color,e.aura=t,e.runDisplayAction(cc.sequence(cc.scaleBy(1.2,1.2),cc.scaleBy(.9,1/1.2)).repeatForever()),e.runDisplayAction(cc.sequence(cc.moveBy(1.2,0,5),cc.moveBy(.9,0,-5)).repeatForever())},EFFECT.coinDrop=function(e){var t=this.createSprite(0,0,"avatar/drop/gold_light");e.addChild(t,30),t.setScale(2),t.angle=-45;var i=kit.rnd(1,1.5);t.runActionVS(cc.sequence(cc.spawn(cc.fadeTo(.5*i,200),cc.scaleTo(.5*i,1)),cc.spawn(cc.fadeTo(.7,255),cc.scaleTo(.7,2))).repeatForever()),e.displayNode.angle=kit.rnd(0,360),e.runDisplayAction(cc.rotateBy(kit.rnd(1,1.5),360).repeatForever());var a=e.obj.config.dropped||0,n=(i=kit.rnd(1,1.5),e.node);n.opacity=0,n.scale=.2,n.runActionVS(cc.rotateBy(1*i,720).easing(cc.easeOut(2))),n.runActionVS(cc.sequence(cc.delayTime(a),cc.spawn(cc.fadeIn(.02*i),cc.scaleTo(.25*i,4).easing(cc.easeQuadraticActionOut())),cc.scaleTo(.25*i,1).easing(cc.easeQuadraticActionIn()),cc.scaleTo(.3*i,2.5).easing(cc.easeJump()),cc.scaleTo(.1*i,1.5).easing(cc.easeJump()),cc.scaleTo(.05*i,1.2).easing(cc.easeJump())))},EFFECT.jumpDrop=function(e){var t=kit.rnd(1,1.5),i=e.obj.config.dropped||0;e.shadow&&(e.shadow.opacity=0,e.shadow.runActionVS(cc.sequence(cc.delayTime(i+1*t),cc.fadeIn(.1)))),e.aura&&(e.aura.opacity=0,e.aura.runActionVS(cc.sequence(cc.delayTime(i+1*t),cc.fadeIn(.1))));var a=e.node;a.opacity=0,a.scale=.2,a.runActionVS(cc.sequence(cc.delayTime(i),cc.spawn(cc.fadeIn(.02*t),cc.scaleTo(.25*t,2).easing(cc.easeQuadraticActionOut())),cc.scaleTo(.25*t,1).easing(cc.easeQuadraticActionIn()),cc.scaleTo(.3*t,1.5).easing(cc.easeJump()),cc.scaleTo(.1*t,1.2).easing(cc.easeJump())))},EFFECT.attackBuff=function(e){var t=e.obj.avatar,i=this.createParticle(0,0,"attack_buff");t.addChild(i,10);var a=i.particleSystem;return a.positionType=cc.ParticleSystem.PositionType.GROUPED,i.remove=function(){a.autoRemoveOnFinish=!0,a.stopSystem()},i},cc._RF.pop()},{}],effect:[function(e,t){"use strict";cc._RF.push(t,"d37c2hZvYBMSoGjoLU8fY3+","effect"),EFFECT.null=function(){},EFFECT.slowMotion=function(e,t,i){cc.log("EFFECT.slowMotion");var a=this.game,n=this.layer;if(!a.slowMotionSprite){var o=this.createSprite(0,0,"white_block",[1,1,1,1]);n.addToUI(o,-100),o.opacity=255,o.scale=1,o.width=cc.winSize.width,o.height=cc.winSize.height;var r=this.createSprite(e.node.x+cc.winSize.width,0,"white_block",[1,1,1,1]);e.node.parent.addChild(r,-100),r.opacity=0,r.color=cc.color(0,0,0),r.scale=2,r.width=3*cc.winSize.width,r.height=cc.winSize.height,r.runAction(cc.sequence(cc.fadeTo(.2,128),cc.delayTime(t),cc.fadeOut(.3),cc.recycle()));var s=this.createAnimation("effect/ult/dazhao",{speed:120,repeat:1});s.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,s.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,s.scale=1.5*ANIME_SCALE,s.y=50,e.node.addChild(s);var c=0;return o.update=function(e){var t=this.node;(c+=1*e)>=1&&t.remove()},o.remove=function(){this.sprite.unschedule(this.update),this.recycleFunc(),a.setTimeScale(1),delete a.slowMotionSprite,i&&i(),cc.audioEngine.resumeAllEffects()},o.reset=function(){this.sprite.schedule(this.update),this.timeScale=.01,this.runAction(cc.sequence(cc.fadeTo(.1,255),cc.fadeOut(.3))),a.setTimeScale(this.timeScale),a.slowMotionSprite=this},cc.audioEngine.pauseAllEffects(),this.playEffect("sound/player/ult"),o.reset(),o}a.slowMotionSprite.reset(!0)},EFFECT.preUltDamage=function(e){if(e){var t=this.createAnimation("effect/ult/hit1",{speed:2,repeat:1});t.scale=2*ANIME_SCALE,t.x=e.node.x,t.y=e.node.y,this.layer.addToCamera(t,ZORDER.EFFECT)}},RES.win=["effect/\u80dc\u5229",{anime:"qizhi"}],EFFECT.winBomb=function(e){var t=this.createSprite(e.x,e.y+300,"effect/\u80dc\u5229");return this.layer.addToCamera(t,ZORDER.EFFECT),t.scale=0,t.runActionVS(cc.sequence(cc.scaleTo(.3,5),cc.spawn(cc.fadeOut(.3),cc.scaleTo(.3,10)))),t},EFFECT.mainTower=function(e){var t=this.createSprite(-50,-15,"avatar/\u4e3b\u653b\u624b");e.addChild(t,-1),t.setScale(1),t.setAnchorPoint(.5,0);var i=this.createSprite(-90,50,"avatar/\u4e3b\u9009\u70ae\u53f0");return t.addChild(i),i.active=!1,t.show=function(){i.x-=100,i.active=!0,i.runAction(cc.sequence(cc.moveBy(.5,cc.v2(100,0)).easing(cc.easeElasticOut(2)),cc.delayTime(1),cc.fadeOut(.5)))},t.show(),t},EFFECT.death=function(e,t){e.node.runActionVS(cc.sequence(cc.delayTime(t>.2?t-.2:0),cc.fadeOut(t>.2?.2:t)))},EFFECT.fadeIn=function(e){e.node.opacity=0,e.node.runActionVS(cc.fadeIn(.1))},RES.starLight=["effect/star/blink"],EFFECT.starLight=function(e,t){for(var i=0;i<15;i++){var a=this.createSprite(e+kit.rnd(-20,20),t+kit.rnd(-110,120),"effect/star/blink");this.layer.addToCamera(a,ZORDER.EFFECT),a.angle=kit.rnd(0,360),a.opacity=255,a.scale=1,a.color=cc.Color(254,250,133),a.runActionVS(cc.sequence(cc.delayTime(.2),cc.fadeOut(kit.rnd(.1,1.2)),cc.recycle())),a.runActionVS(cc.spawn(cc.rotateBy(1,kit.rnd(-100,100)),cc.moveBy(kit.rnd(.5,1),kit.rnd(-15,15),kit.rnd(-25,45)),cc.scaleTo(kit.rnd(.1,1),kit.rnd(.1,.4))))}},RES.ninjaSmoke=["effect/explosion/smoke"],EFFECT.ninjaSmoke=function(e,t){for(var i=0;i<5;i++){var a=this.createSprite(e+kit.rnd(-10,10),t+25*(i-2),"effect/explosion/smoke");this.layer.addToCamera(a,ZORDER.EFFECT),a.angle=kit.rnd(0,360),a.opacity=255,a.scale=1,a.runActionVS(cc.sequence(cc.delayTime(.2),cc.fadeOut(.4),cc.recycle())),a.runActionVS(cc.spawn(cc.rotateBy(1,kit.rnd(-100,100)),cc.moveBy(1,kit.rnd(-50,50),kit.rnd(-50,50))))}},EFFECT.buff=function(e){for(var t=e.obj.avatar,i=function e(i){i.setScale(kit.rnd(1,2),10),i.setPosition(t.x+kit.rnd(-100,100),t.y+kit.rnd(-120,-30));var a=kit.rnd(.2,.3);i.runActionVS(cc.sequence(cc.moveBy(a,0,200),cc.scaleTo(.2*a,i.scaleX,0),cc.callFunc(function(){i.ct++,i.ct>1?i.recycleFunc():e(i)},this)))},a=0;a<5;a++){var n=this.createSprite(0,0,"white_block");this.layer.addToCamera(n,2),n.color=cc.color(255,255,0),n.opacity=255,n.ct=0,i(n)}},EFFECT.deathHide=function(e){e.setVisible(!1)},EFFECT.keepFlyDeath=function(e){e.obj.fly=!0},EFFECT.openBox=function(e){e.rttNode.active=!1;var t=this.createSprite(0,0,"avatar/box_open");e.addChild(t)},EFFECT.blockDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=1*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,2,{scale:.7})},EFFECT.PrisonerDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=1*ANIME_SCALE,t.x=e.x,this.layer.addToCamera(t,ZORDER.EFFECT),e.cage.active=!1,EFFECT.DropShards.call(this,e.x,e.y,50,2,[{res:"avatar/prison/a",scale:.7},{res:"avatar/prison/b",scale:.7},{res:"avatar/prison/c",scale:.7},{res:"avatar/prison/d",scale:.7},{res:"avatar/prison/e",scale:.7}])},EFFECT.PrisonerSpecialDeath=function(e){e.setVisible(!1);var t=e.define,i=this.createArmature(t.anime||"operator/xiaoxiong",t.animeName||"xiaoxiong",function(){});i.scale=.6,i.scaleX=-.6,i.x=e.x,i.y=e.y,i.y=e.y-50;var a=this.game.levelMgr.heroes[1],n=chapter.data.stack,o=cc.bezierTo(.7,[cc.v2(i.x,i.y),cc.v2((a.x+i.x)/2,a.y+200+100*n),cc.v2(a.x-20,a.y+100*n)]).easing(cc.easeInOut(2));i.runAction(cc.sequence(cc.delayTime(1.2),o,cc.destroySelf())),this.layer.addToCamera(i,ZORDER.EFFECT),EFFECT.DropShards.call(this,e.x,e.y,50,2,[{res:"avatar/prison/a",scale:.7},{res:"avatar/prison/b",scale:.7},{res:"avatar/prison/c",scale:.7},{res:"avatar/prison/d",scale:.7},{res:"avatar/prison/e",scale:.7}])},EFFECT.radioDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=1*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT);var i=1300,a=300;e.obj.applyVelocity(a,i),e.rttNode.runAction(cc.rotateBy(.5,360).repeatForever());var n=this;e.schedule(function(){e.obj.vy<=0&&e.obj.y<=n.game.contactMgr.findGroundLine(e.obj.x)+e.obj.height&&(a/=3,i/=3,e.obj.applyVelocity(a,i),e.displayNode.runAction(cc.fadeOut(.5)))})},EFFECT.simpleDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=1*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1);var i=e.define.frm,a=e.define.scale||1;EFFECT.DropShards.call(this,e.x,e.y,0,1,{scale:a,res:i})},EFFECT.sandbagDeath=function(e){var t;(t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1})).color=cc.color(238,217,168),t.angle=kit.rnd(0,360),t.scale=1.5*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),(t=this.createAnimation("effect/hit/qiqiuzha",{speed:2,repeat:1})).color=cc.color(238,217,168),t.scale=2*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1)},EFFECT.firepitDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.color=cc.color(238,217,168),t.angle=kit.rnd(0,360),t.scale=1.5*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),EFFECT.DropShards.call(this,e.x,e.y,50,2,[{scale:.7,res:"effect/shard/\u8089"},{scale:.7,res:"effect/shard/\u6728\u5757"},{scale:.7,res:"effect/shard/\u6728\u5757"}]),e.setVisible(!1)},EFFECT.blockDeathBig=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=2*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,6,{scale:1})},EFFECT.structureDeath=function(e){var t=this.createAnimation("avatar/smoke3",{speed:1,repeat:1});t.x=e.x,t.y=e.y,t.scale=1*ANIME_SCALE,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.woodStructureDeath=function(e){var t=this.createAnimation("avatar/smoke3",{speed:1,repeat:1});t.x=e.x,t.y=e.y,t.scale=1*ANIME_SCALE,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,2,{res:"effect/shard/4"}),EFFECT.DropShards.call(this,e.x,e.y,50,2)},EFFECT.ironStructureDeath=function(e){var t=this.createAnimation("avatar/smoke3",{speed:1,repeat:1});t.x=e.x,t.y=e.y,t.scale=1*ANIME_SCALE,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,3,[{res:"effect/shard/\u94c1\u7ba1"},{res:"effect/shard/iron"},{res:"effect/shard/\u788e\u7247A"}]),EFFECT.DropShards.call(this,e.x,e.y,50,2)},EFFECT.railCarDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:2,repeat:1});t.scale=2*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.AlertLine=function(e,t,i){var a=t.deg,n=this.createSprite(t.x,t.y,"bullet/missile/alert_line",null,function(){});return n.scaleX=100,n.angle=a,n.runAction(cc.sequence(cc.blink(2,4),cc.callFunc(function(){i(e,t,!0)},n),cc.destroySelf())),this.layer.addToCamera(n,ZORDER.EFFECT),n},EFFECT.DropShards=function(e,t,i,a,n,o){var r;void 0===n&&(n={}),void 0===o&&(o=!1),n.constructor==Array&&(r=n);for(var s=1;s<=a;s++){r&&(n=o?r[kit.rndInt(0,r.length-1)]:r[(s-1)%r.length]);var c=kit.rnd(-Math.PI/4,Math.PI/4),l=kit.rnd(0,i);e+=l*Math.sin(c),t+=l*Math.sin(c);var d=n.res,h=n.scale||1;EFFECT.DropShard.call(this,e,t,c,{scale:h,res:d})}},EFFECT.DropShard=function(e,t,i,a){void 0===a&&(a={}),i=i||0,i+=kit.rnd(-Math.PI/10,Math.PI/10);var n=this.createSprite(e,t,a.res||"effect/shard/"+kit.rndInt(1,3));n.angle=a.angle||kit.rnd(-0,360),n.scale=a.scale||1,n.scaleX=a.scaleX||a.scale||1,this.layer.addToCamera(n,ZORDER.EFFECT);var o=kit.rnd(1280,1540)*(a.speed||1),r=o*Math.sin(i),s=o*Math.cos(i),c=a.fadeTime||1;n.runAction(cc.sequence(cc.delayTime(c),cc.fadeOut(.5),cc.destroySelf())),n.sprite.schedule(function(e){s-=2e3*e,n.x+=r*e,n.y+=s*e});var l=a.rotateSpd||1;return n.runAction(cc.rotateBy(kit.rnd(.3,.5),360*l).repeatForever()),n},EFFECT.humanDeath=function(e){if(Math.random()<.3){var t=e.displayNode.getComponent(dragonBones.ArmatureDisplay).armature();if(!t)return;var i=t.getBone("hat");i&&(i.visible=!1),EFFECT.DropShard.call(this,e.x,e.y+20,kit.rnd(-Math.PI/16,Math.PI/16),{fadeTime:.5,rotateSpd:kit.rnd(.5,1.5),scale:.18,speed:.6,res:"avatar/mob/gangkui"}),this.playEffect("sound/mob/soldier/headshot",null,.3),e.obj.vy-=350,e.obj.vx+=150}},EFFECT.slimeDeath=function(e){e.setVisible(!1);var t=this.createAnimation("effect/mob/slime_dead/liquid",{speed:1,repeat:1});t.x=e.x,t.y=e.y,t.scale=1*ANIME_SCALE,this.layer.addToCamera(t,ZORDER.EFFECT-1)},EFFECT.bigHumanDeath=function(e){e.setForcedAnime("dead",2,null,1),e.refresh(.1,!0,!0)},EFFECT.balloonDeath=function(e){var t=this.createAnimation("effect/hit/qiqiuzha",{speed:1,repeat:1});t.scale=1.5*ANIME_SCALE,Math.random()>.5?t.scaleX*=1:t.scaleX*=-1,t.anchorY=.2,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT-1)},EFFECT.explosionDeath=function(e){EFFECT.bomb.call(this,e.x,e.y-e.obj.height/2),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.heroDeath=function(e){var t=e.node.getParent().convertToWorldSpaceAR(e.getPosition());e.node.removeFromParent(!1),e.setForcedAnime("fly",1),e.refresh(.1,!0,!0),this.game.layer.addToCamera(e.node,ZORDER.EFFECT),t=this.game.layer.midLayer.convertToNodeSpaceAR(t),e.node.scale=1,e.node.setPosition(t),e.node.runAction(cc.rotateBy(1,kit.rnd(-720,720)));var i=t.x+kit.rnd(-50,400),a=this.game.contactMgr.findGroundLine(i);e.node.runAction(cc.sequence(cc.jumpTo(1,i,a,kit.rnd(100,300),1),cc.callFunc(function(){e.setForcedAnime("dead",1),e.refresh(.1,!0,!0),e.node.angle=0},this)))},EFFECT.heroRevive=function(e){e.node.setPosition(0,0),e.node.stopAllActions(),e.node.scale=1/ANIME_SCALE,e.initBase()},EFFECT.towerDeath=function(e){var t=e.getPosition();EFFECT.bomb.call(this,t.x,t.y-20),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.towerDeath2=function(e){var t=e.getPosition();EFFECT.bomb.call(this,t.x,t.y-20),e.setVisible(!1),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.vehicleExplosion=function(e){var t=e.getPosition();EFFECT.bomb.call(this,t.x,t.y),EFFECT.DropShards.call(this,e.x,e.y,50,4),EFFECT.DropShards.call(this,e.x,e.y+200,50,4,{res:"avatar/backpack/side"}),EFFECT.machineSmokePersist.call(this,e,null,.02)},EFFECT.machineDeath=function(e,t,i,a){a=a||e.y-e.obj.height,EFFECT.bomb.call(this,i||e.x,a),EFFECT.DropShards.call(this,e.x,e.y,50,4)},EFFECT.tankDeath=function(e,t){var i;EFFECT.DropShard.call(this,e.x,e.y,.001,((i={scale:.7,res:"avatar/turret",angle:1,rotateSpd:.1,scaleX:-.7}).scale=.7,i.speed=.8,i.fadeTime=.3,i)),EFFECT.machineDeath.call(this,e,t),e.obj.removeTimer=10,EFFECT.machineSmokePersist.call(this,e,t),e.setForcedAnime(),e.setForcedUpperAnime("dead",2,1),e.setForcedLowerAnime("dead",2,1),e.refresh(.03,!0,!0)},EFFECT.helicopterDeath=function(e,t){var i=this;EFFECT.machineDeath.call(this,e,t),e.obj.removeTimer=10,EFFECT.machineSmokePersist.call(this,e,t,.02),e.schedule(function(){e.y<=i.game.contactMgr.findGroundLine(e.x)+e.obj.height+1&&!e.earthExplode&&(e.earthExplode=!0,EFFECT.machineDeath.call(i,e),e.setVisible(!1))})},EFFECT.spiderDeath=function(e,t){var i=this;EFFECT.machineDeath.call(this,e,t),e.obj.removeTimer=10,e.schedule(function(){e.y<=e.obj.height+150&&!e.earthExplode&&(e.earthExplode=!0,EFFECT.machineDeath.call(i,e,null,e.x+20,e.y-150),e.setVisible(!1))})},EFFECT.machineSmokePersist=function(e){var t=this;if(!e.machineSmokePersist){var i=new cc.Node,a=i.addComponent(cc.Component);e.machineSmokePersist=i,e.node.addChild(i),a.schedule(function(i){if(kit.timer(this,"123",i||.3,i)){var a=e.getPosition(),n=t.createSprite(a.x+.5*kit.rnd(-40,40)+10,a.y+kit.rnd(-10,0),"effect/weapon/overheat");t.layer.addToCamera(n,1),n.color=cc.color(33,33,33),n.scale=.3*kit.rnd(1,1.5),n.angle=kit.rnd(0,360),n.runAction(cc.sequence(cc.spawn(cc.moveBy(2,cc.v2(.5*kit.rnd(-100,100),.5*kit.rnd(522,700))),cc.rotateBy(2,kit.rnd(0,200)),cc.scaleTo(2,.5*kit.rnd(5,6)),cc.fadeOut(kit.rnd(1.5,2))),cc.destroySelf()))}}),i.remove=function(){this.destroy(),e.machineSmokePersist=null}}return e.machineSmokePersist},EFFECT.spinBlt=function(e,t){void 0===t&&(t=1),e.node.runAction(cc.rotateBy(1/t,360).repeatForever())},EFFECT.createFireLight2=function(e,t,i,a,n){var o=this.createSprite(e,t,"item/pickup"),r=o.getComponent(cc.Sprite);r.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,r.dstBlendFactor=cc.macro.BlendFactor.ONE,n=n||8,i=i||2,o.scale=2*i,o.opacity=0,a=a||255;var s=cc.sequence(cc.fadeTo(.004*n,a),cc.scaleTo(.04*n,1*i),cc.fadeOut(.12*n),cc.destroySelf());return o.runActionVS(s),this.layer.addToCamera(o,ZORDER.EFFECT),o},EFFECT.moneyPickedRemove=function(e){this.playEffect("sound/pick_money",null,.15),EFFECT.createFireLight2.call(this,e.x,e.y,8,null,2);for(var t=0;t<=3;t++){var i=Math.random()*Math.PI*2,a=kit.rnd(10,40),n=a*Math.sin(i),o=a*Math.cos(i),r=this.createSprite(e.x+n,e.y+o,"item/pickup"),s=kit.rnd(1,4);r.scale=s;var c=kit.rnd(0,150)/2,l=kit.rnd(.1,.15)*s-c/1500,d=c*Math.sin(i),h=c*Math.cos(i),u=kit.rnd(.05,.1)*s;r.opacity=0,r.runAction(cc.sequence(cc.delayTime(.02*t),cc.fadeIn(.01),cc.spawn(cc.moveBy(l+u/2,cc.v2(d,h)),cc.sequence(cc.delayTime(u),cc.scaleTo(l,0))),cc.recycle()).easing(cc.easeOut(kit.rnd(2,3)))),r.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,r.dstBlendFactor=cc.macro.BlendFactor.ONE,this.layer.addToCamera(r,ZORDER.EFFECT)}},EFFECT.ropeToTop=function(e){var t=this.createSprite(0,115,"avatar/rope");e.addChild(t,-1),t.height=1e3,t.setAnchorPoint(.5,0)},EFFECT.ropeToTop3=function(e){var t=this.createSprite(0,345,"avatar/rope");e.addChild(t,-1),t.height=1e3,t.setAnchorPoint(.5,0)},EFFECT.grenadeBomb=function(e,t,i){return 1==(t>30?2:1)?EFFECT.bomb.call(this,e,t,i):EFFECT.bomb2.call(this,e,t,i)},EFFECT.avatarShock=function(e,t){var i=this.createSprite(50,100,"effect/mob/shock");e.node.addChild(i),i.scale=0,i.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,2),cc.moveBy(.1,cc.v2(0,20))),cc.spawn(cc.scaleTo(.1,1.5),cc.moveBy(.1,cc.v2(0,-20))),cc.delayTime(t||.5),cc.destroySelf()))},EFFECT.avatarPrisoner=function(e){var t=this.createSprite(-50,133,"avatar/prison/help");e.cage.addChild(t),t.scale=2,t.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,4),cc.moveBy(.1,cc.v2(0,20))),cc.spawn(cc.scaleTo(.1,3),cc.moveBy(.1,cc.v2(0,-20))),cc.delayTime(.3)).repeatForever())},EFFECT.chatSomething=function(e,t,i){var a=this.createSprite(50,183,"avatar/chat/"+t);e.node.addChild(a),a.scaleX=0,a.scaleY=0,a.runAction(cc.sequence(cc.spawn(cc.scaleTo(.1,2,2),cc.moveBy(.1,cc.v2(0,20))),cc.spawn(cc.scaleTo(.1,1.5,1.5),cc.moveBy(.1,cc.v2(0,-20))),cc.delayTime(i),cc.destroySelf())),e.chatSomething=a},EFFECT.TowerDeadExplosion=function(e,t){EFFECT.machineDeath.call(this,avatar,t)},EFFECT.bossDeath=function(e){var t=e.obj.removeTimer=4,i=e.obj.define.shapes;i=i?i.concat([{x:0,y:0,radius:e.obj.radius}]):[{x:0,y:0,radius:e.obj.radius}];var a=this,n=Math.floor(t/.2);e.schedule(function(){var t=kit.rndInt(0,i.length-1),n=i[t],o=n.radius,r=e.x+n.x+kit.rnd(-o,o),s=e.y+n.y+kit.rnd(-o,o);EFFECT.bomb.call(a,r,s),EFFECT.DropShards.call(a,r,s,50,3),EFFECT.DropShards.call(a,r,s,50,1,[{res:"effect/shard/\u94c1\u7ba1"},{res:"effect/shard/\u87ba\u4e1d"},{res:"effect/shard/iron"},{res:"effect/shard/\u788e\u7247A"},{res:"effect/shard/\u7834\u76d8"},{res:"effect/shard/\u7834\u5708"}],!0),e.obj.game.layer.shake(5,5)},.2,n),e.scheduleOnce(function(){for(var t in i){var n=i[t],o=n.radius,r=e.x+n.x+kit.rnd(-o,o),s=e.y+n.y+kit.rnd(-o,o);EFFECT.bomb.call(a,r,s,200),EFFECT.DropShards.call(a,r,s,50,4),EFFECT.DropShards.call(a,r,s,50,4,[{res:"effect/shard/\u94c1\u7ba1"},{res:"effect/shard/\u87ba\u4e1d"},{res:"effect/shard/iron"},{res:"effect/shard/\u788e\u7247A"},{res:"effect/shard/\u7834\u76d8"},{res:"effect/shard/\u7834\u5708"}],!0),e.obj.game.layer.shake(15,15)}},t)},EFFECT.createBack=function(e){var t=this.createSprite(0,0,"avatar/\u5e26\u4ed3\u53e3-\u4e0b");return this.layer.addToCamera(t,0),t.setAnchorPoint(.62,.6),t.sprite.scheduleVS(function(){var i=e.node;cc.isValid(i)?(t.setPosition(i.getPosition()),t.active=i.active):t.recycleFunc()}),t},EFFECT.unitShow=function(e){var t=this.createAnimation("effect/mob/chuxian",{speed:2,repeat:1});t.scale=1*ANIME_SCALE,t.x=e.x,t.y=e.y,this.layer.addToCamera(t,ZORDER.EFFECT-1)},EFFECT.BulletSmoke=function(e){e.game;var t,i=this.createSprite(e.x,e.y,"effect/bullet_smoke"),a=i.sprite;i.target=e,i.ox=e.x,i.oy=e.y,t=Math.random()>.5?1:-1,i.scaleX*=-t,i.rdSX=.04*Math.random()+.05,i.setAnchorPoint(.5,1),i.getContentSize();var n=i.getContentSize().height;this.layer.addToCamera(i,999);var o=function(e,t,a){t&&a&&(i.x=t,i.y=a,i.angle=-kit.radian2Degree(kit.vector2Radian(a-i.oy,t-i.ox)));var o=kit.degree2Radian(i.angle);i.x+=1*Math.sin(o),i.y+=1*Math.cos(o),i.scaleX+=i.rdSX;var r=kit.norm(i.x-i.ox,i.y-i.oy);i.scaleY=r/n},r=function(){i.angle=i.target.deg-90,i.x=i.target.x,i.y=i.target.y;var e=kit.norm(i.x-i.ox,i.y-i.oy);i.scaleY=e/n};return a.schedule(r,.01),r(),i.updateSmoke=r,i.remove=function(){this.isEnd||(this.isEnd=!0,i.updateSmoke(),a.schedule(o,.01),i.runAction(cc.sequence(cc.fadeOut(.5),cc.destroySelf())),a.unschedule(r))},i},cc._RF.pop()},{}],elevator:[function(e,t){"use strict";cc._RF.push(t,"6f0b0yAagRJW5eN6Q4sPwOn","elevator"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=(e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),e("../components/visual/Avatar"));e("../ai/behaviors/combat/AISoldier"),e("./Exploder"),ENTITY.elevator={id:"elevator",name:"\u5347\u964d\u68af",avatar:{ctor:i,anime:"mob/diaolan",animeName:"diaolan",s:.8,moveSpd:100,z:ZORDER.HERO+1,effect:EFFECT.ropeToTop},slots:[{x:0,y:-45,w:100,h:20}],deathEffect:EFFECT.structureDeath,fly:1,height:25,radius:60,hitRadius:60,moveSpd:100,weight:50,hp:420,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/units/AIElevator"),moveX:0,moveY:-1,moveTime:3,delayTime:6}},RES.elevator=[{anime:"mob/diaolan"}],ENTITY.elevator3={id:"elevator3",name:"\u5347\u964d\u68af",editor:1,avatar:{ctor:i,anime:"mob/diaolan",animeName:"diaolan3",s:.8,moveSpd:100,z:ZORDER.HERO+1,effect:EFFECT.ropeToTop3},slots:[{x:0,y:-45,w:100,h:20},{x:0,y:73,w:100,h:20},{x:0,y:191,w:100,h:20}],shapes:[{x:0,y:150,radius:60,hitRadius:60},{x:0,y:300,radius:60,hitRadius:60}],deathEffect:EFFECT.structureDeath,fly:1,height:25,radius:60,hitRadius:60,moveSpd:100,weight:50,hp:900,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/units/AIElevator"),moveX:0,moveY:-1,moveTime:3,delayTime:6}},RES.elevator3=[{anime:"mob/diaolan"}],ENTITY.basket={id:"basket",name:"\u540a\u7bee",avatar:{ctor:a,frm:"avatar/\u6d6e\u7a7a\u540a\u7bee",ay:.2,s:.8},float:1,shapes:[{x:0,y:130,radius:80,hitRadius:80}],slots:[{x:0,y:-40,w:100,h:20}],deathEffect:EFFECT.structureDeath,fly:1,height:25,radius:60,hitRadius:60,moveSpd:100,weight:50,hp:420,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/units/AIElevator"),moveX:0,moveY:-1,moveTime:3,delayTime:6}},ENTITY.basket2={id:"basket2",name:"\u68ee\u6797\u7535\u68af",avatar:{ctor:a,frm:"avatar/\u540a\u5e73\u53f0",ay:.2,s:1},shapes:[{x:0,y:130,radius:80,hitRadius:80}],slots:[{x:0,y:-75,w:120,h:10}],deathEffect:EFFECT.structureDeath,fly:1,height:25,radius:60,hitRadius:60,moveSpd:100,weight:50,hp:420,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/units/AIElevator"),moveX:0,moveY:-1,moveTime:.01,delayTime:99}},cc._RF.pop()},{"../ai/behaviors/combat/AISoldier":"AISoldier","../ai/units/AIElevator":"AIElevator","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","./Exploder":"Exploder","./define":"define"}],equipment:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"c658fa6LuBDlYyR3KsKBJAS","equipment");var o=e("../../../../Plugins/firebase/FirebaseTracking").FirebaseTracking,r={version:1,slotCt:6,current:["machine_gun","sniper","fire_thrower","mortar","armor","heal"],items:{machine_gun:{lvl:1,exp:0},sniper:{lvl:1,exp:0},fire_thrower:{lvl:1,exp:0},mortar:{lvl:1,exp:0},armor:{lvl:1,exp:0},heal:{lvl:1,exp:0}}};window.equipment={init:function(){equipment.data=JSON.parse(JSON.stringify(r))},load:function(){equipment.data=this.loadSaveData("equipment_data"),cc.log("equipment_data load",equipment.data)},loadSaveData:function(e){var t=privacy.decodeToJson(e);if(t&&1===t.version)return t},setOnlineData:function(e){var t=e&&e.equipment||{},i=this._buildCurrentEquipment(t),a=this._calculateSlotCount(t),n=this._buildItemsData(t);equipment.data={current:i,slotCt:a,items:n},this.checkUnlockSlotCt(!0),i&&0!==i.length||(console.warn("[Equipment] No equipment found after login, attempting restoration..."),this.restoreDefaultEquipment()),cc.log("equipment setOnlineData AFTER checkUnlockSlotCt",t,equipment.data)},_buildCurrentEquipment:function(e){var t=[];if(console.log("check currentEquipment 1",t),e.current)for(var i in e.current){var a=e.current[i];null!=a&&""!==a&&t.push(a)}else if(!user.countLoginDay)for(var i in r.current)t.push(r.current[i]);t=t.filter(function(e){return null!=e&&""!==e});var n=this._calculateSlotCount(e);return t.length>n&&(console.warn("[Equipment] Initial equipment has",t.length,"items but only",n,"slots. Truncating..."),t=t.slice(0,n)),console.log("check currentEquipment 2",t),t},_calculateSlotCount:function(e){var t=e.slotCt||r.slotCt,i=adventure.stageToChapter(pc.stageIndex),a=pc.stageIndex;return console.log("equipment _calculateSlotCount - Chapter:",i,"Stage:",a,"Base slotCt:",t,"\n",e),i>=4?8:i>=2?7:t},_buildItemsData:function(e){var t={};for(var i in EquipmentDefine)e["lvl_"+i]||e[i]?t[i]={lvl:e["lvl_"+i]||1,exp:e[i]||0}:r.items[i]&&(t[i]={lvl:r.items[i].lvl,exp:0});return t},remove:function(){equipment.data=null,privacy.remove("equipment_data")},save:function(){cc.log("equipment_data save",JSON.stringify(equipment.data))},get:function(e){return equipment.data&&equipment.data[e]||0},getValidEquipmentCount:function(){return equipment.data&&equipment.data.current?equipment.data.current.filter(function(e){return null!=e&&""!==e}).length:0},restoreDefaultEquipment:function(){if(!equipment.data.current||0===equipment.data.current.length||equipment.data.current.every(function(e){return!e})){for(var e=[],t=equipment.data.items||{},i=["machine_gun","bouncing_ball","mortar","armor","fly_shield","heal","cannon","laser","fire_thrower","fuelTank","sniper","electric"],a=0;a<i.length&&e.length<equipment.data.slotCt;a++){var n=i[a];t[n]&&e.push(n)}return e.length>0?(equipment.data.current=e,!0):(console.warn("[Equipment] No unlocked equipment found to restore"),!1)}return!1},getItem:function(e){return equipment.data.items[e]},set:function(e,t){equipment.data[e]=t},add:function(e,t){void 0===t&&(t=1),console.log(equipment.data),equipment.data[e]+=t},reset:function(){equipment.data=JSON.parse(JSON.stringify(r))},addCurrent:function(e){if(console.log("addCurrent",e),this.checkUnlockSlotCt(!0),equipment.data.current=equipment.data.current.filter(function(e){return null!=e&&""!==e}),equipment.data.current.length>=equipment.data.slotCt)return console.warn("[Equipment] Cannot add equipment - already at max capacity:",equipment.data.slotCt),null;equipment.data.current.push(e);var t={},i=equipment.data.slotCt;pc.getChapterIndex()>=4&&i<8&&(i=8,equipment.set("slotCt",8));for(var a=0;a<i;a++)t["equipment.current."+a]=null;for(a=0;a<equipment.data.current.length&&a<i;a++)equipment.data.current[a]&&(t["equipment.current."+a]=equipment.data.current[a]);return t},readyToSave:function(){equipment.toSave=!0},checkSave:function(){equipment.toSave&&(equipment.toSave=!1,equipment.save())},updateCurrentFromDoc:function(e){var t=Object.keys(e).filter(function(e){return e.startsWith("equipment.current.")}).sort(function(e,t){return parseInt(e.split(".")[2])-parseInt(t.split(".")[2])});!t.some(function(e){return e.endsWith(".7")})&&equipment.data.slotCt>=8&&(console.warn("[Equipment] WARNING: Slot 7 (8th slot) missing from server response! SlotCt:",equipment.data.slotCt),e["equipment.current.7"]);for(var a,n=[],o=-1,r=i(t);!(a=r()).done;){var s=a.value,c=parseInt(s.split(".")[2]);o=Math.max(o,c);var l=e[s];null!=l&&""!==l&&n.push(l)}o>=equipment.data.slotCt&&(console.error("[Equipment] ERROR: Server returned equipment in slot",o,"but only",equipment.data.slotCt,"slots available!"),this.checkUnlockSlotCt(!0),7===o&&7===equipment.data.slotCt&&(console.warn("[Equipment] Forcing slot count to 8 due to equipment in slot 7"),equipment.set("slotCt",8))),n.length>equipment.data.slotCt&&(console.warn("[Equipment] WARNING: Equipment array has",n.length,"items but only",equipment.data.slotCt,"slots available. Truncating..."),n=n.slice(0,equipment.data.slotCt)),equipment.data.current=n},removeCurrent:function(e){var t=equipment.data.current.indexOf(e);this.checkUnlockSlotCt(!0),t>=0?(equipment.data.current.splice(t,1),equipment.readyToSave()):console.warn("[Equipment] removeCurrent - item not found:",e);var i={},a=equipment.data.slotCt;pc.getChapterIndex()>=4&&a<8&&(a=8,equipment.set("slotCt",8));for(var n=0;n<a;n++)i["equipment.current."+n]=null;for(n=0;n<equipment.data.current.length&&n<a;n++)equipment.data.current[n]&&(i["equipment.current."+n]=equipment.data.current[n]);return console.log("------------remove Current ",i),i},unlock:function(e){if(!this.data.items[e])return this.data.items[e]={lvl:1,exp:0},equipment.readyToSave(),cc.log("equipment unlock success",e),this.data.items[e]},isUpgradeLvlMax:function(e){if(this.data.items[e]){var t,i=this.data.items[e].lvl,a=EquipmentDefine[e].stat&&i>=EquipmentDefine[e].stat.length;return cc.log("isUpgradeLvlMax  rt,lvl,max\uff1a",a,i,null==(t=EquipmentDefine[e].stat)?void 0:t.length),a}},getUpgradeLvlMax:function(e){if(this.data.items[e])return EquipmentDefine[e].stat&&EquipmentDefine[e].stat.length||0},canAffordUpgradeCost:function(e){if(this.data.items[e]){var t=EquipmentDefine[e].stat&&EquipmentDefine[e].stat[this.data.items[e].lvl-1].exp,i=!t||this.data.items[e].exp>=t;return cc.log("canAffordUpgradeCost  rt,exp,cost\uff1a",i,this.data.items[e].exp,t),i}},upgrade:function(e,t){if(console.log("Update E",e,t),this.data.items[e]){if(!t){var i=this.data.items[e].lvl,a=EquipmentDefine[e].stat&&EquipmentDefine[e].stat[i-1]&&EquipmentDefine[e].stat[i-1].exp||0,n=this.data.items[e].exp,o=this.isUpgradeLvlMax(e),r=!this.canAffordUpgradeCost(e),s=this.getUpgradeLvlMax(e);if(o||r)return o&&cc.log("\u5347\u7ea7\u88c5\u5907\u5df2\u6ee1\u7ea7,id,lvl,max\uff1a",e,i,s),r&&cc.log("\u5347\u7ea7\u88c5\u5907\u788e\u7247\u4e0d\u8db3,id,exp,cost\uff1a",e,n,a),!1;this.data.items[e].exp-=a}return this.data.items[e].lvl+=1,equipment.readyToSave(),this.data.items[e]}},checkUnlockSlotCt:function(e){if(void 0===e&&(e=!0),e){var t=equipment.get("slotCt"),i=pc.getChapterIndex(),a=adventure.stageToChapter(pc.stageIndex);if(t<8)return i>=4||a>=4?equipment.set("slotCt",8):(i>=2||a>=2)&&equipment.set("slotCt",7),!0;cc.log("checkUnlock unlockSlot - already at max",equipment.data,equipment.get("slotCt"))}},checkUnlock:function(){},isLock:function(e){return console.log("check isLock ",e,this.data.items),console.log(!this.data.items[e]),!this.data.items[e]},unlockByName:function(e){var t={};if(EquipmentDefine[e]){EquipmentDefine[e],equipment.readyToSave();var i=this.unlock(e);return i&&(t["equipment.lvl_"+e]=i.lvl,t["equipment."+e]=i.exp,console.log("checkUnlock unlock item",e,i,JSON.stringify(t))),console.log("unlockByName : ",e,this.data),t}},getCost:function(e){if(this.data.items[e]){var t=this.data.items[e].lvl;return cc.log("equipment getCost",e,EquipmentDefine[e].stat),EquipmentDefine[e].stat&&EquipmentDefine[e].stat[t-1]&&EquipmentDefine[e].stat[t-1].cost}},getExpCost:function(e,t){if(this.data.items[e])return t=t||this.data.items[e].lvl,EquipmentDefine[e].stat&&EquipmentDefine[e].stat[t-1]&&EquipmentDefine[e].stat[t-1].exp},getStat:function(e,t,i){if(void 0===i&&(i=0),this.data.items[e]){var a=this.data.items[e].lvl+i,n=EquipmentDefine[e].stat&&EquipmentDefine[e].stat[a-1]&&EquipmentDefine[e].stat[a-1][t]||0;return cc.log("equipment getStat",e,t,i,n),n}},getStats:function(e){if(this.data.items[e]){var t=this.data.items[e].lvl,i=EquipmentDefine[e].stat&&EquipmentDefine[e].stat[t-1];return cc.log("equipment getStats",e,t,i),i}},isTalentOwned:function(e,t){var i=EquipmentDefine[e].talent;if(cc.log("equipment isTalentOwned",e,t),this.data.items[e]){for(var a in i)if(i[a].id==t){var n=this.data.items[e].lvl;if(n>=i[a].unlockLvl)return cc.log("equipment isTalentOwned true",e,t,n,i[a].unlockLvl),!0;cc.log("equipment isTalentOwned false",e,t,n,i[a].unlockLvl)}}else cc.log("isTalentOwned equipmentId not exist",e)},addExp:function(e,t){this.data.items[e]&&(this.data.items[e].exp+=t,cc.game.emit("equipment_exp_change"))},getDisassembleItems:function(e){if(this.data.items[e]){var t=0,i=0;if(1!=this.data.items[e].lvl)for(var a=1;a<=this.data.items[e].lvl;a++)if(1!=a){var n=EquipmentDefine[e].stat;t+=n[a-2].cost,i+=n[a-2].exp}return[{i:GOLD,n:t},{i:EQUIPMENT,id:e,n:i}]}},disassemble:function(e,t){var i,a,n=this;if(this.data.items[e]&&1!=this.data.items[e].lvl){for(var r=0,s=0,c=1;c<=this.data.items[e].lvl;c++)if(1!=c){var l=EquipmentDefine[e].stat;r+=l[c-2].cost,s+=l[c-2].exp}cc.log("equipment disassemble success",e,r,s),net.updateData({add:(i={},i[EQUIPMENT+"."+e]=s,i[GOLD]=r,i),set:(a={},a[EQUIPMENT+".lvl_"+e]=1,a)},function(i,a){i||(o.setDataBiRes("Equipment"),money.update(a),n.data.items[e].lvl=1,n.data.items[e].exp=n.data.items[e].exp+s,cc.log("equipment disassemble online data",e,a,n.data.items[e]),t&&t(),cc.game.emit("equipment_exp_change"),cc.game.emit("add_money",{i:GOLD,n:r}))})}},checkItemWithRarity:function(){for(var e in reward)if(reward[e].i==EQUIPMENT)return!0},getItemFromReward:function(e,t,i){for(var a in void 0===i&&(i=1),cc.log("getItemFromReward \u5df2\u6709\u4e0e\u5956\u52b1",e,t,i,equipment.get("items")),t){var n=t[a];if(n.i==EQUIPMENT)if(n.rarity){var o=0,r=equipment.get("items"),s=n.n*i,c=[];console.log("check r",r);var l=n.rarity,d=!1;for(var h in r)if(EquipmentDefine[h].rarity===l){d=!0;break}for(var u in!d&&l>1&&l--,r)if(EquipmentDefine[u].rarity==l){var p=kit.rndInt(1,100);o+=p,c.push({id:u,power:p})}var f=0;for(var u in c)if(k=Math.floor(c[u].power/o*s)){var m={i:EQUIPMENT,id:c[u].id,n:k};e.push(m),cc.log("getItemFromReward \u968f\u673a\u6389\u843d",c[u].id,k),equipment.addExp(c[u].id,k),f+=k}if(cc.log("getItemFromReward rewardNum alreadyNum rarity rand items",s,f,n.rarity,c,JSON.stringify(e)),f<s&&c.length){var g=Math.floor(s-f),v=c[kit.rndInt(0,c.length-1)].id,y=!1;for(var b in e)if(e[b].id==v){e[b].n+=g,equipment.addExp(e[b].id,g),y=!0;break}y||(m={i:EQUIPMENT,id:v,n:g},e.push(m),equipment.addExp(v,g))}}else{var k;cc.log("getItemFromReward \u6307\u5b9a\u6389\u843d",n.id,k),(k=Math.floor(n.n*i))&&(equipment.addExp(n.id,k),(m=kit.clone(t[a])).n=k,e.push(getRndItem(m)))}else(k=Math.floor(n.n*i))&&((m=kit.clone(t[a])).n=k,e.push(getRndItem(m)))}cc.log("getItemFromReward \u6700\u7ec8 items",e)},checkRandItem:function(e,t,i){void 0===i&&(i=0);var a=equipment.get("items"),n=e,o=kit.core(i);for(var r in t&&(e=kit.clone(e)),e){var s=e[r];if(s.i==EQUIPMENT&&s.rarity){var c=[];for(var l in a)EquipmentDefine[l].rarity==s.rarity&&c.push(l);var d=c[o.rndInt(0,c.length-1)];s.id=d,delete s.rarity}}return cc.warn("checkRandItem",n,e),e},getIdEByName:function(e){var t;return null!=(t={cannon:0,tesla:1,laser:2,fly_shield:3,bouncing_ball:4,fuelTank:5,energyBarrier:6}[e])?t:-1}},window.EquipmentDefine={machine_gun:{excel:1,rarity:1,talent:[{id:"machine_gun_stack_atk",unlockLvl:1},{id:"machine_gun_atkSpd",unlockLvl:3},{id:"machine_gun_critChance",unlockLvl:5},{id:"machine_gun_critBonus",unlockLvl:6}],stat:[{exp:2,atk:0,cost:500},{exp:5,atk:3,cost:500},{exp:10,atk:6,cost:500},{exp:15,atk:9,cost:500},{exp:22,atk:15,cost:500}]},fire_thrower:{excel:1,rarity:2,talent:[{id:"fire_atkScale",unlockLvl:1},{id:"fire_atkSpd",unlockLvl:3},{id:"fire_distance",unlockLvl:5},{id:"fire_3x",unlockLvl:6}]},sniper:{excel:1,rarity:1,talent:[{id:"sniper_chain",unlockLvl:1},{id:"sniper_atkScale",unlockLvl:3},{id:"sniper_crit",unlockLvl:5},{id:"sniper_blt_n",unlockLvl:6}]},mortar:{excel:1,rarity:2,avatarScale:.7,talent:[{id:"mortar_crit",unlockLvl:1},{id:"mortar_crit2",unlockLvl:3},{id:"mortar_atkScale2",unlockLvl:5},{id:"mortar_atkScale",unlockLvl:6}]},armor:{excel:1,rarity:1,stat:[{exp:2,hp:0,armor:1},{exp:5,hp:3,armor:3},{exp:10,hp:6,armor:3},{exp:15,hp:9,armor:4},{exp:22,hp:15,armor:5}],talent:[{id:"atkSpd_from_armor_1",unlockLvl:1},{id:"atkSpd_from_armor_2",unlockLvl:3},{id:"armor_atkSpd",unlockLvl:5},{id:"armor_atkScale",unlockLvl:6}],avatarScale:1.2},heal:{excel:1,rarity:2,talent:[{id:"atk_from_heal_1",unlockLvl:1},{id:"atk_from_heal_2",unlockLvl:3},{id:"heal_atkSpd",unlockLvl:5},{id:"heal_atkScale",unlockLvl:6}]},cannon:{excel:1,unlock7D:1,unlockProgression:0,rarity:2,talent:[{id:"cannon_crit",unlockLvl:1},{id:"cannon_blt_n",unlockLvl:3},{id:"cannon_atkScale",unlockLvl:5},{id:"cannon_blastRadius",unlockLvl:6}]},tesla:{excel:1,unlock7D:1,unlockProgression:0,rarity:3,avatarScale:.6,talent:[{id:"tesla_chain",unlockLvl:1},{id:"tesla_stun",unlockLvl:3},{id:"tesla_vulnerable",unlockLvl:5},{id:"tesla_more_target",unlockLvl:6}]},laser:{excel:1,unlock7D:1,unlockProgression:0,rarity:3,avatarDx:-20,avatarScale:.8,talent:[{id:"laser_atkSpd",unlockLvl:1},{id:"laser_atkScale",unlockLvl:3},{id:"laser_radius",unlockLvl:5},{id:"laser_slow",unlockLvl:6}]},fly_shield:{excel:1,unlock7D:0,unlockProgression:1,rarity:3,avatarScale:.8,talent:[{id:"fly_shield_kb",unlockLvl:1},{id:"fly_shield_range",unlockLvl:3},{id:"fly_shield_vulnerable",unlockLvl:5},{id:"fly_shield_morecrit",unlockLvl:6}]},bouncing_ball:{excel:1,unlock7D:0,unlockProgression:1,rarity:2,avatarDx:10,avatarScale:.8,talent:[{id:"bouncing_ball_more_hit",unlockLvl:1},{id:"bouncing_ball_more_jump",unlockLvl:3},{id:"bouncing_atkScale",unlockLvl:5},{id:"bouncing_double_shot",unlockLvl:6}]},fuelTank:{excel:1,rarity:2,unlock7D:0,unlockProgression:1,talent:[{id:"fuelTank_hpBonus",unlockLvl:1},{id:"fuelTank_healBonus",unlockLvl:3},{id:"fuelTank_quickHeal",unlockLvl:5},{id:"fuelTank_quickHeal2",unlockLvl:6}]},energyBarrier:{rarity:3,excel:1,unlock7D:0,unlockProgression:1,talent:[{id:"energyBarrier_duplicate",unlockLvl:1},{id:"energyBarrier_atkScale",unlockLvl:2},{id:"energyBarrier_dmg",unlockLvl:3},{id:"energyBarrier_affectMultiple",unlockLvl:7}]}},cc._RF.pop()},{"../../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],eventDefine:[function(e,t){"use strict";cc._RF.push(t,"0d56c0HJDtKxJ89CMfgbyuS","eventDefine"),window.EVENTS={fix:{name:"\u5c0f\u4fee",info:"\u4fee\u6210\u4e86!\u8840\u91cf\u6700\u5927\u503c\u63d0\u534720%",attr:[[ADD_SCALE,"hpMax",.2]]},fix2:{name:"\u5927\u4fee",info:"\u4fee\u6210\u4e86!\u8840\u91cf\u6700\u5927\u503c\u63d0\u534710%",attr:[[ADD_SCALE,"hpMax",.1]]},fix3:{name:"\u65e0\u9650\u5217\u8f66\u4fee",info:"\u4fee\u6210\u4e86!\u8840\u91cf\u6700\u5927\u503c\u63d0\u534730%",attr:[[ADD_SCALE,"hpMax",.3]]},skill_power1:{name:"\u6280\u80fd\u5a01\u529b\u5c0f",attr:[[ADD_SCALE,"skillScale",.2]]},skill_power2:{name:"\u6280\u80fd\u5a01\u529b\u4e2d",attr:[[ADD_SCALE,"skillScale",.3]]},skill_power3:{name:"\u6280\u80fd\u5a01\u529b\u5927",attr:[[ADD_SCALE,"skillScale",.4]]},skill_power4:{name:"\u6280\u80fd\u5a01\u529b\u65e0\u9650\u5217\u8f66",attr:[[ADD_SCALE,"skillScale",.5]]},skill_cd:{name:"\u6280\u80fd\u51b7\u5374\u52a0\u901f",max:2,attr:[[ADD_SCALE,"skillCD",.25]]},skill_combo:{name:"\u6280\u80fd\u8fde\u53d1",max:4,attr:[[ADD_SCALE,"skillCombo",.25]]}},cc._RF.pop()},{}],excel:[function(e,t){"use strict";cc._RF.push(t,"39072KxxnlNWYk0k6k79yBw","excel"),e("./ChapterDefine");var i={dataTable:{},configTable:{},loadLocal:function(){},load:function(e){if(i.loaded)e();else{var t=["mob_list"],a=[],n=[],o=[];for(var r in EquipmentDefine)EquipmentDefine[r].excel&&(n.push(r),o.push("equipment_"+r));i.loadMany(["hero_list","hero_1","hero_2","hero_3","hero_4","hero_5","hero_6","hero_7","hero_8","hero_9","hero_upgrade","vehicle_list","vehicle_star_a","vehicle_star_b","vehicle_star_c","vehicle_a","vehicle_b","vehicle_c","mob_a","talent_list","chapter_info"].concat(t).concat(a).concat(["train_0","train_1","train_2","train_3"]).concat(o),function(){i.loadConfig([],function(){for(var r in i.createVehicleData(i.read("vehicle_list")),i.createHeroData(i.read("hero_list")),t)i.createMobData(i.read(t[r]));for(var r in i.createChapterRewardData(i.read("chapter_info")),a)i.createChapterData(i.read(a[r]));for(var r in o)i.createEquipmentData(i.read(o[r]),n[r]);i.loaded=!0,e()})})}},loadMany:function(e,t){var a=0,n=e.length,o=function(){var o=e[r];cc.resources.load("excel/"+o,cc.JsonAsset,function(e,r){if(!e){var s=r.json;i.dataTable[o]=i.getExcelArray(s)}++a>=n&&t()})};for(var r in e)o()},loadConfig:function(e,t){var a=0,n=e.length;if(0!==n){var o=function(){var o=e[r];cc.resources.load("config/"+o,cc.JsonAsset,function(e,r){e?cc.warn("Failed to load config: "+o):(i.configTable[o]=r.json,cc.log("Config loaded: "+o,i.configTable[o])),++a>=n&&t()})};for(var r in e)o()}else t()},readConfig:function(e){return i.configTable[e]},read:function(e){return i.dataTable[e]},getExcelArray:function(e){if(Array.isArray(e[0])){var t=[];for(var i in e[0])t[i]=e[0][i];var a=[];for(i=1;i<e.length;i++){var n={},o=e[i];if(o.length>0){for(var r=0;r<t.length;r++)n[t[r]]=o[r];a.push(n)}}return a}return e},createHeroData:function(e,t){for(var a in e){var n=e[a],o=ENTITY[n.id]=kit.clone(ENTITY[OPERATOR]);o.excelData=n,o.attr=n.attr,o.career=n.career,o.id=n.id,o.name=LI("hero_"+n.id),o.card="ui/hero/card/"+n.id,o.head="ui/hero/head/"+n.id,o.stat=[n.stat1,n.stat2,n.stat3];var r=o.avatar;r.anime=n.anime,r.animeName=n.animeName;for(var s=[],c=[],l=[],d=i.read("hero_"+n.attr),h=0;h<5;h++)s.push(d[h].stat1),c.push(d[h].stat2),l.push(d[h].stat3);o.stat1=s,o.stat2=c,o.stat3=l,t&&t.push(o)}},createVehicleData:function(e,t){for(var a in e){var n=e[a],o={},r=ENTITY[VEHICLE_BASE];for(var s in r)o[s]=r[s];for(var c in o.avatar={},r.avatar)o.avatar[c]=r.avatar[c];if(ENTITY[n.id]=o,o.excelData=n,o.attr=n.attr,o.career=n.career,o.defaultTower=window[n.tower],o.id=n.id,o.name=LI("vehicle_"+n.id),o.radius=n.radius,o.hitRadius=n.hitRadius,o.leftMsg=n.leftMsg,o.rightMsg=n.rightMsg,n.skill&&(o.skill=[SKILL_DEFINE[n.skill]]),n.wheels){var l=n.wheels.split("|");o.wheels=[+l[0],l[1]]}var d=o.avatar;d.anime=n.anime,d.animeName=n.animeName,d.animeName2=n.animeName2;var h=i.read("vehicle_"+n.attr),u=[];for(var p in h){var f=h[p];f.hp_show=f.hp*n.hp,f.hp_tower=f.hp*n.gunHp,f.hp_vehicle=n.hp,(f.atk_all||f.hp_all)&&u.push({atk:f.atk_all,hp:f.hp_all,lvl:f.lvl})}o.attrGlobal=u;for(var m=[],g=[],v=[],y=[],b=i.read("vehicle_star_"+n.attr),k=0;k<9;k++){var T,_;(_=null==(T=b[k])?void 0:T.attr)&&(m.push(kit.parse(_)),g.push(LI("vehicle_"+n.id+"_info_"+k)),v.push(b[k].global),y.push(b[k].price))}if(o.starAttrs=m,o.starInfo=g,o.starGlobal=v,o.starPrice=y,o.towerSlots=kit.clone(r.towerSlots),n.gunX&&n.gunY)for(var w=n.gunX.split("|"),E=n.gunY.split("|"),C=0;C<4;C++)o.towerSlots[C].dx=+w[C]||0,o.towerSlots[C].dy=+E[C]||0;t&&t.push(o)}},createEquipmentData:function(e,t){for(var i in e){var a=e[i],n=EquipmentDefine[t]=EquipmentDefine[t]||{},o=n.stat||[];o[i]=a,delete o[i].lvl,n.stat=o}},createMobData:function(e,t){if(!this.backupEntity)for(var i in this.backupEntity={},e){var a=e[i].type||E_SOLDIOR;this.backupEntity[a]=ENTITY[a]}for(var n in e){var o=e[n],r={},s=this.backupEntity[o.type||E_SOLDIOR];for(var c in s)r[c]=s[c];for(var l in r.avatar={},s.avatar)r.avatar[l]=s.avatar[l];ENTITY[o.id]=r,r.id=o.id,r.name=LI(o.id),r.editor=!0,null!=o.fly&&(r.fly=o.fly),null!=o.hp&&(r.hp=+o.hp),null!=o.atk&&(r.bltDmg=+o.atk,r.bombDmg=+o.atk),null!=o.crash&&(r.crash=+o.crash),null!=o.radius&&(r.radius=+o.radius);var d=r.avatar;null!=o.frm&&(d.frm=o.frm),null!=o.anime&&(d.anime=o.anime),null!=o.animeName&&(d.animeName=o.animeName),null!=o.attackAnime&&(d.attackAnime0=o["anime-attack"]),null!=o.standAnime&&(d.standAnime0=o["anime-stand"]),null!=o.walkAnime&&(d.walkAnime0=o["anime-walk"]),t&&t.push(r)}},createChapterRewardData:function(e){for(var t in e){var i=e[t],a=window.CHAPTER_DEFINE_ARRAY[t];if(i["\u590d\u7528\u7ae0\u8282"]){if(a=window.CHAPTER_DEFINE_ARRAY[t]=kit.clone(window.CHAPTER_DEFINE_ARRAY[i["\u590d\u7528\u7ae0\u8282"]-1]),i["\u5173\u5361\u7cfb\u6570\u52a0\u6210"])for(var n in a.stage){var o=(a.stage[n].lvl+i["\u5173\u5361\u7cfb\u6570\u52a0\u6210"])/a.stage[n].lvl;a.stage[n].lvl+=i["\u5173\u5361\u7cfb\u6570\u52a0\u6210"],a.stage[n].lvl2*=o,a.stage[n].lvl2=Math.floor(10*a.stage[n].lvl2)/10}var r=+t;a.indexName=LI("chapter_n",{n:r+1}),a.repeatFlag=1}if(a){var s=[];i["\u7ed3\u7b97\u91d1\u5e01"]&&s.push({i:GOLD,n:i["\u7ed3\u7b97\u91d1\u5e01"]}),i["\u7ed3\u7b97\u9f7f\u8f6e"]&&s.push({i:EXP,n:i["\u7ed3\u7b97\u9f7f\u8f6e"]}),i["\u7ed3\u7b97\u7eff\u5361"]&&s.push({i:EQUIPMENT,rarity:1,n:i["\u7ed3\u7b97\u7eff\u5361"]}),i["\u7ed3\u7b97\u84dd\u5361"]&&s.push({i:EQUIPMENT,rarity:2,n:i["\u7ed3\u7b97\u84dd\u5361"]}),a.item=s;var c=[],l=[],d=[];i["\u5b9d\u7bb1\u5956\u52b11\u91d1\u5e01"]&&c.push({i:GOLD,n:i["\u5b9d\u7bb1\u5956\u52b11\u91d1\u5e01"]}),i["\u5b9d\u7bb1\u5956\u52b12\u91d1\u5e01"]&&l.push({i:GOLD,n:i["\u5b9d\u7bb1\u5956\u52b12\u91d1\u5e01"]}),i["\u5b9d\u7bb1\u5956\u52b12\u4f53\u529b"]&&l.push({i:ENERGY,n:i["\u5b9d\u7bb1\u5956\u52b12\u4f53\u529b"]}),i["\u5b9d\u7bb1\u5956\u52b13\u94bb\u77f3"]&&d.push({i:DIAMOND,n:i["\u5b9d\u7bb1\u5956\u52b13\u94bb\u77f3"]}),i["\u5b9d\u7bb1\u5956\u52b13\u7eff\u5361"]&&d.push({i:EQUIPMENT,rarity:1,n:i["\u5b9d\u7bb1\u5956\u52b13\u7eff\u5361"]}),i["\u5b9d\u7bb1\u5956\u52b13\u84dd\u5361"]&&d.push({i:EQUIPMENT,rarity:2,n:i["\u5b9d\u7bb1\u5956\u52b13\u84dd\u5361"]}),i["\u5b9d\u7bb1\u5956\u52b13\u7d2b\u5361"]&&d.push({i:EQUIPMENT,rarity:3,n:i["\u5b9d\u7bb1\u5956\u52b13\u7d2b\u5361"]}),a.rewardBox=[c,l,d]}}},createChapterData:function(e){var t=function(e){if(e){var t=[],i=e.split("|");for(var a in i)if(i[a]){var n=i[a].split(":");t.push({n:+n[0],c:+n[1]})}return t}};for(var i in e){var a=e[i],n={metal:t(a.metal),part:t(a.part),weapon:t(a.weapon),rank:t(a.rank)};a.dropTable=n}}};window.excel=i,cc._RF.pop()},{"./ChapterDefine":"ChapterDefine"}],fireThrower:[function(e,t){"use strict";cc._RF.push(t,"66417nFqN9NWIGN6HH6zQxz","fireThrower"),e("./define");var i=e("../entities/environment/MyTower"),a=e("../entities/projectiles/PowerBullet"),n=e("../entities/projectiles/BallBulletSprite"),o=(e("../entities/projectiles/MissileSprite"),e("../ai/units/AIMyTower"));BULLET_DEFINE[FIRE_GUN]=[{name:"\u706b\u7130",ctor:a,noWall:!0,avatar:{ctor:n,sx:.4,sy:.3,sx1:1.5,sy1:1.8,st:.5,hitEffect:EFFECT.flameHit,a:cc.v2(.7,.5),anime:{repeat:1,alive:1,atlas:"avatar/flamethrower/fireball1",start:1,end:8,speed:1.8}},weaponType:WEAPON_TYPE[FIRE_GUN],kb:0,dmgType:DMG_TYPE.fire,length:22,radius:20,n:1,wd:0,d:5,spd:1650,gravity:300,damp:.8,distance:700,disExtra:10},{name:"\u706b\u7130\u72c2\u66b4",ctor:a,noWall:!0,avatar:{ctor:n,sx:.4,sy:.2,sx1:1.5,sy1:1.8,st:.5,a:cc.v2(.7,.5),hitEffect:EFFECT.flameHit,anime:{repeat:1,alive:1,atlas:"avatar/flamethrower/fireball1",start:1,end:8,speed:1.8}},weaponType:WEAPON_TYPE[FIRE_GUN],kb:0,dmgType:DMG_TYPE.fire,length:80,radius:20,n:1,wd:0,d:5,spd:1650,gravity:300,damp:.87,distance:950,disExtra:10}],ENTITY[FIRE_GUN]={id:FIRE_GUN,hero:!0,category:"firethrower",name:"\u706b\u7130\u55b7\u5c04\u5668",avatar:{gunBone:"gun",animeName:"huoyanpensheqi",anime:"weapon/huoyanpensheqi",s:.7,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.5,armor:1e3,crit:0,bltDmg:7.5,blt:BULLET_DEFINE[FIRE_GUN],bltMax:0,bltReload:1.5,attackCenter:cc.v2(-5,10),attackVolume:.1,attackSequence:[{t:.1,x:135,y:0,blt:1,sound:"sound/flamethrower",volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1}],attackAngle:[-40,80],heat:{attr:{atkSpd:.6},attackVolume:1,attackSequence:[{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},overHeat:{attr:{atkSpd:.6},attackSequence:[{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},pilot:{ctor:o,attackRange:1700,seekRange:1700,offsetX:0,offsetY:-20}},RES[FIRE_GUN]=[{atlas:"avatar/flamethrower/fireball1"},{anime:"weapon/huoyanpensheqi"},{anime:"mob/huoren"}],ENTITY[FIRE_GUN+"_2"]={id:FIRE_GUN+"_2",hero:!0,category:"firethrower",name:"\u706b\u7130\u55b7\u5c04\u56682",avatar:{gunBone:"gun",animeName:"huoyanpensheqi2",anime:"weapon/huoyanpensheqi",s:.7,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.5,armor:1e3,crit:0,bltDmg:11,blt:BULLET_DEFINE[FIRE_GUN],bltMax:0,bltReload:1.5,attackCenter:cc.v2(-5,10),attackVolume:.1,attackSequence:[{t:.1,x:135,y:0,blt:1,sound:"sound/flamethrower",volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1}],attackAngle:[-40,80],heat:{attr:{atkSpd:.6},attackVolume:1,attackSequence:[{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},overHeat:{attr:{atkSpd:.6},attackSequence:[{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},pilot:{ctor:o,attackRange:500,seekRange:600,offsetX:0,offsetY:-20}},ENTITY[FIRE_GUN+"_3"]={id:FIRE_GUN+"_3",hero:!0,category:"firethrower",name:"\u706b\u7130\u55b7\u5c04\u56683",avatar:{gunBone:"gun",animeName:"huoyanpensheqi3",anime:"weapon/huoyanpensheqi",s:.7,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.5,armor:1e3,crit:0,bltDmg:17,blt:BULLET_DEFINE[FIRE_GUN],bltMax:0,bltReload:1.5,attackCenter:cc.v2(-5,10),attackVolume:.1,attackSequence:[{t:.1,x:135,y:0,blt:1,sound:"sound/flamethrower",volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1}],attackAngle:[-40,80],heat:{attr:{atkSpd:.6},attackVolume:1,attackSequence:[{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},overHeat:{attr:{atkSpd:.6},attackSequence:[{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},pilot:{ctor:o,attackRange:500,seekRange:600,offsetX:0,offsetY:-20}},ENTITY[FIRE_GUN+"_4"]={id:FIRE_GUN+"_4",hero:!0,category:"firethrower",name:"\u706b\u7130\u55b7\u5c04\u56684",avatar:{gunBone:"gun",animeName:"huoyanpensheqi4",anime:"weapon/huoyanpensheqi",s:.7,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.5,armor:1e3,crit:0,bltDmg:26,blt:BULLET_DEFINE[FIRE_GUN],bltMax:0,bltReload:1.5,attackCenter:cc.v2(-5,10),attackVolume:.1,attackSequence:[{t:.1,x:135,y:0,blt:1,sound:"sound/flamethrower",volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1},{t:.1,x:135,y:0,blt:1,volume:.1}],attackAngle:[-40,80],heat:{attr:{atkSpd:.6},attackVolume:1,attackSequence:[{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},overHeat:{attr:{atkSpd:.6},attackSequence:[{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,sound:"sound/flamethrower",volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6},{t:0,deg2:15,x:90,y:0,blt:2,volume:.6},{t:0,deg2:-15,x:90,y:0,blt:2,volume:.6},{t:.08,x:90,y:0,blt:2,volume:.6}]},pilot:{ctor:o,attackRange:500,seekRange:600,offsetX:0,offsetY:-20}},cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/MissileSprite":"MissileSprite","../entities/projectiles/PowerBullet":"PowerBullet","./define":"define"}],forgeFail:[function(e,t){"use strict";cc._RF.push(t,"7cf16AXRahKa4pEyFKpKCSv","forgeFail"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{boards:[cc.Node],contents:[cc.Node]},init:function(e){this.args=e,this.game=e.game,this.items=e.items,this.fromWeaponTeam=e.fromWeaponTeam},returnMaterial:function(){for(var e in this.items){var t=this.items[e],i=this.node.convertToWorldSpaceAR(cc.v2(0,0));this.fromWeaponTeam&&e==this.fromWeaponTeam.index?(this.fromWeaponTeam.weaponTeam.addEquipment(t),this.game.removeWeaponTeamForgeBlocks(),this.game.initWeaponTeamForgeBlocks()):this.game.addBagItem(t,null,i)}this.close()}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],gunnerMode:[function(e,t){"use strict";cc._RF.push(t,"5a4bbW1PTdAKo+i9gdEuqpt","gunnerMode");var i=e("../../Plugins/ADManager"),a=e("../../Plugins/firebase/FirebaseTracking"),n=e("../../Plugins/SDKManager"),o=[{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg4"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{map:"adv/736",lvl:1.3,lvl2:12,gold:13,exp:180},{map:"adv/735",lvl:2,lvl2:5,gold:13,exp:180},{map:"adv/736",lvl:1.5,lvl2:15,gold:13,exp:180},{map:"adv/735",lvl:3,lvl2:10,gold:13,exp:180}]},{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg4"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{map:"adv/736",lvl:1.5,lvl2:15,gold:13,exp:180},{map:"adv/735",lvl:3,lvl2:10,gold:13,exp:180}]},{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg4"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{map:"adv/701",lvl:1,lvl2:1,gold:13,exp:180,backpack:{blockData:[[0,0,0,0,0],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}},{map:"adv/702",lvl:1,lvl2:1,gold:13,exp:180,backpack:{blockData:[[0,0,0,0,0],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}},{map:"adv/703",lvl:1,lvl2:1,gold:13,exp:180,backpack:{blockData:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}}]},{name:"\u5931\u843d\u4e1b\u6797",themeDefine:{ui:"theme/ui/forest",bg:{prefab:"theme/bg4"},list:{}},excelData:"chapter_1",mapPool:{},stage:[{map:"adv/777",lvl:10,lvl2:10,gold:13,exp:180,backpack:{blockData:[[0,0,0,0,0],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}},{map:"adv/702",lvl:1,lvl2:1,gold:13,exp:180,backpack:{blockData:[[0,0,0,0,0],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1],[0,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}},{map:"adv/703",lvl:1,lvl2:1,gold:13,exp:180,backpack:{blockData:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],blockItemData:[{id:"machine_gun",pos:[3,6]}]}}]}],r={extractWeaponInfo:function(e){var t=1,i=e;if(e){var a=e.match(/^(.+?)_(\d+)$/);if(a){var n=parseInt(a[2]);n>=1&&n<=6&&(t=n,i=a[1])}}return{cleanId:i,rarity:t}},mapWeaponId:function(e){var t={b:"machine_gun",d:"fire_thrower",c:"cannon",laser:"laser",tesla:"tesla",snip:"sniper",roc:"mortar",ball:"bouncing_ball",arrow:"fly_shield"};return t[e]?t[e]:e},getEquipmentLevel:function(e,t){if(void 0===t&&(t=1),window.equipment&&equipment.data&&equipment.data.items){var i=equipment.data.items[e];if(i&&void 0!==i.lvl)return i.lvl}return t},addEquipmentToArray:function(e,t,i,a){e.push({id:t,level:i,rarity:a})},initializeDamageStats:function(){return{dmg_sniper:0,dmg_machinegun:0,dmg_firethrower:0,dmg_mortar:0,dmg_bouncingball:0,dmg_cannon:0,dmg_laser:0,dmg_tesla:0,dmg_flyshield:0,hprecovery:0,armorrecovery:0}},start:function(e){var t,i=(t=void 0===e?{}:e).chapterIndex;this.typeMode=2===i?"make-choice":"shoot-target";var a=t.mapIndex,n=t.mgr,r=t.jumpToAdventure;if(o[i=i||0]){this.set(kit.rnd(0,9999999),i,a||0),ENTITY.v1,chapter.reset(),chapter.data.tank=[{weapon:"machine_gun",weaponLvl:1}],chapter.data.bench=[],chapter.data.bag=[],chapter.data.backpack={blockData:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,1,1,0,0],[0,1,1,0,0],[0,1,1,0,0]],blockItemData:[{id:"machine_gun",pos:[1,4]},{id:"machine_gun",pos:[1,5]},{id:"machine_gun",pos:[1,6]}]};var s=this.transformBlockItemDataToTowersData(chapter.data.backpack);this.run({vid:"v1",star:1,attr:{},towers:s,heroes:[],bench:[]},n,r)}else cc.msgbox("\u672a\u5b9a\u4e49\u7684\u7ae0\u8282")},transformBlockItemDataToTowersData:function(e){var t=0,i=[];for(var a in e.blockData)for(var n in e.blockData[a])if(e.blockData[a][n]){t=a;break}for(var a in e.blockItemData){var o=e.blockItemData[a];if(o.pos){var r=BackpackItemDefine[o.id],s={stage:t,x:o.pos[0],i:r.unitID,y:o.pos[1],backpack:o};i.push(s)}}return cc.log("transformBlockItemDataToTowersData",i),i},set:function(e,t,i){this.chapterIndex=t,this.seed=e;var a=o[t],n=kit.core(e),r=this.mapList=[],s=a.stage,c=kit.clone(a.mapPool);for(var l in s){var d=s[l];if(d.map)r.push({map:d.map,lvl:d.lvl});else if(d.pool&&c[d.pool]){var h=c[d.pool],u=n.rndInt(0,h.length-1);r.push({map:h[u].map,lvl:d.lvl}),h.splice(u,1)}}this.mapIndex=i,cc.log("adventure load",this.mapList,this.mapIndex),adventure.startTime=Date.now()},run:function(t,s,c){var l=this,d=this.mapList[this.mapIndex],h=this.chapterIndex,u=o[this.chapterIndex],p=this.typeMode;if(d){for(var f in t.tower)t.tower[f].hp=null,t.tower[f].atk=1;var m=t.vid,g=t.star,v=t.attr,y=t.hp,b=t.towers,k=t.heroes,T=t.bench,_=t.cd;cc.log("adventure run vehicleConfig",JSON.stringify(t));var w=u.stage[this.mapIndex];if(w.backpack&&(chapter.data.backpack=w.backpack,cc.log("adventure run chapter.data.backpack",chapter.data.backpack),b=this.transformBlockItemDataToTowersData(w.backpack)),a.FirebaseTracking.level_id=l.mapIndex+1,l.stageStartTime=Date.now(),adventure.startTime||(adventure.startTime=Date.now()),!window.StatsTracker)try{e("../managers/StatsTracker")}catch(t){console.warn("[GunnerMode] Failed to load StatsTracker:",t)}if(!window.EquipmentEncoder)try{e("../utils/EquipmentEncoder")}catch(t){console.warn("[GunnerMode] Failed to load EquipmentEncoder:",t)}if(window.StatsTracker){window.StatsTracker.initSession();var E=[],C="";if(b&&b.length>0){for(var S=0;S<b.length;S++){var I=b[S];if(I.backpack&&I.backpack.id){var A=l.extractWeaponInfo(I.backpack.id),B=1;l.addEquipmentToArray(E,A.cleanId,B,A.rarity)}else if(I.i){var M=I.i;M&&0===M.indexOf("tower_")&&(M=M.replace("tower_","")),A=l.extractWeaponInfo(M),l.mapWeaponId(A.cleanId),B=1,l.addEquipmentToArray(E,A.cleanId,B,A.rarity)}}E.length>0&&window.EquipmentEncoder&&(C=window.EquipmentEncoder.encodeCurrentEquipment({towers:E}))}window.StatsTracker.setEquipmentConfiguration(E,C)}map.load("map/"+d.map,function(e,o){if(e)kit.info("\u5730\u56fe\u4e0d\u5b58\u5728"+d.map);else{var f={lvl:w.lvl||1,lvl2:w.lvl2||1,entity:{1:{id:m,cd:_,star:g,attr:v,hp:y,towers:b,heroes:k,bench:T}},themeDefine:u.themeDefine},E=w.menu||"game",C={effectMgr:s,menu:E,me:1,chapterName:u.name,chapterIndexName:u.indexName,chapterIndex:h,mapName:l.mapIndex+1+"/"+l.mapList.length,mapIndex:l.mapIndex,remotes:f,auto:h>0?1:0,mapData:o,exp:0,gunnerMode:1,startFunc:function(){},finishFunc:function(e,o){e&&(e.gunnerMode=1),e&&e.levelMgr&&(e.levelMgr.entity,e.levelMgr.entityList,e.levelMgr.getEntityByTeam)&&e.levelMgr.getEntityByTeam(1);var s=!1,d=function(){if(o);else if(e.effectMgr.cacheMode=!1,s);else{s=!0;var d=n.SDKManager.Instance.endLevelTimer(),u=a.FirebaseTracking.levelID,p=n.SDKManager.Instance.generateUniqueID(u),f=n.SDKManager.Instance.getAttempts(u),m=i.ADManager.Instance.IsReviveAds?1:0,g="",v=r.initializeDamageStats(),y=[];if(e&&e.levelMgr){if(e.levelMgr.heroes&&e.levelMgr.heroes[1]){var b=e.levelMgr.heroes[1];if(b.towers&&b.towers.length>0)for(var k=0;k<b.towers.length;k++)if(z=b.towers[k]){var T=z.unitType||z.define&&z.define.unitType||z.name;if(O=z.id||z.config&&z.config.i||T){var _=1,w=O,E=O.match(/^(.+?)_(\d+)$/);if(E&&(K=parseInt(E[2]))>=1&&K<=6&&(_=K,w=E[1]),r.mapWeaponId(w),1==(U=1)&&z.define){var C=z.define.id||z.define.type||z.define.unitType;if(C){var S=C,I=C.match(/^(.+?)_?(\\d+)$/);if(I&&(S=I[1]),idMap[S]&&(S=idMap[S]),window.equipment&&equipment.data&&equipment.data.items){var A=equipment.data.items[S];A&&A.lvl&&(U=A.lvl)}}}0===U&&(U=1);var B=w,M=U,D=_;y.push({id:B,level:M,rarity:D})}}if(b.config&&b.config.towers&&b.config.towers.length>0)for(var x=0;x<b.config.towers.length;x++){var R=b.config.towers[x];if(R&&R.i){var N=1,F=R.i,L=R.i.match(/^(.+?)_(\d+)$/);L&&(K=parseInt(L[2]))>=1&&K<=6&&(N=K,F=L[1]),r.mapWeaponId(F);var P=1;0===P&&(P=R.lvl||1);var O=F,U=P;_=N,y.push({id:O,level:U,rarity:_})}}}if(!y.length&&e.levelMgr.entityList)for(var q in e.levelMgr.entityList){var G=e.levelMgr.entityList[q];if(G&&1===G.team&&G.unitType){var H=1,j=O=G.unitType||G.id,Y=O.match(/^(.+?)_(\d+)$/);Y&&(K=parseInt(Y[2]))>=1&&K<=6&&(H=K,j=Y[1]),r.mapWeaponId(j);var W=1;0===W&&(W=G.lvl||G.level||1),O=j,U=W,_=H,y.push({id:O,level:U,rarity:_})}}}if(0===y.length&&window.EquipmentEncoder&&chapter.data.backpack)try{var V=r.transformBlockItemDataToTowersData(chapter.data.backpack);if(V&&V.length>0)for(var X=0;X<V.length;X++){var z;if((z=V[X]).backpack&&z.backpack.id){0==(U=1)&&(U=z.backpack.lvl||z.lvl||1);var K,J=1,Z=z.backpack.id,Q=z.backpack.id.match(/^(.+?)_(\d+)$/);Q&&(K=parseInt(Q[2]))>=1&&K<=6&&(J=K,Z=Q[1]),B=Z,M=U,D=J,y.push({id:B,level:M,rarity:D})}}}catch(t){console.error("[GunnerMode] Failed to process backpack data (lose):",t)}if(console.warn("[GunnerMode] currentEquipmentArray:",y),y.length>0&&window.EquipmentEncoder&&(g=window.EquipmentEncoder.encodeCurrentEquipment({towers:y}),window.StatsTracker&&window.StatsTracker.setEquipmentConfiguration(y,g)),window.StatsTracker){var $=StatsTracker.getSessionStats();$&&$.damageByWeapon&&(v.dmg_sniper=Math.floor($.damageByWeapon.sniper||0),v.dmg_machinegun=Math.floor($.damageByWeapon.machinegun||0),v.dmg_firethrower=Math.floor($.damageByWeapon.firethrower||0),v.dmg_mortar=Math.floor($.damageByWeapon.mortar||0),v.dmg_bouncingball=Math.floor($.damageByWeapon.bouncingball||0),v.dmg_cannon=Math.floor($.damageByWeapon.cannon||0),v.dmg_laser=Math.floor($.damageByWeapon.laser||0),v.dmg_tesla=Math.floor($.damageByWeapon.tesla||0),v.dmg_flyshield=Math.floor($.damageByWeapon.flyshield||0)),$&&(v.hprecovery=Math.floor($.hpRecovered||0),v.armorrecovery=Math.floor($.armorRecovered||0))}a.FirebaseTracking.logGameOver(p,d,m,0,1,f,g,v.dmg_sniper,v.dmg_machinegun,v.dmg_firethrower,v.dmg_mortar,v.dmg_bouncingball,v.dmg_cannon,v.dmg_laser,v.dmg_tesla,v.dmg_flyshield,v.hprecovery,v.armorrecovery)}var ee=[{i:GOLD,n:50*(l.mapIndex+1)}];menuManager.pop("chapter_complete",{win:o,delay:o?2:0,noBlock:1,game:e,vehicleConfig:t,jumpToAdventure:c,level:l.mapIndex,chapter:h,items:ee,hideCb:function(){net.updateData({items:ee},function(e,t){money.update(t)}),e&&(e.layer.hideJoystickBtn(!1),e.layer.hideOtherBtn(!1)),menuManager.preload("main")},nextCb:function(){c?adventure.start(0):user.onlyGunner?r.start({chapterIndex:user.onlyGunnerChapter||0,mapIndex:user.onlyGunnerLevel||0}):menuManager.back(-1)}})};if(o){var u=n.SDKManager.Instance.endLevelTimer(),f=a.FirebaseTracking.levelID,m=n.SDKManager.Instance.generateUniqueID(f),g=n.SDKManager.Instance.getAttempts(f),v=i.ADManager.Instance.IsReviveAds?1:0,y="",b=r.initializeDamageStats(),k=[];if(e&&e.levelMgr){if(e.levelMgr.heroes&&e.levelMgr.heroes[1]){var T=e.levelMgr.heroes[1];if(T.towers&&T.towers.length>0)for(var _=0;_<T.towers.length;_++)if(J=T.towers[_]){var w=J.unitType||J.define&&J.define.unitType||J.name,E=J.id||J.config&&J.config.i||w;if(0==(Z=1)&&J.define){var C=J.define.id||J.define.type||J.define.unitType;if(C){var S=C,I=C.match(/^(.+?)_(\d+)$/);if(I&&parseInt(I[2])>=1&&parseInt(I[2])<=6&&(S=I[1]),S=r.mapWeaponId(S),window.equipment&&equipment.data&&equipment.data.items){var A=equipment.data.items[S];A&&A.lvl&&(Z=A.lvl)}}}if(0===Z&&(Z=1),E){var B=1,M=E,D=E.match(/^(.+?)_(\d+)$/);D&&(U=parseInt(D[2]))>=1&&U<=6&&(B=U,M=D[1]);var x=M,R=Z,N=B;k.push({id:x,level:R,rarity:N})}}if(T.config&&T.config.towers&&T.config.towers.length>0)for(var F=0;F<T.config.towers.length;F++){var L=T.config.towers[F];if(L&&L.i){for(var P=!1,O=0;O<k.length;O++)if(k[O].id===L.i){P=!0,L.lvl&&L.lvl>k[O].lvl&&(k[O].lvl=L.lvl);break}if(!P){var U,q=1,G=L.i,H=L.i.match(/^(.+?)_(\d+)$/);H&&(U=parseInt(H[2]))>=1&&U<=6&&(q=U,G=H[1]);var j=r.mapWeaponId(G),Y=0;window.equipment&&equipment.data&&equipment.data.items&&($=equipment.data.items[j])&&void 0!==$.lvl&&(Y=$.lvl),k.push({id:G,level:Y,rarity:q})}}}}if(!k.length&&e.levelMgr.entityList)for(var W in e.levelMgr.entityList){var V=e.levelMgr.entityList[W];if(V&&1===V.team&&V.unitType){E=V.unitType||V.id;var X=0;window.equipment&&equipment.data&&equipment.data.items&&($=equipment.data.items[E])&&$.lvl&&(X=$.lvl),0===X&&(X=V.lvl||V.level||1),k.push({id:E,level:X})}}}if(0===k.length&&window.EquipmentEncoder&&chapter.data.backpack)try{var z=r.transformBlockItemDataToTowersData(chapter.data.backpack);if(z&&z.length>0)for(var K=0;K<z.length;K++){var J;if((J=z[K]).backpack&&J.backpack.id){var Z=0;window.equipment&&equipment.data&&equipment.data.items&&($=equipment.data.items[J.backpack.id])&&$.lvl&&(Z=$.lvl),0===Z&&(Z=J.backpack.lvl||J.lvl||1),k.push({id:J.backpack.id,level:Z})}else if(J.i){var Q=J.i;Q&&0===Q.indexOf("tower_")&&(Q=Q.replace("tower_",""));var $,ee=0;window.equipment&&equipment.data&&equipment.data.items&&($=equipment.data.items[Q])&&$.lvl&&(ee=$.lvl),0===ee&&(ee=J.lvl||1),k.push({id:Q,level:ee})}}}catch(t){console.error("[GunnerMode] Failed to process backpack data (win):",t)}console.warn("[GunnerMode] currentEquipmentArray from game state:",k);var te=!1;if(window.StatsTracker){var ie=window.StatsTracker.getSessionStats();ie&&ie.equipmentEncoded&&(y=ie.equipmentEncoded,te=!0)}if(te||k.length>0&&window.EquipmentEncoder&&(y=window.EquipmentEncoder.encodeCurrentEquipment({towers:k})),window.StatsTracker){var ae=StatsTracker.getSessionStats();ae&&ae.damageByWeapon&&(b.dmg_sniper=Math.floor(ae.damageByWeapon.sniper||0),b.dmg_machinegun=Math.floor(ae.damageByWeapon.machinegun||0),b.dmg_firethrower=Math.floor(ae.damageByWeapon.firethrower||0),b.dmg_mortar=Math.floor(ae.damageByWeapon.mortar||0),b.dmg_bouncingball=Math.floor(ae.damageByWeapon.bouncingball||0),b.dmg_cannon=Math.floor(ae.damageByWeapon.cannon||0),b.dmg_laser=Math.floor(ae.damageByWeapon.laser||0),b.dmg_tesla=Math.floor(ae.damageByWeapon.tesla||0),b.dmg_flyshield=Math.floor(ae.damageByWeapon.flyshield||0)),ae&&(b.hprecovery=Math.floor(ae.hpRecovered||0),b.armorrecovery=Math.floor(ae.armorRecovered||0))}if(a.FirebaseTracking.logGameOver(m,u,v,1,0,g,y,b.dmg_sniper,b.dmg_machinegun,b.dmg_firethrower,b.dmg_mortar,b.dmg_bouncingball,b.dmg_cannon,b.dmg_laser,b.dmg_tesla,b.dmg_flyshield,b.hprecovery,b.armorrecovery),l.mapIndex++,window.adventure&&window.adventure.updateMinigameProgress){l.stageStartTime||(l.stageStartTime=Date.now());var ne=Math.floor((Date.now()-l.stageStartTime)/1e3),oe=Math.floor((Date.now()-(adventure.startTime||Date.now()))/1e3),re=75+2*l.mapIndex,se={highest_stage:l.mapIndex,maintain_time:ne,total_score:oe,accuracy:Math.min(re,100)};"make-choice"===p&&(se.correct_choices=10*l.mapIndex),window.adventure.updateMinigameProgress(p,se),l.stageStartTime=Date.now()}var ce=l.mapList[l.mapIndex],le=2.5;e.levelMgr.callFade();var de=!0;e.addUpdate({updateLogic:function(i){if((le-=i)<0&&de)if(de=!1,ce){var a=e.effectMgr;r.run(t,a)}else d()}})}else if(window.adventure&&window.adventure.updateMinigameProgress&&(l.stageStartTime||(l.stageStartTime=Date.now()),ne=Math.floor((Date.now()-l.stageStartTime)/1e3),oe=Math.floor((Date.now()-(adventure.startTime||Date.now()))/1e3),re=75+2*l.mapIndex,se={highest_stage:l.mapIndex,maintain_time:ne,total_score:oe,accuracy:Math.min(re,100)},"make-choice"===p&&(se.correct_choices=10*l.mapIndex),window.adventure.updateMinigameProgress(p,se)),l.mapIndex){var he=[{i:GOLD,n:50*(l.mapIndex+1)}];menuManager.pop("revive",{noWait:!0,noBlock:!0,game:e,eventName:"mini_get_revived",items:he,closeCb:function(i){if(net.updateData({items:he},function(e,t){money.update(t)}),i){var a=e.effectMgr;r.run(t,a)}else d()}})}else d()},pauseFunc:function(e){e.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(t){e.popTimeScale(0),t&&(user.onlyGunner?r.start({chapterIndex:user.onlyGunnerChapter||0,mapIndex:user.onlyGunnerLevel||0}):(e.effectMgr.cacheMode=!1,menuManager.back(-1)))}})}};s?(s.cacheMode=!0,menuManager.run(E,C)):loadGame(C)}})}}};window.gunnerMode=r,cc._RF.pop()},{"../../Plugins/ADManager":"ADManager","../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../managers/StatsTracker":"StatsTracker","../utils/EquipmentEncoder":"EquipmentEncoder"}],hack:[function(e,t){"use strict";if(cc._RF.push(t,"47868RazOtLt5aED8/Rmp87","hack"),cc.sys.LANGUAGE_INDONESIAN="id",cc.sys.LANGUAGE_HINDI="hi",cc.sys.LANGUAGE_VIETNAMESE="vi",cc.sys.LANGUAGE_THAI="th",cc.sys.isNative)if(cc.director._scheduler){var i=dragonBones.CCFactory.getInstance();cc.director._scheduler.scheduleUpdate(i,cc.Scheduler.PRIORITY_SYSTEM,!1)}else console.log("no cc.director._scheduler");if((cc.sys.os==cc.sys.OS_IOS||cc.sys.os==cc.sys.OS_OSX||cc.sys.os==cc.sys.OS_WINDOWS)&&!1&cc.sys.isNative){var a=dragonBones.Animation.prototype,n=a.fadeIn;a.fadeIn=function(e){if(this.hasAnimation(e)){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return n.call.apply(n,[this,e].concat(i))}};var o=a.play;a.play=function(e){if(this.hasAnimation(e)){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return o.call.apply(o,[this,e].concat(i))}}}var r=dragonBones.ArmatureDisplay.prototype,s=r._onPreDestroy,c=dragonBones.ArmatureDisplay.AnimationCacheMode;cc.sys.isNative?r._onPreDestroy=function(){s.call(this),this._nativeDisplay&&(this._nativeDisplay.dispose(),this._nativeDisplay._comp=null,this._nativeDisplay=null),this._armature&&!this.isAnimationCached()&&this._factory.remove(this._armature),this._cacheMode===c.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===c.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null)}:r._onPreDestroy=function(){s.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._cacheMode===c.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===c.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null)};var l=cc.Node.prototype;if(l){l.find=function(e,t){var i=cc.find(e.toString(),this);return i&&t?i.getComponent(t):i},l.findAnime=function(e){return this.find(e,dragonBones.ArmatureDisplay)},l.findLabel=function(e){return this.find(e,cc.Label)},l.findSprite=function(e){return this.find(e,cc.Sprite)},l.getScheduler=function(){return this._scheduler},l.setScheduler=function(e){this._scheduler=e},l.getActionManager=function(){return this._actionManager},l.setActionManager=function(e){try{e&&"object"==typeof e&&"_hashTargets"in e&&"_arrayTargets"in e?this._actionManager=e:(console.log("checkAction ",e),void 0===this._actionManager&&(this._actionManager={_hashTargets:{},_arrayTargets:[],_currentTarget:null,_id:"DefaultActionManager"}))}catch(t){console.warn("setActionManager: Error occurred, keeping current actionManager",t)}},l.runActionVS=function(e){if(this.active){cc.assertID(e,1618);var t=this.getActionManager();if(t)return t.addAction(e,this,!1),e;console.warn("runActionVS:no vs actionManager!")}},l.pauseAllActionsVS=function(){var e=this.getActionManager();e?e.pauseTarget(this):console.warn("pauseAllActionsVS:no vs actionManager!")},l.resumeAllActionsVS=function(){var e=this.getActionManager();e?e.resumeTarget(this):console.warn("resumeAllActionsVS:no vs actionManager!")},l.stopAllActionsVS=function(){var e=this.getActionManager();e?e.removeAllActionsFromTarget(this):console.warn("stopAllActionsVS:no vs actionManager!")},l.stopActionVS=function(e){var t=this.getActionManager();t?t.removeAction(e):console.warn("stopActionVS:no vs actionManager!")};var d=l._onPreDestroy;l._onPreDestroy=function(){var e=this.getActionManager();e&&e.removeAllActionsFromTarget(this),d.call(this)};var h=l._onPostActivated;l._onPostActivated=function(e){var t=this.getActionManager();t&&(e?t.resumeTarget(this):t.pauseTarget(this)),h.call(this,e)};var u=l._onBatchCreated;l._onBatchCreated=function(){u.call(this);var e=this.getActionManager();e&&!this._activeInHierarchy&&e.pauseTarget(this)};var p=l._onBatchRestored;l._onBatchRestored=function(){p.call(this);var e=this.getActionManager();e&&!this._activeInHierarchy&&e.pauseTarget(this)};var f=l.cleanup;l.cleanup=function(){var e=this.getActionManager();e&&e.removeAllActionsFromTarget(this),f.call(this)}}var m,g=cc.Component.prototype;if(g){var v=g._onPreDestroy;g._onPreDestroy=function(){var e=this.node.getScheduler();e&&e.unscheduleAllForTarget(this),v.call(this)},g.scheduleVS=function(e,t,i,a){cc.assertID(e,1619),t=t||0,cc.assertID(t>=0,1620),i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,a=a||0;var n=this.node.getScheduler();if(n){var o=n.isTargetPaused(this);n.schedule(e,this,t,i,a,o)}else console.log("scheduleVS:no vs scheduler")},g.scheduleOnceVS=function(e,t){this.scheduleVS(e,0,0,t)},g.unscheduleVS=function(e){if(e){var t=this.node.getScheduler();t?t.unschedule(e,this):console.log("unscheduleVS:no vs scheduler")}},g.unscheduleAllCallbacksVS=function(){var e=this.node.getScheduler();e?e.unscheduleAllForTarget(this):console.log("unscheduleAllCallbacksVS:no vs scheduler")}}if((g=cc.RichText.prototype)&&(g.addMyImageElement=function(e,t){if(!this.imageAtlasTable){var i={};this.imageAtlasTable={getSpriteFrame:function(e){return i[e]},setSpriteFrame:function(e,t){i[e]=t}}}this.imageAtlas=this.imageAtlasTable,this.imageAtlas.setSpriteFrame(e,t)}),cc.MotionStreak){var y=cc.MotionStreak.prototype;y.reset=function(){this._points.length=0,this._assembler&&this._assembler._renderData.clear(),this._lastWPos.x=0,this._lastWPos.y=0,this._needReset=!0},y.lateUpdate=function(e){if(this.node._updateWorldMatrix(),this._needReset){this._needReset=!1;var t=this.node._worldMatrix.m;this._lastWPos.x=t[12],this._lastWPos.y=t[13]}this._assembler&&this._assembler.update(this,e)}}window.dragonBones&&(dragonBones.Slot.prototype.setDisplayByName=function(e){for(var t=0;t<this._displayDatas.length;t++)if(this._displayDatas[t].name==e)return void(this.displayIndex=t);this.displayIndex=-1}),cc.RotateTo._reverse=cc.RotateBy._reverse=!0,cc.Update=cc.Class({name:"cc.Update",extends:cc.Action,ctor:function(e,t,i){this.initWithTarget(e,t,i)},initWithTarget:function(e,t,i){return e&&(this._function=e),t&&(this._selectorTarget=t),void 0!==i&&(this._data=i),!0},step:function(e){this._function&&this._function.call(this._selectorTarget,e,this.target,this._data)},isDone:function(){return!1},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.update=function(e,t,i){return new cc.Update(e,t,i)};var b,k,T,_,w,E=function(){var e=[S,"NxjsOjAiFaIJmwMik.cOoOmSS.yJvLd7PFOEuxtw==","W5JcVauQwXTtlLOZvmkLaW","xSouWQ3dPWFcGCoOuNy","Bt/dP8osWR3dKCkPWQBcUcPGFa","W4GNWPnCW6G","sL3dHu/dTmoLWOSCW4CGlcmd","svVdNSoaW5u","lKK8WRldJ0RcTGyBWQ9QWPe","BSosWPFdTIJcI8o+sfjpW53dMmolW7K","W5PAlsvekSks","W501WR9gWONdImkIvrPhz8oc","fXW1WOPFW4xdJCo7W4GcW4W0","oYKqmCohWPL+WOC"].concat(["zSoOW4tcUahcRSoaWR7dTSotm8k3fG","r3xcQSohWRTtWPW","eNFcG8oyWR8","W4qQmSkIBCkGWODjCfzKWQ0bW7JcGahcRMPu","W58huwCrC8o/x8k0W65OWQji","E8kCF8owfH3dTW","FSomxSo+mZZdTH0","lI7cHSkIuxyPWQbHg8k7W4D+","qerRAxxcG1dcIb8HW7VdLZy","qSoHzvNcLCkFtvxcUSo5AmoZWP1G","W4a5WOvF","WRaCqcP+jSk3W6imWO7dNaFcMCk5DCoNcHS","W7FcGCkrWQBdRxmzWOr1i8kIWQK","v8kLtSk1nCoUWOaEmaxdHKe"].concat(["DCkfFSoqjbtdKG","kY7dScVcRW3dKbX5","b2yPcSonWRGUDYy","j8kIWP/dU17dQSknWQxdMW","WQqylw/dUHdcNq","jSkNWPtdL2i","frW1WOLFW4tcK8oxW4CQW4WpmG","kKC7WRddHupcTtSoWRvLWOG","qIxdUHtcRWJdKa","5y6G5P2I5RIv5OIm","hmk2baxdJmojg0ZcKSodymoLWO0","BSkVBJz0WPtcOmklWO/cUG3cQq"]));return(E=function(){return e})()},C=function(e,t){var i=E();return(C=function(t,a){var n=i[t-=233];if(void 0===C.mwvZug){var o=function(e){for(var t,i,a="",n="",o=0,r=0;i=e.charAt(r++);~i&&(t=o%4?64*t+i:i,o++%4)?a+=String.fromCharCode(255&t>>(-2*o&6)):0)i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(i);for(var s=0,c=a.length;s<c;s++)n+="%"+("00"+a.charCodeAt(s).toString(16)).slice(-2);return decodeURIComponent(n)},r=function(e,t){var i,a,n=[],r=0,s="";for(e=o(e),a=0;a<256;a++)n[a]=a;for(a=0;a<256;a++)r=(r+n[a]+t.charCodeAt(a%t.length))%256,i=n[a],n[a]=n[r],n[r]=i;a=0,r=0;for(var c=0;c<e.length;c++)r=(r+n[a=(a+1)%256])%256,i=n[a],n[a]=n[r],n[r]=i,s+=String.fromCharCode(e.charCodeAt(c)^n[(n[a]+n[r])%256]);return s};C.pFhLFL=r,e=arguments,C.mwvZug=!0}var s=i[0],c=t+s,l=e[c];return l?n=l:(void 0===C.ZTtqPb&&(C.ZTtqPb=!0),n=C.pFhLFL(n,a),e[c]=n),n})(e,t)},S="jsjiami.com.v7",I=C;b=204,T="hs",_="hs",function(e,t,i,a,n){var o=C;_+=n="up",T=i(T=(a="tfi")+T),_=i(_),i=0;for(var r=e();292607+--b;)try{a=-parseInt(o(243,"@2#r"))/1+-parseInt(o(247,"dtS5"))/2*(-parseInt(o(258,"3&jX"))/3)+-parseInt(o(249,"f*Ao"))/4*(parseInt(o(241,"DlIl"))/5)+parseInt(o(257,"f*Ao"))/6+parseInt(o(265,"wiXc"))/7+parseInt(o(254,"HMS4"))/8*(parseInt(o(235,"vIY$"))/9)+parseInt(o(266,"Sp5p"))/10*(-parseInt(o(259,"3&jX"))/11)}catch(s){a=i}finally{if(n=r[T](),202<=b)i?k?a=n:k=n:i=n;else if(i==k.replace(/[MSALENFkuIPJywxOtd=]/g,"")){if(292607===a){r["un"+T](n);break}r[_](n)}}}(E,0,function(e,t,i,a){return t="split",(e=(e=(e=arguments[0])[t](""))[i="reverse"]("v"))[a="join"]("")}),(w=null==(m=e("./MapPage"))?void 0:m[I(270,"UN3o")])&&(w[I(248,"2Lk6")]=w[I(245,"K)7p")],w[I(260,"LqZ9")]=function(){var e=I,t={qwdXS:function(e,t){return e+t},mxKRu:function(e,t){return e>t},zSpxY:e(238,"j^vw")};w[e(262,"qWUB")][e(244,"rZxi")](this,arguments),this[e(242,"2Lk6")]=t[e(234,"UN3o")](this[e(269,"JcOA")]||0,1),t[e(255,"HMS4")](this[e(268,"*5J%")],38)&&kit[e(263,"rZxi")](t[e(246,"dhRL")])},w[I(256,"wP3h")]=w[I(264,"^p(x")],w.refreshStartButton=function(){var e=I;w.refreshStartButton0.apply(this,arguments),this[e(269,"JcOA")]=0}),cc._RF.pop()},{"./MapPage":"MapPage"}],helicopter:[function(e,t){"use strict";cc._RF.push(t,"398c0lv/E1Eya5181KVLKA0","helicopter"),e("./define");var i=e("../components/visual/ArmatureAvatar");e("../entities/projectiles/BallBulletSprite"),e("../entities/projectiles/Bomb"),e("../components/visual/Avatar"),BULLET_DEFINE.helicopter=[{name:"\u76f4\u5347\u673a\u5b50\u5f39",avatar:{sx:.6,sy:.6,sx1:.8,sy1:.8,st:.2,anime:{atlas:"bullet/enemy/bullet4",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit,streakEffect:EFFECT.spinBlt,a:cc.v2(.5,.5)},length:20,kb:.02,n:1,wd:0,d:22,spd:250,spdFluc:.2,distance:600}],ENTITY.helicopter={id:"helicopter",name:"\u76f4\u5347\u673a",avatar:{ctor:i,animeName:"zhishengji",anime:"mob/zhishengji",s:.4,moveSpd:50,dy:-32},fixedFlipX:1,g:800,machine:1,radius:75,moveSpd:150,weight:50,hp:1200,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:4,blt:BULLET_DEFINE.helicopter,bltMax:15,bltReload:.9,deathEffect:EFFECT.helicopterDeath,fly:1,attackSequence:[{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0}],pilot:{ctor:e("../ai/units/AIHelicopter"),attackRange:650,seekRange:1e3}},RES.helicopter=[{anime:"mob/zhishengji"}];var a=e("../entities/projectiles/Missile"),n=e("../entities/projectiles/MissileSprite");BULLET_DEFINE.helicopter2=[{name:"\u76f4\u5347\u673a\u5b50\u5f39",ctor:a,avatar:{ctor:n,frm:"avatar/\u5bfc\u5f39",sx:.6,sy:.6,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileBulletStreak},bomb:{r1:50,r0:50,dmg1:10,dmg0:10,kb:300,effect:EFFECT.bombs},armorType:ARMOR_TYPE.bullet,rttSpd:120,rttSpdTime:.5,kb:.3,length:20,radius:20,hitRadius:50,n:1,wd:0,d:90,spd:400,spdFluc:0,distance:3450,disExtra:100}],ENTITY.helicopter2={id:"helicopter2",name:"\u76f4\u5347\u673a2",avatar:{ctor:i,animeName:"zhishengji2",anime:"mob/zhishengji",s:.4,moveSpd:50,dy:-32},fixedFlipX:1,g:800,machine:1,radius:75,moveSpd:150,weight:50,hp:1200,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:10,blt:BULLET_DEFINE.helicopter2,bltMax:15,bltReload:.9,deathEffect:EFFECT.helicopterDeath,fly:1,attackSequence:[{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:3,ani:0}],pilot:{ctor:e("../ai/units/AIHelicopter"),attackRange:650,attackDeg:180,seekRange:1e3}},RES.helicopter2=[{anime:"mob/zhishengji"}],ENTITY.helicopter_boss={id:"helicopter_boss",name:"\u76f4\u5347\u673aboss",avatar:{ctor:i,animeName:"zhishengji2",anime:"mob/zhishengji",s:.6,moveSpd:50,dy:-48},fixedFlipX:1,g:800,machine:1,radius:75,moveSpd:150,weight:50,hp:10200,boss:1,out:2e3,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:10,blt:[{name:"\u76f4\u5347\u673a\u5b50\u5f39",ctor:a,avatar:{ctor:n,frm:"avatar/\u5bfc\u5f39",sx:.6,sy:.6,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileBulletStreak},bomb:{r1:50,r0:50,dmg1:10,dmg0:10,kb:300,effect:EFFECT.bombs},armorType:ARMOR_TYPE.bullet,rttSpd:120,rttSpdTime:.5,kb:.3,length:20,radius:20,hitRadius:50,n:1,wd:0,d:90,spd:400,spdFluc:0,distance:3450,disExtra:100},{name:"\u76f4\u5347\u673a\u5b50\u5f39",avatar:{sx:.6,sy:.6,sx1:.8,sy1:.8,st:.2,anime:{atlas:"bullet/enemy/bullet4",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit,streakEffect:EFFECT.spinBlt,a:cc.v2(.5,.5)},length:20,kb:.02,n:1,wd:0,d:22,spd:550,spdFluc:.2,distance:600}],bltMax:15,bltReload:.9,deathEffect:EFFECT.helicopterDeath,fly:1,attackSequence:[{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0}],pilot:{ctor:e("../ai/behaviors/boss/AIHelicopterBoss"),attackRange:650,attackDeg:180,seekRange:1e3}},RES.helicopter_boss=[{anime:"mob/zhishengji"}],ENTITY.helicopter_boss222222={id:"helicopter_boss222222",name:"\u5929\u7a7a\u730e\u624b",avatar:{ctor:i,animeName:"zhishengji2",anime:"mob/zhishengji",s:.6,moveSpd:50,dy:-48},fixedFlipX:1,g:800,machine:1,radius:75,moveSpd:150,weight:50,hp:13e3,boss:1,out:2e3,editor:1,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:6,blt:[{name:"\u76f4\u5347\u673a\u5b50\u5f39",ctor:a,avatar:{ctor:n,frm:"avatar/\u5bfc\u5f39",sx:.6,sy:.6,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileBulletStreak},bomb:{r1:50,r0:50,dmg1:6,dmg0:6,kb:300,effect:EFFECT.bombs},armorType:ARMOR_TYPE.bullet,rttSpd:120,rttSpdTime:.5,kb:.3,length:20,radius:20,hitRadius:50,n:1,wd:0,d:90,spd:400,spdFluc:0,distance:3450,disExtra:100},{name:"\u76f4\u5347\u673a\u5b50\u5f39",avatar:{sx:.6,sy:.6,sx1:.8,sy1:.8,st:.2,anime:{atlas:"bullet/enemy/bullet4",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit,streakEffect:EFFECT.spinBlt,a:cc.v2(.5,.5)},length:20,kb:.02,n:1,wd:0,d:22,spd:550,spdFluc:.2,distance:600}],bltMax:15,bltReload:.9,deathEffect:EFFECT.helicopterDeath,fly:1,attackSequence:[{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.1,x:60,deg:-135,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:2,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0}],pilot:{ctor:e("../ai/behaviors/boss/AIHelicopterBoss"),attackRange:650,attackDeg:180,seekRange:1e3}},RES.helicopter_boss222222=[{anime:"mob/zhishengji"}],cc._RF.pop()},{"../ai/behaviors/boss/AIHelicopterBoss":"AIHelicopterBoss","../ai/units/AIHelicopter":"AIHelicopter","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/Missile":"Missile","../entities/projectiles/MissileSprite":"MissileSprite","./define":"define"}],heroBuff:[function(e,t){"use strict";cc._RF.push(t,"675cecGEdRF/a1dyPCDuDga","heroBuff");var i=e("./Buff");BUFF_DEFINE.avoidDeath={symbol:i.getSymbol(),t:1/0,ctor:e("./AvoidDeathBuff"),hp:.5},BUFF_DEFINE.killExplosion={symbol:i.getSymbol(),t:1/0,ctor:e("./KillExplosionBuff"),bomb:{r1:70,r0:20,dmg1:10,dmg0:10,kb:100,effect:EFFECT.bombs}},BUFF_DEFINE.revive={symbol:i.getSymbol(),t:7,revive:1,ctor:e("./ReviveBuff"),protectEffect:EFFECT.invincible},BUFF_DEFINE.hpAtkSpd={symbol:i.getSymbol(),t:1/0,ctor:e("./ConditionBuff"),condition:{func:function(e){return e.hp>.8*e.hpMax},attr:[[ADD_SCALE,"atkSpd",.3]]}},cc._RF.pop()},{"./AvoidDeathBuff":"AvoidDeathBuff","./Buff":"Buff","./ConditionBuff":"ConditionBuff","./KillExplosionBuff":"KillExplosionBuff","./ReviveBuff":"ReviveBuff"}],hotUpdate:[function(e,t){"use strict";cc._RF.push(t,"572c0Ly2GRJ+oUr4bmt5dRp","hotUpdate");var i=e("../utils/security/md5"),a={checkCb:function(e){var t=0,i=!1;switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:console.log("checkCb: No local manifest file found, hot update skipped."),t=1;break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:console.log("checkCb: Fail to download manifest file, hot update skipped."),t=2;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:console.log("checkCb: Already up to date with the latest remote version.");break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:console.log("checkCb: New version found, please try to update. ("+this._am.getTotalBytes()+")"),i=!0;break;default:return void console.log("checkCb Code: "+e.getEventCode())}this._am.setEventCallback(null),this._updating=!1,this.checkFunc(t,i)},updateCb:function(e){console.log("updateCb Code: "+e.getEventCode());var t=0;switch(e.getEventCode()){case jsb.EventAssetsManager.UPDATE_PROGRESSION:this.progressFunc(e.getDownloadedFiles(),e.getTotalFiles(),e.getDownloadedBytes(),e.getTotalBytes());var i=e.getMessage();return void(i&&console.log("updateCb: Updated file: "+i));case jsb.EventAssetsManager.UPDATE_FINISHED:return console.log("updateCb: Update finished. "+e.getMessage()),this.saveConfig(1),this._updating=!1,void this.hotFunc(0,!0);case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:return console.log("updateCb: Already up to date with the latest remote version."),this.saveConfig(1),this._updating=!1,void this.hotFunc(0,!0);case jsb.EventAssetsManager.ERROR_UPDATING:return void console.log("updateCb: Asset update error: "+e.getAssetId()+", "+e.getMessage());case jsb.EventAssetsManager.ERROR_DECOMPRESS:return void console.log("updateCb: decompress error: "+e.getMessage());case jsb.EventAssetsManager.UPDATE_FAILED:if(console.log("updateCb: Update failed. "+e.getMessage()),this._canRetry=!0,this._updating=!1,this._retryCt>0)return this._retryCt--,void this.retry();t=1;break;case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:console.log("updateCb: No local manifest file found, hot update skipped."),t=2;break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:console.log("updateCb: Fail to download manifest file, hot update skipped."),t=3;break;default:return}t&&(this._am.setEventCallback(null),this._updating=!1,this.hotFunc(t,!1))},saveConfig:function(e){void 0===e&&(e=0);var t=jsb.fileUtils.getSearchPaths(),i=this._am.getLocalManifest().getSearchPaths();console.log("saveConfig:",JSON.stringify(t),JSON.stringify(i));for(var a=0;a<t.length;a++)i.includes(t[a])||i.push(t[a]);var n=window.BASE_VERSION||0,o=JSON.stringify({paths:i,init:e,baseVersion:n});console.log("save HotUpdateConfig:",o),cc.sys.localStorage.setItem("HotUpdateConfig",o)},loadConfig:function(){var e;try{var t=cc.sys.localStorage.getItem("HotUpdateConfig");e=JSON.parse(t)}catch(i){console.log("loadConfig HotUpdateConfig err:",i)}return e},restart:function(){cc.audioEngine.stopAll(),cc.game.restart()},setManifest:function(e){if(this._am.getState()===jsb.AssetsManager.State.UNINITED){var t=new jsb.Manifest(e,this._storagePath);this._am.loadLocalManifest(t,this._storagePath)}},checkHotUpdate:function(e){return console.log("checkHotUpdate call"),this._am?this._updating?(console.log("checkHotUpdate: checking or updating"),void e(2)):this._am.getLocalManifest()&&this._am.getLocalManifest().isLoaded()?(this.checkFunc=e,this._am.setEventCallback(this.checkCb.bind(this)),this._am.checkUpdate(),void(this._updating=!0)):(console.log("checkHotUpdate: Failed to load local manifest ..."),void e(3)):(console.log("checkHotUpdate: jsb.AssetsManager is null"),void e(1))},startHotUpdate:function(e,t){var i=this;return console.log("startHotUpdate call"),this._am?this._updating?(console.log("startHotUpdate: is updating started"),void t(2)):(this.hotFunc=t,this.progressCache=null,this.progressFunc=function(t,a,n,o){if(o){var r=i.progressCache;r||(i.progressCache=r={file:t,fileTotal:a,byte:n,byteTotal:o});var s=r.file+t,c=r.byte+n;r.fileTmp=s,r.byteTmp=c,e(s,r.fileTotal,c,r.byteTotal)}},this._am.setEventCallback(this.updateCb.bind(this)),this._am.update(),void(this._updating=!0)):(console.log("startHotUpdate: jsb.AssetsManager is null"),void t(1))},retry:function(){if(!this._updating&&this._canRetry){this._canRetry=!1,console.log("Retry failed Assets..."),this._am.downloadFailedAssets(),this._updating=!0;var e=this.progressCache;e.file=e.fileTmp,e.byte=e.byteTmp}},handleManifest:function(e){NGINX,DATA_HOST,CH,BUILD_VERSION,encodeURIComponent(OS),encodeURIComponent(cc.sys.osVersion),window.nativeSdk&&nativeSdk.getVersion&&(nativeSdk.getVersion(),window.BASE_VERSION);var t=storage.get("recent_uuid");return t&&encodeURIComponent(t),e.remoteManifestUrl="http://192.168.0.156:90011/tank/android/project.manifest",e.remoteVersionUrl="http://192.168.0.156:90011/tank/android/version.manifest",console.log("handleManifest align",e.remoteManifestUrl),e},init:function(){var e=this;console.log("hotUpdate init"),this._retryCt=5,this._storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"backpack-remote-assets",console.log("init: Storage path for remote asset : "+this._storagePath),this.versionCompareHandle=function(e,t){console.log("JS Custom Version Compare: version A is "+e+", version B is "+t);for(var i=e.split("."),a=t.split("."),n=0;n<i.length;++n){var o=parseInt(i[n]),r=parseInt(a[n]||0);if(o!==r)return o-r}return a.length>i.length?-1:0},console.log("init: new jsb.AssetsManager",this._storagePath),this._am=new jsb.AssetsManager("",this._storagePath,this.versionCompareHandle),this.lastUpdateTime=this.lastAddTime=0,this._am.setVerifyCallback(function(t,a){console.log("VerifyCallback");var n=Date.now();n-e.lastUpdateTime>1e3&&(e.lastUpdateTime=e.lastAddTime=n,console.log("VerifyCallback:\u5361\u987f,\u7ebf\u7a0b\u6570\u8c03\u6574\u4e3a1"),e._am.setMaxConcurrentTask(1));var o=a.compressed,r=a.md5,s=a.path;if(a.size,o)return console.log("Verification passed : "+s),!0;if(!jsb.fileUtils.isFileExist(t))return console.log("Verification skip : "+t),!1;var c=i(jsb.fileUtils.getDataFromFile(t));return c!==r?(console.log("Verification failed : "+s+" ("+c+"!="+r+")"),!1):(console.log("Verification passed : "+s+" ("+c+"=="+r+")"),!0)}),cc.sys.os===cc.sys.OS_ANDROID&&(this._am.setMaxConcurrentTask(2),console.log("Max concurrent tasks count have been limited to 2"))},update:function(e){var t=Date.now();if(this._am&&this._updating&&e<.1&&t-this.lastAddTime>500){this.lastAddTime=t;var i=this._am.getMaxConcurrentTask();i<20&&(this._am.setMaxConcurrentTask(++i),console.log("update: \u7ebf\u7a0b\u6570\u8c03\u6574\u4e3a "+i))}this.lastUpdateTime=t},verify:function(e,t,i){var a=this,n={packageUrl:"",remoteManifestUrl:"",remoteVersionUrl:"",version:""+BUILD_VERSION,assets:{},searchPaths:[]};jsb.fileUtils.isFileExist("assets/project.manifest")?(n=JSON.parse(jsb.fileUtils.getStringFromFile("assets/project.manifest")),console.log("loadManifest: innerManifestPath","assets/project.manifest")):console.log("loadManifest: innerManifestPath","null==========================");var o=this._storagePath+"/project.manifest";if(jsb.fileUtils.isFileExist(o)){var r=this.loadConfig(),s=JSON.parse(jsb.fileUtils.getStringFromFile(o));if(r&&r.init){console.log("set local manifest",o);var c=JSON.stringify(this.handleManifest(s));jsb.fileUtils.writeStringToFile(c,o),this.setManifest(c),i(0,!1)}else{console.log("check local manifest",o);var l=[],d=0;for(var h in s.assets){var u=s.assets[h],p=n.assets[h];p&&p.md5===u.md5||(l.push(h),d+=u.size)}var f=0,m=0,g=l.length,v=0;(function e(){if(console.log("checkFunc:",v,l.length),v<l.length){for(var n=0;n<10&&!(v>=l.length);n++){var c=l[v],h=s.assets[c],u=a._storagePath+"/"+c;if(console.log("assets check:",n,u),m+=h.size,jsb.fileUtils.isFileExist(u)){var p=jsb.fileUtils.getFileSize(u);p!==h.size&&(console.log("assets size not matched:",c,p,h.size),delete s.assets[c],f++)}else console.log("assets not exists:",c),delete s.assets[c],f++;v++}t(v,g,m,d),setTimeout(e,0)}else{f>0&&(s.version="0",console.log("reset localManifest.version",s.version));var y=JSON.stringify(a.handleManifest(s));jsb.fileUtils.writeStringToFile(y,o),a.setManifest(y);var b=!1;f<=0&&(a.saveConfig(1),b=!r,console.log("check hotUpdateData, save searchPath,restart:"+b)),console.log("Hot update is ready, please check or directly update."),i(0,b)}})()}}else console.log("set inner manifest","assets/project.manifest"),this.setManifest(JSON.stringify(this.handleManifest(n))),i(0,!1)},check:function(e,t,i,a){cc.sys.isNative,a(0,!1)}};t.exports=a,cc._RF.pop()},{"../utils/security/md5":"md5"}],hurtNumEffect:[function(e,t){"use strict";cc._RF.push(t,"35664uZK7NM+oqbxdND9WYM","hurtNumEffect"),cc._RF.pop()},{}],ids:[function(e,t){"use strict";cc._RF.push(t,"c6738ibsbtKeaCMCs5EZhoI","ids"),window.CORE_VERSION=5,window.STEP_RATE=1,window.STEP_TIME=.1,window.ZERO=1e-4,window.REMOVE_TIME=10,window.SPEED=220,window.SPEED_VAR=20,window.DROP_BOX=".0",window.DROP_HP=".1",window.DROP_EP=".2",window.DROP_ATTACK=".3",window.DROP_GOLD=".9",window.BTN_DOWN=1,window.BTN_UP=2,window.BTN_CLICK=3,window.SIGN_INDEX=0,window.SIGN_SKILLS=[1,2,3,4],window.SIGN_ATTACK=5,window.SIGN_MOVE=6,window.SIGN_SELECT=7,window.SIGN_ROTATE=8,window.SIGN_STEP=9,window.SIGN_CHANGE=10,window.ENTITY={},window.SKILL_DEFINE={},window.BULLET_DEFINE={},window.BUFF_DEFINE={},window.NO_ATTACK=1,window.NO_ROTATE=2,window.NO_MOVE=3,window.NO_SKILLS=4,window.NO_SKILL0=5,window.NO_SKILL1=6,window.NO_SKILL2=7,window.NO_SKILL3=8,window.NO_SKILL=[NO_SKILL0,NO_SKILL1,NO_SKILL2,NO_SKILL3],window.NO_HURT=9,window.FLY=10,window.FLOAT=11,window.NO_CONTACT=12,window.NO_ENTITY=13,window.NO_BULLET=14,window.NO_GROUND=15,window.NO_BORDER=16,window.ADD=1,window.ADD_SCALE=2,window.ADD_COVER=3,window.MUT_SCALE=4,window.SET_FLAG=5,window.SKILL_STATUS={RESET:0,READY:1,START_CHARGE:2,END_CHARGE:3,START_CAST:4,END_CAST:5,FROZEN:6},window.AIM_NULL=0,window.AIM_ENEMY=1,window.AIM_PARTNER=2,window.AIM_FREE=3,window.VEHICLE_BASE="a",window.MACHINE_GUN="b",window.CANNON_GUN="c",window.FIRE_GUN="d",window.OPERATOR="0",window.E_SOLDIOR="e0",window.E_EXPLODER="b0",window.E_ROCKET="r0",cc._RF.pop()},{}],itemBlock:[function(e,t){"use strict";cc._RF.push(t,"7a13eaP3z1HLaN1TA5ep6Mb","itemBlock"),window.ItemBlockDefine={tank:{adapt:["weaponTeam"]},weaponTeamForge:{adapt:["weapon"]}},cc.Class({extends:cc.Component,init:function(e,t){this.cfg=t,this.width=140,this.height=100,this.game=e,this.interactable=!0,this.blockType=t.blockType,this.updatePosition(t.x,t.y),this.node.width=this.width,this.node.height=this.height,t.noTouch||this.initTouch(e),this.initAvatar()},updatePosition:function(e,t){e&&(this.node.x=e),t&&(this.node.y=t)},initAvatar:function(){if(this.cfg.bg){var e=this.game.effectMgr.createSprite(0,0,"checkpoint/item_bg");this.node.addChild(e),this.avatar=e}},setContent:function(e){this.content=e,this.resetContentPos()},initTouch:function(){this.touchNode=this.node;var e=this.touchNode;e.on(cc.Node.EventType.TOUCH_START,function(e){var t=e.getLocation(),i=e.getID();this.onTouchBegan(t,i)&&e.stopPropagation()},this),e.on(cc.Node.EventType.TOUCH_MOVE,function(e){var t=e.getLocation(),i=e.getID();this.onTouchMoved(t,i)},this),e.on(cc.Node.EventType.TOUCH_END,function(e){var t=e.getLocation(),i=e.getID();this.onTouchEnded(t,i)},this),e.on(cc.Node.EventType.TOUCH_CANCEL,function(e){var t=e.getLocation(),i=e.getID();this.onTouchCanceled(t,i)},this),this.touch={}},checkCollision:function(e,t,i){var a=i.node.convertToWorldSpaceAR(cc.v2(0,0)),n=this.game.gameCamera.getComponent(cc.Camera).getWorldToScreenPoint(a);if(cc.log("checkCollision",i.blockType,Math.abs(n.x-e),i.width/2,Math.abs(n.y-t),i.height/2),Math.abs(n.x-e)<=i.width/2&&Math.abs(n.y-t)<=i.height/2&&i.node.parent.active)return cc.log("checkCollision",3),this.interactContent(i)},interactContent:function(e){var t;if("move"==(t=e.interactable?this.content.onInteract(e):"cancel")){var i=this.content;this.content.setBlock(e),i.onMove&&i.onMove()}else if("swap"==t){var a=e.content.onSwapt(this.content),n=this.content.onSwapt(e.content);if(!a||!n)return void this.resetContentPos();var o=e,r=this.content,s=e.content;cc.log("swap1",this.content.avatarName,o.content.avatarName),r.setBlock(o,!0),s.setBlock(this,!0),cc.log("swap2",this.content.avatarName,o.content.avatarName),a=e.content.onSwapt2(this.content),n=this.content.onSwapt2(e.content,!0)}else"cancel"==t&&this.resetContentPos();if("cancel"!=t)return!0},updateContentPos:function(e,t){var i=this.content.getCenterPos(e,t);this.content.node.x=i.x,this.content.node.y=i.y},resetContentPos:function(){if(this.content){var e=this.node.convertToWorldSpaceAR(cc.v2(0,0)),t=this.content.getPosInBlock(e.x,e.y);this.content.node.x=t.x,this.content.node.y=t.y}},showGuideLine:function(e,t){var i,a;if(console.log("showGuideLine"),this.content){if(this.game.merchantMode)return;this.game.forgeMode?i="forge":this.game.equipmentMode&&("weapon"!=this.content.define.type&&"equipment"!=this.content.define.type||(i="weaponTeamForge",a="moveToWeaponTeamForge"))}i&&(cc.log("create guideline success!"),this.guideLineFromContentToBlockType(i,a,e,t)),this.game.selectFrame&&(this.game.selectFrame.destroy(),this.game.selectFrame=null)},unShowGuideLine:function(){for(var e in cc.log("unShowGuideLine",this.guideLines),this.guideLines)this.guideLines[e].destroy();this.guideLines=null,this.game.updateSelectFrame()},guideLineFromContentToBlockType:function(e,t,i,a){var n;if("weaponTeam"==e?n=this.game.tankBlocks:"forge"==e?n=this.game.forgeBlocks:"weaponTeamForge"==e&&(n=this.game.weaponTeamForgeBlocks),this.guideLines=[],a){var o=this.createGuideLineToBlock(a,i);if(this.guideLines.push(o),i)return;o=this.createGuideFrame(a),this.guideLines.push(o)}else for(var r in n){var s=n[r];if(t){if("exist"==t&&!s.content)continue;if("empty"==t&&s.content)continue;if("moveToWeaponTeamForge"==t){if("weaponTeamForge"==this.blockType)continue;if(s.content&&(s.content.define.id!=this.content.define.id||s.content.lvl!=this.content.lvl))continue;if(this.content){if(this.content.define.type!=s.weaponTeamForgeType)continue;if("equipment"==this.content.define.type&&!this.game.tankBlocks[s.index].content)continue}}}if(o=this.createGuideLineToBlock(s,i),this.guideLines.push(o),i)return;o=this.createGuideFrame(s),this.guideLines.push(o)}},createGuideLineToBlock:function(e,t){var i=this.game.effectMgr.createSprite(0,0,"");(t=t||this.content.node).addChild(i);var a=function(){var t=e.node.convertToWorldSpaceAR(cc.v2(0,0)),a=i.parent.convertToNodeSpaceAR(t),n=kit.vector2Degree(a.y,a.x);i.angle=-n;var o=kit.norm(a.y,a.x);i.distance=o};a(),i.sprite.schedule(a);for(var n=1;n<=15;n++){var o=this.createGuideLineArrow();o.y=70*n,o.owner=i,i.addChild(o)}return i},createGuideFrame:function(e){var t=this.game.effectMgr.createSprite(0,0,"checkpoint/frame");return t.scale=.8,t.runAction(cc.sequence(cc.scaleTo(.2,.9),cc.scaleTo(.2,.8)).repeatForever()),e.node.addChild(t,11),t},createGuideLineArrow:function(){var e=this.game.effectMgr.createSprite(0,0,"checkpoint/arrow");e.angle=90;var t=function(t){var i=1;e.owner&&(i=e.owner.distance/1050),e.y+=100*t,e.y>1050&&(e.y-=1050),e.y>1050*i-50?e.opacity=255-5*(e.y-(1050*i-50)):e.y<80*i?e.opacity=255*e.y/80/i:e.opacity=255};return e.sprite.schedule(t),t(0),e},onTouchBegan:function(e,t){var i=this;if(!this.content||!this.interactable||this.game.repairMode)return!this.interactable&&this.game.forgeMode&&menuManager.pop("handbook_help",{}),void(this.interactable||"weapon"!=this.weaponTeamForgeType||this.game.tankBlocks[this.index]&&this.game.repairWeaponTeamWithAD(this.index,function(){i.interactable=!0}));cc.log("onTouchBegan");var a=this.node.convertToWorldSpaceAR(cc.v2(0,0)),n=this.game.gameCamera.getComponent(cc.Camera).getWorldToScreenPoint(a),o=e.x-n.x,r=e.y-n.y;return Math.abs(o)<this.width/2&&Math.abs(r)<this.height/2?(this.content.node.oParent=this.content.node.parent,this.content.node.parent=this.game.node,this.content.node.ozIndex=this.content.node.zIndex,this.content.node.zIndex=999,this.content.node.oScale=this.content.node.scale,this.content.node.scale=1,this.updateContentPos(e.x,e.y),this.touch[t]=!0,this.justTouchBegan=!0,this.touchPos=e,setTimeout(function(){i.justTouchBegan=!1},500),this.showGuideLine(),this.game.effectMgr.playEffect("sound/checkpoint/pick_item"),!0):void 0},onTouchMoved:function(e,t){this.touch[t]&&this.updateContentPos(e.x,e.y)},onTouchEnded:function(e,t){if(this.touch[t]){if(this.content.node.parent=this.content.node.oParent,this.content.node.zIndex=this.content.node.ozIndex,this.content.node.scale=this.content.node.oScale,this.game.effectMgr.playEffect("sound/checkpoint/drop_item"),this.game.checkBlocks(e.x,e.y,this)||this.resetContentPos(),this.touch[t]=!1,this.unShowGuideLine(),("bag"==this.blockType||"weaponTeamForge"==this.blockType)&&this.content&&this.touchPos&&kit.norm(this.touchPos.y-e.y,this.touchPos.x-e.x)<50&&this.justTouchBegan){var i=this;if(this.game.merchantMode){var a;if("weapon"==this.content.define.type)a=(1==(n=this.content.lvl)?50:2==n&&100)||3==n&&200||4==n&&400||5==n&&800,a/=3;else if("equipment"==this.content.define.type)a=(1==(n=this.content.lvl)?20:2==n&&40)||3==n&&80||4==n&&160||5==n&&320,a/=3;else if("material"==this.content.define.type){var n;a=(1==(n=this.content.lvl)?15:2==n&&20)||3==n&&40||80,a/=3}return void menuManager.pop("sell_item",{block:this,game:i.game,itemId:this.content.define.id,lvl:this.content.lvl,cost:a})}this.game.noItemInfoPop||cc.resources.load("checkpoint/itemInfoBox",cc.Prefab,function(e,t){var a=cc.instantiate(t),n=a.getComponent("itemInfoBox"),o=i.content.define;n.init(i.game,o,i.content.lvl,"bag"==i.blockType&&function(){i.content.remove()}||"weaponTeamForge"==i.blockType&&function(){i.content.removeWeaponTeam(i),i.content.remove()},null,null,i.content.hp),a.x=0,a.y=0,i.game.node.addChild(a,1e3)})}return cc.game.emit("onItemInteract"),!0}},onTouchCanceled:function(e,t){this.onTouchEnded(e,t)},setContentGetCb:function(e){this.contentGetCb=e},setContentClearCb:function(e){this.contentClearCb=e},onContentGet:function(){this.contentGetCb&&this.contentGetCb()},onContentClear:function(){this.contentGetCb&&this.contentGetCb()},clearContent:function(){this.content=null,this.contentClearCb&&this.contentClearCb()},setInteractable:function(e,t){this.interactable=e,this.avatar&&(this.avatar.opacity=e?255:128),this.content&&this.content.avatar&&(this.content.setOpacity(e?255:128),this.content.node.shakeAction&&(this.content.node.stopAction(this.content.node.shakeAction),this.content.node.shakeAction=null),t&&e&&(this.content.node.shakeAction=this.content.node.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.delayTime(.5)).repeatForever())))}}),cc._RF.pop()},{}],itemDefine:[function(e,t){"use strict";cc._RF.push(t,"b6bf2Bg+8hGALIowo6k2bLf","itemDefine");var i=e("./checkpointWeapon"),a=e("./checkpointEquipment");for(var n in e("../components/combat/buffs/Buff"),window.ItemDefine={machine_gun:{type:"weapon",avatar:{anime:"weapon/jiqiang",animeName:"jiqiang",icon:"checkpoint/item/jiqiang"},name:"\u673a\u67aa",class:"\u673a\u67aa",des:"\u7ecf\u5178\u7684\u6b66\u5668\uff0c\u9002\u5e94\u4efb\u4f55\u4f5c\u6218\u73af\u5883!",gameId:"b"},cannon:{type:"weapon",avatar:{anime:"weapon/dapao",animeName:"dapao",icon:"checkpoint/item/dapao"},name:"\u52a0\u519c\u70ae",class:"\u706b\u70ae",des:"\u5a01\u529b\u5f3a\u52b2\u7684\u706b\u70ae\uff0c\u5bf9\u5efa\u7b51\u5c24\u4e3a\u6709\u6548!",gameId:"c"},flame_thrower:{type:"weapon",avatar:{anime:"weapon/huoyanpensheqi",animeName:"huoyanpensheqi",icon:"checkpoint/item/penhuo"},name:"\u706b\u7130\u55b7\u5c04\u5668",class:"\u706b\u7130",des:"\u77ed\u8ddd\u79bb\u7684\u738b\u8005\uff0c\u4eba\u7c7b\u7684\u514b\u661f\uff01",gameId:"d"},a:{name:"\u94c1\u7247",avatar:{sprite:"item/\u94c1\u7247"},type:"material"},b:{name:"\u74f6\u76d6",avatar:{sprite:"item/\u74f6\u76d6"},type:"material"},c:{name:"\u80f6\u5e03",avatar:{sprite:"item/\u80f6\u5e03"},type:"material"},d:{name:"\u94c1\u9489",avatar:{sprite:"item/\u94c1\u9489"},type:"material"},e:{lvl:2,name:"\u87ba\u4e1d",avatar:{sprite:"item/\u87ba\u4e1d"},type:"material"},f:{lvl:2,name:"\u50ac\u5316\u5242",avatar:{sprite:"item/\u50ac\u5316\u5242"},type:"material"},g:{lvl:2,name:"\u9f7f\u8f6e",avatar:{sprite:"item/\u9f7f\u8f6e"},type:"material",chapter:3},h:{lvl:2,name:"\u5f39\u7c27",avatar:{sprite:"item/\u5f39\u7c27"},type:"material",chapter:4},i:{lvl:3,name:"\u94a2\u677f",avatar:{sprite:"item/\u94a2\u677f"},type:"material"},j:{lvl:3,name:"\u4f20\u52a8\u8f74",avatar:{sprite:"item/\u4f20\u52a8\u8f74"},type:"material"},k:{lvl:3,name:"\u53d1\u52a8\u673a",avatar:{sprite:"item/\u53d1\u52a8\u673a"},type:"material",chapter:3},garbage:{name:"\u5e9f\u94c1",des:"\u7194\u70bc\u5931\u8d25\u7684\u4ea7\u7269\uff0c\u5927\u6982\u6ca1\u4ec0\u4e48\u7528\u9014",avatar:{sprite:"item/garbage"}},weaponTeam:{ctor:e("./weaponTeam"),type:"weaponTeam"},ab:{name:"\u67aa\u7ba1",des:"+10%\u653b\u51fb",ctor:a,type:"equipment",avatar:{sprite:"item/\u67aa\u7ba1"},attr:[[ADD_SCALE,"atkScale",.1]]},ab2:{lvl:2,name:"\u67aa\u7ba1",des:"+15%\u653b\u51fb",ctor:a,type:"equipment",avatar:{sprite:"item/\u67aa\u7ba1"},attr:[[ADD_SCALE,"atkScale",.15]]},ab3:{lvl:3,name:"\u67aa\u7ba1",des:"+25%\u653b\u51fb",ctor:a,type:"equipment",avatar:{sprite:"item/\u67aa\u7ba1"},attr:[[ADD_SCALE,"atkScale",.25]]},ab4:{lvl:4,name:"\u67aa\u7ba1",des:"+40%\u653b\u51fb",ctor:a,type:"equipment",avatar:{sprite:"item/\u67aa\u7ba1"},attr:[[ADD_SCALE,"atkScale",.4]]},ab5:{lvl:5,name:"\u67aa\u7ba1",des:"+60%\u653b\u51fb",ctor:a,type:"equipment",avatar:{sprite:"item/\u67aa\u7ba1"},attr:[[ADD_SCALE,"atkScale",.6]]},bc:{name:"\u9632\u62a4\u7532\u7247",des:"\u6b66\u5668\u8840\u91cf+20%",ctor:a,type:"equipment",avatar:{sprite:"item/\u9632\u62a4\u7532\u7247"},attr:[[ADD_SCALE,"hpMax",.2]]},bc2:{lvl:2,name:"\u9632\u62a4\u7532\u7247",des:"\u6b66\u5668\u8840\u91cf+30%",ctor:a,type:"equipment",avatar:{sprite:"item/\u9632\u62a4\u7532\u7247"},attr:[[ADD_SCALE,"hpMax",.3]]},bc3:{lvl:3,name:"\u9632\u62a4\u7532\u7247",des:"\u6b66\u5668\u8840\u91cf+45%",ctor:a,type:"equipment",avatar:{sprite:"item/\u9632\u62a4\u7532\u7247"},attr:[[ADD_SCALE,"hpMax",.45]]},bc4:{lvl:4,name:"\u9632\u62a4\u7532\u7247",des:"\u6b66\u5668\u8840\u91cf+65%",ctor:a,type:"equipment",avatar:{sprite:"item/\u9632\u62a4\u7532\u7247"},attr:[[ADD_SCALE,"hpMax",.65]]},bc5:{lvl:5,name:"\u9632\u62a4\u7532\u7247",des:"\u6b66\u5668\u8840\u91cf+90%",ctor:a,type:"equipment",avatar:{sprite:"item/\u9632\u62a4\u7532\u7247"},attr:[[ADD_SCALE,"hpMax",.9]]},fg:{name:"\u8f66\u957f\u955c",des:"\u66b4\u51fb\u51e0\u7387+12%",lvl:2,ctor:a,type:"equipment",avatar:{sprite:"item/\u8f66\u957f\u955c"},attr:[[ADD_SCALE,"critChance",.12]]},fg2:{lvl:3,name:"\u8f66\u957f\u955c",des:"\u66b4\u51fb\u51e0\u7387+16%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8f66\u957f\u955c"},attr:[[ADD_SCALE,"critChance",.16]]},fg3:{lvl:4,name:"\u8f66\u957f\u955c",des:"\u66b4\u51fb\u51e0\u7387+20%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8f66\u957f\u955c"},attr:[[ADD_SCALE,"critChance",.2]]},fg4:{lvl:5,name:"\u8f66\u957f\u955c",des:"\u66b4\u51fb\u51e0\u7387+24%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8f66\u957f\u955c"},attr:[[ADD_SCALE,"critChance",.24]]},ac:{name:"\u8ddf\u8e2a\u5bfc\u5f39",des:"\u53d1\u5c04\u4e00\u679a\u8ddf\u8e2a\u5bfc\u5f39\uff0c\u57fa\u7840\u4f24\u5bb3100%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8ddf\u8e2a\u5bfc\u5f39"},buff:[{symbol:null,rocketOffset:5,t:1/0,ctor:e("../components/combat/buffs/SummonBuff"),effect:EFFECT.rocketItem,dt:2,summon:{ctor:e("../entities/projectiles/Missile"),noContact:1,avatar:{ctor:e("../entities/projectiles/MissileSprite"),frm:"avatar/\u5bfc\u5f39",sx:.4,sy:.4,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileStreak},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,length:120,radius:20,hitRadius:50,n:1,wd:1,d:5,spd:800,spdFluc:0,distance:3450,disExtra:100,offsetDeg:10,rttSpd:40,rttSpdScale0:1,moveSpdScale0:.3,moveSpdTime:.3}}]},ac2:{lvl:2,name:"\u8ddf\u8e2a\u5bfc\u5f39",des:"\u53d1\u5c04\u4e00\u679a\u8ddf\u8e2a\u5bfc\u5f39\uff0c\u57fa\u7840\u4f24\u5bb3150%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8ddf\u8e2a\u5bfc\u5f39"},buff:[{symbol:null,rocketOffset:5,t:1/0,ctor:e("../components/combat/buffs/SummonBuff"),effect:EFFECT.rocketItem,dt:2,summon:{ctor:e("../entities/projectiles/Missile"),noContact:1,avatar:{ctor:e("../entities/projectiles/MissileSprite"),frm:"avatar/\u5bfc\u5f39",sx:.45,sy:.45,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileStreak},bomb:{r1:50,r0:50,dmg1:30,dmg0:30,kb:300,effect:EFFECT.bombs},kb:.3,length:120,radius:20,hitRadius:50,n:1,wd:1,d:5,spd:800,spdFluc:0,distance:3450,disExtra:100,offsetDeg:10,rttSpd:40,rttSpdScale0:1,moveSpdScale0:.3,moveSpdTime:.3}}]},ac3:{lvl:3,name:"\u8ddf\u8e2a\u5bfc\u5f39",des:"\u53d1\u5c04\u4e00\u679a\u8ddf\u8e2a\u5bfc\u5f39\uff0c\u57fa\u7840\u4f24\u5bb3200%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8ddf\u8e2a\u5bfc\u5f39"},buff:[{symbol:null,rocketOffset:5,t:1/0,ctor:e("../components/combat/buffs/SummonBuff"),effect:EFFECT.rocketItem,dt:2,summon:{ctor:e("../entities/projectiles/Missile"),noContact:1,avatar:{ctor:e("../entities/projectiles/MissileSprite"),frm:"avatar/\u5bfc\u5f39",sx:.5,sy:.5,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileStreak},bomb:{r1:50,r0:50,dmg1:40,dmg0:40,kb:300,effect:EFFECT.bombs},kb:.3,length:120,radius:20,hitRadius:50,n:1,wd:1,d:5,spd:800,spdFluc:0,distance:3450,disExtra:100,offsetDeg:10,rttSpd:40,rttSpdScale0:1,moveSpdScale0:.3,moveSpdTime:.3}}]},ac4:{lvl:4,name:"\u8ddf\u8e2a\u5bfc\u5f39",des:"\u53d1\u5c04\u4e00\u679a\u8ddf\u8e2a\u5bfc\u5f39\uff0c\u57fa\u7840\u4f24\u5bb3250%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8ddf\u8e2a\u5bfc\u5f39"},buff:[{symbol:null,rocketOffset:5,t:1/0,ctor:e("../components/combat/buffs/SummonBuff"),effect:EFFECT.rocketItem,dt:2,summon:{ctor:e("../entities/projectiles/Missile"),noContact:1,avatar:{ctor:e("../entities/projectiles/MissileSprite"),frm:"avatar/\u5bfc\u5f39",sx:.55,sy:.55,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileStreak},bomb:{r1:50,r0:50,dmg1:50,dmg0:50,kb:300,effect:EFFECT.bombs},kb:.3,length:120,radius:20,hitRadius:50,n:1,wd:1,d:5,spd:800,spdFluc:0,distance:3450,disExtra:100,offsetDeg:10,rttSpd:40,rttSpdScale0:1,moveSpdScale0:.3,moveSpdTime:.3}}]},ac5:{lvl:5,name:"\u8ddf\u8e2a\u5bfc\u5f39",des:"\u53d1\u5c04\u4e00\u679a\u8ddf\u8e2a\u5bfc\u5f39\uff0c\u57fa\u7840\u4f24\u5bb3300%",ctor:a,type:"equipment",avatar:{sprite:"item/\u8ddf\u8e2a\u5bfc\u5f39"},buff:[{symbol:null,rocketOffset:5,t:1/0,ctor:e("../components/combat/buffs/SummonBuff"),effect:EFFECT.rocketItem,dt:2,summon:{ctor:e("../entities/projectiles/Missile"),noContact:1,avatar:{ctor:e("../entities/projectiles/MissileSprite"),frm:"avatar/\u5bfc\u5f39",sx:.6,sy:.6,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileStreak},bomb:{r1:50,r0:50,dmg1:40,dmg0:40,kb:300,effect:EFFECT.bombs},kb:.3,length:120,radius:20,hitRadius:50,n:1,wd:1,d:5,spd:800,spdFluc:0,distance:3450,disExtra:100,offsetDeg:10,rttSpd:40,rttSpdScale0:1,moveSpdScale0:.3,moveSpdTime:.3}}]},ij:{lvl:3,name:"\u4f9b\u5f39\u5668",des:"\u653b\u51fb\u901f\u5ea6+20%",ctor:a,type:"equipment",avatar:{sprite:"item/\u4f9b\u5f39\u5668"},attr:[[ADD_SCALE,"atkSpd",.2]]},ij2:{lvl:4,name:"\u4f9b\u5f39\u5668",des:"\u653b\u51fb\u901f\u5ea6+25%",ctor:a,type:"equipment",avatar:{sprite:"item/\u4f9b\u5f39\u5668"},attr:[[ADD_SCALE,"atkSpd",.25]]},ij3:{lvl:5,name:"\u4f9b\u5f39\u5668",des:"\u653b\u51fb\u901f\u5ea6+30%",ctor:a,type:"equipment",avatar:{sprite:"item/\u4f9b\u5f39\u5668"},attr:[[ADD_SCALE,"atkSpd",.3]]},ef:{lvl:2,ctor:a,name:"\u53cc\u91cd\u5b50\u5f39",des:"\u589e\u52a0\u526f\u706b\u529b\u70b9\uff0c\u8fdb\u884c\u53cc\u91cd\u653b\u51fb\n\u526f\u706b\u529b\u70b9\u653b\u51fb\u529b\u4e3a40%",type:"equipment",avatar:{sprite:"item/\u53cc\u91cd\u5b50\u5f39"},buff:[{symbol:null,t:1/0,effect:EFFECT.doubleAttack,dmgScale:.4,shotOffset:5,ctor:e("../components/combat/buffs/DoubleShotBuff")}]},ef2:{lvl:3,ctor:a,name:"\u53cc\u91cd\u5b50\u5f39",des:"\u589e\u52a0\u526f\u706b\u529b\u70b9\uff0c\u8fdb\u884c\u53cc\u91cd\u653b\u51fb\n\u526f\u706b\u529b\u70b9\u653b\u51fb\u529b\u4e3a60%",type:"equipment",avatar:{sprite:"item/\u53cc\u91cd\u5b50\u5f39"},buff:[{symbol:null,t:1/0,effect:EFFECT.doubleAttack,dmgScale:.6,shotOffset:5,ctor:e("../components/combat/buffs/DoubleShotBuff")}]},ef3:{lvl:4,ctor:a,name:"\u53cc\u91cd\u5b50\u5f39",des:"\u589e\u52a0\u526f\u706b\u529b\u70b9\uff0c\u8fdb\u884c\u53cc\u91cd\u653b\u51fb\n\u526f\u706b\u529b\u70b9\u653b\u51fb\u529b\u4e3a80%",type:"equipment",avatar:{sprite:"item/\u53cc\u91cd\u5b50\u5f39"},buff:[{symbol:null,t:1/0,effect:EFFECT.doubleAttack,dmgScale:.8,shotOffset:5,ctor:e("../components/combat/buffs/DoubleShotBuff")}]},ef4:{lvl:5,ctor:a,name:"\u53cc\u91cd\u5b50\u5f39",des:"\u589e\u52a0\u526f\u706b\u529b\u70b9\uff0c\u8fdb\u884c\u53cc\u91cd\u653b\u51fb\n\u526f\u706b\u529b\u70b9\u653b\u51fb\u529b\u4e3a100%",type:"equipment",avatar:{sprite:"item/\u53cc\u91cd\u5b50\u5f39"},buff:[{symbol:null,t:1/0,effect:EFFECT.doubleAttack,dmgScale:1,shotOffset:5,ctor:e("../components/combat/buffs/DoubleShotBuff")}]},eg:{lvl:2,ctor:a,name:"\u9ad8\u80fd\u5f39\u836f",des:"\u66b4\u51fb\u4f24\u5bb3+120%",type:"equipment",avatar:{sprite:"item/\u9ad8\u80fd\u5f39\u836f"},attr:[[ADD,"critBonus",1.2]]},eg2:{lvl:3,ctor:a,name:"\u9ad8\u80fd\u5f39\u836f",des:"\u66b4\u51fb\u4f24\u5bb3+200%",type:"equipment",avatar:{sprite:"item/\u9ad8\u80fd\u5f39\u836f"},attr:[[ADD,"critBonus",2]]},eg3:{lvl:4,ctor:a,name:"\u9ad8\u80fd\u5f39\u836f",des:"\u66b4\u51fb\u4f24\u5bb3+280%",type:"equipment",avatar:{sprite:"item/\u9ad8\u80fd\u5f39\u836f"},attr:[[ADD,"critBonus",2.8]]},eg4:{lvl:5,ctor:a,name:"\u9ad8\u80fd\u5f39\u836f",des:"\u66b4\u51fb\u4f24\u5bb3+360%",type:"equipment",avatar:{sprite:"item/\u9ad8\u80fd\u5f39\u836f"},attr:[[ADD,"critBonus",3.6]]},gh:{lvl:2,type:"equipment",name:"\u55dc\u8840\u5b50\u5f39",des:"\u70ed\u529b\u653b\u51fb\u4f24\u5bb3+20%",avatar:{sprite:"item/\u55dc\u8840\u5b50\u5f39"},attr:[[ADD_SCALE,"heatScale",.2]]},gh2:{lvl:3,type:"equipment",name:"\u55dc\u8840\u5b50\u5f39",des:"\u70ed\u529b\u653b\u51fb\u4f24\u5bb3+30%",avatar:{sprite:"item/\u55dc\u8840\u5b50\u5f39"},attr:[[ADD_SCALE,"heatScale",.3]]},gh3:{lvl:4,type:"equipment",name:"\u55dc\u8840\u5b50\u5f39",des:"\u70ed\u529b\u653b\u51fb\u4f24\u5bb3+40%",avatar:{sprite:"item/\u55dc\u8840\u5b50\u5f39"},attr:[[ADD_SCALE,"heatScale",.4]]},gh4:{lvl:5,type:"equipment",name:"\u55dc\u8840\u5b50\u5f39",des:"\u70ed\u529b\u653b\u51fb\u4f24\u5bb3+50%",avatar:{sprite:"item/\u55dc\u8840\u5b50\u5f39"},attr:[[ADD_SCALE,"heatScale",.5]]},eh:{lvl:2,type:"equipment",name:"\u98ce\u51b7\u8bbe\u5907",des:"\u70ed\u529b\u5c04\u51fb\u65f6\u95f4\u6301\u7eed+30%",avatar:{sprite:"item/\u98ce\u51b7\u8bbe\u5907"},attr:[[ADD_SCALE,"heatTime",.3]]},eh2:{lvl:3,type:"equipment",name:"\u98ce\u51b7\u8bbe\u5907",des:"\u70ed\u529b\u5c04\u51fb\u65f6\u95f4\u6301\u7eed+45%",avatar:{sprite:"item/\u98ce\u51b7\u8bbe\u5907"},attr:[[ADD_SCALE,"heatTime",.45]]},eh3:{lvl:4,type:"equipment",name:"\u98ce\u51b7\u8bbe\u5907",des:"\u70ed\u529b\u5c04\u51fb\u65f6\u95f4\u6301\u7eed+65%",avatar:{sprite:"item/\u98ce\u51b7\u8bbe\u5907"},attr:[[ADD_SCALE,"heatTime",.65]]},eh4:{lvl:5,type:"equipment",name:"\u98ce\u51b7\u8bbe\u5907",des:"\u70ed\u529b\u5c04\u51fb\u65f6\u95f4\u6301\u7eed+90%",avatar:{sprite:"item/\u98ce\u51b7\u8bbe\u5907"},attr:[[ADD_SCALE,"heatTime",.9]]},fh:{lvl:2,ctor:a,name:"\u8d85\u8f7d\u6838\u5fc3",des:"\u6b66\u5668\u8840\u91cf40%\u4ee5\u4e0b\u65f6\uff0c\u653b\u51fb+30%",type:"equipment",avatar:{sprite:"item/\u8d85\u8f7d\u6838\u5fc3"},buff:[{symbol:null,t:1/0,ctor:e("../components/combat/buffs/ConditionBuff"),condition:{func:function(e){return e.hp<.4*e.hpMax},attr:[[ADD_SCALE,"atkScale",.3]]}}]},fh2:{lvl:3,ctor:a,name:"\u8d85\u8f7d\u6838\u5fc3",des:"\u6b66\u5668\u8840\u91cf40%\u4ee5\u4e0b\u65f6\uff0c\u653b\u51fb+50%",type:"equipment",avatar:{sprite:"item/\u8d85\u8f7d\u6838\u5fc3"},buff:[{symbol:null,t:1/0,ctor:e("../components/combat/buffs/ConditionBuff"),condition:{func:function(e){return e.hp<.4*e.hpMax},attr:[[ADD_SCALE,"atkScale",.5]]}}]},fh3:{lvl:4,ctor:a,name:"\u8d85\u8f7d\u6838\u5fc3",des:"\u6b66\u5668\u8840\u91cf50%\u4ee5\u4e0b\u65f6\uff0c\u653b\u51fb+70%",type:"equipment",avatar:{sprite:"item/\u8d85\u8f7d\u6838\u5fc3"},buff:[{symbol:null,t:1/0,ctor:e("../components/combat/buffs/ConditionBuff"),condition:{func:function(e){return e.hp<.5*e.hpMax},attr:[[ADD_SCALE,"atkScale",.7]]}}]},fh4:{lvl:5,ctor:a,name:"\u8d85\u8f7d\u6838\u5fc3",des:"\u6b66\u5668\u8840\u91cf50%\u4ee5\u4e0b\u65f6\uff0c\u653b\u51fb+90%",type:"equipment",avatar:{sprite:"item/\u8d85\u8f7d\u6838\u5fc3"},buff:[{symbol:null,t:1/0,ctor:e("../components/combat/buffs/ConditionBuff"),condition:{func:function(e){return e.hp<.5*e.hpMax},attr:[[ADD_SCALE,"atkScale",.9]]}}]},jk:{lvl:3,ctor:a,name:"\u56de\u6536\u88c5\u7f6e",des:"\u670910%\u51e0\u7387\uff0c\u5c0615%\u7684\u4f24\u5bb3\u8f6c\u5316\u4e3a\u6b66\u5668\u8840\u91cf",type:"equipment",avatar:{sprite:"item/\u56de\u6536\u88c5\u7f6e"},buff:[{symbol:null,t:1/0,chance:.1,rate:.15,ctor:e("../components/combat/buffs/LeechBuff")}]},jk2:{lvl:4,ctor:a,name:"\u56de\u6536\u88c5\u7f6e",des:"\u670915%\u51e0\u7387\uff0c\u5c0620%\u7684\u4f24\u5bb3\u8f6c\u5316\u4e3a\u6b66\u5668\u8840\u91cf",type:"equipment",avatar:{sprite:"item/\u56de\u6536\u88c5\u7f6e"},buff:[{symbol:null,t:1/0,chance:.15,rate:.2,ctor:e("../components/combat/buffs/LeechBuff")}]},jk3:{lvl:5,ctor:a,name:"\u56de\u6536\u88c5\u7f6e",des:"\u670915%\u51e0\u7387\uff0c\u5c0625%\u7684\u4f24\u5bb3\u8f6c\u5316\u4e3a\u6b66\u5668\u8840\u91cf",type:"equipment",avatar:{sprite:"item/\u56de\u6536\u88c5\u7f6e"},buff:[{symbol:null,t:1/0,chance:.15,rate:.25,ctor:e("../components/combat/buffs/LeechBuff")}]},ik:{lvl:3,type:"equipment",name:"\u81f4\u6b7b\u5b50\u5f39",des:"30%\u51e0\u7387\u79d2\u6740\u654c\u5175",avatar:{sprite:"item/\u81f4\u6b7b\u5b50\u5f39"},buff:[{symbol:null,t:1/0,chance:.3,ctor:e("../components/combat/buffs/DeadlyHitBuff")}]},ik2:{lvl:4,type:"equipment",name:"\u81f4\u6b7b\u5b50\u5f39",des:"40%\u51e0\u7387\u79d2\u6740\u654c\u5175",avatar:{sprite:"item/\u81f4\u6b7b\u5b50\u5f39"},buff:[{symbol:null,t:1/0,chance:.4,ctor:e("../components/combat/buffs/DeadlyHitBuff")}]},ik3:{lvl:5,type:"equipment",name:"\u81f4\u6b7b\u5b50\u5f39",des:"50%\u51e0\u7387\u79d2\u6740\u654c\u5175",avatar:{sprite:"item/\u81f4\u6b7b\u5b50\u5f39"},buff:[{symbol:null,t:1/0,chance:.5,ctor:e("../components/combat/buffs/DeadlyHitBuff")}]},expPack:{type:"expPack",name:"\u7ecf\u9a8c\u5305",avatar:{sprite:"item/\u7ecf\u9a8c\u5305"}},equipmentPack1:{lvl:1,type:"equipmentPack",cost:50,name:"\u914d\u4ef6\u53051",avatar:{sprite:"item/\u7070\u914d\u4ef6\u7bb1"}},equipmentPack2:{lvl:1,type:"equipmentPack",cost:80,name:"\u914d\u4ef6\u53052",avatar:{sprite:"item/\u7eff\u914d\u4ef6\u7bb1"}},equipmentPack3:{lvl:1,type:"equipmentPack",cost:130,name:"\u914d\u4ef6\u53053",avatar:{sprite:"item/\u84dd\u914d\u4ef6\u7bb1"}},materialPack1:{lvl:1,type:"materialPack",name:"\u7d20\u6750\u53051",cost:50,avatar:{sprite:"item/\u7070\u96f6\u4ef6"}},materialPack2:{lvl:2,type:"materialPack",name:"\u7d20\u6750\u53052",cost:70,avatar:{sprite:"item/\u7eff\u96f6\u4ef6"}},materialPack3:{lvl:3,type:"materialPack",name:"\u7d20\u6750\u53053",cost:100,avatar:{sprite:"item/\u84dd\u96f6\u4ef6"}}},window.ItemDrop={getItemFromExcelData:function(e,t,i){var a=t.dropTable;cc.log("dropTable",a);var n={weapon:"weapon",part:"equipment",metal:"material"},o=function(t,i){cc.log("getItemByTypeAndLevel",t,i);var a=n[t],o=[];for(var r in ItemDefine){var s=ItemDefine[r],c=s.lvl||1,l=s.chapter;if(!(l&&l>e)&&s.type==a){if("weapon"!=a&&i&&c!=i)continue;o.push(s)}}var d=kit.rndOne(o);if(d)return cc.log("getItemByTypeAndLevel drop",t,i,d.id,d.lvl),{id:d.id,lvl:d.lvl||i||1};cc.warn("getItemByTypeAndLevel no item",t,i)};if(i||(i=kit.rndOne(["weapon","part","metal"])),"metal"==i)return o(i);var r=a.rank;return o(i,ItemDrop.getRank(kit.rndOneC(r).n))},getRank:function(e){var t=pc.talentGlobal;return t.green&&e<2&&Math.random()<t.green&&(e=2),t.blue&&e<3&&Math.random()<t.blue&&(e=3),t.purple&&e<4&&Math.random()<t.purple&&(e=4),e},getDropsFromExcelData:function(e,t,i){if(void 0===i&&(i=[]),!t||!t.dropTable)return i;var a=t.dropTable;cc.log("dropTable",a);var n={weapon:"weapon",part:"equipment",metal:"material"},o=function(t,a){cc.log("getItemByTypeAndLevel",t,a);var o=n[t],r=[];for(var s in ItemDefine){var c=ItemDefine[s],l=c.lvl||1,d=c.chapter;if(!(d&&d>e)&&c.type==o){if("weapon"!=o&&a&&l!=a)continue;r.push(c)}}var h=kit.rndOne(r);h?(cc.log("getItemByTypeAndLevel drop",t,a,h.id,h.lvl),i.push({id:h.id,lvl:h.lvl||a||1})):cc.warn("getItemByTypeAndLevel no item",t,a)},r=function(e){var t=a[e],i=a.rank,n=kit.rndOneC(t).n;cc.log(e,t,i,n);for(var r=0;r<n;r++)"metal"==e?o(e):o(e,ItemDrop.getRank(kit.rndOneC(i).n))};return r("weapon"),r("part"),r("metal"),cc.log("drops",i),i}},ItemDefine)ItemDefine[n].id=n,"weapon"==ItemDefine[n].type&&(ItemDefine[n].ctor=i),"equipment"==ItemDefine[n].type&&(ItemDefine[n].ctor=a);for(var n in window.ItemTypeDefine={weaponTeam:{anchorY:0,scale:.7,tank:{dx:20}},weapon:{scale:.6,anchorY:.25},item:{},equipment:{}},window.EquipmentForgeFormula={getRarity:function(e){return cc.log("getRarity",e),ItemDefine[e].lvl||1},getBase:function(e){var t=ItemDefine[e].type;return("weapon"==t?"checkpoint/item/w":"equipment"==t?"checkpoint/item/e":"checkpoint/item/g")+EquipmentForgeFormula.getRarity(e)},getIcon:function(e){return ItemDefine[e].avatar},getName:function(e){return ItemDefine[e].name},isFormulaRecorded:function(e,t){return chapter.formula[e+"-"+t]}},window.EquipmentForgeFormulaDefine=[["a","b","ab"],["a","c","ac"],["a","d","machine_gun"],["b","c","bc"],["b","d","flame_thrower"],["c","d","cannon"],["e","f","ef"],["e","g","eg"],["f","g","fg"],["e","h","eh"],["f","h","fh"],["g","h","gh"],["i","j","ij"],["i","k","ik"],["j","k","jk"]],["ab","ac","ad","bc","bd","cd","ef","eg","fg","eh","fh","gh"]);window.GetWeaponDefineByGameId=function(e){for(var t in ItemDefine)if(ItemDefine[t].gameId==e)return ItemDefine[t]},cc._RF.pop()},{"../components/combat/buffs/Buff":"Buff","../components/combat/buffs/ConditionBuff":"ConditionBuff","../components/combat/buffs/DeadlyHitBuff":"DeadlyHitBuff","../components/combat/buffs/DoubleShotBuff":"DoubleShotBuff","../components/combat/buffs/LeechBuff":"LeechBuff","../components/combat/buffs/SummonBuff":"SummonBuff","../entities/projectiles/Missile":"Missile","../entities/projectiles/MissileSprite":"MissileSprite","./checkpointEquipment":"checkpointEquipment","./checkpointWeapon":"checkpointWeapon","./weaponTeam":"weaponTeam"}],itemEffect:[function(e,t){"use strict";cc._RF.push(t,"538c1/3xMBF+ayo+ezQB9AZ","itemEffect"),EFFECT.doubleAttack=function(e){cc.log("EFFECT.doubleAttack ");var t=e.obj,i=e.x+t.attackCenter.x*t.scale,a=e.y+t.attackCenter.y*t.scale,n=this.createSprite(i,a+30,"avatar/\u53cc\u53d1\u5b50\u5f39");t.avatar.addChild(n,-2),n.setAnchorPoint(.8,.5),n.angle=90;var o=this.createSprite(-e.dy,0,"avatar/\u53cc\u53d1\u5b50\u5f39");return n.addChild(o,1),o.angle=95+e.deg,o.setAnchorPoint(.2,.5),n.sprite.scheduleVS(function(){n.angle=t.avatar.attackDeg-90},0),n.remove=n.recycleFunc,n.shot=function(e){e>.1&&o.runActionVS(cc.sequence(cc.scaleTo(.05,.9,1),cc.scaleTo(e-.05,1,1)))},n},EFFECT.rocketItem=function(e){var t=e.obj;if(!t.rocketItemEffect){var i=this.createSprite(-10,15,"avatar/rocket");return t.avatar.addChild(i,1),i.scale=.7,i.angle=-90,i.remove=i.recycleFunc,t.rocketItemEffect=i,i}},cc._RF.pop()},{}],itemInfoBox:[function(e,t){"use strict";cc._RF.push(t,"369fbWdsL5PAIA9p7Sudoya","itemInfoBox"),cc.Class({extends:cc.Component,properties:{icon:cc.Node,title:cc.Label,des:cc.Label,tip:cc.Node,vehicle:cc.Label},init:function(e,t,i,a,n,o,r){if(this.game=e,this.define=t,this.title.string=t.name||"",this.lvl=i,this.des.string=t.des||"","weapon"==t.type){var s=100*this.game.args.vehicleConfig.attr.tower.atk*Math.pow(4/3,i-1),c=1*this.game.args.vehicleConfig.attr.tower.hp,l=Math.ceil(c)+"";r&&(l=Math.ceil(l*r)+"/"+l),this.des.string="\u653b\u51fb "+Math.ceil(s)+"    \u751f\u547d "+l,this.tip.active=!0,this.vehicle.node.active=!0,this.vehicle.string=ENTITY[this.game.args.vehicleConfig.vid].name}else"material"==t.type&&(this.des.string="\u53ef\u4ee5\u7528\u4f5c\u5408\u6210\u7684\u6750\u6599");this.icon.addComponent("checkpointAvatar").init(t,i||t.lvl,this.game,!0),this.node.scale=0,this.node.runAction(cc.scaleTo(.2,1).easing(cc.easeInOut(2))),this.removeCB=a,this.removeCB||(this.node.getChildByName("\u9500\u6bc1").active=!1),this.buyCB=n,this.buyCB&&(this.node.getChildByName("\u8d2d\u4e70").active=!0,this.node.getChildByName("\u8d2d\u4e70").getChildByName("label").getComponent(cc.Label).string=o)},close:function(){this.node.destroy()},remove:function(){this.removeCB&&this.removeCB(),this.close(),this.define.id},buy:function(){this.buyCB&&this.buyCB(),this.close()}}),cc._RF.pop()},{}],jsEvaler:[function(e,t){(function(i){"use strict";cc._RF.push(t,"def91vkMM5OgJY0asQeR4Zh","jsEvaler"),function(i){function a(){return(a=n()?Reflect.construct.bind():function(e,t,i){var a=[null];a.push.apply(a,t);var n=new(Function.bind.apply(e,a));return i&&o(n,i.prototype),n}).apply(null,arguments)}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function o(e,t){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=s(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}var l=3;function d(t,a){if("require"===t)return e;if("this"===t)return a.$this;do{if(a.$local.hasOwnProperty(t))return a.$local[t];a=a.$parent}while(a);return i[t]}function h(e,t,a,n){do{if(n.$local.hasOwnProperty(e))return u(e,t,a,n.$local);n=n.$parent}while(n);return u(e,t,a,i)}function u(e,t,i,a){if(i)switch(i.$type){case"+=":return a[e]+=t;case"-=":return a[e]-=t;case"*=":return a[e]*=t;case"/=":return a[e]/=t;case"%=":return a[e]%=t;case"++":return i.$prefix?++a[e]:a[e]++;case"--":return i.$prefix?--a[e]:a[e]--}return a[e]=t}function p(e,t){for(var i,a,n=r(e);!(a=n()).done;){if(i=f(a.value,t),t.$return)return t.$return[0];if(t.$continue)return;if(t.$break)return}return i}function f(e,t){if(e&&"object"==typeof e){t=t||{$local:{},$this:this};var i=e.$type;if(i){var n,o=e.$arr;if("+"===i)return 1===o.length?+f(o[0],t):f(o[0],t)+f(o[1],t);if("-"===i)return 1===o.length?-f(o[0],t):f(o[0],t)-f(o[1],t);if("*"===i)return f(o[0],t)*f(o[1],t);if("/"===i)return f(o[0],t)/f(o[1],t);if("%"===i)return f(o[0],t)%f(o[1],t);if("&&"===i)return f(o[0],t)&&f(o[1],t);if("||"===i)return f(o[0],t)||f(o[1],t);if("!"===i)return!f(o[0],t);if("&"===i)return f(o[0],t)&f(o[1],t);if("|"===i)return f(o[0],t)|f(o[1],t);if("^"===i)return f(o[0],t)^f(o[1],t);if("<<"===i)return f(o[0],t)<<f(o[1],t);if(">>"===i)return f(o[0],t)>>f(o[1],t);if("~"===i)return~f(o[0],t);if("typeof"===i)return typeof f(o[0],t);if("instanceof"===i)return f(o[0],t)instanceof f(o[1],t);if("in"===i)return f(o[0],t)in f(o[1],t);if("=="===i)return f(o[0],t)==f(o[1],t);if("!="===i)return f(o[0],t)!=f(o[1],t);if("==="===i)return f(o[0],t)===f(o[1],t);if("!=="===i)return f(o[0],t)!==f(o[1],t);if(">"===i)return f(o[0],t)>f(o[1],t);if(">="===i)return f(o[0],t)>=f(o[1],t);if("<"===i)return f(o[0],t)<f(o[1],t);if("<="===i)return f(o[0],t)<=f(o[1],t);if("?"===i)return f(o[0],t)?f(o[1],t):f(o[2],t);if("."===i)return f(o[0],t)[f(o[1],t)];if("?."===i)return null==(n=f(o[0],t))?void 0:n[f(o[1],t)];if("?.call"===i){var s,c,m=[],g=e.$args;if(g)for(var v,y=r(g);!(v=y()).done;){var b=v.value;m.push(f(b,t))}return e.$optional?null==(s=(c=f(o[0].$arr[0],t))[f(o[0].$arr[1],t)])?void 0:s.call(c,m):f(o[0].$arr[0],t)[f(o[0].$arr[1],t)](m)}if("delete"===i){if("."!==o[0].$type)return;delete f(o[0].$arr[0],t)[f(o[0].$arr[1],t)]}else if(["=","+=","-=","*=","/=","%=","++","--"].includes(i)){var k;if(k=o.length>1?f(o[1],t):1,o[0].$id)return h(o[0].$id,k,e,t);if("."===o[0].$type)return u(f(o[0].$arr[1],t),k,e,f(o[0].$arr[0],t))}else{if("obj"===i){for(var T,_={},w=r(o);!(T=w()).done;){var E=T.value;_[f(E[0],t)]=f(E[1],t)}return _}if("arr"===i){for(var C,S=[],I=r(o);!(C=I()).done;){var A=C.value;S.push(f(A,t))}return S}if("var"===i)for(var B,M=r(e.$body);!(B=M()).done;){var D=B.value,x=f(D[1],t);if("string"==typeof D[0])t.$local[D[0]]=x;else if(Array.isArray(D[0]))for(var R,N=r(D[0]);!(R=N()).done;){var F=R.value;t.$local[F[0]]=void 0===x?void 0:x[F[1]]}}else{if("call"===i){var L=[],P=e.$args;if(P)for(var O,U=r(P);!(O=U()).done;){var q=O.value;L.push(f(q,t))}if("."===o[0].$type){var G=f(o[0].$arr[0],t);return G[f(o[0].$arr[1],t)].apply(G,L)}return f(o[0],t).apply(null,L)}if("new"===i){var H=[],j=e.$args;if(j)for(var Y,W=r(j);!(Y=W()).done;){var V=Y.value;H.push(f(V,t))}return a(f(o[0],t),H)}if("if"===i){var X={$local:{},$parent:t,$this:t.$this};f(o[0],t)?e.$true&&p(e.$true,X):e.$false&&p(e.$false,X),X.$return?t.$return=X.$return:X.$break?t.$break=X.$break:X.$continue&&(t.$continue=X.$continue)}else if("for"===i)for(var z=null,K=[];;){var J={$local:{},$parent:t,$this:t.$this};if(z){for(var Z,Q=r(K);!(Z=Q()).done;){var $=Z.value;J.$local[$]=z.$local[$]}f(o[2],J)}else for(var ee in f(o[0],J),J.$local)K.push(ee);if(z=J,!f(o[1],J))return;if(p(e.$body,J),J.$return)return void(t.$return=J.$return);if(J.$break)break;J.$continue=0}else if("for_in"===i)for(var te in f(o[1],t)){var ie={$local:{},$parent:t,$this:t.$this},ae=void 0;if("var"===o[0].$type){f(o[0],ie);var ne=o[0].$body[0][0];"string"==typeof ne&&(ae=ne)}else o[0].$id&&(ae=o[0].$id);if(ae&&h(ae,te,null,ie),p(e.$body,ie),ie.$return)return void(t.$return=ie.$return);if(ie.$break)break;ie.$continue=0}else if("for_of"===i)for(var oe,re=r(f(o[1],t));!(oe=re()).done;){var se=oe.value,ce={$local:{},$parent:t,$this:t.$this},le=void 0;if("var"===o[0].$type?(f(o[0],ce),le=o[0].$body[0][0]):o[0].$id&&(le=o[0].$id),le)if("string"==typeof le)h(le,se,null,ce);else if(Array.isArray(le))for(var de,he=r(le);!(de=he()).done;){var ue=de.value;ce.$local[ue[0]]=void 0===se?void 0:se[ue[1]]}if(p(e.$body,ce),ce.$return)return void(t.$return=ce.$return);if(ce.$break)break;ce.$continue=0}else if("break"===i)t.$break=1;else if("continue"===i)t.$continue=1;else if("return"===i)if(e.$ret){var pe=f(e.$ret,t);t.$return=[pe]}else t.$return=[];else{if("function"===i){var fe=function(){var i={$local:{},$parent:t,$this:this};for(var a in e.$this&&(i.$this=t.$this),e.$args){var n=e.$args[a];if("string"==typeof n)i.$local[n]=arguments[a];else if("object"==typeof n){var o;if(o=void 0===arguments[a]?f(n.$default,i):arguments[a],"string"==typeof n.$id)i.$local[n.$id]=o;else if(Array.isArray(n.$id))for(var s,c=r(n.$id);!(s=c()).done;){var l=s.value;i.$local[l[0]]=o[l[1]]}}}return p(e.$body,i)};return e.$id&&(t.$local[e.$id]=fe),fe}if("sequence"===i)return p(e.$body,t);if("program"===i)return e.$version!==l&&console.error("older version json may not support",e.$version,l),p(e.$body,t)}}}return}if(e.$id)return d(e.$id,t)}return e}t.exports=f}.call(void 0,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],jsParser:[function(e,t){"use strict";var i;function a(e){for(var t;i<e.length;i++){if((t=e.charCodeAt(i))>32)return t;if(32!==t&&10!==t&&13!==t&&9!==t)throw new SyntaxError("Unexpected "+e[i])}return-1}function n(e){var t;if((t=e.charCodeAt(i))>=48&&t<=57||45===t||43===t)return c(e);switch(i++,t){case 123:return u(e);case 91:return d(e);case 110:return o(e);case 116:return r(e);case 102:return s(e);case 34:case 39:return l(e,t);default:throw new SyntaxError("Unexpected "+e[i])}}function o(e){if(i+2>=e.length||"u"!==e[i]||"l"!==e[i+1]||"l"!==e[i+2])throw new SyntaxError("Unexpected "+e.slice(i,i+3));return i+=3,null}function r(e){if(i+2>=e.length||"r"!==e[i]||"u"!==e[i+1]||"e"!==e[i+2])throw new SyntaxError("Unexpected "+e.slice(i,i+3));return i+=3,!0}function s(e){if(i+3>=e.length||"a"!==e[i]||"l"!==e[i+1]||"s"!==e[i+2]||"e"!==e[i+3])throw new SyntaxError("Unexpected "+e.slice(i,i+4));return i+=4,!1}function c(e){var t=e.slice(i).match(/^[+-]?[0-9]+(\.[0-9]+)?([eE][+-]?[0-9]+)?/)[0];return i+=t.length,parseFloat(t)}function l(e,t){for(var a=i,n=e.length,o="";a<n;a++)if(e.charCodeAt(a)===t)return o+=e.slice(i,a),i=a+1,o;throw new SyntaxError("Unexpected end, expecting a quote. ")}function d(e){for(var t,o=0,r=[];;o++){if(93===a(e))return i++,r;if(r[o]=n(e),44===(t=a(e)))i++;else if(93!==t)throw new SyntaxError("Unexpected end, expecting a index end. ["+i+"] "+e.substring(i))}}function h(e){var t,a=i,n=e.length,o="";for(34!==(t=e.charCodeAt(a))&&39!==t||(i++,a++);a<n;a++){if(32===(t=e.charCodeAt(a))||10===t||13===t||9===t||58===t)return o+=e.slice(i,a),i=a,o;if(34===t||39===t)return o+=e.slice(i,a),i=a+1,o}throw new SyntaxError("Unexpected end, expecting a index.")}function u(e){var t,o,r;for(o={};;){if(125===a(e))return i++,o;if(r=h(e),58!==a(e))throw new Error("Unexpected "+e[i]);if(i++,a(e),o[r]=n(e),44===(t=a(e)))i++;else if(125!==t)throw new SyntaxError("Unexpected end, expecting a index end. ["+i+"] "+e.substring(i))}}cc._RF.push(t,"d5687HpoiVBfYv9mB+tZISf","jsParser"),t.exports=function(e){if("string"!=typeof e)throw new TypeError("Argument should be a string");return i=0,a(e),i>=e.length?null:n(e)},cc._RF.pop()},{}],kit:[function(e,t){"use strict";cc._RF.push(t,"e389e7avf9NG7EwYTcdA6kR","kit"),window.kit={},kit.isObject=function(e){return null!==e&&"object"==typeof e},kit.rndOne=function(e){return e[kit.rndInt(0,e.length-1)]},kit.rndOneC=function(e){var t=0;for(var i in e)t+=e[i].c;var a=kit.rnd(0,t);for(var n in e)if((a-=e[n].c)<=0)return e[n]},kit.x4Line=function(e,t,i){var a=e.x,n=e.y,o=t.x,r=t.y;return a==o?n:n+(i-a)*(n-r)/(a-o)},kit.parabola2Degree=function(e,t,i,a){var n=e,o=1/(2*a*a)*i*n*n,r=n*n-4*o*(o-t);if(0===o||r<0)return[];if(0===r){var s=-n/(2*o);return[Math.atan(s)]}var c=(-n+Math.sqrt(r))/(2*o),l=Math.atan(c),d=(-n-Math.sqrt(r))/(2*o);return[l,Math.atan(d)]},kit.radian2Degree=function(e){return 57.29577951*e},kit.degree2Radian=function(e){return.017453292521*e},kit.includeDegree=function(e,t){return(e-t+900)%360-180},kit.rndInt=function(e,t){return Math.round(e+Math.floor(Math.random()*(t-e+1)))},kit.rnd=function(e,t){return e+(t-e)*Math.random()},kit.core=function(e,t){var i;void 0===e&&(e=0),void 0===t&&(t=0);var a=(i=e,function(){return(i=(9301*i+49297)%233280)/233280}),n={random:a,rnd:function(e,t){return e+(t-e)*this.random()},rndInt:function(e,t){return e+Math.floor(this.random()*(t-e+1))},rndOne:function(e){return e[n.rndInt(0,e.length-1)]},rndOneC:function(e){var t=0;for(var i in e)t+=e[i].c;var a=n.rnd(0,t);for(var o in e)if((a-=e[o].c)<=0)return e[o]}};if(t){t%=1e3;for(var o=0;o<t;o++)a()}return n},kit.sumOfSquares=function(e,t){return e*e+t*t},kit.norm=function(e,t){return Math.sqrt(e*e+t*t)},kit.clamp=function(e,t,i){return e<t?t:e>i?i:e},kit.clone=function e(t){if("object"!=typeof t)return t;if(null===t)return t;var i;for(var a in i=t.constructor===Array?[]:{},t)i[a]=e(t[a]);return i},kit.vector2Degree=function(e,t){var i=0;return 0==e?i=t>0?90:270:e>0?i=57.29577951*Math.atan(t/e):e<0&&(i=57.29577951*Math.atan(t/e)+180),i<0&&(i+=360),i},kit.degree2sin=function(e){return Math.sin(.017453292521*e)},kit.degree2cos=function(e){return Math.cos(.017453292521*e)},kit.abbr=function(e){if((e=Math.floor(e))>9999){var t=e.toString(),i=t.length;return e<1e6?t.substring(0,i-3)+"."+t.substring(i-3,i-2)+"K":e<1e9?t.substring(0,i-6)+"."+t.substring(i-6,i-5)+"M":e<1e12?t.substring(0,i-9)+"."+t.substring(i-9,i-8)+"G":t.substring(0,i-12)+"."+t.substring(i-12,i-11)+"T"}return e},kit.second2hour=function(e){return e<60?Math.floor(e)+" \u79d2":e<3600?Math.floor(e/60)+" \u5206\u949f":e<86400?Math.floor(e/60/60)+" \u5c0f\u65f6":Math.floor(e/24/60/60)+" \u5929"},kit.second2date=function(e){e=Math.round(e);var t=Math.floor(e/60);if(t>60){var i=Math.floor(t/60);return e-=60*t,i+":"+((t-=60*i)<10?"0"+t:t)+":"+(e<10?"0"+e:e)}return(t<10?"0"+t:t)+":"+((e-=60*t)<10?"0"+e:e)},kit.second2second=function(e){var t=Math.floor(e),i=Math.round(100*(e-t)),a=Math.floor(t/60);if(a>60){var n=Math.floor(a/60);return t-=60*a,n+":"+((a-=60*n)<10?"0"+a:a)+":"+(t<10?"0"+t:t)+"."+(i<10?"0"+i:i)}return(a<10?"0"+a:a)+":"+((t-=60*a)<10?"0"+t:t)+"."+(i<10?"0"+i:i)},kit.isValue=function(e){return e||0===e},kit.getValue=function(e,t){return kit.isValue(e)?e:t},kit.getValueInTable=function(e,t){var i=t.split(".");if(i.length>1){n=e;for(var a=0;a<i.length;a++)if(!(n=n[i[a]]))return}else var n=e[t];return n},kit.setValueInTable=function(e,t,i){var a=t.split(".");if(a.length>1){for(var n=e,o=0;o<a.length-1;o++){var r=a[o];n=n[r]?n[r]:n[r]={}}n[a[o]]=i}else e[t]=i;return i},kit.formatValue=function(e,t){if(!e)return t;var i,a=0,n=1;return"%"==t[t.length-1]&&(t=t.substr(0,t.length-1),i=!0),"-"==t[0]&&(t=t.substr(2,t.length-2),n=-1),"1"==t[0]&&"-"==t[1]&&(t=t.substr(2,t.length-2),a+=1,n=-1),"-"==t[t.length-2]&&"1"==t[t.length-1]&&(t=t.substr(0,t.length-2),a+=-1),a+=n*e,i?Math.round(1e4*a)/100+"%":a},kit.replaceString=function(e,t){return t?e.replace(/\{.+?\}/g,function(e){return t[e.substr(1,e.length-2)]}):e};var i=function(e,t){return t?173^(e>>>3|e<<5&255):e},a=function(e){if(70===e[0]&&52===e[1]&&84===e[2]&&84===e[3]&&48===e[4]&&89===e[5]&&33===e[6])return 16*e[9]+e[10]},n=e("../utils/security/pako");kit.buffer2str=function(e){if(cc.js.isString(e))return e;var t=new Uint8Array(e),o=a(t);if(2===o)t=t.slice(20,e.length);else{if(3!==o)return new TextDecoder("utf-8").decode(e);t=t.slice(20,e.length),t=n.inflate(t)}for(var r=[],s=0,c=0;s<t.length;){var l=i(t[s++],o);if(l<128)r[c++]=String.fromCharCode(l);else if(l>191&&l<224){var d=i(t[s++],o);r[c++]=String.fromCharCode((31&l)<<6|63&d)}else if(l>239&&l<365){var h=((7&l)<<18|(63&i(t[s++],o))<<12|(63&i(t[s++],o))<<6|63&i(t[s++],o))-65536;r[c++]=String.fromCharCode(55296+(h>>10)),r[c++]=String.fromCharCode(56320+(1023&h))}else{var u=i(t[s++],o),p=i(t[s++],o);r[c++]=String.fromCharCode((15&l)<<12|(63&u)<<6|63&p)}}return r.join("")},kit.parse=e("../utils/helpers/jsParser"),kit.eval=e("../utils/helpers/jsEvaler"),kit._imageCache={},kit.requestImage=function(e,t){if(kit._imageCache[e])t&&t(0,kit._imageCache[e]);else{var i=function i(){n.removeEventListener("load",i),n.removeEventListener("error",a);var o=new cc.Texture2D;o._uuid=e,o._nativeUrl=e,o._nativeAsset=n,kit._imageCache[e]=o,t&&t(0,o)},a=function e(){n.removeEventListener("load",i),n.removeEventListener("error",e),t&&t(-1)},n=new Image;"file:"!==window.location.protocol&&(n.crossOrigin="anonymous"),n.addEventListener("load",i),n.addEventListener("error",a),n.src=e}},kit.info=function(e,t,i,a){menuManager.queue("info",{noBlock:1,info:e,closeCb:t,time:i,dy:a})},kit.openURL=function(e){console.log("openURL",e),cc.sys.platform===cc.sys.WECHAT_GAME||cc.sys.platform===cc.sys.BYTEDANCE_GAME||cc.sys.platform===cc.sys.OPPO_GAME?menuManager.pop("web_lite",{url:e}):menuManager.pop("web",{initCb:function(t,i){i.node.find("safe/web",cc.WebView).url=e}})},kit.convertTo0to360=function(e){var t=(e%360+360)%360;return t>=0?t:t+360},kit.error=function(e){var t=e.toString()+"\n"+e.fileName+":"+e.lineNumber+"\n"+e.message+"\n\n"+e.stack;console.error("kit.error",t,e);var i=sdk.pt();i&&i.setClipboardData?i.setClipboardData({data:t,success:function(){cc.msgbox("\u51fa\u9519\u5566!\n\u9519\u8bef\u4fe1\u606f\u5df2\u590d\u5236\u5230\u526a\u8d34\u677f")}}):menuManager.pop("error",{info:t,btn:"\u786e\u8ba4",noWait:!0,checkCb:function(){window.navigator.clipboard&&window.navigator.clipboard.writeText(t)}})},kit.getNextDate=function(e){var t=new Date(e);return t.getHours()>=0&&t.getMinutes()>=0&&t.setDate(t.getDate()+1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t},cc.msgbox=function(){var e=sdk.pt();e&&e.showModal?wx.showModal({title:"\u63d0\u793a",content:cc.js.formatStr.apply(null,arguments),success:function(){}}):alert(cc.js.formatStr.apply(null,arguments))},cc.dump=function(e){cc.log(JSON.stringify(e))},window.wxVersion=function(e,t,i){if(cc.sys.platform==cc.sys.WECHAT_GAME){var a=wx.getSystemInfoSync().SDKVersion.split("."),n=+a[0],o=+a[1],r=+a[2];if(n>e)return!0;if(n==e){if(o>t)return!0;if(o==t&&r>=i)return!0}}},window.emptyFunc=function(){},kit.numApproach=function(e,t,i){return e>t?(e-=i)<t&&(e=t):e<t&&(e+=i)>t&&(e=t),e},kit.timer=function(e,t,i,a,n){if(a=a||0,e.gameTimerFromKit||(e.gameTimerFromKit={}),e.gameTimerFromKit[t]||0==e.gameTimerFromKit[t])return e.gameTimerFromKit[t]=e.gameTimerFromKit[t]+a,e.gameTimerFromKit[t]>=i?(e.gameTimerFromKit[t]=0,!0):void 0;e.gameTimerFromKit[t]=null!==n&&-n||0},kit.randomTimer=function(e,t,i,a,n,o){if(void 0===o&&(o=0),n=n||0,e.gameTimerFromKit||(e.gameTimerFromKit={}),e.gameTimerFromKit[t]||0==e.gameTimerFromKit[t])return e.gameTimerFromKit[t]=e.gameTimerFromKit[t]-n,e.gameTimerFromKit[t]<=0?(e.gameTimerFromKit[t]=kit.rnd(i,a),!0):void 0;e.gameTimerFromKit[t]=kit.rnd(i,a)+o},kit.mergeObjs=function(e,t,i){if(e){if("object"==typeof t)for(var a in t)e[a]=a!=i?kit.mergeObjs(e[a],t[a]):kit.addObjs(e[a],t[a])}else e=t=kit.clone(t);return e},kit.mergeObjs2=function(e,t,i){if(e){if("object"==typeof t)for(var a in t)a!=i?t[a]&&t[a].constructor==Array&&e[a]||(e[a]=kit.mergeObjs2(e[a],t[a])):e[a]=t[a]}else e=t=kit.clone(t);return e},kit.num=function(e){return e&&e.constructor==Array?kit.rnd(e[0],e[1]):e},kit.shuffle=function(e){for(var t=e.length;t;){var i=Math.floor(Math.random()*t--),a=[e[t],e[i]];e[i]=a[0],e[t]=a[1]}return e},kit.rollWithPower=function(e){var t=0;for(var i in e)t+=+e[i];var a,n=Math.random()*t;cc.log("ab\u6d4b\u8bd5 rollWithPower rand power",t,n);var o=0;for(var i in e)if(n<=(o+=+e[i])){a=i;break}return a},kit.addObjs=function(e,t){if(e)if("object"!=typeof t)"number"==typeof e&&"number"==typeof t&&(e+=t);else for(var i in t)e[i]=kit.addObjs(e[i],t[i]);else e=t=kit.clone(t);return e},kit.mulObjs=function(e,t){if(e)if("object"!=typeof t)"number"==typeof e&&"number"==typeof t&&(e*=t);else for(var i in t)e[i]=kit.mulObjs(e[i],t[i]);else e=t=kit.clone(t);return e},cc._RF.pop()},{"../utils/helpers/jsEvaler":"jsEvaler","../utils/helpers/jsParser":"jsParser","../utils/security/pako":"pako"}],labelEffect:[function(e,t){"use strict";cc._RF.push(t,"74d93X4SFpEKIsEVBODkrJW","labelEffect"),EFFECT.label=function(e,t){var i=new cc.Node,a=i.addComponent(cc.Label);return a.fontSize=t||50,a.string=e,i.label=a,i},EFFECT.connectLabel=function(e){var t;this.connectNode?(t=this.connectNode).active=!0:(t=this.connectNode=EFFECT.label("",40),this.layer.addToUI(t,60),t.setPosition(0,-cc.winSize.height/2+100),t.opacity=0,t.runAction(cc.fadeIn(.2)),t.runAction(cc.jumpBy(.5,0,0,30,1).repeatForever())),t.label.string=e},EFFECT.connectWait=function(e){cc.log("EFFECT.connectWait"),EFFECT.connectLabel.call(this,LI("pvp_wait1")+" ("+e+")")},EFFECT.connectShow=function(){cc.log("EFFECT.connectShow"),EFFECT.connectLabel.call(this,LI("pvp_wait2"))},EFFECT.connectHide=function(){cc.log("EFFECT.connectHide"),this.connectNode&&(this.connectNode.stopAllActions(),this.connectNode.active=!1)},EFFECT.showMsg=function(){var e=this.createSprite(0,200,"ui/msg/\u5f3a\u654c-\u5e95");this.layer.addToUI(e),e.opacity=0,e.runAction(cc.sequence(cc.fadeIn(.15).easing(cc.easeOut(1)),cc.delayTime(1),cc.fadeOut(.3).easing(cc.easeSineIn(1))));var t=this.createSprite(100,0,"ui/msg/\u654c\u8230\u51fa\u73b0");e.addChild(t),t.runAction(cc.sequence(cc.moveTo(.15,0,0).easing(cc.easeOut(1)),cc.delayTime(1),cc.moveBy(.3,-300,0).easing(cc.easeSineIn(1))))},cc._RF.pop()},{}],laser:[function(e,t){"use strict";var i,a,n,o;cc._RF.push(t,"2a4feQVqMtOUrzTo4HjzeZh","laser"),e("../define");var r=e("../../entities/environment/MyTower"),s=e("../../ai/units/AIMyTower");BULLET_DEFINE.laser=[{avatar:{hitFloorEffect:EFFECT.LaserHitFloor},ctor:e("../../entities/projectiles/BulletLaser"),lifetime:.05,name:"\u81ea\u52a8\u6b65\u67aa",kb:.01,radius:60,sx:.3,sy:.01,sx1:.05,sy1:.01,st:.05,anchorY:.5,frm:"",length:20,dmg:300,n:1,wd:1,d:0,spd:12222,rnd:0,distance:3e3,thrDecline:.75,thrDeath:3,hurtStopTime:4,hurtStopCD:1,dmgType:DMG_TYPE.fire,ignoreWall:1,hurtNumPower:1}],ENTITY.laser=((i={id:"laser",hero:!0,category:"laser",name:"\u6fc0\u5149",avatar:{gunBone:"gun",animeName:"jiguangpao",anime:"weapon/jiguangpao",moveSpd:150,s:.9},rttSpd:10,ctor:r,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:12,blt:BULLET_DEFINE.laser,bltMax:30,bltReload:2,attackCenter:cc.v2(0,75),attackVolume:.3,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]}).heatUpOnShot=2,i.heatMin=0,i.heat={attr:{},attackVolume:1,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},i.overHeat={attr:{atkSpd:.5},attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},i.attackAngle=[-60,80],i.pilot={ctor:s,attackRange:777,seekRange:1111,offsetX:0,offsetY:75},i),RES.laser=[{anime:"weapon/jiguangpao"}],ENTITY.laser_2=((a={id:"laser_2",hero:!0,category:"laser",name:"\u6fc0\u5149",avatar:{gunBone:"gun",animeName:"jiguangpao2",anime:"weapon/jiguangpao",moveSpd:150,s:.9},rttSpd:10,ctor:r,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:18,blt:BULLET_DEFINE.laser,bltMax:30,bltReload:2,attackCenter:cc.v2(0,75),attackVolume:.3,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]}).heatUpOnShot=2,a.heatMin=0,a.heat={attr:{},attackVolume:1,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},a.overHeat={attr:{atkSpd:.5},attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},a.attackAngle=[-60,80],a.pilot={ctor:s,attackRange:777,seekRange:1111,offsetX:0,offsetY:-75},a),RES.laser_2=[{anime:"weapon/jiguangpao"}],ENTITY.laser_3=((n={id:"laser_3",hero:!0,category:"laser",name:"\u6fc0\u51493",avatar:{gunBone:"gun",animeName:"jiguangpao3",anime:"weapon/jiguangpao",moveSpd:150,s:.9},rttSpd:10,ctor:r,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:27,blt:BULLET_DEFINE.laser,bltMax:30,bltReload:2,attackCenter:cc.v2(0,75),attackVolume:.3,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]}).heatUpOnShot=2,n.heatMin=0,n.heat={attr:{},attackVolume:1,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},n.overHeat={attr:{atkSpd:.5},attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},n.attackAngle=[-60,80],n.pilot={ctor:s,attackRange:777,seekRange:1111,offsetX:0,offsetY:-75},n),RES.laser_3=[{anime:"weapon/jiguangpao"}],ENTITY.laser_4=((o={id:"laser_4",hero:!0,category:"laser",name:"\u6fc0\u51494",avatar:{gunBone:"gun",animeName:"jiguangpao4",anime:"weapon/jiguangpao",moveSpd:150,s:.9},rttSpd:10,ctor:r,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:41,blt:BULLET_DEFINE.laser,bltMax:30,bltReload:2,attackCenter:cc.v2(0,75),attackVolume:.3,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]}).heatUpOnShot=2,o.heatMin=0,o.heat={attr:{},attackVolume:1,attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},o.overHeat={attr:{atkSpd:.5},attackSequence:[{t:.04,x:54,y:0,ay:180,blt:1,effect:function(e,t,i,a,n){EFFECT.PureFireLight.call(this,t,i,e,0,0,.7,n,1,2,1205,255)}}]},o.attackAngle=[-60,80],o.pilot={ctor:s,attackRange:777,seekRange:1111,offsetX:0,offsetY:-75},o),RES.laser_4=[{anime:"weapon/jiguangpao"}],cc._RF.pop()},{"../../ai/units/AIMyTower":"AIMyTower","../../entities/environment/MyTower":"MyTower","../../entities/projectiles/BulletLaser":"BulletLaser","../define":"define"}],levelDefine:[function(e,t){"use strict";cc._RF.push(t,"3ed52PShTdMzZE9OBVokIc3","levelDefine"),window.COND={MSG:0,TIMER:1,POS:2,DEED:3,STATUS:4,RANDOM:5,EVENT:6,DISTANCE:7},window.INDEX_TYPE={INDEX:0,ID:1,TEAM:2,ME:3,ALL:9},window.DEED_TYPE={DEATH:0},window.ACT={MSG:0,CREATE:1,REMOVE:2,CAMERA:3,AI:4,STATUS:5,SWITCH:6,AVATAR:7,DELAY:8,EFFECT:9,CTRL:10,CHOSE:11,QUEST:12},window.QUEST_STR=[["\u6d88\u706d{t}","\u6740\u5149{t}","\u6740\u6b7b{t}"],["\u4fdd\u62a4{t}","\u62a4\u9001{t}","\u8425\u6551{t}"],["\u6d3b\u4e0b\u53bb","\u575a\u5b88\u8425\u5730{v}\u79d2","\u5b88\u62a4\u6c34\u6676\u5854{v}\u79d2"],["\u524d\u5f80\u76ee\u6807\u533a\u57df"]],window.STATUS_QUEST_STR={ep:"\u524a\u51cf{t}\u7684\u62a4\u76fe",hp:"\u524a\u51cf{t}\u7684\u8840\u91cf"},window.POS_QUEST_STR={p1:"\u524d\u5f80\u76ee\u6807\u5730\u70b9",p2:"\u62b5\u8fbe\u76ee\u6807\u533a\u57df"},window.TIMER_QUEST_STR={df:"\u575a\u5b88{v}\u79d2",li:"\u5b58\u6d3b{v}\u79d2"},window.MSG_QUEST_STR={fi:"\u5b8c\u6210\u652f\u7ebf\u4efb\u52a1"},window.DEED_QUEST_STR={ki:"\u6740\u6b7b{t}"},window.ENTITY_VALUE={hp:{n:"\u8840\u91cf",get:function(e){return e.hp},set:function(e,t,i){i?e.hp+=t:e.hp=t}},ep:{n:"\u84dd\u7532",get:function(e){return e.ep},set:function(e,t,i){i?e.ep+=t:e.ep=t}},"hp%":{n:"\u767e\u5206\u6bd4\u8840\u91cf",get:function(e){return e.hp/e.hpMax},set:function(e,t,i){i?e.hp+=t*e.hpMax:e.hp=t*e.hpMax}},"ep%":{n:"\u767e\u5206\u6bd4\u84dd\u7532",get:function(e){return e.ep/e.epMax},set:function(e,t,i){i?e.ep+=t*e.epMax:e.ep=t*e.epMax}},moveSpd:{n:"\u79fb\u52a8\u901f\u5ea6",get:function(e){return e.moveSpd},set:function(e,t,i){i?e.attribute.add("moveSpd",t):e.attribute.set("moveSpd",t),e.avatar.refresh(.1)}},no_hurt:{n:"\u4e0d\u53d7\u4f24\u5bb3",list:[{n:"\u5173\u95ed",s:0},{n:"\u6253\u5f00",s:1}],set:function(e,t){e.setFlag(NO_HURT,t)}},no_contact:{n:"\u4e0d\u53ef\u78b0\u649e",list:[{n:"\u5173\u95ed",s:0},{n:"\u6253\u5f00",s:1}],set:function(e,t){e.setFlag(NO_CONTACT,t)}},no_border:{n:"\u65e0\u89c6\u8fb9\u754c",list:[{n:"\u5173\u95ed",s:0},{n:"\u6253\u5f00",s:1}],set:function(e,t){e.setFlag(NO_BORDER,t)}},team:{n:"\u6240\u5c5e\u961f\u4f0d",set:function(e,t){e.team=t;var i=e.avatar;if(i){i.initTeam();var a=i.hpBar;a&&a.initTeam()}}},pilot:{n:"\u63a7\u5236\u5668",list:[{n:"\u5173\u95ed",s:0},{n:"\u6253\u5f00",s:1}],set:function(e,t){var i=e.pilot;i&&(i.setEnabled(t),2==t&&i.initAssist(1))}}},window.ACT_EFFECT={winZoom:{n:"\u80dc\u5229\u7279\u5199",avatar:1,pos:1,func:function(e,t){EFFECT.showWinCloseUp.call(e,t)}},explosion:{n:"\u7206\u70b8",pos:1,func:function(e,t,i){EFFECT.explosion.call(e,t,i,100)}},msg:{n:"\u6a2a\u5e45",args:1,scale:1,func:function(e,t,i,a,n){this.game.callEffect(EFFECT.showMsg,n,a)}},music:{n:"\u97f3\u4e50",args:1,scale:1,func:function(e,t,i,a,n){n&&this.game.playBgm(n,a)}},sound:{n:"\u97f3\u6548",args:1,scale:1,func:function(e,t,i,a,n){n&&this.game.playEffect(n,null,a)}}},window.ACT_EVENT={win:{n:"\u80dc\u5229",func:function(){if(!this.ended){this.ended=!0;var e=this.entityList,t=this.heroes[1];for(var i in e)e[i].team!==t.team&&e[i].callDeath(this,0);this.game.callFinish(!0)}}},fail:{n:"\u5931\u8d25",func:function(){this.ended||(this.ended=!0,this.game.callFinish(!1))}},lock:{n:"\u9501\u5b9a\u5377\u5c4f\u903b\u8f91",func:function(e){this.lockDistance=e}},bomb:{n:"\u8f70\u70b8",func:function(){this.game.levelMgr.heroes[1].addBuff(this,ShotSeq2)}}},cc._RF.pop()},{}],local:[function(e,t){"use strict";cc._RF.push(t,"25f47acH9xDkq5jntC5ObTD","local");var i={click_restart:{"zh-cn":"\u70b9\u51fb\u91cd\u8bd5","en-us":"Tap to retry",id:"Ketuk untuk coba lagi",hi:"\u092b\u093f\u0930 \u0938\u0947 \u0915\u094b\u0936\u093f\u0936 \u0915\u0930\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f \u091f\u0948\u092a \u0915\u0930\u0947\u0902",vi:"Nh\u1ea5n \u0111\u1ec3 th\u1eed l\u1ea1i","pt-br":"Toque para tentar de novo",th:"\u0e41\u0e15\u0e30\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e25\u0e2d\u0e07\u0e2d\u0e35\u0e01\u0e04\u0e23\u0e31\u0e49\u0e07"},startup_title:{"zh-cn":"\u5065\u5eb7\u6e38\u620f\u516c\u544a","en-us":"Healthy Gaming Reminder",id:"Pengingat Game Sehat",hi:"\u0938\u094d\u0935\u0938\u094d\u0925 \u0917\u0947\u092e\u093f\u0902\u0917 \u0905\u0928\u0941\u0938\u094d\u092e\u093e\u0930\u0915",vi:"Th\xf4ng b\xe1o ch\u01a1i game l\xe0nh m\u1ea1nh","pt-br":"Aviso de Jogo Saud\xe1vel",th:"\u0e1b\u0e23\u0e30\u0e01\u0e32\u0e28\u0e01\u0e32\u0e23\u0e40\u0e25\u0e48\u0e19\u0e40\u0e01\u0e21\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e21\u0e35\u0e2a\u0e38\u0e02\u0e20\u0e32\u0e1e\u0e14\u0e35"},startup_msg:{"zh-cn":"\u62b5\u5236\u4e0d\u826f\u6e38\u620f\uff0c\u62d2\u7edd\u76d7\u7248\u6e38\u620f\u3002\u6ce8\u610f\u81ea\u6211\u4fdd\u62a4\uff0c\u8c28\u9632\u53d7\u9a97\u4e0a\u5f53\u3002\n\u9002\u5ea6\u6e38\u620f\u76ca\u8111\uff0c\u6c89\u8ff7\u6e38\u620f\u4f24\u8eab\u3002\u5408\u7406\u5b89\u6392\u65f6\u95f4\uff0c\u4eab\u53d7\u5065\u5eb7\u751f\u6d3b\u3002","en-us":"Resist harmful games and reject piracy. Protect yourself and avoid being deceived.\nPlay moderately for a healthy mind, avoid addiction for a healthy body. Manage your time wisely and enjoy a healthy life.",id:"Hindari game berbahaya dan tolak pembajakan. Lindungi diri Anda dan hindari penipuan.\nBermainlah secara moderat untuk kesehatan mental, hindari kecanduan demi kesehatan tubuh. Atur waktu dengan bijak dan nikmati hidup sehat.",hi:"\u0939\u093e\u0928\u093f\u0915\u093e\u0930\u0915 \u0916\u0947\u0932\u094b\u0902 \u0915\u093e \u0935\u093f\u0930\u094b\u0927 \u0915\u0930\u0947\u0902 \u0914\u0930 \u092a\u093e\u0907\u0930\u0947\u0938\u0940 \u0938\u0947 \u092c\u091a\u0947\u0902\u0964 \u0916\u0941\u0926 \u0915\u0940 \u0930\u0915\u094d\u0937\u093e \u0915\u0930\u0947\u0902 \u0914\u0930 \u0927\u094b\u0916\u093e\u0927\u0921\u093c\u0940 \u0938\u0947 \u0938\u093e\u0935\u0927\u093e\u0928 \u0930\u0939\u0947\u0902\u0964\n\u092e\u0949\u0921\u0930\u0947\u091f \u0917\u0947\u092e\u093f\u0902\u0917 \u0938\u0947 \u0926\u093f\u092e\u093e\u0917 \u0915\u094b \u092b\u093e\u092f\u0926\u093e \u0939\u094b\u0924\u093e \u0939\u0948, \u0932\u0947\u0915\u093f\u0928 \u0932\u0924 \u0936\u0930\u0940\u0930 \u0915\u094b \u0928\u0941\u0915\u0938\u093e\u0928 \u092a\u0939\u0941\u0902\u091a\u093e \u0938\u0915\u0924\u0940 \u0939\u0948\u0964 \u0938\u092e\u092f \u0915\u093e \u0938\u0939\u0940 \u092a\u094d\u0930\u092c\u0902\u0927\u0928 \u0915\u0930\u0947\u0902 \u0914\u0930 \u0938\u094d\u0935\u0938\u094d\u0925 \u091c\u0940\u0935\u0928 \u0915\u093e \u0906\u0928\u0902\u0926 \u0932\u0947\u0902\u0964",vi:"Ch\u1ed1ng l\u1ea1i game \u0111\u1ed9c h\u1ea1i, n\xf3i kh\xf4ng v\u1edbi game l\u1eadu. B\u1ea3o v\u1ec7 b\u1ea3n th\xe2n, c\u1ea3nh gi\xe1c v\u1edbi l\u1eeba \u0111\u1ea3o.\nCh\u01a1i game \u0111i\u1ec1u \u0111\u1ed9 gi\xfap tr\xed tu\u1ec7 minh m\u1eabn, nghi\u1ec7n game g\xe2y h\u1ea1i s\u1ee9c kh\u1ecfe. S\u1eafp x\u1ebfp th\u1eddi gian h\u1ee3p l\xfd \u0111\u1ec3 t\u1eadn h\u01b0\u1edfng cu\u1ed9c s\u1ed1ng l\xe0nh m\u1ea1nh.","pt-br":"Resista a jogos nocivos e rejeite a pirataria. Proteja-se e evite ser enganado.\nJogar moderadamente faz bem \xe0 mente, o v\xedcio prejudica o corpo. Organize bem seu tempo e aproveite uma vida saud\xe1vel.",th:"\u0e2b\u0e25\u0e35\u0e01\u0e40\u0e25\u0e35\u0e48\u0e22\u0e07\u0e40\u0e01\u0e21\u0e17\u0e35\u0e48\u0e40\u0e1b\u0e47\u0e19\u0e2d\u0e31\u0e19\u0e15\u0e23\u0e32\u0e22\u0e41\u0e25\u0e30\u0e1b\u0e0f\u0e34\u0e40\u0e2a\u0e18\u0e01\u0e32\u0e23\u0e25\u0e30\u0e40\u0e21\u0e34\u0e14\u0e25\u0e34\u0e02\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c \u0e1b\u0e01\u0e1b\u0e49\u0e2d\u0e07\u0e15\u0e31\u0e27\u0e40\u0e2d\u0e07\u0e41\u0e25\u0e30\u0e23\u0e30\u0e27\u0e31\u0e07\u0e01\u0e32\u0e23\u0e16\u0e39\u0e01\u0e2b\u0e25\u0e2d\u0e01\n\u0e01\u0e32\u0e23\u0e40\u0e25\u0e48\u0e19\u0e40\u0e01\u0e21\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e1e\u0e2d\u0e40\u0e2b\u0e21\u0e32\u0e30\u0e0a\u0e48\u0e27\u0e22\u0e43\u0e2b\u0e49\u0e2a\u0e21\u0e2d\u0e07\u0e14\u0e35 \u0e01\u0e32\u0e23\u0e15\u0e34\u0e14\u0e40\u0e01\u0e21\u0e17\u0e33\u0e25\u0e32\u0e22\u0e2a\u0e38\u0e02\u0e20\u0e32\u0e1e \u0e08\u0e31\u0e14\u0e2a\u0e23\u0e23\u0e40\u0e27\u0e25\u0e32\u0e2d\u0e22\u0e48\u0e32\u0e07\u0e40\u0e2b\u0e21\u0e32\u0e30\u0e2a\u0e21\u0e41\u0e25\u0e30\u0e21\u0e35\u0e0a\u0e35\u0e27\u0e34\u0e15\u0e17\u0e35\u0e48\u0e21\u0e35\u0e2a\u0e38\u0e02\u0e20\u0e32\u0e1e\u0e14\u0e35"},subpackage_fail:{"zh-cn":"\u5206\u5305\u52a0\u8f7d\u5931\u8d25, \u7a0d\u540e\u518d\u8bd5\u8bd5\u5427","en-us":"Failed to load data, try again later",id:"Gagal memuat data, coba lagi nanti",hi:"\u0921\u0947\u091f\u093e \u0932\u094b\u0921 \u0915\u0930\u0928\u0947 \u092e\u0947\u0902 \u0935\u093f\u092b\u0932, \u092c\u093e\u0926 \u092e\u0947\u0902 \u092a\u0941\u0928: \u092a\u094d\u0930\u092f\u093e\u0938 \u0915\u0930\u0947\u0902",vi:"T\u1ea3i d\u1eef li\u1ec7u th\u1ea5t b\u1ea1i, h\xe3y th\u1eed l\u1ea1i sau","pt-br":"Falha ao carregar os dados. Tente novamente mais tarde.",th:"\u0e42\u0e2b\u0e25\u0e14\u0e02\u0e49\u0e2d\u0e21\u0e39\u0e25\u0e44\u0e21\u0e48\u0e2a\u0e33\u0e40\u0e23\u0e47\u0e08 \u0e25\u0e2d\u0e07\u0e2d\u0e35\u0e01\u0e04\u0e23\u0e31\u0e49\u0e07\u0e20\u0e32\u0e22\u0e2b\u0e25\u0e31\u0e07"}},a=[];window.local={list:["local_main","local_item","local_level","local_guide","local_vehicle","local_hero"],load:function(e){var t=this;this.loadMany(function(){i.game_title={"zh-cn":GAME_TITLE,"en-us":"Epic Idle War\nBackpack Master","zh-tw":"Epic Idle War\n\u80cc\u5305\u5927\u5e2b","ko-kr":"\uc5d0\ud53d \ubc29\uce58 \uc804\uc7c1\n\ubc31\ud329 \ub9c8\uc2a4\ud130","ru-ru":"\u042d\u043f\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0418\u0434\u043b \u0412\u043e\u0439\u043d\u0430\n\u041c\u0430\u0441\u0442\u0435\u0440 \u0420\u044e\u043a\u0437\u0430\u043a\u0430","ja-jp":"\u30a8\u30d4\u30c3\u30af\u30a2\u30a4\u30c9\u30eb\u30a6\u30a9\u30fc\n\u30d0\u30c3\u30af\u30d1\u30c3\u30af\u30de\u30b9\u30bf\u30fc","id-id":"Perang Idle Epik\nPenguasa Ransel","th-th":"\u0e2a\u0e07\u0e04\u0e23\u0e32\u0e21\u0e44\u0e2d\u0e14\u0e2d\u0e25\u0e2a\u0e38\u0e14\u0e21\u0e31\u0e19\u0e2a\u0e4c\n\u0e1b\u0e23\u0e21\u0e32\u0e08\u0e32\u0e23\u0e22\u0e4c\u0e40\u0e1b\u0e49\u0e2a\u0e30\u0e1e\u0e32\u0e22\u0e2b\u0e25\u0e31\u0e07","vi-vn":"Chi\u1ebfn Tranh Nh\xe0n R\u1ed7i K\u1ef3 Th\xfa\nB\u1eadc Th\u1ea7y Ba L\xf4","es-es":"Guerra \xc9pica Idle\nMaestro de Mochila","pt-pt":"Guerra \xc9pica Idle\nMestre da Mochila","de-de":"Epischer Idle-Krieg\nRucksack-Meister","fr-fr":"Guerre \xc9pique Idle\nMa\xeetre du Sac \xe0 Dos","it-it":"Guerra Epica Idle\nMaestro dello Zaino","tr-tr":"Epik Bo\u015fta Sava\u015f\nS\u0131rt \xc7antas\u0131 Ustas\u0131"},i.game_sr_num={"zh-cn":"\u767b\u8bb0\u53f7\uff1a"+GAME_SR_NUM,"en-us":"Registration No.: "+GAME_SR_NUM,"zh-tw":"\u767b\u8a18\u865f\uff1a"+GAME_SR_NUM,"ko-kr":"\ub4f1\ub85d \ubc88\ud638: "+GAME_SR_NUM,"ru-ru":"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0439 \u2116: "+GAME_SR_NUM,"ja-jp":"\u767b\u9332\u756a\u53f7\uff1a"+GAME_SR_NUM,"id-id":"No. Registrasi: "+GAME_SR_NUM,"th-th":"\u0e2b\u0e21\u0e32\u0e22\u0e40\u0e25\u0e02\u0e25\u0e07\u0e17\u0e30\u0e40\u0e1a\u0e35\u0e22\u0e19: "+GAME_SR_NUM,"vi-vn":"S\u1ed1 \u0111\u0103ng k\xfd: "+GAME_SR_NUM,"es-es":"N.\xba de registro: "+GAME_SR_NUM,"pt-pt":"N.\xba de registro: "+GAME_SR_NUM,"de-de":"Registrierungsnr.: "+GAME_SR_NUM,"fr-fr":"N\xb0 d'enregistrement : "+GAME_SR_NUM,"it-it":"N. di registrazione: "+GAME_SR_NUM,"tr-tr":"Kay\u0131t No: "+GAME_SR_NUM},i.game_sr_name={"zh-cn":"\u8457\u4f5c\u6743\u4eba\uff1a"+GAME_SR_NAME,"en-us":"Copyright Holder: "+GAME_SR_NAME,"zh-tw":"\u8457\u4f5c\u6b0a\u4eba\uff1a"+GAME_SR_NAME,"ko-kr":"\uc800\uc791\uad8c\uc790: "+GAME_SR_NAME,"ru-ru":"\u041f\u0440\u0430\u0432\u043e\u043e\u0431\u043b\u0430\u0434\u0430\u0442\u0435\u043b\u044c: "+GAME_SR_NAME,"ja-jp":"\u8457\u4f5c\u6a29\u8005\uff1a"+GAME_SR_NAME,"id-id":"Pemegang Hak Cipta: "+GAME_SR_NAME,"th-th":"\u0e1c\u0e39\u0e49\u0e16\u0e37\u0e2d\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c\u0e25\u0e34\u0e02\u0e2a\u0e34\u0e17\u0e18\u0e34\u0e4c: "+GAME_SR_NAME,"vi-vn":"Ch\u1ee7 s\u1edf h\u1eefu b\u1ea3n quy\u1ec1n: "+GAME_SR_NAME,"es-es":"Titular de los derechos: "+GAME_SR_NAME,"pt-pt":"Detentor dos Direitos Autorais: "+GAME_SR_NAME,"de-de":"Urheberrechtsinhaber: "+GAME_SR_NAME,"fr-fr":"Titulaire des droits d\u2019auteur : "+GAME_SR_NAME,"it-it":"Titolare del copyright: "+GAME_SR_NAME,"tr-tr":"Telif Hakk\u0131 Sahibi: "+GAME_SR_NAME},t.init(),e()})},lanList:["zh-cn","en-us","zh-tw","ko-kr","ru-ru","ja-jp","id-id","th-th","vi-vn","es-es","pt-pt","de-de","fr-fr","it-it","tr-tr"],init:function(){var e=window.launchQuery;e.lan?window.LAN=e.lan:window.LAN="zh-cn"==cc.sys.languageCode?"zh-cn":"en-us",console.log("local init LAN",cc.sys.language,cc.sys.languageCode,LAN),["google"].includes(CH)&&(URLS.privacy_protocol="https://sites.google.com/view/superdan-privacy-policy/home"),loadTalentDefine(),loadHeroStatDefine(),loadDifficultyAffixDefine(),loadBackpackItemDefine(),TalentDefineInit()},loadMany:function(e){var t=this.list,i=0,a=t.length;for(var n in t){var o=t[n];cc.resources.load("excel/"+o,cc.JsonAsset,function(t,n){if(!t){var o=n.json;local.addExcel(excel.getExcelArray(o))}++i>=a&&e()})}},addExcel:function(e){for(var t in e){var a=e[t],n=a["zh-cn"],o=a.index;for(var r in n&&(i[n]=a),o&&(i[o]&&cc.warn("err cover local arr: "+LAN+","+o),i[o]=a),a)"index"!==r&&a[r]&&(a[r]=a[r].replace("\\n","\n"))}},addComp:function(){},removeComp:function(){},translate:function(e,t){return t?e.replace(/\{.+?\}/g,function(e){return t[e.substr(1,e.length-2)]}):e},translateByCn:function(e,t){var n,o=i[e];return o?(n=o[LAN])||("zh-cn"==LAN?n=e:(LAN&&cc.warn("no local str: "+LAN+","+e),n=o["en-us"]||e)):(a.includes(e)||(a.push(e),LAN&&cc.warn("err no local arr: "+LAN+","+e),cc.sys.localStorage.setItem("no_trans",JSON.stringify(a))),n=e),local.translate(n,t)},translateById:function(e,t){var n=i[e];if(!n)return a.includes(e)||(a.push(e),LAN&&cc.error("err no local index: "+LAN+","+e),cc.sys.localStorage.setItem("no_trans",JSON.stringify(a)))," "+e;var o=n[LAN];if(!o){if("zh-cn"===LAN)return LAN&&cc.error("err no local index zh-cn: "+LAN+","+e),e;if(DEV_MODE)return LAN&&cc.error("no local index str: "+LAN+","+e),e;o=n["en-us"]||n["zh-cn"]}return local.translate(o,t)}},window.LT=local.translateByCn,window.LI=local.translateById,cc._RF.pop()},{}],machineGun:[function(e,t){"use strict";cc._RF.push(t,"e3d4dz0wHVGPrfhPDRo09YH","machineGun"),e("./define");var i=e("../entities/environment/MyTower"),a=e("../ai/units/AIMyTower");BULLET_DEFINE[MACHINE_GUN]=[{name:"\u673a\u67aa",avatar:{sx:.4,sy:.6,sx1:.4,sy1:.6,st:.02,frm:"avatar/98k",hitEffect:EFFECT.yellowHit,noBlend:!0,hitFloorEffect:EFFECT.hitFloorSmoke},length:20,kb:.02,n:1,wd:0,d:14,spd:2400,spdFluc:.2,distance:1e3,thrDecline:1,thrChance:0},{name:"\u673a\u67aa\u8fc7\u70ed",avatar:{sx:.4,sy:.6,sx1:.5,sy1:1,st:.02,frm:"avatar/98k",hitEffect:EFFECT.yellowHit,noBlend:!0,hitFloorEffect:EFFECT.hitFloorSmoke},length:20,kb:.02,n:1,wd:0,d:3,spd:2500,spdFluc:.2,distance:1e3,thrDecline:1,thrChance:0}],ENTITY[MACHINE_GUN]={id:MACHINE_GUN,hero:!0,category:"machinegun",name:"\u673a\u67aa",avatar:{gunBone:"gun",animeName:"jiqiang",anime:"weapon/jiqiang",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,armor:1e3,crit:0,bltDmg:30,blt:BULLET_DEFINE[MACHINE_GUN],bltMax:0,bltReload:1,attackCenter:cc.v2(12.25*1.1,-14.3),attackVolume:.3,attackSequence:[{t:.15,x:96,y:19.8,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLight}],attackAngle:[-40,80],heatUpOnShot:2.3,heatMin:0,heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},ENTITY[MACHINE_GUN+"_2"]={id:MACHINE_GUN+"_2",hero:!0,category:"machinegun_2",name:"\u673a\u67aa2",avatar:{gunBone:"gun",animeName:"jiqiang2",anime:"weapon/jiqiang",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:45,blt:BULLET_DEFINE[MACHINE_GUN],bltMax:0,bltReload:1,attackCenter:cc.v2(12.25*1.1,-14.3),attackVolume:.3,attackSequence:[{t:.17,x:96,y:19.8,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLight}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},ENTITY[MACHINE_GUN+"_3"]={id:MACHINE_GUN+"_3",hero:!0,category:"machinegun_3",name:"\u673a\u67aa3",avatar:{gunBone:"gun",animeName:"jiqiang3",anime:"weapon/jiqiang",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:68,blt:BULLET_DEFINE[MACHINE_GUN],bltMax:0,bltReload:1,attackCenter:cc.v2(12.25*1.1,-14.3),attackVolume:.3,attackSequence:[{t:.17,x:96,y:19.8,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLight}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},ENTITY[MACHINE_GUN+"_4"]={id:MACHINE_GUN+"_4",hero:!0,category:"machinegun_4",name:"\u673a\u67aa4",avatar:{gunBone:"gun",animeName:"jiqiang4",anime:"weapon/jiqiang",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:102,blt:BULLET_DEFINE[MACHINE_GUN],bltMax:0,bltReload:1,attackCenter:cc.v2(12.25*1.1,-14.3),attackVolume:.3,attackSequence:[{t:.17,x:96,y:19.8,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLight}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},RES[MACHINE_GUN]=[{anime:"weapon/jiqiang"},"avatar/98k","sound/machine_gun",RES.yellowHit],cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","./define":"define"}],map:[function(e,t){"use strict";cc._RF.push(t,"8b4f4S21U1IuKXqpF6TTkt6","map"),window.UPGRADE_MAP_DATA=function(e){return(!e.version||e.version<1)&&(e.ground=[{i:0,list:e.ground||[]}],e.version=1),e},window.map={load:function(e,t){cc.resources.load(e,cc.JsonAsset,function(e,i){if(e)t(e);else{var a=i.json;t(0,UPGRADE_MAP_DATA(a))}})},loadMany:function(e,t){var i=e.length,a={},n=function(){var n=e[o];cc.resources.load(n,cc.BufferAsset,function(e,o){if(e)t(e);else{var r=kit.buffer2str(o._buffer),s=JSON.parse(r);a[n]=UPGRADE_MAP_DATA(s),0==--i&&t(0,a)}})};for(var o in e)n()}},cc._RF.pop()},{}],md5:[function(require,module,exports){(function(global){"use strict";cc._RF.push(module,"62dc4IlLI5N97R2Co7cDULu","md5"),function(global){(function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root;root=WINDOW?window:{},root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,process=window.process,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var i=OUTPUT_TYPES[t];e[i]=createOutputMethod(i)}return e},nodeWrap=function nodeWrap(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t,i,a,n=typeof e;if("string"!==n){if("object"!==n)throw ERROR;if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw ERROR;t=!0}for(var o=0,r=e.length,s=this.blocks,c=this.buffer8;o<r;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),t)if(ARRAY_BUFFER)for(a=this.start;o<r&&a<64;++o)c[a++]=e[o];else for(a=this.start;o<r&&a<64;++o)s[a>>2]|=e[o]<<SHIFT[3&a++];else if(ARRAY_BUFFER)for(a=this.start;o<r&&a<64;++o)(i=e.charCodeAt(o))<128?c[a++]=i:i<2048?(c[a++]=192|i>>6,c[a++]=128|63&i):i<55296||i>=57344?(c[a++]=224|i>>12,c[a++]=128|i>>6&63,c[a++]=128|63&i):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++o)),c[a++]=240|i>>18,c[a++]=128|i>>12&63,c[a++]=128|i>>6&63,c[a++]=128|63&i);else for(a=this.start;o<r&&a<64;++o)(i=e.charCodeAt(o))<128?s[a>>2]|=i<<SHIFT[3&a++]:i<2048?(s[a>>2]|=(192|i>>6)<<SHIFT[3&a++],s[a>>2]|=(128|63&i)<<SHIFT[3&a++]):i<55296||i>=57344?(s[a>>2]|=(224|i>>12)<<SHIFT[3&a++],s[a>>2]|=(128|i>>6&63)<<SHIFT[3&a++],s[a>>2]|=(128|63&i)<<SHIFT[3&a++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++o)),s[a>>2]|=(240|i>>18)<<SHIFT[3&a++],s[a>>2]|=(128|i>>12&63)<<SHIFT[3&a++],s[a>>2]|=(128|i>>6&63)<<SHIFT[3&a++],s[a>>2]|=(128|63&i)<<SHIFT[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(this.hashed||this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,i,a,n,o,r=this.blocks;this.first?t=((t=((e=((e=r[0]-680876937)<<7|e>>>25)-271733879<<0)^(i=((i=(-271733879^(a=((a=(-1732584194^2004318071&e)+r[1]-117830708)<<12|a>>>20)+e<<0)&(-271733879^e))+r[2]-1126478375)<<17|i>>>15)+a<<0)&(a^e))+r[3]-1316259209)<<22|t>>>10)+i<<0:(e=this.h0,t=this.h1,i=this.h2,t=((t+=((e=((e+=((a=this.h3)^t&(i^a))+r[0]-680876936)<<7|e>>>25)+t<<0)^(i=((i+=(t^(a=((a+=(i^e&(t^i))+r[1]-389564586)<<12|a>>>20)+e<<0)&(e^t))+r[2]+606105819)<<17|i>>>15)+a<<0)&(a^e))+r[3]-1044525330)<<22|t>>>10)+i<<0),t=((t+=((e=((e+=(a^t&(i^a))+r[4]-176418897)<<7|e>>>25)+t<<0)^(i=((i+=(t^(a=((a+=(i^e&(t^i))+r[5]+1200080426)<<12|a>>>20)+e<<0)&(e^t))+r[6]-1473231341)<<17|i>>>15)+a<<0)&(a^e))+r[7]-45705983)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(a^t&(i^a))+r[8]+1770035416)<<7|e>>>25)+t<<0)^(i=((i+=(t^(a=((a+=(i^e&(t^i))+r[9]-1958414417)<<12|a>>>20)+e<<0)&(e^t))+r[10]-42063)<<17|i>>>15)+a<<0)&(a^e))+r[11]-1990404162)<<22|t>>>10)+i<<0,t=((t+=((e=((e+=(a^t&(i^a))+r[12]+1804603682)<<7|e>>>25)+t<<0)^(i=((i+=(t^(a=((a+=(i^e&(t^i))+r[13]-40341101)<<12|a>>>20)+e<<0)&(e^t))+r[14]-1502002290)<<17|i>>>15)+a<<0)&(a^e))+r[15]+1236535329)<<22|t>>>10)+i<<0,t=((t+=((a=((a+=(t^i&((e=((e+=(i^a&(t^i))+r[1]-165796510)<<5|e>>>27)+t<<0)^t))+r[6]-1069501632)<<9|a>>>23)+e<<0)^e&((i=((i+=(e^t&(a^e))+r[11]+643717713)<<14|i>>>18)+a<<0)^a))+r[0]-373897302)<<20|t>>>12)+i<<0,t=((t+=((a=((a+=(t^i&((e=((e+=(i^a&(t^i))+r[5]-701558691)<<5|e>>>27)+t<<0)^t))+r[10]+38016083)<<9|a>>>23)+e<<0)^e&((i=((i+=(e^t&(a^e))+r[15]-660478335)<<14|i>>>18)+a<<0)^a))+r[4]-405537848)<<20|t>>>12)+i<<0,t=((t+=((a=((a+=(t^i&((e=((e+=(i^a&(t^i))+r[9]+568446438)<<5|e>>>27)+t<<0)^t))+r[14]-1019803690)<<9|a>>>23)+e<<0)^e&((i=((i+=(e^t&(a^e))+r[3]-187363961)<<14|i>>>18)+a<<0)^a))+r[8]+1163531501)<<20|t>>>12)+i<<0,t=((t+=((a=((a+=(t^i&((e=((e+=(i^a&(t^i))+r[13]-1444681467)<<5|e>>>27)+t<<0)^t))+r[2]-51403784)<<9|a>>>23)+e<<0)^e&((i=((i+=(e^t&(a^e))+r[7]+1735328473)<<14|i>>>18)+a<<0)^a))+r[12]-1926607734)<<20|t>>>12)+i<<0,t=((t+=((o=(a=((a+=((n=t^i)^(e=((e+=(n^a)+r[5]-378558)<<4|e>>>28)+t<<0))+r[8]-2022574463)<<11|a>>>21)+e<<0)^e)^(i=((i+=(o^t)+r[11]+1839030562)<<16|i>>>16)+a<<0))+r[14]-35309556)<<23|t>>>9)+i<<0,t=((t+=((o=(a=((a+=((n=t^i)^(e=((e+=(n^a)+r[1]-1530992060)<<4|e>>>28)+t<<0))+r[4]+1272893353)<<11|a>>>21)+e<<0)^e)^(i=((i+=(o^t)+r[7]-155497632)<<16|i>>>16)+a<<0))+r[10]-1094730640)<<23|t>>>9)+i<<0,t=((t+=((o=(a=((a+=((n=t^i)^(e=((e+=(n^a)+r[13]+681279174)<<4|e>>>28)+t<<0))+r[0]-358537222)<<11|a>>>21)+e<<0)^e)^(i=((i+=(o^t)+r[3]-722521979)<<16|i>>>16)+a<<0))+r[6]+76029189)<<23|t>>>9)+i<<0,t=((t+=((o=(a=((a+=((n=t^i)^(e=((e+=(n^a)+r[9]-640364487)<<4|e>>>28)+t<<0))+r[12]-421815835)<<11|a>>>21)+e<<0)^e)^(i=((i+=(o^t)+r[15]+530742520)<<16|i>>>16)+a<<0))+r[2]-995338651)<<23|t>>>9)+i<<0,t=((t+=((a=((a+=(t^((e=((e+=(i^(t|~a))+r[0]-198630844)<<6|e>>>26)+t<<0)|~i))+r[7]+1126891415)<<10|a>>>22)+e<<0)^((i=((i+=(e^(a|~t))+r[14]-1416354905)<<15|i>>>17)+a<<0)|~e))+r[5]-57434055)<<21|t>>>11)+i<<0,t=((t+=((a=((a+=(t^((e=((e+=(i^(t|~a))+r[12]+1700485571)<<6|e>>>26)+t<<0)|~i))+r[3]-1894986606)<<10|a>>>22)+e<<0)^((i=((i+=(e^(a|~t))+r[10]-1051523)<<15|i>>>17)+a<<0)|~e))+r[1]-2054922799)<<21|t>>>11)+i<<0,t=((t+=((a=((a+=(t^((e=((e+=(i^(t|~a))+r[8]+1873313359)<<6|e>>>26)+t<<0)|~i))+r[15]-30611744)<<10|a>>>22)+e<<0)^((i=((i+=(e^(a|~t))+r[6]-1560198380)<<15|i>>>17)+a<<0)|~e))+r[13]+1309151649)<<21|t>>>11)+i<<0,t=((t+=((a=((a+=(t^((e=((e+=(i^(t|~a))+r[4]-145523070)<<6|e>>>26)+t<<0)|~i))+r[11]-1120210379)<<10|a>>>22)+e<<0)^((i=((i+=(e^(a|~t))+r[2]+718787259)<<15|i>>>17)+a<<0)|~e))+r[9]-343485551)<<21|t>>>11)+i<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=i-1732584194<<0,this.h3=a+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+i<<0,this.h3=this.h3+a<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,a=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,a=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,255&a,a>>8&255,a>>16&255,a>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,i,a="",n=this.array(),o=0;o<15;)e=n[o++],t=n[o++],i=n[o++],a+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[63&(e<<4|t>>>4)]+BASE64_ENCODE_CHAR[63&(t<<2|i>>>6)]+BASE64_ENCODE_CHAR[63&i];return e=n[o],a+(BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"==")};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&define(function(){return exports}))})()}.call(void 0,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),cc._RF.pop()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],mob:[function(e,t){"use strict";cc._RF.push(t,"2b519SXBepBspQkhPsln8vL","mob"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=e("../entities/projectiles/BallBulletSprite"),n=e("../entities/projectiles/Bomb"),o=e("../components/visual/Avatar"),r=e("../ai/behaviors/combat/AISoldier"),s=e("./Exploder");ENTITY[E_ROCKET]={id:E_ROCKET,name:"\u5bfc\u5f39\u6765\u88ad",ctor:s,avatar:{ctor:o,frm:"avatar/rocket/daodan",s:.9,moveSpd:50,effect:EFFECT.rocketTail},deathEffect:EFFECT.deathHide,preCreateEffect:EFFECT.AlertLine,fly:1,landExplode:1,radius:20,hitRadius:55,moveSpd:600,weight:50,hp:80,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.bullet,bomb:{r1:150,r0:50,dmg1:10,dmg0:20,kb:100,effect:EFFECT.explosion},pilot:{ctor:e("../ai/units/AIRocket")}},RES[E_ROCKET]=["avatar/rocket/daodan",RES.rocketTail],ENTITY.rocket_bomb={id:E_ROCKET,name:"\u70b8\u5f392",ctor:s,avatar:{ctor:o,frm:"avatar/huojiandan",s:.9,moveSpd:50},deathEffect:EFFECT.deathHide,fly:1,landExplode:1,radius:20,hitRadius:55,moveSpd:600,weight:50,hp:80,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,bomb:{r1:150,r0:50,dmg1:10,dmg0:20,kb:100,effect:EFFECT.explosion2},pilot:{ctor:e("../ai/units/AIRocket"),spdScale:.01,spdScaleAdd:1}},RES[E_ROCKET]=["avatar/rocket/daodan",RES.rocketTail],ENTITY.structure={id:"structure",name:"\u5efa\u7b51",avatar:{ctor:o,frm:"avatar/tower",s:1,moveSpd:50,z:ZORDER.HERO+1},slots:[{x:0,y:105,w:100,h:20}],deathEffect:EFFECT.woodStructureDeath,height:103,radius:95,hitRadius:95,moveSpd:0,weight:50,hp:300,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},RES.structure=["avatar/tower"],ENTITY.structure2={id:"structure2",name:"\u94c1\u5854",avatar:{ctor:o,frm:"avatar/tower2",s:1,moveSpd:50,z:ZORDER.HERO+1},slots:[{x:0,y:105,w:100,h:20}],deathEffect:EFFECT.ironStructureDeath,height:103,radius:95,hitRadius:95,moveSpd:0,weight:50,hp:1350,editor:1,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},RES.structure2=["avatar/tower2"],ENTITY.woodBox={id:"woodBox",name:"\u6728\u7bb1",editor:1,avatar:{ctor:o,frm:"theme/\u7801\u5934/\u7bb1\u5b50",s:.7,moveSpd:50,z:ZORDER.MOB-1},slots:[{x:0,y:40,w:100,h:20,safeSlotOut:1}],deathEffect:EFFECT.woodStructureDeath,height:50,radius:95,hitRadius:95,moveSpd:0,weight:50,hp:200,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},RES.woodBox=["theme/\u7801\u5934/\u7bb1\u5b50"];var c=e("../entities/items/Drop");RES.gold=["avatar/block/gold"],ENTITY.gold={name:"\u91d1\u5e01",ctor:c,avatar:{ctor:o,frm:"avatar/block/gold",z:20},onPick:function(){cc.game.emit("add_drop",{i:GOLD,n:1,tid:"pick"})}},BULLET_DEFINE.enemy_gun=[{name:"\u5927\u70ae\u70ae\u5f39",ctor:n,avatar:{ctor:a,frm:"bullet/cannon_ball",sx:.7,sy:.7,noBlend:!0,a:cc.v2(.5,.5),streakEffect:EFFECT.grenadeBulletStreak},bomb:{r1:120,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,length:20,radius:20,n:1,wd:0,d:0,spd:250,spdFluc:0,gravity:-125,distance:3450,disExtra:100}],ENTITY.enemy_gun={id:"enemy_gun",name:"\u654c\u4eba\u5927\u70ae",avatar:{gunBone:"gun",animeName:"pangpao",anime:"mob/pangpao",s:1,walkAnime:"stand",moveSpd:50},machine:1,radius:35,hitRadius:35,moveSpd:0,weight:50,hp:240,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.enemy_gun,bltMax:1,bltReload:4,deathEffect:EFFECT.explosionDeath,attackSequence:[{t:.25,x:60,y:10,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight}],pilot:{ctor:r,attackRange:650,seekRange:650,bonusAttackDeg:20}},RES.enemy_rockets=[{anime:"mob/pangpao"}],BULLET_DEFINE.enemy_rockets=[{name:"\u706b\u7bad\u5f39",ctor:n,avatar:{ctor:a,frm:"bullet/rocket",sx:.7,sy:.7,noBlend:!0,a:cc.v2(.5,.5)},bomb:{r1:120,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,length:20,radius:20,n:1,wd:0,d:5,spd:1200,spdFluc:0,gravity:-555,distance:8450,disExtra:100}],ENTITY.enemy_rockets={id:"enemy_rockets",name:"\u654c\u4eba\u706b\u7bad\u70ae",avatar:{gunBone:"gun",animeName:"pangpao",anime:"mob/pangpao",s:1,walkAnime:"stand",moveSpd:50},machine:1,radius:35,hitRadius:35,moveSpd:0,weight:50,hp:240,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.enemy_rockets,bltMax:1,bltReload:4,deathEffect:EFFECT.explosionDeath,attackSequence:[{t:.4,x:60,y:10,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.4,x:60,y:10,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.4,x:60,y:10,blt:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:3,ani:0}],pilot:{ctor:e("../ai/behaviors/combat/AIAlwaysAttack"),atkDeg:95}},RES.enemy_gun=[{anime:"mob/pangpao"}],ENTITY.balcony={id:"balcony",name:"\u9633\u53f0",avatar:{ctor:o,frm:"avatar/\u9633\u53f0",s:.9,moveSpd:50,z:ZORDER.HERO+1},slots:[{x:0,y:0,w:100,h:20}],deathEffect:EFFECT.structureDeath,fly:1,height:25,radius:50,hitRadius:50,moveSpd:0,weight:50,hp:450,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},RES.balcony=["avatar/\u9633\u53f0"],ENTITY.rail_car={id:"rail_car",name:"\u624b\u6447\u8f68\u9053\u8f66",avatar:{ctor:i,anime:"mob/guidaoche",animeName:"guidaoche",moveSpd:100,z:ZORDER.HERO+1,s:.8,flipX:-1},fixedFlipX:1,slots:[{x:-30,y:0,w:80,h:20}],deathEffect:EFFECT.railCarDeath,height:35,radius:60,hitRadius:60,moveSpd:50,weight:50,hp:350,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathSound:"sound/structure_dead",pilot:{ctor:e("../ai/core/AICommon"),vx:-1}},RES.rail_car=[{anime:"mob/guidaoche"}],BULLET_DEFINE.spider=[{name:"\u8718\u86db\u96f7",ctor:n,avatar:{ctor:a,frm:"bullet/lava_ball",sx:.5,sy:.5,noBlend:!0,a:cc.v2(.5,.5),streakEffect:EFFECT.grenadeBulletStreak},bomb:{r1:60,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},hp:30,kb:.3,jump:6,length:20,radius:20,n:1,wd:0,d:10,spd:700,spdFluc:0,gravity:-1500,distance:3450,disExtra:100}],ENTITY.spider={id:"spider",ctor:e("./Spider"),name:"\u673a\u68b0\u8718\u86db",avatar:{ctor:i,anime:"mob/yanzhu",animeName:"Armature",s:.8,moveSpd:100,z:ZORDER.BULLET+1},fixedFlipX:1,radius:80,hitRadius:80,moveSpd:150,fly:1,weight:50,hp:1650,armor:1e3,blt:BULLET_DEFINE.spider,bltMax:1,bltReload:2,deathEffect:EFFECT.spiderDeath,attackSequence:[{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"}],mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/mob/spider/dead",pilot:{ctor:e("../ai/units/AISpider"),attackRange:[400,500],safeRange:[200,400],seekRange:1e3}},RES.spider=[{anime:"mob/yanzhu"}],ENTITY.boss_spider={id:"boss_spider",ctor:e("./Spider"),name:"\u673a\u68b0\u8718\u86dbboss",avatar:{ctor:i,anime:"mob/yanzhu",animeName:"Armature",s:1,moveSpd:100,z:ZORDER.BULLET+1},fixedFlipX:1,radius:90,hitRadius:90,moveSpd:150,fly:1,weight:50,boss:1,hp:5e3,armor:1e3,blt:BULLET_DEFINE.spider,bltMax:1,bltReload:2,deathEffect:EFFECT.spiderDeath,attackSequence:[{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"},{t:.25,x:0,oy:-30,blt:1,sound:"sound/cannon_fire"}],mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/mob/spider/dead",pilot:{ctor:e("../ai/units/AISpider"),attackRange:[400,500],safeRange:[200,400],seekRange:1e3}},ENTITY.entrance={id:"entrance",name:"\u5927\u95e8",machine:1,avatar:{ctor:o,frm:"avatar/entrance",s:1,moveSpd:50,z:ZORDER.HERO+5,flipX:-1},boss:1,slots:[{x:0,y:170,w:200,h:20,slot:1,sub:1}],deathEffect:EFFECT.bossDeath,height:210,radius:95,hitRadius:150,moveSpd:0,weight:50,hp:22550,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.building,deathSound:"sound/structure_dead"},ENTITY.slime={id:"slime",name:"\u53f2\u83b1\u59c6",ctor:s,avatar:{ctor:i,animeName:"shilaimu",anime:"mob/shilaimu",s:.9,moveSpd:50},editor:1,radius:35,hitRadius:35,moveSpd:50,weight:50,hp:300,mobType:MOB_TYPE.ground,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.frogman,bltMax:6,bltReload:.9,deathEffect:EFFECT.deathHide,bomb:{r1:100,r0:50,dmg1:10,dmg0:20,kb:100,effect:EFFECT.slimeBomb},attackSequence:[{t:1,ani:0}],pilot:{ctor:e("../ai/units/AISlime"),attackRange:1,safeRange:[1,1]}},RES.slime=[{anime:"mob/shilaimu"}],ENTITY.turtle={id:"turtle",name:"\u4e4c\u9f9f",avatar:{ctor:i,animeName:"guigui",anime:"mob/guigui",s:.9,moveSpd:50},editor:1,radius:90,hitRadius:100,moveSpd:15,weight:50,hp:4e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,armor:1e3,crit:0,bltDmg:5,blt:[{name:"\u86d9\u4eba",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:6,wd:10,d:80,spd:250,spdFluc:.2,distance:600}],bltMax:6,bltReload:.9,deathEffect:EFFECT.explosionDeath,attackSequence:[{t:1,ani:1},{t:1,x:150,blt:1},{t:1,ani:0}],pilot:{ctor:e("../ai/units/AITurtle"),attackRange:555}},RES.turtle=[{anime:"mob/guigui"}],ENTITY.mosquito={id:"mosquito",name:"\u868a\u5b50",avatar:{ctor:i,animeName:"wenzi",anime:"mob/wenzi",s:.8,moveSpd:50,dy:-32},editor:1,fixedFlipX:1,g:800,machine:1,radius:50,moveSpd:150,weight:50,hp:500,out:1e3,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:4,blt:BULLET_DEFINE.helicopter,bltMax:15,bltReload:.9,deathEffect:EFFECT.helicopterDeath,fly:1,attackSequence:[{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.15,x:60,y:-20,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:2,ani:0}],pilot:{ctor:e("../ai/units/AIMosquito"),attackRange:350,seekRange:1e3},deathSound:"sound/mob/mosquito/dead"},cc._RF.pop()},{"../ai/behaviors/combat/AIAlwaysAttack":"AIAlwaysAttack","../ai/behaviors/combat/AISoldier":"AISoldier","../ai/core/AICommon":"AICommon","../ai/units/AIMosquito":"AIMosquito","../ai/units/AIRocket":"AIRocket","../ai/units/AISlime":"AISlime","../ai/units/AISpider":"AISpider","../ai/units/AITurtle":"AITurtle","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/items/Drop":"Drop","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","./Exploder":"Exploder","./Spider":"Spider","./define":"define"}],money:[function(e,t){"use strict";cc._RF.push(t,"2990cEOsPlGHI5D5fBZcHmM","money");var i=e("../../Plugins/firebase/FirebaseTracking");window.ENERGY_DEF={max:30,init:30,time:120,add:1,videoCt:5,videoAdd:10},window.SHARD_LIST=["h1","h2","h3","h4","h5","h6","h7","h8","v1","v2","v3","h99"],window.MONEY_LIST=[[GOLD],[ENERGY],[EXP],[TALENT],[DIAMOND],[BLUEPRINT_ATK],[BLUEPRINT_HP],[BLUEPRINT_SKILL],[SWEEP_TICKET],[RECRUIT_TICKET],[HERO_REFRESH_TICKET],[EXP_PROGRESSION_TRACK]];var a={init:function(){var e={};for(var t in MONEY_LIST)e[MONEY_LIST[t]]={n:0};for(var i in SHARD_LIST)e[SHARD+"."+SHARD_LIST[i]]={n:0};a.saveData=e},setOnlineData:function(e){for(var t in MONEY_LIST)a.setNum(MONEY_LIST[t],e[MONEY_LIST[t]]||0);var i=e[SHARD]||{};for(var n in SHARD_LIST)a.setNum(SHARD+"."+SHARD_LIST[n],i[SHARD_LIST[n]]);a.energyTime=e.energyTime||0,a.energyDailyCt=e.energyDailyCt||0,a.energyDailyTime=e.energyDailyTime,a.videoCount=e.videoCount||0,a.shareCount=e.shareCount||0,a.expProgressionTrack=e.expProgressionTrack||0,e[ENERGY]?a.scheduleEnergy():a.scheduleEnergy(!0)},clearScheduleEnergy:function(){void 0!==a.energyTimeout&&(clearTimeout(a.energyTimeout),a.energyTimeout=void 0)},scheduleEnergy:function(e){if(a.clearScheduleEnergy(),a.getNum(ENERGY)<ENERGY_DEF.max){var t=a.getEnergyRefreshTime();cc.log("money.scheduleEnergy",t),a.energyTimeout=setTimeout(function(){a.energyTimeout=void 0,cc.log("updateEnergy",t),a.claimEnergy(1,e)},t)}},claimEnergy:function(e,t){var i=a.getEnergyTime(),n=Math.floor(i/1e3/ENERGY_DEF.time);e&&n<e&&(n=e);var o=a.energyTime+n*ENERGY_DEF.time*1e3;o>sdk.now()&&(o=sdk.now()),n+a.getNum(ENERGY)>ENERGY_DEF.max&&(n=ENERGY_DEF.max-a.getNum(ENERGY)),cc.log("money.claimEnergy",n,o),n>0&&a.postEnergy(2,n,o,t)},postEnergy:function(e,t,i,n){var o,r,s,c,l,d;cc.log("postEnergy",e,t,i,n),n?((c={energyTime:i})[ENERGY]=ENERGY_DEF.init,o=c):(o={energyTime:i},(l={})[ENERGY]=t,r=l,(d={})[ENERGY]=ENERGY_DEF.max-t,s=d),net.postSilent("updateData",{set:o,add:r,max:s},function(n,o){if(cc.log("updateEnergy ret",n,o),n)e>0&&setTimeout(function(){a.postEnergy(e-1,t,i)},5e3);else{var r=t;r>0&&cc.game.emit("add_money",{i:ENERGY,noFly:1,n:r,tid:"time"}),a.update(o)}})},getNum:function(e){var t=a.saveData[e];return t&&t.n?t.n:0},setNum:function(e,t){var i=a.saveData[e];if(i&&void 0!==t)return i.n=t,!0},update:function(e){if(e){var t=e.doc;try{console.log("======= money update - e.doc (JSON):",JSON.stringify(t,null,2))}catch(y){console.error("Could not stringify e.doc:",y),console.log("======= money update - e.doc (raw):",t)}if(t){if(void 0!==t.videoCount&&(a.videoCount=t.videoCount),void 0!==t.shareCount&&(a.shareCount=t.shareCount,cc.game.emit("video_change")),void 0!==t.midBoxKey&&(shop.midBoxKey=t.midBoxKey),void 0!==t.bigBoxKey&&(shop.bigBoxKey=t.bigBoxKey),void 0!==t[DIAMOND]){var n=a.getNum(DIAMOND)-t[DIAMOND];n>0&&task.addDailyTaskCt("diamondCost",n)}var o=t.heroList;if(o)for(var r in o)pc.setHero(o[r]);var s=t.vehicleList;if(s)for(var c in s)pc.setVehicle(s[c]);for(var l in cc.log("money vehicleList",pc.vehicleList),MONEY_LIST){var d=MONEY_LIST[l];if(d&&0!==d.length){var h=d[0],u=t[h];if((h===GOLD||h===DIAMOND)&&void 0!==u){var p=u-a.getNum(h),f=p>0?"source":"sink",m=h===GOLD?"coin":"diamond",g=Math.abs(p);i.FirebaseTracking.logBiResource(f,m,g,u),console.log("===== [Firebase Tracking] Logged:",f,m,p,"New Balance:",u,"Level:",i.FirebaseTracking.levelID)}a.setNum(MONEY_LIST[l],t[MONEY_LIST[l]])}}for(var v in void 0!==t[SWEEP_TICKET]&&cc.game.emit("useAdTicket"),SHARD_LIST)a.setNum(SHARD+"."+SHARD_LIST[v],t[SHARD]&&t[SHARD][SHARD_LIST[v]]);void 0!==t.energyDailyCt&&(a.energyDailyCt=t.energyDailyCt||0),void 0!==t.energyDailyTime&&(a.energyDailyTime=t.energyDailyTime),void 0!==t.energyTime?(a.energyTime=t.energyTime||0,a.scheduleEnergy()):t[ENERGY]&&t[ENERGY]>=ENERGY_DEF.max&&a.clearScheduleEnergy()}}},had:function(e,t){return a.getNum(e)>=t},check:function(e,t,i){if(!a.had(e,t))return 0===e.indexOf(SHARD)?kit.info(LI("tip_equip1")):(cc.log("money check",e,LI(e)),kit.info(LI("no_money_msg",{n:LI(e)}),function(){a.showFree(e,i)})),!0},showFree:function(e,t){var i,n,o,r;if(cc.log("showFree",e,a.energyDailyCt),e!=ENERGY)return e==DIAMOND?void 0:e==TALENT?void 0:e==GOLD?void(t&&t()):void 0;a.energyDailyCt>0&&(i=ENERGY_DEF.videoAdd,n=LI("daily_times_available",{n:a.energyDailyCt}),(r={})[e]=i,r.energyDailyCt=-1,o=r,menuManager.pop("video",{title:LI("free_box",{n:LI(e)}),items:[{i:e,n:i}],count:n,checkCb:function(n){n&&sdk.useFree("home_energy",function(n){n||net.updateData({add:o},function(n,o){cc.log(n,o),n||(a.update(o),menuManager.close(),cc.game.emit("add_money",{i:e,n:i,tid:"video"}),t&&t(),YMTJ("video","energy"))})})}}))},getEnergyTime:function(){return sdk.now()-a.energyTime},getEnergyRefreshTime:function(){var e=1e3*ENERGY_DEF.time-a.getEnergyTime();return e<=0?0:e},getEnergyFullTime:function(){var e=a.getNum(ENERGY);return(ENERGY_DEF.max-e-1)*ENERGY_DEF.time*1e3+a.getEnergyRefreshTime()},getExpProgressionTrack:function(){return a.getNum(EXP_PROGRESSION_TRACK)},setExpProgressionTrack:function(e){var t;t=0==a.getNum(EXP_PROGRESSION_TRACK)?{set:{expProgressionTrack:e}}:{add:{expProgressionTrack:e}},net.updateData(t,function(e,t){console.log("[adventure]","updateData expProgressionTrack",t),money.update(t)})}};window.money=a,cc._RF.pop()},{"../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],net:[function(e,t){"use strict";cc._RF.push(t,"0503fK/K7BBtbHifkUhbEhp","net");var i=function(e){return e},a=function(e){return e},n=e("../security/pako"),o=e("../security/base64"),r={gateCount:0,status:1,httpHost:"",wsHost:"",wsPort:"6001",host:"",reqStack:[],serverIndex:-1,forcedServer:!1,waitTime:0,init:function(){var e,t,s,c,l,d,h,u;u=kit.rndInt,i=function(i){if(e=n.deflate(i),window.USE_BASE64_ENCRYPTION)return console.log("[net.encrypt] Using Base64 encryption for web"),o.encode(e);for(console.log("[net.encrypt] Using Unicode encryption for native"),t=u(256,55295),s=t^e.length,c="",l=2,d=e.length;l<d;l++)h=(e[l]^255&(s^l))+(u(1,215)<<8),c+=String.fromCharCode(h);return String.fromCharCode(t)+c},a=function(i){if(window.USE_BASE64_ENCRYPTION)return console.log("[net.decrypt] Using Base64 decryption for web"),e=o.decode(i),n.inflate(e,{to:"string"});for(console.log("[net.decrypt] Using Unicode decryption for native"),e=[120,156],t=i.charCodeAt(0)^i.length+1,s=1,c=i.length;s<c;s++)l=255&(i.charCodeAt(s)^255&(t^s+1)),e.push(l);return n.inflate(new Uint8Array(e),{to:"string"})},r.httpHost=(NGINX?"https://":"http://")+DATA_HOST+"/dat?m=",console.log(r.httpHost),r.listened||(r.listened=!0,pomelo.on("error",function(e){console.log("pomelo.error:",JSON.stringify(e)),r.gateCount--,pomelo.disconnect()}),pomelo.on("io-error",function(e){console.log("pomelo.io-error:",JSON.stringify(e)),r.gateCount--,pomelo.disconnect(),cc.sys.isNative||r.clean()}),pomelo.on("onKick",function(){console.log("onKick:"),r.gateCount--,pomelo.disconnect()}),pomelo.on("close",function(){if(console.log("pomelo.close"),r.closeCb){var e=r.closeCb;delete r.closeCb,setTimeout(e,0)}else r.clean(),setTimeout(function(){pomelo.emit("offline")},0)}))},clean:function(e){cc.log("net.clean:"+r.reqStack.length),r.status=1;var t=r.reqStack;for(var i in r.reqStack=[],t){var a=t[i];a.cb&&a.cb(e)}Date.now()>r.serverDate&&(cc.log("refreshConfig?",r.serverDate),r.postSilent("getConfig",{v:CODE_VERSION,ch:sdk.getChannelName()},function(e,t){cc.log("getConfig",e,t),e||(r.serverDate=Date.now()+6e4,sdk.setConfigData(t))}))},setServerCfg:function(e){var t;e&&(e.host&&(t=NGINX?"wss://"+e.host:"ws://"+e.host)!=r.wsHost&&(r.gateCount=0,r.wsHost=t),e.port&&(r.wsPort=e.port),void 0!==e.wait&&(r.waitTime=e.wait||0),void 0!==e.time&&(r.matchTime=e.time||0),void 0!==e.ai&&(r.aiRate=e.ai||0))},gate:function(){var e,t;NGINX?(e=r.wsHost+"/con?p="+r.wsPort,t=""):(e=r.wsHost,t=r.wsPort),cc.log("net.gate: "+e+","+t,4),pomelo.init({host:e,port:t,nolog:!0},function(){r.status=2,cc.log("net.gate connected",4),pomelo.request("gate.gateHandler.queryEntry",function(e){e&&200==e.code&&(cc.log("net.gate:success "+e.port),r.gateCount=3,NGINX?(r.host=r.wsHost+"/con?p="+e.port,r.port=""):(r.host=r.wsHost,r.port=e.port),r.closeCb=r.connect),pomelo.disconnect()})})},disconnect:function(){cc.log("net.disconnect"),pomelo.disconnect()},connect:function(){cc.log("net.connect "+r.host+":"+r.port,4),r.status=3,pomelo.init({host:r.host,port:r.port,reconnect:!1,nolog:!0},function(){r.status=4,r.login()})},login:function(){pomelo.request("connector.entryHandler.login",{uid:user.getUID(),v:CORE_VERSION},function(e){if(!e||200!=e.code)return cc.log("login fail:",e),void r.clean(e);for(cc.log("net.connect connected: "+r.host+":"+r.port,4),r.status=5;r.reqStack.length>0;){var t=r.reqStack.pop();r.call(t.method,t.route,t.args,t.cb)}})},call:function(e,t,i,a){5==r.status?1==e?pomelo.request(t,i,a):2==e&&pomelo.notify(t,i,a):(r.reqStack.push({method:e,route:t,args:i,cb:a}),r.gateCount<=0?r.gate():1==r.status&&r.connect())},on:function(e,t){pomelo.on(e,t)},removeListener:function(e,t){pomelo.removeListener(e,t)},removeAllListeners:function(e){pomelo.removeAllListeners(e)},notify:function(e,t){r.call(2,e,t)},reqCallback:function(e,t){e?200!=e.code?t(!1,e,e.msg||LI("net_err1",{n:e.code})):t(!0,e):t(!1,null,LI("net_err0"))},request:function(e,t,i){console.log("request",e,t),r.call(1,e,t,function(t){console.log("request ret",e,t),r.reqCallback(t,i)})},reqSilent:function(e,t,i){console.log("reqSilent",e,t),r.call(1,e,t,function(t){console.log("reqSilent ret",e,t),r.reqCallback(t,i)})},err2str:function(e,t){return 1===e?LI("net_err2"):3===e?LI("net_err3"):2===e?LI("net_err1",{n:t.err}):4===e?LI("net_err5"):5===e?LI("net_err6"):999===e?LI("net_err4"):e?LI("net_err0"):void 0},post:function(e,t,i,a){void 0===a&&(a=0),r.postByHttp(e,t,function(n,o){if(console.log("netPost:",o),n){var s=r.err2str(n,o),c=a*a;if(999===n&&o)try{var l=JSON.parse(o);cc.log(l,l.ts-Date.now()),l.ts&&l.ts>Date.now()&&(c=l.ts-Date.now()),l.msg&&(s=l.msg)}catch(d){cc.error("post parse err 4")}menuManager.queue("net_report",{title:LI("net_err_title"),info:s,time:c,zIndex:9999,noLogin:a<2,checkCb:function(n){n?r.post(e,t,i,a+1):menuManager.run("login",null,!0)}})}else i&&i(n,o)})},updateLazyData:function(e){console.log("updateLazyData");var t=e.set,i=e.add;if(t)for(var a in r.lazySetData||(r.lazySetData={}),t)r.lazySetData[a]=t[a];if(i)for(var n in r.lazyAddData||(r.lazyAddData={}),i)r.lazyAddData[n]=i[n]},applyLazyData:function(e){console.log("applyLazyData");var t=r.lazySetData;if(t){var i=e.set;for(var a in i||(i={},e.set=i),t)null!=i[a]&&cc.warn("applyLazyData repeat",a,i[a],t[a]),i[a]=t[a];delete r.lazySetData}var n=r.lazyAddData;if(n){var o=e.add;for(var s in o||(o={},e.add=o),n)null!=o[s]&&cc.warn("applyLazyData repeat",s,o[s],n[s]),o[s]=n[s];delete r.lazyAddData}},pushLazyData:function(e){console.log("pushLazyData",e),(r.lazySetData||r.lazyAddData)&&r.updateData({},e)},updateData:function(e,t){if(e.price){e.add=e.add||{},e.min=e.min||{};var i=e.price.i;e.price.id&&(i+="."+e.price.id),e.add[i]=e.add[i]||0,e.add[i]-=e.price.n||0,e.min[i]=-e.add[i]}if(e.items)for(var a in e.add=e.add||{},e.items){var n=e.items[a];i=n.i,n.id&&(i+="."+n.id),e.add[i]=e.add[i]||0,e.add[i]+=n.n||0}if(e.vehicles)for(var a in e.set=e.set||{},e.vehicles){var o=e.vehicles[a];i=VEHICLE+"."+o.id,o.atk&&(e.set[i+".atk"]=o.atk),o.star&&(e.set[i+".star"]=o.star)}if(e.heroes)for(var a in e.set=e.set||{},e.heroes)o=e.heroes[a],i=HERO+"."+o.id,o.atk&&(e.set[i+".atk"]=o.atk),o.star&&(e.set[i+".star"]=o.star),o.stat&&(e.set[i+".stat"]=o.stat);r.applyLazyData(e),console.log("UpdateData",e,t),r.post("updateData",e,t)},postSilent:function(e,t,i){r.postByHttp(e,t,i,!1)},postByHttp:function(e,t,n,o){void 0===t&&(t={}),void 0===o&&(o=!0);var s=!0;t.token=r.token,t.ts=sdk.now();var c,l=null;o&&(l=menuManager.popCover());var d=function(e,t){s&&(s=!1,r.posting=!1,l&&(menuManager.closeCover(l),l=null),n&&(n(e,t),n=null))};try{c=JSON.stringify(t)}catch(p){return cc.error("net.postByHttp: JSON.stringify param err"),void d(5)}var h=new XMLHttpRequest;h.timeout=5e3,h.ontimeout=function(){cc.error("net.postByHttp: ontimeout"),d(1)};var u=i(c);h.open("POST",r.httpHost+e,!0),h.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),h.setRequestHeader("X-Protocol-Version",window.USE_BASE64_ENCRYPTION?"base64":"unicode"),h.onloadend=function(){if(4==h.readyState&&h.status>=200&&h.status<=206){var t,i=h.response;try{var n=a(i);n&&(t=JSON.parse(n)),t&&t.err&&(cc.error("net.postByHttp: response.err="+t.err,e),d(2,t))}catch(p){cc.error("xhr.onloadend",p.fileName+":"+p.lineNumber+"\n"+p.message+"\n\n"+p.stack),d(3)}d(0,t)}else cc.error("net.postByHttp: xhr.status="+h.status,e),d(4)},h.send(u)}};window.net=r,cc._RF.pop()},{"../security/base64":"base64","../security/pako":"pako"}],noob:[function(e,t){"use strict";cc._RF.push(t,"afd6bf5zbVDTrs07hWjnUdq","noob"),e("./define");var i=e("../entities/vehicles/VehicleAvatar"),a=e("./MyVehicle"),n=e("../components/combat/skills/BombSkill"),o=e("../components/combat/skills/IncendiarySkill"),r=e("../components/combat/skills/NukeSkill");SKILL_DEFINE.bomb={name:"\u9971\u548c\u8f70\u70b8",ctor:n,t:4,cd:50,icon:"ui/joystick/ult/1",ult:{energyToTime:.025,heroEnergy:20,hurtEnergy:2e3}},SKILL_DEFINE.incendiary={name:"\u71c3\u70e7\u5f39",ctor:o,t:4,cd:50,icon:"ui/joystick/ult/3",ult:{energyToTime:.025,heroEnergy:20,hurtEnergy:2e3}},SKILL_DEFINE.nuke={name:"\u6838\u5f39",ctor:r,t:4,cd:50,icon:"ui/joystick/ult/2",ult:{energyToTime:.025,heroEnergy:20,hurtEnergy:2e3}},ENTITY[VEHICLE_BASE]={id:VEHICLE_BASE,wheels:[-60,80],hero:!0,name:"\u88c5\u7532\u8fd0\u5175\u8f66",avatar:{ctor:i,animeName2:"chejia",animeName:"cheshen",anime:"zhanche",s:.85,dy:-10,standAnime:"walk",moveSpd:80,bench:[{name:"cman1"},{name:"cman2"},{name:"cman3"},{name:"cman4"}],stage:[{name:"jiazi1"},{name:"jiazi2"},{name:"jiazi3"},{name:"jiazi4"}]},towerSlots:[{name:"gun1",dy:155},{name:"gun2",dy:255},{name:"gun3",dy:355},{name:"gun4",dy:455}],heroSlots:[{name:"man1"},{name:"man2"},{name:"man3"},{name:"man4"}],ctor:a,radius:110,hitRadius:100,height:10,moveSpd:50,weight:50,hp:550,armor:1e3,skill:[SKILL_DEFINE.bomb],pilot:{aimBest:1800,aimDeg:30,keepRange1:200,attackRange:500}},RES[VEHICLE_BASE]=[RES.launchBomb,RES.launchSmoke],cc._RF.pop()},{"../components/combat/skills/BombSkill":"BombSkill","../components/combat/skills/IncendiarySkill":"IncendiarySkill","../components/combat/skills/NukeSkill":"NukeSkill","../entities/vehicles/VehicleAvatar":"VehicleAvatar","./MyVehicle":"MyVehicle","./define":"define"}],numberEffect:[function(e,t){"use strict";cc._RF.push(t,"81888ZCabBFQ5ELl6BWdqqn","numberEffect"),e("../../managers/EffectManager"),EFFECT.hurtRed=function(e,t){if(e){var i=e.displayNode||e.node;t?(i.color=cc.color(t.r,t.g,t.b),i.stopAllActionsVS(),i.runActionVS(cc.sequence(cc.tintTo(.03,255,255,255),cc.tintTo(.03,t.r,t.g,t.b),cc.tintTo(.03,255,255,255)))):(i.color=cc.color(255,66,0),i.stopAllActionsVS(),i.hurtRed=i.runActionVS(cc.sequence(cc.tintTo(.03,255,255,255),cc.tintTo(.03,255,66,0),cc.tintTo(.03,255,255,255))))}},RES.hurtDeathNum=[{path:"effect/num/number_light",type:cc.Font},{path:"effect/num/number_crit",type:cc.Font}],EFFECT.hurtDeathNum=function(e,t,i,a,n,o){return EFFECT.hurtNum.call(this,e,t,i,a,n,o)},RES.hurtNum=[{path:"effect/num/number_light",type:cc.Font},{path:"effect/num/number_crit",type:cc.Font},{path:"effect/num/number_heat",type:cc.Font}],EFFECT.hurtNum=function(e,t,i,a,n,o){if(!(i<=0||n===DMG_TYPE.platform)){var r,s,c;o?(r="effect/num/number_heat",s=20,c=2):a?(r="effect/num/number_crit",s=28,c=3):(r="effect/num/number_light",s=20,c=2);var l,d=t.avatar.getPosition(),h=this.createLabel(d.x,d.y,r,Math.ceil(i),s);this.layer.addToCamera(h,ZORDER.UI+c),h.scale=a?6:0,h.opacity=255,h.label.spacingX=-5,l=this.layer.flipX?-1:1;var u=kit.rnd(.05,.05);h.runActionVS(cc.sequence(cc.spawn(a&&cc.scaleTo(u,1.6*l,1.6)||cc.scaleTo(u,2.4*l,2.4),cc.moveBy(2*u,kit.rnd(-50,50),50+kit.rnd(0,100))),cc.spawn(a&&cc.scaleTo(2*u/3,2.4*l,2.4)||cc.scaleTo(u,1.8*l,1.8),cc.moveBy(1.501,0,50),cc.sequence(a&&cc.delayTime(.65)||cc.delayTime(.5),cc.spawn(cc.fadeOut(.1),cc.scaleTo(.1,0)))),cc.recycle())),EFFECT.hurtRed.call(this,t.avatar,e.hurtColor)}},RES.healNum=[{path:"effect/num/number_heal",type:cc.Font}],EFFECT.healNum=function(e,t,i,a){var n,o,r=t.avatar.getPosition(),s=this.createLabel(r.x,r.y,"effect/num/number_heal",Math.ceil(i),28);this.layer.addToCamera(s,ZORDER.UI),s.scale=0,s.opacity=255,s.label.spacingX=-5,n=a?1.2:1,o=this.layer.flipX?-1:1,s.runActionVS(cc.sequence(cc.scaleTo(.01,n*o,n),cc.moveBy(.5,kit.rnd(-20,20),kit.rnd(50,80)).easing(cc.easeElasticOut()),cc.fadeOut(.2),cc.recycle()))},RES.dodgeNum=["effect/num/dodge"],EFFECT.dodgeNum=function(e,t){var i,a=t.avatar,n=this.createSprite(a.x,a.y,"effect/num/dodge");this.layer.addToCamera(n,ZORDER.UI+1),n.scale=0,n.opacity=255,i=this.layer.flipX?-1:1;var o=kit.rnd(.05,.15);n.runActionVS(cc.sequence(cc.spawn(cc.scaleTo(o,2*i,2),cc.moveBy(o,kit.rnd(-50,50),kit.rnd(-50,80))),cc.spawn(cc.moveBy(1.3,0,30),cc.sequence(cc.delayTime(.15),cc.spawn(cc.fadeOut(.2),cc.scaleTo(.2,0)))),cc.recycle()))},cc._RF.pop()},{"../../managers/EffectManager":"EffectManager"}],operatorInfoBox:[function(e,t){"use strict";cc._RF.push(t,"cc925LJUaZOzpdrSESclYTG","operatorInfoBox"),cc.Class({extends:e("../ui/core/PopMenu"),properties:{icon:cc.Sprite},init:function(e){this.args=e,this.game=e.game}}),cc._RF.pop()},{"../ui/core/PopMenu":"PopMenu"}],operator:[function(e,t){"use strict";cc._RF.push(t,"23772x3pSFGgpmfSzQiGKsQ","operator"),e("./define");var i=e("../components/visual/ArmatureAvatar"),a=e("../entities/characters/Hero");ENTITY[OPERATOR]={id:OPERATOR,hero:!0,name:"\u64cd\u4f5c\u5458",avatar:{ctor:i,animeName:"degun",anime:"operator/degun",s:.7,fixedScale:1,moveSpd:150,dy:-5.5},ctor:a,radius:45,hitRadius:35,moveSpd:150,weight:50,hp:2e3,armor:1e3},RES[OPERATOR]=[],cc._RF.pop()},{"../components/visual/ArmatureAvatar":"ArmatureAvatar","../entities/characters/Hero":"Hero","./define":"define"}],pako:[function(e,t,i){"use strict";cc._RF.push(t,"b51b9XDJFRKgLM+m4MH/7Cr","pako"),function(e,a){"object"==typeof i&&void 0!==t?a(i):"function"==typeof define&&define.amd?define(["exports"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(void 0,function(e){function t(e){for(var t=e.length;--t>=0;)e[t]=0}var i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=new Array(576);t(r);var s=new Array(60);t(s);var c=new Array(512);t(c);var l=new Array(256);t(l);var d,h,u,p=new Array(29);t(p);var f=new Array(30);function m(e,t,i,a,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=a,this.max_length=n,this.has_stree=e&&e.length}function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(f);var v=function(e){return e<256?c[e]:c[256+(e>>>7)]},y=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},b=function(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,y(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},k=function(e,t,i){b(e,i[2*t],i[2*t+1])},T=function(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},_=function(e,t,i){var a,n,o=new Array(16),r=0;for(a=1;a<=15;a++)o[a]=r=r+i[a-1]<<1;for(n=0;n<=t;n++){var s=e[2*n+1];0!==s&&(e[2*n]=T(o[s]++,s))}},w=function(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},E=function(e){e.bi_valid>8?y(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},C=function(e,t,i,a){var n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&a[t]<=a[i]},S=function(e,t,i){for(var a=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&C(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!C(t,a,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=a},I=function(e,t,n){var o,r,s,c,d=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*d]<<8|e.pending_buf[e.d_buf+2*d+1],r=e.pending_buf[e.l_buf+d],d++,0===o?k(e,r,t):(s=l[r],k(e,s+256+1,t),0!==(c=i[s])&&(r-=p[s],b(e,r,c)),s=v(--o),k(e,s,n),0!==(c=a[s])&&(o-=f[s],b(e,o,c)))}while(d<e.last_lit);k(e,256,t)},A=function(e,t){var i,a,n,o=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<c;i++)0!==o[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[n]=0,e.opt_len--,s&&(e.static_len-=r[2*n+1]);for(t.max_code=l,i=e.heap_len>>1;i>=1;i--)S(e,o,i);n=c;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],S(e,o,1),a=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=a,o[2*n]=o[2*i]+o[2*a],e.depth[n]=(e.depth[i]>=e.depth[a]?e.depth[i]:e.depth[a])+1,o[2*i+1]=o[2*a+1]=n,e.heap[1]=n++,S(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,a,n,o,r,s,c=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(c[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(o=c[2*c[2*(a=e.heap[i])+1]+1]+1)>f&&(o=f,m++),c[2*a+1]=o,a>l||(e.bl_count[o]++,r=0,a>=p&&(r=u[a-p]),s=c[2*a],e.opt_len+=s*(o+r),h&&(e.static_len+=s*(d[2*a+1]+r)));if(0!==m){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(o=f;0!==o;o--)for(a=e.bl_count[o];0!==a;)(n=e.heap[--i])>l||(c[2*n+1]!==o&&(e.opt_len+=(o-c[2*n+1])*c[2*n],c[2*n+1]=o),a--)}}(e,t),_(o,l,e.bl_count)},B=function(e,t,i){var a,n,o=-1,r=t[1],s=0,c=7,l=4;for(0===r&&(c=138,l=3),t[2*(i+1)+1]=65535,a=0;a<=i;a++)n=r,r=t[2*(a+1)+1],++s<c&&n===r||(s<l?e.bl_tree[2*n]+=s:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=n,0===r?(c=138,l=3):n===r?(c=6,l=3):(c=7,l=4))},M=function(e,t,i){var a,n,o=-1,r=t[1],s=0,c=7,l=4;for(0===r&&(c=138,l=3),a=0;a<=i;a++)if(n=r,r=t[2*(a+1)+1],!(++s<c&&n===r)){if(s<l)do{k(e,n,e.bl_tree)}while(0!=--s);else 0!==n?(n!==o&&(k(e,n,e.bl_tree),s--),k(e,16,e.bl_tree),b(e,s-3,2)):s<=10?(k(e,17,e.bl_tree),b(e,s-3,3)):(k(e,18,e.bl_tree),b(e,s-11,7));s=0,o=n,0===r?(c=138,l=3):n===r?(c=6,l=3):(c=7,l=4)}},D=!1,x=function(e,t,i,a){b(e,0+(a?1:0),3),function(e,t,i){E(e),y(e,i),y(e,~i),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i}(e,t,i)},R=x,N=function(e,t,i,a){for(var n=65535&e|0,o=e>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{o=o+(n=n+t[a++]|0)|0}while(--r);n%=65521,o%=65521}return n|o<<16|0},F=new Uint32Array(function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var a=0;a<8;a++)1&e?e=3988292384^e>>>1:e>>>=1;t[i]=e}return t}()),L=function(e,t,i,a){var n=F,o=a+i;e^=-1;for(var r=a;r<o;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},P={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},O={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},U=function(e){D||(function(){var e,t,o,g,v,y=new Array(16);for(o=0,g=0;g<28;g++)for(p[g]=o,e=0;e<1<<i[g];e++)l[o++]=g;for(l[o-1]=g,v=0,g=0;g<16;g++)for(f[g]=v,e=0;e<1<<a[g];e++)c[v++]=g;for(v>>=7;g<30;g++)for(f[g]=v<<7,e=0;e<1<<a[g]-7;e++)c[256+v++]=g;for(t=0;t<=15;t++)y[t]=0;for(e=0;e<=143;)r[2*e+1]=8,e++,y[8]++;for(;e<=255;)r[2*e+1]=9,e++,y[9]++;for(;e<=279;)r[2*e+1]=7,e++,y[7]++;for(;e<=287;)r[2*e+1]=8,e++,y[8]++;for(_(r,287,y),e=0;e<30;e++)s[2*e+1]=5,s[2*e]=T(e,5);d=new m(r,i,257,286,15),h=new m(s,a,0,30,15),u=new m(new Array(0),n,0,19,7)}(),D=!0),e.l_desc=new g(e.dyn_ltree,d),e.d_desc=new g(e.dyn_dtree,h),e.bl_desc=new g(e.bl_tree,u),e.bi_buf=0,e.bi_valid=0,w(e)},q=R,G=function(e,t,i,a){var n,c,l=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),A(e,e.l_desc),A(e,e.d_desc),l=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=14+3*(t+1),t}(e),n=e.opt_len+3+7>>>3,(c=e.static_len+3+7>>>3)<=n&&(n=c)):n=c=i+5,i+4<=n&&-1!==t?x(e,t,i,a):4===e.strategy||c===n?(b(e,2+(a?1:0),3),I(e,r,s)):(b(e,4+(a?1:0),3),function(e,t,i,a){var n;for(b(e,t-257,5),b(e,i-1,5),b(e,a-4,4),n=0;n<a;n++)b(e,e.bl_tree[2*o[n]+1],3);M(e,e.dyn_ltree,t-1),M(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),I(e,e.dyn_ltree,e.dyn_dtree)),w(e),a&&E(e)},H=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(l[i]+256+1)]++,e.dyn_dtree[2*v(t)]++),e.last_lit===e.lit_bufsize-1},j=function(e){b(e,2,3),k(e,256,r),function(e){16===e.bi_valid?(y(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},Y=O.Z_NO_FLUSH,W=O.Z_PARTIAL_FLUSH,V=O.Z_FULL_FLUSH,X=O.Z_FINISH,z=O.Z_BLOCK,K=O.Z_OK,J=O.Z_STREAM_END,Z=O.Z_STREAM_ERROR,Q=O.Z_DATA_ERROR,$=O.Z_BUF_ERROR,ee=O.Z_DEFAULT_COMPRESSION,te=O.Z_FILTERED,ie=O.Z_HUFFMAN_ONLY,ae=O.Z_RLE,ne=O.Z_FIXED,oe=O.Z_DEFAULT_STRATEGY,re=O.Z_UNKNOWN,se=O.Z_DEFLATED,ce=262,le=function(e,t){return e.msg=P[t],t},de=function(e){return(e<<1)-(e>4?9:0)},he=function(e){for(var t=e.length;--t>=0;)e[t]=0},ue=function(e,t,i){return(t<<e.hash_shift^i)&e.hash_mask},pe=function(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},fe=function(e,t){G(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,pe(e.strm)},me=function(e,t){e.pending_buf[e.pending++]=t},ge=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ve=function(e,t){var i,a,n,o=e.max_chain_length,r=e.strstart,s=e.prev_length,c=e.nice_match;n=e.strstart>e.w_size-ce?e.strstart-(e.w_size-ce):0;var l=e.window,d=e.w_mask,h=e.prev,u=e.strstart+258,p=l[r+s-1],f=l[r+s];e.prev_length>=e.good_match&&(o>>=2),c>e.lookahead&&(c=e.lookahead);do{if(l[(i=t)+s]===f&&l[i+s-1]===p&&l[i]===l[r]&&l[++i]===l[r+1]){r+=2,i++;do{}while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<u);if(a=258-(u-r),r=u-258,a>s){if(e.match_start=t,s=a,a>=c)break;p=l[r+s-1],f=l[r+s]}}}while((t=h[t&d])>n&&0!=--o);return s<=e.lookahead?s:e.lookahead},ye=function(e){var t,i,a,n,o,r,s,c,l,d,h=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=h+(h-ce)){e.window.set(e.window.subarray(h,h+h),0),e.match_start-=h,e.strstart-=h,e.block_start-=h,t=i=e.hash_size;do{a=e.head[--t],e.head[t]=a>=h?a-h:0}while(--i);t=i=h;do{a=e.prev[--t],e.prev[t]=a>=h?a-h:0}while(--i);n+=h}if(0===e.strm.avail_in)break;if(r=e.strm,s=e.window,c=e.strstart+e.lookahead,l=n,d=void 0,(d=r.avail_in)>l&&(d=l),0===d?i=0:(r.avail_in-=d,s.set(r.input.subarray(r.next_in,r.next_in+d),c),1===r.state.wrap?r.adler=N(r.adler,s,d,c):2===r.state.wrap&&(r.adler=L(r.adler,s,d,c)),r.next_in+=d,r.total_in+=d,i=d),e.lookahead+=i,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=ue(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=ue(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ce&&0!==e.strm.avail_in)},be=function(e,t){for(var i,a;;){if(e.lookahead<ce){if(ye(e),e.lookahead<ce&&t===Y)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ce&&(e.match_length=ve(e,i)),e.match_length>=3)if(a=H(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ue(e,e.ins_h,e.window[e.strstart+1]);else a=H(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(fe(e,!1),0===e.strm.avail_out))return 1}return e.strstart<2?e.insert=e.strstart:e.insert=2,t===X?(fe(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(fe(e,!1),0===e.strm.avail_out)?1:2},ke=function(e,t){for(var i,a,n;;){if(e.lookahead<ce){if(ye(e),e.lookahead<ce&&t===Y)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ce&&(e.match_length=ve(e,i),e.match_length<=5&&(e.strategy===te||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,a=H(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=ue(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(fe(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((a=H(e,0,e.window[e.strstart-1]))&&fe(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=H(e,0,e.window[e.strstart-1]),e.match_available=0),e.strstart<2?e.insert=e.strstart:e.insert=2,t===X?(fe(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(fe(e,!1),0===e.strm.avail_out)?1:2};function Te(e,t,i,a,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=a,this.func=n}var _e=[new Te(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ye(e),0===e.lookahead&&t===Y)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var a=e.block_start+i;if((0===e.strstart||e.strstart>=a)&&(e.lookahead=e.strstart-a,e.strstart=a,fe(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-ce&&(fe(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(fe(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(fe(e,!1),e.strm.avail_out),1)}),new Te(4,4,8,4,be),new Te(4,5,16,8,be),new Te(4,6,32,32,be),new Te(4,4,16,16,ke),new Te(8,16,32,32,ke),new Te(8,16,128,128,ke),new Te(8,32,128,256,ke),new Te(32,128,258,1024,ke),new Te(32,258,258,4096,ke)];function we(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=se,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),he(this.dyn_ltree),he(this.dyn_dtree),he(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),he(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),he(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Ee=function(e){if(!e||!e.state)return le(e,Z);e.total_in=e.total_out=0,e.data_type=re;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.wrap?t.status=42:t.status=113,2===t.wrap?e.adler=0:e.adler=1,t.last_flush=Y,U(t),K},Ce=function(e){var t,i=Ee(e);return i===K&&((t=e.state).window_size=2*t.w_size,he(t.head),t.max_lazy_match=_e[t.level].max_lazy,t.good_match=_e[t.level].good_length,t.nice_match=_e[t.level].nice_length,t.max_chain_length=_e[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),i},Se=function(e,t,i,a,n,o){if(!e)return Z;var r=1;if(t===ee&&(t=6),a<0?(r=0,a=-a):a>15&&(r=2,a-=16),n<1||n>9||i!==se||a<8||a>15||t<0||t>9||o<0||o>ne)return le(e,Z);8===a&&(a=9);var s=new we;return e.state=s,s.strm=e,s.wrap=r,s.gzhead=null,s.w_bits=a,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=i,Ce(e)},Ie={deflateInit:function(e,t){return Se(e,t,se,15,8,oe)},deflateInit2:Se,deflateReset:Ce,deflateResetKeep:Ee,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?Z:(e.state.gzhead=t,K):Z},deflate:function(e,t){var i,a;if(!e||!e.state||t>z||t<0)return e?le(e,Z):Z;var n=e.state;if(!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==X)return le(e,0===e.avail_out?$:Z);n.strm=e;var o=n.last_flush;if(n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,me(n,31),me(n,139),me(n,8),n.gzhead?(me(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),me(n,255&n.gzhead.time),me(n,n.gzhead.time>>8&255),me(n,n.gzhead.time>>16&255),me(n,n.gzhead.time>>24&255),me(n,9===n.level?2:n.strategy>=ie||n.level<2?4:0),me(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(me(n,255&n.gzhead.extra.length),me(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=L(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(me(n,0),me(n,0),me(n,0),me(n,0),me(n,0),me(n,9===n.level?2:n.strategy>=ie||n.level<2?4:0),me(n,3),n.status=113);else{var r=se+(n.w_bits-8<<4)<<8;r|=(n.strategy>=ie||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(r|=32),r+=31-r%31,n.status=113,ge(n,r),0!==n.strstart&&(ge(n,e.adler>>>16),ge(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),pe(e),i=n.pending,n.pending!==n.pending_buf_size));)me(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),pe(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,me(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),pe(e),i=n.pending,n.pending===n.pending_buf_size)){a=1;break}a=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,me(n,a)}while(0!==a);n.gzhead.hcrc&&n.pending>i&&(e.adler=L(e.adler,n.pending_buf,n.pending-i,i)),0===a&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&pe(e),n.pending+2<=n.pending_buf_size&&(me(n,255&e.adler),me(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(pe(e),0===e.avail_out)return n.last_flush=-1,K}else if(0===e.avail_in&&de(t)<=de(o)&&t!==X)return le(e,$);if(666===n.status&&0!==e.avail_in)return le(e,$);if(0!==e.avail_in||0!==n.lookahead||t!==Y&&666!==n.status){var s;if(3!==(s=n.strategy===ie?function(e,t){for(var i;;){if(0===e.lookahead&&(ye(e),0===e.lookahead)){if(t===Y)return 1;break}if(e.match_length=0,i=H(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(fe(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(fe(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(fe(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===ae?function(e,t){for(var i,a,n,o,r=e.window;;){if(e.lookahead<=258){if(ye(e),e.lookahead<=258&&t===Y)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=r[n=e.strstart-1])===r[++n]&&a===r[++n]&&a===r[++n]){o=e.strstart+258;do{}while(a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&a===r[++n]&&n<o);e.match_length=258-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=H(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=H(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(fe(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(fe(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(fe(e,!1),0===e.strm.avail_out)?1:2}(n,t):_e[n.level].func(n,t))&&4!==s||(n.status=666),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),K;if(2===s&&(t===W?j(n):t!==z&&(q(n,0,0,!1),t===V&&(he(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),pe(e),0===e.avail_out))return n.last_flush=-1,K}return t!==X?K:n.wrap<=0?J:(2===n.wrap?(me(n,255&e.adler),me(n,e.adler>>8&255),me(n,e.adler>>16&255),me(n,e.adler>>24&255),me(n,255&e.total_in),me(n,e.total_in>>8&255),me(n,e.total_in>>16&255),me(n,e.total_in>>24&255)):(ge(n,e.adler>>>16),ge(n,65535&e.adler)),pe(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?K:J)},deflateEnd:function(e){if(!e||!e.state)return Z;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?le(e,Z):(e.state=null,113===t?le(e,Q):K)},deflateSetDictionary:function(e,t){var i=t.length;if(!e||!e.state)return Z;var a=e.state,n=a.wrap;if(2===n||1===n&&42!==a.status||a.lookahead)return Z;if(1===n&&(e.adler=N(e.adler,t,i,0)),a.wrap=0,i>=a.w_size){0===n&&(he(a.head),a.strstart=0,a.block_start=0,a.insert=0);var o=new Uint8Array(a.w_size);o.set(t.subarray(i-a.w_size,i),0),t=o,i=a.w_size}var r=e.avail_in,s=e.next_in,c=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,ye(a);a.lookahead>=3;){var l=a.strstart,d=a.lookahead-2;do{a.ins_h=ue(a,a.ins_h,a.window[l+3-1]),a.prev[l&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=l,l++}while(--d);a.strstart=l,a.lookahead=2,ye(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=s,e.input=c,e.avail_in=r,a.wrap=n,K},deflateInfo:"pako deflate (from Nodeca project)"};function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Be=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},Me=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!==Ae(i))throw new TypeError(i+"must be non-object");for(var a in i)Be(i,a)&&(e[a]=i[a])}}return e},De=function(e){for(var t=0,i=0,a=e.length;i<a;i++)t+=e[i].length;for(var n=new Uint8Array(t),o=0,r=0,s=e.length;o<s;o++){var c=e[o];n.set(c,r),r+=c.length}return n},xe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){xe=!1}for(var Re=new Uint8Array(256),Ne=0;Ne<256;Ne++)Re[Ne]=Ne>=252?6:Ne>=248?5:Ne>=240?4:Ne>=224?3:Ne>=192?2:1;Re[254]=Re[254]=1;var Fe=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,i,a,n,o,r=e.length,s=0;for(n=0;n<r;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(a=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(a-56320),n++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(s),o=0,n=0;o<s;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(a=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(a-56320),n++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t},Le=function(e,t){var i,a,n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var o=new Array(2*n);for(a=0,i=0;i<n;){var r=e[i++];if(r<128)o[a++]=r;else{var s=Re[r];s>4?(o[a++]=65533,i+=s-1):(r&=2===s?31:3===s?15:7,s>1?o[a++]=65533:r<65536?o[a++]=r:(r-=65536,o[a++]=55296|r>>10&1023,o[a++]=56320|1023&r))}}return function(e,t){if(t<65534&&e.subarray&&xe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var i="",a=0;a<t;a++)i+=String.fromCharCode(e[a]);return i}(o,a)},Pe=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Re[e[i]]>t?i:t},Oe=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Ue=Object.prototype.toString,qe=O.Z_NO_FLUSH,Ge=O.Z_SYNC_FLUSH,He=O.Z_FULL_FLUSH,je=O.Z_FINISH,Ye=O.Z_OK,We=O.Z_STREAM_END,Ve=O.Z_DEFAULT_COMPRESSION,Xe=O.Z_DEFAULT_STRATEGY,ze=O.Z_DEFLATED;function Ke(e){this.options=Me({level:Ve,method:ze,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xe},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Oe,this.strm.avail_out=0;var i=Ie.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==Ye)throw new Error(P[i]);if(t.header&&Ie.deflateSetHeader(this.strm,t.header),t.dictionary){var a;if(a="string"==typeof t.dictionary?Fe(t.dictionary):"[object ArrayBuffer]"===Ue.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=Ie.deflateSetDictionary(this.strm,a))!==Ye)throw new Error(P[i]);this._dict_set=!0}}function Je(e,t){var i=new Ke(t);if(i.push(e,!0),i.err)throw i.msg||P[i.err];return i.result}Ke.prototype.push=function(e,t){var i,a,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;for(a=t===~~t?t:!0===t?je:qe,"string"==typeof e?n.input=Fe(e):"[object ArrayBuffer]"===Ue.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(a===Ge||a===He)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if((i=Ie.deflate(n,a))===We)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Ie.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ye;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Ke.prototype.onData=function(e){this.chunks.push(e)},Ke.prototype.onEnd=function(e){e===Ye&&(this.result=De(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ze,Qe,$e=Ke,et=Je,tt=function(e,t){var i,a,n,o,r,s,c,l,d,h,u,p,f,m,g,v,y,b,k,T,_,w,E,C,S=e.state;i=e.next_in,E=e.input,a=i+(e.avail_in-5),n=e.next_out,C=e.output,o=n-(t-e.avail_out),r=n+(e.avail_out-257),s=S.dmax,c=S.wsize,l=S.whave,d=S.wnext,h=S.window,u=S.hold,p=S.bits,f=S.lencode,m=S.distcode,g=(1<<S.lenbits)-1,v=(1<<S.distbits)-1;e:do{p<15&&(u+=E[i++]<<p,p+=8,u+=E[i++]<<p,p+=8),y=f[u&g];t:for(;;){if(u>>>=b=y>>>24,p-=b,0==(b=y>>>16&255))C[n++]=65535&y;else{if(!(16&b)){if(0==(64&b)){y=f[(65535&y)+(u&(1<<b)-1)];continue t}if(32&b){S.mode=12;break e}e.msg="invalid literal/length code",S.mode=30;break e}k=65535&y,(b&=15)&&(p<b&&(u+=E[i++]<<p,p+=8),k+=u&(1<<b)-1,u>>>=b,p-=b),p<15&&(u+=E[i++]<<p,p+=8,u+=E[i++]<<p,p+=8),y=m[u&v];i:for(;;){if(u>>>=b=y>>>24,p-=b,!(16&(b=y>>>16&255))){if(0==(64&b)){y=m[(65535&y)+(u&(1<<b)-1)];continue i}e.msg="invalid distance code",S.mode=30;break e}if(T=65535&y,p<(b&=15)&&(u+=E[i++]<<p,(p+=8)<b&&(u+=E[i++]<<p,p+=8)),(T+=u&(1<<b)-1)>s){e.msg="invalid distance too far back",S.mode=30;break e}if(u>>>=b,p-=b,T>(b=n-o)){if((b=T-b)>l&&S.sane){e.msg="invalid distance too far back",S.mode=30;break e}if(_=0,w=h,0===d){if(_+=c-b,b<k){k-=b;do{C[n++]=h[_++]}while(--b);_=n-T,w=C}}else if(d<b){if(_+=c+d-b,(b-=d)<k){k-=b;do{C[n++]=h[_++]}while(--b);if(_=0,d<k){k-=b=d;do{C[n++]=h[_++]}while(--b);_=n-T,w=C}}}else if(_+=d-b,b<k){k-=b;do{C[n++]=h[_++]}while(--b);_=n-T,w=C}for(;k>2;)C[n++]=w[_++],C[n++]=w[_++],C[n++]=w[_++],k-=3;k&&(C[n++]=w[_++],k>1&&(C[n++]=w[_++]))}else{_=n-T;do{C[n++]=C[_++],C[n++]=C[_++],C[n++]=C[_++],k-=3}while(k>2);k&&(C[n++]=C[_++],k>1&&(C[n++]=C[_++]))}break}}break}}while(i<a&&n<r);i-=k=p>>3,u&=(1<<(p-=k<<3))-1,e.next_in=i,e.next_out=n,e.avail_in=i<a?a-i+5:5-(i-a),e.avail_out=n<r?r-n+257:257-(n-r),S.hold=u,S.bits=p},it=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),at=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),nt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ot=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),rt=function(e,t,i,a,n,o,r,s){var c,l,d,h,u,p,f,m,g,v=s.bits,y=0,b=0,k=0,T=0,_=0,w=0,E=0,C=0,S=0,I=0,A=null,B=0,M=new Uint16Array(16),D=new Uint16Array(16),x=null,R=0;for(y=0;y<=15;y++)M[y]=0;for(b=0;b<a;b++)M[t[i+b]]++;for(_=v,T=15;T>=1&&0===M[T];T--);if(_>T&&(_=T),0===T)return n[o++]=20971520,n[o++]=20971520,s.bits=1,0;for(k=1;k<T&&0===M[k];k++);for(_<k&&(_=k),C=1,y=1;y<=15;y++)if(C<<=1,(C-=M[y])<0)return-1;if(C>0&&(0===e||1!==T))return-1;for(D[1]=0,y=1;y<15;y++)D[y+1]=D[y]+M[y];for(b=0;b<a;b++)0!==t[i+b]&&(r[D[t[i+b]]++]=b);if(0===e?(A=x=r,p=19):1===e?(A=it,B-=257,x=at,R-=257,p=256):(A=nt,x=ot,p=-1),I=0,b=0,y=k,u=o,w=_,E=0,d=-1,h=(S=1<<_)-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){f=y-E,r[b]<p?(m=0,g=r[b]):r[b]>p?(m=x[R+r[b]],g=A[B+r[b]]):(m=96,g=0),c=1<<y-E,k=l=1<<w;do{n[u+(I>>E)+(l-=c)]=f<<24|m<<16|g|0}while(0!==l);for(c=1<<y-1;I&c;)c>>=1;if(0!==c?(I&=c-1,I+=c):I=0,b++,0==--M[y]){if(y===T)break;y=t[i+r[b]]}if(y>_&&(I&h)!==d){for(0===E&&(E=_),u+=k,C=1<<(w=y-E);w+E<T&&!((C-=M[w+E])<=0);)w++,C<<=1;if(S+=1<<w,1===e&&S>852||2===e&&S>592)return 1;n[d=I&h]=_<<24|w<<16|u-o|0}}return 0!==I&&(n[u+I]=y-E<<24|64<<16|0),s.bits=_,0},st=O.Z_FINISH,ct=O.Z_BLOCK,lt=O.Z_TREES,dt=O.Z_OK,ht=O.Z_STREAM_END,ut=O.Z_NEED_DICT,pt=O.Z_STREAM_ERROR,ft=O.Z_DATA_ERROR,mt=O.Z_MEM_ERROR,gt=O.Z_BUF_ERROR,vt=O.Z_DEFLATED,yt=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function bt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var kt=function(e){if(!e||!e.state)return pt;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,dt},Tt=function(e){if(!e||!e.state)return pt;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,kt(e)},_t=function(e,t){var i;if(!e||!e.state)return pt;var a=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?pt:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=i,a.wbits=t,Tt(e))},wt=function(e,t){if(!e)return pt;var i=new bt;e.state=i,i.window=null;var a=_t(e,t);return a!==dt&&(e.state=null),a},Et=!0,Ct=function(e){if(Et){Ze=new Int32Array(512),Qe=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(rt(1,e.lens,0,288,Ze,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;rt(2,e.lens,0,32,Qe,0,e.work,{bits:5}),Et=!1}e.lencode=Ze,e.lenbits=9,e.distcode=Qe,e.distbits=5},St=function(e,t,i,a){var n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),a>=o.wsize?(o.window.set(t.subarray(i-o.wsize,i),0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>a&&(n=a),o.window.set(t.subarray(i-a,i-a+n),o.wnext),(a-=n)?(o.window.set(t.subarray(i-a,i),0),o.wnext=a,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0},It={inflateReset:Tt,inflateReset2:_t,inflateResetKeep:kt,inflateInit:function(e){return wt(e,15)},inflateInit2:wt,inflate:function(e,t){var i,a,n,o,r,s,c,l,d,h,u,p,f,m,g,v,y,b,k,T,_,w,E,C,S=0,I=new Uint8Array(4),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return pt;12===(i=e.state).mode&&(i.mode=13),r=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,a=e.input,s=e.avail_in,l=i.hold,d=i.bits,h=s,u=c,w=dt;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;d<16;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(2&i.wrap&&35615===l){i.check=0,I[0]=255&l,I[1]=l>>>8&255,i.check=L(i.check,I,2,0),l=0,d=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",i.mode=30;break}if((15&l)!==vt){e.msg="unknown compression method",i.mode=30;break}if(d-=4,_=8+(15&(l>>>=4)),0===i.wbits)i.wbits=_;else if(_>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&l?10:12,l=0,d=0;break;case 2:for(;d<16;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(i.flags=l,(255&i.flags)!==vt){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(I[0]=255&l,I[1]=l>>>8&255,i.check=L(i.check,I,2,0)),l=0,d=0,i.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.head&&(i.head.time=l),512&i.flags&&(I[0]=255&l,I[1]=l>>>8&255,I[2]=l>>>16&255,I[3]=l>>>24&255,i.check=L(i.check,I,4,0)),l=0,d=0,i.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(I[0]=255&l,I[1]=l>>>8&255,i.check=L(i.check,I,2,0)),l=0,d=0,i.mode=5;case 5:if(1024&i.flags){for(;d<16;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(I[0]=255&l,I[1]=l>>>8&255,i.check=L(i.check,I,2,0)),l=0,d=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((p=i.length)>s&&(p=s),p&&(i.head&&(_=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(a.subarray(o,o+p),_)),512&i.flags&&(i.check=L(i.check,a,p,o)),s-=p,o+=p,i.length-=p),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===s)break e;p=0;do{_=a[o+p++],i.head&&_&&i.length<65536&&(i.head.name+=String.fromCharCode(_))}while(_&&p<s);if(512&i.flags&&(i.check=L(i.check,a,p,o)),s-=p,o+=p,_)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===s)break e;p=0;do{_=a[o+p++],i.head&&_&&i.length<65536&&(i.head.comment+=String.fromCharCode(_))}while(_&&p<s);if(512&i.flags&&(i.check=L(i.check,a,p,o)),s-=p,o+=p,_)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;d<16;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(l!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}l=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;d<32;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}e.adler=i.check=yt(l),l=0,d=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=d,ut;e.adler=i.check=1,i.mode=12;case 12:if(t===ct||t===lt)break e;case 13:if(i.last){l>>>=7&d,d-=7&d,i.mode=27;break}for(;d<3;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}switch(i.last=1&l,d-=1,3&(l>>>=1)){case 0:i.mode=14;break;case 1:if(Ct(i),i.mode=20,t===lt){l>>>=2,d-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}l>>>=2,d-=2;break;case 14:for(l>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&l,l=0,d=0,i.mode=15,t===lt)break e;case 15:i.mode=16;case 16:if(p=i.length){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;n.set(a.subarray(o,o+p),r),s-=p,o+=p,c-=p,r+=p,i.length-=p;break}i.mode=12;break;case 17:for(;d<14;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(i.nlen=257+(31&l),l>>>=5,d-=5,i.ndist=1+(31&l),l>>>=5,d-=5,i.ncode=4+(15&l),l>>>=4,d-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;d<3;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.lens[A[i.have++]]=7&l,l>>>=3,d-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,E={bits:i.lenbits},w=rt(0,i.lens,0,19,i.lencode,0,i.work,E),i.lenbits=E.bits,w){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;v=(S=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,y=65535&S,!((g=S>>>24)<=d);){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(y<16)l>>>=g,d-=g,i.lens[i.have++]=y;else{if(16===y){for(C=g+2;d<C;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(l>>>=g,d-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}_=i.lens[i.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===y){for(C=g+3;d<C;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}d-=g,_=0,p=3+(7&(l>>>=g)),l>>>=3,d-=3}else{for(C=g+7;d<C;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}d-=g,_=0,p=11+(127&(l>>>=g)),l>>>=7,d-=7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;p--;)i.lens[i.have++]=_}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,E={bits:i.lenbits},w=rt(1,i.lens,0,i.nlen,i.lencode,0,i.work,E),i.lenbits=E.bits,w){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,E={bits:i.distbits},w=rt(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,E),i.distbits=E.bits,w){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,t===lt)break e;case 20:i.mode=21;case 21:if(s>=6&&c>=258){e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=d,tt(e,u),r=e.next_out,n=e.output,c=e.avail_out,o=e.next_in,a=e.input,s=e.avail_in,l=i.hold,d=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;v=(S=i.lencode[l&(1<<i.lenbits)-1])>>>16&255,y=65535&S,!((g=S>>>24)<=d);){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(v&&0==(240&v)){for(b=g,k=v,T=y;v=(S=i.lencode[T+((l&(1<<b+k)-1)>>b)])>>>16&255,y=65535&S,!(b+(g=S>>>24)<=d);){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}l>>>=b,d-=b,i.back+=b}if(l>>>=g,d-=g,i.back+=g,i.length=y,0===v){i.mode=26;break}if(32&v){i.back=-1,i.mode=12;break}if(64&v){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&v,i.mode=22;case 22:if(i.extra){for(C=i.extra;d<C;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;v=(S=i.distcode[l&(1<<i.distbits)-1])>>>16&255,y=65535&S,!((g=S>>>24)<=d);){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(0==(240&v)){for(b=g,k=v,T=y;v=(S=i.distcode[T+((l&(1<<b+k)-1)>>b)])>>>16&255,y=65535&S,!(b+(g=S>>>24)<=d);){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}l>>>=b,d-=b,i.back+=b}if(l>>>=g,d-=g,i.back+=g,64&v){e.msg="invalid distance code",i.mode=30;break}i.offset=y,i.extra=15&v,i.mode=24;case 24:if(i.extra){for(C=i.extra;d<C;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===c)break e;if(p=u-c,i.offset>p){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}p>i.wnext?(p-=i.wnext,f=i.wsize-p):f=i.wnext-p,p>i.length&&(p=i.length),m=i.window}else m=n,f=r-i.offset,p=i.length;p>c&&(p=c),c-=p,i.length-=p;do{n[r++]=m[f++]}while(--p);0===i.length&&(i.mode=21);break;case 26:if(0===c)break e;n[r++]=i.length,c--,i.mode=21;break;case 27:if(i.wrap){for(;d<32;){if(0===s)break e;s--,l|=a[o++]<<d,d+=8}if(u-=c,e.total_out+=u,i.total+=u,u&&(e.adler=i.check=i.flags?L(i.check,n,u,r-u):N(i.check,n,u,r-u)),u=c,(i.flags?l:yt(l))!==i.check){e.msg="incorrect data check",i.mode=30;break}l=0,d=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;d<32;){if(0===s)break e;s--,l+=a[o++]<<d,d+=8}if(l!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}l=0,d=0}i.mode=29;case 29:w=ht;break e;case 30:w=ft;break e;case 31:return mt;case 32:default:return pt}return e.next_out=r,e.avail_out=c,e.next_in=o,e.avail_in=s,i.hold=l,i.bits=d,(i.wsize||u!==e.avail_out&&i.mode<30&&(i.mode<27||t!==st))&&St(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,i.total+=u,i.wrap&&u&&(e.adler=i.check=i.flags?L(i.check,n,u,e.next_out-u):N(i.check,n,u,e.next_out-u)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0===h&&0===u||t===st)&&w===dt&&(w=gt),w},inflateEnd:function(e){if(!e||!e.state)return pt;var t=e.state;return t.window&&(t.window=null),e.state=null,dt},inflateGetHeader:function(e,t){if(!e||!e.state)return pt;var i=e.state;return 0==(2&i.wrap)?pt:(i.head=t,t.done=!1,dt)},inflateSetDictionary:function(e,t){var i,a=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?pt:11===i.mode&&N(1,t,a,0)!==i.check?ft:St(e,t,a,a)?(i.mode=31,mt):(i.havedict=1,dt):pt},inflateInfo:"pako inflate (from Nodeca project)"},At=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Bt=Object.prototype.toString,Mt=O.Z_NO_FLUSH,Dt=O.Z_FINISH,xt=O.Z_OK,Rt=O.Z_STREAM_END,Nt=O.Z_NEED_DICT,Ft=O.Z_STREAM_ERROR,Lt=O.Z_DATA_ERROR,Pt=O.Z_MEM_ERROR;function Ot(e){this.options=Me({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Oe,this.strm.avail_out=0;var i=It.inflateInit2(this.strm,t.windowBits);if(i!==xt)throw new Error(P[i]);if(this.header=new At,It.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Fe(t.dictionary):"[object ArrayBuffer]"===Bt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=It.inflateSetDictionary(this.strm,t.dictionary))!==xt))throw new Error(P[i])}function Ut(e,t){var i=new Ot(t);if(i.push(e),i.err)throw i.msg||P[i.err];return i.result}Ot.prototype.push=function(e,t){var i,a,n,o=this.strm,r=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Dt:Mt,"[object ArrayBuffer]"===Bt.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(r),o.next_out=0,o.avail_out=r),(i=It.inflate(o,a))===Nt&&s&&((i=It.inflateSetDictionary(o,s))===xt?i=It.inflate(o,a):i===Lt&&(i=Nt));o.avail_in>0&&i===Rt&&o.state.wrap>0&&0!==e[o.next_in];)It.inflateReset(o),i=It.inflate(o,a);switch(i){case Ft:case Lt:case Nt:case Pt:return this.onEnd(i),this.ended=!0,!1}if(n=o.avail_out,o.next_out&&(0===o.avail_out||i===Rt))if("string"===this.options.to){var c=Pe(o.output,o.next_out),l=o.next_out-c,d=Le(o.output,c);o.next_out=l,o.avail_out=r-l,l&&o.output.set(o.output.subarray(c,c+l),0),this.onData(d)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(i!==xt||0!==n){if(i===Rt)return i=It.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},Ot.prototype.onData=function(e){this.chunks.push(e)},Ot.prototype.onEnd=function(e){e===xt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=De(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qt=$e,Gt=et,Ht=function(e,t){return(t=t||{}).raw=!0,Je(e,t)},jt=function(e,t){return(t=t||{}).gzip=!0,Je(e,t)},Yt=Ot,Wt=Ut,Vt=function(e,t){return(t=t||{}).raw=!0,Ut(e,t)},Xt=Ut,zt=O,Kt={Deflate:qt,deflate:Gt,deflateRaw:Ht,gzip:jt,Inflate:Yt,inflate:Wt,inflateRaw:Vt,ungzip:Xt,constants:zt};e.Deflate=qt,e.Inflate=Yt,e.constants=zt,e.default=Kt,e.deflate=Gt,e.deflateRaw=Ht,e.gzip=jt,e.inflate=Wt,e.inflateRaw=Vt,e.ungzip=Xt}),cc._RF.pop()},{}],pc:[function(e,t){"use strict";cc._RF.push(t,"6f0ebjwvwpF4r/JTxJzx1TB","pc");var i={init:function(){i.heroList=[],i.heroTable={},i.vehicleList=[],i.vehicleTable={},i.talentTable={}},setOnlineData:function(e){console.log("setOnlineData , pc"),i.chapterIndex=e.chapterIndex||0,i.chapterIndex>CHAPTER_DEFINE_ARRAY.length&&(i.chapterIndex=CHAPTER_DEFINE_ARRAY.length),i.stageIndex=e.stageIndex||0,i.trainCount=e.trainCount||0,i.trainRestartCt=e.trainRestartCt||0,i.trainDailyCt=e.trainDailyCt||0,i.trainTowerIndex=e.trainTowerIndex||0,i.trainSeed=e.trainSeed||0,i.trainRefreshTime=e.trainRefreshTime||0,i.chapterBoxOpen=e.chapterBoxOpen||{},i.difficultyBoxOpen=e.difficultyBoxOpen||{},i.progressionTrack=e.progressionTrack||{},excel.read("hero_list");var t=excel.read("vehicle_list"),a=e.hero;if(a)for(var n in a){var o=a[n];o.id||(o.id=n),i.getHeroData(o.id)&&(i.heroList.push(o),i.heroTable[o.id]=o)}cc.log("pc setOnlineData",e);var r=e.vehicle;if(r)for(var s in r){var c=r[s];c.id||(c.id=s),i.vehicleList.push(c),i.vehicleTable[c.id]=c}cc.log("pc vehicleList",r,JSON.stringify(i.vehicleList)),i.team=e.team;var l=[];for(var d in l)if(!i.isHeroUnlock(l[d])){var h={id:l[d],star:1};i.heroList.unshift(h),i.heroTable[h.id]=h}if(i.firstVehicle=t[0].id,!i.vehicleTable[i.firstVehicle]){var u={id:i.firstVehicle,star:1};cc.log("pc vehicleList 2",JSON.stringify(i.vehicleList)),i.vehicleList.unshift(u),i.vehicleTable[u.id]=u,cc.log("firstVehicle",u,i.firstVehicle)}cc.log("pc vehicleList 3",JSON.stringify(i.vehicleList)),i.vehicleIndex=e.vehicleIndex||0,i.vehicleList[i.vehicleIndex]||(i.vehicleIndex=0),cc.log("pc vehicleIndex",e.vehicleIndex,i.vehicleIndex,i.vehicleList),i.vehicleLink=e.vehicleLink||{0:0,1:0,2:0},i.vehicleLink[0]=1,i.updateMaxLevel();var p=e.talentList;if(p)for(var f in p)p[f]&&(i.talentTable[f]=+p[f]);i.updateTalentGlobal()},setChapterIndex:function(e){e!=i.chapterIndex&&(i.chapterIndex=e,net.updateLazyData({set:{chapterIndex:i.chapterIndex}}))},getChapterStage:function(e){var t=CHAPTER_DEFINE_ARRAY[e];if(t){var a=t.stage.length,n=i.stageIndex-adventure.chapterToStage(e,0);return kit.clamp(n,0,a)}return 1},getChapterIndex:function(){return i.chapterIndex||0},getChapterProgress:function(){var e=CHAPTER_DEFINE_ARRAY;for(var t in e)if(!this.isChapterDone(t))return t},isChapterOpened:function(e){return TEST_ALL_CHAPTER||i.stageIndex>=adventure.chapterToStage(e,0)},isChapterDone:function(e){return TEST_ALL_CHAPTER||e<adventure.stageToChapter(i.stageIndex)},setStageIndex:function(t){cc.log("setStageIndex",t,i.stageIndex),t>i.stageIndex&&(i.stageIndex,i.stageIndex=t,setTimeout(function(){try{var i=0,a=1,n=0;if(window.CHAPTER_DEFINE_ARRAY)for(var o=0;o<window.CHAPTER_DEFINE_ARRAY.length;o++){var r=window.CHAPTER_DEFINE_ARRAY[o],s=r.stage?r.stage.length:10;if(t<=n+s){i=o,a=t-n;break}n+=s}else i=Math.floor((t-1)/10),a=(t-1)%10+1;cc.log("[Leaderboard] PC updating progress - Chapter:",i+1,"Stage:",a,"StageIndex:",t),window.net&&window.net.token&&e("../../ui/leaderBoard/LeaderBoardPopup").updateProgress("mainStory",{chapter:i+1,stage:a},function(e,t){e?(cc.log("[Leaderboard] PC successfully updated! Full response:",t),cc.log("[Leaderboard] Player rank:",t&&t.rank),cc.log("[Leaderboard] Player ID:",t&&t.player_id),cc.log("[Leaderboard] Total players:",t&&t.total_players)):cc.warn("[Leaderboard] PC failed to update:",t)})}catch(c){cc.error("[Leaderboard] Error updating leaderboard from pc.js:",c)}},100))},getTalentLevel:function(e){return i.talentTable[e]||0},setTalentLevel:function(e,t){i.talentTable[e]=t,i.updateTalentGlobal()},updateTalentGlobal:function(){i.talentGlobal={};var e=excel.read("talent_list");for(var t in e){var a=i.talentTable[t],n=e[t];a&&(i.talentGlobal[n.attr]=+n["v"+a]||0)}cc.log("pc.talentGlobal",i.talentGlobal)},setVehicleLinkStatus:function(e,t){i.vehicleLink[e]=t,i.updateMaxLevel()},updateMaxLevel:function(){var e=["star","atk","hp","skill"],t=i.vehicleMaxLevel={};for(var a in e)t[e[a]]=0;var n=excel.read("vehicle_list");for(var o in n){var r=n[o].id;if(i.vehicleLink[o]){var s=i.getVehicle(r);for(var c in e){var l=e[c];t[l]=Math.max(s[l]||0,t[l])}}}},getMaxLevel:function(e){return i.vehicleMaxLevel[e]},isVehicleLinked:function(){return!1},getVehicleList:function(){return i.vehicleList},getChooseVehicle:function(){return i.getVehicleList()[i.vehicleIndex]},setChooseVehicleIndex:function(e){i.getVehicleList()[e]&&(i.vehicleIndex=e,cc.log("setChooseVehicleIndex",e),net.updateData({set:{vehicleIndex:e}}))},setChooseVehicle:function(e){var t=e;kit.isObject(e)&&(t=e.id),cc.log("setChooseVehicle",t);var a=i.getVehicleList();for(var n in cc.warn("setChooseVehicle list",a),a)if(cc.log("setChooseVehicle list i",n,a[n].id,t),a[n].id==t)return void i.setChooseVehicleIndex(n)},getVehicle:function(e){return i.vehicleTable[e]},getVehiclesAttrGlobal:function(){var e=i.getVehicleAttrGlobal("v1"),t=i.getVehicleAttrGlobal("v3"),a={hp0:0,atk:0};return a.hp0=e.hp0+t.hp0,a.atk=e.atk+t.atk,cc.log("getVehiclesAttrGlobal",e,t,a),a},getVehicleAttrGlobal:function(e){var t=i.getVehicle(e),a=i.getVehicleData(e),n=a.attrGlobal,o=t&&t.atk||0,r={hp0:0,atk:0};if(!t)return r;for(var s in n)n[s].lvl<=o&&(r.hp0+=n[s].hp||0,r.atk+=n[s].atk||0);for(var c=t&&t.star||0,l=0;l<c;l++){var d=a.starAttrs[l];a.starGlobal[l]&&("vehicle_atk"==d.id&&(r.atk+=d.num),"vehicle_hp"==d.id&&(r.hp0+=d.num))}return r},getVehicleAttr:function(e){var t=i.getVehicle(e),a=i.getVehicleData(e),n={hp0:"atk",atk:"atk",hp:"hp_vehicle"},o=excel.read("vehicle_"+a.attr),r={};for(var s in n){var c=n[s],l=t&&t.atk||0;cc.log("getVehicleAttr lvl",l),i.isVehicleLinked(e)&&(l=i.getMaxLevel("atk")),r[s]=o[l][c]}cc.log("getVehicleAttr local attr",JSON.stringify(r));for(var d=t&&t.star||0,h=0;h<d;h++){var u=a.starAttrs[h];a.starGlobal[h]||("vehicle_atk"==u.id&&(r.atk+=u.num),"vehicle_hp"==u.id&&(r.hp0+=u.num))}cc.log("getVehicleAttr local starAttrs",JSON.stringify(r));var p=i.getVehiclesAttrGlobal();for(var f in p)r[f]+=p[f];return cc.log("getVehicleAttr global attr",JSON.stringify(r)),r},getVehicleData:function(e){return ENTITY[e]},isVehicleUnlock:function(e){var t=i.vehicleTable[e];return t&&t.star},addVehicle:function(e){cc.log("addVehicle",JSON.stringify(i.vehicleList),e),"object"!=typeof e&&(e={id:e,star:1});var t=e.id;return e.part=e.part||0,i.vehicleList.push(e),i.vehicleTable[t]=e,cc.log("addVehicle vehicleList",JSON.stringify(i.vehicleList),e),i.updateMaxLevel(),i.updateGlobal(),e},setVehicle:function(e){var t=e.id,a=i.getVehicle(t);for(var n in a||(a=i.addVehicle(e)),e)"id"!=n&&(a[n]=e[n]);i.updateMaxLevel(),i.updateGlobal()},setChapterBoxOpen:function(e,t){i.chapterBoxOpen[e]=i.chapterBoxOpen[e]||{},i.chapterBoxOpen[e][t]=1},getChapterBoxOpen:function(e,t){return i.chapterBoxOpen[e]&&i.chapterBoxOpen[e][t]},setDifficultyBoxOpen:function(e){i.difficultyBoxOpen[e]=1},getDifficultyBoxOpen:function(e){return i.difficultyBoxOpen[e]&&i.difficultyBoxOpen[e]},isHeroUnlock:function(e){var t=i.getHeroTable()[e];return t&&t.star},addHero:function(e){kit.isObject(e)||(e={id:e,lvl:1,star:1,part:0});var t=e.id;return e.part=e.part||0,i.heroList.push(e),i.heroTable[t]=e,i.updateGlobal(),e},setHero:function(e){var t=e.id,a=i.getHero(t);for(var n in a||(a=i.addHero(e)),e)"id"!=n&&(a[n]=e[n])},getHeroTable:function(){return i.heroTable},getHeroList:function(){return i.heroList},getHeroCt:function(){return i.getHeroList().length},getHero:function(e){return i.heroTable[e]},getHeroData:function(e){return ENTITY[e]},getHeroStatScale:function(e){var t=i.getHero(e);if(t.stat){var a={};for(var n in t.stat)a[t.stat[n]]=a[t.stat[n]]||0,a[t.stat[n]]+=1;for(var n in a)a[n]=Math.pow(2,a[n]-1);return a}},getHeroStatNum:function(e){var t=i.getHero(e);if(t.stat){var a={},n={};for(var o in t.stat){a[t.stat[o]]=a[t.stat[o]]||0,a[t.stat[o]]+=1;var r=HeroStatDefine[t.stat[o]].rarity;for(var s in cc.log("getHeroStatNum",t.stat[o],ENTITY[e].stat),ENTITY[e].stat)if(t.stat[o].indexOf(ENTITY[e].stat[s])>=0){n[t.stat[o]]=ENTITY[e]["stat"+(+s+1)][r];break}}for(var o in a)a[o]=Math.pow(2,a[o]-1),a[o]*=n[o];return a}},getHeroAttr:function(e,t){var i=e.attr,a=excel.read("player_"+i);return a[(t=kit.clamp(t,1,a.length))-1]},getHeroUpgradePrice:function(e){var t=i.getChooseVehicle().id,a=i.getVehicleData(t).starPrice[e]||0;return cc.log("getHeroUpgradePrice",a),a},getTeam:function(){var e=i.team,t=[],a=excel.read("hero_list");for(var n in e){var o=a[e[n]];if(o){var r=o.id;i.isHeroUnlock(r)&&!t.includes(r)&&t.push(r)}}return cc.log("getTeam",t,e),t},setTeam:function(e){var t={0:-1,1:-1,2:-1,3:-1},a=excel.read("hero_list");for(var n in e){var o=e[n];for(var r in a)if(o===a[r].id){t[n]=r;break}}i.team=t,cc.log("setTeam",e,t),net.updateData({set:{team:t}})},getEnemyAttr:function(e){var t=excel.read("mob_a");return t[(e=kit.clamp(e,1,t.length))-1]},getChooseHero:function(){return i.getHeroList()[i.heroIndex]},getMaxHeroLevel:function(){var e=i.getHeroList(),t=0;for(var a in e){var n=e[a];t=Math.max(t,n.lvl)}return t},updateGlobal:function(){},checkNotice:function(){return!0},getDifficultyAffix:function(){var e=i.getChapterIndex(),t=e>6&&Math.floor((e-6)/6)+2||1,a=DifficultyDefine[t]&&DifficultyDefine[t].affix;if(a)return cc.log("pc getDifficultyAffix",a,e),a},getProgressisonTrack:function(){var e;return console.log("getProgressisonTrack"),console.log(i.progressionTrack),0===Object.keys(i.progressionTrack).length?(net.updateData({set:(e={},e["progressionTrack.0"]=0,e)},function(e,t){console.log("[adventure]","getProgressisonTrack",e,t)}),i.progressionTrack={0:0}):i.progressionTrack},setProgressisonTrack:function(e,t){var a,n;console.log("setProgressisonTrack",e,t,((a={})["progressionTrack."+e]=t,a)),i.progressionTrack[e]=t,net.updateData({add:(n={},n["progressionTrack."+e]=t,n)},function(e,t){console.log("[adventure]","setChapterProgressisonTrack",e,t)})},getInforProgressisonTrack:function(){var e,t;console.log("--\x3e>getInforProgressisonTrack");for(var i=0,a=money.getNum(EXP_PROGRESSION_TRACK),n=0;n<configRewardProgressionTrack.length&&a>=configRewardProgressionTrack[n].expRequired;n++)i=configRewardProgressionTrack[n].levelProgressionTrack;var o=null==(e=configRewardProgressionTrack[i])?void 0:e.expRequired,r=(null==(t=configRewardProgressionTrack[i-1])?void 0:t.expRequired)||0,s=(a-r)/(o-r),c=Math.max(0,Math.min(1,s));user.levelProgression=i,cc.game.emit("UpdateExpProgression",{currentExp:a,currentLevel:i,currentProcess:c})},updateRedPointSign:function(){var e;if(!this.isChapterDone(1))return!1;var t=user.signCount,i=user.signIndex,a=i-1,n=(null==(e=user.stateRewardSign)?void 0:e[a])||{};console.log("updateRedPointSign",t,i,n);var o=1==n.normalReward,r=1==n.enhancedReward;return console.log("updateRedPointSign",o,r),!(o&&r&&t<i)},updateRedPointProgress:function(){if(this.isChapterDone(1)){var e=Object.keys(pc.progressionTrack).length;return console.log("updateRedPoint updateRedPointProgress",e,user.levelProgression),e<user.levelProgression}}};window.pc=i,cc._RF.pop()},{"../../ui/leaderBoard/LeaderBoardPopup":"LeaderBoardPopup"}],pomelo:[function(e,t){"use strict";cc._RF.push(t,"a0892fBTfBFm7QQkNAD0ITx","pomelo"),window.pomelo=function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t;return t=e&&e.__esModule?function(){return e.default}:function(){return e},i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){(function(e){var a=i(6),n=i(7),o=i(8);function r(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,i){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return l(this,e,t,i)}function l(e,t,i,a){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?m(e,t,i,a):"string"==typeof t?p(e,t,i):g(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t,i,a){return d(t),t<=0?s(e,t):void 0!==i?"string"==typeof a?s(e,t).fill(i,a):s(e,t).fill(i):s(e,t)}function u(e,t){if(d(t),e=s(e,t<0?0:0|v(t)),!c.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function p(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!c.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var a=0|y(t,i),n=(e=s(e,a)).write(t,i);return n!==a&&(e=e.slice(0,n)),e}function f(e,t){var i;e=s(e,i=t.length<0?0:0|v(t.length));for(var a=0;a<i;a+=1)e[a]=255&t[a];return e}function m(e,t,i,a){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(a||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===a?new Uint8Array(t):void 0===a?new Uint8Array(t,i):new Uint8Array(t,i,a),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t),e}function g(e,t){if(c.isBuffer(t)){var i=0|v(t.length);return 0===(e=s(e,i)).length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(a=t.length)!=a?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var a;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function y(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return X(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return J(e).length;default:if(a)return X(e).length;t=(""+t).toLowerCase(),a=!0}}function b(e,t,i){var a=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,i);case"utf8":case"utf-8":return M(this,t,i);case"ascii":return R(this,t,i);case"latin1":case"binary":return N(this,t,i);case"base64":return B(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,i);default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function k(e,t,i){var a=e[t];e[t]=e[i],e[i]=a}function T(e,t,i,a,n){if(0===e.length)return-1;if("string"==typeof i?(a=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=c.from(t,a)),c.isBuffer(t))return 0===t.length?-1:_(e,t,i,a,n);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):_(e,[t],i,a,n);throw new TypeError("val must be string, number or Buffer")}function _(e,t,i,a,n){var o,r=1,s=e.length,c=t.length;if(void 0!==a&&("ucs2"===(a=String(a).toLowerCase())||"ucs-2"===a||"utf16le"===a||"utf-16le"===a)){if(e.length<2||t.length<2)return-1;r=2,s/=2,c/=2,i/=2}function l(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(n){var d=-1;for(o=i;o<s;o++)if(l(e,o)===l(t,-1===d?0:o-d)){if(-1===d&&(d=o),o-d+1===c)return d*r}else-1!==d&&(o-=o-d),d=-1}else for(i+c>s&&(i=s-c),o=i;o>=0;o--){for(var h=!0,u=0;u<c;u++)if(l(e,o+u)!==l(t,u)){h=!1;break}if(h)return o}return-1}function w(e,t,i,a){i=Number(i)||0;var n=e.length-i;a?(a=Number(a))>n&&(a=n):a=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");a>o/2&&(a=o/2);for(var r=0;r<a;++r){var s=parseInt(t.substr(2*r,2),16);if(isNaN(s))return r;e[i+r]=s}return r}function E(e,t,i,a){return Z(X(t,e.length-i),e,i,a)}function C(e,t,i,a){return Z(z(t),e,i,a)}function S(e,t,i,a){return C(e,t,i,a)}function I(e,t,i,a){return Z(J(t),e,i,a)}function A(e,t,i,a){return Z(K(t,e.length-i),e,i,a)}function B(e,t,i){return 0===t&&i===e.length?a.fromByteArray(e):a.fromByteArray(e.slice(t,i))}function M(e,t,i){i=Math.min(e.length,i);for(var a=[],n=t;n<i;){var o,r,s,c,l,d=e[n],h=null;if(n+(l=d>239?4:d>223?3:d>191?2:1)<=i)switch(l){case 1:d<128&&(h=d);break;case 2:128==(192&(o=e[n+1]))&&(c=(31&d)<<6|63&o)>127&&(h=c);break;case 3:o=e[n+1],r=e[n+2],128==(192&o)&&128==(192&r)&&(c=(15&d)<<12|(63&o)<<6|63&r)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=e[n+1],r=e[n+2],s=e[n+3],128==(192&o)&&128==(192&r)&&128==(192&s)&&(c=(15&d)<<18|(63&o)<<12|(63&r)<<6|63&s)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,a.push(h>>>10&1023|55296),h=56320|1023&h),a.push(h),n+=l}return x(a)}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,void 0!==e.TYPED_ARRAY_SUPPORT?c.TYPED_ARRAY_SUPPORT=e.TYPED_ARRAY_SUPPORT:c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=r(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,i){return l(null,e,t,i)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,i){return h(null,e,t,i)},c.allocUnsafe=function(e){return u(null,e)},c.allocUnsafeSlow=function(e){return u(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,a=t.length,n=0,o=Math.min(i,a);n<o;++n)if(e[n]!==t[n]){i=e[n],a=t[n];break}return i<a?-1:a<i?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var a=c.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var r=e[i];if(!c.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(a,n),n+=r.length}return a},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)k(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)k(this,t,t+3),k(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)k(this,t,t+7),k(this,t+1,t+6),k(this,t+2,t+5),k(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):b.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,i,a,n){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===a&&(a=0),void 0===n&&(n=this.length),t<0||i>e.length||a<0||n>this.length)throw new RangeError("out of range index");if(a>=n&&t>=i)return 0;if(a>=n)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(a>>>=0),r=(i>>>=0)-(t>>>=0),s=Math.min(o,r),l=this.slice(a,n),d=e.slice(t,i),h=0;h<s;++h)if(l[h]!==d[h]){o=l[h],r=d[h];break}return o<r?-1:r<o?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return T(this,e,t,i,!0)},c.prototype.lastIndexOf=function(e,t,i){return T(this,e,t,i,!1)},c.prototype.write=function(e,t,i,a){if(void 0===t)a="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)a=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===a&&(a="utf8")):(a=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");a||(a="utf8");for(var o=!1;;)switch(a){case"hex":return w(this,e,t,i);case"utf8":case"utf-8":return E(this,e,t,i);case"ascii":return C(this,e,t,i);case"latin1":case"binary":return S(this,e,t,i);case"base64":return I(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+a);a=(""+a).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var D=4096;function x(e){var t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);for(var i="",a=0;a<t;)i+=String.fromCharCode.apply(String,e.slice(a,a+=D));return i}function R(e,t,i){var a="";i=Math.min(e.length,i);for(var n=t;n<i;++n)a+=String.fromCharCode(127&e[n]);return a}function N(e,t,i){var a="";i=Math.min(e.length,i);for(var n=t;n<i;++n)a+=String.fromCharCode(e[n]);return a}function F(e,t,i){var a,n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var o="",r=t;r<i;++r)(a=e[r])<16?o+="0"+a.toString(16):o+=a.toString(16);return o}function L(e,t,i){for(var a=e.slice(t,i),n="",o=0;o<a.length;o+=2)n+=String.fromCharCode(a[o]+256*a[o+1]);return n}function P(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,i,a,n,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<o)throw new RangeError('"value" argument is out of bounds');if(i+a>e.length)throw new RangeError("Index out of range")}function U(e,t,i,a){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-i,2);n<o;++n)e[i+n]=(t&255<<8*(a?n:1-n))>>>8*(a?n:1-n)}function q(e,t,i,a){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-i,4);n<o;++n)e[i+n]=t>>>8*(a?n:3-n)&255}function G(e,t,i,a){if(i+a>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function H(e,t,i,a,o){return o||G(e,0,i,4),n.write(e,t,i,a,23,4),i+4}function j(e,t,i,a,o){return o||G(e,0,i,8),n.write(e,t,i,a,52,8),i+8}c.prototype.slice=function(e,t){var i,a=this.length;if((e=~~e)<0?(e+=a)<0&&(e=0):e>a&&(e=a),(t=void 0===t?a:~~t)<0?(t+=a)<0&&(t=0):t>a&&(t=a),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=c.prototype;else{var n=t-e;i=new c(n,void 0);for(var o=0;o<n;++o)i[o]=this[o+e]}return i},c.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var a=this[e],n=1,o=0;++o<t&&(n*=256);)a+=this[e+o]*n;return a},c.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var a=this[e+--t],n=1;t>0&&(n*=256);)a+=this[e+--t]*n;return a},c.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var a=this[e],n=1,o=0;++o<t&&(n*=256);)a+=this[e+o]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||P(e,t,this.length);for(var a=t,n=1,o=this[e+--a];a>0&&(n*=256);)o+=this[e+--a]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),n.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),n.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),n.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),n.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,i,a){e=+e,t|=0,i|=0,a||O(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},c.prototype.writeUIntBE=function(e,t,i,a){e=+e,t|=0,i|=0,a||O(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+i},c.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):q(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):q(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,i,a){if(e=+e,t|=0,!a){var n=Math.pow(2,8*i-1);O(this,e,t,i,n-1,-n)}var o=0,r=1,s=0;for(this[t]=255&e;++o<i&&(r*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/r>>0)-s&255;return t+i},c.prototype.writeIntBE=function(e,t,i,a){if(e=+e,t|=0,!a){var n=Math.pow(2,8*i-1);O(this,e,t,i,n-1,-n)}var o=i-1,r=1,s=0;for(this[t+o]=255&e;--o>=0&&(r*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/r>>0)-s&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):q(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):q(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,i){return H(this,e,t,!0,i)},c.prototype.writeFloatBE=function(e,t,i){return H(this,e,t,!1,i)},c.prototype.writeDoubleLE=function(e,t,i){return j(this,e,t,!0,i)},c.prototype.writeDoubleBE=function(e,t,i){return j(this,e,t,!1,i)},c.prototype.copy=function(e,t,i,a){if(i||(i=0),a||0===a||(a=this.length),t>=e.length&&(t=e.length),t||(t=0),a>0&&a<i&&(a=i),a===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(a<0)throw new RangeError("sourceEnd out of bounds");var n;a>this.length&&(a=this.length),e.length-t<a-i&&(a=e.length-t+i);var o=a-i;if(this===e&&i<t&&t<a)for(n=o-1;n>=0;--n)e[n+t]=this[n+i];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+o),t);return o},c.prototype.fill=function(e,t,i,a){if("string"==typeof e){if("string"==typeof t?(a=t,t=0,i=this.length):"string"==typeof i&&(a=i,i=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==a&&"string"!=typeof a)throw new TypeError("encoding must be a string");if("string"==typeof a&&!c.isEncoding(a))throw new TypeError("Unknown encoding: "+a)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,void 0===i?i=this.length:i>>>=0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var r,s=(r=c.isBuffer(e)?e:X(new c(e,a).toString())).length;for(o=0;o<i-t;++o)this[o+t]=r[o%s]}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function W(e){if((e=V(e).replace(Y,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function V(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function X(e,t){var i;t=t||1/0;for(var a=e.length,n=null,o=[],r=0;r<a;++r){if((i=e.charCodeAt(r))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(r+1===a){(t-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function z(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}function K(e,t){for(var i,a,n,o=[],r=0;r<e.length&&!((t-=2)<0);++r)a=(i=e.charCodeAt(r))>>8,n=i%256,o.push(n),o.push(a);return o}function J(e){return a.toByteArray(W(e))}function Z(e,t,i,a){for(var n=0;n<a&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}}).call(this,i(5))},function(e){var t=e.exports;t.encodeUInt32=function(e){var t=parseInt(e);if(isNaN(t)||t<0)return console.log(t),null;var i=[];do{var a=t%128,n=Math.floor(t/128);0!==n&&(a+=128),i.push(a),t=n}while(0!==t);return i},t.encodeSInt32=function(e){var i=parseInt(e);return isNaN(i)?null:(i=i<0?2*Math.abs(i)-1:2*i,t.encodeUInt32(i))},t.decodeUInt32=function(e){for(var t=0,i=0;i<e.length;i++){var a=parseInt(e[i]);if(t+=(127&a)*Math.pow(2,7*i),a<128)return t}return t},t.decodeSInt32=function(e){var t=this.decodeUInt32(e);return(t%2+t)/2*(t%2==1?-1:1)}},function(e){var t=e.exports;t.isSimpleType=function(e){return"uInt32"===e||"sInt32"===e||"int32"===e||"uInt64"===e||"sInt64"===e||"float"===e||"double"===e},t.equal=function(e,i){for(var a in e){var n=e[a],o=i[a];if("object"==typeof n){if(!t.equal(n,o))return!1}else if(n!==o)return!1}return!0}},function(e,t,i){var a=i(4),n=i(9),o=window.decodeIO_protobuf,r=null,s=null,c=a.Package,l=a.Message,d=i(13).EventEmitter,h=window.rsa,u=cc.sys.localStorage;"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t});var p,f=window,m=Object.create(d.prototype);f.pomelo=m;var g=null,v=0,y={},b={},k={},T={},_={},w={},E={},C=0,S=0,I=0,A=0,B=null,M=null,D=null,x=null,R=null,N=!1,F=null,L=null,P=0,O=5e3,U={sys:{type:"js-websocket",version:"0.0.1",rsa:{}},user:{}},q=null,G=!1;m.init=function(e,t){q=t;var i=e.host,a=e.port;if(R=e.encode||j,x=e.decode||H,G=e.nolog,i.indexOf("ws://")>=0||i.indexOf("wss://")>=0)var n=i;else n="ws://"+i;if(a&&(n+=":"+a),U.user=e.user,e.encrypt){p=!0,h.generate(1024,"10001");var o={rsa_n:h.n.toString(16),rsa_e:h.e};U.sys.rsa=o}D=e.handshakeCallback,Y(e,n,t)};var H=m.decode=function(e){var t=l.decode(e);if(!(t.id>0)||(t.route=k[t.id],delete k[t.id],t.route))return t.body=Z(t),t},j=m.encode=function(e,t,i){var o;o=e?l.TYPE_REQUEST:l.TYPE_NOTIFY,i=n&&E[t]?n.encode(t,i):r&&r.lookup(t)?new(r.build(t))(i).encodeNB():a.strencode(JSON.stringify(i));var s=0;return T&&T[t]&&(t=T[t],s=1),l.encode(e,o,s,t,i)},Y=function e(t,i,l){G||console.log("connect to "+i);var d=(t=t||{}).maxReconnectAttempts||10;if(L=i,u&&u.getItem("protos")&&0===C){var h=JSON.parse(u.getItem("protos"));C=h.version||0,w=h.server||{},E=h.client||{},n&&n.init({encoderProtos:E,decoderProtos:w}),o&&(r=o.loadJson(E),s=o.loadJson(w))}U.sys.protoVersion=C,(g=new WebSocket(i,[],cc.sys.isNative&&"src/sdk/cacert.pem")).binaryType="arraybuffer",g.onopen=function(){N&&m.emit("reconnect"),W();var e=c.encode(c.TYPE_HANDSHAKE,a.strencode(JSON.stringify(U)));X(e)},g.onmessage=function(e){K(c.decode(e.data),l),I&&(A=Date.now()+I)},g.onerror=function(e){m.emit("io-error",e),G||console.error("socket error: "+JSON.stringify(e))},g.onclose=function(i){if(m.emit("close",i),m.emit("disconnect",i),G||console.error("socket close: "+JSON.stringify(i)),g&&(g=null),B&&(clearTimeout(B),B=null),M&&(clearTimeout(M),M=null),t.reconnect&&P<d)N=!0,P++,F=setTimeout(function(){e(t,L,l)},O),O*=2;else for(var a in y)y[a]()}};m.disconnect=function(){g&&(g.disconnect&&g.disconnect(),g.close&&g.close(),G||console.log("disconnect"),g=null),B&&(clearTimeout(B),B=null),M&&(clearTimeout(M),M=null)};var W=function(){N=!1,O=5e3,P=0,clearTimeout(F)};m.request=function(e,t,i){2===arguments.length&&"function"==typeof t?(i=t,t={}):t=t||{},(e=e||t.route)&&(V(++v,e,t),y[v]=i,k[v]=e)},m.notify=function(e,t){V(0,e,t=t||{})};var V=function(e,t,i){if(p){i=JSON.stringify(i);var a=h.signString(i,"sha256");(i=JSON.parse(i)).__crypto__=a}R&&(i=R(e,t,i));var n=c.encode(c.TYPE_DATA,i);X(n)},X=function(e){g&&g.send(e.buffer)},z=function e(){var t=A-Date.now();t>100?M=setTimeout(e,t):(G||console.error("server heartbeat timeout"),m.emit("heartbeat timeout"),m.disconnect())};b[c.TYPE_HANDSHAKE]=function(e){if(501!==(e=JSON.parse(a.strdecode(e))).code)if(200===e.code){Q(e);var t=c.encode(c.TYPE_HANDSHAKE_ACK);X(t),q&&q(g)}else m.emit("error","handshake fail");else m.emit("error","client version not fullfill")},b[c.TYPE_HEARTBEAT]=function(){if(S){var e=c.encode(c.TYPE_HEARTBEAT);M&&(clearTimeout(M),M=null),B||(B=setTimeout(function(){B=null,X(e),A=Date.now()+I,M=setTimeout(z,I)},S))}},b[c.TYPE_DATA]=function(e){var t=e;x&&(t=x(t)),J(m,t)},b[c.TYPE_KICK]=function(e){e=JSON.parse(a.strdecode(e)),m.emit("onKick",e)};var K=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var i=e[t];b[i.type](i.body)}else b[e.type](e.body)},J=function(e,t){if(t.id){var i=y[t.id];delete y[t.id],"function"==typeof i&&i(t.body)}else e.emit(t.route,t.body)},Z=function(e){var t=e.route;if(e.compressRoute){if(!_[t])return{};t=e.route=_[t]}return n&&w[t]?n.decodeStr(t,e.body):s&&s.lookup(t)?s.build(t).decode(e.body):JSON.parse(a.strdecode(e.body))},Q=function(e){e.sys&&e.sys.heartbeat?(S=1e3*e.sys.heartbeat,I=2*S):(S=0,I=0),$(e),"function"==typeof D&&D(e.user)},$=function(e){if(e&&e.sys){T=e.sys.dict;var t=e.sys.protos;if(T)for(var i in _={},T=T)_[T[i]]=i;t&&(C=t.version||0,w=t.server||{},E=t.client||{},u.setItem("protos",JSON.stringify(t)),n&&n.init({encoderProtos:t.client,decoderProtos:t.server}),o&&(r=o.loadJson(E),s=o.loadJson(w)))}};e.exports=m},function(e,t,i){var a,n=i(0).Buffer;a="undefined"==typeof window?n:Uint8Array;var o=e.exports,r=o.Package={},s=o.Message={};r.TYPE_HANDSHAKE=1,r.TYPE_HANDSHAKE_ACK=2,r.TYPE_HEARTBEAT=3,r.TYPE_DATA=4,r.TYPE_KICK=5,s.TYPE_REQUEST=0,s.TYPE_NOTIFY=1,s.TYPE_RESPONSE=2,s.TYPE_PUSH=3,o.strencode=function(e){if(void 0!==n&&a===n)return new n(e);for(var t=[],i=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);r<128?t[i++]=r:r<2048?(t[i++]=r>>6|192,t[i++]=63&r|128):55296==(64512&r)&&o+1<e.length&&56320==(64512&e.charCodeAt(o+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++o)),t[i++]=r>>18|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=63&r|128):(t[i++]=r>>12|224,t[i++]=r>>6&63|128,t[i++]=63&r|128)}return t},o.strdecode=function(e){if(void 0!==n&&a===n)return e.toString();for(var t=e,i=[],o=0,r=0;o<t.length;){var s=t[o++];if(s<128)i[r++]=String.fromCharCode(s);else if(s>191&&s<224){var c=t[o++];i[r++]=String.fromCharCode((31&s)<<6|63&c)}else if(s>239&&s<365){var l=((7&s)<<18|(63&(c=t[o++]))<<12|(63&(d=t[o++]))<<6|63&t[o++])-65536;i[r++]=String.fromCharCode(55296+(l>>10)),i[r++]=String.fromCharCode(56320+(1023&l))}else{c=t[o++];var d=t[o++];i[r++]=String.fromCharCode((15&s)<<12|(63&c)<<6|63&d)}}return i.join("")},r.encode=function(e,t){var i;i=t?t.length:0;var n=new a(4+i),o=0;return n[o++]=255&e,n[o++]=i>>16&255,n[o++]=i>>8&255,n[o++]=255&i,t&&c(n,4,t,0,i),n},r.decode=function(e){for(var t=0,i=new a(e),n=0,o=[];t<i.length;){var r,s=i[t++];(r=(n=(i[t++]<<16|i[t++]<<8|i[t++])>>>0)?new a(n):null)&&c(r,0,i,t,n),t+=n,o.push({type:s,body:r})}return 1===o.length?o[0]:o},s.encode=function(e,t,i,n,r){var s=1+(l(t)?h(e):0);if(d(t))if(i){if("number"!=typeof n)throw new Error("error flag for number route!");s+=2}else if(s+=1,n){if((n=o.strencode(n)).length>255)throw new Error("route maxlength is overflow");s+=n.length}r&&(s+=r.length);var c=new a(s),g=0;return g=u(t,i,c,g),l(t)&&(g=p(e,c,g)),d(t)&&(g=f(i,n,c,g)),r&&(g=m(r,c,g)),c},s.decode=function(e){var t=new a(e),i=t.length||t.byteLength,n=0,r=0,s=null,h=t[n++],u=1&h,p=h>>1&7;if(l(p)){var f=0,m=0;do{r+=(127&(f=parseInt(t[n])))<<7*m,n++,m++}while(f>=128)}if(d(p))if(u)s=t[n++]<<8|t[n++];else{var g=t[n++];g?(s=new a(g),c(s,0,t,n,g),s=o.strdecode(s)):s="",n+=g}var v=i-n,y=new a(v);return c(y,0,t,n,v),{id:r,type:p,compressRoute:u,route:s,body:y}};var c=function(e,t,i,a,n){if("function"==typeof i.copy)i.copy(e,t,a,a+n);else for(var o=0;o<n;o++)e[t++]=i[a++]},l=function(e){return e===s.TYPE_REQUEST||e===s.TYPE_RESPONSE},d=function(e){return e===s.TYPE_REQUEST||e===s.TYPE_NOTIFY||e===s.TYPE_PUSH},h=function(e){var t=0;do{t+=1,e>>=7}while(e>0);return t},u=function(e,t,i,a){if(e!==s.TYPE_REQUEST&&e!==s.TYPE_NOTIFY&&e!==s.TYPE_RESPONSE&&e!==s.TYPE_PUSH)throw new Error("unkonw message type: "+e);return i[a]=e<<1|(t?1:0),a+1},p=function(e,t,i){do{var a=e%128,n=Math.floor(e/128);0!==n&&(a+=128),t[i++]=a,e=n}while(0!==e);return i},f=function(e,t,i,a){if(e){if(t>65535)throw new Error("route number is overflow");i[a++]=t>>8&255,i[a++]=255&t}else t?(i[a++]=255&t.length,c(i,a,t,0,t.length),a+=t.length):i[a++]=0;return a},m=function(e,t,i){return c(t,i,e,0,e.length),i+e.length}},function(e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(i){"object"==typeof window&&(t=window)}e.exports=t},function(e,t){t.byteLength=function(e){var t=c(e),i=t[0],a=t[1];return 3*(i+a)/4-a},t.toByteArray=function(e){var t,a,o=c(e),r=o[0],s=o[1],d=new i(l(0,r,s)),h=0;a=s>0?r-4:r;for(var u=0;u<a;u+=4)t=n[e.charCodeAt(u)]<<18|n[e.charCodeAt(u+1)]<<12|n[e.charCodeAt(u+2)]<<6|n[e.charCodeAt(u+3)],d[h++]=t>>16&255,d[h++]=t>>8&255,d[h++]=255&t;return 2===s&&(t=n[e.charCodeAt(u)]<<2|n[e.charCodeAt(u+1)]>>4,d[h++]=255&t),1===s&&(t=n[e.charCodeAt(u)]<<10|n[e.charCodeAt(u+1)]<<4|n[e.charCodeAt(u+2)]>>2,d[h++]=t>>8&255,d[h++]=255&t),d},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,o=[],r=0,s=i-n;r<s;r+=16383)o.push(d(e,r,r+16383>s?s:r+16383));return 1===n?(t=e[i-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===n&&(t=(e[i-2]<<8)+e[i-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"=")),o.join("")};var i,a=[],n=[];i="undefined"!=typeof Uint8Array?Uint8Array:Array;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,s=o.length;r<s;++r)a[r]=o[r],n[o.charCodeAt(r)]=r;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function l(e,t,i){return 3*(t+i)/4-i}function d(e,t,i){for(var n,o,r=[],s=t;s<i;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),r.push(a[(o=n)>>18&63]+a[o>>12&63]+a[o>>6&63]+a[63&o]);return r.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,a,n){var o,r,s,c,l=8*n-a-1,d=(1<<l)-1,h=d>>1,u=-7;c=i?-1:1;var p=e[t+(s=i?n-1:0)];for(s+=c,o=p&(1<<-u)-1,p>>=-u,u+=l;u>0;o=256*o+e[t+s],s+=c,u-=8);for(r=o&(1<<-u)-1,o>>=-u,u+=a;u>0;r=256*r+e[t+s],s+=c,u-=8);if(0===o)o=1-h;else{if(o===d)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,a),o-=h}return(p?-1:1)*r*Math.pow(2,o-a)},t.write=function(e,t,i,a,n,o){var r,s,c,l,d,h,u,p=8*o-n-1,f=(1<<p)-1,m=f>>1;for(l=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=a?0:o-1,h=a?1:-1,u=t<0||0===t&&1/t<0?1:0,t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,r=f):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),(t+=r+m>=1?l/c:l*Math.pow(2,1-m))*c>=2&&(r++,c/=2),r+m>=f?(s=0,r=f):r+m>=1?(s=(t*c-1)*Math.pow(2,n),r+=m):(s=t*Math.pow(2,m-1)*Math.pow(2,n),r=0));n>=8;e[i+d]=255&s,d+=h,s/=256,n-=8);for(r=r<<n|s,p+=n;p>0;e[i+d]=255&r,d+=h,r/=256,p-=8);e[i+d-h]|=128*u}},function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},function(e,t,i){var a=i(0).Buffer,n=i(10),o=i(11),r=i(12),s=e.exports;s.encode=function(e,t){return n.encode(e,t)},s.encode2Bytes=function(e,t){var i=this.encode(e,t);if(!i||!i.length)return console.warn("encode msg failed! key : %j, msg : %j",e,t),null;for(var a=new Uint8Array(i.length),n=0;n<i.length;n++)a[n]=i.readUInt8(n);return a},s.encodeStr=function(e,t,i){i=i||"base64";var a=s.encode(e,t);return a?a.toString(i):a},s.decode=function(e,t){return o.decode(e,t)},s.decodeStr=function(e,t,i){var n=new a(t,i=i||"base64");return n?s.decode(e,n):n},s.parse=function(e){return r.parse(e)},s.setEncoderProtos=function(e){n.init(e)},s.setDecoderProtos=function(e){o.init(e)},s.init=function(e){n.init(e.encoderProtos),o.init(e.decoderProtos)}},function(e,t,i){(function(t){var a=i(1),n={TYPES:{uInt32:0,sInt32:0,int32:0,double:1,string:2,message:2,float:5}},o=i(2),r=e.exports;function s(e,t){if(!t||!e)return console.warn("no protos or msg exist! msg : %j, protos : %j",e,t),!1;for(var i in t){var a=t[i];switch(a.option){case"required":if(void 0===e[i])return console.warn("no property exist for required! name: %j, proto: %j, msg: %j",i,a,e),!1;case"optional":if(void 0!==e[i]&&(n=t.__messages[a.type]||r.protos["message "+a.type])&&!s(e[i],n))return console.warn("inner proto error! name: %j, proto: %j, msg: %j",i,a,e),!1;break;case"repeated":var n=t.__messages[a.type]||r.protos["message "+a.type];if(e[i]&&n)for(var o=0;o<e[i].length;o++)if(!s(e[i][o],n))return!1}}return!0}function c(e,t,i,a){for(var n in a)if(i[n]){var o=i[n];switch(o.option){case"required":case"optional":t=h(e,t,u(o.type,o.tag)),t=l(a[n],o.type,t,e,i);break;case"repeated":a[n]&&a[n].length>0&&(t=d(a[n],o,t,e,i))}}return t}function l(e,i,n,o,s){var l=0;switch(i){case"uInt32":n=h(o,n,a.encodeUInt32(e));break;case"int32":case"sInt32":n=h(o,n,a.encodeSInt32(e));break;case"float":o.writeFloatLE(e,n),n+=4;break;case"double":o.writeDoubleLE(e,n),n+=8;break;case"string":l=t.byteLength(e),n=h(o,n,a.encodeUInt32(l)),o.write(e,n,l),n+=l;break;default:var d=s.__messages[i]||r.protos["message "+i];if(d){var u=new t(2*t.byteLength(JSON.stringify(e)));l=c(u,l=0,d,e),n=h(o,n,a.encodeUInt32(l)),u.copy(o,n,0,l),n+=l}}return n}function d(e,t,i,n,r){var s=0;if(o.isSimpleType(t.type))for(i=h(n,i,u(t.type,t.tag)),i=h(n,i,a.encodeUInt32(e.length)),s=0;s<e.length;s++)i=l(e[s],t.type,i,n);else for(s=0;s<e.length;s++)i=h(n,i,u(t.type,t.tag)),i=l(e[s],t.type,i,n,r);return i}function h(e,t,i){for(var a=0;a<i.length;a++)e.writeUInt8(i[a],t),t++;return t}function u(e,t){var i=n.TYPES[e];return void 0===i&&(i=2),a.encodeUInt32(t<<3|i)}r.init=function(e){this.protos=e||{}},r.encode=function(e,i){if(!e||!i)return console.warn("Route or msg can not be null! route : %j, msg %j",e,i),null;var a=this.protos[e];if(!s(i,a))return console.warn("check msg failed! msg : %j, proto : %j",i,a),null;var n=2*t.byteLength(JSON.stringify(i)),o=new t(n),r=0;return a&&(r=c(o,r,a,i))>0?o.slice(0,r):null}}).call(this,i(0).Buffer)},function(e,t,i){var a,n=i(1),o=i(2),r=e.exports,s=0;function c(e,t,i){for(;s<i;){var a=l(),n=(a.type,a.tag),o=t.__tags[n];switch(t[o].option){case"optional":case"required":e[o]=d(t[o].type,t);break;case"repeated":e[o]||(e[o]=[]),h(e[o],t[o].type,t)}}return e}function l(){var e=n.decodeUInt32(u());return{type:7&e,tag:e>>3}}function d(e,t){switch(e){case"uInt32":return n.decodeUInt32(u());case"int32":case"sInt32":return n.decodeSInt32(u());case"float":var i=a.readFloatLE(s);return s+=4,i;case"double":var o=a.readDoubleLE(s);return s+=8,o;case"string":var l=n.decodeUInt32(u()),d=a.toString("utf8",s,s+l);return s+=l,d;default:var h=t&&(t.__messages[e]||r.protos["message "+e]);if(h){l=n.decodeUInt32(u());var p={};return c(p,h,s+l),p}}}function h(e,t,i){if(o.isSimpleType(t))for(var a=n.decodeUInt32(u()),r=0;r<a;r++)e.push(d(t));else e.push(d(t,i))}function u(e){var t=[],i=s;e=e||!1;do{var n=a.readUInt8(i);t.push(n),i++}while(n>=128);return e||(s=i),t}r.init=function(e){this.protos=e||{}},r.setProtos=function(e){e&&(this.protos=e)},r.decode=function(e,t){var i=this.protos[e];return a=t,s=0,i?c({},i,a.length):null}},function(e){function t(e){var i={},a={},n={};for(var o in e){var r=e[o],s=o.split(" ");switch(s[0]){case"message":if(2!==s.length)continue;a[s[1]]=t(r);continue;case"required":case"optional":case"repeated":if(3!==s.length||n[r])continue;i[s[2]]={option:s[0],type:s[1],tag:r},n[r]=s[2]}}return i.__messages=a,i.__tags=n,i}e.exports.parse=function(e){var i={};for(var a in e)i[a]=t(e[a]);return i}},function(e){var t,i,a;i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},t=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var r=10;function s(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,i,a){var n,o,r,c;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),o=e._events),r=o[t]),void 0===r)r=o[t]=i,++e._eventsCount;else if("function"==typeof r?r=o[t]=a?[i,r]:[r,i]:a?r.unshift(i):r.push(i),(n=s(e))>0&&r.length>n&&!r.warned){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=r.length,c=l,console&&console.warn&&console.warn(c)}return e}function l(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,a(this.listener,this.target,e))}function d(e,t,i){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=l.bind(a);return n.listener=i,a.wrapFn=n,n}function h(e,t,i){var a=e._events;if(void 0===a)return[];var n=a[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?m(n):p(n,n.length)}function u(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),a=0;a<t;++a)i[a]=e[a];return i}function f(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function m(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");r=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return s(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var s=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw s.context=r,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var l=c.length,d=p(c,l);for(i=0;i<l;++i)a(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,a,n,o,r;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(a=this._events))return this;if(void 0===(i=a[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){r=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():f(i,n),1===i.length&&(a[e]=i[0]),void 0!==a.removeListener&&this.emit("removeListener",e,r||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,a;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,o=Object.keys(i);for(a=0;a<o.length;++a)"removeListener"!==(n=o[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):u.call(e,t)},o.prototype.listenerCount=u,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}]),cc._RF.pop()},{}],privacy:[function(e,t){"use strict";cc._RF.push(t,"7f4d6KhLqZFi7RoWCZHrRVx","privacy");var i=function(e){return e},a=function(e){return e};window.privacy={init:function(){var e=parseInt(user.getUID(),36);privacy.prefix=e+"_",i=function(e){for(var t="",i=0;i<e.length;i++){var a=173^e.charCodeAt(i);a=a>>>5|a<<3&255,t+=String.fromCharCode(+a+1)}return t},a=function(e){for(var t="",i=0;i<e.length;i++){var a=+e.charCodeAt(i)-1;a=a>>>3|a<<5&255,t+=String.fromCharCode(173^a)}return t}},decodeToJson:function(e,t){try{var i=privacy.decode(e);if(i){if(t&&(cc.warn("md5 check",t,0),0!=t))return;return JSON.parse(i)}}catch(a){console.warn(a)}},encodeFromJson:function(e,t,i){try{t.uuid=user.getUID();var a=JSON.stringify(t);if(privacy.encode(e,a),i)return 0}catch(n){console.warn(n)}},decode:function(e){var t=cc.sys.localStorage.getItem(privacy.getName(e));if(t)return a(t)},encode:function(e,t){cc.sys.localStorage.setItem(privacy.getName(e),i(t))},exists:function(e){return cc.sys.localStorage.getItem(privacy.getName(e))},remove:function(e){return cc.sys.localStorage.removeItem(privacy.getName(e))},getName:function(e){return parseInt(user.getUID(),36),privacy.prefix+e}},cc._RF.pop()},{}],pvp:[function(e,t){"use strict";function i(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=a(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}cc._RF.push(t,"6799eFUuzxO3qynOYIG4+VP","pvp");var o={init:function(){o.saveData={}},load:function(e){var t;o.saveData[HONOR]=e[HONOR],o.saveData.hisWin=e.hisWin,o.saveData.hisFail=e.hisFail,o.saveData.index=e.pvpIndex,o.mode={};for(var a=i(PVP_DEF);!(t=a()).done;){var n=t.value,r=n[0],s=n[1];o.initMode(r,e.pvp,s)}o.initRoad(e),o.boxData={};var c=excel.read("pvp_box");for(var l in c)o.boxData[c[l].id]=c[l];var d=excel.read("pvp_map");for(var h in d)o.mode[d[h].mode].maps.push(d[h])},update:function(e){if(e){var t;void 0!==e[HONOR]&&o.setHonor(e[HONOR]);for(var a=i(PVP_DEF);!(t=a()).done;){var n=t.value,r=n[0],s=(n[1],e["pvp."+r+".power"]),c=e["pvp."+r+".index"],l=e["pvp."+r+".win"],d=o.mode[r];void 0!==s&&(d.power=s),void 0!==c&&(d.index=c),void 0!==l&&(d.win=l)}}},initRoad:function(e){o.road={};var t=e.pvpRoad;for(var i in t)o.road[i]={status:t[i].status}},getRoadData:function(e){return o.road[e]||{}},getRoadStatus:function(e){return o.getRoadData(e).status},getRoadBox:function(e){return o.boxData[e]},setRoadStatus:function(e,t){o.road[e]?o.road[e].status=t:o.road[e]={status:t}},getHonor:function(){return o.saveData[HONOR]||0},getHonorIcon:function(){return o.iconIndex||(o.iconIndex=o.updateHonorIcon(o.getHonor())),o.iconIndex},updateHonorIcon:function(e){var t,i=excel.read("pvp_road");for(var a in i){var n=i[a];if(n.honor>e)break;n.icon&&(t=n.icon)}return t},setHonor:function(e){o.saveData[HONOR]=e,o.iconIndex=o.updateHonorIcon(e);var t=sdk.pt();if(t&&t.setUserCloudStorage){var i=JSON.stringify({wxgame:{score:+e,update_time:Math.round(Date.now()/1e3)}});t.setUserCloudStorage({KVDataList:[{key:"honor",value:i}]})}},setHisWin:function(e){o.saveData.hisWin=e;var t=sdk.pt();t&&t.setUserCloudStorage&&t.setUserCloudStorage({KVDataList:[{key:"hisWin",value:""+e}]})},setHisFail:function(e){o.saveData.hisFail=e;var t=sdk.pt();t&&t.setUserCloudStorage&&t.setUserCloudStorage({KVDataList:[{key:"hisFail",value:""+e}]})},getHisWin:function(){return o.saveData.hisWin||0},getHisFail:function(){return o.saveData.hisFail||0},getHisRate:function(){return o.getHisFail()+o.getHisWin()>0?Math.round(o.getHisWin()/(o.getHisFail()+o.getHisWin())*100):0},getAIDefine:function(e){void 0===e&&(e=o.getHonor());for(var t=excel.read("pvp_ai"),i=t[0],a=1,n=t.length;a<n;a++){if(t[a].honor>=e)return i;i=t[a]}return i},initMode:function(e,t,i){o.mode[e]||(o.mode[e]={});var a=o.mode[e];a.def=i,a.maps=[],t&&t[e]?(a.index=t[e].index,a.win=t[e].win,a.power=t[e].power,a.teamList=t[e].teamList,a.date=Date.now()+t[e].time||0,a.opened=!0):(a.power=a.def.maxPower,a.date=0)},updateModeData:function(e,t){net.postSilent("getPvpData",{pvp:e},function(i,a){if(!i){var n=o.mode[e];n.power=a.power,n.date=Date.now()+a.time||0,n.opened=!0,t&&t()}})},getModeData:function(e){return o.mode[e]},isModeOpened:function(e){var t=o.mode[e];return!!t.opened||t.def.unlock<0&&(t.opened=!0,!0)},getModeMap:function(e){if("quick"!=e){var t=o.getDayIndex(),i=o.mode[e].maps;return i[t%i.length]}},getModeIndex:function(e){return o.getModeData(e).index||0},getModeWin:function(e){return o.getModeData(e).win||0},getModeTime:function(e){return(o.mode[e].date-Date.now())/1e3},getModePower:function(e){return o.getModeData(e).power||0},getDayIndex:function(){return o.saveData.index},getModeDefine:function(e){return o.getModeData(e).def},updateTeamList:function(e){for(var t=o.getTeamList(e),i=0,a=t.length;i<a;i++)if(t[i]){var n=t[i].hero;if(n.rent)t.splice(i,1),i--,a--;else{t[i].hero=pc.getHero(n.id);var r=t[i].gun;r&&r.rent&&delete t[i].gun}}},getTeamList:function(e){var t=o.getModeData(e);return t.teamList||(t.teamList=[{hero:pc.getChooseHero(),gun:pc.getChooseGun()}])},setTeamList:function(e,t){o.getModeData(e).teamList=t}};window.pvp=o,cc._RF.pop()},{}],quickMatch:[function(e,t){"use strict";cc._RF.push(t,"f8dfbNrnGVMRJi2HnRvTfkc","quickMatch");var i={prepare:function(e){i.maxUser=e.maxUser||2,i.maxHero=e.maxHero||1,i.teamList=e.teamList,i.setMatchType(e.type||"q-all"),i.config=e,i.waitCallback=null,i.matchCallback=null,i.fillCallback=null},setMatchType:function(e){cc.log("set match",e),i.type=e,i.matchType=e+"-"+CORE_VERSION},getUserData:function(){var e=i.teamList,t=[];for(var a in e){var n=e[a],o=n.hero,r=pc.getHeroData(o.id),s=pc.getHeroAttr(r,o.lvl),c=n.gun,l=pc.getGunParts(c.id);t.push({lvl:o.lvl,hp0:s.hp,atk0:s.atk,talent:s.talent,face:r.cos,guns:{left_gun:{i:c.id,talent:l}}})}return{name:user.getUserName(),head:user.getUserHeadUrl(),honor:pvp.getHonor(),list:t,lvl:pc.getMaxHeroLevel()}},getMatchData:function(){return{fr:NET_FRAME_RATE,mu:i.maxUser,matchType:i.matchType,user:i.getUserData()}},start:function(e){cc.log("start match",i.matchType),i.matchCb=e,net.post("getBattleServer",{},function(e,t){if(e)return kit.info(LI("net_err")),i.reset(),void i.matchCb(-1);net.setServerCfg(t);var a=net.waitTime||0;i.forceAI?(a+=kit.rnd(1,4),setTimeout(function(){i.fillUser(function(e,t){if(e)return kit.info(LI("net_err")),i.reset(),void i.matchCb(-1);i.matching(t)})},1e3*a)):setTimeout(function(){i.matching()},1e3*a)})},accept:function(e,t){i.matchCb=e,net.post("getBattleServer",{uid:t},function(e,t){if(e)return kit.info(LI("net_err")),i.reset(),void i.matchCb(-1);net.setServerCfg(t),i.join()})},join:function(){var e=i.matchType;cc.log("join match",e),net.request("matching.handler.join",i.getMatchData(),function(e,t){if(!e)return kit.info(LI("invite_null_msg")),void i.matchCb(-1);var a=t.users;for(var n in a)if(a[n].uid==user.getUID())break;i.matchCallback?i.matchCallback(t,n):i.run(t,n)})},matching:function(e){var t=i.matchType;console.log(t),net.removeAllListeners("match.on"),net.on("match.on",function(e){net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener);var t=e.users;i.go(e,t)});var a=i.getMatchData();a.robots=e,net.reqSilent("matching.handler.matching",a,function(e,t,a){e?(cc.log("\u5f00\u623f\u542f\u52a8\u6210\u529f"),i.wait()):(cc.log("\u5f00\u623f\u542f\u52a8\u5931\u8d25",e,t,a),kit.info(a||LI("net_err")),net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener),i.reset(),i.matchCb(-1))})},pushRobot:function(e){var t=i.matchType;net.reqSilent("matching.handler.pushRobot",{matchType:t,robots:e},function(e,t,a){e?cc.log("\u5339\u914d\u8d85\u65f6\u6210\u529f"):(cc.log("\u5339\u914d\u8d85\u65f6\u5931\u8d25"),kit.info(a||LI("invite_fail_msg")),net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener),i.reset(),i.matchCb(-1),net.disconnect())})},timeout:function(){cc.log("match.timeout"),i.isMatchStart||i.fillUser(function(e,t){e?(kit.info(LI("net_err")),i.reset(),i.matchCb(-1)):i.pushRobot(t)})},fillUser:function(e){var t=i.maxUser-1,a=[],n=window.hg;if(n){var o=!1;n.getAIUser({num:t,success:function(n){if(console.log("hg.getAIUser",JSON.stringify(n)),!o){o=!0;for(var r=0;r<t;r++)i.fillHero(a,n[r].nickName,n[r].avatarUrl||n[r].avataUrl);e(0,a)}},fail:function(){console.log("hg.getAIUser fail"),o||(o=!0,e(-1))}})}else{for(var r=0;r<t;r++)i.fillHero(a,rnd_name(),rnd_head());e(0,a)}},fillHero:function(e,t,a){if(i.fillCallback)i.fillCallback(e,t,a);else{var n=excel.read("weapon_player"),o=[];for(var r in n)o.push(n[r].id);n=excel.read("player_list");var s=[];for(var r in n)s.push(n[r].id);var c=kit.rndInt(1,40),l=i.maxHero,d=[];for(r=0;r<l;r++){var h=s.splice(kit.rndInt(0,s.length-1),1)[0],u=o.splice(kit.rndInt(0,o.length-1),1)[0],p=kit.clamp(kit.rndInt(.6*c,c),1,40),f=pc.getHeroData(h),m=pc.getHeroAttr(f,p),g=pc.getGunParts(u);d.push({ai:"3",lvl:p,hp0:m.hp,atk0:m.atk,talent:m.talent,face:f.cos,guns:{left_gun:{i:u,talent:g}}})}var v={robot:1,lvl:c,head:a,name:t,honor:kit.rndInt(0,900),list:d};e.push(v)}},go:function(e,t){cc.log("match.go");for(var a=0,n=0;n<t.length;n++)if(t[n].uid==user.getUID()){a=n;break}i.matchCallback?i.matchCallback(e,a):i.run(e,a)},wait:function(){i.isMatchWait=!0,i.waitCallback&&i.waitCallback(),i.offlineListener=function(){cc.log("reconnnect!"),net.request("matching.handler.matching",i.getMatchData(),function(e,t,a){e?cc.log("\u7ea6\u6218\u91cd\u65b0\u542f\u52a8\u6210\u529f"):(cc.log("\u7ea6\u6218\u91cd\u65b0\u542f\u52a8\u5931\u8d25"),net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener),kit.info(a||LI("net_err")),i.reset(),i.matchCb(-1),net.disconnect())})},net.on("offline",i.offlineListener)},run:function(e,t){cc.log("match.run",e),net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener),i.isMatchStart=!0,e.rid,e.users;for(var a=i.mapFile||"map/PVP1",n=i.config,o={},r=i.maxUser,s=(i.maxHero,0);s<r;s++)o[s]=e.users[s];var c={pvp:1,rid:e.rid,seed:e.seed,mapFile:a,users:e.users,remotes:{lvl:e.lvl,entity:o},me:+t+1,startFunc:n.startFunc,finishFunc:n.finishFunc,pauseFunc:n.pauseFunc};loadGame(c)},reset:function(){cc.log("match.reset"),i.isMatchWait=!1},exit:function(){cc.log("match.exit"),net.removeAllListeners("match.on"),i.offlineListener&&(net.removeListener("offline",i.offlineListener),delete i.offlineListener),i.isMatchWait?(cc.log("cancel"),net.reqSilent("matching.handler.cancel",{},function(e,t,a){e?cc.log("\u9000\u51fa\u7ea6\u6218"):cc.log(a||LI("net_err")),i.isMatchStart||net.disconnect(),i.isMatchStart=!1}),i.isMatchWait=!1):(i.isMatchStart||net.disconnect(),i.isMatchStart=!1)}};t.exports=i,cc._RF.pop()},{}],record:[function(e,t){"use strict";var i;cc._RF.push(t,"5567bP/yCJLBpxiKkyFNOmL","record"),window.record={start:function(){},isRecordEnabled:function(){return!(!DEV_MODE||"tt"!=CH||cc.sys.platform==cc.sys.BYTEDANCE_GAME)||!cc.sys.isNative&&(cc.sys.platform==cc.sys.BYTEDANCE_GAME?tt.getGameRecorderManager:void 0)},isRecordReady:function(){return!(!DEV_MODE||"tt"!=CH||cc.sys.platform==cc.sys.BYTEDANCE_GAME)||!cc.sys.isNative&&record.videoPath},showRecord:function(e,t){if(DEV_MODE&&"tt"==CH&&cc.sys.platform!=cc.sys.BYTEDANCE_GAME)kit.info(LT("\u6a21\u62df\u5f55\u5c4f\u5206\u4eab"),function(){t(0)});else{var i=record.videoPath;cc.sys.platform==cc.sys.BYTEDANCE_GAME?i?tt.shareAppMessage({channel:"video",title:"\u6e38\u620f\u65f6\u523b #"+GAME_TITLE+"#",desc:record.slogan||"\u6211\u7684\u7cbe\u5f69\u5b9e\u5f55",imageUrl:"",templateId:"",query:"",extra:{videoPath:i,videoTopics:[GAME_TITLE,"\u5c0f\u6e38\u620f","\u8363\u8000","\u738b\u8005"]},success:function(){console.log("\u5206\u4eab\u6210\u529f"),kit.info(LT("\u5206\u4eab\u5f55\u5c4f\u6210\u529f"),function(){t(0)})},fail:function(){console.log("\u5206\u4eab\u5931\u8d25"),kit.info(LT("\u5206\u4eab\u5f55\u5c4f\u5931\u8d25, \u518d\u8bd5\u8bd5\u5427"),function(){t(1)})}}):kit.info(LT("\u6682\u65f6\u6ca1\u6709\u5f55\u5c4f, \u53bb\u6218\u6597\u4e00\u573a\u5427"),function(){t(2)}):t(213)}},stop:function(e,t){if(cc.sys.platform==cc.sys.BYTEDANCE_GAME&&i){if(record.starting)return console.log("recorderMgr waitForStop"),void(record.waitForStop=!0);console.log("tt recorderMgr.stop"),i.onStop(function(a){console.log("recorderMgr.onStop",e,a.videoPath),e||(record.videoPath=a.videoPath,record.slogan=t),i=null,record.stopping=!1,record.waitForStart&&(console.log("recorderMgr waitForStart done"),record.waitForStart=!1,setTimeout(function(){record.start()},100))}),i.stop(),record.stopping=!0}else cc.sys.platform,cc.sys.WECHAT_GAME},cancel:function(){record.stop(!0)}},cc._RF.pop()},{}],replay:[function(e,t){"use strict";cc._RF.push(t,"597c7O3r5ZBD5SozI71VnNU","replay"),cc._RF.pop()},{}],rifleman:[function(e,t){"use strict";cc._RF.push(t,"ffe8bmMAM9AU4LDXANfdAAg","rifleman"),e("./define");var i=e("../entities/environment/MyTower"),a=e("../ai/units/AIMyTower");BULLET_DEFINE.riflemanBlt=[{name:"\u673a\u67aa",avatar:{sx:1.6,sy:1.8,sx1:1.6,sy1:1.8,st:.02,frm:"bullet/zidan",hitEffect:EFFECT.meleeHit,noBlend:!0,hitFloorEffect:EFFECT.hitFloorSmoke,streakEffect:EFFECT.BulletSmoke},length:20,kb:.02,n:1,wd:0,d:14,spd:2500,spdFluc:.2,distance:1e3,thrDecline:1,thrChance:0},{name:"\u673a\u67aa\u8fc7\u70ed",avatar:{sx:.4,sy:.6,sx1:.5,sy1:1,st:.02,frm:"avatar/98k",hitEffect:EFFECT.yellowHit,noBlend:!0,hitFloorEffect:EFFECT.hitFloorSmoke},length:20,kb:.02,n:1,wd:0,d:14,spd:2200,spdFluc:.2,distance:1e3,thrDecline:1,thrChance:0}],ENTITY.rifleman={id:"rifleman",hero:!0,category:"rifleman",name:"\u6b65\u67aa",avatar:{gunBone:"gun",animeName:"jqxb",anime:"weapon/jqxb",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:30,blt:BULLET_DEFINE.riflemanBlt,bltMax:40,bltReload:1,attackCenter:cc.v2(0,-5),attackVolume:.3,attackSequence:[{t:.5,x:77,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLightSmall},{t:1}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},RES[MACHINE_GUN]=[{anime:"weapon/jiqiang"},"avatar/98k","sound/machine_gun",RES.yellowHit],ENTITY.rifleman_2={id:"rifleman_2",hero:!0,category:"rifleman",name:"\u6b65\u67aa2",avatar:{gunBone:"gun",animeName:"jqxb2",anime:"weapon/jqxb",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:45,blt:BULLET_DEFINE.riflemanBlt,bltMax:40,bltReload:1,attackCenter:cc.v2(0,-5),attackVolume:.3,attackSequence:[{t:1.5,x:77,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLightSmall},{t:1}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},ENTITY.rifleman_3={id:"rifleman_3",hero:!0,category:"rifleman",name:"\u6b65\u67aa3",avatar:{gunBone:"gun",animeName:"jqxb3",anime:"weapon/jqxb",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:68,blt:BULLET_DEFINE.riflemanBlt,bltMax:40,bltReload:1,attackCenter:cc.v2(0,-5),attackVolume:.3,attackSequence:[{t:1.5,x:77,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLightSmall},{t:1}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},ENTITY.rifleman_4={id:"rifleman_4",hero:!0,category:"rifleman",name:"\u6b65\u67aa4",avatar:{gunBone:"gun",animeName:"jqxb4",anime:"weapon/jqxb",s:.77,moveSpd:150},ctor:i,radius:45,hitRadius:45,moveSpd:150,weight:50,hp:200,heatUpOnShot:.85,heatMin:0,armor:1e3,crit:0,bltDmg:102,blt:BULLET_DEFINE.riflemanBlt,bltMax:40,bltReload:1,attackCenter:cc.v2(0,-5),attackVolume:.3,attackSequence:[{t:1.5,x:77,y:0,blt:1,sound:"sound/machine_gun",volume:.3,effect:EFFECT.MachineGunFireLightSmall},{t:1}],attackAngle:[-40,80],heat:{attr:{},attackVolume:1,attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},overHeat:{attr:{atkSpd:.5},attackSequence:[{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight},{t:.125,x:80,y:18,blt:2,sound:"sound/machine_gun",effect:EFFECT.MachineGunHeatModeFireLight}]},pilot:{ctor:a,attackRange:500,seekRange:700,offsetX:-12,offsetY:-23}},cc._RF.pop()},{"../ai/units/AIMyTower":"AIMyTower","../entities/environment/MyTower":"MyTower","./define":"define"}],rope:[function(e,t){"use strict";cc._RF.push(t,"aacdalmfTxJlrgj9p8120Gg","rope"),e("../define"),e("../../components/visual/ArmatureAvatar"),e("../../entities/projectiles/BallBulletSprite"),e("../../entities/projectiles/Bomb");var i=e("../../components/visual/Avatar"),a=e("../../ai/behaviors/combat/AISoldier"),n=(e("../Exploder"),e("../../entities/projectiles/PowerBullet"),e("../../components/movement/Joint")),o=e("../Rope");ENTITY.vine={id:"vine",ctor:o,name:"\u6811\u85e4",avatar:{ctor:i,s:.5,ay:1,frm:"avatar/\u6811\u85e4"},fly:1,moveSpd:500,radius:500,slots:[{x:0,y:-250,w:30,h:500,ctor:n}],pilot:{ctor:e("../../ai/units/AIElevator"),moveX:0,moveY:-1,moveTime:1,delayTime:1}},BULLET_DEFINE.taishan1=[{name:"\u654c\u4eba\u673a\u67aa",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:250,spdFluc:.2,distance:600}],ENTITY.taishan1={id:"taishan1",name:"\u6cf0\u5c711",avatar:{gunBone:"wepon",animeName:"taishan",anime:"mob/taishan",s:.9,moveSpd:50},climb:1,radius:20,hitRadius:35,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.taishan1,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:.9,x:20,y:0,blt:1},{t:1,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:a,attackRange:400,safeRange:[200,350]}},cc._RF.pop()},{"../../ai/behaviors/combat/AISoldier":"AISoldier","../../ai/units/AIElevator":"AIElevator","../../components/movement/Joint":"Joint","../../components/visual/ArmatureAvatar":"ArmatureAvatar","../../components/visual/Avatar":"Avatar","../../entities/projectiles/BallBulletSprite":"BallBulletSprite","../../entities/projectiles/Bomb":"Bomb","../../entities/projectiles/PowerBullet":"PowerBullet","../Exploder":"Exploder","../Rope":"Rope","../define":"define"}],scene:[function(e,t){"use strict";cc._RF.push(t,"130c3NRoRhDl79dDaWhg0Uq","scene"),ENTITY.stage={id:"stage",ctor:e("../entities/environment/Platform"),name:"\u68ee\u6797\u9ad8\u53f0",avatar:{ctor:e("../entities/environment/PlatformSprite"),frm:"theme/\u68ee\u6797\u9ad8\u53f0",z:ZORDER.BACKGROUND},radius:160,dy:120,w:320},ENTITY.stage2={id:"stage2",ctor:e("../entities/environment/Platform"),name:"\u9ad8\u811a\u67b6",editor:1,avatar:{ctor:e("../entities/environment/PlatformSprite"),frm:"theme/\u9ad8\u811a\u67b6",z:ZORDER.BACKGROUND},radius:160,dy:120,w:320},ENTITY.stage3={id:"stage3",ctor:e("../entities/environment/Platform"),name:"\u4e2d\u811a\u67b6",editor:1,avatar:{ctor:e("../entities/environment/PlatformSprite"),frm:"theme/\u4e2d\u811a\u67b6",z:ZORDER.BACKGROUND},radius:160,dy:73,w:320},ENTITY.ship={id:"ship",ctor:e("../entities/environment/Platform"),name:"\u8d27\u8239",avatar:{ctor:e("../entities/environment/PlatformSprite"),frm:"theme/\u7801\u5934/\u8d27\u8239",z:ZORDER.BACKGROUND},editor:1,radius:1320,dy:120,w:1811},ENTITY.ship2={id:"ship2",ctor:e("../entities/environment/Platform"),name:"\u5ba2\u8239",avatar:{ctor:e("../entities/environment/PlatformSprite"),frm:"theme/\u7801\u5934/\u5ba2\u8239",z:ZORDER.BACKGROUND},editor:1,radius:1320,dy:77,w:1247},cc._RF.pop()},{"../entities/environment/Platform":"Platform","../entities/environment/PlatformSprite":"PlatformSprite"}],scrapEffect:[function(e,t){"use strict";cc._RF.push(t,"7fb87qbe6hI2JluFuq715LD","scrapEffect"),EFFECT.scrap=function(e,t,i){if(t){var a=i.getLinearVelocity(),n=bb._b2c(a.x,a.y),o=t.avatar,r=o.atlas,s=o.frm,c=o.frms,l=e.node,d=e.x,h=e.y,u=this.createSpriteFromAtlas(d,h,r,s||c[c.length-1]);this.layer.addToCamera(u,l.zIndex),u.angle=l.angle,u.scaleX=l.scaleX,u.scaleY=l.scaleY,u.opacity=255,u.runActionVS(cc.sequence(cc.spawn(cc.scaleTo(.1,1.2*u.scaleX,1.2*u.scaleY),cc.fadeOut(.1),cc.moveBy(.1,.1*n.x,.1*n.y)),cc.recycle()));var p=t.scrap;if(p){r=p.atlas,c=p.frms;for(var f=kit.rnd(3,5),m=u.width,g=u.height;f>0;){var v=kit.rnd(.3,1),y=kit.rnd(.7,1),b=kit.rnd(.2,y+2*v),k=c[kit.rndInt(0,c.length-1)],T=this.createSpriteFromAtlas(d+kit.rnd(-.5,.5)*m,h+kit.rnd(-.5,.5)*g,r,k);this.layer.addToCamera(T,ZORDER.EFFECT+Math.round(10*b)-10),T.angle=kit.rnd(0,360),f-=y,T.scale=y,T.opacity=0;var _=v+.1,w=kit.clamp(_/b,.3,1.2);T.runActionVS(cc.rotateBy(_,kit.rnd(-360/w,360/w))),T.runActionVS(cc.scaleBy(_,b)),T.runActionVS(cc.jumpBy(_,kit.rnd(-50,50)+n.x*w,kit.rnd(-200,-100)+n.y*w,_*_*200,1)),T.runActionVS(cc.sequence(cc.fadeIn(.1),cc.delayTime(.5*v),cc.fadeOut(.5*v),cc.recycle()))}}}},cc._RF.pop()},{}],sdk:[function(e,t,i){"use strict";cc._RF.push(t,"6c200619cdOfaui/IPZhUo8","sdk"),i.__esModule=!0,i.DailyAdInfo=void 0;var a,n=e("../../../Plugins/ADManager"),o=(a=e("../../TimeManager"))&&a.__esModule?a:{default:a},r=e("../../../Plugins/applovin/MAX"),s=e("../../../Plugins/firebase/FirebaseTracking");i.DailyAdInfo=function(){this.dateTimestamp=Date.now(),this.bannerCount=0,this.interstitialCount=0,this.rewardedCount=0,this.spinCount=0},window.VIDEO_FREE="video",window.SHARE_FREE="share",window.SHARE_PIC="https://mmocgame.qpic.cn/wechatgame/upkzJjU1alsbSxconnQPuG1SLkPWXy0Zh6OYzYIZx5tsLFH8ZWhKVibSwHgRH1JyI/0",window.SHARE_PIC_ID="NVzpGICsQzCTUSZSWe7SRQ==";var c={isValid:function(){return!1},createCustomAd:function(e){var t=e.adUnitId,i=e.style;if(c.isValid()){var a=document.getElementById("Cocos2dGameContainer");if(a){var n=document.createElement("div");a.insertBefore(n,a.lastChild),n.style.background="#083",n.style.position="absolute",n.style.opacity="0.5",n.style.display="none";var o=60,r=106;return 1==t&&(o=360,r=106),n.style.width=o,n.style.height=r,n.style.left=i.left,n.style.top=i.top,n.destroy=function(){n.parentNode.removeChild(n)},n.hide=function(){return n.style.display="none",n},n.show=function(){return n.style.display="block",n},n.then=function(){},n.onError=function(e){n.errorCb=e},n.onLoad=function(e){n.loadCb=e},n.onClose=function(){},setTimeout(function(){n.loadCb({})},1e3),n}}var s={onError:function(e){s.errorCb=e},onLoad:function(){},onClose:function(){}};return setTimeout(function(){s.errorCb({})},500),s},createInterstitialAd:function(){if(c.isValid()){var e=document.getElementById("Cocos2dGameContainer");if(e){var t=document.createElement("div");e.insertBefore(t,e.lastChild),t.style.background="rgba(0,0,0,0.5)",t.style.position="absolute",t.style.display="none",t.style.width="100%",t.style.height="100%";var i=document.createElement("div");return t.appendChild(i),i.style.position="absolute",i.style.left=100,i.style.top=200,i.style.right=100,i.style.bottom=200,i.style.margin="auto",i.style.background="#09C",i.innerHTML="<button>\u5f39\u7a97\u4e86, \u70b9\u51fb\u4efb\u610f\u4f4d\u7f6e\u5173\u95ed</button>",t.onclick=function(){t.onClose(),t.hide()},t.destroy=function(){t.parentNode.removeChild(t)},t.hide=function(){t.style.display="none"},t.show=function(){t.style.display="block"},t.onError=function(e){t.errorCb=e},t.onLoad=function(e){t.loadCb=e},t.onClose=function(){},t.load=function(){setTimeout(function(){t.loadCb({})},1e3)},t}}var a={onError:function(e){a.errorCb=e},onLoad:function(){},onClose:function(){},load:function(){}};return setTimeout(function(){a.errorCb({})},500),a}},l={init:function(){cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","querySkuDetails","(Ljava/lang/String;Ljava/lang/String;)V","","")},setConfigData:function(e){try{o.default.Instance.initializeWithServerTime(e.ts)}catch(t){cc.error("setConfigData",t.fileName+":"+t.lineNumber+"\n"+t.message+"\n\n"+t.stack)}},now:function(){return o.default.Instance.now()},date:function(){return new Date(l.now())},getChannelName:function(){return CH},showFloat:function(e,t){if(ADS){var i=0;"bonus"==e&&(i=1),l.floatCounts[i]++,console.log("showFloat",e,l.floatCounts[i]),l.loadFloat(i,t),l.floatAds[i]&&l.floatAds[i].show().then(function(){console.log("show float then",e,l.floatCounts[i]),l.floatCounts[i]<=0&&l.floatAds[i].hide()})}},hideFloat:function(e){if(ADS){var t=0;"bonus"==e&&(t=1),l.floatCounts[t]--,console.log("hideFloat",e,l.floatCounts[t]),l.floatAds[t]&&l.floatCounts[t]<=0&&l.floatAds[t].hide()}},loadFloat:function(e,t){var i=[0,1],a=l.pt(),n=[cc.v2(60,106),cc.v2(360,106)],o=[cc.v2(.5,.5),cc.v2(.5,0)];if(cc.sys.platform==cc.sys.WECHAT_GAME&&(i=["adunit-e4f3f44c61f8eb7c","adunit-e5eff55ff17acc35"]),a&&a.createCustomAd){var r=n[e],s=o[e],c=cc.view.getDevicePixelRatio(),d=cc.view.getScaleX()/c,h=cc.view.getScaleY()/c,u=t.getBoundingBoxToWorld(),p=u.x*d-r.x*s.x,f=(cc.winSize.height-u.y-u.height)*h+r.y*(s.y-1);if(l.floatAds[e]){if(l.floatAdPos[e]&&l.floatAdPos[e].left==p&&l.floatAdPos[e].top==f)return;l.floatAds[e].hide(),l.floatAds[e].destroy()}var m=a.createCustomAd({adUnitId:i[e],style:{left:p,top:f,fixed:!1}});l.floatAds[e]=m,l.floatAdPos[e]={left:p,top:f},m.onLoad(function(e){console.log("float onLoad",e)}),m.onClose(function(){console.log("float onClose"),l.floatAds[e]=null}),m.onError(function(t){console.log("float onError",t),l.floatAds[e]=null})}},loadInsert:function(){},showInsert:function(e){ADS&&(console.log("sdk.showInsert"),l.wxInsert&&(console.log("showInsert",e),l.insertOpened&&l.wxInsert.show(),cc.sys.platform==cc.sys.OPPO_GAME&&l.wxInsert.load()))},isBannerOpened:function(){return"douyin"!=CH&&"tt"!=CH&&(window.Platformsdk&&Platformsdk.checkBanner?Platformsdk.checkBanner():"oppo"==CH?!!l.wxBanner:l.bannerOpened)},loadBanner:function(){},isVideoOpened:function(){if(window.nativeSdk&&nativeSdk.checkVideo)return nativeSdk.checkVideo()},initVideo:function(){if(!l.videoLoaded){var e;l.videoLoaded=!0;var t=l.pt(),i=VIDEO_ID;cc.sys.platform===cc.sys.OPPO_GAME&&(i="1738747"),t&&(t.createRewardedVideoAd||t.createRewardVideoAd)&&(console.log("video_debug sdk init video",i),e=window.uc?t.createRewardVideoAd():t.createRewardedVideoAd({adUnitId:i}),console.log("video_debug video createRewardedVideoAd",e),l.rewardedVideo=e,e.onClose(function(e){console.log("video_debug onClose",JSON.stringify(e)),e.isEnded?(l.showVideoCallback(!0),TJ.mpVideo(l._showVideoId,2),window.sfks&&sfks.IKsSDK.instance.incidentReturn(),window.sfwx&&sfwx.WxZtSdk.instance.incidentReturn()):l.showVideoCallback(!1)}),e.onLoad(function(e){console.log("video_debug onLoad",JSON.stringify(e)),l.videoStatus="loaded",cc.game.emit("video_change")}),e.onError(function(e){console.log("video_debug onError",e),l.showVideoError(e)}),cc.sys.platform===cc.sys.OPPO_GAME?(e.load(),console.log("video_debug call load")):(cc.sys.platform===cc.sys.BYTEDANCE_GAME||window.ks)&&(l.videoStatus="loaded",cc.game.emit("video_change"),console.log("video_debug loaded(ks/tt)")))}},loadVideo:function(){var e=l.rewardedVideo;e&&(cc.sys.platform===cc.sys.BYTEDANCE_GAME||window.ks?(l.videoStatus="loaded",cc.game.emit("video_change")):e.load())},getBoostType:function(){return SHARE?l.isVideoOpened()?VIDEO_FREE:SHARE_FREE:VIDEO_FREE},getFreeType:function(){return SHARE?l.isVideoOpened()?VIDEO_FREE:SHARE_FREE:VIDEO_FREE},useBoost:function(e,t){var i=l.getBoostType();i===VIDEO_FREE?l.showVideo(e,t):i===SHARE_FREE&&l.showShare(e,t)},useFree:function(e,t,i){if(H5VERSION||i)t(0);else{var a=menuManager.popCover({time:3});console.log("======= useFree showvideo"),l.showVideo(e,function(e,i){menuManager.closeCover(a),t(e,i)})}},buyDiamond:function(e,t){if(cc.sys.isNative)if(cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_IOS){var i=e.split(".")[1]+"-"+sdk.now();cc.log("orderid:"+i),r.MAX.instance.setPayBack(t),cc.sys.os==cc.sys.OS_IOS||cc.sys.os==cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","GooglePay","(Ljava/lang/String;Ljava/lang/String;)V",e,i)}else t(0,VIDEO_FREE)},useTicket:function(e,t,i){money.getNum(SWEEP_TICKET)>0?net.updateData({price:{i:SWEEP_TICKET,n:1}},function(i,a){s.FirebaseTracking.setDataBiRes("SweepTicket"),money.update(a),t(0),YMTJ("lv","video_Coupons_"+e)}):H5VERSION||i?t(0):l.useFree(e,t,i)},showVideo:function(e,t){t?r.MAX.instance.isRewarded?(console.log("showRewarded"),1==user.buyVIPState?t(0,VIDEO_FREE):cc.sys.os===cc.sys.OS_ANDROID||cc.sys.os===cc.sys.OS_IOS?setTimeout(function(){console.log("Showing reward ad after delay to prevent race condition"),n.ADManager.Instance.showReward(e,t)},150):t(0,VIDEO_FREE)):(console.log("Ad not ready - showing empty message"),kit.info(LI("ads_empty_msg")),t&&t(-1,"Ad not available")):console.log("video_debug need cb")},showVideoCallback:function(e,t){if(cc.audioEngine.resumeAll(),l._showVideoCallback){var i=l._showVideoId,a=l._showVideoCallback;delete l._showVideoCallback,e?(console.log("video_debug showVideoCallback success"),task.addDailyTaskCt("videoCount"),kit.info(LI("ads_done"),function(){a(0,VIDEO_FREE),YMTJ("pay","pay_"+i+"_"+pc.getChapterIndex(),t),TJ.onEvent("user_add",{total_video_finish:1}),user.onlineTime<=1440&&TJ.onEvent("user_add",{video_24h_finish:1})})):(console.log("video_debug showVideoCallback cancel"),a(5,VIDEO_FREE)||kit.info(LI("ads_cancel")))}else cc.log("video_debug sdk._showVideoCallback is null")},showVideoError:function(){console.log("video_debug showVideoError"),l.videoStatus="failed",cc.game.emit("video_change");var e=l._showVideoId;TJ.mpVideo(e,1);var t=l._showVideoCallback;t&&(delete l._showVideoCallback,cc.audioEngine.resumeAll(),t(3,VIDEO_FREE)||kit.info(LI("ads_empty_msg")),l.rewardedVideo&&(console.log("video_debug showVideoError reload video"),l.videoStatus="null",l.loadVideo()))},showShare:function(e,t){console.log("showShare:",e),t?l._showShareCallback?console.log("share is waiting"):(l._showShareId=e,window.nativeSdk&&nativeSdk.share&&(l._showShareCallback=t,nativeSdk.share(e,"",function(e,t){if(l._showShareCallback){l._showShareId;var i=l._showShareCallback;delete l._showShareCallback,e?kit.info(LI("share_done"),function(){i(0,SHARE_FREE)}):kit.info(t||LI("share_cancel"),function(){i(1,SHARE_FREE)})}}))):console.log("share need cb")},showFullScreenAd:function(){},showBanner:function(e){ADS&&(l.bannerCount++,console.log("showBanner",e,l.bannerCount),window.nativeSdk&&nativeSdk.showBanner?nativeSdk.showBanner(e):l.wxBanner&&(window.uc?l.wxBanner.show():l.wxBanner.show().then(function(){console.log("show banner then",e,l.bannerCount),l.bannerCount<=0&&l.wxBanner.hide()})))},removeBanner:function(e){ADS&&(l.bannerCount--,console.log("removeBanner",e,l.bannerCount),window.nativeSdk&&nativeSdk.removeBanner?l.bannerCount<=0&&nativeSdk.removeBanner(e):l.wxBanner&&l.bannerCount<=0&&(l.wxBanner.hide(),window.qq&&Date.now()-l.bannerTime>12e4&&l.loadBanner()))},vibrateShort:function(){var e=l.pt();e&&e.vibrateShort?e.vibrateShort():window.nativeSdk&&nativeSdk.vibrate?nativeSdk.vibrate():window.navigator.vibrate?window.navigator.vibrate(30):console.log("\u4e0d\u652f\u6301\u9707\u52a8")},getSafeAreaRect:function(){var e={x:0,width:cc.winSize.width,y:0,height:cc.winSize.height};return window.bl||(e=cc.sys.getSafeAreaRect()),!e.y&&cc.winSize.height/cc.winSize.width>2&&(e={x:0,height:cc.winSize.height-50-50,y:50,width:cc.winSize.width}),e},getGameReward:function(e,t){var i=this;if(DEV_MODE&&DEBUG_MODE)return t(0);wx.checkSession({success:function(){var a=user.session_key;net.post("getGameRewardData",{index:e,session_key:a},function(e,a){if(e)return t(101);i.payGameReward(a,t)})},fail:function(){wx.login({success:function(a){var n={code:a.code};net.post("getGameRewardData",{index:e,loginData:n},function(e,a){if(e)return t(102);i.payGameReward(a,t)})},fail:function(){return t(102)}})}})},payGameReward:function(e,t){var i=e.signData,a=e.paySig,n=e.signature;console.log("payGameReward",i,a,n);var o=window.miniGameCommon;if(!o||!o.createGameRewarded)return t(201);if(!l.miniGameRewardCb){var r=menuManager.popCover();l.miniGameRewardCb=function(e){console.log("miniGameRewardCb",e.errCode),e.orderNo,1103==e.errCode?(l.miniGameRewardCb=null,t(0),menuManager.closeCover(r)):1104==e.errCode?(l.miniGameRewardCb=null,t(1104),menuManager.closeCover(r)):1105==e.errCode||(1101==e.errCode?s.load({signData:i,paySig:a,signature:n}):1102==e.errCode&&(l.miniGameRewardCb=null,t(1102),menuManager.closeCover(r)))};var s=this.miniGameRewarded;s||(s=o.createGameRewarded(),this.miniGameRewarded=s,s.onLoad(function(){console.log("gr.onLoad"),s.show({success:function(e){console.log("gr.show",e),l.miniGameRewardCb&&l.miniGameRewardCb(e)}})}),s.onError(function(e){console.log("gr.onError",e),l.miniGameRewardCb&&l.miniGameRewardCb(e)})),s.load({signData:i,paySig:a,signature:n})}},pt:function(){return cc.sys.isBrowser&&window.uc?uc:cc.sys.platform===cc.sys.WECHAT_GAME?window.ks?ks:window.bl?bl:wx:cc.sys.platform===cc.sys.BYTEDANCE_GAME?tt:cc.sys.platform===cc.sys.OPPO_GAME?qg:void c.isValid()},capture:function(e,t,i){e=e||"\u770b\u770b\u6211\u7684\u9ed1\u5fc3\u5de5\u5382, \u9177\u6bd9\u4e86!  #"+GAME_TITLE+"# ",cc.sys.platform!==cc.sys.WECHAT_GAME?setTimeout(function(){cc.game.canvas.getContext("webgl",{preserveDrawingBuffer:!0}).canvas.toTempFilePath({x:t.x,y:t.y,width:t.width,height:t.height,destWidth:500,destHeight:400,success:function(t){wx.updateShareMenu({withShareTicket:!0,isUpdatableMessage:!1}),(wx.aldShareAppMessage||wx.shareAppMessage)({title:e,imageUrl:t.tempFilePath,query:"u="+user.getUID(),ald_desc:"income-canvas"}),i(0)},fail:function(){kit.info(LI("capture_fail_msg")),i(1)}})},100):i(1)},setFibaseEvent:function(t,i){cc.log("Firebase tracking :"+t+" - param : "+i),cc.sys.os==cc.sys.OS_IOS?jsb.reflection.callStaticMethod("AppController","adjustEvent3:",e("config").IsCZJE+""):cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","FiraseEvent","(Ljava/lang/String;Ljava/lang/String;)V",t,i)},setAdjustEvent:function(e,t){cc.sys.os==cc.sys.OS_IOS||cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID&&jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","AdjustEvent","(Ljava/lang/String;Ljava/lang/String;)V",e,t)},setAdjuststageEndEvent:function(e){sdk.setAdjustEvent(["4yr5bc","rczxpz","5ysaf9","l8j2e8","aflzhk"][e],"")},setAdjuststageStartEvent:function(e){sdk.setAdjustEvent(["g9z25k","390u5n","ev0svo","1m1tzx","mt6qhd","tr0zru","8tvbsj","lt5lr5","o7q5kj","az4xj4","fqi600","x3lvkv","figa3e","7p4o14","i9pbih"][e],"")},CopyText:function(e){cc.sys.isNative&&cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","JavaCopy","(Ljava/lang/String;)V",e):cc.sys.isNative&&(cc.sys.os,cc.sys.OS_IOS)}};window.sdk=l,cc._RF.pop()},{"../../../Plugins/ADManager":"ADManager","../../../Plugins/applovin/MAX":"MAX","../../../Plugins/firebase/FirebaseTracking":"FirebaseTracking","../../TimeManager":"TimeManager",config:void 0}],setting:[function(e,t){"use strict";if(cc._RF.push(t,"e3839YI6eBC0oVdS3BwJpLQ","setting"),window.MAJOR_VERSION=1,window.MINOR_VERSION=0,window.REVISION_VERSION=25,window.ANIME_SCALE=2,window.DATA_HOST="tank-idle.playablelabs.studio",window.DATA_DEV="tank-idle.playablelabs.studio",window.DATA_DEV_LOCAL="localhost:6001",window.DEV_MODE=!1,window.NGINX=1,window.DEBUG_MODE=!1,window.DEBUG_INVICIBLE=0,window.DEBUG_MAP=0,window.DEBUG_SKILL=1,window.DEBUG_GAME_SPEED=1,window.DEBUG_ADS=1,window.CODE_VERSION=1,window.GAME_VIEW_SCALE=.8,window.BGM_VOLUME=1,window.SE_VOLUME=1,window.VIBRATE=1,window.ADS=1,window.PERSONAL_ADS=1,window.SHARE=0,window.LAN="en-us",window.CH="google",window.OS=cc.sys.os,window.streamerMode=0,window.H5VERSION=0,window.GAME_ID=window.GAME_ID||"tankGame",window.GAME_ID_DEV="tankGame",window.GAME_TITLE=window.GAME_TITLE||"\u6218\u8f66\u5411\u524d\u51b2",window.VIDEO_ID=window.VIDEO_ID||"2wf0coh89ts3gd80a6",window.GAME_SR_NUM=window.GAME_SR_NUM||"2023SR0496802",window.GAME_SR_NAME="",window.activeLeaderBoard=!1,cc.log("[Settings] Leaderboard feature status: "+(window.activeLeaderBoard?"ENABLED":"DISABLED")),window.USE_BASE64_ENCRYPTION=function(){if(cc.sys.isNative)return!1;var e=window.location.hostname;return!("localhost"===e||"127.0.0.1"===e||e.startsWith("192.168.")||e.startsWith("10.")||e.startsWith("172."))}(),cc.log("[Settings] Encryption protocol: "+(window.USE_BASE64_ENCRYPTION?"Base64 (Web - Public)":"Unicode (Native/Local)")),cc.log("[Settings] Hostname: "+window.location.hostname),window.nativeSdk)CH=nativeSdk.getChannelName();else switch(cc.sys.platform){case cc.sys.BYTEDANCE_GAME:CH="tt";break;case cc.sys.WECHAT_GAME:CH=window.ks?"ks":"wx";break;case cc.sys.OPPO_GAME:CH="oppo";break;default:streamerMode=cc.sys.isBrowser}if(DEV_MODE)GAME_ID=GAME_ID_DEV,DATA_HOST=DATA_DEV_LOCAL;else switch(CH){case"wx":case"tt":case"ks":case"m233":case"oppo":DATA_HOST=DATA_HOST;break;case"google":DATA_HOST=DATA_HOST,LAN="en-us"}console.log("@@@@@",window.NGINX?"https://":"http://",DATA_HOST,GAME_ID,"v1.0.3"),cc._RF.pop()},{}],shaderDefine:[function(e,t){"use strict";cc._RF.push(t,"119843yAdBAPbtEcUOBUMUi","shaderDefine");var i=e("./ColorMatrix");window.SHADER_DEFINE={hue180:{name:"matrix",n:"\u8272\u76f8\u53cd\u8f6c",value:{u_mat4:(new i).setHue(180).getMatrix()}},hue130:{name:"matrix",n:"\u8272\u76f8130",value:{u_mat4:(new i).setHue(130).getMatrix()}},pm1:{name:"matrix",n:"\u5f02\u7d2b",value:{u_mat4:cc.mat4(1,0,0,0,0,1,0,0,1,0,1,0,0,0,0,1)}},pm2:{name:"matrix",n:"\u52a0\u7ea2",value:{u_mat4:cc.mat4(1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1)}},pm3:{name:"matrix",n:"\u8272\u76f860\u52a0\u6d53",value:{u_mat4:(new i).setHue(60).setSaturation(1.5).getMatrix()}},pm4:{name:"matrix",n:"\u52a0\u9752",value:{u_mat4:cc.mat4(1,0,0,0,.6,1,.6,0,1,1,1,0,0,0,0,1)}},m0:{name:"matrix",n:"0\u8f6c\u8272",value:{u_mat4:cc.mat4(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1)}},m1:{name:"matrix",n:"1\u8f6c\u8272",value:{u_mat4:cc.mat4(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1)}},m2:{name:"matrix",n:"2\u7ea2\u7eff\u7ffb\u8f6c",value:{u_mat4:cc.mat4(0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1)}},m3:{name:"matrix",n:"3\u7ea2\u84dd\u7ffb\u8f6c",value:{u_mat4:cc.mat4(0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1)}},m4:{name:"matrix",n:"4\u7eff\u84dd\u7ffb\u8f6c",value:{u_mat4:cc.mat4(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1)}},frost:{name:"color",n:"\u767d\u8986\u76d6",value:{u_color:[150/255,225/255,1,.5]}},illusion:{name:"color",n:"\u9752\u8986\u76d6",value:{u_color:[185/255,235/255,1,.8]}},outline:{name:"outline",n:"\u63cf\u8fb9"},gray:{name:"gray",n:"\u7070\u8272"}},cc._RF.pop()},{"./ColorMatrix":"ColorMatrix"}],shop:[function(e,t){"use strict";cc._RF.push(t,"497beOWR2VLPqWvoMH/WbZU","shop");var i={init:function(){i.listenHide()},listenHide:function(){cc.game.on(cc.game.EVENT_SHOW,function(){if(cc.log("shop.onShow"),i.onlineBoxHideTime){var e=Date.now()-i.onlineBoxHideTime;delete i.onlineBoxHideTime,i.onlineBoxStartTime+=e}}),cc.game.on(cc.game.EVENT_HIDE,function(){cc.log("shop.onHide"),i.onlineBoxHideTime=Date.now(),Date.now()-i.onlineBoxStartTime>3e4&&(cc.log("shop.onHide onlineBoxTime post"),net.postSilent("updateData",{add:{onlineBoxTime:Date.now()-i.onlineBoxStartTime}},function(e,t){e||(i.onlineBoxTime=t.onlineBoxTime||0,i.onlineBoxStartTime=Date.now(),cc.log("shop.onHide onlineBoxTime",i.getOnlineBoxTime()/1e3))}))})},setOnlineData:function(e){i.smallBoxCt=e.smallBoxCt||0,i.smallBoxTime=e.smallBoxTime||0,i.midBoxTime=e.midBoxTime||0,i.bigBoxCt=e.bigBoxCt||0,i.bigBoxKey=e.bigBoxKey||0,i.bigBoxTime=e.bigBoxTime||0,i.midBoxKey=e.midBoxKey||0,i.itemBoxTime=e.itemBoxTime||0,i.itemBoxSeed=e.itemBoxSeed||0,i.itemBoxStatus=e.itemBoxStatus,i.VIPCardStatus=e.VIPCardStatus||0,i.VIPCardTime=e.VIPCardTime||0,null!=e.shopRefreshCt?i.refreshCt=e.shopRefreshCt:i.refreshCt=20,cc.log("shop setOnlineData",e),i.loadOnlineBoxData(e)},loadOnlineBoxData:function(e){i.onlineRefreshTime=(e.onlineRefreshTime||0)+Date.now(),i.onlineBoxIndex=e.onlineBoxIndex||0,i.onlineBoxTime=e.onlineBoxTime||0,i.onlineBoxStartTime=Date.now()},getSmallBoxCount:function(){return i.smallBoxCt},getOnlineBoxTime:function(){return i.onlineBoxTime+Date.now()-i.onlineBoxStartTime},getOnlineRefreshTime:function(){var e=i.onlineRefreshTime-Date.now();return e<=0?0:e},getBigBoxRefreshTime:function(){var e=i.bigBoxTime-sdk.now();return e<=0?0:e},getMidBoxRefreshTime:function(){var e=i.midBoxTime-sdk.now();return e<=0?0:e},getSmallBoxRefreshTime:function(){var e=i.smallBoxTime-sdk.now();return e<=0?0:e},getItemBoxRefreshTime:function(){var e=i.itemBoxTime-sdk.now();return e<=0?0:e},getItemBoxStatus:function(e){return i.itemBoxStatus||(i.itemBoxStatus={}),i.itemBoxStatus[e]},setItemBoxStatus:function(e,t){i.itemBoxStatus||(i.itemBoxStatus={}),i.itemBoxStatus[e]=t},getVIPCardStatus:function(){return i.vipCardStatus},getVIPCardFreeStatus:function(){var e=(new Date).setHours(0,0,0,0)+864e5;return i.VIPCardTime<e?1:0},SetVIPCardFreeTime:function(e){i.VIPCardTime=e}};window.shop=i,cc._RF.pop()},{}],skillEffect:[function(e,t){"use strict";cc._RF.push(t,"21ebca1F5ZDHZ4QQN+kmNI/","skillEffect"),RES.launchSmoke=[{anime:"effect/bomb/smoke1"},"sound/rocket_ult"],EFFECT.launchSmoke=function(e,t,i){this.game.playEffect("sound/rocket_ult");var a=this.createAnimation("effect/bomb/smoke1",{speed:1,repeat:1});return this.layer.addToCamera(a,ZORDER.EFFECT),a.setPosition(e,t),a.setAnchorPoint(.5,0),a.angle=i,a.scale=1.2*ANIME_SCALE,a},RES.launchBomb=[{anime:"effect/explosion/boom3"},"sound/explosive"],EFFECT.launchBomb=function(e,t){this.game.playEffect("sound/explosive",null,2);var i=this.createAnimation("effect/explosion/boom3",{speed:2,repeat:1});return this.layer.addToCamera(i,ZORDER.EFFECT),i.setPosition(e,t),i.setAnchorPoint(.5,.1),i.scale=2*ANIME_SCALE,i},EFFECT.launchSmokeAvatar=function(e,t,i){this.game.playEffect("sound/rocket_ult");var a=this.createAnimation("effect/bomb/smoke1",{speed:1,repeat:1});this.layer.addToCamera(a,ZORDER.EFFECT);var n=e.getPosition();return a.setPosition(n.x+t,n.y+i),a.setAnchorPoint(.5,0),a.angle=0,a.scale=1.2*ANIME_SCALE,a},cc._RF.pop()},{}],soldior:[function(e,t){"use strict";var i;cc._RF.push(t,"5f70bTyJd9OE7GXryzqFnrU","soldior"),e("./define");var a=e("../components/visual/ArmatureAvatar"),n=e("../entities/projectiles/BallBulletSprite"),o=e("../entities/projectiles/Bomb"),r=(e("../components/visual/Avatar"),e("../ai/behaviors/combat/AISoldier")),s=e("./Exploder"),c=e("../entities/projectiles/PowerBullet");BULLET_DEFINE[E_SOLDIOR]=[{name:"\u6b65\u67aa",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:250,spdFluc:.2,distance:600}],ENTITY[E_SOLDIOR]={id:E_SOLDIOR,name:"\u5c0f\u51751",avatar:{ctor:a,animeName:"bubing2",anime:"mob/shouren",s:.9,moveSpd:50,dy:-5},radius:30,hitRadius:35,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE[E_SOLDIOR],bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:.9,x:30,blt:1},{t:1,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:r,attackRange:400,safeRange:[100,150],runaway:1}},RES.E_SOLDIOR=[{anime:"mob/shouren"}],BULLET_DEFINE.frogman=[{name:"\u86d9\u4eba",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:30,spd:250,spdFluc:.2,distance:600}],ENTITY.frogman={id:"frogman",name:"\u86d9\u4eba",avatar:{ctor:a,animeName:"waren",anime:"mob/shouren",s:.9,moveSpd:50},editor:1,radius:20,hitRadius:35,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.frogman,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:.9,x:30,blt:1},{t:1,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:e("../ai/units/AIFrogman"),attackRange:700,safeRange:[100,150],runaway:1}},BULLET_DEFINE.grenadier=[{name:"\u624b\u69b4\u5f39",ctor:o,avatar:{ctor:n,frm:"bullet/grenade",sx:.7,sy:.7,noBlend:!0,streakEffect:EFFECT.grenadeBulletStreak},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,hp:10,length:20,radius:20,hitRadius:60,n:1,wd:0,d:0,spd:460,spdFluc:0,gravity:-400,distance:13450,disExtra:100}],ENTITY.grenadier={id:"grenadier",name:"\u624b\u69b4\u5f39\u5175",editor:1,climb:1,avatar:{ctor:a,animeName:"zhihuiguan",anime:"mob/shouren",s:.9,moveSpd:50},radius:20,hitRadius:35,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.grenadier,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:1.1},{t:.3,x:50,y:0,blt:1},{t:2,ani:0}],pilot:{ctor:r,attackRange:650,seekRange:650,seekWidth:400,safeRange:[100,150],defaultDeg:100,runaway:1}},RES.grenadier=[{anime:"mob/shouren"}],BULLET_DEFINE.rocketman=[{name:"\u706b\u7bad\u7b52\u5175",ctor:o,avatar:{ctor:n,frm:"bullet/rocketman/blt",sx:1,sy:1,noBlend:!0,streakEffect:EFFECT.missileBulletStreak},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.bombs},kb:.3,hp:10,length:20,radius:1,hitRadius:60,n:1,wd:0,d:0,spd:460,spdFluc:0,gravity:0,distance:13450,disExtra:100}],ENTITY.rocketman={id:"rocketman",name:"\u706b\u7bad\u7b52\u5175",editor:1,climb:1,avatar:{ctor:a,animeName:"bubing3",anime:"mob/shouren",s:.9,moveSpd:50},radius:25,hitRadius:35,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.rocketman,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:1.1,ani:0},{t:.2,ani:1},{t:.4,x:50,y:0,blt:1},{t:2,ani:0}],pilot:{ctor:r,attackRange:950,seekRange:950,seekWidth:950,safeRange:[100,150],defaultDeg:100,runaway:1}},RES.rocketman=[{anime:"mob/shouren"}],ENTITY[E_EXPLODER]={id:E_EXPLODER,name:"\u81ea\u7206",ctor:s,avatar:{ctor:a,animeName:"shouren",anime:"mob/shouren",s:.9,moveSpd:100},deathEffect:EFFECT.deathHide,radius:20,hitRadius:35,moveSpd:150,weight:50,hp:60,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,crit:0,bltDmg:5,bltMax:6,bltReload:.9,bomb:{r1:200,r0:50,dmg1:10,dmg0:20,kb:100,effect:EFFECT.bomb4},pilot:{ctor:e("../ai/core/AICommon")}},RES[E_EXPLODER]=[{anime:"mob/shouren"}],ENTITY.feibing={id:"feibing",name:"\u98de\u5175",avatar:{ctor:a,animeName:"feibing",anime:"mob/shouren",s:.9,moveSpd:50},shapes:[{x:0,y:100,radius:40,hitRadius:40}],deathEffect:EFFECT.balloonDeath,radius:20,hitRadius:35,moveSpd:50,weight:50,hp:40,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.human,crit:0,bltDmg:5,blt:BULLET_DEFINE[E_SOLDIOR],bltMax:6,bltReload:.9,attackSequence:[{t:.1,x:20,blt:1},{t:.5}],pilot:{ctor:e("../ai/units/AIFlySoldier"),attackRange:500},deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]]},RES.feibing=[{anime:"mob/shouren"}],ENTITY.qiqiu={id:"qiqiu",name:"\u6c14\u7403",avatar:{gunBone:"wepon",animeName:"qiqiubing",standAnime:"walk",anime:"mob/shouren",s:.9,moveSpd:50},fixedFlipX:1,shapes:[{x:0,y:85,radius:40,hitRadius:40}],deathEffect:EFFECT.balloonDeath,radius:20,hitRadius:35,moveSpd:50,weight:50,hp:40,armor:1e3,mobType:MOB_TYPE.air,armorType:ARMOR_TYPE.human,crit:0,bltDmg:123,blt:BULLET_DEFINE[E_SOLDIOR],bltMax:6,bltReload:.9,attackSequence:[{t:.1,x:20,blt:1},{t:1,ani:0}],pilot:{ctor:e("../ai/units/AIFlySoldier"),attackRange:500},deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]]},RES.qiqiu=[{anime:"mob/shouren"}],BULLET_DEFINE.fireBat=[{name:"\u706b\u7130",ctor:c,noWall:!0,avatar:{ctor:n,sx:.4,sy:.2,sx1:1.5,sy1:2,st:.5,hitEffect:EFFECT.flameHit,a:cc.v2(.7,.5),anime:{repeat:1,alive:1,atlas:"avatar/flamethrower/fireball1",start:1,end:8,speed:1.8},z:ZORDER.MOB-1},kb:0,dmgType:DMG_TYPE.fire,length:22,radius:20,n:1,wd:0,d:5,spd:950,gravity:300,damp:.87,distance:1600,disExtra:10}],ENTITY.fireBat={id:"fireBat",name:"\u55b7\u706b\u5175",avatar:{ctor:a,animeName:"penhuobing",anime:"mob/penhuobing",s:.9,moveSpd:50,dy:-5},radius:33,hitRadius:44,moveSpd:50,weight:50,hp:100,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.fireBat,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:.1,x:30,blt:1},{t:1,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:r,attackRange:350,safeRange:[200,300]}},RES.fireBat=[{anime:"mob/penhuobing"}],BULLET_DEFINE.machinegun=[{name:"\u654c\u4eba\u673a\u67aa",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:550,spdFluc:.2,distance:500}],ENTITY.machinegun={id:"machinegun",name:"\u5c0f\u51751",avatar:{gunBone:"gun",animeName:"jiqiangbing",anime:"mob/\u673a\u67aa\u624b",s:.9,moveSpd:50,dy:-3,flipX:-1},radius:30,hitRadius:35,height:5,moveSpd:50,weight:50,hp:40,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.machinegun,bltMax:1,bltReload:1.9,deathEffect:EFFECT.deathHide,attackCenter:cc.v2(0,20),attackSequence:[{t:.2,x:40,y:0,deg:2,blt:1},{t:.2,x:40,deg:-2,blt:1},{t:.2,x:40,deg:2,blt:1},{t:.2,x:40,deg:-2,blt:1},{t:.5,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{attackTime:1,attackDeg:180,bonusAttackDeg:1,attackRange:620}},RES.machinegun=[{anime:"mob/\u673a\u67aa\u624b"}],BULLET_DEFINE.sniper=[{name:"\u654c\u4eba\u673a\u67aa",avatar:{sx:.3,sy:.3,sx1:.6,sy1:.6,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:750,spdFluc:.2,distance:600}],ENTITY.sniper={id:"sniper",name:"\u72d9\u51fb\u624b",avatar:{gunBone:"wepon",animeName:"jujishou",anime:"mob/shouren",s:.9,moveSpd:50},radius:20,hitRadius:35,moveSpd:50,weight:50,hp:80,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:15,blt:BULLET_DEFINE.sniper,bltMax:2,bltReload:1.9,deathEffect:EFFECT.humanDeath,attackSequence:[{t:2,x:50,ani:0},{t:.2,x:50,ani:1},{t:1,x:50,blt:1,ani:0}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{attackTime:1,attackDeg:180,attackRange:800}},RES.sniper=[{anime:"mob/shouren"}],BULLET_DEFINE.shield=[{name:"\u76fe\u5175",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:250,spdFluc:.2,distance:600}],ENTITY.shield={id:"shield",name:"\u76fe\u5175",avatar:{ctor:a,animeName:"dunbing",anime:"mob/dunbing",s:.9,moveSpd:50,deathFireScale:1.3},radius:44,hitRadius:55,moveSpd:50,weight:50,hp:550,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,machine:1,blt:BULLET_DEFINE.sniper,bltMax:2,bltReload:1.9,deathEffect:EFFECT.bigHumanDeath,attackSequence:[{t:1},{t:.1,x:40,blt:1},{t:.1,x:40,blt:1},{t:.1,x:40,blt:1},{t:.2}],deathSound:[["sound/mob/dead/1",.5],["sound/mob/dead/2",.5],["sound/mob/dead/3",.5],["sound/mob/dead/4",.5]],pilot:{ctor:r,attackRange:400,safeRange:[200,350]}},RES.shield=[{anime:"mob/dunbing"}],BULLET_DEFINE.shenghuabing=[{name:"\u751f\u5316\u5f39",ctor:o,avatar:{ctor:n,sx:2,sy:2,noBlend:!0,streakEffect:EFFECT.slimeStreak,anime:{repeat:-1,speed:3,atlas:"bullet/slime/shuiqiu"}},bomb:{r1:50,r0:50,dmg1:20,dmg0:20,kb:300,effect:EFFECT.slimeBomb,exploFunc:function(e){e==BULLET_FADE_TYPE.GROUND&&this.game.levelMgr.createObject(ENTITY.slime,{x:this.x,y:this.y,team:this.obj.team,ai:1,atk0:this.obj.config.atk0,hp0:this.obj.config.hp0})}},kb:.3,hp:110,length:20,radius:20,hitRadius:60,n:1,wd:0,d:7,spd:760,spdFluc:0,gravity:-700,distance:13450,disExtra:100}],ENTITY.shenghuabing=((i={id:"shenghuabing",name:"\u751f\u5316\u5175",editor:1,climb:1,avatar:{ctor:a,animeName:"shenghuabing",anime:"mob/shenghuabing",s:.7,moveSpd:50,walkAnime:"walk"},radius:30,hitRadius:35,moveSpd:50,weight:50,hp:500,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.human,armor:1e3,crit:0,bltDmg:5,blt:BULLET_DEFINE.shenghuabing,bltMax:6,bltReload:.9,deathEffect:EFFECT.humanDeath}).editor=1,i.attackSequence=[{t:.54},{t:.04,x:50,y:0,blt:1,deg:-12},{t:.96}],i.pilot={ctor:r,attackRange:1222,seekRange:1222,bonusAttackDeg:71,safeRange:[100,150],defaultDeg:100,runaway:1},i),RES.shenghuabing=[{anime:"mob/shenghuabing"}],cc._RF.pop()},{"../ai/behaviors/combat/AISoldier":"AISoldier","../ai/core/AICommon":"AICommon","../ai/units/AIFlySoldier":"AIFlySoldier","../ai/units/AIFrogman":"AIFrogman","../components/visual/ArmatureAvatar":"ArmatureAvatar","../components/visual/Avatar":"Avatar","../entities/projectiles/BallBulletSprite":"BallBulletSprite","../entities/projectiles/Bomb":"Bomb","../entities/projectiles/PowerBullet":"PowerBullet","./Exploder":"Exploder","./define":"define"}],storage:[function(e,t){"use strict";cc._RF.push(t,"89e59wm9+ZOZ7qCp6zBkIxE","storage"),window.storage,window.storage={exists:function(e){return cc.sys.localStorage.getItem(e)},remove:function(e){return cc.sys.localStorage.removeItem(e)},get:function(e){return cc.sys.localStorage.getItem(e)},getInt:function(e){var t=window.storage.get(e);return kit.isValue(t)&&(t=+t,isNaN(t)),t},set:function(e,t){cc.sys.localStorage.setItem(e,""+t)}},cc._RF.pop()},{}],tank:[function(e,t){"use strict";var i;cc._RF.push(t,"ac70ble+SZOlLdsimowf9JX","tank"),e("../../scripts/define");var a=e("../../components/visual/ArmatureAvatar"),n=e("../projectiles/BallBulletSprite"),o=e("../projectiles/Bomb"),r=e("../characters/HumanAvatar"),s=e("./Vehicle");BULLET_DEFINE.tank=[{name:"\u70ae\u5f39",ctor:o,avatar:{ctor:n,frm:"avatar/1",sx:.5,sy:.5,a:cc.v2(.5,.6),noBlend:!0,streakEffect:EFFECT.tankBulletStreak},bomb:{r1:100,r0:50,dmg1:40,dmg0:40,kb:300,effect:EFFECT.bombs},kb:.3,hp:30,length:20,radius:40,n:1,wd:0,d:0,spd:360,spdFluc:0,gravity:-200,distance:3450,disExtra:100}],ENTITY.tank={id:"tank",ctor:s,wheels:[-45,45],name:"\u5766\u514b",avatar:{ctor:r,gunBone:"body",gunDeg:-20,animeName:"tank",anime:"mob/tank",s:.6,moveSpd:150},attackAngle:[0,50],machine:1,fixedFlipX:1,radius:60,moveSpd:50,hp:1800,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.tank,bltMax:1,bltReload:1.5,deathEffect:EFFECT.tankDeath,attackCenter:cc.v2(0,30),attackSequence:[{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:2,ani:0}],pilot:{ctor:e("../../ai/behaviors/combat/AITank"),attackRange:650,bonusAttackDeg:30,safeRange:[400,450],moveAttackMinRange:550,moveAttack:1}};var c=e("../../scripts/Knife");BULLET_DEFINE.tank2=[(i={name:"\u70ae\u5f39",hitEffect:EFFECT.meleeHit,shot:c.shot,radius:100,avatar:{sx:.5,sy:.5,a:cc.v2(.5,.6),noBlend:!0,hitEffect:EFFECT.meleeHit},bomb:{r1:100,r0:50,dmg1:11,dmg0:11,kb:300},noContact:1,kb:.3,hp:30,length:20},i.radius=40,i.n=1,i.wd=0,i.d=0,i.spd=1,i.spdFluc=0,i.gravity=0,i.distance=1,i.disExtra=100,i)],ENTITY.tank2={id:"tank2",ctor:e("./Tank2"),wheels:[-45,45],name:"\u51b2\u649e\u5766\u514b",avatar:{ctor:r,animeName:"tank2",anime:"mob/tank",s:.6,moveSpd:150},machine:1,fixedFlipX:1,radius:60,moveSpd:30,hp:1300,out:500,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.tank2,bltMax:1,bltReload:.1,deathEffect:EFFECT.tankDeath,attackCenter:cc.v2(100,0),attackSequence:[{t:.25,ani:0,blt:1,x:100}],pilot:{ctor:e("../../ai/behaviors/combat/AITank2"),attackRange:650,bonusAttackDeg:30,moveAttack:1}},BULLET_DEFINE.moto=[{name:"\u654c\u4eba\u673a\u67aa",avatar:{sx:.3,sy:.3,sx1:.3,sy1:.3,st:.2,anime:{atlas:"bullet/enemy/bullet3",speed:10,repeat:-1},noBlend:1,hitEffect:EFFECT.yellowHit},length:20,kb:.02,n:1,wd:0,d:0,spd:250,spdFluc:.2,distance:600}],ENTITY.moto={id:"moto",name:"\u6469\u6258\u8f66",avatar:{ctor:e("../characters/HumanAvatar"),animeName:"moto",anime:"mob/moto",s:.8,moveSpd:50,dy:-5,flipX:-1},fixedFlipX:1,machine:1,radius:60,hitRadius:60,moveSpd:40,weight:50,hp:500,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.moto,bltMax:1,bltReload:0,deathEffect:EFFECT.explosionDeath,attackCenter:cc.v2(100,20),attackSequence:[{t:.7,x:0,y:0,blt:1,sound:"sound/machine_gun_2",effect:EFFECT.MachineGunFireLight},{t:.5}],pilot:{ctor:e("../../ai/behaviors/movement/AIChaseCar"),seekRange:650}},ENTITY.robot={id:"robot",name:"\u53cc\u8db3\u673a\u5668\u4eba",avatar:{ctor:a,animeName:"liangjiaoguai",anime:"mob/liangjiaoguai",moveSpd:150},slots:[{x:0,y:45,w:120,h:40}],moveScale:1/150,moveSequence:[{x:0,y:0,t:.25},{x:0,y:20,t:.25},{x:0,y:0,t:.25},{x:0,y:20,t:.25}],machine:1,height:120,radius:80,hitRadius:80,moveSpd:50,weight:50,hp:1500,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathEffect:EFFECT.explosionDeath,pilot:{moveTime:1/0,moveX:-1}},ENTITY.bossrobot={id:"bossrobot",name:"\u53cc\u8db3\u673a\u5668\u4ebaBOSS",avatar:{ctor:a,animeName:"liangjiaoguai",anime:"mob/liangjiaoguai",moveSpd:150,s:2},slots:[{x:0,y:90,w:240,h:40}],boss:1,moveScale:1/150,moveSequence:[{x:0,y:0,t:.25},{x:0,y:20,t:.25},{x:0,y:0,t:.25},{x:0,y:20,t:.25}],machine:1,height:240,radius:160,hitRadius:160,moveSpd:50,weight:50,hp:2e4,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,deathEffect:EFFECT.bossDeath,pilot:{ctor:e("../../ai/behaviors/combat/AITank"),attackRange:750,bonusAttackDeg:75,safeRange:[600,750],moveAttack:1,hitRunTime:200}},BULLET_DEFINE.bosstank=[{name:"\u70ae\u5f39",ctor:o,avatar:{ctor:n,frm:"avatar/1",sx:.7,sy:.7,a:cc.v2(.5,.6),noBlend:!0,streakEffect:EFFECT.tankBulletStreak},bomb:{r1:100,r0:50,dmg1:40,dmg0:40,kb:300,effect:EFFECT.bombs},kb:.3,hp:150,length:20,radius:66,n:1,wd:0,d:10,spd:580,spdFluc:0,gravity:-300,distance:3450,disExtra:100}],ENTITY.bosstank={id:"bosstank",ctor:s,wheels:[-45,45],name:"boss\u5766\u514b",avatar:{ctor:r,gunBone:"body",gunDeg:-20,animeName:"tank",anime:"mob/tank",s:1.2,moveSpd:150},attackAngle:[0,100],machine:1,fixedFlipX:1,radius:120,moveSpd:60,hp:2e4,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.bosstank,bltMax:1,bltReload:1.5,deathEffect:EFFECT.bossDeath,boss:1,attackCenter:cc.v2(0,60),attackSequence:[{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:2,ani:0}],pilot:{ctor:e("../../ai/behaviors/combat/AITank"),attackRange:750,bonusAttackDeg:75,safeRange:[600,650],moveAttackMinRange:550,moveAttack:1,hitRunTime:200}},ENTITY.bosstank222={id:"bosstank222",ctor:s,wheels:[-45,45],name:"boss\u5766\u514b",avatar:{ctor:r,gunBone:"body",gunDeg:-20,animeName:"tank",anime:"mob/tank",s:1.2,moveSpd:150},attackAngle:[0,100],machine:1,fixedFlipX:1,radius:120,moveSpd:60,hp:2e4,editor:1,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.bosstank,bltMax:1,bltReload:1,deathEffect:EFFECT.bossDeath,boss:1,attackCenter:cc.v2(0,60),attackSequence:[{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:2,ani:0}],pilot:{ctor:e("../../ai/behaviors/combat/AITank"),attackRange:750,bonusAttackDeg:75,safeRange:[500,650],moveAttackMinRange:550,moveAttack:1,hitRunTime:200}};var l=e("../projectiles/Missile"),d=e("../projectiles/MissileSprite");BULLET_DEFINE.bosstank2=[{name:"bosstank2",ctor:l,avatar:{ctor:d,frm:"avatar/\u5bfc\u5f39",sx:.6,sy:.6,a:cc.v2(.5,.5),noBlend:1,streakEffect:EFFECT.missileBulletStreak},bomb:{r1:120,r0:50,dmg1:10,dmg0:10,kb:300,effect:EFFECT.bombs},armorType:ARMOR_TYPE.bullet,rttSpd:120,rttSpdTime:1,kb:.3,length:20,radius:20,hitRadius:50,n:1,wd:0,d:90,spd:600,spdFluc:0,distance:3450,disExtra:100}],ENTITY.bosstank2={id:"bosstank2",ctor:s,wheels:[-45,45],name:"boss\u5766\u514b2",avatar:{ctor:r,gunBone:"body",gunDeg:-20,animeName:"tank",anime:"mob/tank",s:1.2,moveSpd:150},out:2e3,attackAngle:[0,100],machine:1,fixedFlipX:1,radius:120,moveSpd:60,hp:1e4,armor:1e3,mobType:MOB_TYPE.ground,armorType:ARMOR_TYPE.machine,crit:0,bltDmg:5,blt:BULLET_DEFINE.bosstank2,bltMax:1,bltReload:1.5,deathEffect:EFFECT.bossDeath,boss:1,attackCenter:cc.v2(0,60),attackSequence:[{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:.25,x:50,blt:1,ani:1,sound:"sound/cannon_fire",effect:EFFECT.CannonFireLight},{t:2,ani:0}],pilot:{ctor:e("../../ai/behaviors/combat/AITank"),attackRange:850,bonusAttackDeg:75,safeRange:[600,650],moveAttackMinRange:550,moveAttack:1,hitRunTime:200,seekRange:1e3}},cc._RF.pop()},{"../../ai/behaviors/combat/AITank":"AITank","../../ai/behaviors/combat/AITank2":"AITank2","../../ai/behaviors/movement/AIChaseCar":"AIChaseCar","../../components/visual/ArmatureAvatar":"ArmatureAvatar","../../scripts/Knife":"Knife","../../scripts/define":"define","../characters/HumanAvatar":"HumanAvatar","../projectiles/BallBulletSprite":"BallBulletSprite","../projectiles/Bomb":"Bomb","../projectiles/Missile":"Missile","../projectiles/MissileSprite":"MissileSprite","./Tank2":"Tank2","./Vehicle":"Vehicle"}],task:[function(e,t){"use strict";cc._RF.push(t,"f8eb0H17TRKhIqC0bv+45VD","task"),window.STAGE_TASK=[],window.DAILY_TASK=[[{item:{i:DIAMOND,n:20},info:"Watch {n} Video Ads",name:"Video",num:2,getNum:function(){return i.getDailyTaskCt("videoCount")},goTo:function(){menuManager.run("main",{hot:"shop"})}}],[{item:{i:DIAMOND,n:20},info:"Kill {n} Enemy Troops",name:"Kill Enemy",num:100,getNum:function(){return i.getDailyTaskCt("humanKilled")},goTo:function(){menuManager.run("main",{hot:"map"})}},{item:{i:DIAMOND,n:20},info:"Destroy {n} Machines",name:"Kill Enemy",num:10,getNum:function(){return i.getDailyTaskCt("machineKilled")},goTo:function(){menuManager.run("main",{hot:"map"})}}],[{item:{i:DIAMOND,n:20},info:"Upgrade Weapons {n} Times",name:"Upgrade",num:2,getNum:function(){return i.getDailyTaskCt("weaponUpgrade")},goTo:function(){menuManager.run("main",{hot:"map"})}},{item:{i:DIAMOND,n:20},info:"Craft {n} Parts",name:"Upgrade",num:2,getNum:function(){return i.getDailyTaskCt("partForge")},goTo:function(){menuManager.run("main",{hot:"map"})}}],[{item:{i:DIAMOND,n:20},info:"Challenge Infinite Train {n} Times",name:"Challenge",num:1,isOpened:function(){return pc.isChapterDone(2)},getNum:function(){return i.getDailyTaskCt("trainStart")},goTo:function(){menuManager.run("train")}},{item:{i:DIAMOND,n:20},info:"Upgrade Tank {n} Times",name:"Upgrade",num:3,isOpened:function(){var e=0,t=["atk","hp","skill"],i=excel.read("vehicle_list");for(var a in i){var n=i[a].id,o=pc.getVehicle(n),r=pc.getVehicleData(n),s=excel.read("vehicle_"+r.attr).length-1;for(var c in t){var l=t[c],d=o&&o[l]||0;pc.isVehicleLinked(n)&&(d=pc.getMaxLevel(l)),e+=s-d}}return e>=3},getNum:function(){return i.getDailyTaskCt("vehicleUpgrade")},goTo:function(){menuManager.run("main",{hot:"garage"})}},{item:{i:DIAMOND,n:20},info:"Upgrade Talent {n} Times",name:"Upgrade",num:3,isOpened:function(){var e=0,t=excel.read("talent_list");for(var i in t)e+=5-pc.getTalentLevel(i);return e>=3},getNum:function(){return i.getDailyTaskCt("talentUpgrade")},goTo:function(){menuManager.run("main",{hot:"talent"})}}],[{item:{i:DIAMOND,n:20},info:"Use {n} Gold",name:"Shop",num:1e3,getNum:function(){return i.getDailyTaskCt("goldCost")},goTo:function(){menuManager.run("main",{hot:"map"})}},{item:{i:DIAMOND,n:20},info:"Use {n} Diamonds",name:"Shop",num:200,getNum:function(){return i.getDailyTaskCt("diamondCost")},goTo:function(){menuManager.run("main",{hot:"shop"})}}]],window.OFFLINE_TASK=[{name:"Daily Patrol",time:30,n:1,max:4},{name:"Work Hard",time:900,n:2,max:4},{name:"Flow Immersion",time:14400,n:3,max:4}];var i={init:function(){i.saveData={}},isOfflineTaskRed:function(){for(var e in OFFLINE_TASK){var t=OFFLINE_TASK[e],a=i.getOfflineTaskData(e).ct,n=i.getOfflineTaskStatus(e);if(a<t.max&&0==n)return!0;if(1==n&&i.getOfflineTaskTime(e)<=0)return!0}},isSignRed:function(){return user.signIndex%7+user.signCount<7&&user.signCount<1},isStageTaskRed:function(){for(var e in STAGE_TASK){var t=STAGE_TASK[e],a=adventure.chapterToStage(t.chapter-1,t.map-1);if(pc.stageIndex>a&&!i.getStageTaskStatus(a))return!0}},getDailTaskList:function(){var e=i.dailyTaskSeed;if(!i.dailyTask||i.dailyTask.seed!=e){var t=[],a=kit.core(e);for(var n in DAILY_TASK){var o=[];for(var r in DAILY_TASK[n]){var s=DAILY_TASK[n][r];s.isOpened&&!s.isOpened()||o.push(s)}o.length>0?t.push(a.rndOne(o)):t.push(DAILY_TASK[n][0])}i.dailyTask={list:t,seed:e}}return i.dailyTask.list},isDalyTaskRed:function(){var e=i.getDailTaskList(),t=i.getDailyTaskSum();for(var a in e){var n=e[a],o=n.getNum()>=n.num,r=i.getDailyTaskStatus(a);if(o){if(!r)return!0;t--}}if(0==t)return!i.getDailyTaskStatus("sum")},setOnlineData:function(e){for(var t in i.stageTaskList=e.stageTaskList||[],i.chapterSweepList=e.chapterSweepList||[],i.chapterSweepList){var a=i.chapterSweepList[t];a.time=(a.time||0)+Date.now()}i.loadDailyTaskData(e),i.loadOfflineTaskData(e)},isChapterSweepRed:function(e){if(i.isChapterSweepOpened(e)){var t=i.getChapterSweepData(e);if(0==t.status){var a=CHAPTER_DEFINE_ARRAY[e].energy;return money.had(SWEEP_TICKET,1)||money.had(ENERGY,a)}return t.time-Date.now()<=0||void 0}},isChapterSweepOpened:function(e){return pc.isChapterDone(e)},getChapterSweepData:function(e){var t=i.chapterSweepList;for(var a in t)if(t[a].index==e)return t[a];var n={index:e,status:0,time:0};return t.push(n),n},setChapterSweepData:function(e,t){var a=i.getChapterSweepData(e);void 0!==t.time&&(a.time=(t.time||0)+Date.now()),void 0!==t.status&&(a.status=t.status||0)},getChapterSweepTime:function(e){var t=i.getChapterSweepData(e).time-Date.now();return t<=0?0:t},getChapterSweepStatus:function(e){return i.getChapterSweepData(e).status},loadDailyTaskData:function(e){i.dailyTaskSeed=e.dailyTaskSeed||0,i.dailyTaskRefreshTime=(e.dailyTaskRefreshTime||0)+Date.now(),i.dailyTaskStatus=e.dailyTaskStatus||{},i.dailyTaskCt=e.dailyTaskCt||{}},loadOfflineTaskData:function(e){i.offlineTaskRefreshTime=(e.offlineTaskRefreshTime||0)+Date.now(),i.offlineTaskData=e.offlineTasks||{},i.offlineTasks={}},getOfflineTaskData:function(e){var t=i.offlineTasks[e];if(!t){var a=i.offlineTaskData[e];t=i.offlineTasks[e]={type:0,seed:0,time:Date.now(),status:0,ct:0},a&&(t.type=a.type||0,t.seed=a.seed||0,t.time=(a.time||0)+Date.now(),t.status=a.status||0,t.ct=a.ct||0)}return t},updateOfflineTaskData:function(e,t){var a=i.offlineTasks[e];t&&(i.offlineTaskData[e]=t,a&&(a.type=t.type||0,a.seed=t.seed||0,a.time=(t.time||0)+Date.now(),a.status=t.status||0,a.ct=t.ct||0))},getOfflineTaskRefreshTime:function(){var e=i.offlineTaskRefreshTime-Date.now();return e<=0?0:e},setOfflineTaskStatus:function(e,t){i.getOfflineTaskData(e).status=t},getOfflineTaskHero:function(e){var t=pc.getHeroList()[i.getOfflineTaskData(e).type||0];return t&&t.id},rndOfflineTaskHeroIndex:function(e){var t=pc.getHeroList(),a=[];for(var n in t)a.push(+n);for(var o in i.offlineTasks)if(e!=o&&(0==i.getOfflineTaskStatus(o)||i.getOfflineTaskTime(o)>0)){var r=i.getOfflineTaskData(o).type,s=a.indexOf(r);s>=0&&a.splice(s,1)}var c=kit.rndOne(a);return cc.log("rndOfflineTaskHeroIndex",c),c},getOfflineTaskStatus:function(e){return i.getOfflineTaskData(e).status||0},getOfflineTaskTime:function(e){var t=i.getOfflineTaskData(e).time-Date.now();return t<=0?0:t},getDailyTaskSum:function(){for(var e=0,t=0,a=0;a<5;a++)t++,i.dailyTaskStatus[a]&&(e+=1);return{sum:e,max:t}},getDailyTaskStatus:function(e){return i.dailyTaskStatus[e]||0},setDailyTaskStatus:function(e,t){i.dailyTaskStatus[e]=t},addDailyTaskCt:function(e,t){void 0===t&&(t=1),i.dailyTaskCt[e]=i.getDailyTaskCt(e)+t,net.updateLazyData({set:{dailyTaskCt:i.dailyTaskCt}})},getDailyTaskCt:function(e){return i.dailyTaskCt[e]||0},getDailyTaskRefreshTime:function(){var e=i.dailyTaskRefreshTime-Date.now();return e<=0?0:e},getStageTaskStatus:function(e){for(var t in i.stageTaskList){var a=i.stageTaskList[t];if(a.index==e)return a.status}return 0},setStageTaskStatus:function(e,t){for(var a in i.stageTaskList){var n=i.stageTaskList[a];if(n.index==e)return void(n.status=t)}i.stageTaskList.push({index:e,status:t})}};window.task=i,cc._RF.pop()},{}],teamEffect:[function(e,t){"use strict";cc._RF.push(t,"17654/EVGJLKJ0qnTX6HZuP","teamEffect");var i=[cc.color(0,170,255),cc.color(255,0,0),cc.color(255,255,0),cc.color(255,0,255),cc.color(0,255,255),cc.color(0,255,0)];EFFECT.teamHpColor=function(e,t,a){return e==t?a?cc.color(0,255,50):i[0]:e<t?i[e+1]:i[e]},cc._RF.pop()},{}],temp:[function(e,t){"use strict";cc._RF.push(t,"07096qFuZxAkZWVwggdzorR","temp"),cc._RF.pop()},{}],train:[function(e,t){"use strict";cc._RF.push(t,"9ac65gyP5NIVL7lIhInOcAe","train");var i=e("../../Plugins/ADManager"),a=e("../../Plugins/firebase/FirebaseTracking"),n=e("../../Plugins/SDKManager");window.TRAIN_MAP_POOL={1:[{map:"train/301",enemy:"e7"},{map:"train/306",enemy:"grenadier"},{map:"train/311",enemy:"machinegun"},{map:"train/316",enemy:"rocketman"},{map:"train/321",enemy:"shield"},{map:"train/326",enemy:"tank"},{map:"train/331",enemy:"r0"},{map:"train/336",enemy:"mine"},{map:"train/341",enemy:"sniper"},{map:"train/346",enemy:"e4"},{map:"train/351",enemy:"enemy_gun"},{map:"train/356",enemy:"frogman"},{map:"train/366",enemy:"moto"},{map:"train/371",enemy:"fireBat"},{map:"train/401",enemy:"e7"},{map:"train/407",enemy:"machinegun"}],2:[{map:"train/302",enemy:"e7"},{map:"train/307",enemy:"grenadier"},{map:"train/312",enemy:"machinegun"},{map:"train/317",enemy:"rocketman"},{map:"train/322",enemy:"shield"},{map:"train/327",enemy:"tank"},{map:"train/332",enemy:"r0"},{map:"train/337",enemy:"mine"},{map:"train/342",enemy:"sniper"},{map:"train/347",enemy:"e4"},{map:"train/357",enemy:"frogman"},{map:"train/367",enemy:"moto"},{map:"train/372",enemy:"fireBat"},{map:"train/362",enemy:"tank2"},{map:"train/419",enemy:"tank"},{map:"train/402",enemy:"e7"},{map:"train/425",enemy:"slime"},{map:"train/431",enemy:"slime"}],3:[{map:"train/303",enemy:"e7"},{map:"train/308",enemy:"grenadier"},{map:"train/313",enemy:"machinegun"},{map:"train/318",enemy:"rocketman"},{map:"train/323",enemy:"shield"},{map:"train/328",enemy:"tank"},{map:"train/333",enemy:"r0"},{map:"train/338",enemy:"mine"},{map:"train/348",enemy:"e4"},{map:"train/358",enemy:"frogman"},{map:"train/368",enemy:"moto"},{map:"train/373",enemy:"fireBat"},{map:"train/363",enemy:"tank2"},{map:"train/403",enemy:"e7"},{map:"train/408",enemy:"machinegun"},{map:"train/426",enemy:"shenghuabing"},{map:"train/432",enemy:"shenghuabing"}],4:[{map:"train/319",enemy:"rocketman"},{map:"train/324",enemy:"shield"},{map:"train/329",enemy:"tank"},{map:"train/334",enemy:"r0"},{map:"train/364",enemy:"tank2"},{map:"train/427",enemy:"shenghuabing"},{map:"train/433",enemy:"shenghuabing"}],5:[{map:"train/376",enemy:"helicopter_boss"},{map:"train/378",enemy:"boss_0f"},{map:"train/377",enemy:"bosstank"},{map:"train/379",enemy:"boss_spider"}]};var o=function(e){for(var t in ItemDefine)if(ItemDefine[t].gameId==e)return t},r={isTrainRed:function(){if(r.load(),!r.saveData)return!0;if(pc.trainRestartCt>0)return!0;var e=r.getTrainData();return!r.saveData.death&&pc.trainTowerIndex<=e.length||void 0},generate:function(){var e=pc.trainCount+1;1==e&&0==pc.trainSeed?e=0:e>3&&(e=3);var t=excel.read("train_"+e),i=kit.core(pc.trainSeed),a=[],n=0,o={};for(var r in TRAIN_MAP_POOL)for(var s in o[r]=[],TRAIN_MAP_POOL[r])o[r].push(TRAIN_MAP_POOL[r][s]);for(var c in t){var l=t[c],d=+l.tower,h=a[d];if(!h){var u=getRndItem(kit.parse(l.item),i);a[d]=h={floors:[],item:u,towerIndex:d}}var p=l.map,f=l.enemy;if(l.pool){var m=o[l.pool];if(m.length>0){var g=i.rndInt(0,m.length-1),v=m.splice(g,1)[0];p=v.map,f=v.enemy}else{var y=i.rndOne(TRAIN_MAP_POOL[l.pool]);p=y.map,f=y.enemy}}var b=h.floors.length;h.floors.push({index:n,towerIndex:d,floorIndex:b,tower:h,data:l,map:p,enemy:f,lvl:l.lvl}),n++}return{trainData:a,trainSeed:pc.trainSeed,trainCount:pc.trainCount}},getTrainData:function(){return this.retainData&&this.retainData.trainCount==pc.trainCount&&this.retainData.trainSeed==pc.trainSeed||(this.retainData=r.generate()),this.retainData.trainData},getFloorData:function(e){var t=r.getTrainData();for(var i in t)for(var a in t[i].floors)if(t[i].floors[a].index==e)return t[i].floors[a]},start:function(){chapter.reset(),this.mapIndex=0;var e=pc.getChooseVehicle(),t=e.id,i=pc.getVehicleData(t),a=i.defaultTower,n=o(a),s=pc.getTeam(),c=[];for(var l in s)c.push(s[l]);chapter.data.tank=[{weapon:n,weaponLvl:1,operator:c.shift()}],chapter.data.bench=c,cc.log("team",s,c);var d=chapter.data.tank,h=[],u=[],p=[];for(var f in c){var m=c[f];p.push(c[f]?{i:m,star:pc.getHero(m).star}:null)}cc.error(p);var g=!1;for(var v in d){var y=d[v];if(y){var b=y.operator;u[v]=b?{i:b,star:pc.getHero(b).star}:null;var k=y.weapon;if(k){var T=ItemDefine[k].gameId,_=null;T&&(_={i:T,hp:1},g||(g=!0,_.m=1)),h[v]=_}}}var w=0,E=0,C=0,S=1,I=1;function A(e){if(e&&e.global){var t=e.global;if(cc.warn("star attr global",t),t.firstGunLevel){var i=+t.firstGunLevel,a=1*Math.pow(4/3,i-1);h[0].atk0=a,h[0].lvl=i,d[0].weaponLvl=i}t.initPart&&(w+=t.initPart),t.initItem&&(E+=t.initItem),t.initWeapon&&(C+=t.initWeapon),t.buyPrice&&(S+=t.buyPrice),t.repairPrice&&(I+=t.repairPrice)}}for(var B=e.star||0,M=0;M<B;M++)A(i.starAttrs[M]);for(var D in u){var x=u[D];if(x)for(var R=x.star||0,N=pc.getHeroData(x.i),F=0;F<R;F++)A(N.starAttrs[F])}for(var L in p){var P=p[L];if(P)for(var O=P.star||0,U=pc.getHeroData(P.i),q=0;q<O;q++)A(U.starAttrs[q])}if(chapter.data.buyPrice=S,chapter.data.repairPrice=I,E>0){var G=[];for(var H in chapter.data.combatItem)G.push(H);for(var j=0;j<E;j++)chapter.data.combatItem[kit.rndOne(G)]++}if(C>0){var Y=[];for(var W in ItemDefine)"weapon"==ItemDefine[W].type&&Y.push(W);for(var V=0;V<C;V++)chapter.data.bag.push({id:kit.rndOne(Y),lvl:1})}if(w>0){var X=[];for(var z in ItemDefine){var K=ItemDefine[z];"equipment"!=K.type||K.lvl&&1!=K.lvl||X.push(z)}for(var J=[],Z=0;Z<w;Z++)J.push(kit.rndOne(X));h[0].equipment=J,d[0].equipment=J}var Q={vid:t,star:e.star,attr:pc.getVehicleAttr(t),hp:1,towers:h,heroes:u,bench:p},$=r.getFloorData(this.mapIndex);chapter.add(SILVER,+$.data.money),this.save(Q,this.mapIndex)},save:function(e,t){var i=0,a=0;this.saveData&&(i=this.saveData.death,a=this.saveData.revive);var n={version:0,trainCount:pc.trainCount,trainSeed:pc.trainSeed,vehicleConfig:e,mapIndex:t,data:chapter.data,death:i,revive:a};cc.log("train_data save",JSON.stringify(n));var o=privacy.encodeFromJson("train_data",n,!0);cc.warn("md5 2",o),this.saveData=n},load:function(){var e=privacy.decodeToJson("train_data");e&&0===e.version&&e.trainCount==pc.trainCount&&e.trainSeed==pc.trainSeed&&(this.saveData=e)},revive:function(){this.load();var e=this.saveData;if(e){for(var t in e.death=0,e.revive=1,e.vehicleConfig.hp=1,e.vehicleConfig.towers){var i=e.vehicleConfig.towers[t];i&&(i.hp=1)}var a=privacy.encodeFromJson("train_data",e,!0);cc.warn("md5 1",a)}},death:function(){this.load();var e=this.saveData;if(e){e.death=1;var t=privacy.encodeFromJson("train_data",e,!0);cc.warn("md5 3",t)}},reset:function(){this.saveData=null,privacy.remove("train_data"),chapter.reset()},getTrainSaveData:function(){var e=this.saveData;return e&&e.trainCount==pc.trainCount&&e.trainSeed==pc.trainSeed?(chapter.data=e.data,this.mapIndex=e.mapIndex):(r.start(),e=this.saveData),e},continue:function(){var e=r.getTrainSaveData().vehicleConfig,t=r.getFloorData(this.mapIndex),i=t.towerIndex,a=t.floorIndex,n=t.tower.floors.length;cc.warn(a,n,i,this.getTrainData().length),menuManager.run("checkpoint",{train:1,mapIndex:a+1,mapLength:n,chapterIndex:i+1,vehicleConfig:e,nextCb:function(e){r.run(e)},pauseCb:function(){menuManager.pop("pause",{closeCb:function(e){e&&menuManager.back()}})}})},run:function(e){var t=this,i=r.getFloorData(this.mapIndex);if(i){task.addDailyTaskCt("trainStart");var a=e.vid,n=e.star,o=e.attr,s=e.hp,c=e.towers,l=e.heroes,d=e.bench,h=e.cd,u=chapter.data.events;map.load("map/"+i.map,function(p,f){if(p)kit.info("\u5730\u56fe\u4e0d\u5b58\u5728"+i.map,function(){DEBUG_MODE&&(t.mapIndex++,r.save(e,t.mapIndex),menuManager.back())});else{var m={lvl:i.lvl,entity:{1:{id:a,cd:h,star:n,attr:o,events:u,hp:s,towers:c,heroes:l,bench:d}}};loadGame({me:1,remotes:m,auto:2,train:1,mapData:f,finishFunc:function(e,i){if(i){var n=e.levelMgr.heroes[1],s={vid:a,stack:chapter.data.stack,attr:o,driver:1,hp:n.hp/n.hpMax,towers:[],heroes:l,bench:d,cd:[n.getSkillCDPercent(0)]};for(var h in n.towers){var u=n.towers[h];s.towers[h]={i:c[h].i,hp:u.hp/u.hpMax,m:u==n.mainTower?1:0}}t.chapterWin(e,s)}else r.death(),t.chapterFail(e)},pauseFunc:function(e){e.pushTimeScale(0),menuManager.pop("pause",{closeCb:function(t){e.popTimeScale(0),t&&menuManager.back(2)}})}})}})}},chapterWin:function(e,t,o){var s=this;void 0===o&&(o=2);var c=n.SDKManager.Instance.endLevelTimer(),l=a.FirebaseTracking.levelID,d=n.SDKManager.Instance.generateUniqueID(l),h=n.SDKManager.Instance.getAttempts(l),u=i.ADManager.Instance.IsReviveAds?1:0;a.FirebaseTracking.logGameOver(d,c,u,1,0,h),this.mapIndex++;var p=r.getFloorData(this.mapIndex);if(p)chapter.add(SILVER,+p.data.money),r.save(t,this.mapIndex),menuManager.pop("complete",{noBlock:1,noWait:!0,game:e,mapIndex:this.mapIndex,hideCb:function(){menuManager.popCover({noLoading:!0,prefab:menuManager.currentRun().fadeOutPrefab}).transitionIn(e.layer),e.levelMgr.callFade(),menuManager.preload("train")},nextCb:function(){menuManager.back(2)}});else{r.save(t,this.mapIndex);var f=[];e&&e.layer.hidePauseBtn(!1),chapter.get(SILVER)&&f.push({i:DIAMOND,n:chapter.get(SILVER)}),t.stack>1&&f.push({i:DIAMOND,n:[0,5,15,30][t.stack-1]}),net.updateData({items:f},function(i,n){a.FirebaseTracking.setDataBiRes("ChapterWin"),money.update(n),menuManager.pop("chapter_complete",{win:1,delay:o,noBlock:1,game:e,vehicleConfig:t,level:s.mapIndex,items:f,hideCb:function(){e&&(e.layer.hideJoystickBtn(!1),e.layer.hideOtherBtn(!1)),menuManager.preload("train")},nextCb:function(){menuManager.back(2)}})})}},chapterFail:function(e,t){void 0===t&&(t=2),menuManager.pop("chapter_complete",{win:0,delay:t,noBlock:1,game:e,train:1,noVideo:1,hideCb:function(){e&&(e.layer.hideJoystickBtn(!1),e.layer.hideOtherBtn(!1)),menuManager.preload("train")},nextCb:function(){menuManager.back(2)}})},init:function(){}};window.train=r,cc._RF.pop()},{"../../Plugins/ADManager":"ADManager","../../Plugins/SDKManager":"SDKManager","../../Plugins/firebase/FirebaseTracking":"FirebaseTracking"}],userProtocol:[function(e,t){"use strict";cc._RF.push(t,"4f6fb7u1oVKbYY0t+HrcqkW","userProtocol"),window.URLS={identify_protocol:"https://sites.google.com/view/superdan-privacy-policy/home",privacy_protocol:"https://test.fattoy.cn/privacy/backpack/privacy_protocol.html",permission_list:"https://test.fattoy.cn/privacy/backpack/permission_list.html",sdk_list:"https://test.fattoy.cn/privacy/backpack/sdk_list.html",user_info:"https://test.fattoy.cn/privacy/backpack/user_info.html",payment:"https://test.fattoy.cn/privacy/backpack/payment.html",cadpa:"https://test.fattoy.cn/privacy/backpack/cadpa.html",beian:"https://beian.miit.gov.cn/#/home"},window.userProtocol={init:function(){},reset:function(){},setLoginRichText:function(e){var t="<color=#63C4FF><on click='onLink' param='"+URLS.identify_protocol+"'>"+LI("privacy_btn_2")+"</on></c>",i="<color=#63C4FF><on click='onLink' param='"+URLS.privacy_protocol+"'>"+LI("privacy_btn_1")+"</on></c>",a="<outline color=black width=3>"+LI("login_check",{p1:t,p2:i})+"</outline>";e.string=a,e.onLink=function(e,t){cc.log("link",e,t),kit.openURL(t)}},check:function(e){if(cc.sys.platform===cc.sys.WECHAT_GAME||cc.sys.platform===cc.sys.BYTEDANCE_GAME)return!1;if(["tt","wx","ks","m233","google"].includes(CH))return!1;if(!cc.sys.localStorage.getItem("privacy_check")){var t="      \u4eb2\u7231\u7684\u7528\u6237\uff0c\u611f\u8c22\u60a8\u4f53\u9a8c\u672c\u6e38\u620f\u3002\u4e3a\u4e86\u7ed9\u60a8\u63d0\u4f9b\u66f4\u4f18\u8d28\u7684\u6e38\u620f\u4f53\u9a8c\uff0c\u6211\u4eec\u5c06\u4f1a\u4f7f\u7528\u60a8\u7684\u4e2a\u4eba\u4fe1\u606f\uff0c\u5e76\u6309\u7167\u6cd5\u5f8b\u6cd5\u89c4\u8981\u6c42\uff0c\u91c7\u53d6\u4e25\u683c\u7684\u5b89\u5168\u4fdd\u62a4\u63aa\u65bd\uff0c\u4fdd\u62a4\u60a8\u7684\u4e2a\u4eba\u9690\u79c1\u3002\n      \n      \u5728\u4f7f\u7528\u6e38\u620f\u524d\uff0c\u52a1\u5fc5\u4ed4\u7ec6\u9605\u8bfb\u3001\u5145\u5206\u7406\u89e3<color=#0000ff><on click='onLink' param='"+URLS.identify_protocol+"'> \u300a\u7528\u6237\u534f\u8bae\u300b</on></c>\u3001<color=#0000ff><on click='onLink' param='"+URLS.privacy_protocol+"'> \u300a\u9690\u79c1\u653f\u7b56\u300b</on></c>\u3001<color=#0000ff><on click='onLink' param='"+URLS.payment+"'> \u300a\u5145\u503c\u670d\u52a1\u534f\u8bae\u300b</on></c>\u3001<color=#0000ff><on click='onLink' param='"+URLS.permission_list+"'> \u300a\u7cfb\u7edf\u6743\u9650\u6e05\u5355\u300b</on></c>\u3001<color=#0000ff><on click='onLink' param='"+URLS.sdk_list+"'> \u300a\u7b2c\u4e09\u65b9SDK\u63a5\u5165\u6e05\u5355\u300b</on></c>\u3001<color=#0000ff><on click='onLink' param='"+URLS.user_info+"'> \u300a\u4e2a\u4eba\u4fe1\u606f\u641c\u96c6\u6e05\u5355\u300b</on></c>\uff0c\u7279\u522b\u662f\u5176\u4e2d\u52a0\u7c97\u7684\u6761\u6b3e\uff0c\u4f46\u60a8\u70b9\u51fb\u540c\u610f\u5e76\u8fdb\u5165\u65f6\uff0c\u5373\u8868\u793a\u60a8\u5df2\u7406\u89e3\u5e76\u540c\u610f\u8be5\u6761\u6b3e\u5185\u5bb9\uff0c\u8be5\u6761\u6b3e\u5c06\u5bf9\u60a8\u4ea7\u751f\u6cd5\u5f8b\u7ea6\u675f\u529b\u3002\u5982\u679c\u60a8\u4e0d\u540c\u610f\uff0c\u5c06\u65e0\u6cd5\u8fdb\u5165\u6e38\u620f\u3002";return menuManager.pop("privacy_check",{noWait:!0,info:t,initCb:function(e,t){t.infoText.onLink=function(e,t){cc.log("link",e,t),kit.openURL(t)}},checkCb:function(t){if(!t)return menuManager.pop("check",{title:"\u63d0\u793a",info:"\u4e0d\u540c\u610f\u6b64\u534f\u8bae,\u6211\u4eec\u5c06\u65e0\u6cd5\u4e3a\u60a8\u63d0\u4f9b\u670d\u52a1,\n\u5e76\u5c06\u7acb\u523b\u9000\u51fa\u6e38\u620f",btnNo:"\u4e0d\u540c\u610f\u5e76\u9000\u51fa",btnYes:"\u8fd4\u56de",noWait:!0,checkCb:function(e){e||cc.game.end()}}),!0;cc.sys.localStorage.setItem("privacy_check","1"),e&&e()}}),!0}}},cc._RF.pop()},{}],userZip:[function(e,t){"use strict";cc._RF.push(t,"92545ZWHJxNTpccxJGcqbWT","userZip");var i=["eye","hair","mouth","beard","hat","socks","shoes","brow","glasses","glove","head","hand","trunk","leg","scarf"],a=["head","hand","trunk","leg"],n={convertToString:function(e){var t="";for(var a in i)e[i[a]]?t=t+e[i[a]]+"|":t+="|";return t},convertToObject:function(e){if(e){var t=e.split("|"),a={};for(var n in t)i[n]&&(a[i[n]]=t[n]);return a}},convertToDefine:function(e){var t={};if(e){var n=e.split("|");if(n.length>1){for(var o in n)(s=i[o])&&FACE_DEFINE[s]&&(t[s]=FACE_DEFINE[s][n[o]]);return t}var r=COS_DEFINE[e];if(r)for(var o in t.female=r.female,a){var s,c=r[s=a[o]],l=SKIN_DEFINE[s],d=t[s]={x:l.x,y:l.y,frm:l.frm,atlas:r.atlas||l.atlas};if(c){d.x+=c.x||0,d.y+=c.y||0;var h=SKIN_DEFINE[s+"_s"],u=t[s+"_s"]={x:h.x,y:h.y,frm:h.frm,atlas:r.atlas||h.atlas};u.x+=c.x||0,u.y+=c.y||0}}}return t}};window.userZip=n,cc._RF.pop()},{}],user:[function(e,t){"use strict";cc._RF.push(t,"82ea7Fc2a1Gv5dVtI7S6bLG","user");var i=function(e,t){console.log("wxGetUserInfo",t),wx.getUserInfo({success:function(t){console.log("success",t);var i=t.userInfo;r.updateTeam(i.nickName,i.avatarUrl),e(0,!0);var a=window.mpsdk;a&&a.Account.setAccountInfo({nickName:i.nickName,gender:i.gender})},fail:function(t){console.log("fail",t),e(-1)}})},a=function(e,t){if(console.log("wxAuth",t),cc.sys.platform==cc.sys.WECHAT_GAME||cc.sys.platform==cc.sys.BYTEDANCE_GAME){var a=menuManager.popCover(),n=function(n){console.log("check",n),menuManager.closeCover(a);var o=n.authSetting;o["scope.userInfo"]?i(e,!0):wx.createUserInfoButton?menuManager.pop("wx_auth",{title:t,infoCb:e}):!1===o["scope.userInfo"]?menuManager.pop("notice",{title:t||LI("login_title"),btn:LI("login_btn"),info:LI("login_closed_msg"),closeCb:function(t){t?(console.log("go setting"),wx.openSetting({success:function(t){t.authSetting["scope.userInfo"]?i(e):(kit.info(LI("login_reject")),e(-1))},fail:function(){kit.info(LI("login_fail")),e(-1)}})):e(-1)}}):wx.authorize({scope:"scope.userInfo",success:function(t){console.log("wx.authorize success",t),i(e,!0)},fail:function(e){console.log("wx.authorize fail",e),kit.info(LI("login_reject"))}})};if(cc.sys.platform==cc.sys.BYTEDANCE_GAME&&(console.log("tt auth",r.guestMode),r.guestMode)){var o=function(e){net.post("setGuest",{loginData:{code:e.code,anonymousCode:e.anonymousCode},ch:CH},function(e,t){e||(t.openId?(r.guestMode=!1,r.openId=t.openId,wx.getSetting({success:n})):kit.info(LI("login_relog_msg"),function(){menuManager.run("login",null,!0)}))})};return void wx.login({force:!0,success:function(e){menuManager.closeCover(a),menuManager.pop("check",{title:LI("login_bind"),info:LI("login_bind_msg"),noWait:!0,checkCb:function(t){t&&o(e)}})},fail:function(e){menuManager.closeCover(a),console.log("login fail",e),kit.info(LI("login_null"))}})}wx.getSetting({success:n})}},n=function(e){window.potato.startLogin(function(t,i){if(cc.log(t,JSON.stringify(i)),t)if(cc.log(i.id,i.name,i.avatar),r.guestMode){var a=function(t){net.post("setGuest",{loginData:t,ch:CH},function(t,a){t||(a.openId?(r.guestMode=!1,r.openId=a.openId,r.updateTeam(i.name,i.avatar),e(0,!0)):kit.info(LI("login_relog_msg"),function(){menuManager.run("login",null,!0)}))})},n={id:i.id,did:nativeSdk.getUserId()};menuManager.pop("check",{title:LI("login_bind"),info:LI("login_bind_msg"),noWait:!0,checkCb:function(e){e&&a(n)}})}else e(0,!0);else cc.log(i.code,i.message),kit.info(LI("login_null"))})},o=function(e){var t,i=function(e,t){uc.isLogin({success:function(i){i.isLogin?e&&e():t&&t()},fail:function(e){t&&t(res),console.error(e)}})},a=function(e,t){uc.getSetting({success:function(i){i.userInfo?e&&e():t&&t()},fail:function(e){t&&t(res),console.error(e)}})},n=function(e,t){uc.authorize({scope:"userInfo",success:function(i){i.userInfo?e&&e():t&&t()},fail:function(e){t&&t(res),console.error(e)}})},o=function(t,i){uc.getUserInfo({success:function(i){t&&t(i),e&&e(0,!0)},fail:function(e){i&&i(res),console.error(e)}})},s=function(t){net.post("setGuest",{loginData:t,ch:CH},function(t,i){t||(i.openId?(r.guestMode=!1,r.openId=i.openId,a(function(){o(function(e){r.updateTeam(e.nickname,e.avatar_url)})},function(){n(function(){o(function(e){r.updateTeam(e.nickname,e.avatar_url)})},function(){r.updateTeam(guestData.nickname,guestData.avatar_url)})}),e(0,!0)):kit.info(LI("login_relog_msg"),function(){menuManager.run("login",null,!0)}))})};t=function(e){i(function(){a(function(){o(function(e){r.updateTeam(e.nickname,e.avatar_url)})},function(){n(function(){o(function(e){r.updateTeam(e.nickname,e.avatar_url)})},function(){r.updateTeam(e.nickname,e.avatar_url)})})},function(){var t,i;t=function(t){if(r.guestMode){var i={code:t.code,guestCode:e.guestid};menuManager.pop("check",{title:LI("login_bind"),info:LI("login_bind_msg"),noWait:!0,checkCb:function(e){e&&s(i)}})}},i=function(){r.updateTeam(e.nickname,e.avatar_url)},uc.login({success:function(e){t&&t(e)},fail:function(){i&&i()}})})},uc.getGuestInfo({success:function(e){t&&t(e)},fail:function(e){console.error(e)}})},r={init:function(){r.uesrName="",r.headUrl=""},setOnlineData:function(e){console.log("setOnlineData User",e),r.uuid=e.uuid,storage.set("recent_uuid",r.uuid),r.displayName=e.displayName,storage.set("name_player",r.displayName),r.openId=e.openId,r.setUserName(e.name),r.setUserHeadUrl(e.head),r.updateSignData(e.signIndex,e.signCount,e.signRefreshDate),r.guide=e.guide||{},r.mark=e.mark||{},r.gift={},r.initGift("pack_a",e.gift),r.initGift("pack_b",e.gift),r.favoriteCount=e.favoriteCount,r.favoriteIndex=e.favoriteIndex,r.mailList=e.mailList||[],r.mailInfoTable=e.mailInfoTable||{},r.onlineTime=e.onlineTime||0,cc.log("setOnlineData",e),this.scheduleOnlineTime(e),r.loginDay=e.loginDay||0,r.countLoginDay=e.countLoginDay||0,r.loginDayRefreshTime=e.loginDayRefreshTime||0,r.onlineTimer=e.onlineTimer||{},r.abTestIndex=e.abTestIndex,r.tjVersion=e.tjVersion,this.upLoadTjVersion(),r.adFinishCount=e.adFinishCount||0,r.adEcpmCount=e.adEcpmCount||0,r.guideStep=e.guideStep||0,r.levelProgression=0,r.stateRewardSign=e.stateRewardSign||{0:{normalReward:0,enhancedReward:0}},r.weekSign=e.weekSign||0,console.log(e.stateRewardSign)},upLoadTjVersion:function(){r.tjVersion?cc.log("user.tjVersion exist",r.tjVersion):(r.tjVersion=YMTJ_VERSION,cc.log("user.tjVersion not exist,creating one",r.tjVersion),net.updateLazyData({set:{tjVersion:r.tjVersion}}))},uploadAbTestIndex:function(e,t){cc.log("user.uploadAbTestIndex",e),net.postSilent("updateData",{set:{abTestIndex:e}},function(e,i){e?t&&t():(r.abTestIndex=i.doc.abTestIndex,t&&t(),cc.log("user.uploadAbTestIndex success",r.abTestIndex))})},testNextDay:function(){this.checkDau(r.loginDayRefreshTime)},checkDau:function(e){cc.log("user.checkDau loginDay|loginDayRefreshTime",r.loginDay,r.loginDayRefreshTime),(e||sdk.now())>=r.loginDayRefreshTime&&net.postSilent("updateData",{set:{loginDayRefreshTime:kit.getNextDate(sdk.now()).getTime()},add:{loginDay:1}},function(e,t){if(!e){r.loginDayRefreshTime=t.doc.loginDayRefreshTime,r.loginDay=t.doc.loginDay;var i=new Date(r.loginDayRefreshTime);cc.log("user.checkDau new loginDay",r.loginDay,"next loginDayRefreshTime",i),YMTJ("dau","dau"),r.loginDay<=7?YMTJ("time","dau_day"+r.loginDay):8==r.loginDay?YMTJ("time","dau_day8_10"):11==r.loginDay?YMTJ("time","dau_day11_15"):16==r.loginDay&&YMTJ("time","dau_day16_30")}})},checkLoginNewDay:function(){console.log("[check] checkLoginNewDay",r.countLoginDay,r.signRefreshDate),sdk.now()>r.signRefreshDate&&sdk.now()>r.signRefreshDate&&net.updateData({add:{countLoginDay:1}},function(e,t){console.log("[check] checkLoginNewDay",e,t)})},scheduleOnlineTime:function(){var e=this;setTimeout(function(){net.postSilent("updateData",{add:{onlineTime:1}},function(e,t){e||(t=t.doc,r.onlineTime=t.onlineTime||0,cc.log("scheduleOnlineTime data",r.onlineTime,t),1==r.onlineTime?YMTJ("time","time_1"):3==r.onlineTime?YMTJ("time","time_3"):5==r.onlineTime?YMTJ("time","time_5"):7==r.onlineTime?YMTJ("time","time_7"):10==r.onlineTime?YMTJ("time","time_10"):15==r.onlineTime?YMTJ("time","time_15"):20==r.onlineTime?YMTJ("time","time_20"):30==r.onlineTime&&YMTJ("time","time_30"))}),e.scheduleOnlineTime()},6e4)},isMailRed:function(){for(var e in r.mailList){var t=r.mailList[e];if(0==t.status&&t.time/1e3+t.exp>0)return!0}},initGift:function(e,t){t&&t[e]?r.gift[e]=t[e]:r.gift[e]={}},setGuideStep:function(e){r.guideStep=e,user.quickSave("guideStep",e)},getGuideStep:function(){return r.guideStep},getGiftStatus:function(e){return r.gift[e].status||0},setGiftStatus:function(e,t){r.gift[e].status=t},setGiftIndex:function(e,t){r.gift[e].index=t},getGiftIndex:function(e){return r.gift[e].index||0},isFavoriteHide:function(){return"oppo"==CH?r.mark.favorite:!!cc.sys.isNative||("tt"==CH?cc.sys.platform!=cc.sys.BYTEDANCE_GAME?r.favoriteCount:"DOUYIN"!==tt.getSystemInfoSync().appName.toUpperCase()||r.favoriteCount:"wx"==CH?r.mark.favorite:"qq"==CH?r.mark.favorite:"bl"==CH?r.mark.favorite:(CH,!0))},lootFavorite:function(){},getGuide:function(e){return r.guide[e]},setGuide:function(e,t){var i;r.guide[e]!=t&&(r.guide[e]=t,cc.warn("setGuide",e,t),net.updateLazyData({set:(i={},i["guide."+e]=t,i)}))},updateSignData:function(e,t,i){if(console.log("[check]","updateSignData","signIndex : ",e," signCount",t,i,!i),r.signIndex=e||0,r.signCount=t||0,console.log("[check]","r.signCount",r.signCount," r.signIndex",r.signIndex),!i){var a=sdk.now()+864e5;return net.postSilent("updateData",{set:{signRefreshDate:a}},function(){console.log("[check]","updateSignData","Update Success"),r.updateSignData(r.signIndex,r.signCount,a)}),void(r.signRefreshDate=a)}r.signRefreshDate=i,console.log("[check resetSignRewardData]","r.signIndex",r.signIndex,r.signCount,sdk.now()>i),r.signIndex>=7&&sdk.now()>i&&r.resetSignRewardData()},resetSignRewardData:function(){console.log("[user]","resetSignRewardData"),net.updateData({set:{signCount:-1,signIndex:0,stateRewardSign:{0:{normalReward:0,enhancedReward:0}}},add:{weekSign:1}},function(e,t){console.log("[user]","resetSignRewardData",e,t),t.doc&&(user.weekSign=t.doc.weekSign),user.signIndex=0,user.signCount=0,user.stateRewardSign={0:{normalReward:0,enhancedReward:0}},user.updateSignData(user.signIndex,user.signCount,user.signRefreshDate)})},refreshSignData:function(e){if(sdk.now()>r.signRefreshDate){var t=sdk.now()+864e5;r.signCount<6?net.updateData({add:{signCount:1},set:{signRefreshDate:t}},function(t,i){console.log("[check]","After Update",r.signIndex,r.signCount,i),r.updateSignData(r.signIndex,i.doc.signCount,i.doc.signRefreshDate),e&&e()}):net.updateData({set:{signRefreshDate:t}},function(t,i){console.log("[check]",t,i),r.updateSignData(r.signIndex,r.signCount,i.doc.signRefreshDate),e&&e()})}else e&&e()},getUID:function(){return r.uuid},checkUserInfo:function(e){if(r.userInfoUpdated)e&&e(0,!0);else{if(window.nativeSdk&&nativeSdk.login)return t=e,void(r.guestMode?nativeSdk.login(function(e,i){e?menuManager.pop("check",{title:LI("login_bind"),info:LI("login_bind_msg"),noWait:!0,checkCb:function(e){e&&net.post("setGuest",{loginData:{code:i,did:nativeSdk.getUserId()},ch:CH},function(e,i){if(!e){if(!i.openId)return i.nextId&&window.nativeSdk&&"douyin"==nativeSdk.getChannelName()&&(storage.set("douyinDate",Date.now()+864e5),storage.set("douyinOpenId",i.nextId)),void kit.info(LI("login_relog_msg"),function(){menuManager.run("login",null,!0)});r.updateTeam(i.name,i.head),r.guestMode=!1,r.openId=i.openId,window.nativeSdk&&"douyin"==nativeSdk.getChannelName()&&(storage.set("douyinDate",Date.now()+864e5),storage.set("douyinOpenId",i.openId)),t(0,!0)}})}}):t(-1)}):t(0,!0));var t;if(cc.sys.platform!=cc.sys.OPPO_GAME){var i=window.hg;if(i)i.getUserInfo({success:function(t){var i=t.userInfo;r.updateTeam(i.nickName,i.avatarUrl),e&&e(0,!0)}});else if(window.potato)n(e);else{var s=window.bl;s?s.getUserInfo({success:function(t){var i=t.userInfo;r.updateTeam(i.nickName,i.avatarUrl),e&&e(0,!0)}}):window.uc?o(e):cc.sys.platform!=cc.sys.WECHAT_GAME&&cc.sys.platform!=cc.sys.BYTEDANCE_GAME?(r.updateTeam("\u6d4b\u6d4b\u8bd5\u8bd5"+kit.rndInt(0,99999)),e&&e(0,!0)):a(e)}}else e&&e(0,!0)}},updateTeam:function(e,t){r.userInfoUpdated=!0;var i={},a=!1;e&&r.getUserName()!=e&&(r.setUserName(e),a=!0,i.name=e),t&&r.getUserHeadUrl()!=t&&(r.setUserHeadUrl(t),a=!0,i.head=t),a&&net.postSilent("updateData",{set:i})},getDisplayName:function(){return r.displayName},getUserName:function(){return r.uesrName},setUserName:function(e){r.uesrName=e},setUserHeadUrl:function(e){r.headUrl=e},getUserHeadUrl:function(){return r.headUrl},loadUserHead:function(e,t){if(e&&t&&t!=e.userHeadUrl){e.userHeadUrl=t;var i=function(t,i){if(!t&&i&&cc.isValid(e)){var a=new cc.SpriteFrame;a.setTexture(i),e.spriteFrame=a;var n=e.node;n.width=100,n.height=100}};"0"===t?cc.resources.load("ui/hero/head/h2",cc.Texture2D,i):kit.requestImage(t,i)}},getOnlineTimerString:function(e,t){var i=(r.onlineTimer[e]||0)+t-sdk.now();return i<0&&(i=0),kit.second2date(i/1e3)},checkOnlineTimeCD:function(e,t){return sdk.now()-(r.onlineTimer[e]||0)>t},checkOnlineTimeNextDay:function(e){var t=kit.getNextDate(r.onlineTimer[e]||0),i=t.getTime();return cc.log("user checkOnlineTimeNextDay",e,t),sdk.now()+-i>0},setOnlineTimer:function(e){var t,i={onlineTimer:(t={},t[e]=sdk.now(),t)};net.postSilent("updateData",{set:i},function(t,i){t||(r.onlineTimer[e]=i.doc.onlineTimer[e]||0,cc.log("user setOnlineTimer updateData data/timerId/value",i,e,r.onlineTimer[e]))})},logout:function(){r.userInfoUpdated=!1,sdk.videoLoaded=!1,menuManager.run("login",null,!0)},quickSave:function(e,t){var i={};i[""+e]=t,net.updateData({set:i},function(e,t){console.log("QickSave , ",t)})}};window.user=r,cc._RF.pop()},{}],version:[function(e,t){"use strict";cc._RF.push(t,"8ea711Eje1A6pjNvgZLgHQf","version"),window.BUILD_VERSION=746,window.BUILD_TIME=1730112381760,cc._RF.pop()},{}],weaponEffect:[function(e,t){"use strict";cc._RF.push(t,"73c0cInXXRHuaeR5k/p060w","weaponEffect"),RES.bomb=[{atlas:"effect/explosion/boom1"},"sound/explosive"],EFFECT.bomb=function(e,t,i){void 0===i&&(i=100);var a=i/100;this.game.playEffect("sound/explosive",null,a);var n=this.createAnimation("effect/explosion/boom5",{speed:1.2,repeat:1});return n.scale=.7*a*ANIME_SCALE,this.layer.addToCamera(n,ZORDER.EFFECT),n.setPosition(e,t),n.setAnchorPoint(.5,.1),EFFECT.createFireLight.call(this,e,t+50,1.6*a,255,2),this.game.layer.shake(11*a,11*a),this.game.callEffect(EFFECT.DropShards,e,t,50,i>100?3:2,{scale:a}),EFFECT.nova.call(this,e,t,.4,a),n},EFFECT.bomb2=function(e,t,i){void 0===i&&(i=100);var a=i/100;this.game.playEffect("sound/explosive",null,a);var n=this.createAnimation("effect/explosion/boom2",{speed:1.2,repeat:1});return n.scale=.8*a*ANIME_SCALE,this.layer.addToCamera(n,ZORDER.EFFECT),n.setPosition(e,t),n.setAnchorPoint(.5,.55),EFFECT.createFireLight.call(this,e,t+50,1.6*a,255,2),this.game.layer.shake(4,4),this.game.callEffect(EFFECT.DropShards,e,t,50,i>100?3:2,{scale:a}),EFFECT.nova.call(this,e,t,.5,a),n},EFFECT.bomb3=function(e,t,i){var a=i/100*1.2;this.game.playEffect("sound/explosive");var n=this.createAnimation("effect/explosion/boom3",{speed:1.2,repeat:1});return n.scale=.7*ANIME_SCALE*a,this.layer.addToCamera(n,ZORDER.EFFECT),n.setPosition(e,t),n.setAnchorPoint(.5,.1),EFFECT.createFireLight.call(this,e,t+50,1.6*a,255,2),this.game.layer.shake(4*a,4*a),this.game.callEffect(EFFECT.DropShards,e,t,50,i>100?3:2),EFFECT.nova.call(this,e,t,.4,a),n},EFFECT.bomb4=function(e,t,i){this.game.playEffect("sound/explosive");var a=this.createAnimation("effect/explosion/boom1",{speed:1.2,repeat:1});return a.scale=.7*ANIME_SCALE,this.layer.addToCamera(a,ZORDER.EFFECT),a.setPosition(e,t),a.setAnchorPoint(.5,.1),EFFECT.createFireLight.call(this,e,t+50,1.6,255,2),this.game.layer.shake(11,11),this.game.callEffect(EFFECT.DropShards,e,t,50,i>100?3:2),EFFECT.nova.call(this,e,t,.4),a},EFFECT.slimeBomb=function(e,t){this.game.playEffect("sound/mob/slime/dead");var i=this.createAnimation("effect/mob/slime_dead/liquid",{speed:1,repeat:1});i.scale=1.2*ANIME_SCALE,i.x=e,i.y=t,this.layer.addToCamera(i,ZORDER.EFFECT),this.game.layer.shake(2,2)},EFFECT.nova=function(e,t,i,a){void 0===a&&(a=1);var n=this.createAnimation("effect/explosion/quan",{speed:2,repeat:1});n.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,n.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,n.setPosition(e,t),n.setAnchorPoint(.5,i||.5),n.scale=1.6*a*ANIME_SCALE,this.layer.addToCamera(n,ZORDER.EFFECT+1)},EFFECT.bombs=function(e,t,i){var a;return a=t>100?2:1,cc.log("EFFECT.bombs",i),1==a?EFFECT.bomb.call(this,e,t,i):EFFECT.bomb2.call(this,e,t,i)},EFFECT.smallBomb=function(e,t,i){var a=i/100;this.game.playEffect("sound/explosive",null,a);var n=this.createAnimation("effect/explosion/boom5",{speed:1.2,repeat:1});return n.scale=.7*a*ANIME_SCALE,this.layer.addToCamera(n,ZORDER.EFFECT),n.setPosition(e,t),n.setAnchorPoint(.5,.1),EFFECT.createFireLight.call(this,e,t+50,1.6*a,255,2),this.game.layer.shake(11*a,11*a),EFFECT.nova.call(this,e,t,.4,a),n},EFFECT.bombs3=function(e,t,i){return 1==(t>100?2:1)?EFFECT.bomb3.call(this,e,t,i):EFFECT.bomb2.call(this,e,t,i)},EFFECT.mortarBomb=function(e,t,i){return 1==(t>100?2:1)?EFFECT.bomb3.call(this,e,t,i):EFFECT.bomb2.call(this,e,t,i)},EFFECT.bombNukePre=function(e,t){var i=this.createAnimation("bullet/nuke/hebao",{speed:1,repeat:1});return i.scale=.8*3*ANIME_SCALE,this.layer.addToCamera(i,ZORDER.EFFECT),i.setPosition(e,t),i.setAnchorPoint(.53,.45),i},EFFECT.bombNuke=function(e,t){this.game.playEffect("sound/explosive"),EFFECT.createFireLight.call(this,e,t+50,1.6*3,255,2),this.game.callEffect(EFFECT.DropShards,e,t,50,2),EFFECT.nova.call(this,e,t,.5,3),this.game.layer.shake(55,55)},EFFECT.incendiaryBombHit=function(e,t){this.game.playEffect("sound/explosive");var i=this.createAnimation("effect/explosion/boom3",{speed:1.2,repeat:1});return i.scale=.7*ANIME_SCALE,this.layer.addToCamera(i,ZORDER.EFFECT),i.setPosition(e,t),i.setAnchorPoint(.5,.1),EFFECT.createFireLight.call(this,e,t+50,1.6,255,2),this.game.layer.shake(4,4),this.game.callEffect(EFFECT.DropShards,e,t,50,2),EFFECT.nova.call(this,e,t,.4),i},RES.yellowHit=[{atlas:"effect/hit/hit1"}],EFFECT.meleeHit=function(e,t,i,a,n){void 0===n&&(n=1);var o=this.createAnimation("effect/hit/baodian_huangse",{delay:a,speed:2.5});this.layer.addToCamera(o,ZORDER.EFFECT);var r=1*ANIME_SCALE;o.scale=r,o.angle=i-30,o.setAnchorPoint(.3671875,.2890625),o.setPosition(e,t)},EFFECT.yellowHit=function(e,t,i,a,n){void 0===n&&(n=1);var o=this.createAnimation("effect/hit/hit1",{delay:a,speed:4});o.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,o.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,this.layer.addToCamera(o,ZORDER.EFFECT);var r=Math.random()>.5,s=1.6*n*ANIME_SCALE;o.scaleX=r?-s:s,o.angle=kit.rnd(0,360),o.setPosition(e,t),o.scaleY=s},EFFECT.flameHit=function(e,t,i,a,n){void 0===n&&(n=10);var o=this.createAnimation("bullet/flame_thrower/dianran",{speed:2});o.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,o.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,o.anchorY=.2,this.layer.addToCamera(o,ZORDER.EFFECT);var r=Math.random()>.5,s=1*ANIME_SCALE;o.scaleX=r?-s:s,o.setPosition(e+kit.rnd(-n,n),t+kit.rnd(-n,n)),o.scaleY=s},RES.rocketTail=[{atlas:"avatar/rocket/weiyan"}],EFFECT.rocketTail=function(e){var t=this.createAnimation("avatar/rocket/weiyan",{speed:5,repeat:-1});e.addChild(t,-1),t.angle=e.getAngle()+(e.flipX?180:0);var i=kit.degree2Radian(t.angle),a=-100*Math.cos(i),n=-100*Math.sin(i);return t.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,t.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,t.setPosition(a,n),t.scale=2*ANIME_SCALE,t.remove=function(){this.destroy()},t},RES.explosion=[{atlas:"effect/explosion/boom2"},"sound/explosive_2"],EFFECT.explosion=function(e,t){this.game.playEffect("sound/explosive_2");var i=this.createAnimation("effect/explosion/boom2",{speed:2,repeat:1});return this.layer.addToCamera(i,ZORDER.EFFECT),i.setPosition(e,t),i.setAnchorPoint(.5,.5),i.scale=1*ANIME_SCALE,EFFECT.createFireLight.call(this,e,t,.7,255,2),i},EFFECT.explosion2=function(e,t){this.game.playEffect("sound/explosive_2");var i=this.createAnimation("effect/explosion/boom3",{speed:2,repeat:1});return this.layer.addToCamera(i,ZORDER.EFFECT),i.setPosition(e,t),i.setAnchorPoint(.5,.1),i.scale=1*ANIME_SCALE,EFFECT.createFireLight.call(this,e,t,.7,255,2),this.game.callEffect(EFFECT.DropShards,e,t,50,2),this.game.layer.shake(6,6),i},EFFECT.GunFire=function(e,t,i,a){var n=this.createAnimation("bullet/fire_attack",{speed:3.5});n.setAnchorPoint(.5,.06),n.scale=(.2*Math.random()+.8)*ANIME_SCALE,n.scale*=a||1,Math.random()>.5?n.scaleX*=1:n.scaleX*=-1,n.angle=i-90,n.x=e,n.y=t,this.layer.addToCamera(n,ZORDER.EFFECT-1)},EFFECT.CannonGunFire=function(e,t,i,a){var n=this.createAnimation("bullet/cannon/paohua",{speed:1.5});n.setAnchorPoint(0,.5),n.scale=(.2*Math.random()+.4)*ANIME_SCALE,n.scale*=a||1,n.angle=i,n.x=e,n.y=t,this.layer.addToCamera(n,ZORDER.EFFECT-1)},EFFECT.FireLight=function(e,t,i,a,n,o,r,s){var c=this;return void 0===n&&(n=1),function(n,o,r){var l=c.createSprite(0,0,"bullet/fire_light");l.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,l.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE;var d=e.getPosition();l.x=d.x+t||0,l.y=d.y+i||0,o=o||1,n=1*(n||1),l.scale=1.4*n,l.opacity=0,c.layer.addToCamera(l,ZORDER.EFFECT),r=r||100;var h=cc.sequence(cc.fadeTo(.004*o,r),cc.scaleTo(.04*o,.7*n),cc.fadeOut(.1*o),cc.recycle());l.runAction(h);var u=kit.degree2sin(a),p=kit.degree2cos(a);if(s){var f=l.x-40*p,m=l.y-40*u;EFFECT.CannonGunFire.call(c,f,m,a,n)}f=l.x-50*p,m=l.y-50*u,EFFECT.GunFire.call(c,f,m,a,n)}(n,o,r)},EFFECT.MachineGunFireLight=function(e,t,i,a){EFFECT.FireLight.call(this,e,t,i,a,.6);var n=e.getPosition(),o=kit.degree2Radian(a),r=n.x,s=n.y+20;o=-1==e.flipX&&Math.PI/6||-Math.PI/6,EFFECT.DropShell.call(this,r,s,o)},EFFECT.MachineGunFireLightSmall=function(e,t,i,a){EFFECT.FireLight.call(this,e,t,i,a,.4);var n=e.getPosition(),o=kit.degree2Radian(a),r=n.x,s=n.y+20;o=-1==e.flipX&&Math.PI/6||-Math.PI/6,EFFECT.DropShell.call(this,r,s,o,{scale:.4})},EFFECT.MachineGunHeatModeFireLight=function(e,t,i,a){EFFECT.FireLight.call(this,e,t,i,a,.8);var n=e.getPosition(),o=(kit.degree2Radian(a),n.x),r=n.y+20;EFFECT.DropShell.call(this,o,r,-Math.PI/6)},EFFECT.CannonFireLight=function(e,t,i,a){EFFECT.FireLight.call(this,e,t,i,a,1.6,1.3,200,!0);var n=e.getPosition(),o=(kit.degree2Radian(a),n.x-50),r=n.y+30;EFFECT.DropShell.call(this,o,r,-Math.PI/6,{res:"bullet/cannon/shell",scale:.3,speed:.5}),this.game.layer.shake(13,13)},EFFECT.DropShell=function(e,t,i,a){void 0===a&&(a={}),i=i||-Math.PI/8,i+=kit.rnd(-Math.PI/10,Math.PI/10);var n=this.createSprite(e,t,a.res||"bullet/machine_gun/shell");n.angle=kit.rnd(-20,20),n.scale=a.scale||.5,this.layer.addToCamera(n,ZORDER.EFFECT);var o=kit.rnd(380,440)*(a.speed||1),r=o*Math.sin(i),s=o*Math.cos(i);return n.runAction(cc.sequence(cc.delayTime(.5),cc.fadeOut(.5),cc.destroySelf())),n.sprite.schedule(function(e){s-=2e3*e,n.x+=r*e,n.y+=s*e}),n.runAction(cc.rotateBy(kit.rnd(.3,.5),360).repeatForever()),n},EFFECT.createFireLight=function(e,t,i,a,n){var o=this.createSprite(e,t,"bullet/fire_light"),r=o.getComponent(cc.Sprite);r.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,r.dstBlendFactor=cc.macro.BlendFactor.ONE,n=n||8,i=i||2,o.scale=2*i,o.opacity=0,a=a||255;var s=cc.sequence(cc.fadeTo(.004*n,a),cc.scaleTo(.04*n,1*i),cc.fadeOut(.12*n),cc.destroySelf());return o.runActionVS(s),this.layer.addToCamera(o,ZORDER.EFFECT),o},EFFECT.deathFire=function(e){var t=this,i=this.createArmature("mob/huoren","huoren",function(){});this.layer.addToCamera(i,ZORDER.MOB);var a=e.getPosition(),n=(e.define.deathFireScale||1)*ANIME_SCALE,o=e.obj.height;i.setPosition(a.x,a.y+o),i.timer=0,i.walkTimer=0,i.scaleY=n,i.scaleX=(Math.random()<.5?1:-1)*n,i.played=!1;var r=0,s=kit.rnd(-100,100);i.armatureDisplay.scheduleVS(function(e){var a,c,l,d,h,u,p,f,m;if(i.timer+=e,i.timer>=2&&"dead"!=i.played&&(l=null==(a=i.armatureDisplay)?void 0:null==(c=a.armature())?void 0:c.animation)&&(l.play("dead"),i.played="dead",i.runAction(cc.sequence(cc.delayTime(2),cc.recycle()))),i.y>t.game.contactMgr.findGroundLine(i.x)+o)r-=2e3*e,i.y+=r*e,i.x+=s*e,i.played||(u=null==(d=i.armatureDisplay)?void 0:null==(h=d.armature())?void 0:h.animation)&&(u.play("fly"),i.played="fly");else if(i.played&&"fly"!=i.played||(m=null==(p=i.armatureDisplay)?void 0:null==(f=p.armature())?void 0:f.animation)&&(m.play("walk"),i.played="walk"),r<=-500&&(i.timer+=2,i.spdX=0),i.y=t.game.contactMgr.findGroundLine(i.x)+o,"dead"!==i.played&&i.timer<2){if(i.walkTimer-=e,i.walkTimer<=0){i.walkTimer=kit.rnd(.2,.5);var g=kit.rnd(-200,200);i.scaleX=(g>0?1:-1)*n,i.spdX=g}i.x+=i.spdX*e}else i.spdX*=.9,i.x+=i.spdX*e},0),e.setVisible(!1)},EFFECT.hitFloorSmoke=function(e,t,i){void 0===i&&(i=1);var a=this.createAnimation("effect/hit/zidanyan",{speed:4,repeat:1});a.scale=1.5*i*ANIME_SCALE,Math.random()>.5?a.scaleX*=1:a.scaleX*=-1,a.anchorY=.05,a.x=e,a.y=t,this.layer.addToCamera(a,ZORDER.EFFECT-1)},EFFECT.overHeatSmoke=function(e){var t=this,i=new cc.Node;i.addComponent(cc.Component).schedule(function(a){if(kit.timer(this,"123",.1,a)){var n=t.createSprite(kit.rnd(-20,20)+20,kit.rnd(60,70),"effect/weapon/overheat");e.avatar.node.addChild(n),n.scale=kit.rnd(0,.3),n.angle=kit.rnd(0,360),n.runAction(cc.sequence(cc.spawn(cc.moveBy(1,cc.v2(kit.rnd(-70,70),kit.rnd(22,100))),cc.rotateBy(1,kit.rnd(0,100)),cc.scaleTo(1,kit.rnd(1.5,2)),cc.fadeOut(1)),cc.destroySelf()))}e.isHeatOver()||i.destroy()}),this.playEffect("sound/overheat",null,2)},EFFECT.overHeatSmokePersist=function(e){var t=this;if(!e.overHeatNode){var i=new cc.Node,a=i.addComponent(cc.Component);e.overHeatNode=i,e.avatar.node.addChild(i),a.schedule(function(i){if(e.isHeatOver()&&kit.timer(this,"123",.1,i)){var a=t.createSprite(kit.rnd(-20,20)+20,kit.rnd(60,70),"effect/weapon/overheat");e.avatar.node.addChild(a),a.scale=kit.rnd(0,.3),a.angle=kit.rnd(0,360),a.runAction(cc.sequence(cc.spawn(cc.moveBy(1,cc.v2(kit.rnd(-70,70),kit.rnd(22,100))),cc.rotateBy(1,kit.rnd(0,100)),cc.scaleTo(1,kit.rnd(1.5,2)),cc.fadeOut(1)),cc.destroySelf()))}})}},EFFECT.bulletStreak=function(e,t){var i=this.createMotionStreak(t||"bullet/streak",.6,10,20);this.layer.addToCamera(i,ZORDER.BULLET-1),i.setPosition(e.x,e.y),i.opacity=255;var a=i.motionStreak;return a.updateReal=function(t){a.removeFlag?this.stroke:this.node.setPosition(e.x,e.y),this.deltaTime+=t},a.schedule(a.updateReal,0),i.remove=function(){a.removeFlag=!0,this.runAction(cc.sequence(cc.delayTime(.501),cc.destroySelf()))},i},EFFECT.slimeStreak=function(e){return EFFECT.bulletStreak.call(this,e,"bullet/slime/tuowei1")},EFFECT.tankBulletStreak=function(e){var t=this.createSprite(0,0,"bullet/contact_blt/1");return t.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,t.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,t.opacity=150,t.sprite.schedule(function(){t.sprite.removeFlag||(t.x=e.node.x,t.y=e.node.y)}),this.layer.addToCamera(t,ZORDER.BULLET-1),t.runAction(cc.sequence(cc.scaleTo(.05,1),cc.scaleTo(.05,.9)).repeatForever()),t.remove=function(){t.sprite.removeFlag=!0,t.destroy()},t},EFFECT.missileBulletStreak=function(e){EFFECT.bulletStreak.call(this,e);var t=this.createSprite(e.node.x,e.node.y,"bullet/contact_blt/1");return t.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,t.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,t.opacity=150,t.sprite.scheduleVS(function(){t.sprite.removeFlag||(t.x=e.node.x,t.y=e.node.y)}),this.layer.addToCamera(t,ZORDER.BULLET-1),t.runAction(cc.sequence(cc.scaleTo(.05,.9),cc.scaleTo(.05,.8)).repeatForever()),t.remove=function(){t.sprite.removeFlag=!0,t.destroy()},t},EFFECT.grenadeBulletStreak=function(e){EFFECT.spinBlt.call(this,e);var t=this.createSprite(e.node.x,e.node.y,"bullet/contact_blt/1");return t.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,t.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,t.opacity=150,t.sprite.scheduleVS(function(){t.sprite.removeFlag||(t.x=e.node.x,t.y=e.node.y)}),this.layer.addToCamera(t,ZORDER.BULLET-1),t.runAction(cc.sequence(cc.scaleTo(.05,.9),cc.scaleTo(.05,.8)).repeatForever()),t.remove=function(){t.sprite.removeFlag=!0,t.destroy()},t},EFFECT.bossBulletStreak=function(e){EFFECT.spinBlt.call(this,e,3);var t=this,i=e.define;e.schedule(function(a){if(kit.timer(this,"1",.1,a)){var n=t.createSprite(e.x,e.y,i.frm);n.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,n.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE,n.color=cc.color(122,0,255),n.angle=e.node.angle,t.layer.addToCamera(n,ZORDER.BULLET-1),n.runAction(cc.fadeOut(.5))}})},EFFECT.weaponReloading=function(e){cc.warn("EFFECT.weaponReloading");var t=new cc.Node,i=t.addComponent(cc.Sprite);t.scale=1,t.y=50,this.layer.addToCamera(t,ZORDER.EFFECT),i.schedule(function(){this.node.x=e.obj.getPositionX(),this.node.y=e.obj.getPositionY()}),i=this.createSprite(0,0,"effect/weapon/reload_bg"),t.addChild(i),i.runAction(cc.rotateBy(2,360).repeatForever()),i=this.createSprite(0,0,"effect/weapon/reload_content"),t.addChild(i),i.runAction(cc.sequence(cc.scaleTo(.5,1.5),cc.scaleTo(.5,1)).repeatForever()),t.runAction(cc.sequence(cc.delayTime(2),cc.fadeOut(.2),cc.destroySelf()))},EFFECT.bonusIcon=function(e,t){if(e.display){var i=e.display.attachUtil,a=t.attach||"root";i.generateAttachedNodes(a);var n=i.getAttachedNodes(a)[0];if(n){var o=this.createSprite(0,-25,t.icon);n.addChild(o),e.obj.buffIcon=o}}},RES.lightning=[{atlas:"effect/electric/lightning"},{atlas:"effect/electric/lightning_ball"}],EFFECT.lightning=function(e,t){if(!t.from){for(var i,a,n=e.obj,o=new cc.Node,r=1;r<=2;r++){var s=this.createAnimation("effect/electric/lightning",{repeat:-1,speed:3,rand:1});o.addChild(s),s.setAnchorPoint(.5,0),s.sprite.scheduleVS(function(){var e=kit.rnd(-120,120);this.node.angle=e+t.deg-90,this.node.y=25,this.node.scale=(120-Math.abs(e))/120*.8+.5},.1),s.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,s.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE}s=this.createAnimation("effect/electric/lightning_ball",{repeat:-1,speed:3,rand:1}),o.addChild(s),s.setAnchorPoint(100/205,98/205),s.y=25,o.scale=2;var c=n.attackCenter,l=(n.x,n.y,n._attackDeg+n._deg),d=c_degree2cos(l),h=c_degree2sin(l);return i=0*d-0*h+c.x*n.flipX*n.scale,a=0*h+0*d+c.y*n.scale,o.setPosition(i,a),o.restart=function(){o.active=!0},o.stop=function(){o.active=!1},e.node.addChild(o,100),o}},RES.lightningHit=[{atlas:"effect/electric/hit_lightning"},{atlas:"effect/electric/lightning"}],EFFECT.lightningHit=function(e,t){var i=this.createAnimation("effect/electric/hit_lightning",{speed:3,rand:1});if(e){e.addChild(i,100),i.scale=1.5+.1*Math.random(),i.angle=360*Math.random(),i.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,i.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE;var a=this.createAnimation("effect/electric/lightning",{speed:3,rand:1});this.layer.addToCamera(a,ZORDER.HERO+1),a.setAnchorPoint(.52,.07),a.sprite.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,a.sprite.dstBlendFactor=cc.macro.BlendFactor.ONE;var n=a.sprite;return n.updateReal=function(){if(cc.sys.isObjectValid(e)&&e.obj&&t){var i=this.node,a=e.obj.x-t.x,n=e.obj.y-t.y,o=kit.vector2Degree(a,n),r=kit.norm(a,n);i.angle=o-90,i.setPosition(t.x,t.y),i.setScale(2.5,r/240*4)}},n.scheduleVS(n.updateReal,0),n.updateReal(),i}return null},EFFECT.Laser=function(e,t,i,a){kit.norm(e,t);var n=c_vector2Radian(t,e),o=function(e){r.sprite;var t=n;r.lifetime||(t=r.radTotal),r.scaleX=r.lifetime/r.oLifetime,r.lifetime-=e,r.lifetime<0&&(r.lifetime=null,r.radTotal=t,r.opacity=0,r.bltLength=!1)},r=a.effectMgr.createSprite(0,0,"bullet/laser/aimBlue",null,function(e,t){t.schedule(o,.016)});return r.anchorY=0,r.updateFunc=o,r.start=function(e){r.lifetime=r.oLifetime=e,r.opacity=255},a.layer.addToCamera(r,1200),r.updateLength=function(e,t){r.bltLength=e,r.height=e,t&&(r.angle=-t)},r},EFFECT.PureFireLight=function(e,t,i,a,n,o,r,s,c,l,d,h){var u=i.getPosition&&i.getPosition()||i,p=this.createSprite(u.x+e,u.y+t,"bullet/laser/fire_light"),f=p.getComponent(cc.Sprite);f.srcBlendFactor=cc.macro.BlendFactor.SRC_ALPHA,f.dstBlendFactor=cc.macro.BlendFactor.ONE,s=s||1.2,o=.9*(o||1),p.scale=2*o,p.opacity=d||0,this.layer.addToCamera(p,l||i.zIndex+1);var m=cc.sequence(cc.fadeTo(.004*s,h||100),cc.scaleTo(.04*s,1*o),cc.fadeOut(.1*s),cc.destroySelf());p.runAction(m)},EFFECT.LaserHitFloor=function(e,t,i,a,n){EFFECT.PureFireLight.call(this,e,t,{x:0,y:0},0,-100,.7,n,1.3,2,1300,255,255)},cc._RF.pop()},{}],weaponTeam:[function(e,t){"use strict";cc._RF.push(t,"e60c0AlJzVHZbtuA1GSi6Xf","weaponTeam"),cc.Class({extends:e("./checkPointItem"),properties:{},onLoad:function(){this.statusNode=new cc.Node,this.node.addChild(this.statusNode,2),this.statusNode.scale=1,this.statusNode.y=0},update:function(){this.updateAvatarShake()},updateAvatarShake:function(){var e=this.game.tank,t=e.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).armature().getBone("gun"+this.positionIndex),i=(t.global.rotation,this.shakeOangle,(t.global.x-this.shakeOx)*e.parent.scale),a=(t.global.y-this.shakeOy)*e.parent.scale;this.avatar.x=this.avatar.ox+i,this.avatar.y=this.avatar.oy+a,this.operatorAvatar.x=this.operatorAvatar.ox+i,this.operatorAvatar.y=this.operatorAvatar.oy+a},setHp:function(e){this.hp=e,this.hpBarObj.hp=e,this.updateOperator();var t=this.avatar.armatureDisplay;t.armature()&&(this.hp<=0?t.playAnimation("dead"):t.playAnimation("stand"))},updateHpMax:function(){this.hpMax=1,this.hpBarObj&&(this.hpBarObj.hpMax=this.hpMax)},getHpMax:function(){return this.hpMax},setBaseHp:function(){},getCalculatedHpMax:function(){var t=ItemDefine[this.weapon],i=this.game.args.vehicleConfig.attr.tower.hp||ENTITY[t.gameId].hp,a=this.weaponLvl,n=(Math.pow(4/3,a-1),1*i),o=chapter.data.events,r=[];for(var s in o){var c=o[s],l=EVENTS[c.eventId];c.objectId&&c.objectId!=this.operator||l.attr&&(r=r.concat(l.attr))}for(var d in this.equipment){var h=ItemDefine[this.equipment[d]];h.attr&&(r=r.concat(h.attr))}var u=new(e("./Attribute"));u.init("hpMax",n,1e10,0,function(){});var p=pc.talentGlobal.hp4weapon;p&&u.addScale("hpMax",+p);var f=(u=this.getAttr(u,r)).get("hpMax");return cc.log("getCalculatedHpMax",f),f},getAttr:function(e,t){if(t){var i=e;for(var a in t){var n=t[a],o=n[0];"hpMax"==n[1]&&(o==ADD?i.add(n[1],n[2]):o==ADD_SCALE?i.addScale(n[1],n[2]):o==ADD_COVER?i.addCover(n[1],n[2]):o==MUT_SCALE&&i.mutScale(n[1],n[2]))}return e}},start:function(){this.updateOperator();var e=this.avatar.armatureDisplay;e.armature()&&(this.hp<=0?e.playAnimation("dead"):e.playAnimation("stand"))},setHpBarVisible:function(e){this.hpBar.setVisible(e)},initShow:function(){console.log("initShow",this.config);var e=cc.instantiate(this.game.towerBarPrefab);this.statusNode.addChild(e);var t=e.getComponent("TowerBar"),i=ItemDefine[this.weapon].gameId,a=this.getHpMax()||ENTITY[i].hp;this.hpBarObj={hp:this.hp,hpMax:a,config:{},heatMax:1,getDegree:function(){return 0},define:{attackAngle:[30,90]},lvl:this.weaponLvl},t.init(this.game,this.hpBarObj,{x:0,y:0,getPosition:function(){return cc.v2(0,0)}},{dx:5,dy:-5}),t.enableAlwaysShow(),this.hpBar=t},initAvatarShake:function(){var e=this.game.tank,t=1;for(var i in this.game.tankBlocks)this.game.tankBlocks[i]==this.block&&(t=+i+1);this.positionIndex=t;var a=e.getChildByName("back").getComponent(dragonBones.ArmatureDisplay).armature().getBone("gun"+this.positionIndex);this.shakeOangle=a.global.rotation,this.shakeOx=a.global.x,this.shakeOy=a.global.y},setWeapon:function(e,t,i){this.weapon=e,this.weaponLvl=t,null!=i&&this.setHp(i),this.avatar.destroy(),this.initWeaponAvatar(),this.hpBar.setLevel(this.weaponLvl)},initWeaponAvatar:function(){var e=this,t=this.weapon,i=ItemDefine[t];cc.log("initAvatar:"+t);var a=i.avatar;if(a.sprite){var n=this.game.effectMgr.createSprite(0,0,a.sprite);this.node.addChild(n),this.avatar=n}else a.anime&&(n=menuManager.createArmature(a.anime,a.animeName,function(t,i){e.hp<=0?i.playAnimation("dead"):i.playAnimation("stand")}),this.node.addChild(n),this.avatar=n);var o=ItemTypeDefine.weaponTeam;if(this.avatar.scale=(i.avatar.scale||o&&o.scale||1)*ANIME_SCALE,cc.log("initAvatar define type",i.type,i.avatar.anchorY),o&&null!=o.anchorY)var r=o.anchorY;else null!=i.avatar.anchorY&&(r=i.avatar.anchorY);this.avatar.oy=this.avatar.y+=(-.5+r)*this.block.height,this.avatar.ox=this.avatar.x+=20},initAvatar:function(){this.initWeaponAvatar(),this.updateOperator(),this.initAvatarShake(),this.updateEquipmentIcon(),this.initShow()},updateEquipmentIcon:function(e){this.equipmentIcon||(this.equipmentIcon=[]);for(var t=0;t<=2;t++){var i,a;a=this.equipment[t]?ItemDefine[this.equipment[t]].lvl||1:0;var n=27+27*t-64;this.equipmentIcon[t]?(this.equipmentIcon[t].y=n,a=this.equipment[t]?ItemDefine[this.equipment[t]].lvl||1:0,i=this.game.effectMgr.loadSprite(this.equipmentIcon[t].sprite,"checkpoint/item/i"+a),e&&this.equipmentIcon[t].lvl!=a&&(this.equipmentIcon[t].lvl=a,this.equipmentIcon[t].scale=0,this.equipmentIcon[t].runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(.1,1))))):((i=this.game.effectMgr.createSprite(-100,n,"checkpoint/item/i"+a)).lvl=a,this.statusNode.addChild(i),this.equipmentIcon.push(i),e&&(i.scale=0,i.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.scaleTo(.1,1)))))}},updateOperator:function(){var e=this,t=ENTITY[this.operator].avatar;if(this.operatorAvatar){var i=this.operatorAvatar.armatureDisplay;this.game.effectMgr.loadArmature(i,t.anime,function(t,i){e.hp>0?i.playAnimation("stand"):i.playAnimation("dead")},t.animeName)}else{var a=menuManager.createArmature(t.anime,t.animeName,function(t,i){e.hp>0?i.playAnimation("stand"):i.playAnimation("dead")});a.x-=50,a.y-=5,this.node.addChild(a),this.operatorAvatar=a,this.operatorAvatar.scale=.65,this.operatorAvatar.oy=this.operatorAvatar.y+=-.5*this.block.height,this.operatorAvatar.ox=this.operatorAvatar.x}},updateAvatar:function(){this.avatar&&("forge"==this.avatarState?this.avatar.active=!1:this.avatar.active=!0)},init:function(e,t,i){this.game=e,this.define=t,this.setBlock(i.block),this.config=i,this.scale=1,this.width=100,this.height=100,this.weapon=i.weapon,this.weaponLvl=i.weaponLvl||1,this.equipment=i.equipment||[],this.operator=i.operator,this.updateHpMax(),this.hp=(null!=this.config.hp?this.config.hp:1)*this.hpMax,this.initAvatar(),this.hpBar.setLevel(this.weaponLvl)},setOperator:function(e){this.operator=e},getEquipmentById:function(e){for(var t in this.equipment)if(this.equipment[t]==e)return t},addEquipment:function(e){if(this.equipment.length>=3){var t=this.game.effectMgr.createSprite(0,0,"effect/text/\u914d\u4ef6\u5df2\u6ee1");return this.game.node.addChild(t),void t.runAction(cc.sequence(cc.blink(.5,3),cc.delayTime(1),cc.destroySelf()))}return this.equipment.push(e),cc.log("addEquipment",e,this.equipment),this.updateEquipmentIcon(!0),this.updateHpMax(!0),!0},removeEquipment:function(e){this.equipment.splice(e,1),this.updateEquipmentIcon(!0),this.updateHpMax(!0)},removeEquipmentById:function(e){for(var t in this.equipment)if(this.equipment[t]==e)return void this.removeEquipment(t)},resetAvatarState:function(){this.avatarState=null,this.updateAvatar()},onInteract:function(e){var t,i,a=e.content;if("tank"!=e.blockType&&"forge"!=e.blockType)return"cancel";if("forge"==e.blockType)return this.avatarState?"cancel":(this.avatarState="forge",this.updateAvatar(),this.game.addItem(e,{id:this.weapon,lvl:this.weaponLvl,weaponTeam:this}),"cancel");for(var n in this.game.updateVehicleFixShow(),this.game.tankBlocks)e==this.game.tankBlocks[n]&&(t=n);for(var n in this.game.tankBlocks)this.block==this.game.tankBlocks[n]&&(i=n);if(!a)return chapter.data.bank[t]=chapter.data.bank[i],chapter.data.bank[i]=[],"move";var o=[chapter.data.bank[i],chapter.data.bank[t]];return chapter.data.bank[t]=o[0],chapter.data.bank[i]=o[1],"swap"},onMove:function(){this.game.onWeaponTeamChange(),this.game.updateBattleBottomUI()},onSwapt2:function(e,t){t||this.game.updateBattleBottomUI()}}),cc._RF.pop()},{"./Attribute":void 0,"./checkPointItem":"checkPointItem"}]},{},["A","ADManager","DateTime","SDKManager","MAX","MAXImplement","Analytic","Crashlytics","Firebase","FirebaseTracking","PromiseExt","TimeManager","AIBigShipBoss","AIBossCyborg","AIHelicopterBoss","AISubmarineBoss","AITurtleBoss","AIAlwaysAttack","AISoldier","AITank","AITank2","AIChaseCar","AIIdle","AISimple","AICommon","AIProto","Assist","AIElevator","AIFlySoldier","AIFlySoldierWander","AIFrogman","AIHelicopter","AILaobing","AIMosquito","AIMyTower","AIRocket","AISlime","AISpider","AITurtle","Slot","Attribute","AttributeAgent","AIBuff","AvoidDeathBuff","BigShieldBuff","BltPerShotBuff","Buff","ConditionBuff","DeadlyHitBuff","DodgeBuff","DoubleShotBuff","HpMaxBuff","InfiniteHeatBuff","InvincibleBuff","KillBuff","KillExplosionBuff","LeechBuff","OverHeatBuff","OverlapBuff","PoisonBuff","QuickRecoverOnLowBuff","RecoverBuff","RestrainBuff","ReviveBuff","ShotSeqBuff","SingleBuff","StackBuff","StunBuff","SummonBuff","heroBuff","equipment","BombSkill","IncendiarySkill","NukeSkill","Skill","Focus","Joint","Mover","ArmatureAvatar","Avatar","PrisonerAvatar","VirtualAvatar","EventSystem","InterfaceManager","Entity","Proto","CoreMath","GameConstants","LocalLabel","LocalNode","LocalSprite","local","Transition","TransitionCover","TransitionGo","LabelEffect","LoadingEffect","bonusEffect","buffBannerEffect","dropEffect","effect","hurtNumEffect","itemEffect","numberEffect","scrapEffect","skillEffect","teamEffect","weaponEffect","Hero","HumanAvatar","Pilot","Ground","GroundAvatar","MyTower","Platform","PlatformSprite","TeslaTower","Drop","Item","MoneyPack","BallBulletSprite","BesselMissileSprite","Bomb","Bullet","BulletLaser","BulletSprite","ContactBullet","IncendiaryBomb","Missile","MissileSprite","Mortar","MortarBomb","PowerBullet","SplitArrow","SubArrow","Tank2","Vehicle","VehicleAvatar","tank","BattlePassManager","BattlePassSeasonManager","ConfigSourceManager","ContactManager","EffectManager","EventManager","GameSystem","LevelManager","RemoteConfigManager","StatsLoader","StatsStorage","StatsTracker","TaskBattlePassInit","TaskBattlePassServer","TaskManager","TaskMilestoneManager","TaskResetManager","ballMode","gunnerMode","AddBuffOnShot","AreaPoint","AuthMenu","Background","BackpackItemDefine","BackpackItemInfoMenu","BackpackItemStatInfo","Ball","Basket","BattlePassPopup","BgResize","Blink","BouncingBall","BoxMenu","BoxUpgradeInfo","ChapterBoxRewardInfo","ChapterCompleteMenu","ChapterDefine","ChapterNewMenu","CheckMenu","ColorMatrix","CrashlyticsInit","DEFINE_GO_TO","DailyTaskMenu","DiamondMenu","DifficultyAffixDefine","DraftMenu","Electric","EnergyUpMenu","EquipmentPageDisassemble","EquipmentPageItem","EquipmentPageItemInfo","ErrorMenu","Exploder","FakeUI","FavoriteMenu","FeedbackMenu","Film","FlyShield","FreeIcon","FreeLabel","FullScreenWidget","GarageDefine","GaragePage","GetItemInfo","GiftCodeMenu","GreenDiamondMenu","Handbook","HeroBoard","HeroInfo","HeroModel","HeroStatDefine","IncomeUpMenu","InfoMenu","ItemInfoMenu","ItemMenu","Knife","Laser","Light","LinkMenu","LoadingMenu","Locker","LootMenu","MapDifficultyBoard","MapDifficultySelect","MapPage","Merchant","MerchantSellPop","MeshSprite","Multiplier","MyVehicle","NetMenu","NetSync","NewOperatorGetPopMenu","OfflineTaskMenu","OnlineBox","OnlineBoxMenu","OnlineBoxTimer","OnlineTimer","PassiveItem","PilotPage","PilotStatCard","Pinball","Power","PressToStartPopMenu","RecommendBtn","RecommendIcon","RenameMenu","ReviveMenu","RewardBtn","RewardMenu","Rope","Shine","ShowMenu","ShowNewEquipment","SignItem","SignMenu","SimpleComplete","Spider","StageTaskMenu","Star","SweepMenu","Sync","TJ","Talent","TalentDefine","TaskPopup","TeamHead","Theme","TrainMenu","TutorialPopup","UserInfoMenu","VIPCardMenu","VehicleModel","VehicleUnlock","VideoGuideMenu","VideoIcon","VideoMenu","VirtualLayer","WeaponTeamInfo","WebLiteMenu","adventure","antiAddiction","battleBottomUI","battleBottomWeaponUI","block","bonus","boss","bottomUI","cannon","chapter","checkPointItem","checkPointMenu","checkpointAvatar","checkpointEquipment","checkpointOperator","checkpointVehicleFix","checkpointWeapon","chooseBonus","define","dmgType","elevator","eventDefine","excel","fireThrower","forgeFail","hack","helicopter","hotUpdate","ids","itemBlock","itemDefine","itemInfoBox","kit","labelEffect","laser","levelDefine","machineGun","map","mob","money","noob","operator","operatorInfoBox","privacy","pvp","quickMatch","replay","rifleman","rope","scene","setting","shaderDefine","soldior","task","train","weaponTeam","Dialog","Menu","MenuManager","PopMenu","GameCamera","GameLayer","GameMenu","PauseMenu","BackpackMenu","EquipmentPage","GuideLeaderBoard","ItemMainPlayerRank","ItemRanker","LeaderBoardPopup","WeeklyRewardLeaderBoard","LoginMenu","MainMenu","SettingMenu","TalentMenu","TalentPage","GuideProgressionTrack","ItemProgressionTrack","ProgressionTrack","ShopPage","shop","FriendMenu","MailListMenu","MailMenu","StatsDisplayOverlay","BattlePassItemLevel","BattlePassItemReward","TaskItem","TaskItemReward","BossBar","EnergyBarrier","FloatBar","FullBarWidget","HeadBar","MoneyBar","NumBar","PvpBar","QuestBar","RecommendBar","TeamBar","TopBar","TowerBar","VehicleBar","ClickButton","SwitchButton","JoyButton","Joystick","JoystickButton","JoystickItem","JoystickRocker","AnimUtils","ConsecutiveHPManager","DEBUGADS","DrawRulesManager","EquipmentEncoder","MAXDebug","NativeUtils","StatsCalculator","Utils","jsEvaler","jsParser","version","ApiClient","ApiClientPromise","ApiEndpoints","PakoLoader","net","pomelo","userProtocol","pc","sdk","base64","md5","pako","userZip","record","storage","user","GameResCache","HotUpdate","ResLoader","Startup","temp"]);